const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/sidebar-BqRDWae8.js","assets/index-C-OtLwH9.js","assets/index-DN-vOy2S.css","assets/llm-check-S84pbv31.js"])))=>i.map(i=>d[i]);
var Us=Object.defineProperty;var Ns=(n,e,s)=>e in n?Us(n,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[e]=s;var Pe=(n,e,s)=>Ns(n,typeof e!="symbol"?e+"":e,s);import{c as pe,d as ve,a as g,b as p,e as o,f as L,t as i,F as de,q as he,g as T,i as r,u as Ie,n as ae,h as le,z as ze,j as ye,l as ue,B as ss,C as nt,r as D,o as xe,D as me,E as Re,w as ce,m as fe,G as Dt,H as Et,v as Ls,I as os,J as tt,A as Ee,T as Ut,p as Ke,K as Os,M as Bs,N as qs,O as et,_ as ns,P as js,y as Vs}from"./index-C-OtLwH9.js";import{D as Gs,u as st,P as ut,s as V}from"./sidebar-BqRDWae8.js";import{I as R,_ as be}from"./_plugin-vue_export-helper-DDbKzZqR.js";import{L as Hs}from"./LanguageSwitcher-BV5wNQ_k.js";import{M as as,u as Js,a as Ws}from"./useMessage-CVBeA9Tp.js";import"./llm-check-S84pbv31.js";class mt{static async getDetails(e){try{const s=await fetch(`${this.BASE_URL}/details/${e}`);if(s.status===404)return null;if(!s.ok){const l=await s.text();throw new Error(`Failed to get detailed information: ${s.status} - ${l}`)}const t=await s.text(),a=JSON.parse(t);return a&&typeof a=="object"&&!a.currentPlanId&&(a.currentPlanId=e),a}catch(s){return console.error("[CommonApiService] Failed to get plan details:",s),null}}static async submitFormInput(e,s){const t=await fetch(`${this.BASE_URL}/submit-input/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!t.ok){let l;try{l=await t.json()}catch{l={message:`Failed to submit form input: ${t.status}`}}throw new Error(l.message||`Failed to submit form input: ${t.status}`)}const a=t.headers.get("content-type");return a&&a.indexOf("application/json")!==-1?await t.json():{success:!0}}static async getAllPrompts(){try{const e=await fetch(this.BASE_URL);return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get Prompt list:",e),e}}static async handleResponse(e){if(!e.ok)try{const s=await e.json();throw new Error(s.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}}Pe(mt,"BASE_URL","/api/executor");function Nt(){return{formatResponseText:m=>m?m.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\n/g,"<br>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>"):"",formatTimestamp:m=>{const h=new Date().getTime()-m.getTime();return h<6e4?"Just now":h<36e5?`${Math.floor(h/6e4)} minutes ago`:h<864e5?`${Math.floor(h/36e5)} hours ago`:m.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},getMessageClasses:m=>pe(()=>({user:m.type==="user",assistant:m.type==="assistant",streaming:m.isStreaming,"has-error":!!m.error,"has-thinking":!!m.thinking,"has-execution":!!m.planExecution})),formatFileSize:m=>{if(m===0)return"0 B";const u=1024,h=["B","KB","MB","GB"],y=Math.floor(Math.log(m)/Math.log(u));return parseFloat((m/Math.pow(u,y)).toFixed(2))+" "+h[y]},truncateText:(m,u=100)=>!m||m.length<=u?m:m.substring(0,u)+"...",stripHtml:m=>m.replace(/<[^>]*>/g,""),hasDisplayableContent:m=>!!(m.content||(m.thinking??!1)||(m.planExecution??!1)||m.error),getMessageStatus:m=>m.error?"Send failed":m.isStreaming?"Typing...":m.type==="assistant"&&!m.content&&!m.thinking?"Waiting for response":""}}const zs=["data-message-id"],Ks={class:"user-content"},Xs={class:"message-text"},Qs={key:0,class:"attachments"},Ys={class:"attachment-name"},Zs={class:"attachment-size"},eo={class:"message-timestamp"},to={key:0,class:"message-status error"},so={class:"status-text"},oo=ve({__name:"UserMessage",props:{message:{}},setup(n){const{formatTimestamp:e,formatFileSize:s}=Nt();return(t,a)=>{var l;return p(),g("div",{class:"user-message","data-message-id":t.message.id},[o("div",Ks,[o("div",Xs,i(t.message.content),1),(l=t.message.attachments)!=null&&l.length?(p(),g("div",Qs,[(p(!0),g(de,null,he(t.message.attachments,(c,d)=>(p(),g("div",{key:d,class:"attachment-item"},[T(r(R),{icon:"carbon:document",class:"attachment-icon"}),o("span",Ys,i(c.name),1),o("span",Zs,i(r(s)(c.size)),1)]))),128))])):L("",!0),o("div",eo,i(r(e)(t.message.timestamp)),1)]),t.message.error?(p(),g("div",to,[T(r(R),{icon:"carbon:warning",class:"status-icon"}),o("span",so,i(t.message.error),1)])):L("",!0)],8,zs)}}}),no=be(oo,[["__scopeId","data-v-94372507"]]),ao={class:"sub-plan-info"},lo={class:"sub-plan-details"},ro={class:"sub-plan-title"},io={key:0,class:"nesting-level"},co={class:"sub-plan-id"},uo={class:"sub-plan-meta"},po={key:0,class:"trigger-tool"},ho={class:"trigger-text"},mo={key:0,class:"sub-plan-progress"},fo={class:"progress-info"},go={class:"progress-text"},vo={class:"progress-bar"},bo={key:1,class:"sub-plan-agents-steps"},yo={class:"agents-steps-header"},_o={class:"agents-label"},wo={class:"agents-steps-list"},So=["onClick"],$o={class:"agent-step-header"},Po={class:"agent-name"},ko={class:"sub-agent-execution-info"},Eo={key:0,class:"agent-result"},Co={class:"result-header"},To={class:"result-label"},Ro={class:"result-content"},Io={key:1,class:"agent-error"},Ao={class:"error-header"},xo={class:"error-label"},Mo={class:"error-content"},Fo={key:2,class:"think-act-preview"},Do={class:"think-act-header"},Uo={class:"think-act-label"},No={class:"think-act-steps-preview"},Lo=["onClick"],Oo={class:"step-number"},Bo={class:"step-description"},qo={key:0,class:"more-steps"},jo={class:"more-steps-text"},Vo={key:3,class:"nested-sub-plans"},Go={class:"nested-sub-plans-header"},Ho={class:"nested-label"},Jo={class:"nested-sub-plans-list"},Wo={key:4,class:"direct-sub-plans"},zo={class:"direct-sub-plans-header"},Ko={class:"direct-label"},Xo={class:"direct-sub-plans-list"},Qo=ve({__name:"RecursiveSubPlan",props:{subPlan:{},subPlanIndex:{},nestingLevel:{default:0},maxNestingDepth:{default:3},maxVisibleSteps:{default:2}},emits:["sub-plan-selected","step-selected"],setup(n,{emit:e}){const s=n,t=e,{t:a}=Ie(),l=()=>`nesting-level-${s.nestingLevel}`,c=()=>{var A,B;return s.subPlan.completed?"completed":((A=s.subPlan.agentExecutionSequence)==null?void 0:A.some(C=>C.status==="RUNNING"))?"running":((B=s.subPlan.agentExecutionSequence)==null?void 0:B.some(C=>C.status==="FINISHED"))?"in-progress":"pending"},d=()=>{switch(c()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},m=()=>{switch(c()){case"completed":return"carbon:checkmark";case"running":return"carbon:play";case"in-progress":return"carbon:in-progress";case"pending":default:return"carbon:dot-mark"}},u=()=>{var $;if(!(($=s.subPlan.agentExecutionSequence)!=null&&$.length))return 0;if(s.subPlan.completed)return 100;const f=h();return Math.min(100,f/s.subPlan.agentExecutionSequence.length*100)},h=()=>{var f;return(f=s.subPlan.agentExecutionSequence)!=null&&f.length?s.subPlan.agentExecutionSequence.filter($=>$.status==="FINISHED").length:0},y=f=>{switch(f){case"FINISHED":return"completed";case"RUNNING":return"running";case"IDLE":default:return"pending"}},F=f=>{switch(f){case"FINISHED":return"carbon:checkmark";case"RUNNING":return"carbon:play";case"IDLE":default:return"carbon:dot-mark"}},U=f=>{switch(f){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},x=f=>{var $;return(($=f.thinkActSteps)==null?void 0:$.some(A=>A.subPlanExecutionRecord))??!1},k=f=>{var $;return(($=f.thinkActSteps)==null?void 0:$.filter(A=>A.subPlanExecutionRecord))??[]},_=()=>{t("sub-plan-selected",-1,s.subPlanIndex,s.subPlan)},v=(f,$)=>{const A=$.stepId??`subplan-${s.subPlanIndex}-agent-${f}`;t("step-selected",A)},E=(f,$,A)=>{const B=A.stepId??`subplan-${s.subPlanIndex}-agent-${f}`;t("step-selected",B)},P=(f,$,A)=>{t("sub-plan-selected",f,$,A)},w=f=>{t("step-selected",f)};return(f,$)=>{var B,C;const A=ss("RecursiveSubPlan",!0);return p(),g("div",{class:ae(["recursive-sub-plan",l()])},[o("div",{class:"sub-plan-header",onClick:_},[o("div",ao,[T(r(R),{icon:m(),class:"sub-plan-status-icon"},null,8,["icon"]),o("div",lo,[o("div",ro,[le(i(f.subPlan.title||f.$t("chat.subPlan"))+" #"+i(f.subPlanIndex+1)+" ",1),(f.nestingLevel??0)>0?(p(),g("span",io,"(L"+i((f.nestingLevel??0)+1)+")",1)):L("",!0)]),o("div",co,i(f.subPlan.currentPlanId),1)])]),o("div",uo,[o("div",{class:ae(["sub-plan-status-badge",c()])},i(d()),3),f.subPlan.parentActToolCall?(p(),g("div",po,[T(r(R),{icon:"carbon:function",class:"trigger-icon"}),o("span",ho,i(f.subPlan.parentActToolCall.name),1)])):L("",!0)])]),(B=f.subPlan.agentExecutionSequence)!=null&&B.length?(p(),g("div",mo,[o("div",fo,[o("span",go,i(f.$t("chat.progress"))+": "+i(h())+" / "+i(f.subPlan.agentExecutionSequence.length),1),o("div",vo,[o("div",{class:"progress-fill",style:ze({width:u()+"%"})},null,4)])])])):L("",!0),(C=f.subPlan.agentExecutionSequence)!=null&&C.length?(p(),g("div",bo,[o("div",yo,[o("span",_o,i(f.$t("chat.agentExecutions"))+":",1)]),o("div",wo,[(p(!0),g(de,null,he(f.subPlan.agentExecutionSequence,(M,j)=>{var Z,Q;return p(),g("div",{key:M.id||j,class:ae(["agent-step-item",y(M.status)]),onClick:W=>v(j,M)},[o("div",$o,[T(r(R),{icon:F(M.status),class:"agent-icon"},null,8,["icon"]),o("span",Po,i(M.agentName||f.$t("chat.unknownAgent")),1),o("div",{class:ae(["agent-status-badge",y(M.status)])},i(U(M.status)),3)]),o("div",ko,[M.result?(p(),g("div",Eo,[o("div",Co,[T(r(R),{icon:"carbon:checkmark",class:"result-icon"}),o("span",To,i(f.$t("chat.agentResult"))+":",1)]),o("pre",Ro,i(M.result),1)])):L("",!0),M.errorMessage?(p(),g("div",Io,[o("div",Ao,[T(r(R),{icon:"carbon:warning",class:"error-icon"}),o("span",xo,i(f.$t("chat.errorMessage"))+":",1)]),o("pre",Mo,i(M.errorMessage),1)])):L("",!0),(Z=M.thinkActSteps)!=null&&Z.length?(p(),g("div",Fo,[o("div",Do,[T(r(R),{icon:"carbon:thinking",class:"think-act-icon"}),o("span",Uo,i(f.$t("chat.thinkActSteps"))+" ("+i(M.thinkActSteps.length)+")",1)]),o("div",No,[(p(!0),g(de,null,he(M.thinkActSteps.slice(0,f.maxVisibleSteps??2),(W,X)=>(p(),g("div",{key:W.id||X,class:"think-act-step-preview",onClick:ye(G=>E(j,X,M),["stop"])},[o("span",Oo,"#"+i(X+1),1),o("span",Bo,i(W.actionDescription||f.$t("chat.thinking")),1),T(r(R),{icon:"carbon:arrow-right",class:"step-arrow"})],8,Lo))),128)),M.thinkActSteps.length>(f.maxVisibleSteps??2)?(p(),g("div",qo,[o("span",jo,i(f.$t("chat.andMoreSteps",{count:M.thinkActSteps.length-(f.maxVisibleSteps??2)})),1)])):L("",!0)])])):L("",!0),x(M)?(p(),g("div",Vo,[o("div",Go,[T(r(R),{icon:"carbon:tree-view-alt",class:"nested-icon"}),o("span",Ho,i(f.$t("chat.nestedSubPlans")),1)]),o("div",Jo,[(p(!0),g(de,null,he(k(M),(W,X)=>(p(),ue(A,{key:W.id||X,"sub-plan":W.subPlanExecutionRecord,"sub-plan-index":X,"nesting-level":(f.nestingLevel??0)+1,"max-nesting-depth":f.maxNestingDepth??3,"max-visible-steps":f.maxVisibleSteps??2,onSubPlanSelected:P,onStepSelected:w},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):L("",!0),(Q=M.subPlanExecutionRecords)!=null&&Q.length?(p(),g("div",Wo,[o("div",zo,[T(r(R),{icon:"carbon:tree-view",class:"direct-icon"}),o("span",Ko,i(f.$t("chat.directSubPlans")),1)]),o("div",Xo,[(p(!0),g(de,null,he(M.subPlanExecutionRecords,(W,X)=>(p(),ue(A,{key:W.currentPlanId||X,"sub-plan":W,"sub-plan-index":X,"nesting-level":(f.nestingLevel??0)+1,"max-nesting-depth":f.maxNestingDepth??3,"max-visible-steps":f.maxVisibleSteps??2,onSubPlanSelected:P,onStepSelected:w},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):L("",!0)])],10,So)}),128))])])):L("",!0)],2)}}}),Yo=be(Qo,[["__scopeId","data-v-5dcf159c"]]),Zo={class:"execution-details"},en={key:0,class:"plan-overview"},tn={class:"plan-header"},sn={class:"plan-title"},on={key:0,class:"parent-tool-call"},nn={class:"parent-tool-header"},an={class:"tool-label"},ln={class:"tool-name"},rn={key:0,class:"tool-parameters"},cn={class:"param-label"},dn={class:"param-content"},un={key:1,class:"agent-execution-container"},pn={class:"section-title"},hn=["onClick"],mn={class:"agent-info"},fn={class:"agent-details"},gn={class:"agent-name"},vn={class:"request-content"},bn={class:"agent-controls"},yn={class:"agent-execution-info"},_n={key:0,class:"agent-result"},wn={class:"result-header"},Sn={class:"result-label"},$n={class:"result-content"},Pn={key:1,class:"agent-error"},kn={class:"error-header"},En={class:"error-label"},Cn={class:"error-content"},Tn={key:0,class:"sub-plans-container"},Rn={class:"sub-plans-header"},In={class:"sub-plans-title"},An={class:"sub-plans-list"},xn=ve({__name:"ExecutionDetails",props:{planExecution:{}},emits:["sub-plan-selected","step-selected"],setup(n,{emit:e}){const s=n,t=e,{t:a}=Ie(),l=pe(()=>s.planExecution.agentExecutionSequence??[]),c=k=>{k.stepId?t("step-selected",k.stepId):console.warn("[ExecutionDetails] Agent execution has no stepId:",k)},d=()=>s.planExecution.completed?"completed":l.value.some(v=>v.status==="RUNNING")?"running":l.value.some(v=>v.status==="FINISHED")?"in-progress":"pending",m=()=>{switch(d()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},u=k=>{switch(k){case"RUNNING":return"running";case"FINISHED":return"completed";case"IDLE":default:return"pending"}},h=k=>{switch(k){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},y=k=>{switch(k){case"RUNNING":return"carbon:play";case"FINISHED":return"carbon:checkmark";case"IDLE":default:return"carbon:dot-mark"}},F=(k,_,v)=>{t("sub-plan-selected",k,_,v)},U=k=>{t("step-selected",k)},x=k=>{if(!k)return"";try{const _=JSON.parse(k);return JSON.stringify(_,null,2)}catch{return k}};return(k,_)=>{var v,E,P;return p(),g("div",Zo,[k.planExecution?(p(),g("div",en,[o("div",tn,[o("h3",sn,i(k.planExecution.title||k.$t("chat.planExecution")),1),o("div",{class:ae(["plan-status-badge",d()])},i(m()),3)]),k.planExecution.parentActToolCall?(p(),g("div",on,[o("div",nn,[T(r(R),{icon:"carbon:flow",class:"tool-icon"}),o("span",an,i(k.$t("chat.triggeredByTool"))+":",1),o("span",ln,i(k.planExecution.parentActToolCall.name),1)]),k.planExecution.parentActToolCall.parameters?(p(),g("div",rn,[o("span",cn,i(k.$t("common.parameters"))+":",1),o("pre",dn,i(x(k.planExecution.parentActToolCall.parameters)),1)])):L("",!0)])):L("",!0)])):L("",!0),(((E=(v=k.planExecution)==null?void 0:v.agentExecutionSequence)==null?void 0:E.length)??0)>0?(p(),g("div",un,[o("h4",pn,i(k.$t("chat.agentExecutionSequence")),1),(p(!0),g(de,null,he((P=k.planExecution)==null?void 0:P.agentExecutionSequence,(w,f)=>{var $;return p(),g("div",{key:w.id||f,class:ae(["agent-execution-item",u(w.status)])},[o("div",{class:"agent-header",onClick:A=>c(w)},[o("div",mn,[T(r(R),{icon:y(w.status),class:"agent-status-icon"},null,8,["icon"]),o("div",fn,[o("div",gn,i(w.agentName||k.$t("chat.unknownAgent")),1),o("pre",vn,i(w.agentRequest),1)])]),o("div",bn,[o("div",{class:ae(["agent-status-badge",u(w.status)])},i(h(w.status)),3),T(r(R),{icon:"carbon:arrow-right",class:"step-select-icon"})])],8,hn),o("div",yn,[w.result?(p(),g("div",_n,[o("div",wn,[T(r(R),{icon:"carbon:checkmark",class:"result-icon"}),o("span",Sn,i(k.$t("chat.agentResult"))+":",1)]),o("pre",$n,i(w.result),1)])):L("",!0),w.errorMessage?(p(),g("div",Pn,[o("div",kn,[T(r(R),{icon:"carbon:warning",class:"error-icon"}),o("span",En,i(k.$t("chat.errorMessage"))+":",1)]),o("pre",Cn,i(w.errorMessage),1)])):L("",!0)]),($=w.subPlanExecutionRecords)!=null&&$.length?(p(),g("div",Tn,[o("div",Rn,[T(r(R),{icon:"carbon:tree-view",class:"sub-plans-icon"}),o("span",In,i(k.$t("chat.subPlanExecutions"))+" ("+i(w.subPlanExecutionRecords.length)+") ",1)]),o("div",An,[(p(!0),g(de,null,he(w.subPlanExecutionRecords,(A,B)=>(p(),ue(Yo,{key:A.currentPlanId||B,"sub-plan":A,"sub-plan-index":B,"nesting-level":0,"max-nesting-depth":3,"max-visible-steps":2,onSubPlanSelected:F,onStepSelected:U},null,8,["sub-plan","sub-plan-index"]))),128))])])):L("",!0)],2)}),128))])):L("",!0)])}}}),ls=be(xn,[["__scopeId","data-v-3fdaaeed"]]),Mn={key:0,class:"thinking-section"},Fn={class:"thinking-header"},Dn={class:"thinking-avatar"},Un={class:"thinking-label"},Nn={class:"thinking-content"},Ln={key:0,class:"thinking"},On={key:2,class:"default-processing"},Bn={class:"processing-indicator"},qn=ve({__name:"ThinkingSection",props:{thinking:{},thinkingDetails:{},planExecution:{},stepActions:{},genericInput:{},hasContent:{type:Boolean}},emits:["agent-selected","sub-plan-selected","user-input-submitted","step-selected"],setup(n,{emit:e}){const s=n,t=e,a=pe(()=>{var u,h,y,F;return(s.thinking??!1)||(((h=(u=s.thinkingDetails)==null?void 0:u.agentExecutionSequence)==null?void 0:h.length)??0)>0||(((F=(y=s.planExecution)==null?void 0:y.agentExecutionSequence)==null?void 0:F.length)??0)>0}),l=(u,h)=>{t("agent-selected",u,h)},c=(u,h,y)=>{t("sub-plan-selected",u,h,y)},d=u=>{t("user-input-submitted",u)},m=u=>{t("step-selected",u)};return(u,h)=>a.value?(p(),g("div",Mn,[o("div",Fn,[o("div",Dn,[T(r(R),{icon:"carbon:thinking",class:"thinking-icon"})]),o("div",Un,i(u.$t("chat.thinkingLabel")),1)]),o("div",Nn,[u.thinking?(p(),g("div",Ln,[T(r(R),{icon:"carbon:thinking",class:"thinking-icon"}),o("span",null,i(u.thinking),1)])):L("",!0),u.thinkingDetails||u.planExecution?(p(),ue(ls,{key:1,"plan-execution":u.thinkingDetails||u.planExecution,"step-actions":u.stepActions||[],"generic-input":u.genericInput||"",onAgentSelected:l,onSubPlanSelected:c,onUserInputSubmitted:d,onStepSelected:m},null,8,["plan-execution","step-actions","generic-input"])):!u.hasContent&&u.thinking?(p(),g("div",On,[o("div",Bn,[h[0]||(h[0]=o("div",{class:"thinking-dots"},[o("span"),o("span"),o("span")],-1)),o("span",null,i(u.thinking||u.$t("chat.thinkingProcessing")),1)])])):L("",!0)])])):L("",!0)}}),jn=be(qn,[["__scopeId","data-v-1cb833fc"]]),Vn={class:"user-input-form-container"},Gn={class:"user-input-header"},Hn={class:"user-input-title"},Jn={class:"user-input-message"},Wn={key:0,class:"form-description"},zn={key:0,class:"form-grid"},Kn=["for"],Xn=["id","name","placeholder","required","onUpdate:modelValue"],Qn=["id","name","placeholder","required","onUpdate:modelValue"],Yn=["id","name","placeholder","required","onUpdate:modelValue"],Zn=["id","name","placeholder","required","onUpdate:modelValue"],ea=["id","name","placeholder","required","onUpdate:modelValue"],ta=["id","name","required","onUpdate:modelValue"],sa={value:""},oa=["value"],na={key:6,class:"checkbox-group"},aa=["id","name","value","onUpdate:modelValue"],la={class:"checkbox-label"},ra={key:7,class:"radio-group"},ia=["id","name","value","onUpdate:modelValue"],ca={class:"radio-label"},da=["id","name","placeholder","required","onUpdate:modelValue"],ua={key:1,class:"form-group"},pa={for:"form-input-genericInput"},ha={type:"submit",class:"submit-user-input-btn"},ma=ve({__name:"UserInputForm",props:{userInputWaitState:{},planId:{},genericInput:{}},emits:["user-input-submitted"],setup(n,{emit:e}){const s=n,t=e;Ie();const a=nt({}),l=D(s.genericInput??""),c=D(!1),d=D(null),m=()=>{var U;const F=(U=s.userInputWaitState)==null?void 0:U.formInputs;F&&F.length>0&&(!c.value||Object.keys(a).length!==F.length)&&(F.forEach((k,_)=>{(!(_ in a)||k.type==="checkbox"&&!Array.isArray(a[_])||k.type!=="checkbox"&&a[_]==="")&&(k.type==="checkbox"?a[_]=[]:a[_]="")}),c.value=!0)};xe(()=>{m()}),me(()=>{var F;return(F=s.userInputWaitState)==null?void 0:F.formInputs},()=>{d.value&&clearTimeout(d.value),d.value=setTimeout(()=>{c.value=!1,m()},100)},{deep:!0});const u=async()=>{var F;try{const U={},x=(F=s.userInputWaitState)==null?void 0:F.formInputs;x&&x.length>0?Object.entries(a).forEach(([k,_])=>{const v=parseInt(k,10),P=x[v].label||`input_${k}`;Array.isArray(_)?U[P]=_.join(", "):U[P]=_}):U.genericInput=l.value,console.log("[UserInputForm] Submitting user input:",U,"for planId:",s.planId),s.planId?(await mt.submitFormInput(s.planId,U),console.log("[UserInputForm] User input submitted successfully")):console.error("[UserInputForm] No planId available for user input submission"),t("user-input-submitted",U)}catch(U){console.error("[UserInputForm] User input submission failed:",U)}},h=F=>F?Array.isArray(F)?F:typeof F=="string"?F.split(",").map(U=>U.trim()).filter(U=>U.length>0):[]:[],y=F=>typeof F=="boolean"?F:typeof F=="string"?F==="true":!1;return Re(()=>{d.value&&clearTimeout(d.value)}),(F,U)=>{var x,k,_,v,E;return p(),g("div",Vn,[o("div",Gn,[T(r(R),{icon:"carbon:user",class:"user-icon"}),o("h4",Hn,i(F.$t("chat.userInputRequired")),1)]),o("p",Jn,i(((x=F.userInputWaitState)==null?void 0:x.title)??F.$t("chat.userInput.message")),1),(k=F.userInputWaitState)!=null&&k.formDescription?(p(),g("p",Wn,i((_=F.userInputWaitState)==null?void 0:_.formDescription),1)):L("",!0),o("form",{onSubmit:ye(u,["prevent"]),class:"user-input-form"},[(v=F.userInputWaitState)!=null&&v.formInputs&&F.userInputWaitState.formInputs.length>0?(p(),g("div",zn,[(p(!0),g(de,null,he((E=F.userInputWaitState)==null?void 0:E.formInputs,(P,w)=>(p(),g("div",{key:w,class:"form-group"},[o("label",{for:`form-input-${P.label.replace(/\W+/g,"_")}`},i(P.label)+i(y(P.required)?" *":"")+": ",9,Kn),!P.type||P.type==="text"?ce((p(),g("input",{key:0,type:"text",id:`form-input-${P.label.replace(/\W+/g,"_")}`,name:P.label,placeholder:P.placeholder||"",required:y(P.required),"onUpdate:modelValue":f=>a[w]=f,class:"form-input"},null,8,Xn)),[[fe,a[w]]]):P.type==="email"?ce((p(),g("input",{key:1,type:"email",id:`form-input-${P.label.replace(/\W+/g,"_")}`,name:P.label,placeholder:P.placeholder||"",required:y(P.required),"onUpdate:modelValue":f=>a[w]=f,class:"form-input"},null,8,Qn)),[[fe,a[w]]]):P.type==="number"?ce((p(),g("input",{key:2,type:"number",id:`form-input-${P.label.replace(/\W+/g,"_")}`,name:P.label,placeholder:P.placeholder||"",required:y(P.required),"onUpdate:modelValue":f=>a[w]=f,class:"form-input"},null,8,Yn)),[[fe,a[w]]]):P.type==="password"?ce((p(),g("input",{key:3,type:"password",id:`form-input-${P.label.replace(/\W+/g,"_")}`,name:P.label,placeholder:P.placeholder||"",required:y(P.required),"onUpdate:modelValue":f=>a[w]=f,class:"form-input"},null,8,Zn)),[[fe,a[w]]]):P.type==="textarea"?ce((p(),g("textarea",{key:4,id:`form-input-${P.label.replace(/\W+/g,"_")}`,name:P.label,placeholder:P.placeholder||"",required:y(P.required),"onUpdate:modelValue":f=>a[w]=f,class:"form-input form-textarea",rows:"4"},null,8,ea)),[[fe,a[w]]]):P.type==="select"&&P.options?ce((p(),g("select",{key:5,id:`form-input-${P.label.replace(/\W+/g,"_")}`,name:P.label,required:y(P.required),"onUpdate:modelValue":f=>a[w]=f,class:"form-input form-select"},[o("option",sa,i(F.$t("selectCommon.pleaseSelect")),1),(p(!0),g(de,null,he(h(P.options),f=>(p(),g("option",{key:f,value:f},i(f),9,oa))),128))],8,ta)),[[Dt,a[w]]]):P.type==="checkbox"&&P.options?(p(),g("div",na,[(p(!0),g(de,null,he(h(P.options),f=>(p(),g("label",{key:f,class:"checkbox-item"},[ce(o("input",{type:"checkbox",id:`form-input-${P.label.replace(/\W+/g,"_")}-${f.replace(/\W+/g,"_")}`,name:P.label,value:f,"onUpdate:modelValue":$=>a[w]=$,class:"form-checkbox"},null,8,aa),[[Et,a[w]]]),o("span",la,i(f),1)]))),128))])):P.type==="radio"&&P.options?(p(),g("div",ra,[(p(!0),g(de,null,he(h(P.options),f=>(p(),g("label",{key:f,class:"radio-item"},[ce(o("input",{type:"radio",id:`form-input-${P.label.replace(/\W+/g,"_")}-${f.replace(/\W+/g,"_")}`,name:P.label,value:f,"onUpdate:modelValue":$=>a[w]=$,class:"form-radio"},null,8,ia),[[Ls,a[w]]]),o("span",ca,i(f),1)]))),128))])):ce((p(),g("input",{key:8,type:"text",id:`form-input-${P.label.replace(/\W+/g,"_")}`,name:P.label,placeholder:P.placeholder||"",required:y(P.required),"onUpdate:modelValue":f=>a[w]=f,class:"form-input"},null,8,da)),[[fe,a[w]]])]))),128))])):(p(),g("div",ua,[o("label",pa,i(F.$t("common.input"))+":",1),ce(o("input",{type:"text",id:"form-input-genericInput",name:"genericInput","onUpdate:modelValue":U[0]||(U[0]=P=>l.value=P),class:"form-input"},null,512),[[fe,l.value]])])),o("button",ha,i(F.$t("chat.userInput.submit")),1)],32)])}}}),fa=be(ma,[["__scopeId","data-v-fc42d4b8"]]),ga={class:"response-section"},va={class:"response-header"},ba={class:"response-avatar"},ya={class:"response-name"},_a={key:0,class:"response-timestamp"},wa={class:"response-content"},Sa={key:1,class:"final-response"},$a=["innerHTML"],Pa={class:"response-actions"},ka=["title"],Ea=["title"],Ca={key:2,class:"response-placeholder"},Ta={class:"typing-indicator"},Ra={class:"typing-text"},Ia={key:3,class:"response-error"},Aa={class:"error-text"},xa={key:4,class:"response-empty"},Ma={class:"empty-text"},Fa=ve({__name:"ResponseSection",props:{content:{},isStreaming:{type:Boolean},error:{},timestamp:{},userInputWaitState:{},planId:{},genericInput:{}},emits:["copy","regenerate","retry","user-input-submitted"],setup(n,{emit:e}){const s=n,t=e,{formatResponseText:a,formatTimestamp:l}=Nt(),c=async()=>{if(s.content)try{const h=s.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(h),t("copy")}catch(h){console.error("Failed to copy to clipboard:",h)}},d=()=>{t("regenerate")},m=()=>{t("retry")},u=h=>{console.log("[ResponseSection] User input submitted:",h),t("user-input-submitted",h)};return(h,y)=>{var F;return p(),g("div",ga,[o("div",va,[o("div",ba,[T(r(R),{icon:"carbon:bot",class:"bot-icon"})]),o("div",ya,i(h.$t("chat.botName")),1),h.timestamp?(p(),g("div",_a,i(r(l)(h.timestamp)),1)):L("",!0)]),o("div",wa,[(F=h.userInputWaitState)!=null&&F.waiting?(p(),ue(fa,os({key:0,"user-input-wait-state":h.userInputWaitState},h.planId?{"plan-id":h.planId}:{},{"generic-input":h.genericInput??"",onUserInputSubmitted:u}),null,16,["user-input-wait-state","generic-input"])):L("",!0),h.content?(p(),g("div",Sa,[o("div",{class:"response-text",innerHTML:r(a)(h.content)},null,8,$a),o("div",Pa,[o("button",{class:"action-btn copy-btn",onClick:c,title:h.$t("chat.copyResponse")},[T(r(R),{icon:"carbon:copy"})],8,ka),o("button",{class:"action-btn regenerate-btn",onClick:d,title:h.$t("chat.regenerateResponse")},[T(r(R),{icon:"carbon:renew"})],8,Ea)])])):h.isStreaming?(p(),g("div",Ca,[o("div",Ta,[y[0]||(y[0]=o("div",{class:"typing-dots"},[o("span"),o("span"),o("span")],-1)),o("span",Ra,i(h.$t("chat.thinkingResponse")),1)])])):h.error?(p(),g("div",Ia,[T(r(R),{icon:"carbon:warning",class:"error-icon"}),o("span",Aa,i(h.error),1),o("button",{class:"retry-btn",onClick:m},i(h.$t("chat.retry")),1)])):(p(),g("div",xa,[o("span",Ma,i(h.$t("chat.waitingForResponse")),1)]))])])}}}),Da=be(Fa,[["__scopeId","data-v-6581a34f"]]),Ua={class:"assistant-message"},Na=ve({__name:"AssistantMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(n,{emit:e}){const s=n,t=e,a=()=>{t("copy",s.message.id)},l=()=>{t("regenerate",s.message.id)},c=()=>{t("retry",s.message.id)},d=(u,h)=>{console.log("[AssistantMessage] User input submitted:",h,"for message:",u.id)},m=u=>{console.log("[AssistantMessage] Step selected:",u),t("step-selected",u)};return(u,h)=>{var y,F,U,x;return p(),g("div",Ua,[u.message.thinkingDetails?(p(),ue(jn,{key:0,"thinking-details":u.message.thinkingDetails,onStepSelected:m},null,8,["thinking-details"])):L("",!0),u.message.planExecution?(p(),ue(ls,{key:1,"plan-execution":u.message.planExecution,"step-actions":u.message.stepActions||[],"generic-input":u.message.genericInput||"",onStepSelected:m},null,8,["plan-execution","step-actions","generic-input"])):L("",!0),u.message.content||u.message.error||u.isStreaming||(F=(y=u.message.planExecution)==null?void 0:y.userInputWaitState)!=null&&F.waiting?(p(),ue(Da,os({key:2,content:u.message.content||"","is-streaming":u.isStreaming||!1},{...u.message.error?{error:u.message.error}:{},...(U=u.message.planExecution)!=null&&U.userInputWaitState?{userInputWaitState:u.message.planExecution.userInputWaitState}:{},...(x=u.message.planExecution)!=null&&x.currentPlanId?{planId:u.message.planExecution.currentPlanId}:{}},{timestamp:u.message.timestamp,"generic-input":u.message.genericInput||"",onCopy:a,onRegenerate:l,onRetry:c,onUserInputSubmitted:h[0]||(h[0]=k=>d(u.message,k))}),null,16,["content","is-streaming","timestamp","generic-input"])):L("",!0)])}}}),La=be(Na,[["__scopeId","data-v-3810c279"]]),Oa=ve({__name:"ChatMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(n,{emit:e}){const s=n,t=e,{getMessageClasses:a}=Nt(),l=pe(()=>a(s.message)),c=h=>{t("copy",h)},d=h=>{t("regenerate",h)},m=h=>{t("retry",h)},u=h=>{t("step-selected",h)};return(h,y)=>(p(),g("div",{class:ae(["chat-message",l.value])},[h.message.type==="user"?(p(),ue(no,{key:0,message:h.message},null,8,["message"])):h.message.type==="assistant"?(p(),ue(La,{key:1,message:h.message,"is-streaming":h.isStreaming||!1,onCopy:c,onRegenerate:d,onRetry:m,onStepSelected:u},null,8,["message","is-streaming"])):L("",!0)],2))}}),Ba=be(Oa,[["__scopeId","data-v-218b3735"]]);function Ct(n){const e={...n};return"agentExecutionSequence"in n&&Array.isArray(n.agentExecutionSequence)&&(e.agentExecutionSequence=n.agentExecutionSequence.map(s=>qa(s))),e}function qa(n){const e={...n};return"subPlanExecutionRecords"in n&&Array.isArray(n.subPlanExecutionRecords)&&(e.subPlanExecutionRecords=n.subPlanExecutionRecords.map(s=>Ct(s))),e}function ja(n){const e={...n};return"thinkingDetails"in n&&n.thinkingDetails&&(e.thinkingDetails=Ct(n.thinkingDetails)),"planExecution"in n&&n.planExecution&&(e.planExecution=Ct(n.planExecution)),"attachments"in n&&Array.isArray(n.attachments)&&(e.attachments=[...n.attachments]),e}function Va(){const n=D([]),e=D(!1),s=D(null),t=D(null),a=pe(()=>n.value.length>0?n.value[n.value.length-1]:null),l=pe(()=>s.value!==null),c=pe(()=>n.value.length>0),d=(w,f,$)=>{const A={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:w,content:f,timestamp:new Date,isStreaming:!1,...$};return n.value.push(A),A},m=(w,f)=>{const $=n.value.findIndex(A=>A.id===w);$!==-1&&(n.value[$]={...n.value[$],...f})},u=w=>{const f=n.value.findIndex($=>$.id===w);f!==-1&&n.value.splice(f,1)},h=()=>{n.value=[],s.value=null,t.value=null},y=w=>{s.value=w,m(w,{isStreaming:!0})},F=w=>{w&&m(w,{isStreaming:!1}),s.value===w&&(s.value=null)},U=w=>{t.value=w},x=(w,f,$="content")=>{const A=n.value.find(B=>B.id===w);A&&typeof A[$]=="string"&&m(w,{[$]:A[$]+f})},k=(w,f)=>{m(w,{thinkingDetails:f})},_=(w,f)=>{m(w,{thinking:f})},v=(w,f)=>{m(w,{planExecution:f})},E=w=>n.value.find(f=>f.id===w),P=w=>n.value.findIndex(f=>f.id===w);return{messages:tt(n),isLoading:e,streamingMessageId:tt(s),activeMessageId:tt(t),lastMessage:a,isStreaming:l,hasMessages:c,addMessage:d,updateMessage:m,removeMessage:u,clearMessages:h,startStreaming:y,stopStreaming:F,setActiveMessage:U,appendToMessage:x,updateMessageThinking:_,updateMessageThinkingDetails:k,updateMessagePlanExecution:v,findMessage:E,getMessageIndex:P}}function Ga(n){const e=D(!1),s=D(!0),t=150,a=async(_=!0)=>{n.value&&(await Ee(),n.value.scrollTo({top:n.value.scrollHeight,behavior:_?"smooth":"auto"}))},l=()=>{if(!n.value)return!1;const{scrollTop:_,scrollHeight:v,clientHeight:E}=n.value;return v-_-E<t},c=()=>{if(!n.value)return;const _=l();e.value=!_&&n.value.scrollHeight>n.value.clientHeight,_&&(s.value=!0)},d=()=>{c(),l()||(s.value=!1)},m=async()=>{s.value&&await a()},u=async()=>{s.value=!0,await a()},h=(_,v=!0)=>{if(!n.value)return;const E=n.value.querySelector(`[data-message-id="${_}"]`);E&&E.scrollIntoView({behavior:v?"smooth":"auto",block:"center"})},y=()=>{if(!n.value)return{scrollTop:0,scrollHeight:0,clientHeight:0,isAtTop:!0,isAtBottom:!0,scrollPercentage:0};const{scrollTop:_,scrollHeight:v,clientHeight:E}=n.value,P=_===0,w=_+E>=v-5,f=v>E?_/(v-E)*100:100;return{scrollTop:_,scrollHeight:v,clientHeight:E,isAtTop:P,isAtBottom:w,scrollPercentage:f}},F=()=>{n.value&&n.value.addEventListener("scroll",d,{passive:!0})},U=()=>{n.value&&n.value.removeEventListener("scroll",d)},x=()=>{F(),c()},k=()=>{U()};return xe(()=>{Ee(()=>{x()})}),Re(()=>{k()}),{showScrollToBottom:tt(e),isAutoScrollEnabled:tt(s),scrollToBottom:a,autoScrollToBottom:m,forceScrollToBottom:u,scrollToMessage:h,isNearBottom:l,checkScrollPosition:c,getScrollInfo:y,addScrollListener:F,removeScrollListener:U,initializeScrollBehavior:x,cleanupScrollBehavior:k}}const Ge=class Ge{constructor(){Pe(this,"POLL_INTERVAL",5e3);Pe(this,"state",nt({activePlanId:null,lastSequenceSize:0,isPolling:!1,pollTimer:null}));Pe(this,"callbacks",{});Pe(this,"planExecutionCache",new Map);Pe(this,"uiStateCache",new Map);console.log("[PlanExecutionManager] Initialized with callback-based event system")}getCachedPlanRecord(e){return this.planExecutionCache.get(e)}getCachedUIState(e){return this.uiStateCache.get(e)}setCachedUIState(e,s){this.uiStateCache.set(e,s),console.log(`[PlanExecutionManager] Cached UI state for rootPlanId: ${e}`)}getAllCachedRecords(){return new Map(this.planExecutionCache)}hasCachedPlanRecord(e){return this.planExecutionCache.has(e)}setCachedPlanRecord(e,s){this.planExecutionCache.set(e,s),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${e}`)}clearCachedPlanRecord(e){const s=this.planExecutionCache.delete(e);return s&&console.log(`[PlanExecutionManager] Cleared cached plan execution record for rootPlanId: ${e}`),s}clearAllCachedRecords(){const e=this.planExecutionCache.size,s=this.uiStateCache.size;this.planExecutionCache.clear(),this.uiStateCache.clear(),console.log(`[PlanExecutionManager] Cleared all caches - Plans: ${e}, UI States: ${s}`)}static getInstance(){return Ge.instance||(Ge.instance=new Ge),Ge.instance}getActivePlanId(){return this.state.activePlanId}getState(){return this.state}setEventCallbacks(e){this.callbacks={...this.callbacks,...e},console.log("[PlanExecutionManager] Event callbacks set:",Object.keys(e))}async handleUserMessageSendRequested(e){if(this.validateAndPrepareUIForNewRequest(e))try{if(await this.sendUserMessageAndSetPlanId(e),this.state.activePlanId)this.initiatePlanExecutionSequence(e,this.state.activePlanId);else throw new Error("Failed to get valid plan ID")}catch(s){console.error("[PlanExecutionManager] Failed to send user message:",s);const t=this.state.activePlanId??"error";this.setCachedUIState(t,{enabled:!0}),this.emitChatInputUpdateState(t),this.state.activePlanId=null}}handlePlanExecutionRequested(e,s){console.log("[PlanExecutionManager] Received plan execution request:",{planId:e,query:s}),e?(this.state.activePlanId=e,this.initiatePlanExecutionSequence(s??"Execute Plan",e)):console.error("[PlanExecutionManager] Invalid plan execution request: missing planId")}handleCachedPlanExecution(e,s){const t=this.getCachedPlanRecord(e);return t!=null&&t.currentPlanId?(console.log(`[PlanExecutionManager] Found cached plan execution record for rootPlanId: ${e}`),this.handlePlanExecutionRequested(t.currentPlanId,s),!0):(console.log(`[PlanExecutionManager] No cached plan execution record found for rootPlanId: ${e}`),!1)}validateAndPrepareUIForNewRequest(e){if(!e)return console.warn("[PlanExecutionManager] Query is empty"),!1;if(this.state.activePlanId)return!1;this.emitChatInputClear();const s=this.state.activePlanId??"ui-state";return this.setCachedUIState(s,{enabled:!1,placeholder:"Processing..."}),this.emitChatInputUpdateState(s),!0}async sendUserMessageAndSetPlanId(e){try{const s=await Gs.sendMessage({input:e});if(s!=null&&s.planId)return this.state.activePlanId=s.planId,s;if(s!=null&&s.planTemplateId)return this.state.activePlanId=s.planTemplateId,{...s,planId:s.planTemplateId};throw console.error("[PlanExecutionManager] Failed to get planId from response:",s),new Error("Failed to get valid planId from API response")}catch(s){throw console.error("[PlanExecutionManager] API call failed:",s),s}}initiatePlanExecutionSequence(e,s){console.log(`[PlanExecutionManager] Starting plan execution sequence for query: "${e}", planId: ${s}`);const t=s;st().setTaskRunning(s),console.log("[PlanExecutionManager] Task marked as running with planId:",s),this.emitDialogRoundStart(t),this.startPolling()}handlePlanCompletion(e){this.emitPlanCompleted(e.rootPlanId??""),this.state.lastSequenceSize=0,this.stopPolling();const s=st();s.currentTask&&s.currentTask.isRunning&&(s.currentTask.isRunning=!1,console.log("[PlanExecutionManager] Task marked as completed"));try{setTimeout(async()=>{if(this.state.activePlanId)try{await ut.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}},5e3)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}e.completed&&(this.state.activePlanId=null,this.emitChatInputUpdateState(e.rootPlanId??""))}handlePlanError(e){this.emitPlanError(e.message??""),this.state.lastSequenceSize=0,this.stopPolling();const s=st();s.currentTask&&s.currentTask.isRunning&&(s.currentTask.isRunning=!1,console.log("[PlanExecutionManager] Task marked as stopped due to error"));try{setTimeout(async()=>{if(this.state.activePlanId)try{await ut.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}},5e3)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}}async pollPlanStatus(){if(this.state.activePlanId){if(this.state.isPolling){console.log("[PlanExecutionManager] Previous polling still in progress, skipping");return}try{this.state.isPolling=!0;const e=await this.getPlanDetails(this.state.activePlanId);if(!e){console.warn("[PlanExecutionManager] No details received from API - this might be a temporary network issue");return}if(e.status&&e.status==="failed"&&e.message&&!e.message.includes("Failed to get detailed information")){this.handlePlanError(e);return}e.rootPlanId&&this.setCachedPlanRecord(e.rootPlanId,e),this.emitPlanUpdate(e.rootPlanId??""),e.completed&&this.handlePlanCompletion(e)}catch(e){console.error("[PlanExecutionManager] Failed to poll plan status:",e)}finally{this.state.isPolling=!1}}}async getPlanDetails(e){try{const s=await mt.getDetails(e);return s!=null&&s.rootPlanId&&(this.planExecutionCache.set(s.rootPlanId,s),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${s.rootPlanId}`)),s}catch(s){return console.error("[PlanExecutionManager] Failed to get plan details:",s),{currentPlanId:e,status:"failed",message:s instanceof Error?s.message:"Failed to get plan"}}}startPolling(){this.state.pollTimer&&clearInterval(this.state.pollTimer),this.state.pollTimer=window.setInterval(()=>{this.pollPlanStatus()},this.POLL_INTERVAL),console.log("[PlanExecutionManager] Started polling")}async pollPlanStatusImmediately(){console.log("[PlanExecutionManager] Polling plan status immediately"),await this.pollPlanStatus()}stopPolling(){this.state.pollTimer&&(clearInterval(this.state.pollTimer),this.state.pollTimer=null),console.log("[PlanExecutionManager] Stopped polling")}cleanup(){this.stopPolling(),this.state.activePlanId=null,this.state.lastSequenceSize=0,this.state.isPolling=!1,this.clearAllCachedRecords()}emitChatInputClear(){this.callbacks.onChatInputClear&&this.callbacks.onChatInputClear()}emitChatInputUpdateState(e){this.callbacks.onChatInputUpdateState&&this.callbacks.onChatInputUpdateState(e)}emitDialogRoundStart(e){this.callbacks.onDialogRoundStart&&this.callbacks.onDialogRoundStart(e)}emitPlanUpdate(e){this.callbacks.onPlanUpdate&&this.callbacks.onPlanUpdate(e)}emitPlanCompleted(e){this.callbacks.onPlanCompleted&&this.callbacks.onPlanCompleted(e)}emitPlanError(e){this.callbacks.onPlanError&&this.callbacks.onPlanError(e)}};Pe(Ge,"instance",null);let Tt=Ge;const De=Tt.getInstance(),Ha={class:"chat-container"},Ja={key:0,class:"loading-message"},Wa={class:"loading-content"},za=["title"],Ka=ve({__name:"ChatContainer",emits:["step-selected"],setup(n,{expose:e,emit:s}){const t=s,{t:a}=Ie(),{messages:l,isLoading:c,streamingMessageId:d,addMessage:m,updateMessage:u,startStreaming:h,stopStreaming:y,findMessage:F}=Va(),U=D(null),{scrollToBottom:x,autoScrollToBottom:k,showScrollToBottom:_}=Ga(U),v=D(),E=W=>d.value===W,P=pe(()=>l.value.map(ja)),w=()=>{},f=W=>{const X=W.target;if(X.classList.contains("md-copy-btn")){const G=X.getAttribute("data-raw");if(G){const te=decodeURIComponent(G);navigator.clipboard.writeText(te).then(()=>{X.textContent=a("chat.copied"),setTimeout(()=>{X.textContent=a("chat.copy")},1e3)})}}},$=async W=>{const X=F(W);if(X)try{const G=X.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(G)}catch(G){console.error("Failed to copy message:",G)}},A=W=>{const X=F(W);X&&X.type==="assistant"&&(u(W,{content:""}),h(W))},B=W=>{F(W)&&(u(W,{content:""}),h(W))},C=W=>{console.log("[ChatContainer] Step selected:",W),t("step-selected",W)},M=W=>{console.log("[ChatContainer] Plan update received:",W);const X=De.getCachedPlanRecord(W);if(!X){console.warn("[ChatContainer] No cached plan data found for rootPlanId:",W);return}console.log("[ChatContainer] Retrieved plan details from cache:",X);const G=l.value.findIndex(te=>{var z;return((z=te.planExecution)==null?void 0:z.currentPlanId)===X.currentPlanId&&te.type==="assistant"});if(G!==-1){const te=l.value[G],z={planExecution:JSON.parse(JSON.stringify(X))};if(!X.agentExecutionSequence||X.agentExecutionSequence.length===0){if(console.log("[ChatContainer] Handling simple response without agent execution sequence"),X.completed){z.thinking="";const N=X.summary??X.result??X.message??"Execution completed";z.content=N,console.log("[ChatContainer] Set simple response content:",N)}}else console.log("[ChatContainer] Handling detailed plan with agent execution sequence");u(te.id,z)}},j=W=>{if(console.log("[ChatContainer] Plan completed:",W),W.rootPlanId){const X=l.value.findIndex(G=>{var te;return((te=G.planExecution)==null?void 0:te.currentPlanId)===W.rootPlanId});if(X!==-1){const G=l.value[X],te=W.summary??W.result??"Execution completed";u(G.id,{thinking:"",content:te}),console.log("[ChatContainer] Updated completed message:",te)}}},Z=W=>{console.log("[ChatContainer] Dialog round start:",W)},Q=W=>{console.log("[ChatContainer] Plan error:",W),m("assistant",`Error: ${W}`),console.error("[ChatContainer] Plan execution error:",W)};return xe(()=>{me(l,()=>{Ee(()=>{k()})},{deep:!0}),De.setEventCallbacks({onPlanUpdate:M,onPlanCompleted:j,onDialogRoundStart:Z,onPlanError:Q})}),Re(()=>{v.value&&clearInterval(v.value)}),e({scrollToBottom:x,handlePlanUpdate:M,handlePlanCompleted:j,handleDialogRoundStart:Z,handlePlanError:Q,addMessage:m,updateMessage:u,startStreaming:h,stopStreaming:y}),(W,X)=>(p(),g("div",Ha,[o("div",{class:"messages",ref_key:"messagesRef",ref:U,onScroll:w,onClick:f},[(p(!0),g(de,null,he(P.value,G=>(p(),ue(Ba,{key:G.id,message:G,"is-streaming":E(G.id),onCopy:$,onRegenerate:A,onRetry:B,onStepSelected:C},null,8,["message","is-streaming"]))),128)),r(c)?(p(),g("div",Ja,[o("div",Wa,[T(r(R),{icon:"carbon:circle-dash",class:"loading-icon"}),o("span",null,i(W.$t("chat.processing")),1)])])):L("",!0)],544),T(Ut,{name:"scroll-button"},{default:Ke(()=>[r(_)?(p(),g("button",{key:0,class:"scroll-to-bottom",onClick:X[0]||(X[0]=()=>r(x)()),title:W.$t("chat.scrollToBottom")},[T(r(R),{icon:"carbon:chevron-down"})],8,za)):L("",!0)]),_:1})]))}}),Xa=be(Ka,[["__scopeId","data-v-3aa5b9a4"]]);class Qa{constructor(){Pe(this,"isCollapsed",!1);Pe(this,"selectMemoryId","");Pe(this,"loadMessages",()=>{});Pe(this,"intervalId")}toggleSidebar(){this.isCollapsed=!this.isCollapsed,this.isCollapsed?(this.loadMessages(),this.intervalId=window.setInterval(()=>{this.loadMessages()},3e3)):clearInterval(this.intervalId)}selectMemory(e){this.toggleSidebar(),this.selectMemoryId=e}setMemory(e){this.selectMemoryId=e}defaultMemoryId(){this.selectMemoryId=this.generateRandomId()}clearMemoryId(){this.selectMemoryId=""}generateRandomId(){return Math.random().toString(36).substring(2,10)}setLoadMessages(e){this.loadMessages=e}}const Ne=nt(new Qa);class jt{static async uploadFiles(e){try{console.log("[FileUploadApiService] Uploading files:",e.length);const s=new FormData;e.forEach(l=>{s.append("files",l)});const t=await fetch("/api/file-upload/upload",{method:"POST",body:s});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();return console.log("[FileUploadApiService] Files uploaded successfully:",a.successfulFiles,"uploadKey:",a.uploadKey),a}catch(s){throw console.error("[FileUploadApiService] Error uploading files:",s),s}}static async getUploadedFiles(e){try{console.log("[FileUploadApiService] Getting uploaded files for uploadKey:",e);const s=await fetch(`/api/file-upload/files/${encodeURIComponent(e)}`);if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const t=await s.json();return console.log("[FileUploadApiService] Got uploaded files:",t.totalCount,"for uploadKey:",e),t}catch(s){throw console.error("[FileUploadApiService] Error getting uploaded files:",s),s}}static async deleteFile(e,s){try{console.log("[FileUploadApiService] Deleting file:",s,"from uploadKey:",e);const t=await fetch(`/api/file-upload/files/${encodeURIComponent(e)}/${encodeURIComponent(s)}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();return console.log("[FileUploadApiService] File deleted successfully:",a.success),a}catch(t){throw console.error("[FileUploadApiService] Error deleting file:",t),t}}static async getUploadConfig(){try{console.log("[FileUploadApiService] Getting upload configuration");const e=await fetch("/api/file-upload/config");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();return console.log("[FileUploadApiService] Got upload configuration:",s),s}catch(e){throw console.error("[FileUploadApiService] Error getting upload configuration:",e),e}}}const Ya={class:"file-upload-component"},Za=["accept"],el={key:0},tl={key:1},sl={key:0,class:"files-list"},ol={class:"file-name"},nl={class:"file-size"},al=["onClick","title"],ll={key:0,class:"upload-progress"},rl=ve({__name:"FileUploadComponent",props:{acceptedFileTypes:{default:".pdf,.txt,.md,.doc,.docx,.csv,.xlsx,.xls,.json,.xml,.html,.htm,.log,.java,.py,.js,.ts,.sql,.sh,.bat,.yaml,.yml,.properties,.conf,.ini,.jpg,.jpeg,.png,.gif"},disabled:{type:Boolean,default:!1}},emits:["files-uploaded","files-removed","upload-key-changed","upload-started","upload-completed","upload-error"],setup(n,{expose:e,emit:s}){const{t}=Ie(),a=n,l=s,c=D(),d=D([]),m=D(!1),u=D(null),h=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),d.value=[],u.value=null,l("upload-key-changed",null)};Re(()=>{h()}),me(()=>d.value,_=>{l("files-removed",_)},{deep:!0});const y=()=>{a.disabled||c.value&&c.value.click()},F=async _=>{const v=_.target,E=v.files;if(!E||E.length===0)return;const P=Array.from(E);console.log("[FileUpload] Selected files for upload:",P.map(w=>w.name)),await U(P),v.value=""},U=async _=>{if(_.length!==0){m.value=!0,l("upload-started");try{const v=await jt.uploadFiles(_);v.success&&(!u.value&&v.uploadKey?(u.value=v.uploadKey,console.log("[FileUpload] Set uploadKey:",u.value),d.value=v.uploadedFiles):u.value?(console.log("[FileUpload] Using existing uploadKey:",u.value),d.value=[...d.value,...v.uploadedFiles]):(console.warn("[FileUpload] No uploadKey returned from upload"),d.value=v.uploadedFiles),v.uploadKey&&(u.value=v.uploadKey,console.log("[Input] Saved uploadKey locally:",v.uploadKey),l("upload-key-changed",u.value)),console.log("[Input] Updated global uploadedFiles state:",d.value),l("files-uploaded",d.value,u.value)),console.log("Files uploaded successfully:",v),l("upload-completed")}catch(v){console.error("File upload error:",v),l("upload-error",v)}finally{m.value=!1}}},x=async _=>{try{if(console.log("ðŸ—‘ï¸ Removing file:",_.originalName,"from uploadKey:",u),u.value){const v=await jt.deleteFile(u.value,_.originalName);v.success?console.log("âœ… File deleted from server successfully"):console.error("âŒ Failed to delete file from server:",v.error)}d.value=d.value.filter(v=>v.originalName!==_.originalName),d.value.length===0&&(console.log("[FileUpload] ðŸ§¹ Clearing uploadKey to force new plan for new files"),u.value=null,l("upload-key-changed",null)),console.log("ðŸŽ‰ File removal completed, remaining files:",d.value.length)}catch(v){console.error("âŒ Error removing file:",v),l("upload-error",v)}},k=_=>{if(_===0)return"0 Bytes";const v=1024,E=["Bytes","KB","MB","GB"],P=Math.floor(Math.log(_)/Math.log(v));return parseFloat((_/Math.pow(v,P)).toFixed(2))+" "+E[P]};return e({uploadedFiles:d,uploadKey:u,resetSession:h,uploadFiles:U,removeFile:x,isUploading:m}),(_,v)=>(p(),g("div",Ya,[o("input",{ref_key:"fileInputRef",ref:c,type:"file",multiple:"",style:{display:"none"},onChange:F,accept:_.acceptedFileTypes||""},null,40,Za),o("div",{class:ae(["uploaded-files",{"has-files":d.value.length>0}])},[o("div",{class:"files-header",onClick:y},[T(r(R),{icon:"carbon:attachment"}),d.value.length===0?(p(),g("span",el,i(r(t)("input.attachFile")),1)):(p(),g("span",tl,i(r(t)("input.attachedFiles"))+" ("+i(d.value.length)+")",1))]),d.value.length>0?(p(),g("div",sl,[(p(!0),g(de,null,he(d.value,E=>(p(),g("div",{key:E.originalName,class:"file-item"},[T(r(R),{icon:"carbon:document",class:"file-icon"}),o("span",ol,i(E.originalName),1),o("span",nl,"("+i(k(E.size))+")",1),o("button",{onClick:P=>x(E),class:"remove-btn",title:r(t)("input.removeFile")},[T(r(R),{icon:"carbon:close"})],8,al)]))),128))])):L("",!0)],2),m.value?(p(),g("div",ll,[T(r(R),{icon:"carbon:rotate--clockwise",class:"loading-icon"}),o("span",null,i(r(t)("input.uploading")),1)])):L("",!0)]))}}),rs=be(rl,[["__scopeId","data-v-d1f7078c"]]),il={class:"input-area"},cl={class:"input-container"},dl=["placeholder","disabled"],ul=["title"],pl=["disabled","title"],hl=["title"],ml=ve({__name:"InputArea",props:{placeholder:{default:""},disabled:{type:Boolean,default:!1},initialValue:{default:""}},emits:["send","clear","update-state","plan-mode-clicked"],setup(n,{expose:e,emit:s}){const{t}=Ie(),a=st(),l=pe(()=>a.hasRunningTask()),c=n,d=s,m=D(),u=D(),h=D(""),y=pe(()=>c.placeholder||t("input.placeholder")),F=D(y.value),U=D([]),x=D(null),k=()=>{var G;console.log("[FileUpload] Resetting session and clearing uploadKey"),(G=u.value)==null||G.resetSession()};Re(()=>{k()});const _=(G,te)=>{U.value=G.map(z=>z.originalName),x.value=te,console.log("[InputArea] Files uploaded:",G.length,"uploadKey:",te),U.value.length>0&&(F.value=t("input.filesAttached",{count:U.value.length}))},v=G=>{U.value=G.map(te=>te.originalName),console.log("[InputArea] Files removed, remaining:",G.length),U.value.length===0?F.value=y.value:F.value=t("input.filesAttached",{count:U.value.length})},E=G=>{x.value=G,console.log("[InputArea] Upload key changed:",G)},P=()=>{console.log("[InputArea] Upload started")},w=()=>{console.log("[InputArea] Upload completed")},f=G=>{console.error("[InputArea] Upload error:",G)},$=pe(()=>!!c.disabled),A=()=>{Ee(()=>{m.value&&(m.value.style.height="auto",m.value.style.height=Math.min(m.value.scrollHeight,120)+"px")})},B=G=>{G.key==="Enter"&&!G.shiftKey&&(G.preventDefault(),C())},C=()=>{if(!h.value.trim()||$.value)return;const te={input:h.value.trim(),memoryId:Ne.selectMemoryId,uploadedFiles:U.value};x.value?(te.uploadKey=x.value,console.log("[InputArea] Including uploadKey in message:",x.value)):console.log("[InputArea] No uploadKey available for message"),d("send",te),Z()},M=()=>{d("plan-mode-clicked")},j=async()=>{console.log("[InputArea] Stop button clicked"),await a.stopCurrentTask()?console.log("[InputArea] Task stopped successfully"):console.error("[InputArea] Failed to stop task")},Z=()=>{h.value="",A(),d("clear")},Q=(G,te)=>{te&&(F.value=G?te:t("input.waiting")),d("update-state",G,te)},W=G=>{h.value=G,A()},X=()=>h.value.trim();return me(()=>c.initialValue,G=>{G.trim()&&(h.value=G,A())},{immediate:!0}),e({clearInput:Z,updateState:Q,setInputValue:W,getQuery:X,resetSession:k,focus:()=>{var G;return(G=m.value)==null?void 0:G.focus()},get uploadedFiles(){var G,te;return((te=(G=u.value)==null?void 0:G.uploadedFiles)==null?void 0:te.map(z=>z.originalName))||[]},get uploadKey(){var G;return((G=u.value)==null?void 0:G.uploadKey)||null}}),xe(()=>{}),Re(()=>{}),(G,te)=>(p(),g("div",il,[T(rs,{ref_key:"fileUploadRef",ref:u,disabled:$.value,onFilesUploaded:_,onFilesRemoved:v,onUploadKeyChanged:E,onUploadStarted:P,onUploadCompleted:w,onUploadError:f},null,8,["disabled"]),o("div",cl,[ce(o("textarea",{"onUpdate:modelValue":te[0]||(te[0]=z=>h.value=z),ref_key:"inputRef",ref:m,class:"chat-input",placeholder:F.value,disabled:$.value,onKeydown:B,onInput:A},null,40,dl),[[fe,h.value]]),o("button",{class:"plan-mode-btn",title:G.$t("input.planMode"),onClick:M},[T(r(R),{icon:"carbon:document"}),le(" "+i(G.$t("input.planMode")),1)],8,ul),l.value?(p(),g("button",{key:1,class:"send-button stop-button",onClick:j,title:G.$t("input.stop")},[T(r(R),{icon:"carbon:stop-filled"}),le(" "+i(G.$t("input.stop")),1)],8,hl)):(p(),g("button",{key:0,class:"send-button",disabled:!h.value.trim()||$.value,onClick:C,title:G.$t("input.send")},[T(r(R),{icon:"carbon:send-alt"}),le(" "+i(G.$t("input.send")),1)],8,pl))])]))}}),fl=be(ml,[["__scopeId","data-v-f3b9d060"]]);class rt{static async handleResponse(e){if(!e.ok)try{const s=await e.json();throw new Error(s.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getMemories(){try{const e=await fetch(`${this.BASE_URL}`);return(await(await this.handleResponse(e)).json()).memories??[]}catch(e){throw console.error("Failed to get memory list:",e),e}}static async getMemory(e){try{const s=await fetch(`${this.BASE_URL}/single?conversationId=${e}`),a=await(await this.handleResponse(s)).json();if(!a.data)throw new Error("Memory not found");return a.data}catch(s){throw console.error("Failed to get memory:",s),s}}static async createMemory(e,s){try{const t=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,memory_name:s})}),l=await(await this.handleResponse(t)).json();if(!l.data)throw new Error("Failed to create memory");return l.data}catch(t){throw console.error("Failed to create memory:",t),t}}static async updateMemory(e,s){try{const t=await fetch(`${this.BASE_URL}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,memory_name:s})}),l=await(await this.handleResponse(t)).json();if(!l.data)throw new Error("Failed to update memory");return l.data}catch(t){throw console.error("Failed to update memory:",t),t}}static async deleteMemory(e){try{const s=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE"});await this.handleResponse(s)}catch(s){throw console.error("Failed to delete memory:",s),s}}static async generateConversationId(){try{const e=await fetch(`${this.BASE_URL}/generate-id`),t=await(await this.handleResponse(e)).json();if(!t.data)throw new Error("Failed to generate conversation ID");return t.data}catch(e){throw console.error("Failed to generate conversation ID:",e),e}}}Pe(rt,"BASE_URL","/api/memories");const gl={key:0,class:"app-container"},vl={class:"app-content"},bl={class:"header"},yl={class:"relative"},_l={class:"title-edit-group"},wl={id:"main-title",class:"main-title"},Sl={key:0,id:"title-edit-container",class:"title-edit-container"},$l={class:"search-bar"},Pl={class:"search-container"},kl=["placeholder"],El={class:"message-list",id:"message-list"},Cl={class:"message-header"},Tl={class:"message-content"},Rl={class:"sender-info"},Il=["onClick"],Al={class:"sender-name"},xl=["onClick"],Ml={class:"action-buttons"},Fl=["onClick"],Dl={class:"action-buttons"},Ul=["onClick"],Nl={class:"message-preview"},Ll={class:"preview-line"},Ol={key:0,class:"preview-line",style:{opacity:"0.8"}},Bl={class:"message-meta"},ql={class:"message-id"},jl={class:"meta-right"},Vl={key:0,class:"unread-count"},Gl={class:"message-time"},Hl=["id"],Jl={style:{display:"flex","flex-direction":"column",gap:"0.75rem"}},Wl={class:"bubble-avatar"},zl={class:"bubble-content"},Kl={class:"bubble-text"},Xl={key:0,class:"empty-state"},Ql={class:"modal-content"},Yl={class:"modal-header"},Zl={class:"modal-title"},er=["placeholder"],tr={id:"name-char-count",class:"char-count",style:{"text-align":"right",display:"block","margin-top":"0.25rem"}},sr={class:"modal-footer"},or={class:"modal-content"},nr={class:"modal-header"},ar={class:"modal-title"},lr={class:"state-text",id:"delete-message"},rr={class:"modal-footer"},ir=ve({__name:"Memory",emits:["memory-selected"],setup(n,{emit:e}){const s=D(!1),t=D(""),a=D([]),l=D([]),c=D(!1),d=D(null),m=D(""),u=D(!1),h=D(null),y=new Map,F=e,U=C=>{C.key==="Escape"&&(u.value?A():c.value&&P())};xe(()=>{Ne.setLoadMessages(x),document.addEventListener("keydown",U)}),Re(()=>{document.removeEventListener("keydown",U)});const x=async()=>{try{const C=await rt.getMemories();a.value=C.map(M=>({...M,expanded:y.has(M.conversation_id)?y.get(M.conversation_id):!1})),l.value=[...a.value],v()}catch(C){console.error("error:",C),a.value=[],l.value=[]}},k=C=>{Ne.selectMemory(C),F("memory-selected")},_=C=>{const M=typeof C=="string"?parseInt(C,10):C;return isNaN(M)||M<=0?"unknow time":new Date(M.toString().length===13?M:M*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(","," ")},v=()=>{const C=t.value.toLowerCase().trim();if(!C){l.value=[...a.value];return}l.value=a.value.filter(M=>{var W;const j=M.memory_name.toLowerCase().includes(C),Z=M.conversation_id.toLowerCase().includes(C),Q=((W=M.messages)==null?void 0:W.some(X=>X.text.toLowerCase().includes(C)))??!1;return j||Z||Q})},E=(C,M)=>{d.value=C,m.value=M,c.value=!0},P=()=>{c.value=!1,d.value=null},w=async()=>{if(!d.value)return;const C=m.value.trim()||"unknow name",M=a.value.findIndex(j=>j.conversation_id===d.value);if(M!==-1){const j=a.value[M];try{const Z=await rt.updateMemory(j.conversation_id,C);Z.messages||(Z.messages=[]),a.value[M]={...Z,expanded:j.expanded},v(),c.value=!1}catch(Z){console.error("error:",Z)}}},f=C=>{const M=a.value.find(j=>j.conversation_id===C);if(M){M.expanded=!M.expanded,y.set(C,M.expanded);const j=l.value.findIndex(Z=>Z.conversation_id===C);j!==-1&&(l.value[j]={...M})}},$=C=>{h.value=C,u.value=!0},A=()=>{u.value=!1,h.value=null},B=async()=>{if(h.value)try{await rt.deleteMemory(h.value),a.value=a.value.filter(C=>C.conversation_id!==h.value),v(),a.value.length===0&&Ne.clearMemoryId(),u.value=!1,h.value=null}catch(C){console.error("error:",C)}};return(C,M)=>(p(),ue(Os,{to:"body"},[T(Ut,{name:"modal"},{default:Ke(()=>[r(Ne).isCollapsed?(p(),g("div",gl,[o("div",vl,[o("div",bl,[o("div",yl,[o("div",_l,[o("h1",wl,[o("span",null,i(C.$t("memory.title")),1)])]),s.value?(p(),g("div",Sl)):L("",!0)]),o("button",{class:"close-btn",onClick:M[0]||(M[0]=j=>r(Ne).toggleSidebar())},[T(r(R),{icon:"carbon:close"})])]),o("div",$l,[o("div",Pl,[T(r(R),{class:"search-container-icon",icon:"carbon:search"}),ce(o("input",{type:"text",placeholder:C.$t("memory.searchPlaceholder"),class:"search-input","onUpdate:modelValue":M[1]||(M[1]=j=>t.value=j),onInput:v},null,40,kl),[[fe,t.value]])])]),o("div",El,[o("div",null,[(p(!0),g(de,null,he(l.value,j=>(p(),g("div",{class:ae(["message-item",{expanded:j.expanded}]),key:j.conversation_id},[o("div",Cl,[o("div",Tl,[o("div",Rl,[o("div",{class:"sender-div",onClick:ye(Z=>k(j.conversation_id),["stop"])},[o("h3",Al,i(j.memory_name),1)],8,Il),o("div",{class:"toggle-container",onClick:ye(Z=>E(j.conversation_id,j.memory_name),["stop"])},[T(r(R),{icon:"carbon:edit",class:"edit-btn"})],8,xl),o("div",Ml,[o("button",{class:"delete-btn",onClick:ye(Z=>f(j.conversation_id),["stop"])},[T(r(R),{id:"toggle-"+j.conversation_id,icon:"carbon:chevron-down",class:"down-btn"},null,8,["id"])],8,Fl)]),o("div",Dl,[o("button",{class:"delete-btn",onClick:ye(Z=>$(j.conversation_id),["stop"])},[T(r(R),{icon:"carbon:delete"})],8,Ul)])]),o("div",Nl,[o("p",Ll,i(j.messages&&j.messages.length>0?j.messages[0].text:"none message"),1),j.messages&&j.messages.length>1?(p(),g("p",Ol,i(j.messages[1].text),1)):L("",!0)]),o("div",Bl,[o("span",ql,"ID: "+i(j.conversation_id),1),o("div",jl,[j.messages&&j.messages.length>0?(p(),g("span",Vl,i(j.messages.length)+" "+i(C.$t("memory.size")),1)):L("",!0),o("span",Gl,i(_(j.create_time)),1)])])])]),j.expanded?(p(),g("div",{key:0,id:"content-"+j.conversation_id,class:"expanded-content"},[o("div",Jl,[(p(!0),g(de,null,he(j.messages,(Z,Q)=>(p(),g("div",{class:"message-bubble",key:Q},[o("div",Wl,i(Z.messageType),1),o("div",zl,[o("p",Kl,i(Z.text),1)])]))),128))])],8,Hl)):L("",!0)],2))),128))]),l.value.length===0&&t.value?(p(),g("div",Xl,M[3]||(M[3]=[o("p",{class:"state-text"},"none message",-1)]))):L("",!0)]),c.value?(p(),g("div",{key:0,id:"name-edit-modal",class:"modal-overlay",onClick:ye(P,["self"])},[o("div",Ql,[o("div",Yl,[o("h3",Zl,i(C.$t("memory.changeName")),1),ce(o("input",{type:"text","onUpdate:modelValue":M[2]||(M[2]=j=>m.value=j),class:"edit-input",placeholder:C.$t("memory.newNamePlaceholder")},null,8,er),[[fe,m.value]]),o("span",tr,i(m.value.length),1)]),o("div",sr,[o("button",{id:"cancel-name",class:"modal-btn cancel-btn",onClick:P},i(C.$t("memory.cancel")),1),o("button",{id:"save-name",class:"modal-btn confirm-btn",onClick:w},i(C.$t("memory.save")),1)])])])):L("",!0),u.value?(p(),g("div",{key:1,id:"delete-modal",class:"modal-overlay",onClick:ye(A,["self"])},[o("div",or,[o("div",nr,[o("h3",ar,i(C.$t("memory.deleteHint")),1),o("p",lr,i(C.$t("memory.deleteHintPrefix"))+" "+i(h.value)+" "+i(C.$t("memory.deleteHintSuffix")),1)]),o("div",rr,[o("button",{id:"cancel-delete",class:"modal-btn cancel-btn",onClick:A},i(C.$t("memory.cancel")),1),o("button",{id:"confirm-delete",class:"modal-btn delete-btn-confirm",onClick:B},i(C.$t("memory.delete")),1)])])])):L("",!0)])])):L("",!0)]),_:1})]))}}),cr=be(ir,[["__scopeId","data-v-4dca2d9f"]]),dr="/api/executor";async function is(n){try{const e=await fetch(`${dr}/agent-execution/${n}`);if(!e.ok){if(e.status===404)return console.warn(`Agent execution detail not found for stepId: ${n}`),null;throw new Error(`HTTP error! status: ${e.status}`)}return await e.json()}catch(e){return console.error(`Error fetching agent execution detail for stepId: ${n}:`,e),null}}async function ur(n){return console.log(`Refreshing agent execution detail for stepId: ${n}`),is(n)}class Ve{static async handleResponse(e){if(!e.ok)try{const s=await e.json();throw new Error(s.message??`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getFileTree(e){try{const s=await fetch(`${this.BASE_URL}/tree/${e}`),a=await(await this.handleResponse(s)).json();if(!a.success)throw new Error(a.message??"Failed to get file tree");return a.data}catch(s){throw console.error("Failed to get file tree:",s),s}}static async getFileContent(e,s){try{const t=await fetch(`${this.BASE_URL}/content/${e}?path=${encodeURIComponent(s)}`),l=await(await this.handleResponse(t)).json();if(!l.success)throw new Error(l.message??"Failed to get file content");return l.data}catch(t){throw console.error("Failed to get file content:",t),t}}static async downloadFile(e,s,t){try{const a=await fetch(`${this.BASE_URL}/download/${e}?path=${encodeURIComponent(s)}`);await this.handleResponse(a);const l=await a.blob(),c=window.URL.createObjectURL(l),d=document.createElement("a");d.href=c,d.download=t??s.split("/").pop()??"download",document.body.appendChild(d),d.click(),window.URL.revokeObjectURL(c),document.body.removeChild(d)}catch(a){throw console.error("Failed to download file:",a),a}}static isTextFile(e,s){const t=["text/","application/json","application/xml","application/javascript","application/typescript"],a=[".txt",".md",".json",".xml",".html",".css",".js",".ts",".vue",".jsx",".tsx",".py",".java",".cpp",".c",".h",".sh",".bat",".yml",".yaml",".properties",".conf",".cfg"];if(t.some(c=>e.startsWith(c)))return!0;const l=s.toLowerCase();return a.some(c=>l.endsWith(c))}static getFileIcon(e){if(e.type==="directory")return"carbon:folder";const s=e.name.toLowerCase();return s.endsWith(".js")?"vscode-icons:file-type-js":s.endsWith(".ts")?"vscode-icons:file-type-typescript":s.endsWith(".vue")?"vscode-icons:file-type-vue":s.endsWith(".java")?"vscode-icons:file-type-java":s.endsWith(".py")?"vscode-icons:file-type-python":s.endsWith(".json")?"vscode-icons:file-type-json":s.endsWith(".xml")?"vscode-icons:file-type-xml":s.endsWith(".html")?"vscode-icons:file-type-html":s.endsWith(".css")?"vscode-icons:file-type-css":s.endsWith(".md")?"vscode-icons:file-type-markdown":s.endsWith(".yml")||s.endsWith(".yaml")?"vscode-icons:file-type-yaml":s.endsWith(".pdf")?"vscode-icons:file-type-pdf2":s.endsWith(".doc")||s.endsWith(".docx")?"vscode-icons:file-type-word":s.endsWith(".xls")||s.endsWith(".xlsx")?"vscode-icons:file-type-excel":s.endsWith(".ppt")||s.endsWith(".pptx")?"vscode-icons:file-type-powerpoint":s.match(/\.(jpg|jpeg|png|gif|bmp|svg)$/)?"carbon:image":s.match(/\.(zip|rar|7z|tar|gz)$/)?"carbon:archive":"carbon:document"}}Pe(Ve,"BASE_URL","/api/file-browser");const pr={class:"file-tree-node"},hr={class:"node-icon"},mr={class:"node-name"},fr={key:1,class:"file-size"},gr={key:2,class:"node-actions"},vr={key:0,class:"children"},br=ve({__name:"FileTreeNode",props:{node:{},level:{}},emits:["file-selected","download-file"],setup(n,{emit:e}){const s=n,t=e,a=D(s.level===0),l=D(!1),c=D(!1),d=D({}),m=()=>{s.node.type==="directory"&&(a.value=!a.value)},u=()=>{s.node.type==="directory"?m():h()},h=()=>{s.node.type==="file"&&t("file-selected",s.node),U()},y=()=>{t("download-file",s.node),U()},F=v=>{v.preventDefault(),c.value=!0,d.value={position:"fixed",top:`${v.clientY}px`,left:`${v.clientX}px`,zIndex:1e3},setTimeout(()=>{document.addEventListener("click",U)},0)},U=()=>{c.value=!1,document.removeEventListener("click",U)},x=async()=>{try{await navigator.clipboard.writeText(s.node.path)}catch(v){console.error("Failed to copy path:",v)}U()},k=()=>s.node.type==="directory"?a.value?"carbon:folder-open":"carbon:folder":Ve.getFileIcon(s.node),_=v=>{if(v===0)return"0 B";const E=1024,P=["B","KB","MB","GB"],w=Math.floor(Math.log(v)/Math.log(E));return parseFloat((v/Math.pow(E,w)).toFixed(1))+" "+P[w]};return Re(()=>{document.removeEventListener("click",U)}),(v,E)=>{const P=ss("FileTreeNode",!0);return p(),g("div",pr,[o("div",{class:ae(["node-content",{"is-directory":v.node.type==="directory","is-file":v.node.type==="file","is-expanded":a.value}]),style:ze({paddingLeft:`${v.level*16+12}px`}),onClick:u,onContextmenu:ye(F,["prevent"])},[v.node.type==="directory"?(p(),g("div",{key:0,class:"expand-icon",onClick:ye(m,["stop"])},[T(r(R),{icon:a.value?"carbon:chevron-down":"carbon:chevron-right",class:"chevron-icon"},null,8,["icon"])])):L("",!0),o("div",hr,[T(r(R),{icon:k()},null,8,["icon"])]),o("span",mr,i(v.node.name),1),v.node.type==="file"?(p(),g("span",fr,i(_(v.node.size)),1)):L("",!0),l.value?(p(),g("div",gr,[v.node.type==="file"?(p(),g("button",{key:0,onClick:E[0]||(E[0]=ye(w=>v.$emit("download-file",v.node),["stop"])),class:"action-btn download-btn",title:"Download"},[T(r(R),{icon:"carbon:download"})])):L("",!0)])):L("",!0)],38),v.node.type==="directory"&&a.value&&v.node.children?(p(),g("div",vr,[(p(!0),g(de,null,he(v.node.children,w=>(p(),ue(P,{key:w.path,node:w,level:v.level+1,onFileSelected:E[1]||(E[1]=f=>v.$emit("file-selected",f)),onDownloadFile:E[2]||(E[2]=f=>v.$emit("download-file",f))},null,8,["node","level"]))),128))])):L("",!0),c.value?(p(),g("div",{key:1,class:"context-menu",style:ze(d.value),onClick:E[3]||(E[3]=ye(()=>{},["stop"]))},[o("div",{class:"context-menu-item",onClick:h},[T(r(R),{icon:"carbon:view"}),E[4]||(E[4]=o("span",null,"Open",-1))]),v.node.type==="file"?(p(),g("div",{key:0,class:"context-menu-item",onClick:y},[T(r(R),{icon:"carbon:download"}),E[5]||(E[5]=o("span",null,"Download",-1))])):L("",!0),E[7]||(E[7]=o("div",{class:"context-menu-divider"},null,-1)),o("div",{class:"context-menu-item",onClick:x},[T(r(R),{icon:"carbon:copy"}),E[6]||(E[6]=o("span",null,"Copy Path",-1))])],4)):L("",!0)])}}}),yr=be(br,[["__scopeId","data-v-e4a376d5"]]),_r={class:"file-browser"},wr={class:"file-browser-header"},Sr={class:"header-actions"},$r=["disabled","title"],Pr={class:"file-browser-content"},kr={class:"file-tree-panel"},Er={key:0,class:"loading-state"},Cr={key:1,class:"error-state"},Tr={key:0,class:"waiting-for-files"},Rr={class:"message-content"},Ir={class:"tips"},Ar=["disabled"],xr={key:1,class:"actual-error"},Mr={key:2,class:"empty-state"},Fr={key:3,class:"file-tree"},Dr={key:0,class:"file-content-panel"},Ur={class:"file-content-header"},Nr={class:"file-info"},Lr={class:"file-name"},Or={class:"file-size"},Br={class:"file-actions"},qr=["title"],jr=["title"],Vr={class:"file-content-body"},Gr={key:0,class:"loading-content"},Hr={key:1,class:"content-error"},Jr={key:2,class:"file-content"},Wr={key:0,class:"text-content"},zr={key:1,class:"binary-content"},Kr=ve({__name:"index",props:{planId:{}},setup(n){const e=n,{t:s}=Ie(),t=D(!1),a=D(null),l=D(null),c=D(null),d=D(null),m=D(!1),u=D(null),h=D(null),y=pe(()=>!d.value||!c.value?!1:Ve.isTextFile(d.value.mimeType,c.value.name)),F=pe(()=>a.value&&(a.value.includes("Plan directory not found")||a.value.includes("not found"))),U=()=>{h.value&&(clearTimeout(h.value),h.value=null)},x=()=>{U(),h.value=window.setTimeout(()=>{F.value&&k()},5e3)},k=async()=>{if(e.planId){t.value=!0,a.value=null,U();try{l.value=await Ve.getFileTree(e.planId)}catch(f){a.value=f instanceof Error?f.message:s("fileBrowser.loadError"),console.error("Failed to load file tree:",f);const $=f instanceof Error?f.message:"";($.includes("Plan directory not found")||$.includes("not found"))&&x()}finally{t.value=!1}}},_=async f=>{if(f.type!=="directory"){c.value=f,d.value=null,m.value=!0,u.value=null;try{d.value=await Ve.getFileContent(e.planId,f.path)}catch($){u.value=$ instanceof Error?$.message:s("fileBrowser.contentLoadError"),console.error("Failed to load file content:",$)}finally{m.value=!1}}},v=async f=>{try{await Ve.downloadFile(e.planId,f.path,f.name)}catch($){console.error("Failed to download file:",$)}},E=()=>{c.value=null,d.value=null,u.value=null},P=f=>Ve.getFileIcon(f),w=f=>{if(f===0)return"0 B";const $=1024,A=["B","KB","MB","GB"],B=Math.floor(Math.log(f)/Math.log($));return parseFloat((f/Math.pow($,B)).toFixed(1))+" "+A[B]};return me(()=>e.planId,f=>{f&&(c.value=null,d.value=null,k())},{immediate:!0}),xe(()=>{e.planId&&k()}),Re(()=>{U()}),(f,$)=>(p(),g("div",_r,[o("div",wr,[o("h3",null,i(f.$t("fileBrowser.title")),1),o("div",Sr,[o("button",{class:"refresh-btn",onClick:k,disabled:t.value,title:f.$t("fileBrowser.refresh")},[T(r(R),{icon:"carbon:refresh",class:ae({rotating:t.value}),style:{color:"#ffffff",fontSize:"18px",width:"18px",height:"18px"}},null,8,["class"])],8,$r)])]),o("div",Pr,[o("div",kr,[t.value?(p(),g("div",Er,[T(r(R),{icon:"carbon:loading",class:"rotating"}),o("span",null,i(f.$t("fileBrowser.loading")),1)])):a.value?(p(),g("div",Cr,[F.value?(p(),g("div",Tr,[T(r(R),{icon:"carbon:time",class:"rotating"}),o("div",Rr,[o("h3",null,i(f.$t("fileBrowser.waitingForGeneration")),1),o("p",null,i(f.$t("fileBrowser.planExecuting")),1),o("div",Ir,[T(r(R),{icon:"carbon:information"}),o("span",null,i(f.$t("fileBrowser.filesTip")),1)])]),o("button",{onClick:k,class:"retry-btn",disabled:t.value},[T(r(R),{icon:"carbon:refresh",class:ae({rotating:t.value})},null,8,["class"]),le(" "+i(t.value?f.$t("fileBrowser.checking"):f.$t("fileBrowser.checkNow")),1)],8,Ar)])):(p(),g("div",xr,[T(r(R),{icon:"carbon:warning"}),o("span",null,i(a.value),1),o("button",{onClick:k,class:"retry-btn"},i(f.$t("fileBrowser.retry")),1)]))])):l.value?(p(),g("div",Fr,[T(yr,{node:l.value,level:0,onFileSelected:_,onDownloadFile:v},null,8,["node"])])):(p(),g("div",Mr,[T(r(R),{icon:"carbon:folder-off"}),o("span",null,i(f.$t("fileBrowser.noFiles")),1)]))]),c.value?(p(),g("div",Dr,[o("div",Ur,[o("div",Nr,[T(r(R),{icon:P(c.value)},null,8,["icon"]),o("span",Lr,i(c.value.name),1),o("span",Or,"("+i(w(c.value.size))+")",1)]),o("div",Br,[o("button",{onClick:$[0]||($[0]=A=>v(c.value)),class:"download-btn",title:f.$t("fileBrowser.download")},[T(r(R),{icon:"carbon:download"})],8,qr),o("button",{onClick:E,class:"close-btn",title:f.$t("common.close")},[T(r(R),{icon:"carbon:close"})],8,jr)])]),o("div",Vr,[m.value?(p(),g("div",Gr,[T(r(R),{icon:"carbon:loading",class:"rotating"}),o("span",null,i(f.$t("fileBrowser.loadingContent")),1)])):u.value?(p(),g("div",Hr,[T(r(R),{icon:"carbon:warning"}),o("span",null,i(u.value),1)])):d.value?(p(),g("div",Jr,[y.value?(p(),g("div",Wr,[o("pre",null,[o("code",null,i(d.value.content),1)])])):(p(),g("div",zr,[T(r(R),{icon:"carbon:document-unknown"}),o("p",null,i(f.$t("fileBrowser.binaryFile")),1),o("button",{onClick:$[1]||($[1]=A=>v(c.value)),class:"download-btn-large"},[T(r(R),{icon:"carbon:download"}),le(" "+i(f.$t("fileBrowser.downloadToView")),1)])]))])):L("",!0)])])):L("",!0)])]))}}),Xr=be(Kr,[["__scopeId","data-v-e7c74fe4"]]),Qr={class:"right-panel"},Yr={class:"preview-header"},Zr={class:"preview-tabs"},ei={class:"preview-content"},ti={key:0,class:"step-details"},si={key:0,class:"step-info"},oi={key:0,class:"agent-info"},ni={class:"info-item"},ai={class:"label"},li={class:"value"},ri={class:"info-item"},ii={class:"label"},ci={class:"value"},di={class:"info-item"},ui={class:"label"},pi={class:"execution-status"},hi={class:"status-item"},mi={class:"status-text"},fi={key:0},gi={key:0,class:"think-act-steps"},vi={class:"steps-container"},bi={class:"step-header"},yi={class:"step-number"},_i={class:"think-section"},wi={class:"think-content"},Si={class:"input"},$i={class:"label"},Pi={class:"output"},ki={class:"label"},Ei={key:0,class:"action-section"},Ci={class:"action-content"},Ti={class:"tool-info"},Ri={class:"label"},Ii={class:"value"},Ai={class:"input"},xi={class:"label"},Mi={class:"output"},Fi={class:"label"},Di={key:0,class:"sub-plan-section"},Ui={class:"sub-plan-content"},Ni={class:"sub-plan-header"},Li={class:"sub-plan-info"},Oi={class:"label"},Bi={class:"value"},qi={key:0,class:"sub-plan-info"},ji={class:"label"},Vi={class:"value"},Gi={class:"sub-plan-status"},Hi={class:"status-text"},Ji={key:0,class:"no-steps-message"},Wi={key:1,class:"no-execution-message"},zi={class:"step-basic-info"},Ki={class:"info-item"},Xi={class:"label"},Qi={class:"value"},Yi={key:0,class:"info-item"},Zi={class:"label"},ec={class:"value"},tc={class:"info-item"},sc={class:"label"},oc={class:"no-execution-hint"},nc={key:2,class:"execution-indicator"},ac={class:"execution-text"},lc={key:1,class:"no-selection"},rc=["title"],ic={key:1,class:"file-browser-container"},cc={key:1,class:"no-plan-message"},dc={class:"message-content"},uc={class:"tips"},pc=ve({__name:"RightPanel",props:{currentRootPlanId:{},selectedStepId:{}},setup(n,{expose:e}){const s=n,{t}=Ie(),a=D(),l=D(),c=D("details"),d=D(localStorage.getItem("jmanus-last-plan-id")),m=D(localStorage.getItem("jmanus-has-executed-plan")==="true"),u=D(!1),h=D(!0),y=D(!0),F=pe(()=>l.value?l.value.completed?t("rightPanel.status.completed"):l.value.current?t("rightPanel.status.executing"):t("rightPanel.status.waiting"):""),U=pe(()=>s.currentRootPlanId?s.currentRootPlanId:d.value),x=pe(()=>!U.value&&!m.value),k=async C=>{var M,j,Z;if(console.log("[RightPanel] Step selected:",{stepId:C}),!C){console.warn("[RightPanel] No stepId provided"),l.value=null;return}try{const Q=await is(C);if(!Q){console.warn("[RightPanel] Agent execution detail not found for stepId:",C),l.value=null;return}const W={stepId:C,title:Q.agentName??`Step ${C}`,description:Q.agentDescription??"",agentExecution:Q,completed:Q.status==="FINISHED",current:Q.status==="RUNNING"};l.value=W,console.log("[RightPanel] Step details updated:",W),console.log("[RightPanel] activeTab:",c.value),console.log("[RightPanel] selectedStep.value:",l.value),console.log("[RightPanel] agentExecution:",l.value.agentExecution),console.log("[RightPanel] thinkActSteps:",(M=l.value.agentExecution)==null?void 0:M.thinkActSteps),console.log("[RightPanel] thinkActSteps length:",(Z=(j=l.value.agentExecution)==null?void 0:j.thinkActSteps)==null?void 0:Z.length),await Ee(),console.log("[RightPanel] After nextTick - selectedStep:",l.value),setTimeout(()=>{E()},100),w()}catch(Q){console.error("[RightPanel] Error fetching step details:",Q),l.value=null}},_=async()=>{var C;if(!((C=l.value)!=null&&C.stepId)){console.warn("[RightPanel] No step selected for refresh");return}console.log("[RightPanel] Refreshing current step:",l.value.stepId);try{const M=await ur(l.value.stepId);M&&(l.value.agentExecution=M,l.value.completed=M.status==="FINISHED",l.value.current=M.status==="RUNNING",console.log("[RightPanel] Step refreshed successfully"),w())}catch(M){console.error("[RightPanel] Error refreshing step:",M)}};me(()=>s.selectedStepId,async C=>{C?await k(C):l.value=null},{immediate:!0});const v=C=>{a.value=C??void 0},E=()=>{if(!a.value)return;const{scrollTop:C,scrollHeight:M,clientHeight:j}=a.value,Z=M-C-j<50,Q=M>j;h.value=Z,u.value=Q&&!Z,Z?y.value=!0:M-C-j>100&&(y.value=!1),console.log("[RightPanel] Scroll state check:",{scrollTop:C,scrollHeight:M,clientHeight:j,isAtBottom:Z,hasScrollableContent:Q,showButton:u.value,shouldAutoScroll:y.value})},P=()=>{a.value&&(a.value.scrollTo({top:a.value.scrollHeight,behavior:"smooth"}),Ee(()=>{y.value=!0,E()}))},w=()=>{!y.value||!a.value||Ee(()=>{a.value&&(a.value.scrollTop=a.value.scrollHeight,console.log("[RightPanel] Auto scroll to bottom"))})},f=C=>{if(C===null||typeof C>"u"||C==="")return"N/A";try{const M=typeof C=="object"?C:JSON.parse(C);return JSON.stringify(M,null,2)}catch{return String(C)}},$=()=>{l.value=null,y.value=!0,a.value&&a.value.removeEventListener("scroll",E)},A=()=>{const C=()=>{const M=a.value;return M?(v(M),M.addEventListener("scroll",E),y.value=!0,E(),console.log("[RightPanel] Scroll listener initialized successfully"),!0):(console.log("[RightPanel] Scroll container not found, retrying..."),!1)};Ee(()=>{C()||setTimeout(()=>{C()},100)})};return me(()=>s.currentRootPlanId,(C,M)=>{C&&C!==M?(d.value=C,m.value=!0,localStorage.setItem("jmanus-last-plan-id",C),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] New plan started:",C)):!C&&M&&console.log("[RightPanel] Plan execution finished, keeping last plan:",d.value)},{immediate:!0}),xe(()=>{console.log("[RightPanel] Component mounted"),Ee(()=>{A()})}),Re(()=>{console.log("[RightPanel] Component unmounting, cleaning up..."),$()}),e({handleStepSelected:k,refreshCurrentStep:_,updateDisplayedPlanProgress:C=>{console.log("[RightPanel] updateDisplayedPlanProgress called with rootPlanId:",C),C&&(d.value=C,m.value=!0,localStorage.setItem("jmanus-last-plan-id",C),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] Plan progress updated:",C))}}),(C,M)=>{var j,Z;return p(),g("div",Qr,[o("div",Yr,[o("div",Zr,[o("div",{class:ae(["tab-item",{active:c.value==="details"}]),onClick:M[0]||(M[0]=Q=>c.value="details")},[T(r(R),{icon:"carbon:events"}),o("span",null,i(r(t)("rightPanel.stepExecutionDetails")),1)],2),o("div",{class:ae(["tab-item",{active:c.value==="files"}]),onClick:M[1]||(M[1]=Q=>c.value="files")},[T(r(R),{icon:"carbon:folder"}),o("span",null,i(r(t)("fileBrowser.title")),1)],2)])]),o("div",ei,[c.value==="details"?(p(),g("div",ti,[l.value?(p(),g("div",si,[o("h3",null,i(l.value.title||l.value.description||r(t)("rightPanel.defaultStepTitle",{number:1})),1),l.value.agentExecution?(p(),g("div",oi,[o("div",ni,[o("span",ai,i(r(t)("rightPanel.executingAgent"))+":",1),o("span",li,i(l.value.agentExecution.agentName),1)]),o("div",ri,[o("span",ii,i(r(t)("rightPanel.callingModel"))+":",1),o("span",ci,i(l.value.agentExecution.modelName),1)]),o("div",di,[o("span",ui,i(r(t)("rightPanel.executionResult"))+":",1),o("span",{class:ae(["value",{success:l.value.agentExecution.status==="FINISHED"}])},i(l.value.agentExecution.status||r(t)("rightPanel.executing")),3)])])):L("",!0),o("div",pi,[o("div",hi,[l.value.completed?(p(),ue(r(R),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):l.value.current?(p(),ue(r(R),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})):(p(),ue(r(R),{key:2,icon:"carbon:time",class:"status-icon pending"})),o("span",mi,i(F.value),1)])])])):L("",!0),o("div",{ref_key:"scrollContainer",ref:a,class:"step-details-scroll-container",onScroll:E},[l.value?(p(),g("div",fi,[(j=l.value.agentExecution)!=null&&j.thinkActSteps&&l.value.agentExecution.thinkActSteps.length>0?(p(),g("div",gi,[o("h4",null,i(r(t)("rightPanel.thinkAndActionSteps")),1),o("div",vi,[(p(!0),g(de,null,he(l.value.agentExecution.thinkActSteps,(Q,W)=>(p(),g("div",{key:W,class:"think-act-step"},[o("div",bi,[o("span",yi,"#"+i(W+1),1),o("span",{class:ae(["step-status",Q.status])},i(Q.status||r(t)("rightPanel.executing")),3)]),o("div",_i,[o("h5",null,[T(r(R),{icon:"carbon:thinking"}),le(" "+i(r(t)("rightPanel.thinking")),1)]),o("div",wi,[o("div",Si,[o("span",$i,i(r(t)("rightPanel.input"))+":",1),o("pre",null,i(f(Q.thinkInput)),1)]),o("div",Pi,[o("span",ki,i(r(t)("rightPanel.output"))+":",1),o("pre",null,i(f(Q.thinkOutput)),1)])])]),Q.actionNeeded?(p(),g("div",Ei,[o("h5",null,[T(r(R),{icon:"carbon:play"}),le(" "+i(r(t)("rightPanel.action")),1)]),o("div",Ci,[(p(!0),g(de,null,he(Q.actToolInfoList,(X,G)=>(p(),g("div",{key:G},[o("div",Ti,[o("span",Ri,i(r(t)("rightPanel.tool"))+":",1),o("span",Ii,i(X.name||""),1)]),o("div",Ai,[o("span",xi,i(r(t)("rightPanel.toolParameters"))+":",1),o("pre",null,i(f(X.parameters)),1)]),o("div",Mi,[o("span",Fi,i(r(t)("rightPanel.executionResult"))+":",1),o("pre",null,i(f(X.result)),1)])]))),128))]),Q.subPlanExecutionRecord?(p(),g("div",Di,[o("h5",null,[T(r(R),{icon:"carbon:tree-view"}),le(" "+i(r(t)("rightPanel.subPlan")),1)]),o("div",Ui,[o("div",Ni,[o("div",Li,[o("span",Oi,i(C.$t("rightPanel.subPlanId"))+":",1),o("span",Bi,i(Q.subPlanExecutionRecord.currentPlanId),1)]),Q.subPlanExecutionRecord.title?(p(),g("div",qi,[o("span",ji,i(C.$t("rightPanel.title"))+":",1),o("span",Vi,i(Q.subPlanExecutionRecord.title),1)])):L("",!0),o("div",Gi,[Q.subPlanExecutionRecord.completed?(p(),ue(r(R),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):(p(),ue(r(R),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})),o("span",Hi,i(Q.subPlanExecutionRecord.completed?C.$t("rightPanel.status.completed"):C.$t("rightPanel.status.executing")),1)])])])])):L("",!0)])):L("",!0)]))),128))]),l.value.agentExecution&&!((Z=l.value.agentExecution.thinkActSteps)!=null&&Z.length)?(p(),g("div",Ji,[o("p",null,i(r(t)("rightPanel.noStepDetails")),1)])):l.value.agentExecution?L("",!0):(p(),g("div",Wi,[T(r(R),{icon:"carbon:information",class:"info-icon"}),o("h4",null,i(r(t)("rightPanel.stepInfo")),1),o("div",zi,[o("div",Ki,[o("span",Xi,i(r(t)("rightPanel.stepName"))+":",1),o("span",Qi,i(l.value.title||l.value.description||l.value.stepId),1)]),l.value.description?(p(),g("div",Yi,[o("span",Zi,i(C.$t("rightPanel.description"))+":",1),o("span",ec,i(l.value.description),1)])):L("",!0),o("div",tc,[o("span",sc,i(C.$t("rightPanel.status.label"))+":",1),o("span",{class:ae(["value",{"status-completed":l.value.completed,"status-current":l.value.current,"status-pending":!l.value.completed&&!l.value.current}])},i(l.value.completed?C.$t("rightPanel.status.completed"):l.value.current?C.$t("rightPanel.status.executing"):C.$t("rightPanel.status.pending")),3)])]),o("p",oc,i(r(t)("rightPanel.noExecutionInfo")),1)])),l.value.current&&!l.value.completed?(p(),g("div",nc,[M[2]||(M[2]=o("div",{class:"execution-waves"},[o("div",{class:"wave wave-1"}),o("div",{class:"wave wave-2"}),o("div",{class:"wave wave-3"})],-1)),o("p",ac,[T(r(R),{icon:"carbon:in-progress",class:"rotating-icon"}),le(" "+i(r(t)("rightPanel.stepExecuting")),1)])])):L("",!0)])):(p(),g("div",lc,[T(r(R),{icon:"carbon:events",class:"empty-icon"}),o("h3",null,i(r(t)("rightPanel.noStepSelected")),1),o("p",null,i(r(t)("rightPanel.selectStepHint")),1)]))])):L("",!0),T(Ut,{name:"scroll-button"},{default:Ke(()=>[u.value?(p(),g("button",{key:0,onClick:P,class:"scroll-to-bottom-btn",title:r(t)("rightPanel.scrollToBottom")},[T(r(R),{icon:"carbon:chevron-down"})],8,rc)):L("",!0)]),_:1})],544)])):L("",!0),c.value==="files"?(p(),g("div",ic,[U.value?(p(),ue(Xr,{key:0,"plan-id":U.value},null,8,["plan-id"])):x.value?(p(),g("div",cc,[T(r(R),{icon:"carbon:folder-off"}),o("div",dc,[o("h3",null,i(r(t)("fileBrowser.noFilesYet")),1),o("p",null,i(r(t)("fileBrowser.noPlanExecuting")),1),o("div",uc,[T(r(R),{icon:"carbon:information"}),o("span",null,i(r(t)("fileBrowser.startTaskTip")),1)])])])):L("",!0)])):L("",!0)])])}}}),hc=be(pc,[["__scopeId","data-v-3ea813c1"]]);class Le{static async getCoordinatorToolConfig(){try{const e=await fetch(`${this.BASE_URL}/config`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get coordinator tool config: ${e.status}`);return await e.json()}catch(e){return console.error("Failed to get CoordinatorTool configuration:",e),{enabled:!0,success:!1,message:e.message}}}static async getAllEndpoints(){try{const e=await fetch(`${this.BASE_URL}/endpoints`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get endpoints: ${e.status}`);return await e.json()}catch(e){throw console.error("Failed to get endpoints:",e),new Error("Failed to get endpoints: "+e.message)}}static async getCoordinatorToolsByTemplate(e){console.log("[CoordinatorToolApiService] Starting to get coordinator tool, planTemplateId:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/get-get-or-new-by-template/${e}`);try{const s=await fetch(`${this.BASE_URL}/get-or-new-by-template/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",s.status),console.log("[CoordinatorToolApiService] Response status text:",s.statusText),s.status===404)return console.log("[CoordinatorToolApiService] 404"),null;if(!s.ok){const a=await s.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to get coordinator tools: ${s.status} - ${a}`)}const t=await s.json();return console.log("[CoordinatorToolApiService] Successfully got coordinator tool, result:",t),t}catch(s){throw console.error("[CoordinatorToolApiService] Failed to get coordinator tool:",s),new Error("Failed to get coordinator tool: "+s.message)}}static async getOrNewCoordinatorToolsByTemplate(e){console.log("[CoordinatorToolApiService] Starting to get or create coordinator tool, planTemplateId:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/get-or-new-by-template/${e}`);try{const s=await fetch(`${this.BASE_URL}/get-or-new-by-template/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",s.status),console.log("[CoordinatorToolApiService] Response status text:",s.statusText),!s.ok){const a=await s.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to get coordinator tools: ${s.status} - ${a}`)}const t=await s.json();return console.log("[CoordinatorToolApiService] Successfully got coordinator tool, result:",t),t}catch(s){throw console.error("[CoordinatorToolApiService] Failed to get coordinator tool:",s),new Error("Failed to get coordinator tool: "+s.message)}}static async createCoordinatorTool(e){console.log("[CoordinatorToolApiService] Starting to create coordinator tool"),console.log("[CoordinatorToolApiService] Original data:",JSON.stringify(e,null,2)),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}`);const s={id:e.id,toolName:e.toolName,toolDescription:e.toolDescription,inputSchema:e.inputSchema,planTemplateId:e.planTemplateId,httpEndpoint:e.httpEndpoint,mcpEndpoint:e.mcpEndpoint,serviceGroup:e.serviceGroup,enableInternalToolcall:e.enableInternalToolcall,enableHttpService:e.enableHttpService,enableMcpService:e.enableMcpService};console.log("[CoordinatorToolApiService] Cleaned sending data:",JSON.stringify(s,null,2));try{const t=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(console.log("[CoordinatorToolApiService] Response status:",t.status),console.log("[CoordinatorToolApiService] Response status text:",t.statusText),!t.ok){let l="Unknown error";try{const c=await t.json();l=c.message||c.error||l}catch{l=await t.text()||l}throw console.error("[CoordinatorToolApiService] Response error content:",l),new Error(`Failed to create coordinator tool: ${t.status} - ${l}`)}const a=await t.json();return console.log("[CoordinatorToolApiService] Created successfully, result:",a),a}catch(t){throw console.error("[CoordinatorToolApiService] Failed to create coordinator tool:",t),new Error("Failed to create coordinator tool: "+t.message)}}static async updateCoordinatorTool(e,s){console.log("[CoordinatorToolApiService] Starting to update coordinator tool, ID:",e),console.log("[CoordinatorToolApiService] Sending data:",s),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/${e}`);const t={id:s.id,toolName:s.toolName,toolDescription:s.toolDescription,inputSchema:s.inputSchema,planTemplateId:s.planTemplateId,httpEndpoint:s.httpEndpoint,mcpEndpoint:s.mcpEndpoint,serviceGroup:s.serviceGroup,enableInternalToolcall:s.enableInternalToolcall,enableHttpService:s.enableHttpService,enableMcpService:s.enableMcpService};console.log("[CoordinatorToolApiService] Cleaned sending data:",t);try{const a=await fetch(`${this.BASE_URL}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(console.log("[CoordinatorToolApiService] Response status:",a.status),console.log("[CoordinatorToolApiService] Response status text:",a.statusText),!a.ok){let c="Unknown error";try{const d=await a.json();c=d.message||d.error||c}catch{c=await a.text()||c}throw console.error("[CoordinatorToolApiService] Response error content:",c),new Error(`Failed to update coordinator tool: ${a.status} - ${c}`)}const l=await a.json();return console.log("[CoordinatorToolApiService] Updated successfully, result:",l),l}catch(a){throw console.error("[CoordinatorToolApiService] Failed to update coordinator tool:",a),new Error("Failed to update coordinator tool: "+a.message)}}static async deleteCoordinatorTool(e){console.log("[CoordinatorToolApiService] Starting to delete coordinator tool, ID:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/${e}`);try{const s=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",s.status),console.log("[CoordinatorToolApiService] Response status text:",s.statusText),!s.ok){const a=await s.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to delete coordinator tool: ${s.status} - ${a}`)}const t=await s.json();return console.log("[CoordinatorToolApiService] Deleted successfully, result:",t),t}catch(s){throw console.error("[CoordinatorToolApiService] Failed to delete coordinator tool:",s),new Error("Failed to delete coordinator tool: "+s.message)}}}Pe(Le,"BASE_URL","/api/coordinator-tools");class cs{static async handleResponse(e){if(!e.ok)try{const s=await e.json();throw new Error(s.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getAllAgents(e){try{if(e){const s=await fetch(`${this.BASE_URL}/namespace/${e}`);return await(await this.handleResponse(s)).json()}else{const s=await fetch(`${this.BASE_URL}`);return await(await this.handleResponse(s)).json()}}catch(s){throw console.error("Failed to get Agent list:",s),s}}static async getAgentById(e){try{const s=await fetch(`${this.BASE_URL}/${e}`);return await(await this.handleResponse(s)).json()}catch(s){throw console.error(`Failed to get Agent[${e}] details:`,s),s}}static async createAgent(e){try{const s=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await(await this.handleResponse(s)).json()}catch(s){throw console.error("Failed to create Agent:",s),s}}static async updateAgent(e,s){try{const t=await fetch(`${this.BASE_URL}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});return await(await this.handleResponse(t)).json()}catch(t){throw console.error(`Failed to update Agent[${e}]:`,t),t}}static async deleteAgent(e){try{const s=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE"});if(s.status===400)throw new Error("Cannot delete default Agent");await this.handleResponse(s)}catch(s){throw console.error(`Failed to delete Agent[${e}]:`,s),s}}static async getAvailableTools(){try{const e=await fetch(`${this.BASE_URL}/tools`);return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get available tools list:",e),e}}}Pe(cs,"BASE_URL","/api/agents");class Lt{static async getParameterRequirements(e){try{const s=await fetch(`${this.BASE_URL}/${e}/parameters`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`Failed to get parameter requirements: ${s.statusText}`);return await s.json()}catch(s){throw console.error("Error getting parameter requirements:",s),s}}}Pe(Lt,"BASE_URL","/api/plan-template");const mc={class:"modal-form wide-modal"},fc={class:"form-section"},gc={class:"form-item"},vc=["placeholder"],bc={class:"field-description"},yc={class:"form-section"},_c={class:"form-item"},wc=["placeholder"],Sc={class:"field-description"},$c={class:"form-section"},Pc={class:"form-item"},kc={class:"service-group-autocomplete"},Ec=["placeholder"],Cc={key:0,class:"service-group-dropdown"},Tc=["onMousedown"],Rc={class:"field-description"},Ic={class:"form-section"},Ac={class:"section-title"},xc={key:0,class:"params-help-text"},Mc={class:"parameter-table"},Fc=["onUpdate:modelValue","placeholder","readonly"],Dc=["onUpdate:modelValue","placeholder"],Uc={class:"form-section"},Nc={class:"service-publish-options"},Lc={class:"internal-toolcall-publish-option"},Oc={class:"checkbox-label"},Bc={class:"checkbox-text"},qc={class:"checkbox-description"},jc={class:"http-publish-option"},Vc={class:"checkbox-label"},Gc={class:"checkbox-text"},Hc={class:"checkbox-description"},Jc={class:"button-container"},Wc=["disabled"],zc=["disabled"],Kc=ve({__name:"PublishServiceModal",props:{modelValue:{type:Boolean,default:!1},planTemplateId:{default:""},planDescription:{default:""}},emits:["update:modelValue","published"],setup(n,{expose:e,emit:s}){const{t}=Ie(),a=n,l=s,c=pe({get:()=>a.modelValue,set:N=>l("update:modelValue",N)}),d=D(""),m=D(""),u=D(!1),h=D(!1),y=D(null),F=D(!1),U=D(!1),x=D(!0),k=D({parameters:[],hasParameters:!1,requirements:""}),_=D(!1),v=D(!1),E=D([]),P=D(!1),w=nt({serviceName:"",userRequest:"",endpoint:"",serviceGroup:"",parameters:[]}),f=pe(()=>{const N=w.serviceGroup.trim();if(!N)return E.value;const J=N.toLowerCase();return E.value.filter(K=>K.toLowerCase().includes(J))}),$=pe(()=>{var J;const N=(J=y.value)==null?void 0:J.id;return t(N?"mcpService.updateService":"mcpService.createService")}),A=()=>{w.serviceName="",w.userRequest=a.planDescription||"",w.endpoint="",w.serviceGroup="",k.value.hasParameters||(w.parameters=[]),y.value=null,F.value=!1};me(()=>w.userRequest,N=>{const J=N.trim();J&&(w.serviceName.trim()||(w.serviceName=J))});const B=async()=>{if(!P.value){P.value=!0;try{const N=await cs.getAvailableTools(),J=new Set;N.forEach(K=>{K.serviceGroup&&J.add(K.serviceGroup)}),E.value=Array.from(J).sort()}catch(N){console.error("[PublishModal] Failed to load service groups:",N),E.value=[]}finally{P.value=!1}}},C=()=>{v.value=!0},M=()=>{setTimeout(()=>{v.value=!1},200)},j=N=>{w.serviceGroup=N,v.value=!1},Z=async()=>{if(!a.planTemplateId){k.value={parameters:[],hasParameters:!1,requirements:""};return}_.value=!0;try{const N=await Lt.getParameterRequirements(a.planTemplateId);k.value=N,N.hasParameters&&(w.parameters=N.parameters.map(J=>({name:J,description:""})))}catch(N){console.error("[PublishModal] Failed to load parameter requirements:",N),N instanceof Error&&!N.message.includes("404")&&console.warn("[PublishModal] Parameter requirements not available yet, will retry later"),k.value={parameters:[],hasParameters:!1,requirements:""}}finally{_.value=!1}},Q=(N,J)=>{J==="success"?(m.value=N,setTimeout(()=>{m.value=""},3e3)):J==="error"&&(d.value=N,setTimeout(()=>{d.value=""},5e3))},W=()=>{if(!w.serviceName.trim())return Q(t("mcpService.toolNameRequiredError"),"error"),!1;if(!w.userRequest.trim())return Q(t("mcpService.toolDescriptionRequiredError"),"error"),!1;if(!w.serviceGroup.trim())return Q(t("mcpService.serviceGroupRequiredError"),"error"),!1;if(!x.value&&!U.value)return Q("Please select at least one service type","error"),!1;for(let N=0;N<w.parameters.length;N++){const J=w.parameters[N];if(J.name&&!J.description.trim())return Q(`Parameter "${J.name}" description cannot be empty`,"error"),!1;if(J.description&&!J.name.trim())return Q(`Parameter description "${J.description}" corresponding name cannot be empty`,"error"),!1}return!0},X=async()=>{if(console.log("[PublishModal] Starting to handle publish request"),console.log("[PublishModal] Form data:",w),console.log("[PublishModal] Current tool:",y.value),console.log("[PublishModal] Publish as HTTP service:",U.value),!W()){console.log("[PublishModal] Form validation failed");return}u.value=!0;try{y.value||(console.log("[PublishModal] No current tool data, getting or creating first"),y.value=await Le.getOrNewCoordinatorToolsByTemplate(a.planTemplateId)),console.log("[PublishModal] Updating tool information"),y.value.toolName=w.serviceName.trim(),y.value.toolDescription=w.userRequest.trim(),y.value.serviceGroup=w.serviceGroup.trim(),y.value.planTemplateId=a.planTemplateId,y.value.enableInternalToolcall=x.value,y.value.enableHttpService=U.value,y.value.enableMcpService=!1,y.value.mcpEndpoint=void 0;const N=w.parameters.filter(K=>K.name.trim()&&K.description.trim()).map(K=>({name:K.name.trim(),description:K.description.trim(),type:"string"}));if(y.value.inputSchema=JSON.stringify(N),console.log("[PublishModal] Updated tool information:",y.value),y.value.id)console.log("[PublishModal] Updating existing tool, ID:",y.value.id),await Le.updateCoordinatorTool(y.value.id,y.value);else{console.log("[PublishModal] Creating new tool");const K=await Le.createCoordinatorTool(y.value);y.value=K}const J=[];if(x.value&&J.push("Internal Method Call"),U.value&&J.push("HTTP Service"),J.length>0){console.log("[PublishModal] Step 5: Publishing service, ID:",y.value.id,"Enabled services:",J.join(", "));const K=[];x.value&&K.push(`Internal Call: ${w.serviceName}`),console.log("[PublishModal] Service published successfully"),Q(t("mcpService.publishSuccess"),"success"),l("published",y.value)}else console.log("[PublishModal] Only saving tool, not publishing as any service"),Q(t("mcpService.saveSuccess"),"success"),l("published",y.value)}catch(N){console.error("[PublishModal] Failed to publish service:",N),Q(t("mcpService.publishFailed")+": "+N.message,"error")}finally{u.value=!1}},G=async()=>{var N;if(!h.value&&confirm(t("mcpService.deleteConfirmMessage"))){if(!((N=y.value)!=null&&N.id)){Q(t("mcpService.deleteFailed")+": "+t("mcpService.selectPlanTemplateFirst"),"error");return}h.value=!0;try{console.log("[PublishModal] Starting to delete MCP service, ID:",y.value.id);const J=await Le.deleteCoordinatorTool(y.value.id);if(J.success)console.log("[PublishModal] Deleted successfully"),Q(t("mcpService.deleteSuccess"),"success"),c.value=!1,l("published",null);else throw new Error(J.message)}catch(J){console.error("[PublishModal] Failed to delete MCP service:",J),Q(t("mcpService.deleteFailed")+": "+J.message,"error")}finally{h.value=!1}}},te=async()=>{c.value&&(console.log("[PublishModal] Modal opened, starting to initialize data"),A(),await z())},z=async()=>{if(!a.planTemplateId){console.log("[PublishModal] "+t("mcpService.noPlanTemplateId"));return}try{console.log("[PublishModal] Starting to load coordinator tool data, planTemplateId:",a.planTemplateId);const N=await Le.getOrNewCoordinatorToolsByTemplate(a.planTemplateId);console.log("[PublishModal] Get coordinator tool data result:",N),y.value=N,F.value=!!N.id;const J=[];if(N.enableMcpService&&N.mcpEndpoint){const K=window.location.origin;J.push(`MCP: ${K}/mcp${N.mcpEndpoint}`)}N.enableInternalToolcall&&J.push(`Internal Call: ${N.toolName}`),console.log("[PublishModal] Load tool data completed"),w.serviceName=N.toolName||"",w.userRequest=N.toolDescription||a.planDescription||"",w.serviceGroup=N.serviceGroup??"",U.value=N.enableHttpService??!1,x.value=N.enableInternalToolcall??!1;try{if(N.inputSchema){const K=JSON.parse(N.inputSchema);Array.isArray(K)&&K.length>0?(w.parameters=K.map(O=>({name:O.name||"",description:O.description||""})),console.log("[PublishModal] Load parameters from inputSchema:",w.parameters)):console.log("[PublishModal] inputSchema is empty, keeping existing parameters:",w.parameters)}}catch(K){console.warn("[PublishModal] "+t("mcpService.parseInputSchemaFailed")+":",K),console.log("[PublishModal] Parsing failed, keeping existing parameters:",w.parameters)}console.log("[PublishModal] Form data filled:",w)}catch(N){console.error("[PublishModal] "+t("mcpService.loadToolDataFailed")+":",N),Q(t("mcpService.loadToolDataFailed")+": "+N.message,"error")}};return me(()=>a.modelValue,te),me(()=>a.planTemplateId,(N,J)=>{N&&N!==J&&(J&&N.startsWith("planTemplate-")?setTimeout(()=>{Z()},1e3):Z())}),me(c,N=>{N&&B()}),xe(async()=>{c.value&&(console.log("[PublishModal] Initialize when component mounted"),A(),await z(),await Z())}),e({loadParameterRequirements:Z}),(N,J)=>(p(),g(de,null,[T(as,{modelValue:c.value,"onUpdate:modelValue":J[6]||(J[6]=K=>c.value=K),title:$.value,onConfirm:X},{footer:Ke(()=>{var K;return[o("div",Jc,[F.value&&((K=y.value)!=null&&K.id)?(p(),g("button",{key:0,class:"action-btn danger",onClick:G,disabled:h.value},[h.value?(p(),ue(r(R),{key:0,icon:"carbon:loading",class:"loading-icon"})):(p(),ue(r(R),{key:1,icon:"carbon:trash-can"})),le(" "+i(h.value?r(t)("mcpService.deleting"):r(t)("mcpService.delete")),1)],8,Wc)):L("",!0),o("button",{class:"action-btn primary",onClick:X,disabled:u.value},[u.value?(p(),ue(r(R),{key:0,icon:"carbon:loading",class:"loading-icon"})):(p(),ue(r(R),{key:1,icon:"carbon:cloud-upload"})),le(" "+i(u.value?r(t)("mcpService.publishing"):r(t)("mcpService.publishAsService")),1)],8,zc)])]}),default:Ke(()=>[o("div",mc,[o("div",fc,[o("div",gc,[o("label",null,i(r(t)("mcpService.toolNameRequired")),1),ce(o("input",{type:"text","onUpdate:modelValue":J[0]||(J[0]=K=>w.serviceName=K),placeholder:r(t)("mcpService.toolNamePlaceholder"),class:ae({error:!w.serviceName||!w.serviceName.trim()}),required:""},null,10,vc),[[fe,w.serviceName]]),o("div",bc,i(r(t)("mcpService.toolNameDescription")),1)])]),o("div",yc,[o("div",_c,[o("label",null,i(r(t)("mcpService.toolDescriptionRequired")),1),ce(o("textarea",{"onUpdate:modelValue":J[1]||(J[1]=K=>w.userRequest=K),placeholder:r(t)("mcpService.toolDescriptionPlaceholder"),class:ae([{error:!w.userRequest||!w.userRequest.trim()},"description-field"]),rows:"4",required:""},null,10,wc),[[fe,w.userRequest]]),o("div",Sc,i(r(t)("mcpService.toolDescriptionDescription")),1)])]),o("div",$c,[o("div",Pc,[o("label",null,i(r(t)("mcpService.serviceGroup")),1),o("div",kc,[ce(o("input",{type:"text","onUpdate:modelValue":J[2]||(J[2]=K=>w.serviceGroup=K),onInput:C,onFocus:J[3]||(J[3]=K=>v.value=!0),onBlur:M,placeholder:r(t)("mcpService.serviceGroupPlaceholder"),class:ae({error:!w.serviceGroup||!w.serviceGroup.trim()}),required:""},null,42,Ec),[[fe,w.serviceGroup]]),v.value&&f.value.length>0?(p(),g("div",Cc,[(p(!0),g(de,null,he(f.value,K=>(p(),g("div",{key:K,class:"service-group-option",onMousedown:O=>j(K)},i(K),41,Tc))),128))])):L("",!0)]),o("div",Rc,i(r(t)("mcpService.serviceGroupDescription")),1)])]),o("div",Ic,[o("div",Ac,i(r(t)("mcpService.parameterConfig")),1),k.value.hasParameters?(p(),g("div",xc,i(r(t)("sidebar.parameterRequirementsHelp")),1)):L("",!0),o("div",Mc,[o("table",null,[o("thead",null,[o("tr",null,[o("th",null,i(r(t)("mcpService.parameterName")),1),o("th",null,i(r(t)("mcpService.parameterDescription")),1)])]),o("tbody",null,[(p(!0),g(de,null,he(w.parameters,(K,O)=>(p(),g("tr",{key:O},[o("td",null,[ce(o("input",{type:"text","onUpdate:modelValue":b=>K.name=b,placeholder:r(t)("mcpService.parameterName"),class:ae(["parameter-input",{"readonly-input":k.value.hasParameters}]),readonly:k.value.hasParameters,required:""},null,10,Fc),[[fe,K.name]])]),o("td",null,[ce(o("input",{type:"text","onUpdate:modelValue":b=>K.description=b,placeholder:r(t)("mcpService.parameterDescription"),class:"parameter-input",required:""},null,8,Dc),[[fe,K.description]])])]))),128))])])])]),o("div",Uc,[o("div",Nc,[o("div",Lc,[o("label",Oc,[ce(o("input",{type:"checkbox","onUpdate:modelValue":J[4]||(J[4]=K=>x.value=K),class:"checkbox-input"},null,512),[[Et,x.value]]),o("span",Bc,i(r(t)("mcpService.publishAsInternalToolcall")),1)]),o("div",qc,i(r(t)("mcpService.publishAsInternalToolcallDescription")),1)]),o("div",jc,[o("label",Vc,[ce(o("input",{type:"checkbox","onUpdate:modelValue":J[5]||(J[5]=K=>U.value=K),class:"checkbox-input"},null,512),[[Et,U.value]]),o("span",Gc,i(r(t)("mcpService.publishAsHttpService")),1)]),o("div",Hc,i(r(t)("mcpService.publishAsHttpServiceDescription")),1)])])])])]),_:1},8,["modelValue","title"]),d.value?(p(),g("div",{key:0,class:"error-toast",onClick:J[7]||(J[7]=K=>d.value="")},[T(r(R),{icon:"carbon:error"}),le(" "+i(d.value),1)])):L("",!0),m.value?(p(),g("div",{key:1,class:"success-toast",onClick:J[8]||(J[8]=K=>m.value="")},[T(r(R),{icon:"carbon:checkmark"}),le(" "+i(m.value),1)])):L("",!0)],64))}}),Xc=be(Kc,[["__scopeId","data-v-ed79e898"]]),Qc={class:"config-section"},Yc={class:"section-header"},Zc={class:"execution-content"},ed={class:"params-requirements-group"},td={class:"params-help-text"},sd={key:0,class:"parameter-fields"},od={class:"parameter-label"},nd=["onUpdate:modelValue","placeholder","onInput"],ad={key:0,class:"parameter-error"},ld={key:1,class:"validation-message"},rd=["disabled"],id=["disabled"],cd={key:1,class:"call-example-wrapper"},dd={class:"call-example-header"},ud={class:"call-example-title"},pd={class:"call-example-description"},hd={class:"internal-call-wrapper"},md={class:"call-info"},fd={class:"call-method"},gd={class:"call-endpoint"},vd={key:0,class:"call-endpoint"},bd={class:"call-description"},yd={class:"call-example"},_d={class:"example-code"},wd={key:2,class:"call-example-wrapper"},Sd={class:"call-example-header"},$d={class:"call-example-title"},Pd={class:"call-example-description"},kd={class:"http-api-urls-wrapper"},Ed={class:"tab-container"},Cd={class:"tab-header"},Td=["onClick"],Rd={class:"tab-content"},Id={class:"http-api-url-display"},Ad={class:"api-method"},xd={class:"api-endpoint"},Md={class:"api-description"},Fd={key:0,class:"api-example"},Dd={class:"example-code"},Ud={key:3,class:"call-example-wrapper"},Nd={class:"call-example-header"},Ld={class:"call-example-title"},Od={class:"call-example-description"},Bd={class:"mcp-call-wrapper"},qd={class:"call-info"},jd={class:"call-method"},Vd={class:"call-endpoint"},Gd={class:"call-description"},Hd={class:"call-example"},Jd={class:"example-code"},Wd=ve({__name:"ExecutionController",props:{currentPlanTemplateId:{default:""},isExecuting:{type:Boolean,default:!1},isGenerating:{type:Boolean,default:!1},showPublishButton:{type:Boolean,default:!0},toolInfo:{default:()=>({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""})}},emits:["executePlan","publishMcpService","clearParams","updateExecutionParams"],setup(n,{expose:e,emit:s}){const{t}=Ie(),a=n,l=s,c=D(""),d=D({parameters:[],hasParameters:!1,requirements:""}),m=D({}),u=D(!1),h=D("get-sync"),y=D({}),F=D(!1),U=D(!1),x=D(),k=D([]),_=D(null),v=D([{id:"get-sync",label:"GET + Sync",method:"GET",endpoint:"/api/executor/executeByToolNameSync/{toolName}",description:"Synchronous GET request - returns execution result immediately",example:`GET /api/executor/executeByToolNameSync/my-tool?allParams={"rawParam":"test"}
Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-sync",label:"POST + Sync",method:"POST",endpoint:"/api/executor/executeByToolNameSync",description:"Synchronous POST request - returns execution result immediately",example:`POST /api/executor/executeByToolNameSync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-async",label:"POST + Async",method:"POST",endpoint:"/api/executor/executeByToolNameAsync",description:"Asynchronous POST request - returns task ID, check status separately",example:`POST /api/executor/executeByToolNameAsync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "planId": "plan-123",
  "status": "processing",
  "message": "Task submitted, processing",
  "memoryId": "ABC12345",
  "toolName": "my-tool",
  "planTemplateId": "template-456"
}

# Check execution status and get detailed results:
GET /api/executor/details/{planId}
Response: {
  "currentPlanId": "plan-123",
  "title": "Plan Title",
  "status": "completed",
  "summary": "Execution completed successfully",
  "agentExecutionSequence": [...],
  "userInputWaitState": null
}`}]),E=pe(()=>a.toolInfo.enableInternalToolcall??a.toolInfo.enableHttpService??a.toolInfo.enableMcpService),P=pe(()=>E.value?t("sidebar.updateServiceStatus"):t("sidebar.publishMcpService")),w=pe(()=>a.isExecuting||a.isGenerating?!1:d.value.hasParameters?d.value.parameters.every(z=>{const N=m.value[z];return typeof N=="string"&&N.trim()!==""}):!0),f=(z,N)=>{k.value=z.map(J=>J.originalName),_.value=N,console.log("[ExecutionController] Files uploaded:",z.length,"uploadKey:",N)},$=z=>{k.value=z.map(N=>N.originalName),console.log("[ExecutionController] Files removed, remaining:",z.length)},A=z=>{_.value=z,console.log("[ExecutionController] Upload key changed:",z)},B=()=>{console.log("[ExecutionController] Upload started")},C=()=>{console.log("[ExecutionController] Upload completed")},M=z=>{console.error("[ExecutionController] Upload error:",z)},j=()=>{if(console.log("[ExecutionController] ðŸš€ Execute button clicked"),U.value=!0,console.log("[ExecutionController] ðŸ”’ Set isExecutingPlan to true"),!G()){console.log("[ExecutionController] âŒ Parameter validation failed:",y.value),U.value=!1;return}const z=d.value.hasParameters&&Object.keys(m.value).length>0?m.value:void 0;console.log("[ExecutionController] ðŸ”„ Replacement params:",z);const N={title:"",planData:{title:"",steps:[],directResponse:!1},params:void 0,replacementParams:z,uploadedFiles:k.value,uploadKey:_.value};console.log("[ExecutionController] ðŸ“¤ Emitting executePlan with payload:",JSON.stringify(N,null,2)),l("executePlan",N)},Z=()=>{l("publishMcpService")},Q=()=>{console.log("[ExecutionController] ðŸ§¹ clearExecutionParams called"),c.value="",m.value={},U.value=!1,console.log("[ExecutionController] ðŸ”“ Reset isExecutingPlan to false"),console.log("[ExecutionController] âœ… After clear - parameterValues cleared"),l("clearParams")},W=async()=>{if(console.log("[ExecutionController] ðŸ”„ loadParameterRequirements called for templateId:",a.currentPlanTemplateId),console.log("[ExecutionController] ðŸ“Š Current parameterRequirements before load:",JSON.stringify(d.value,null,2)),!a.currentPlanTemplateId){console.log("[ExecutionController] âŒ No template ID, resetting parameters"),d.value={parameters:[],hasParameters:!1,requirements:""},m.value={};return}d.value={parameters:[],hasParameters:!1,requirements:""},m.value={},console.log("[ExecutionController] ðŸ§¹ Cleared previous data before loading new template"),u.value=!0;try{console.log("[ExecutionController] ðŸŒ Fetching parameter requirements from API...");const z=await Lt.getParameterRequirements(a.currentPlanTemplateId);console.log("[ExecutionController] ðŸ“¥ Received requirements from API:",JSON.stringify(z,null,2)),d.value=z;const N={};z.parameters.forEach(J=>{N[J]=m.value[J]||""}),m.value=N,console.log("[ExecutionController] âœ… Updated parameterRequirements:",JSON.stringify(d.value,null,2)),console.log("[ExecutionController] âœ… Updated parameterValues:",JSON.stringify(m.value,null,2)),te()}catch(z){console.error("[ExecutionController] âŒ Failed to load parameter requirements:",z),z instanceof Error&&!z.message.includes("404")&&console.warn("[ExecutionController] âš ï¸ Parameter requirements not available yet, will retry later"),d.value={parameters:[],hasParameters:!1,requirements:""},m.value={},console.log("[ExecutionController] ðŸ”„ Reset parameterRequirements due to error:",JSON.stringify(d.value,null,2)),console.log("[ExecutionController] ðŸ”„ Cleared parameterValues:",JSON.stringify(m.value,null,2))}finally{u.value=!1,console.log("[ExecutionController] âœ… loadParameterRequirements completed")}},X=(z,N)=>{m.value[z]=N,y.value[z]&&delete y.value[z],te()},G=()=>{if(y.value={},F.value=!1,!d.value.hasParameters)return!0;let z=!1;return d.value.parameters.forEach(N=>{(m.value[N]?m.value[N].trim():"")||(y.value[N]=`${N} is required`,z=!0)}),F.value=z,!z},te=()=>{d.value.hasParameters?c.value=JSON.stringify(m.value,null,2):c.value="",l("updateExecutionParams",c.value)};return me(()=>a.currentPlanTemplateId,(z,N)=>{if(z&&z!==N){if(U.value){console.log("[ExecutionController] â¸ï¸ Skipping parameter reload - plan is executing");return}console.log("[ExecutionController] ðŸ”„ Template ID changed, will reload parameters"),N&&z.startsWith("planTemplate-")?(console.log("[ExecutionController] â° New template detected, retrying with delay..."),setTimeout(()=>{console.log("[ExecutionController] â° Delay timeout, calling loadParameterRequirements"),W()},1e3)):(console.log("[ExecutionController] ðŸš€ Immediate reload of parameters"),W())}}),me(()=>c.value,z=>{l("updateExecutionParams",z)}),xe(()=>{W()}),e({executionParams:c,clearExecutionParams:Q,loadParameterRequirements:W,fileUploadRef:x,uploadedFiles:k,uploadKey:_}),(z,N)=>{var J,K,O,b,q;return p(),g("div",Qc,[o("div",Yc,[T(r(R),{icon:"carbon:play",width:"16"}),o("span",null,i(r(t)("sidebar.executionController")),1)]),o("div",Zc,[o("div",ed,[o("label",null,i(r(t)("sidebar.parameterRequirements")),1),o("div",td,i(r(t)("sidebar.parameterRequirementsHelp")),1),d.value.hasParameters?(p(),g("div",sd,[(p(!0),g(de,null,he(d.value.parameters,Y=>(p(),g("div",{key:Y,class:"parameter-field"},[o("label",od,[le(i(Y)+" ",1),N[0]||(N[0]=o("span",{class:"required"},"*",-1))]),ce(o("input",{"onUpdate:modelValue":ee=>m.value[Y]=ee,class:ae(["parameter-input",{error:y.value[Y]}]),placeholder:r(t)("sidebar.enterValueFor",{param:Y}),onInput:ee=>X(Y,ee.target.value),required:""},null,42,nd),[[fe,m.value[Y]]]),y.value[Y]?(p(),g("div",ad,i(y.value[Y]),1)):L("",!0)]))),128))])):L("",!0),d.value.hasParameters&&!w.value&&!a.isExecuting&&!a.isGenerating?(p(),g("div",ld,[T(r(R),{icon:"carbon:warning",width:"14"}),le(" "+i(r(t)("sidebar.fillAllRequiredParameters")),1)])):L("",!0)]),T(rs,{ref_key:"fileUploadRef",ref:x,disabled:a.isExecuting||a.isGenerating,onFilesUploaded:f,onFilesRemoved:$,onUploadKeyChanged:A,onUploadStarted:B,onUploadCompleted:C,onUploadError:M},null,8,["disabled"]),o("button",{class:"btn btn-primary execute-btn",onClick:j,disabled:!w.value},[T(r(R),{icon:a.isExecuting?"carbon:circle-dash":"carbon:play",width:"16",class:ae({spinning:a.isExecuting})},null,8,["icon","class"]),le(" "+i(a.isExecuting?r(t)("sidebar.executing"):r(t)("sidebar.executePlan")),1)],8,rd),z.showPublishButton?(p(),g("button",{key:0,class:"btn publish-mcp-btn",onClick:Z,disabled:!z.currentPlanTemplateId},[T(r(R),{icon:"carbon:application",width:"16"}),le(" "+i(P.value),1)],8,id)):L("",!0),(J=z.toolInfo)!=null&&J.enableInternalToolcall?(p(),g("div",cd,[o("div",dd,[o("h4",ud,i(r(t)("sidebar.internalCall")),1),o("p",pd,i(r(t)("sidebar.internalCallDescription")),1)]),o("div",hd,[o("div",md,[o("div",fd,i(r(t)("sidebar.internalMethodCall")),1),o("div",gd,i(r(t)("sidebar.toolName"))+": "+i(((K=z.toolInfo)==null?void 0:K.toolName)||z.currentPlanTemplateId),1),(O=z.toolInfo)!=null&&O.serviceGroup?(p(),g("div",vd,i(r(t)("sidebar.serviceGroup"))+": "+i(z.toolInfo.serviceGroup),1)):L("",!0),o("div",bd,i(r(t)("sidebar.internalCallUsage")),1),o("div",yd,[o("strong",null,i(r(t)("sidebar.usage"))+":",1),o("pre",_d,i(r(t)("sidebar.internalCallExample")),1)])])])])):L("",!0),(b=z.toolInfo)!=null&&b.enableHttpService?(p(),g("div",wd,[o("div",Sd,[o("h4",$d,i(r(t)("sidebar.httpCallExample")),1),o("p",Pd,i(r(t)("sidebar.httpCallDescription")),1)]),o("div",kd,[o("div",Ed,[o("div",Cd,[(p(!0),g(de,null,he(v.value,Y=>(p(),g("button",{key:Y.id,class:ae(["tab-button",{active:h.value===Y.id}]),onClick:ee=>h.value=Y.id},i(Y.label),11,Td))),128))]),o("div",Rd,[(p(!0),g(de,null,he(v.value,Y=>ce((p(),g("div",{key:Y.id,class:"tab-panel"},[o("div",Id,[o("div",Ad,i(Y.method),1),o("div",xd,i(Y.endpoint),1),o("div",Md,i(Y.description),1),Y.example?(p(),g("div",Fd,[o("strong",null,i(r(t)("sidebar.example"))+":",1),o("pre",Dd,i(Y.example),1)])):L("",!0)])])),[[Bs,h.value===Y.id]])),128))])])])])):L("",!0),(q=z.toolInfo)!=null&&q.enableMcpService?(p(),g("div",Ud,[o("div",Nd,[o("h4",Ld,i(r(t)("sidebar.mcpCall")),1),o("p",Od,i(r(t)("sidebar.mcpCallDescription")),1)]),o("div",Bd,[o("div",qd,[o("div",jd,i(r(t)("sidebar.mcpServiceCall")),1),o("div",Vd,i(r(t)("sidebar.mcpEndpoint"))+": /mcp/execute",1),o("div",Gd,i(r(t)("sidebar.mcpCallUsage")),1),o("div",Hd,[o("strong",null,i(r(t)("sidebar.usage"))+":",1),o("pre",Jd,i(r(t)("sidebar.mcpCallExample")),1)])])])])):L("",!0)])])}}}),zd=be(Wd,[["__scopeId","data-v-93d601c9"]]);function ds(n,e){const s=D(!1),t=nt({title:"",steps:[],directResponse:!1,planTemplateId:n.currentPlanTemplateId||"",planType:"dynamic_agent"}),a=_=>{console.log("[JsonEditorLogic] parseJsonToVisual called with jsonContent:",_),console.log("[JsonEditorLogic] parseJsonToVisual called with currentPlanTemplateId:",n.currentPlanTemplateId);try{if(!_){console.log("[JsonEditorLogic] No jsonContent, resetting to default"),Object.assign(t,{title:"",steps:[],directResponse:!1,planTemplateId:n.currentPlanTemplateId||"",planType:"dynamic_agent"}),console.log("[JsonEditorLogic] Reset displayData to:",t);return}const v=JSON.parse(_);console.log("[JsonEditorLogic] Parsed JSON:",v),t.title=v.title||"",t.directResponse=!1,t.planTemplateId=v.planTemplateId||n.currentPlanTemplateId||"",t.planType=v.planType||"dynamic_agent",t.steps=(v.steps||[]).map(E=>({stepRequirement:E.stepRequirement||"",agentName:E.agentName||"",modelName:E.modelName||null,selectedToolKeys:E.selectedToolKeys||[],terminateColumns:E.terminateColumns||""})),console.log("[JsonEditorLogic] Updated displayData to:",t)}catch(v){console.warn("Failed to parse JSON content:",v),Object.assign(t,{title:"",steps:[],directResponse:!1,planTemplateId:n.currentPlanTemplateId||"",planType:"dynamic_agent"}),console.log("[JsonEditorLogic] Error occurred, reset displayData to:",t)}},l=()=>{try{const _={title:t.title,steps:t.steps.map(v=>({stepRequirement:v.stepRequirement,agentName:v.agentName,modelName:v.modelName??"",selectedToolKeys:v.selectedToolKeys,terminateColumns:v.terminateColumns})),directResponse:t.directResponse,planTemplateId:t.planTemplateId,planType:t.planType};return JSON.stringify(_,null,2)}catch(_){return console.error("Failed to convert visual data to JSON:",_),"{}"}},c=pe(()=>l());return me(()=>n.jsonContent,(_,v)=>{console.log("[JsonEditorLogic] Watch triggered - jsonContent changed from",v,"to",_),a(_)},{immediate:!0}),me(t,()=>{const _=l();e("update:jsonContent",_)},{deep:!0}),me(()=>n.currentPlanTemplateId,_=>{_&&(t.planTemplateId=_)}),{showJsonPreview:s,displayData:t,formattedJsonOutput:c,addStep:()=>{const _={stepRequirement:"",agentName:"ConfigurableDynaAgent",modelName:null,selectedToolKeys:[],terminateColumns:"",agentType:"",stepContent:""};t.steps.push(_)},removeStep:_=>{_>=0&&_<t.steps.length&&t.steps.splice(_,1)},moveStepUp:_=>{if(_>0){const v=t.steps.splice(_,1)[0];t.steps.splice(_-1,0,v)}},moveStepDown:_=>{if(_<t.steps.length-1){const v=t.steps.splice(_,1)[0];t.steps.splice(_+1,0,v)}},toggleJsonPreview:()=>{s.value=!s.value},closeJsonPreview:()=>{s.value=!1},handleRollback:()=>{e("rollback")},handleRestore:()=>{e("restore")},handleSave:()=>{e("save")}}}const Kd={class:"config-section"},Xd={class:"section-header"},Qd={class:"visual-editor"},Yd={class:"plan-basic-info"},Zd={class:"form-row"},eu={class:"form-label"},tu=["placeholder"],su={class:"steps-section"},ou={class:"steps-header"},nu={class:"form-label"},au={class:"steps-container"},lu={class:"step-header"},ru={class:"step-number"},iu={class:"step-actions"},cu=["onClick","disabled","title"],du=["onClick","disabled","title"],uu=["onClick","title"],pu={class:"step-content"},hu={class:"form-row"},mu={class:"form-label"},fu={class:"agent-selector"},gu=["onUpdate:modelValue"],vu={value:""},bu=["title"],yu={class:"form-row"},_u={class:"form-label"},wu=["onUpdate:modelValue","placeholder"],Su={class:"form-row"},$u={class:"form-label"},Pu=["onUpdate:modelValue","placeholder"],ku={key:0,class:"empty-steps"},Eu={class:"plan-id-section"},Cu={class:"form-row"},Tu={class:"form-label"},Ru={key:0,class:"json-preview"},Iu={class:"preview-header"},Au={class:"form-label"},xu={class:"json-code"},Mu={class:"editor-footer"},Fu={class:"section-actions"},Du=["disabled","title"],Uu=["disabled","title"],Nu=["disabled"],Lu=ve({__name:"JsonEditor",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},hiddenFields:{default:()=>[]},currentPlanTemplateId:{default:""}},emits:["rollback","restore","save","update:jsonContent"],setup(n,{emit:e}){const s=n,t=e,{showJsonPreview:a,displayData:l,formattedJsonOutput:c,addStep:d,removeStep:m,moveStepUp:u,moveStepDown:h,handleRollback:y,handleRestore:F,handleSave:U,toggleJsonPreview:x,closeJsonPreview:k}=ds(s,t),_=v=>{const E=v.target;E.style.height="auto";const P=20,w=Math.ceil(E.scrollHeight/P),f=4,$=12,A=Math.max(f,Math.min($,w)),B=A*P;E.style.height=`${B}px`,E.rows=A,w>$?E.style.overflowY="auto":E.style.overflowY="hidden"};return(v,E)=>(p(),g("div",Kd,[o("div",Xd,[T(r(R),{icon:"carbon:code",width:"16"}),o("span",null,i(v.$t("sidebar.jsonTemplate")),1)]),o("div",Qd,[o("div",Yd,[o("div",Zd,[o("label",eu,i(v.$t("sidebar.title")),1),ce(o("input",{"onUpdate:modelValue":E[0]||(E[0]=P=>r(l).title=P),type:"text",class:"form-input",placeholder:v.$t("sidebar.titlePlaceholder")},null,8,tu),[[fe,r(l).title]])])]),o("div",su,[o("div",ou,[o("label",nu,i(v.$t("sidebar.tasks")),1)]),o("div",au,[(p(!0),g(de,null,he(r(l).steps,(P,w)=>(p(),g("div",{key:w,class:"step-item"},[o("div",lu,[o("span",ru,i(v.$t("sidebar.subtask"))+" "+i(w+1),1),o("div",iu,[o("button",{onClick:f=>r(u)(w),disabled:w===0,class:"btn btn-xs",title:v.$t("sidebar.moveUp")},[T(r(R),{icon:"carbon:chevron-up",width:"12"})],8,cu),o("button",{onClick:f=>r(h)(w),disabled:w===r(l).steps.length-1,class:"btn btn-xs",title:v.$t("sidebar.moveDown")},[T(r(R),{icon:"carbon:chevron-down",width:"12"})],8,du),o("button",{onClick:f=>r(m)(w),class:"btn btn-xs btn-danger",title:v.$t("sidebar.removeStep")},[T(r(R),{icon:"carbon:trash-can",width:"12"})],8,uu)])]),o("div",pu,[o("div",hu,[o("label",mu,i(v.$t("sidebar.agent")),1),o("div",fu,[ce(o("select",{"onUpdate:modelValue":f=>P.agentName=f,class:"form-select agent-select"},[o("option",vu,i(v.$t("sidebar.selectAgent")),1),E[10]||(E[10]=qs('<option value="DEFAULT_AGENT" data-v-91f01967>DEFAULT_AGENT</option><option value="BROWSER_AGENT" data-v-91f01967>BROWSER_AGENT</option><option value="TEXT_FILE_AGENT" data-v-91f01967>TEXT_FILE_AGENT</option><option value="JSX_GENERATOR_AGENT" data-v-91f01967>JSX_GENERATOR_AGENT</option><option value="FILE_MANAGER_AGENT" data-v-91f01967>FILE_MANAGER_AGENT</option>',5))],8,gu),[[Dt,P.agentName]]),o("button",{onClick:E[1]||(E[1]=(...f)=>r(d)&&r(d)(...f)),class:"btn btn-sm btn-add-step",title:v.$t("sidebar.addStep")},[T(r(R),{icon:"carbon:add",width:"14"})],8,bu)])]),o("div",yu,[o("label",_u,i(v.$t("sidebar.stepRequirement")),1),ce(o("textarea",{"onUpdate:modelValue":f=>P.stepContent=f,class:"form-textarea auto-resize",placeholder:v.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:E[2]||(E[2]=f=>_(f))},null,40,wu),[[fe,P.stepContent]])]),o("div",Su,[o("label",$u,i(v.$t("sidebar.terminateColumns")),1),ce(o("input",{"onUpdate:modelValue":f=>P.terminateColumns=f,type:"text",class:"form-input",placeholder:v.$t("sidebar.terminateColumnsPlaceholder")},null,8,Pu),[[fe,P.terminateColumns]])])])]))),128)),r(l).steps.length===0?(p(),g("div",ku,[T(r(R),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),o("p",null,i(v.$t("sidebar.noSteps")),1),o("button",{onClick:E[3]||(E[3]=(...P)=>r(d)&&r(d)(...P)),class:"btn btn-primary"},[T(r(R),{icon:"carbon:add",width:"14"}),le(" "+i(v.$t("sidebar.addFirstStep")),1)])])):L("",!0)])]),o("div",Eu,[o("div",Cu,[o("label",Tu,i(v.$t("sidebar.planId")),1),ce(o("input",{"onUpdate:modelValue":E[4]||(E[4]=P=>r(l).planTemplateId=P),type:"text",class:"form-input",placeholder:"planTemplate-1756109892045"},null,512),[[fe,r(l).planTemplateId]])])]),r(a)?(p(),g("div",Ru,[o("div",Iu,[o("label",Au,i(v.$t("sidebar.jsonPreview")),1),o("button",{onClick:E[5]||(E[5]=(...P)=>r(k)&&r(k)(...P)),class:"btn btn-xs"},[T(r(R),{icon:"carbon:close",width:"12"})])]),o("pre",xu,i(r(c)),1)])):L("",!0),o("div",Mu,[o("button",{onClick:E[6]||(E[6]=(...P)=>r(x)&&r(x)(...P)),class:"btn btn-sm btn-secondary"},[T(r(R),{icon:"carbon:code",width:"14"}),le(" "+i(r(a)?v.$t("sidebar.hideJson"):v.$t("sidebar.showJson")),1)]),o("div",Fu,[o("button",{class:"btn btn-sm",onClick:E[7]||(E[7]=(...P)=>r(y)&&r(y)(...P)),disabled:!(v.canRollback??!1),title:v.$t("sidebar.rollback")},[T(r(R),{icon:"carbon:undo",width:"14"})],8,Du),o("button",{class:"btn btn-sm",onClick:E[8]||(E[8]=(...P)=>r(F)&&r(F)(...P)),disabled:!(v.canRestore??!1),title:v.$t("sidebar.restore")},[T(r(R),{icon:"carbon:redo",width:"14"})],8,Uu),o("button",{class:"btn btn-primary",onClick:E[9]||(E[9]=(...P)=>r(U)&&r(U)(...P)),disabled:v.isGenerating||v.isExecuting},[T(r(R),{icon:"carbon:save",width:"14"}),E[11]||(E[11]=le(" Save "))],8,Nu)])])])]))}}),Ou=be(Lu,[["__scopeId","data-v-91f01967"]]);function us(n,e){return function(){return n.apply(e,arguments)}}const{toString:Bu}=Object.prototype,{getPrototypeOf:Ot}=Object,{iterator:ft,toStringTag:ps}=Symbol,gt=(n=>e=>{const s=Bu.call(e);return n[s]||(n[s]=s.slice(8,-1).toLowerCase())})(Object.create(null)),Me=n=>(n=n.toLowerCase(),e=>gt(e)===n),vt=n=>e=>typeof e===n,{isArray:Xe}=Array,ot=vt("undefined");function qu(n){return n!==null&&!ot(n)&&n.constructor!==null&&!ot(n.constructor)&&Ce(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const hs=Me("ArrayBuffer");function ju(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&hs(n.buffer),e}const Vu=vt("string"),Ce=vt("function"),ms=vt("number"),bt=n=>n!==null&&typeof n=="object",Gu=n=>n===!0||n===!1,it=n=>{if(gt(n)!=="object")return!1;const e=Ot(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(ps in n)&&!(ft in n)},Hu=Me("Date"),Ju=Me("File"),Wu=Me("Blob"),zu=Me("FileList"),Ku=n=>bt(n)&&Ce(n.pipe),Xu=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||Ce(n.append)&&((e=gt(n))==="formdata"||e==="object"&&Ce(n.toString)&&n.toString()==="[object FormData]"))},Qu=Me("URLSearchParams"),[Yu,Zu,ep,tp]=["ReadableStream","Request","Response","Headers"].map(Me),sp=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function at(n,e,{allOwnKeys:s=!1}={}){if(n===null||typeof n>"u")return;let t,a;if(typeof n!="object"&&(n=[n]),Xe(n))for(t=0,a=n.length;t<a;t++)e.call(null,n[t],t,n);else{const l=s?Object.getOwnPropertyNames(n):Object.keys(n),c=l.length;let d;for(t=0;t<c;t++)d=l[t],e.call(null,n[d],d,n)}}function fs(n,e){e=e.toLowerCase();const s=Object.keys(n);let t=s.length,a;for(;t-- >0;)if(a=s[t],e===a.toLowerCase())return a;return null}const He=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,gs=n=>!ot(n)&&n!==He;function Rt(){const{caseless:n}=gs(this)&&this||{},e={},s=(t,a)=>{const l=n&&fs(e,a)||a;it(e[l])&&it(t)?e[l]=Rt(e[l],t):it(t)?e[l]=Rt({},t):Xe(t)?e[l]=t.slice():e[l]=t};for(let t=0,a=arguments.length;t<a;t++)arguments[t]&&at(arguments[t],s);return e}const op=(n,e,s,{allOwnKeys:t}={})=>(at(e,(a,l)=>{s&&Ce(a)?n[l]=us(a,s):n[l]=a},{allOwnKeys:t}),n),np=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),ap=(n,e,s,t)=>{n.prototype=Object.create(e.prototype,t),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),s&&Object.assign(n.prototype,s)},lp=(n,e,s,t)=>{let a,l,c;const d={};if(e=e||{},n==null)return e;do{for(a=Object.getOwnPropertyNames(n),l=a.length;l-- >0;)c=a[l],(!t||t(c,n,e))&&!d[c]&&(e[c]=n[c],d[c]=!0);n=s!==!1&&Ot(n)}while(n&&(!s||s(n,e))&&n!==Object.prototype);return e},rp=(n,e,s)=>{n=String(n),(s===void 0||s>n.length)&&(s=n.length),s-=e.length;const t=n.indexOf(e,s);return t!==-1&&t===s},ip=n=>{if(!n)return null;if(Xe(n))return n;let e=n.length;if(!ms(e))return null;const s=new Array(e);for(;e-- >0;)s[e]=n[e];return s},cp=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&Ot(Uint8Array)),dp=(n,e)=>{const t=(n&&n[ft]).call(n);let a;for(;(a=t.next())&&!a.done;){const l=a.value;e.call(n,l[0],l[1])}},up=(n,e)=>{let s;const t=[];for(;(s=n.exec(e))!==null;)t.push(s);return t},pp=Me("HTMLFormElement"),hp=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(s,t,a){return t.toUpperCase()+a}),Vt=(({hasOwnProperty:n})=>(e,s)=>n.call(e,s))(Object.prototype),mp=Me("RegExp"),vs=(n,e)=>{const s=Object.getOwnPropertyDescriptors(n),t={};at(s,(a,l)=>{let c;(c=e(a,l,n))!==!1&&(t[l]=c||a)}),Object.defineProperties(n,t)},fp=n=>{vs(n,(e,s)=>{if(Ce(n)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const t=n[s];if(Ce(t)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")})}})},gp=(n,e)=>{const s={},t=a=>{a.forEach(l=>{s[l]=!0})};return Xe(n)?t(n):t(String(n).split(e)),s},vp=()=>{},bp=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e;function yp(n){return!!(n&&Ce(n.append)&&n[ps]==="FormData"&&n[ft])}const _p=n=>{const e=new Array(10),s=(t,a)=>{if(bt(t)){if(e.indexOf(t)>=0)return;if(!("toJSON"in t)){e[a]=t;const l=Xe(t)?[]:{};return at(t,(c,d)=>{const m=s(c,a+1);!ot(m)&&(l[d]=m)}),e[a]=void 0,l}}return t};return s(n,0)},wp=Me("AsyncFunction"),Sp=n=>n&&(bt(n)||Ce(n))&&Ce(n.then)&&Ce(n.catch),bs=((n,e)=>n?setImmediate:e?((s,t)=>(He.addEventListener("message",({source:a,data:l})=>{a===He&&l===s&&t.length&&t.shift()()},!1),a=>{t.push(a),He.postMessage(s,"*")}))(`axios@${Math.random()}`,[]):s=>setTimeout(s))(typeof setImmediate=="function",Ce(He.postMessage)),$p=typeof queueMicrotask<"u"?queueMicrotask.bind(He):typeof process<"u"&&process.nextTick||bs,Pp=n=>n!=null&&Ce(n[ft]),I={isArray:Xe,isArrayBuffer:hs,isBuffer:qu,isFormData:Xu,isArrayBufferView:ju,isString:Vu,isNumber:ms,isBoolean:Gu,isObject:bt,isPlainObject:it,isReadableStream:Yu,isRequest:Zu,isResponse:ep,isHeaders:tp,isUndefined:ot,isDate:Hu,isFile:Ju,isBlob:Wu,isRegExp:mp,isFunction:Ce,isStream:Ku,isURLSearchParams:Qu,isTypedArray:cp,isFileList:zu,forEach:at,merge:Rt,extend:op,trim:sp,stripBOM:np,inherits:ap,toFlatObject:lp,kindOf:gt,kindOfTest:Me,endsWith:rp,toArray:ip,forEachEntry:dp,matchAll:up,isHTMLForm:pp,hasOwnProperty:Vt,hasOwnProp:Vt,reduceDescriptors:vs,freezeMethods:fp,toObjectSet:gp,toCamelCase:hp,noop:vp,toFiniteNumber:bp,findKey:fs,global:He,isContextDefined:gs,isSpecCompliantForm:yp,toJSONObject:_p,isAsyncFn:wp,isThenable:Sp,setImmediate:bs,asap:$p,isIterable:Pp};function se(n,e,s,t,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),s&&(this.config=s),t&&(this.request=t),a&&(this.response=a,this.status=a.status?a.status:null)}I.inherits(se,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:I.toJSONObject(this.config),code:this.code,status:this.status}}});const ys=se.prototype,_s={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{_s[n]={value:n}});Object.defineProperties(se,_s);Object.defineProperty(ys,"isAxiosError",{value:!0});se.from=(n,e,s,t,a,l)=>{const c=Object.create(ys);return I.toFlatObject(n,c,function(m){return m!==Error.prototype},d=>d!=="isAxiosError"),se.call(c,n.message,e,s,t,a),c.cause=n,c.name=n.name,l&&Object.assign(c,l),c};const kp=null;function It(n){return I.isPlainObject(n)||I.isArray(n)}function ws(n){return I.endsWith(n,"[]")?n.slice(0,-2):n}function Gt(n,e,s){return n?n.concat(e).map(function(a,l){return a=ws(a),!s&&l?"["+a+"]":a}).join(s?".":""):e}function Ep(n){return I.isArray(n)&&!n.some(It)}const Cp=I.toFlatObject(I,{},null,function(e){return/^is[A-Z]/.test(e)});function yt(n,e,s){if(!I.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,s=I.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(k,_){return!I.isUndefined(_[k])});const t=s.metaTokens,a=s.visitor||h,l=s.dots,c=s.indexes,m=(s.Blob||typeof Blob<"u"&&Blob)&&I.isSpecCompliantForm(e);if(!I.isFunction(a))throw new TypeError("visitor must be a function");function u(x){if(x===null)return"";if(I.isDate(x))return x.toISOString();if(!m&&I.isBlob(x))throw new se("Blob is not supported. Use a Buffer instead.");return I.isArrayBuffer(x)||I.isTypedArray(x)?m&&typeof Blob=="function"?new Blob([x]):Buffer.from(x):x}function h(x,k,_){let v=x;if(x&&!_&&typeof x=="object"){if(I.endsWith(k,"{}"))k=t?k:k.slice(0,-2),x=JSON.stringify(x);else if(I.isArray(x)&&Ep(x)||(I.isFileList(x)||I.endsWith(k,"[]"))&&(v=I.toArray(x)))return k=ws(k),v.forEach(function(P,w){!(I.isUndefined(P)||P===null)&&e.append(c===!0?Gt([k],w,l):c===null?k:k+"[]",u(P))}),!1}return It(x)?!0:(e.append(Gt(_,k,l),u(x)),!1)}const y=[],F=Object.assign(Cp,{defaultVisitor:h,convertValue:u,isVisitable:It});function U(x,k){if(!I.isUndefined(x)){if(y.indexOf(x)!==-1)throw Error("Circular reference detected in "+k.join("."));y.push(x),I.forEach(x,function(v,E){(!(I.isUndefined(v)||v===null)&&a.call(e,v,I.isString(E)?E.trim():E,k,F))===!0&&U(v,k?k.concat(E):[E])}),y.pop()}}if(!I.isObject(n))throw new TypeError("data must be an object");return U(n),e}function Ht(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(t){return e[t]})}function Bt(n,e){this._pairs=[],n&&yt(n,this,e)}const Ss=Bt.prototype;Ss.append=function(e,s){this._pairs.push([e,s])};Ss.toString=function(e){const s=e?function(t){return e.call(this,t,Ht)}:Ht;return this._pairs.map(function(a){return s(a[0])+"="+s(a[1])},"").join("&")};function Tp(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function $s(n,e,s){if(!e)return n;const t=s&&s.encode||Tp;I.isFunction(s)&&(s={serialize:s});const a=s&&s.serialize;let l;if(a?l=a(e,s):l=I.isURLSearchParams(e)?e.toString():new Bt(e,s).toString(t),l){const c=n.indexOf("#");c!==-1&&(n=n.slice(0,c)),n+=(n.indexOf("?")===-1?"?":"&")+l}return n}class Jt{constructor(){this.handlers=[]}use(e,s,t){return this.handlers.push({fulfilled:e,rejected:s,synchronous:t?t.synchronous:!1,runWhen:t?t.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){I.forEach(this.handlers,function(t){t!==null&&e(t)})}}const Ps={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Rp=typeof URLSearchParams<"u"?URLSearchParams:Bt,Ip=typeof FormData<"u"?FormData:null,Ap=typeof Blob<"u"?Blob:null,xp={isBrowser:!0,classes:{URLSearchParams:Rp,FormData:Ip,Blob:Ap},protocols:["http","https","file","blob","url","data"]},qt=typeof window<"u"&&typeof document<"u",At=typeof navigator=="object"&&navigator||void 0,Mp=qt&&(!At||["ReactNative","NativeScript","NS"].indexOf(At.product)<0),Fp=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Dp=qt&&window.location.href||"http://localhost",Up=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:qt,hasStandardBrowserEnv:Mp,hasStandardBrowserWebWorkerEnv:Fp,navigator:At,origin:Dp},Symbol.toStringTag,{value:"Module"})),ke={...Up,...xp};function Np(n,e){return yt(n,new ke.classes.URLSearchParams,Object.assign({visitor:function(s,t,a,l){return ke.isNode&&I.isBuffer(s)?(this.append(t,s.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)}},e))}function Lp(n){return I.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Op(n){const e={},s=Object.keys(n);let t;const a=s.length;let l;for(t=0;t<a;t++)l=s[t],e[l]=n[l];return e}function ks(n){function e(s,t,a,l){let c=s[l++];if(c==="__proto__")return!0;const d=Number.isFinite(+c),m=l>=s.length;return c=!c&&I.isArray(a)?a.length:c,m?(I.hasOwnProp(a,c)?a[c]=[a[c],t]:a[c]=t,!d):((!a[c]||!I.isObject(a[c]))&&(a[c]=[]),e(s,t,a[c],l)&&I.isArray(a[c])&&(a[c]=Op(a[c])),!d)}if(I.isFormData(n)&&I.isFunction(n.entries)){const s={};return I.forEachEntry(n,(t,a)=>{e(Lp(t),a,s,0)}),s}return null}function Bp(n,e,s){if(I.isString(n))try{return(e||JSON.parse)(n),I.trim(n)}catch(t){if(t.name!=="SyntaxError")throw t}return(s||JSON.stringify)(n)}const lt={transitional:Ps,adapter:["xhr","http","fetch"],transformRequest:[function(e,s){const t=s.getContentType()||"",a=t.indexOf("application/json")>-1,l=I.isObject(e);if(l&&I.isHTMLForm(e)&&(e=new FormData(e)),I.isFormData(e))return a?JSON.stringify(ks(e)):e;if(I.isArrayBuffer(e)||I.isBuffer(e)||I.isStream(e)||I.isFile(e)||I.isBlob(e)||I.isReadableStream(e))return e;if(I.isArrayBufferView(e))return e.buffer;if(I.isURLSearchParams(e))return s.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let d;if(l){if(t.indexOf("application/x-www-form-urlencoded")>-1)return Np(e,this.formSerializer).toString();if((d=I.isFileList(e))||t.indexOf("multipart/form-data")>-1){const m=this.env&&this.env.FormData;return yt(d?{"files[]":e}:e,m&&new m,this.formSerializer)}}return l||a?(s.setContentType("application/json",!1),Bp(e)):e}],transformResponse:[function(e){const s=this.transitional||lt.transitional,t=s&&s.forcedJSONParsing,a=this.responseType==="json";if(I.isResponse(e)||I.isReadableStream(e))return e;if(e&&I.isString(e)&&(t&&!this.responseType||a)){const c=!(s&&s.silentJSONParsing)&&a;try{return JSON.parse(e)}catch(d){if(c)throw d.name==="SyntaxError"?se.from(d,se.ERR_BAD_RESPONSE,this,null,this.response):d}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ke.classes.FormData,Blob:ke.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};I.forEach(["delete","get","head","post","put","patch"],n=>{lt.headers[n]={}});const qp=I.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),jp=n=>{const e={};let s,t,a;return n&&n.split(`
`).forEach(function(c){a=c.indexOf(":"),s=c.substring(0,a).trim().toLowerCase(),t=c.substring(a+1).trim(),!(!s||e[s]&&qp[s])&&(s==="set-cookie"?e[s]?e[s].push(t):e[s]=[t]:e[s]=e[s]?e[s]+", "+t:t)}),e},Wt=Symbol("internals");function Ze(n){return n&&String(n).trim().toLowerCase()}function ct(n){return n===!1||n==null?n:I.isArray(n)?n.map(ct):String(n)}function Vp(n){const e=Object.create(null),s=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let t;for(;t=s.exec(n);)e[t[1]]=t[2];return e}const Gp=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function $t(n,e,s,t,a){if(I.isFunction(t))return t.call(this,e,s);if(a&&(e=s),!!I.isString(e)){if(I.isString(t))return e.indexOf(t)!==-1;if(I.isRegExp(t))return t.test(e)}}function Hp(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,s,t)=>s.toUpperCase()+t)}function Jp(n,e){const s=I.toCamelCase(" "+e);["get","set","has"].forEach(t=>{Object.defineProperty(n,t+s,{value:function(a,l,c){return this[t].call(this,e,a,l,c)},configurable:!0})})}let Te=class{constructor(e){e&&this.set(e)}set(e,s,t){const a=this;function l(d,m,u){const h=Ze(m);if(!h)throw new Error("header name must be a non-empty string");const y=I.findKey(a,h);(!y||a[y]===void 0||u===!0||u===void 0&&a[y]!==!1)&&(a[y||m]=ct(d))}const c=(d,m)=>I.forEach(d,(u,h)=>l(u,h,m));if(I.isPlainObject(e)||e instanceof this.constructor)c(e,s);else if(I.isString(e)&&(e=e.trim())&&!Gp(e))c(jp(e),s);else if(I.isObject(e)&&I.isIterable(e)){let d={},m,u;for(const h of e){if(!I.isArray(h))throw TypeError("Object iterator must return a key-value pair");d[u=h[0]]=(m=d[u])?I.isArray(m)?[...m,h[1]]:[m,h[1]]:h[1]}c(d,s)}else e!=null&&l(s,e,t);return this}get(e,s){if(e=Ze(e),e){const t=I.findKey(this,e);if(t){const a=this[t];if(!s)return a;if(s===!0)return Vp(a);if(I.isFunction(s))return s.call(this,a,t);if(I.isRegExp(s))return s.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,s){if(e=Ze(e),e){const t=I.findKey(this,e);return!!(t&&this[t]!==void 0&&(!s||$t(this,this[t],t,s)))}return!1}delete(e,s){const t=this;let a=!1;function l(c){if(c=Ze(c),c){const d=I.findKey(t,c);d&&(!s||$t(t,t[d],d,s))&&(delete t[d],a=!0)}}return I.isArray(e)?e.forEach(l):l(e),a}clear(e){const s=Object.keys(this);let t=s.length,a=!1;for(;t--;){const l=s[t];(!e||$t(this,this[l],l,e,!0))&&(delete this[l],a=!0)}return a}normalize(e){const s=this,t={};return I.forEach(this,(a,l)=>{const c=I.findKey(t,l);if(c){s[c]=ct(a),delete s[l];return}const d=e?Hp(l):String(l).trim();d!==l&&delete s[l],s[d]=ct(a),t[d]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const s=Object.create(null);return I.forEach(this,(t,a)=>{t!=null&&t!==!1&&(s[a]=e&&I.isArray(t)?t.join(", "):t)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,s])=>e+": "+s).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...s){const t=new this(e);return s.forEach(a=>t.set(a)),t}static accessor(e){const t=(this[Wt]=this[Wt]={accessors:{}}).accessors,a=this.prototype;function l(c){const d=Ze(c);t[d]||(Jp(a,c),t[d]=!0)}return I.isArray(e)?e.forEach(l):l(e),this}};Te.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);I.reduceDescriptors(Te.prototype,({value:n},e)=>{let s=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(t){this[s]=t}}});I.freezeMethods(Te);function Pt(n,e){const s=this||lt,t=e||s,a=Te.from(t.headers);let l=t.data;return I.forEach(n,function(d){l=d.call(s,l,a.normalize(),e?e.status:void 0)}),a.normalize(),l}function Es(n){return!!(n&&n.__CANCEL__)}function Qe(n,e,s){se.call(this,n??"canceled",se.ERR_CANCELED,e,s),this.name="CanceledError"}I.inherits(Qe,se,{__CANCEL__:!0});function Cs(n,e,s){const t=s.config.validateStatus;!s.status||!t||t(s.status)?n(s):e(new se("Request failed with status code "+s.status,[se.ERR_BAD_REQUEST,se.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s))}function Wp(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function zp(n,e){n=n||10;const s=new Array(n),t=new Array(n);let a=0,l=0,c;return e=e!==void 0?e:1e3,function(m){const u=Date.now(),h=t[l];c||(c=u),s[a]=m,t[a]=u;let y=l,F=0;for(;y!==a;)F+=s[y++],y=y%n;if(a=(a+1)%n,a===l&&(l=(l+1)%n),u-c<e)return;const U=h&&u-h;return U?Math.round(F*1e3/U):void 0}}function Kp(n,e){let s=0,t=1e3/e,a,l;const c=(u,h=Date.now())=>{s=h,a=null,l&&(clearTimeout(l),l=null),n.apply(null,u)};return[(...u)=>{const h=Date.now(),y=h-s;y>=t?c(u,h):(a=u,l||(l=setTimeout(()=>{l=null,c(a)},t-y)))},()=>a&&c(a)]}const pt=(n,e,s=3)=>{let t=0;const a=zp(50,250);return Kp(l=>{const c=l.loaded,d=l.lengthComputable?l.total:void 0,m=c-t,u=a(m),h=c<=d;t=c;const y={loaded:c,total:d,progress:d?c/d:void 0,bytes:m,rate:u||void 0,estimated:u&&d&&h?(d-c)/u:void 0,event:l,lengthComputable:d!=null,[e?"download":"upload"]:!0};n(y)},s)},zt=(n,e)=>{const s=n!=null;return[t=>e[0]({lengthComputable:s,total:n,loaded:t}),e[1]]},Kt=n=>(...e)=>I.asap(()=>n(...e)),Xp=ke.hasStandardBrowserEnv?((n,e)=>s=>(s=new URL(s,ke.origin),n.protocol===s.protocol&&n.host===s.host&&(e||n.port===s.port)))(new URL(ke.origin),ke.navigator&&/(msie|trident)/i.test(ke.navigator.userAgent)):()=>!0,Qp=ke.hasStandardBrowserEnv?{write(n,e,s,t,a,l){const c=[n+"="+encodeURIComponent(e)];I.isNumber(s)&&c.push("expires="+new Date(s).toGMTString()),I.isString(t)&&c.push("path="+t),I.isString(a)&&c.push("domain="+a),l===!0&&c.push("secure"),document.cookie=c.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Yp(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function Zp(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function Ts(n,e,s){let t=!Yp(e);return n&&(t||s==!1)?Zp(n,e):e}const Xt=n=>n instanceof Te?{...n}:n;function We(n,e){e=e||{};const s={};function t(u,h,y,F){return I.isPlainObject(u)&&I.isPlainObject(h)?I.merge.call({caseless:F},u,h):I.isPlainObject(h)?I.merge({},h):I.isArray(h)?h.slice():h}function a(u,h,y,F){if(I.isUndefined(h)){if(!I.isUndefined(u))return t(void 0,u,y,F)}else return t(u,h,y,F)}function l(u,h){if(!I.isUndefined(h))return t(void 0,h)}function c(u,h){if(I.isUndefined(h)){if(!I.isUndefined(u))return t(void 0,u)}else return t(void 0,h)}function d(u,h,y){if(y in e)return t(u,h);if(y in n)return t(void 0,u)}const m={url:l,method:l,data:l,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:d,headers:(u,h,y)=>a(Xt(u),Xt(h),y,!0)};return I.forEach(Object.keys(Object.assign({},n,e)),function(h){const y=m[h]||a,F=y(n[h],e[h],h);I.isUndefined(F)&&y!==d||(s[h]=F)}),s}const Rs=n=>{const e=We({},n);let{data:s,withXSRFToken:t,xsrfHeaderName:a,xsrfCookieName:l,headers:c,auth:d}=e;e.headers=c=Te.from(c),e.url=$s(Ts(e.baseURL,e.url,e.allowAbsoluteUrls),n.params,n.paramsSerializer),d&&c.set("Authorization","Basic "+btoa((d.username||"")+":"+(d.password?unescape(encodeURIComponent(d.password)):"")));let m;if(I.isFormData(s)){if(ke.hasStandardBrowserEnv||ke.hasStandardBrowserWebWorkerEnv)c.setContentType(void 0);else if((m=c.getContentType())!==!1){const[u,...h]=m?m.split(";").map(y=>y.trim()).filter(Boolean):[];c.setContentType([u||"multipart/form-data",...h].join("; "))}}if(ke.hasStandardBrowserEnv&&(t&&I.isFunction(t)&&(t=t(e)),t||t!==!1&&Xp(e.url))){const u=a&&l&&Qp.read(l);u&&c.set(a,u)}return e},eh=typeof XMLHttpRequest<"u",th=eh&&function(n){return new Promise(function(s,t){const a=Rs(n);let l=a.data;const c=Te.from(a.headers).normalize();let{responseType:d,onUploadProgress:m,onDownloadProgress:u}=a,h,y,F,U,x;function k(){U&&U(),x&&x(),a.cancelToken&&a.cancelToken.unsubscribe(h),a.signal&&a.signal.removeEventListener("abort",h)}let _=new XMLHttpRequest;_.open(a.method.toUpperCase(),a.url,!0),_.timeout=a.timeout;function v(){if(!_)return;const P=Te.from("getAllResponseHeaders"in _&&_.getAllResponseHeaders()),f={data:!d||d==="text"||d==="json"?_.responseText:_.response,status:_.status,statusText:_.statusText,headers:P,config:n,request:_};Cs(function(A){s(A),k()},function(A){t(A),k()},f),_=null}"onloadend"in _?_.onloadend=v:_.onreadystatechange=function(){!_||_.readyState!==4||_.status===0&&!(_.responseURL&&_.responseURL.indexOf("file:")===0)||setTimeout(v)},_.onabort=function(){_&&(t(new se("Request aborted",se.ECONNABORTED,n,_)),_=null)},_.onerror=function(){t(new se("Network Error",se.ERR_NETWORK,n,_)),_=null},_.ontimeout=function(){let w=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const f=a.transitional||Ps;a.timeoutErrorMessage&&(w=a.timeoutErrorMessage),t(new se(w,f.clarifyTimeoutError?se.ETIMEDOUT:se.ECONNABORTED,n,_)),_=null},l===void 0&&c.setContentType(null),"setRequestHeader"in _&&I.forEach(c.toJSON(),function(w,f){_.setRequestHeader(f,w)}),I.isUndefined(a.withCredentials)||(_.withCredentials=!!a.withCredentials),d&&d!=="json"&&(_.responseType=a.responseType),u&&([F,x]=pt(u,!0),_.addEventListener("progress",F)),m&&_.upload&&([y,U]=pt(m),_.upload.addEventListener("progress",y),_.upload.addEventListener("loadend",U)),(a.cancelToken||a.signal)&&(h=P=>{_&&(t(!P||P.type?new Qe(null,n,_):P),_.abort(),_=null)},a.cancelToken&&a.cancelToken.subscribe(h),a.signal&&(a.signal.aborted?h():a.signal.addEventListener("abort",h)));const E=Wp(a.url);if(E&&ke.protocols.indexOf(E)===-1){t(new se("Unsupported protocol "+E+":",se.ERR_BAD_REQUEST,n));return}_.send(l||null)})},sh=(n,e)=>{const{length:s}=n=n?n.filter(Boolean):[];if(e||s){let t=new AbortController,a;const l=function(u){if(!a){a=!0,d();const h=u instanceof Error?u:this.reason;t.abort(h instanceof se?h:new Qe(h instanceof Error?h.message:h))}};let c=e&&setTimeout(()=>{c=null,l(new se(`timeout ${e} of ms exceeded`,se.ETIMEDOUT))},e);const d=()=>{n&&(c&&clearTimeout(c),c=null,n.forEach(u=>{u.unsubscribe?u.unsubscribe(l):u.removeEventListener("abort",l)}),n=null)};n.forEach(u=>u.addEventListener("abort",l));const{signal:m}=t;return m.unsubscribe=()=>I.asap(d),m}},oh=function*(n,e){let s=n.byteLength;if(s<e){yield n;return}let t=0,a;for(;t<s;)a=t+e,yield n.slice(t,a),t=a},nh=async function*(n,e){for await(const s of ah(n))yield*oh(s,e)},ah=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:s,value:t}=await e.read();if(s)break;yield t}}finally{await e.cancel()}},Qt=(n,e,s,t)=>{const a=nh(n,e);let l=0,c,d=m=>{c||(c=!0,t&&t(m))};return new ReadableStream({async pull(m){try{const{done:u,value:h}=await a.next();if(u){d(),m.close();return}let y=h.byteLength;if(s){let F=l+=y;s(F)}m.enqueue(new Uint8Array(h))}catch(u){throw d(u),u}},cancel(m){return d(m),a.return()}},{highWaterMark:2})},_t=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Is=_t&&typeof ReadableStream=="function",lh=_t&&(typeof TextEncoder=="function"?(n=>e=>n.encode(e))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),As=(n,...e)=>{try{return!!n(...e)}catch{return!1}},rh=Is&&As(()=>{let n=!1;const e=new Request(ke.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e}),Yt=64*1024,xt=Is&&As(()=>I.isReadableStream(new Response("").body)),ht={stream:xt&&(n=>n.body)};_t&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!ht[e]&&(ht[e]=I.isFunction(n[e])?s=>s[e]():(s,t)=>{throw new se(`Response type '${e}' is not supported`,se.ERR_NOT_SUPPORT,t)})})})(new Response);const ih=async n=>{if(n==null)return 0;if(I.isBlob(n))return n.size;if(I.isSpecCompliantForm(n))return(await new Request(ke.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(I.isArrayBufferView(n)||I.isArrayBuffer(n))return n.byteLength;if(I.isURLSearchParams(n)&&(n=n+""),I.isString(n))return(await lh(n)).byteLength},ch=async(n,e)=>{const s=I.toFiniteNumber(n.getContentLength());return s??ih(e)},dh=_t&&(async n=>{let{url:e,method:s,data:t,signal:a,cancelToken:l,timeout:c,onDownloadProgress:d,onUploadProgress:m,responseType:u,headers:h,withCredentials:y="same-origin",fetchOptions:F}=Rs(n);u=u?(u+"").toLowerCase():"text";let U=sh([a,l&&l.toAbortSignal()],c),x;const k=U&&U.unsubscribe&&(()=>{U.unsubscribe()});let _;try{if(m&&rh&&s!=="get"&&s!=="head"&&(_=await ch(h,t))!==0){let f=new Request(e,{method:"POST",body:t,duplex:"half"}),$;if(I.isFormData(t)&&($=f.headers.get("content-type"))&&h.setContentType($),f.body){const[A,B]=zt(_,pt(Kt(m)));t=Qt(f.body,Yt,A,B)}}I.isString(y)||(y=y?"include":"omit");const v="credentials"in Request.prototype;x=new Request(e,{...F,signal:U,method:s.toUpperCase(),headers:h.normalize().toJSON(),body:t,duplex:"half",credentials:v?y:void 0});let E=await fetch(x);const P=xt&&(u==="stream"||u==="response");if(xt&&(d||P&&k)){const f={};["status","statusText","headers"].forEach(C=>{f[C]=E[C]});const $=I.toFiniteNumber(E.headers.get("content-length")),[A,B]=d&&zt($,pt(Kt(d),!0))||[];E=new Response(Qt(E.body,Yt,A,()=>{B&&B(),k&&k()}),f)}u=u||"text";let w=await ht[I.findKey(ht,u)||"text"](E,n);return!P&&k&&k(),await new Promise((f,$)=>{Cs(f,$,{data:w,headers:Te.from(E.headers),status:E.status,statusText:E.statusText,config:n,request:x})})}catch(v){throw k&&k(),v&&v.name==="TypeError"&&/Load failed|fetch/i.test(v.message)?Object.assign(new se("Network Error",se.ERR_NETWORK,n,x),{cause:v.cause||v}):se.from(v,v&&v.code,n,x)}}),Mt={http:kp,xhr:th,fetch:dh};I.forEach(Mt,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const Zt=n=>`- ${n}`,uh=n=>I.isFunction(n)||n===null||n===!1,xs={getAdapter:n=>{n=I.isArray(n)?n:[n];const{length:e}=n;let s,t;const a={};for(let l=0;l<e;l++){s=n[l];let c;if(t=s,!uh(s)&&(t=Mt[(c=String(s)).toLowerCase()],t===void 0))throw new se(`Unknown adapter '${c}'`);if(t)break;a[c||"#"+l]=t}if(!t){const l=Object.entries(a).map(([d,m])=>`adapter ${d} `+(m===!1?"is not supported by the environment":"is not available in the build"));let c=e?l.length>1?`since :
`+l.map(Zt).join(`
`):" "+Zt(l[0]):"as no adapter specified";throw new se("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return t},adapters:Mt};function kt(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Qe(null,n)}function es(n){return kt(n),n.headers=Te.from(n.headers),n.data=Pt.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),xs.getAdapter(n.adapter||lt.adapter)(n).then(function(t){return kt(n),t.data=Pt.call(n,n.transformResponse,t),t.headers=Te.from(t.headers),t},function(t){return Es(t)||(kt(n),t&&t.response&&(t.response.data=Pt.call(n,n.transformResponse,t.response),t.response.headers=Te.from(t.response.headers))),Promise.reject(t)})}const Ms="1.9.0",wt={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{wt[n]=function(t){return typeof t===n||"a"+(e<1?"n ":" ")+n}});const ts={};wt.transitional=function(e,s,t){function a(l,c){return"[Axios v"+Ms+"] Transitional option '"+l+"'"+c+(t?". "+t:"")}return(l,c,d)=>{if(e===!1)throw new se(a(c," has been removed"+(s?" in "+s:"")),se.ERR_DEPRECATED);return s&&!ts[c]&&(ts[c]=!0,console.warn(a(c," has been deprecated since v"+s+" and will be removed in the near future"))),e?e(l,c,d):!0}};wt.spelling=function(e){return(s,t)=>(console.warn(`${t} is likely a misspelling of ${e}`),!0)};function ph(n,e,s){if(typeof n!="object")throw new se("options must be an object",se.ERR_BAD_OPTION_VALUE);const t=Object.keys(n);let a=t.length;for(;a-- >0;){const l=t[a],c=e[l];if(c){const d=n[l],m=d===void 0||c(d,l,n);if(m!==!0)throw new se("option "+l+" must be "+m,se.ERR_BAD_OPTION_VALUE);continue}if(s!==!0)throw new se("Unknown option "+l,se.ERR_BAD_OPTION)}}const dt={assertOptions:ph,validators:wt},Fe=dt.validators;let Je=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Jt,response:new Jt}}async request(e,s){try{return await this._request(e,s)}catch(t){if(t instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const l=a.stack?a.stack.replace(/^.+\n/,""):"";try{t.stack?l&&!String(t.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(t.stack+=`
`+l):t.stack=l}catch{}}throw t}}_request(e,s){typeof e=="string"?(s=s||{},s.url=e):s=e||{},s=We(this.defaults,s);const{transitional:t,paramsSerializer:a,headers:l}=s;t!==void 0&&dt.assertOptions(t,{silentJSONParsing:Fe.transitional(Fe.boolean),forcedJSONParsing:Fe.transitional(Fe.boolean),clarifyTimeoutError:Fe.transitional(Fe.boolean)},!1),a!=null&&(I.isFunction(a)?s.paramsSerializer={serialize:a}:dt.assertOptions(a,{encode:Fe.function,serialize:Fe.function},!0)),s.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?s.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:s.allowAbsoluteUrls=!0),dt.assertOptions(s,{baseUrl:Fe.spelling("baseURL"),withXsrfToken:Fe.spelling("withXSRFToken")},!0),s.method=(s.method||this.defaults.method||"get").toLowerCase();let c=l&&I.merge(l.common,l[s.method]);l&&I.forEach(["delete","get","head","post","put","patch","common"],x=>{delete l[x]}),s.headers=Te.concat(c,l);const d=[];let m=!0;this.interceptors.request.forEach(function(k){typeof k.runWhen=="function"&&k.runWhen(s)===!1||(m=m&&k.synchronous,d.unshift(k.fulfilled,k.rejected))});const u=[];this.interceptors.response.forEach(function(k){u.push(k.fulfilled,k.rejected)});let h,y=0,F;if(!m){const x=[es.bind(this),void 0];for(x.unshift.apply(x,d),x.push.apply(x,u),F=x.length,h=Promise.resolve(s);y<F;)h=h.then(x[y++],x[y++]);return h}F=d.length;let U=s;for(y=0;y<F;){const x=d[y++],k=d[y++];try{U=x(U)}catch(_){k.call(this,_);break}}try{h=es.call(this,U)}catch(x){return Promise.reject(x)}for(y=0,F=u.length;y<F;)h=h.then(u[y++],u[y++]);return h}getUri(e){e=We(this.defaults,e);const s=Ts(e.baseURL,e.url,e.allowAbsoluteUrls);return $s(s,e.params,e.paramsSerializer)}};I.forEach(["delete","get","head","options"],function(e){Je.prototype[e]=function(s,t){return this.request(We(t||{},{method:e,url:s,data:(t||{}).data}))}});I.forEach(["post","put","patch"],function(e){function s(t){return function(l,c,d){return this.request(We(d||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:l,data:c}))}}Je.prototype[e]=s(),Je.prototype[e+"Form"]=s(!0)});let hh=class Fs{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let s;this.promise=new Promise(function(l){s=l});const t=this;this.promise.then(a=>{if(!t._listeners)return;let l=t._listeners.length;for(;l-- >0;)t._listeners[l](a);t._listeners=null}),this.promise.then=a=>{let l;const c=new Promise(d=>{t.subscribe(d),l=d}).then(a);return c.cancel=function(){t.unsubscribe(l)},c},e(function(l,c,d){t.reason||(t.reason=new Qe(l,c,d),s(t.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const s=this._listeners.indexOf(e);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const e=new AbortController,s=t=>{e.abort(t)};return this.subscribe(s),e.signal.unsubscribe=()=>this.unsubscribe(s),e.signal}static source(){let e;return{token:new Fs(function(a){e=a}),cancel:e}}};function mh(n){return function(s){return n.apply(null,s)}}function fh(n){return I.isObject(n)&&n.isAxiosError===!0}const Ft={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ft).forEach(([n,e])=>{Ft[e]=n});function Ds(n){const e=new Je(n),s=us(Je.prototype.request,e);return I.extend(s,Je.prototype,e,{allOwnKeys:!0}),I.extend(s,e,null,{allOwnKeys:!0}),s.create=function(a){return Ds(We(n,a))},s}const _e=Ds(lt);_e.Axios=Je;_e.CanceledError=Qe;_e.CancelToken=hh;_e.isCancel=Es;_e.VERSION=Ms;_e.toFormData=yt;_e.AxiosError=se;_e.Cancel=_e.CanceledError;_e.all=function(e){return Promise.all(e)};_e.spread=mh;_e.isAxiosError=fh;_e.mergeConfig=We;_e.AxiosHeaders=Te;_e.formToJSON=n=>ks(I.isHTMLForm(n)?new FormData(n):n);_e.getAdapter=xs.getAdapter;_e.HttpStatusCode=Ft;_e.default=_e;const{Axios:dg,AxiosError:ug,CanceledError:pg,isCancel:hg,CancelToken:mg,VERSION:fg,all:gg,Cancel:vg,isAxiosError:bg,spread:yg,toFormData:_g,AxiosHeaders:wg,HttpStatusCode:Sg,formToJSON:$g,getAdapter:Pg,mergeConfig:kg}=_e;class gh{static async getAvailableModels(){try{return(await _e({url:"/api/models/available-models",method:"GET",baseURL:""})).data}catch(e){return console.error("Failed to fetch available models:",e),{options:[],total:0}}}}const vh={class:"assigned-tools"},bh={class:"section-header"},yh={class:"tool-info"},_h={class:"tool-name"},wh={class:"tool-desc"},Sh={key:0,class:"no-tools"},$h=ve({__name:"AssignedTools",props:{title:{},selectedToolIds:{},availableTools:{},addButtonText:{default:"Add/Remove Tools"},emptyText:{default:"No tools assigned"},showAddButton:{type:Boolean,default:!0},useGridLayout:{type:Boolean,default:!1}},emits:["add-tools","tools-filtered"],setup(n,{emit:e}){const s=n,t=e,a=pe(()=>s.selectedToolIds.filter(d=>s.availableTools.some(m=>m.key===d)));me(a,d=>{d.length!==s.selectedToolIds.length&&t("tools-filtered",d)},{immediate:!0});const l=d=>{const m=s.availableTools.find(h=>h.key===d);return m?`${m.serviceGroup||"Ungrouped"}.${m.name}`:d},c=d=>{const m=s.availableTools.find(u=>u.key===d);return m?m.description:""};return(d,m)=>(p(),g("div",vh,[o("div",bh,[o("span",null,i(d.title)+" ("+i(a.value.length)+")",1),d.showAddButton?(p(),g("button",{key:0,class:"action-btn small",onClick:m[0]||(m[0]=u=>d.$emit("add-tools"))},[T(r(R),{icon:"carbon:add"}),le(" "+i(d.addButtonText),1)])):L("",!0)]),o("div",{class:ae(["tools-grid",{"grid-layout":d.useGridLayout}])},[(p(!0),g(de,null,he(a.value,u=>(p(),g("div",{key:u,class:"tool-item assigned"},[o("div",yh,[o("span",_h,i(l(u)),1),o("span",wh,i(c(u)),1)])]))),128)),a.value.length===0?(p(),g("div",Sh,[T(r(R),{icon:"carbon:tool-box"}),o("span",null,i(d.emptyText),1)])):L("",!0)],2)]))}}),Ph=be($h,[["__scopeId","data-v-0033a342"]]),kh={class:"tool-selection-content"},Eh={class:"tool-controls"},Ch={class:"search-container"},Th=["placeholder"],Rh={class:"sort-container"},Ih={value:"group"},Ah={value:"name"},xh={value:"enabled"},Mh={class:"tool-summary"},Fh={class:"summary-text"},Dh={key:0,class:"tool-groups"},Uh=["onClick"],Nh={class:"group-title-area"},Lh={class:"group-name"},Oh={class:"group-count"},Bh={class:"group-enable-all"},qh=["checked","onChange","data-group"],jh={class:"enable-label"},Vh={class:"tool-info"},Gh={class:"tool-selection-name"},Hh={key:0,class:"tool-selection-desc"},Jh={class:"tool-actions"},Wh=["checked","onChange"],zh={key:1,class:"empty-state"},Kh=ve({__name:"ToolSelectionModal",props:{modelValue:{type:Boolean},tools:{},selectedToolIds:{}},emits:["update:modelValue","confirm"],setup(n,{emit:e}){const s=n,t=e,a=pe({get:()=>s.modelValue,set:$=>t("update:modelValue",$)}),l=D(""),c=D("group"),d=D(new Set),m=D([]),u=($,A)=>{const B=document.querySelector(`input[data-group="${$}"]`);B&&(B.indeterminate=v(A))};me(()=>s.selectedToolIds,$=>{m.value=[...$]},{immediate:!0});const h=pe(()=>{let $=s.tools.filter(A=>A.key);if($=$.filter(A=>A.selectable===!0),l.value){const A=l.value.toLowerCase();$=$.filter(B=>B.name.toLowerCase().includes(A)||B.description.toLowerCase().includes(A)||B.serviceGroup.toLowerCase().includes(A))}switch(c.value){case"name":$=[...$].sort((A,B)=>A.name.localeCompare(B.name));break;case"enabled":$=[...$].sort((A,B)=>{const C=m.value.includes(A.key),M=m.value.includes(B.key);return C&&!M?-1:!C&&M?1:A.name.localeCompare(B.name)});break;case"group":default:$=[...$].sort((A,B)=>{const C=A.serviceGroup||"Ungrouped",M=B.serviceGroup||"Ungrouped";return C!==M?C.localeCompare(M):A.name.localeCompare(B.name)});break}return $}),y=pe(()=>{const $=new Map;return h.value.forEach(A=>{const B=A.serviceGroup||"Ungrouped";$.has(B)||$.set(B,[]),$.get(B).push(A)}),new Map([...$.entries()].sort())}),F=pe(()=>h.value.length);me([m,y],()=>{Ee(()=>{for(const[$,A]of y.value)u($,A)})},{flush:"post",deep:!1});const U=$=>m.value.includes($),x=($,A)=>{A.stopPropagation();const C=A.target.checked;if(!$){console.error("toolKey is undefined, cannot proceed");return}C?m.value.includes($)||(m.value=[...m.value,$]):m.value=m.value.filter(M=>M!==$)},k=$=>$.filter(A=>m.value.includes(A.key)),_=$=>$.length>0&&$.every(A=>m.value.includes(A.key)),v=$=>{const A=k($).length;return A>0&&A<$.length},E=($,A)=>{A.stopPropagation();const C=A.target.checked,M=$.map(j=>j.key);if(C){const j=[...m.value];M.forEach(Z=>{j.includes(Z)||j.push(Z)}),m.value=j}else m.value=m.value.filter(j=>!M.includes(j))},P=$=>{d.value.has($)?d.value.delete($):d.value.add($)},w=()=>{t("confirm",[...m.value]),t("update:modelValue",!1)},f=()=>{m.value=[...s.selectedToolIds],t("update:modelValue",!1)};return me(a,$=>{if($){d.value.clear();const A=Array.from(y.value.keys());A.length>1&&A.slice(1).forEach(B=>{d.value.add(B)})}}),($,A)=>(p(),ue(as,{modelValue:a.value,"onUpdate:modelValue":[A[4]||(A[4]=B=>a.value=B),f],title:$.$t("toolSelection.title"),onConfirm:w},{default:Ke(()=>[o("div",kh,[o("div",Eh,[o("div",Ch,[ce(o("input",{"onUpdate:modelValue":A[0]||(A[0]=B=>l.value=B),type:"text",class:"search-input",placeholder:$.$t("toolSelection.searchPlaceholder")},null,8,Th),[[fe,l.value]])]),o("div",Rh,[ce(o("select",{"onUpdate:modelValue":A[1]||(A[1]=B=>c.value=B),class:"sort-select"},[o("option",Ih,i($.$t("toolSelection.sortByGroup")),1),o("option",Ah,i($.$t("toolSelection.sortByName")),1),o("option",xh,i($.$t("toolSelection.sortByStatus")),1)],512),[[Dt,c.value]])])]),o("div",Mh,[o("span",Fh,i($.$t("toolSelection.summary",{groups:y.value.size,tools:F.value,selected:m.value.length})),1)]),y.value.size>0?(p(),g("div",Dh,[(p(!0),g(de,null,he(y.value,([B,C])=>(p(),g("div",{key:B,class:"tool-group"},[o("div",{class:ae(["tool-group-header",{collapsed:d.value.has(B)}]),onClick:M=>P(B)},[o("div",Nh,[T(r(R),{icon:d.value.has(B)?"carbon:chevron-right":"carbon:chevron-down",class:"collapse-icon"},null,8,["icon"]),T(r(R),{icon:"carbon:folder",class:"group-icon"}),o("span",Lh,i(B),1),o("span",Oh," ("+i(k(C).length)+"/"+i(C.length)+") ",1)]),o("div",{class:"group-actions",onClick:A[2]||(A[2]=ye(()=>{},["stop"]))},[o("label",Bh,[o("input",{type:"checkbox",class:"group-enable-checkbox",checked:_(C),onChange:M=>E(C,M),"data-group":B},null,40,qh),o("span",jh,i($.$t("toolSelection.enableAll")),1)])])],10,Uh),o("div",{class:ae(["tool-group-content",{collapsed:d.value.has(B)}])},[(p(!0),g(de,null,he(C,M=>(p(),g("div",{key:M.key,class:"tool-selection-item"},[o("div",Vh,[o("div",Gh,i(M.name),1),M.description?(p(),g("div",Hh,i(M.description),1)):L("",!0)]),o("div",Jh,[o("label",{class:"tool-enable-switch",onClick:A[3]||(A[3]=ye(()=>{},["stop"]))},[o("input",{type:"checkbox",class:"tool-enable-checkbox",checked:U(M.key),onChange:j=>x(M.key,j)},null,40,Wh),A[5]||(A[5]=o("span",{class:"tool-enable-slider"},null,-1))])])]))),128))],2)]))),128))])):(p(),g("div",zh,[T(r(R),{icon:"carbon:tools",class:"empty-icon"}),o("p",null,i($.$t("toolSelection.noToolsFound")),1)]))])]),_:1},8,["modelValue","title"]))}}),Xh=be(Kh,[["__scopeId","data-v-3f78a288"]]),Qh={class:"config-section"},Yh={class:"section-header"},Zh={key:0,class:"error-section"},em={class:"error-message"},tm={class:"error-content"},sm={class:"error-title"},om={class:"error-description"},nm={key:1,class:"visual-editor"},am={class:"plan-basic-info"},lm={class:"form-row"},rm={class:"form-label"},im=["placeholder"],cm={key:0,class:"field-error-message"},dm={class:"form-row"},um={class:"form-label"},pm=["value","placeholder"],hm={class:"steps-section"},mm={class:"steps-header"},fm={class:"form-label"},gm={class:"steps-actions"},vm=["title"],bm={class:"steps-container"},ym={class:"step-header"},_m={class:"step-number"},wm={class:"step-actions"},Sm=["onClick","disabled","title"],$m=["onClick","disabled","title"],Pm=["onClick","title"],km={class:"step-content"},Em={class:"form-row"},Cm={class:"form-label"},Tm=["onUpdate:modelValue","placeholder"],Rm={class:"form-row"},Im={class:"form-label"},Am=["onUpdate:modelValue","placeholder"],xm={key:0,class:"preview-section"},Mm={class:"preview-label"},Fm={class:"preview-content"},Dm={class:"preview-text"},Um={class:"preview-table-header"},Nm={class:"form-row"},Lm={class:"form-label"},Om={class:"model-selector-wrapper"},Bm={class:"model-input-wrapper"},qm=["value","placeholder","disabled","onClick","onFocus","onInput","onKeydown"],jm={key:0,class:"dropdown-item disabled"},Vm={key:1,class:"dropdown-item disabled error"},Gm={key:2,class:"dropdown-item disabled"},Hm=["onClick","onMouseenter"],Jm=["onClick","onMouseenter"],Wm=["title"],zm={key:0,class:"error-message"},Km={class:"form-row"},Xm={key:0,class:"empty-steps"},Qm={key:0,class:"json-preview"},Ym={class:"preview-header"},Zm={class:"form-label"},ef={class:"json-code"},tf={class:"editor-footer"},sf={class:"section-actions"},of=["disabled","title"],nf=["disabled","title"],af=["disabled","title"],lf=["disabled"],rf=ve({__name:"JsonEditorV2",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},currentPlanTemplateId:{default:""}},emits:["rollback","restore","save","copy-plan","update:jsonContent"],setup(n,{emit:e}){const{t:s}=Ie(),t=n,a=e,l={...t,hiddenFields:[]},{showJsonPreview:c,displayData:d,formattedJsonOutput:m,addStep:u,removeStep:h,moveStepUp:y,moveStepDown:F,handleRollback:U,handleRestore:x,handleSave:k,toggleJsonPreview:_,closeJsonPreview:v}=ds(l,a),E=D(null),P=D(""),w=D([]),f=D(!1),$=D(""),A=D(new Map),B=D(new Set),C=D(new Map),M=S=>A.value.get(S)??"",j=(S,H)=>{A.value.set(S,H)},Z=S=>{const H=M(S);if(!H.trim())return w.value;const ne=H.toLowerCase().trim();return w.value.filter(oe=>oe.value.toLowerCase().includes(ne)||oe.label.toLowerCase().includes(ne))},Q=S=>{const H=d.steps[S],ne=M(S);return B.value.has(S)&&ne!==""?ne:H.modelName??""},W=S=>f.value||$.value||d.steps[S].modelName?"":s("sidebar.modelNameDescription")||"",X=S=>B.value.has(S),G=S=>{f.value||B.value.add(S)},te=S=>{B.value.delete(S),C.value.set(S,-1);const H=d.steps[S];j(S,H.modelName??"")},z=S=>{X(S)?te(S):G(S)},N=(S,H)=>{const ne=d.steps[H];ne.modelName=S,j(H,S),te(H)},J=(S,H)=>{const ne=S.target;j(H,ne.value),G(H)},K=S=>C.value.get(S)??-1,O=(S,H)=>{C.value.set(S,H)},b=S=>{const H=K(S),ne=Z(S);H>=0&&H<ne.length?N(ne[H].value,S):H===-1?N("",S):ne.length>0?N(ne[0].value,S):d.steps[S].modelName||N("",S)},q=S=>{if(!X(S)){G(S),O(S,0);return}const ne=Z(S).length+1,oe=K(S),re=Math.min(oe+1,ne-1);O(S,re)},Y=S=>{if(!X(S)){G(S);const oe=Z(S);O(S,oe.length);return}const H=K(S),ne=Math.max(H-1,-1);O(S,ne)},ee=S=>{S.target.closest(".model-selector")||B.value.clear()};me(()=>d.steps,S=>{S.forEach((H,ne)=>{A.value.has(ne)||j(ne,H.modelName??"")})},{deep:!0,immediate:!0});const ge=D(!1),Se=D(-1),Ue=async()=>{if(!f.value){f.value=!0,$.value="";try{const S=await gh.getAvailableModels();w.value=S.options}catch(S){console.error("Failed to load models:",S),$.value=S instanceof Error?S.message:"Failed to load models",w.value=[]}finally{f.value=!1}}},Oe=S=>{Se.value=S,ge.value=!0,console.log("[JsonEditorV2] Available tools from store:",V.availableTools)},Be=S=>{Se.value>=0&&Se.value<d.steps.length&&(d.steps[Se.value].selectedToolKeys=[...S]),ge.value=!1,Se.value=-1},qe=(S,H)=>{S>=0&&S<d.steps.length&&(d.steps[S].selectedToolKeys=[...H])},Ae=()=>{a("copy-plan")},$e=()=>{try{E.value=null,d.title||(d.title=""),d.directResponse=!1}catch(S){const H=`Failed to initialize JsonEditorV2: ${S instanceof Error?S.message:"Unknown error"}`;E.value=H,console.error(H,S)}};me(()=>d,S=>{try{S.title.trim()?P.value="":P.value="Title is required field",E.value=null}catch(H){E.value=`Invalid data structure: ${H instanceof Error?H.message:"Unknown error"}`,P.value=""}},{immediate:!0,deep:!0}),me(()=>t.jsonContent,(S,H)=>{if(console.log("[JsonEditorV2] Props watch triggered - jsonContent changed from",H,"to",S),S&&S!==H){console.log("[JsonEditorV2] Force parsing new jsonContent:",S);try{const ne=JSON.parse(S);console.log("[JsonEditorV2] Parsed new jsonContent:",ne),Object.assign(d,{title:ne.title||"",steps:ne.steps||[],directResponse:!1,planTemplateId:ne.planTemplateId||t.currentPlanTemplateId||"",planType:ne.planType||"dynamic_agent"}),console.log("[JsonEditorV2] Updated displayData with new content:",d)}catch(ne){console.warn("[JsonEditorV2] Failed to parse new jsonContent:",ne)}}},{immediate:!0}),xe(()=>{if(console.log("[JsonEditorV2] Component mounted with jsonContent:",t.jsonContent),console.log("[JsonEditorV2] Component mounted with currentPlanTemplateId:",t.currentPlanTemplateId),console.log("[JsonEditorV2] Component mounted with displayData:",d),t.jsonContent){console.log("[JsonEditorV2] Force parsing jsonContent on mount:",t.jsonContent);try{const S=JSON.parse(t.jsonContent);console.log("[JsonEditorV2] Parsed jsonContent on mount:",S),Object.assign(d,{title:S.title||"",steps:S.steps||[],directResponse:!1,planTemplateId:S.planTemplateId||t.currentPlanTemplateId||"",planType:S.planType||"dynamic_agent"}),console.log("[JsonEditorV2] Updated displayData on mount:",d)}catch(S){console.warn("[JsonEditorV2] Failed to parse jsonContent on mount:",S)}}$e(),Ue(),document.addEventListener("click",ee)}),Re(()=>{document.removeEventListener("click",ee)});const we=S=>{const H=S.target;H.style.height="auto";const ne=20,oe=Math.ceil(H.scrollHeight/ne),re=4,ie=12,Ye=Math.max(re,Math.min(ie,oe)),St=Ye*ne;H.style.height=`${St}px`,H.rows=Ye,oe>ie?H.style.overflowY="auto":H.style.overflowY="hidden"},je=S=>{if(!S.trim())return"";const H=S.split(",").map(ne=>ne.trim()).filter(ne=>ne.length>0);return H.length===0?"":`|${H.join("|")}|`};return(S,H)=>{var ne;return p(),g("div",Qh,[o("div",Yh,[T(r(R),{icon:"carbon:code",width:"16"}),o("span",null,i(S.$t("sidebar.dynamicAgentPlan")),1)]),E.value?(p(),g("div",Zh,[o("div",em,[T(r(R),{icon:"carbon:warning",width:"16"}),o("div",tm,[o("div",sm,i(S.$t("sidebar.planTypeError")),1),o("div",om,i(E.value),1)])])])):(p(),g("div",nm,[o("div",am,[o("div",lm,[o("label",rm,i(S.$t("sidebar.title")),1),ce(o("input",{"onUpdate:modelValue":H[0]||(H[0]=oe=>r(d).title=oe),type:"text",class:ae(["form-input",{error:P.value}]),placeholder:S.$t("sidebar.titlePlaceholder")},null,10,im),[[fe,r(d).title]]),P.value?(p(),g("div",cm,[T(r(R),{icon:"carbon:warning",width:"12"}),le(" "+i(P.value),1)])):L("",!0)]),o("div",dm,[o("label",um,i(S.$t("sidebar.planTemplateId")),1),o("input",{value:S.currentPlanTemplateId,type:"text",class:"form-input readonly-input",readonly:"",placeholder:S.$t("sidebar.planTemplateIdPlaceholder")},null,8,pm)])]),o("div",hm,[o("div",mm,[o("label",fm,i(S.$t("sidebar.tasks")),1),o("div",gm,[o("button",{onClick:H[1]||(H[1]=(...oe)=>r(u)&&r(u)(...oe)),class:"btn btn-xs",title:S.$t("sidebar.addStep")},[T(r(R),{icon:"carbon:add",width:"12"})],8,vm)])]),o("div",bm,[(p(!0),g(de,null,he(r(d).steps,(oe,re)=>(p(),g("div",{key:re,class:"step-item"},[o("div",ym,[o("span",_m,i(S.$t("sidebar.subtask"))+" "+i(re+1),1),o("div",wm,[o("button",{onClick:ie=>r(y)(re),disabled:re===0,class:"btn btn-xs",title:S.$t("sidebar.moveUp")},[T(r(R),{icon:"carbon:chevron-up",width:"12"})],8,Sm),o("button",{onClick:ie=>r(F)(re),disabled:re===r(d).steps.length-1,class:"btn btn-xs",title:S.$t("sidebar.moveDown")},[T(r(R),{icon:"carbon:chevron-down",width:"12"})],8,$m),o("button",{onClick:ie=>r(h)(re),class:"btn btn-xs btn-danger",title:S.$t("sidebar.removeStep")},[T(r(R),{icon:"carbon:trash-can",width:"12"})],8,Pm)])]),o("div",km,[o("div",Em,[o("label",Cm,i(S.$t("sidebar.stepRequirement")),1),ce(o("textarea",{"onUpdate:modelValue":ie=>oe.stepRequirement=ie,class:"form-textarea auto-resize",placeholder:S.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:H[2]||(H[2]=ie=>we(ie))},null,40,Tm),[[fe,oe.stepRequirement]])]),o("div",Rm,[o("label",Im,i(S.$t("sidebar.terminateColumns")),1),ce(o("textarea",{"onUpdate:modelValue":ie=>oe.terminateColumns=ie,class:"form-textarea auto-resize",placeholder:S.$t("sidebar.terminateColumnsPlaceholder"),rows:"4",onInput:H[3]||(H[3]=ie=>we(ie))},null,40,Am),[[fe,oe.terminateColumns]]),oe.terminateColumns&&oe.terminateColumns.trim()?(p(),g("div",xm,[o("div",Mm,i(S.$t("sidebar.preview"))+":",1),o("div",Fm,[o("div",Dm,[le(i(S.$t("sidebar.systemWillReturnListWithTableHeaderFormat"))+": ",1),o("span",Um,i(je(oe.terminateColumns)),1)])])])):L("",!0)]),o("div",Nm,[o("label",Lm,i(S.$t("sidebar.modelName")),1),o("div",Om,[o("div",{class:ae(["model-selector",{"is-open":X(re),"is-disabled":f.value}])},[o("div",Bm,[o("input",{value:Q(re),type:"text",class:"form-input model-search-input",placeholder:W(re),disabled:f.value,onClick:ye(ie=>G(re),["stop"]),onFocus:ie=>G(re),onInput:ie=>J(ie,re),onKeydown:[et(ie=>te(re),["escape"]),et(ye(ie=>b(re),["prevent"]),["enter"]),et(ye(ie=>q(re),["prevent"]),["down"]),et(ye(ie=>Y(re),["prevent"]),["up"])]},null,40,qm),T(r(R),{icon:"carbon:chevron-down",width:"14",class:ae(["dropdown-arrow",{"is-open":X(re)}]),onClick:ye(ie=>z(re),["stop"])},null,8,["class","onClick"])]),X(re)?(p(),g("div",{key:0,class:"model-dropdown",onClick:H[4]||(H[4]=ye(()=>{},["stop"]))},[f.value?(p(),g("div",jm,i(S.$t("sidebar.loading")),1)):$.value?(p(),g("div",Vm,i(S.$t("sidebar.modelLoadError")),1)):Z(re).length===0?(p(),g("div",Gm,i(S.$t("sidebar.noModelsFound")),1)):L("",!0),(p(!0),g(de,null,he(Z(re),(ie,Ye)=>(p(),g("div",{key:ie.value,class:ae(["dropdown-item",{"is-selected":oe.modelName===ie.value,"is-highlighted":K(re)===Ye}]),onClick:St=>N(ie.value,re),onMouseenter:St=>O(re,Ye)},[le(i(ie.value)+" ",1),oe.modelName===ie.value?(p(),ue(r(R),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"})):L("",!0)],42,Hm))),128)),o("div",{class:ae(["dropdown-item",{"is-selected":!oe.modelName,"is-highlighted":K(re)===-1}]),onClick:ie=>N("",re),onMouseenter:ie=>O(re,-1)},[le(i(S.$t("sidebar.noModelSelected"))+" ",1),oe.modelName?L("",!0):(p(),ue(r(R),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"}))],42,Jm)])):L("",!0)],2),$.value?(p(),g("button",{key:0,onClick:Ue,class:"btn btn-sm btn-danger",title:S.$t("sidebar.retryLoadModels")},[T(r(R),{icon:"carbon:warning",width:"14"}),le(" "+i(S.$t("sidebar.retry")),1)],8,Wm)):L("",!0)]),$.value?(p(),g("div",zm,[T(r(R),{icon:"carbon:warning",width:"12"}),le(" "+i($.value),1)])):L("",!0)]),o("div",Km,[T(Ph,{title:S.$t("sidebar.selectedTools"),"selected-tool-ids":oe.selectedToolKeys,"available-tools":r(V).availableTools,"add-button-text":S.$t("sidebar.addRemoveTools"),"empty-text":S.$t("sidebar.noTools"),"use-grid-layout":!0,onAddTools:ie=>Oe(re),onToolsFiltered:ie=>qe(re,ie)},null,8,["title","selected-tool-ids","available-tools","add-button-text","empty-text","onAddTools","onToolsFiltered"])])])]))),128)),r(d).steps.length===0?(p(),g("div",Xm,[T(r(R),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),o("p",null,i(S.$t("sidebar.noSteps")),1),o("button",{onClick:H[5]||(H[5]=(...oe)=>r(u)&&r(u)(...oe)),class:"btn btn-primary"},[T(r(R),{icon:"carbon:add",width:"14"}),le(" "+i(S.$t("sidebar.addFirstStep")),1)])])):L("",!0)])]),r(c)?(p(),g("div",Qm,[o("div",Ym,[o("label",Zm,i(S.$t("sidebar.jsonPreview")),1),o("button",{onClick:H[6]||(H[6]=(...oe)=>r(v)&&r(v)(...oe)),class:"btn btn-xs"},[T(r(R),{icon:"carbon:close",width:"12"})])]),o("pre",ef,i(r(m)),1)])):L("",!0),o("div",tf,[o("button",{onClick:H[7]||(H[7]=(...oe)=>r(_)&&r(_)(...oe)),class:"btn btn-sm btn-secondary"},[T(r(R),{icon:"carbon:code",width:"14"}),le(" "+i(r(c)?S.$t("sidebar.hideJson"):S.$t("sidebar.showJson")),1)]),o("div",sf,[o("button",{class:"btn btn-sm",onClick:Ae,disabled:S.isGenerating||S.isExecuting,title:S.$t("sidebar.copyPlan")},[T(r(R),{icon:"carbon:copy",width:"14"}),le(" "+i(S.$t("sidebar.copyPlan")),1)],8,of),o("button",{class:"btn btn-sm",onClick:H[8]||(H[8]=(...oe)=>r(U)&&r(U)(...oe)),disabled:!(S.canRollback??!1),title:S.$t("sidebar.rollback")},[T(r(R),{icon:"carbon:undo",width:"14"})],8,nf),o("button",{class:"btn btn-sm",onClick:H[9]||(H[9]=(...oe)=>r(x)&&r(x)(...oe)),disabled:!(S.canRestore??!1),title:S.$t("sidebar.restore")},[T(r(R),{icon:"carbon:redo",width:"14"})],8,af),o("button",{class:"btn btn-primary",onClick:H[10]||(H[10]=(...oe)=>r(k)&&r(k)(...oe)),disabled:S.isGenerating||S.isExecuting},[T(r(R),{icon:"carbon:save",width:"14"}),H[12]||(H[12]=le(" Save "))],8,lf)])])])),T(Xh,{modelValue:ge.value,"onUpdate:modelValue":H[11]||(H[11]=oe=>ge.value=oe),tools:r(V).availableTools,"selected-tool-ids":Se.value>=0?((ne=r(d).steps[Se.value])==null?void 0:ne.selectedToolKeys)||[]:[],onConfirm:Be},null,8,["modelValue","tools","selected-tool-ids"])])}}}),cf=be(rf,[["__scopeId","data-v-91854736"]]),df={class:"sidebar-content"},uf={class:"sidebar-content-header"},pf={class:"sidebar-content-title"},hf={class:"tab-switcher"},mf=["disabled"],ff={key:0,class:"tab-content"},gf={class:"new-task-section"},vf={class:"sidebar-content-list"},bf={key:0,class:"loading-state"},yf={key:1,class:"error-state"},_f={key:2,class:"empty-state"},wf=["onClick"],Sf={class:"task-icon"},$f={class:"task-details"},Pf={class:"task-title"},kf={class:"task-preview"},Ef={class:"task-time"},Cf={class:"task-actions"},Tf=["title","onClick"],Rf={key:1,class:"tab-content config-tab"},If={key:0,class:"config-container"},Af={class:"template-info-header"},xf={class:"template-info"},Mf={class:"template-id"},Ff=["title"],Df={class:"modal-header"},Uf={class:"modal-body"},Nf={class:"form-row"},Lf={class:"form-label"},Of=["placeholder"],Bf={class:"modal-footer"},qf=["disabled"],jf=ve({__name:"Sidebar",emits:["planExecutionRequested"],setup(n,{expose:e,emit:s}){const{t}=Ie(),a=Js(),l=D(80),c=D(!1),d=D(0),m=D(0),u=D(null),h=D({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}),y=D(null),F=D({enabled:!0,success:!0}),U=pe(()=>F.value.enabled);me(()=>V.currentPlanTemplateId,(b,q)=>{console.log("[Sidebar] currentPlanTemplateId changed from",q,"to",b)}),me(()=>V.jsonContent,(b,q)=>{console.log("[Sidebar] jsonContent changed from",q,"to",b)});const x=async()=>{try{const b=await Le.getCoordinatorToolConfig();F.value=b}catch(b){console.error("Failed to load CoordinatorTool configuration:",b),F.value={enabled:!0,success:!1,message:b instanceof Error?b.message:"Unknown error"}}},k=s,_=async()=>{try{const b=await V.saveTemplate();b!=null&&b.duplicate?a.success(t("sidebar.saveCompleted",{message:b.message,versionCount:b.versionCount})):b!=null&&b.saved?(a.success(t("sidebar.saveSuccess",{message:b.message,versionCount:b.versionCount})),v()):b!=null&&b.message&&a.success(t("sidebar.saveStatus",{message:b.message}))}catch(b){console.error("Failed to save plan modifications:",b),a.error(b.message||t("sidebar.saveFailed"))}},v=async()=>{await new Promise(b=>setTimeout(b,1e3)),console.log("[Sidebar] ðŸ”„ Refreshing parameter requirements for templateId:",V.currentPlanTemplateId),await Ee(),u.value?(console.log("[Sidebar] ðŸ“ž Calling ExecutionController.loadParameterRequirements()"),u.value.loadParameterRequirements(),setTimeout(()=>{u.value&&(console.log("[Sidebar] ðŸ”„ Retry: Calling ExecutionController.loadParameterRequirements() again"),u.value.loadParameterRequirements())},2e3)):console.warn("[Sidebar] âš ï¸ ExecutionController ref not available"),y.value?(console.log("[Sidebar] ðŸ“ž Calling PublishMcpServiceModal.loadParameterRequirements()"),y.value.loadParameterRequirements()):console.warn("[Sidebar] âš ï¸ PublishMcpServiceModal ref not available")},E=()=>{try{typeof V.rollbackVersion=="function"?V.rollbackVersion():console.warn("rollbackVersion method is not available")}catch(b){console.error("Error during rollback operation:",b),a.error(t("sidebar.rollbackFailed")||"Rollback failed")}},P=()=>{try{typeof V.restoreVersion=="function"?V.restoreVersion():console.warn("restoreVersion method is not available")}catch(b){console.error("Error during restore operation:",b),a.error(t("sidebar.restoreFailed")||"Restore failed")}},w=async b=>{var q;console.log("[Sidebar] ðŸŽ¯ handleExecutePlan called with payload:",JSON.stringify(b,null,2)),console.log("[Sidebar] ðŸ“Š Current sidebarStore state:",{currentPlanTemplateId:V.currentPlanTemplateId,selectedTemplate:(q=V.selectedTemplate)==null?void 0:q.id,jsonContent:V.jsonContent.substring(0,100)+"..."});try{const Y=V.preparePlanExecution();if(console.log("[Sidebar] ðŸ“‹ Prepared plan data:",JSON.stringify(Y,null,2)),!Y){console.log("[Sidebar] âŒ No plan data available, returning");return}const ee={...Y,uploadedFiles:b.uploadedFiles,uploadKey:b.uploadKey};b.replacementParams&&Object.keys(b.replacementParams).length>0&&(console.log("[Sidebar] ðŸ”„ Processing replacement parameters:",b.replacementParams),ee.replacementParams=b.replacementParams),console.log("[Sidebar] âœ… Final plan data:",JSON.stringify(ee,null,2));const ge={...b,title:ee.title,planData:ee.planData,params:ee.params,uploadedFiles:ee.uploadedFiles,uploadKey:ee.uploadKey};console.log("[Sidebar] ðŸ“¤ Emitting planExecutionRequested with final payload:",JSON.stringify(ge,null,2)),k("planExecutionRequested",ge),console.log("[Sidebar] âœ… Event emitted successfully")}catch(Y){console.error("[Sidebar] âŒ Error executing plan:",Y),a.error(t("sidebar.executeFailed")+": "+Y.message)}finally{console.log("[Sidebar] ðŸ§¹ Cleaning up after execution"),V.finishPlanExecution(),V.clearExecutionParams(),u.value&&(console.log("[Sidebar] ðŸ§¹ Calling ExecutionController.clearExecutionParams"),u.value.clearExecutionParams()),console.log("[Sidebar] âœ… Cleanup completed")}},f=D(!1),$=D(!1),A=D(""),B=D(!1),C=()=>{if(console.log("[Sidebar] Publish MCP service button clicked"),console.log("[Sidebar] currentPlanTemplateId:",V.currentPlanTemplateId),!V.currentPlanTemplateId){console.log("[Sidebar] No plan template selected, showing warning"),a.error(t("mcpService.selectPlanTemplateFirst"));return}console.log("[Sidebar] Opening publish MCP service modal"),f.value=!0},M=async b=>{b===null?(console.log("MCP service deleted successfully"),a.success(t("mcpService.deleteSuccess")),h.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}):(console.log("MCP service published successfully:",b),a.success(t("mcpService.publishSuccess")),h.value={...b,toolName:b.toolName,serviceGroup:b.serviceGroup??""}),console.log("[Sidebar] ðŸ”„ Reloading available tools after service publish/delete"),await V.loadAvailableTools()},j=()=>{V.clearExecutionParams()},Z=b=>{V.executionParams=b},Q=()=>{if(console.log("[Sidebar] Copy plan clicked"),!V.selectedTemplate){console.log("[Sidebar] No template selected, cannot copy"),a.error(t("sidebar.selectPlanFirst"));return}A.value=(V.selectedTemplate.title??t("sidebar.unnamedPlan"))+" (copy)",console.log("[Sidebar] Opening copy plan modal"),$.value=!0},W=()=>{$.value=!1,A.value="",B.value=!1},X=async()=>{if(!A.value.trim()){a.error(t("sidebar.titleRequired"));return}if(!V.selectedTemplate||!V.jsonContent){a.error(t("sidebar.noPlanToCopy"));return}B.value=!0;try{const q={...JSON.parse(V.jsonContent),title:A.value.trim(),planTemplateId:""},{PlanActApiService:Y}=await ns(async()=>{const{PlanActApiService:ge}=await import("./sidebar-BqRDWae8.js").then(Se=>Se.p);return{PlanActApiService:ge}},__vite__mapDeps([0,1,2,3])),ee=await Y.savePlanTemplate("",JSON.stringify(q));ee.saved?(a.success(t("sidebar.copyPlanSuccess",{title:A.value.trim()})),await V.loadPlanTemplateList(),W()):a.error(t("sidebar.copyPlanFailed",{message:ee.message||"Unknown error"}))}catch(b){console.error("[Sidebar] Error copying plan:",b),a.error(t("sidebar.copyPlanFailed",{message:b.message||"Unknown error"}))}finally{B.value=!1}},G=async b=>{if(!b){h.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""};return}try{const q=await Le.getCoordinatorToolsByTemplate(b);q?h.value={...q,toolName:q.toolName,serviceGroup:q.serviceGroup??""}:h.value={toolName:"",toolDescription:"",planTemplateId:b,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}catch(q){console.error("Failed to load tool information:",q),h.value={toolName:"",toolDescription:"",planTemplateId:b,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}},te=b=>{if(isNaN(b.getTime()))return console.warn("Invalid date received:",b),t("time.unknown");const Y=new Date().getTime()-b.getTime(),ee=Math.floor(Y/6e4),ge=Math.floor(Y/36e5),Se=Math.floor(Y/864e5);return ee<1?t("time.now"):ee<60?t("time.minuteAgo",{count:ee}):ge<24?t("time.hourAgo",{count:ge}):Se<30?t("time.dayAgo",{count:Se}):b.toLocaleDateString("zh-CN")},z=(b,q)=>!b||b.length<=q?b:b.substring(0,q)+"...",N=b=>{c.value=!0,d.value=b.clientX,m.value=l.value,document.addEventListener("mousemove",J),document.addEventListener("mouseup",K),document.body.style.cursor="col-resize",document.body.style.userSelect="none",b.preventDefault()},J=b=>{if(!c.value)return;const q=window.innerWidth,ee=(b.clientX-d.value)/q*100;let ge=m.value+ee;ge=Math.max(15,Math.min(100,ge)),l.value=ge},K=()=>{c.value=!1,document.removeEventListener("mousemove",J),document.removeEventListener("mouseup",K),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("sidebarWidth",l.value.toString())},O=()=>{l.value=80,localStorage.setItem("sidebarWidth","80")};return me(()=>V.currentPlanTemplateId,b=>{G(b)},{immediate:!0}),xe(()=>{V.loadPlanTemplateList(),x(),V.loadAvailableTools();const b=localStorage.getItem("sidebarWidth");b&&(l.value=parseFloat(b))}),Re(()=>{document.removeEventListener("mousemove",J),document.removeEventListener("mouseup",K)}),e({loadPlanTemplateList:V.loadPlanTemplateList,toggleSidebar:V.toggleSidebar,currentPlanTemplateId:V.currentPlanTemplateId}),(b,q)=>{var Y;return p(),g(de,null,[o("div",{class:ae(["sidebar-wrapper",{"sidebar-wrapper-collapsed":r(V).isCollapsed}]),style:ze({width:l.value+"%"})},[o("div",df,[o("div",uf,[o("div",pf,i(b.$t("sidebar.title")),1)]),o("div",hf,[o("button",{class:ae(["tab-button",{active:r(V).currentTab==="list"}]),onClick:q[0]||(q[0]=ee=>r(V).switchToTab("list"))},[T(r(R),{icon:"carbon:list",width:"16"}),le(" "+i(b.$t("sidebar.templateList")),1)],2),o("button",{class:ae(["tab-button",{active:r(V).currentTab==="config"}]),onClick:q[1]||(q[1]=ee=>r(V).switchToTab("config")),disabled:!r(V).selectedTemplate},[T(r(R),{icon:"carbon:settings",width:"16"}),le(" "+i(b.$t("sidebar.configuration")),1)],10,mf)]),r(V).currentTab==="list"?(p(),g("div",ff,[o("div",gf,[o("button",{class:"new-task-btn",onClick:q[2]||(q[2]=()=>r(V).createNewTemplate(r(V).planType))},[T(r(R),{icon:"carbon:add",width:"16"}),le(" "+i(b.$t("sidebar.newPlan"))+" ",1),q[10]||(q[10]=o("span",{class:"shortcut"},"âŒ˜ K",-1))])]),o("div",vf,[r(V).isLoading?(p(),g("div",bf,[T(r(R),{icon:"carbon:circle-dash",width:"20",class:"spinning"}),o("span",null,i(b.$t("sidebar.loading")),1)])):r(V).errorMessage?(p(),g("div",yf,[T(r(R),{icon:"carbon:warning",width:"20"}),o("span",null,i(r(V).errorMessage),1),o("button",{onClick:q[3]||(q[3]=(...ee)=>r(V).loadPlanTemplateList&&r(V).loadPlanTemplateList(...ee)),class:"retry-btn"},i(b.$t("sidebar.retry")),1)])):r(V).planTemplateList.length===0?(p(),g("div",_f,[T(r(R),{icon:"carbon:document",width:"32"}),o("span",null,i(b.$t("sidebar.noTemplates")),1)])):(p(!0),g(de,{key:3},he(r(V).sortedTemplates,ee=>(p(),g("div",{key:ee.id,class:ae(["sidebar-content-list-item",{"sidebar-content-list-item-active":ee.id===r(V).currentPlanTemplateId}]),onClick:ge=>r(V).selectTemplate(ee)},[o("div",Sf,[T(r(R),{icon:"carbon:document",width:"20"})]),o("div",$f,[o("div",Pf,i(ee.title||b.$t("sidebar.unnamedPlan")),1),o("div",kf,i(z(ee.description||b.$t("sidebar.noDescription"),40)),1)]),o("div",Ef,i(te(r(V).parseDateTime(ee.updateTime||ee.createTime))),1),o("div",Cf,[o("button",{class:"delete-task-btn",title:b.$t("sidebar.deleteTemplate"),onClick:ye(ge=>r(V).deleteTemplate(ee),["stop"])},[T(r(R),{icon:"carbon:close",width:"16"})],8,Tf)])],10,wf))),128))])])):r(V).currentTab==="config"?(p(),g("div",Rf,[r(V).selectedTemplate?(p(),g("div",If,[o("div",Af,[o("div",xf,[o("h3",null,i(r(V).selectedTemplate.title||b.$t("sidebar.unnamedPlan")),1),o("span",Mf,"ID: "+i(r(V).selectedTemplate.id),1)]),o("button",{class:"back-to-list-btn",onClick:q[4]||(q[4]=ee=>r(V).switchToTab("list"))},[T(r(R),{icon:"carbon:arrow-left",width:"16"})])]),r(V).planType==="dynamic_agent"?(p(),ue(cf,{key:r(V).currentPlanTemplateId||"default","json-content":r(V).jsonContent,"can-rollback":r(V).canRollback,"can-restore":r(V).canRestore,"is-generating":r(V).isGenerating,"is-executing":r(V).isExecuting,"current-plan-template-id":r(V).currentPlanTemplateId||"",onRollback:E,onRestore:P,onSave:_,onCopyPlan:Q,"onUpdate:jsonContent":q[5]||(q[5]=ee=>r(V).jsonContent=ee)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])):(p(),ue(Ou,{key:"simple-"+(r(V).currentPlanTemplateId||"default"),"json-content":r(V).jsonContent,"can-rollback":r(V).canRollback,"can-restore":r(V).canRestore,"is-generating":r(V).isGenerating,"is-executing":r(V).isExecuting,"current-plan-template-id":r(V).currentPlanTemplateId||"",onRollback:E,onRestore:P,onSave:_,"onUpdate:jsonContent":q[6]||(q[6]=ee=>r(V).jsonContent=ee)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])),T(zd,{ref_key:"executionControllerRef",ref:u,"current-plan-template-id":r(V).currentPlanTemplateId||"","is-executing":r(V).isExecuting,"is-generating":r(V).isGenerating,"show-publish-button":U.value,"tool-info":h.value,onExecutePlan:w,onPublishMcpService:C,onClearParams:j,onUpdateExecutionParams:Z},null,8,["current-plan-template-id","is-executing","is-generating","show-publish-button","tool-info"])])):L("",!0)])):L("",!0)]),o("div",{class:"sidebar-resizer",onMousedown:N,onDblclick:O,title:b.$t("sidebar.resizeHint")},q[11]||(q[11]=[o("div",{class:"resizer-line"},null,-1)]),40,Ff)],6),T(Xc,{ref_key:"publishMcpModalRef",ref:y,modelValue:f.value,"onUpdate:modelValue":q[7]||(q[7]=ee=>f.value=ee),"plan-template-id":r(V).currentPlanTemplateId||"","plan-description":((Y=r(V).selectedTemplate)==null?void 0:Y.description)||"",onPublished:M},null,8,["modelValue","plan-template-id","plan-description"]),$.value?(p(),g("div",{key:0,class:"modal-overlay",onClick:W},[o("div",{class:"modal-content",onClick:q[9]||(q[9]=ye(()=>{},["stop"]))},[o("div",Df,[o("h3",null,i(b.$t("sidebar.copyPlan")),1),o("button",{class:"close-btn",onClick:W},[T(r(R),{icon:"carbon:close",width:"16"})])]),o("div",Uf,[o("div",Nf,[o("label",Lf,i(b.$t("sidebar.newPlanTitle")),1),ce(o("input",{"onUpdate:modelValue":q[8]||(q[8]=ee=>A.value=ee),type:"text",class:"form-input",placeholder:b.$t("sidebar.enterNewPlanTitle"),onKeyup:et(X,["enter"])},null,40,Of),[[fe,A.value]])])]),o("div",Bf,[o("button",{class:"btn btn-secondary",onClick:W},i(b.$t("common.cancel")),1),o("button",{class:"btn btn-primary",onClick:X,disabled:!A.value.trim()||B.value},[B.value?(p(),ue(r(R),{key:0,icon:"carbon:loading",width:"16",class:"spinning"})):L("",!0),le(" "+i(B.value?b.$t("sidebar.copying"):b.$t("sidebar.copyPlan")),1)],8,qf)])])])):L("",!0)],64)}}}),Vf=be(jf,[["__scopeId","data-v-3686debf"]]),Gf={class:"direct-page"},Hf={class:"direct-chat"},Jf={class:"chat-header"},Wf={class:"header-actions"},zf=["title"],Kf=["title"],Xf=["title"],Qf={class:"chat-content"},Yf=["title"],Zf={class:"message-content"},eg=ve({__name:"index",setup(n){const e=js(),s=Vs(),t=st(),{t:a}=Ie(),{message:l}=Ws(),c=D(""),d=D(""),m=D(),u=D(),h=D(),y=D(),F=D(!1),U=D(!1),x=D(null),k=D(50),_=D(!1),v=D(0),E=D(0),P=pe(()=>{if(V.isCollapsed)return k.value;let O=26;y.value&&y.value.sidebarWidth!==void 0&&(O=y.value.sidebarWidth);const b=100-O;return Math.max(20,Math.min(b,k.value))});xe(()=>{if(console.log("[Direct] onMounted called"),console.log("[Direct] taskStore.currentTask:",t.currentTask),console.log("[Direct] taskStore.hasUnprocessedTask():",t.hasUnprocessedTask()),De.setEventCallbacks({onPlanUpdate:b=>{console.log("[Direct] Plan update event received for rootPlanId:",b),B(b)&&(console.log("[Direct] Processing plan update for current rootPlanId:",b),u.value&&typeof u.value.handlePlanUpdate=="function"?(console.log("[Direct] Calling chatRef.handlePlanUpdate with rootPlanId:",b),u.value.handlePlanUpdate(b)):console.warn("[Direct] chatRef.handlePlanUpdate method not available"),m.value&&typeof m.value.updateDisplayedPlanProgress=="function"?(console.log("[Direct] Calling rightPanelRef.updateDisplayedPlanProgress with rootPlanId:",b),m.value.updateDisplayedPlanProgress(b)):console.warn("[Direct] rightPanelRef.updateDisplayedPlanProgress method not available"))},onPlanCompleted:b=>{if(console.log("[Direct] Plan completed event received for rootPlanId:",b),!!B(b)){if(console.log("[Direct] Processing plan completion for current rootPlanId:",b),u.value&&typeof u.value.handlePlanCompleted=="function"){const q=De.getCachedPlanRecord(b);q&&q.completed?q.summary&&q.summary.trim().length>0?(console.log("[Direct]  Plan details are valid and complete from polling cache, updating UI"),u.value.handlePlanCompleted(q)):(console.warn("[Direct]  Plan completed but summary is empty, still proceeding with available data"),u.value.handlePlanCompleted(q)):(console.warn("[Direct]  Plan details incomplete in cache, attempting API fallback"),mt.getDetails(b).then(Y=>{console.log("[Direct]  Got fresh details from API:",Y),Y&&Y.completed?(console.log("[Direct] Fresh details from API are valid, updating UI"),De.setCachedPlanRecord(b,Y),u.value.handlePlanCompleted(Y)):(console.warn("[Direct]  API details also incomplete, using best available data"),u.value.handlePlanCompleted(q??{planId:b}))}).catch(Y=>{console.error("[Direct] API call failed (likely record deleted), using cached data:",Y),u.value.handlePlanCompleted(q??{planId:b})}))}else console.warn("[Direct] chatRef.handlePlanCompleted method not available");x.value=null,console.log("[Direct] ðŸ§¹ Cleared currentRootPlanId after plan completion"),h.value&&typeof h.value.resetSession=="function"&&(console.log("[Direct] ðŸ§¹ Calling inputRef.resetSession to clear sessionPlanId"),h.value.resetSession())}},onDialogRoundStart:b=>{console.log("[Direct] Dialog round start event received for rootPlanId:",b),x.value=b,console.log("[Direct] Set currentRootPlanId to:",b),u.value&&typeof u.value.handleDialogRoundStart=="function"?(console.log("[Direct] Calling chatRef.handleDialogRoundStart with planId:",b),u.value.handleDialogRoundStart(b)):console.warn("[Direct] chatRef.handleDialogRoundStart method not available")},onChatInputClear:()=>{console.log("[Direct] Chat input clear event received"),j()},onChatInputUpdateState:b=>{if(console.log("[Direct] Chat input update state event received for rootPlanId:",b),!B(b,!0))return;const q=De.getCachedUIState(b);q&&Q(q.enabled,q.placeholder)},onPlanError:b=>{u.value.handlePlanError(b)}}),console.log("[Direct] Event callbacks registered to planExecutionManager"),V.loadPlanTemplateList(),t.hasUnprocessedTask()&&t.currentTask){const b=t.currentTask.prompt;console.log("[Direct] Found unprocessed task from store:",b),b.trim()?(t.markTaskAsProcessed(),Ee(async()=>{try{console.log("[Direct] Calling handleChatSendMessage with taskContent:",b),await C({input:b})}catch(q){console.warn("[Direct] handleChatSendMessage failed, falling back to prompt:",q),c.value=b}})):(console.log("[Direct] Task has empty content, marking as processed without execution"),t.markTaskAsProcessed())}else{const b=t.getAndClearTaskToInput();b?(d.value=b,console.log("[Direct] Setting inputOnlyContent for input only:",d.value)):(c.value=e.query.prompt||"",console.log("[Direct] Received task from URL:",c.value),console.log("[Direct] No unprocessed task in store"))}const O=localStorage.getItem("directPanelWidth");O&&(k.value=parseFloat(O)),console.log("[Direct] Final prompt value:",c.value),d.value&&Ee(()=>{h.value&&typeof h.value.setInputValue=="function"&&(h.value.setInputValue(d.value),console.log("[Direct] Set input value:",d.value),d.value="")}),window.addEventListener("plan-execution-requested",b=>{console.log("[DirectView] Received plan-execution-requested event:",b.detail),N(b.detail)})}),me(()=>t.currentTask,O=>{if(console.log("[Direct] Watch taskStore.currentTask triggered, newTask:",O),O&&!O.processed&&O.prompt.trim()){const b=O.prompt;t.markTaskAsProcessed(),console.log("[Direct] Received new task from store:",b),Ee(async()=>{try{console.log("[Direct] Directly executing new task via handleChatSendMessage:",b),await C({input:b})}catch(q){console.warn("[Direct] handleChatSendMessage failed for new task:",q)}})}else console.log("[Direct] Task is null, already processed, or has empty prompt - ignoring")},{immediate:!1}),me(()=>c.value,(O,b)=>{console.log("[Direct] prompt value changed from:",b,"to:",O)},{immediate:!1}),me(()=>t.taskToInput,O=>{console.log("[Direct] Watch taskStore.taskToInput triggered, newTaskToInput:",O),O.trim()&&(console.log("[Direct] Setting input value from taskToInput:",O),Ee(()=>{h.value&&typeof h.value.setInputValue=="function"&&(h.value.setInputValue(O.trim()),console.log("[Direct] Input value set from taskToInput watch:",O.trim()),t.getAndClearTaskToInput())}))},{immediate:!1}),Re(()=>{console.log("[Direct] onUnmounted called, cleaning up resources"),x.value=null,De.cleanup(),document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",$),window.removeEventListener("plan-execution-requested",O=>{N(O.detail)})});const w=O=>{_.value=!0,v.value=O.clientX,E.value=k.value,document.addEventListener("mousemove",f),document.addEventListener("mouseup",$),document.body.style.cursor="col-resize",document.body.style.userSelect="none",O.preventDefault()},f=O=>{if(!_.value)return;const b=window.innerWidth,Y=(O.clientX-v.value)/b*100;let ee=E.value+Y;ee=Math.max(20,Math.min(80,ee)),k.value=ee},$=()=>{_.value=!1,document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",$),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("directPanelWidth",k.value.toString())},A=()=>{k.value=50,localStorage.setItem("directPanelWidth","50")},B=(O,b=!1)=>!x.value||O===x.value||b&&(O==="ui-state"||O==="error")?!0:(console.log("[Direct] Ignoring event for non-current rootPlanId:",O,"current:",x.value),!1),C=async O=>{var q,Y,ee,ge,Se,Ue,Oe,Be,qe;let b=null;try{if(console.log("[DirectView] Processing send-message event:",O),!O.input.trim()){console.warn("[DirectView] Empty input detected, skipping backend request");return}const Ae=(q=u.value)==null?void 0:q.addMessage("user",O.input);O.attachments&&Ae&&((Y=u.value)==null||Y.updateMessage(Ae.id,{attachments:O.attachments})),b=(ee=u.value)==null?void 0:ee.addMessage("assistant","",{thinking:a("chat.thinkingProcessing")}),b&&((ge=u.value)==null||ge.startStreaming(b.id));const{DirectApiService:$e}=await ns(async()=>{const{DirectApiService:je}=await import("./sidebar-BqRDWae8.js").then(S=>S.d);return{DirectApiService:je}},__vite__mapDeps([0,1,2,3]));console.log("[DirectView] Calling DirectApiService.sendMessageWithDefaultPlan");const we=await $e.sendMessageWithDefaultPlan(O);console.log("[DirectView] API response received:",we),we.planId&&b?((Se=u.value)==null||Se.updateMessage(b.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:we.planId,rootPlanId:we.planId,status:"running"}}),x.value=we.planId,console.log("[DirectView] Set currentRootPlanId to:",we.planId),De.handlePlanExecutionRequested(we.planId,O.input),console.log("[DirectView] Started polling for plan execution updates")):b&&((Ue=u.value)==null||Ue.updateMessage(b.id,{content:we.message||we.result||"No response received from backend"}),(Oe=u.value)==null||Oe.stopStreaming(b.id))}catch(Ae){console.error("[DirectView] Send message failed:",Ae),(Be=u.value)==null||Be.addMessage("assistant",`Error: ${(Ae==null?void 0:Ae.message)||"Failed to send message"}`),b&&((qe=u.value)==null||qe.stopStreaming(b.id))}},M=async O=>{console.log("[DirectView] Send message from input:",JSON.stringify(O)),await C(O)},j=()=>{console.log("[DirectView] Input cleared"),h.value&&typeof h.value.clear=="function"&&h.value.clear()},Z=()=>{console.log("[DirectView] Input focused")},Q=(O,b)=>{console.log("[DirectView] Input state updated:",O,b),U.value=!O},W=O=>{console.log("[DirectView] Step selected:",O),m.value&&typeof m.value.handleStepSelected=="function"?(console.log("[DirectView] Forwarding step selection to right panel:",O),m.value.handleStepSelected(O)):console.warn("[DirectView] rightPanelRef.handleStepSelected method not available")},X=(O,b,q,Y)=>{console.log("[DirectView] Sub plan step selected:",{parentPlanId:O,subPlanId:b,stepIndex:q,subStepIndex:Y}),m.value&&typeof m.value.handleSubPlanStepSelected=="function"?(console.log("[DirectView] Forwarding sub plan step selection to right panel:",{parentPlanId:O,subPlanId:b,stepIndex:q,subStepIndex:Y}),m.value.handleSubPlanStepSelected(O,b,q,Y)):console.warn("[DirectView] rightPanelRef.handleSubPlanStepSelected method not available")},G=()=>{console.log("[DirectView] Plan mode button clicked"),V.toggleSidebar(),console.log("[DirectView] Sidebar toggled, isCollapsed:",V.isCollapsed)},te=()=>{s.push("/home")},z=()=>{s.push("/configs")},N=async O=>{var Y,ee,ge,Se,Ue,Oe,Be,qe,Ae;if(console.log("[DirectView] Plan execution requested:",O),F.value){console.log("[DirectView] Plan execution already in progress, ignoring request");return}F.value=!0;let b=!1,q=null;try{console.log("[DirectView] Adding messages for plan execution:",O.title),(Y=u.value)==null||Y.addMessage("user",O.title),b=!0,q=(ee=u.value)==null?void 0:ee.addMessage("assistant","",{thinking:a("chat.planningExecution")}),q&&((ge=u.value)==null||ge.startStreaming(q.id),console.log("[DirectView] Added assistant message for plan execution:",q.id))}catch($e){console.warn("[DirectView] Failed to add messages:",$e)}try{const $e=O.planData.planTemplateId;if(!$e)throw new Error(a("direct.planTemplateIdNotFound"));console.log("[Direct] Executing plan with templateId:",$e,"params:",O.params),console.log("[Direct] About to call PlanActApiService.executePlan");const we=O.uploadedFiles??[],je=O.uploadKey??void 0;console.log("[Direct] ðŸ” DEBUG - InputArea uploadedFiles:",we),console.log("[Direct] ðŸ” DEBUG - InputArea uploadKey:",je),console.log("[Direct] Executing with uploaded files:",we.length),console.log("[Direct] Executing with replacement params:",O.replacementParams);let S;if((Se=O.params)!=null&&Se.trim()?(console.log("[Direct] Calling executePlan with rawParam:",O.params.trim()),S=await ut.executePlan($e,O.params.trim(),we,O.replacementParams,je)):(console.log("[Direct] Calling executePlan without rawParam"),S=await ut.executePlan($e,void 0,we,O.replacementParams,je)),console.log("[Direct] Plan execution API response:",S),S.planId&&q)console.log("[Direct] Got planId from response:",S.planId,"starting plan execution"),(Ue=u.value)==null||Ue.updateMessage(q.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:S.planId,rootPlanId:S.planId,status:"running"}}),x.value=S.planId,console.log("[Direct] Set currentRootPlanId to:",S.planId),console.log("[Direct] Delegating plan execution to planExecutionManager"),De.handlePlanExecutionRequested(S.planId,O.title);else throw console.error("[Direct] No planId in response:",S),new Error(a("direct.executionFailedNoPlanId"))}catch($e){console.error("[Direct] Plan execution failed:",$e),console.error("[Direct] Error details:",{message:$e.message,stack:$e.stack}),x.value=null;try{console.log("[Direct] Adding error messages to chat"),b||(Oe=u.value)==null||Oe.addMessage("user",O.title),q?((Be=u.value)==null||Be.updateMessage(q.id,{content:`${a("direct.executionFailed")}: ${$e.message||a("common.unknownError")}`,thinking:void 0}),(qe=u.value)==null||qe.stopStreaming(q.id)):(Ae=u.value)==null||Ae.addMessage("assistant",`${a("direct.executionFailed")}: ${$e.message||a("common.unknownError")}`)}catch(we){console.error("[Direct] Failed to add error messages:",we),alert(`${a("direct.executionFailed")}: ${$e.message||a("common.unknownError")}`)}}finally{console.log("[Direct] Plan execution finished, resetting isExecutingPlan flag"),F.value=!1}},J=()=>{u.value.showMemory()},K=()=>{Ne.clearMemoryId(),u.value.newChat()};return(O,b)=>(p(),g("div",Gf,[o("div",Hf,[T(Vf,{ref_key:"sidebarRef",ref:y,onPlanExecutionRequested:N},null,512),o("div",{class:"left-panel",style:ze({width:P.value+"%"})},[o("div",Jf,[o("button",{class:"back-button",onClick:te},[T(r(R),{icon:"carbon:arrow-left"})]),o("h2",null,i(O.$t("conversation")),1),o("div",Wf,[T(Hs),o("button",{class:"config-button",onClick:K,title:O.$t("memory.newChat")},[T(r(R),{icon:"carbon:add",width:"20"})],8,zf),o("button",{class:"config-button",onClick:z,title:O.$t("direct.configuration")},[T(r(R),{icon:"carbon:settings-adjust",width:"20"})],8,Kf),o("button",{class:"cron-task-btn",onClick:b[0]||(b[0]=q=>r(Ne).toggleSidebar()),title:O.$t("memory.selectMemory")},[T(r(R),{icon:"carbon:calendar",width:"20"})],8,Xf)])]),o("div",Qf,[T(Xa,{ref_key:"chatRef",ref:u,mode:"direct","initial-prompt":c.value||"",onStepSelected:W,onSubPlanStepSelected:X},null,8,["initial-prompt"])]),(p(),ue(fl,{key:O.$i18n.locale,ref_key:"inputRef",ref:h,disabled:U.value,placeholder:U.value?r(a)("input.waiting"):r(a)("input.placeholder"),"initial-value":c.value,onSend:M,onClear:j,onFocus:Z,onUpdateState:Q,onPlanModeClicked:G},null,8,["disabled","placeholder","initial-value"]))],4),o("div",{class:"panel-resizer",onMousedown:w,onDblclick:A,title:O.$t("direct.panelResizeHint")},b[1]||(b[1]=[o("div",{class:"resizer-line"},null,-1)]),40,Yf),T(hc,{ref_key:"rightPanelRef",ref:m,style:ze({width:100-k.value+"%"}),"current-root-plan-id":x.value},null,8,["style","current-root-plan-id"])]),T(cr,{onMemorySelected:J}),r(l).show?(p(),g("div",{key:0,class:ae(["message-toast",r(l).type])},[o("div",Zf,[o("span",null,i(r(l).text),1)])],2)):L("",!0)]))}}),Eg=be(eg,[["__scopeId","data-v-e8d32f85"]]);export{Eg as default};
//# sourceMappingURL=index-Bjtcu_wz.js.map
