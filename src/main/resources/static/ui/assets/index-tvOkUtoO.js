const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/sidebar-hQWcOc6U.js","assets/index-CqifdL0M.js","assets/index-DN-vOy2S.css","assets/llm-check-S84pbv31.js"])))=>i.map(i=>d[i]);
var No=Object.defineProperty;var Uo=(n,e,o)=>e in n?No(n,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[e]=o;var ke=(n,e,o)=>Uo(n,typeof e!="symbol"?e+"":e,o);import{c as he,d as be,a as g,b as p,e as s,f as L,t as i,F as ue,q as me,g as T,i as r,u as Ae,n as le,h as re,z as ze,j as Se,l as pe,B as oo,C as nt,r as D,o as Fe,D as fe,E as Ie,w as de,m as ve,G as Dt,H as Et,v as Lo,I as so,J as tt,A as Ce,T as Nt,p as Ke,K as Oo,M as Bo,N as qo,O as et,_ as no,P as jo,y as Vo}from"./index-CqifdL0M.js";import{D as Go,u as ot,P as ut,T as Ho,s as j}from"./sidebar-hQWcOc6U.js";import{I as R,_ as ye}from"./_plugin-vue_export-helper-oZzM1xkr.js";import{L as Jo}from"./LanguageSwitcher-Ify189fw.js";import{M as ao,u as Wo,a as zo}from"./useMessage-DEQm7hRr.js";import"./llm-check-S84pbv31.js";class mt{static async getDetails(e){try{const o=await fetch(`${this.BASE_URL}/details/${e}`);if(o.status===404)return null;if(!o.ok){const l=await o.text();throw new Error(`Failed to get detailed information: ${o.status} - ${l}`)}const t=await o.text(),a=JSON.parse(t);return a&&typeof a=="object"&&!a.currentPlanId&&(a.currentPlanId=e),a}catch(o){return console.error("[CommonApiService] Failed to get plan details:",o),null}}static async submitFormInput(e,o){const t=await fetch(`${this.BASE_URL}/submit-input/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!t.ok){let l;try{l=await t.json()}catch{l={message:`Failed to submit form input: ${t.status}`}}throw new Error(l.message||`Failed to submit form input: ${t.status}`)}const a=t.headers.get("content-type");return a&&a.indexOf("application/json")!==-1?await t.json():{success:!0}}static async getAllPrompts(){try{const e=await fetch(this.BASE_URL);return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get Prompt list:",e),e}}static async handleResponse(e){if(!e.ok)try{const o=await e.json();throw new Error(o.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}}ke(mt,"BASE_URL","/api/executor");function Ut(){return{formatResponseText:m=>m?m.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\n/g,"<br>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>"):"",formatTimestamp:m=>{const h=new Date().getTime()-m.getTime();return h<6e4?"Just now":h<36e5?`${Math.floor(h/6e4)} minutes ago`:h<864e5?`${Math.floor(h/36e5)} hours ago`:m.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},getMessageClasses:m=>he(()=>({user:m.type==="user",assistant:m.type==="assistant",streaming:m.isStreaming,"has-error":!!m.error,"has-thinking":!!m.thinking,"has-execution":!!m.planExecution})),formatFileSize:m=>{if(m===0)return"0 B";const u=1024,h=["B","KB","MB","GB"],b=Math.floor(Math.log(m)/Math.log(u));return parseFloat((m/Math.pow(u,b)).toFixed(2))+" "+h[b]},truncateText:(m,u=100)=>!m||m.length<=u?m:m.substring(0,u)+"...",stripHtml:m=>m.replace(/<[^>]*>/g,""),hasDisplayableContent:m=>!!(m.content||(m.thinking??!1)||(m.planExecution??!1)||m.error),getMessageStatus:m=>m.error?"Send failed":m.isStreaming?"Typing...":m.type==="assistant"&&!m.content&&!m.thinking?"Waiting for response":""}}const Ko=["data-message-id"],Xo={class:"user-content"},Qo={class:"message-text"},Yo={key:0,class:"attachments"},Zo={class:"attachment-name"},es={class:"attachment-size"},ts={class:"message-timestamp"},os={key:0,class:"message-status error"},ss={class:"status-text"},ns=be({__name:"UserMessage",props:{message:{}},setup(n){const{formatTimestamp:e,formatFileSize:o}=Ut();return(t,a)=>{var l;return p(),g("div",{class:"user-message","data-message-id":t.message.id},[s("div",Xo,[s("div",Qo,i(t.message.content),1),(l=t.message.attachments)!=null&&l.length?(p(),g("div",Yo,[(p(!0),g(ue,null,me(t.message.attachments,(c,d)=>(p(),g("div",{key:d,class:"attachment-item"},[T(r(R),{icon:"carbon:document",class:"attachment-icon"}),s("span",Zo,i(c.name),1),s("span",es,i(r(o)(c.size)),1)]))),128))])):L("",!0),s("div",ts,i(r(e)(t.message.timestamp)),1)]),t.message.error?(p(),g("div",os,[T(r(R),{icon:"carbon:warning",class:"status-icon"}),s("span",ss,i(t.message.error),1)])):L("",!0)],8,Ko)}}}),as=ye(ns,[["__scopeId","data-v-94372507"]]),ls={class:"sub-plan-info"},rs={class:"sub-plan-details"},is={class:"sub-plan-title"},cs={key:0,class:"nesting-level"},ds={class:"sub-plan-id"},us={class:"sub-plan-meta"},ps={key:0,class:"trigger-tool"},hs={class:"trigger-text"},ms={key:0,class:"sub-plan-progress"},fs={class:"progress-info"},gs={class:"progress-text"},vs={class:"progress-bar"},bs={key:1,class:"sub-plan-agents-steps"},ys={class:"agents-steps-header"},_s={class:"agents-label"},Ss={class:"agents-steps-list"},ws=["onClick"],$s={class:"agent-step-header"},Ps={class:"agent-name"},ks={class:"sub-agent-execution-info"},Es={key:0,class:"agent-result"},Cs={class:"result-header"},Ts={class:"result-label"},Rs={class:"result-content"},Is={key:1,class:"agent-error"},As={class:"error-header"},xs={class:"error-label"},Ms={class:"error-content"},Fs={key:2,class:"think-act-preview"},Ds={class:"think-act-header"},Ns={class:"think-act-label"},Us={class:"think-act-steps-preview"},Ls=["onClick"],Os={class:"step-number"},Bs={class:"step-description"},qs={key:0,class:"more-steps"},js={class:"more-steps-text"},Vs={key:3,class:"nested-sub-plans"},Gs={class:"nested-sub-plans-header"},Hs={class:"nested-label"},Js={class:"nested-sub-plans-list"},Ws={key:4,class:"direct-sub-plans"},zs={class:"direct-sub-plans-header"},Ks={class:"direct-label"},Xs={class:"direct-sub-plans-list"},Qs=be({__name:"RecursiveSubPlan",props:{subPlan:{},subPlanIndex:{},nestingLevel:{default:0},maxNestingDepth:{default:3},maxVisibleSteps:{default:2}},emits:["sub-plan-selected","step-selected"],setup(n,{emit:e}){const o=n,t=e,{t:a}=Ae(),l=()=>`nesting-level-${o.nestingLevel}`,c=()=>{var M,q;return o.subPlan.completed?"completed":((M=o.subPlan.agentExecutionSequence)==null?void 0:M.some(k=>k.status==="RUNNING"))?"running":((q=o.subPlan.agentExecutionSequence)==null?void 0:q.some(k=>k.status==="FINISHED"))?"in-progress":"pending"},d=()=>{switch(c()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},m=()=>{switch(c()){case"completed":return"carbon:checkmark";case"running":return"carbon:play";case"in-progress":return"carbon:in-progress";case"pending":default:return"carbon:dot-mark"}},u=()=>{var w;if(!((w=o.subPlan.agentExecutionSequence)!=null&&w.length))return 0;if(o.subPlan.completed)return 100;const f=h();return Math.min(100,f/o.subPlan.agentExecutionSequence.length*100)},h=()=>{var f;return(f=o.subPlan.agentExecutionSequence)!=null&&f.length?o.subPlan.agentExecutionSequence.filter(w=>w.status==="FINISHED").length:0},b=f=>{switch(f){case"FINISHED":return"completed";case"RUNNING":return"running";case"IDLE":default:return"pending"}},F=f=>{switch(f){case"FINISHED":return"carbon:checkmark";case"RUNNING":return"carbon:play";case"IDLE":default:return"carbon:dot-mark"}},N=f=>{switch(f){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},A=f=>{var w;return((w=f.thinkActSteps)==null?void 0:w.some(M=>M.subPlanExecutionRecord))??!1},P=f=>{var w;return((w=f.thinkActSteps)==null?void 0:w.filter(M=>M.subPlanExecutionRecord))??[]},y=()=>{t("sub-plan-selected",-1,o.subPlanIndex,o.subPlan)},v=(f,w)=>{const M=w.stepId??`subplan-${o.subPlanIndex}-agent-${f}`;t("step-selected",M)},E=(f,w,M)=>{const q=M.stepId??`subplan-${o.subPlanIndex}-agent-${f}`;t("step-selected",q)},$=(f,w,M)=>{t("sub-plan-selected",f,w,M)},_=f=>{t("step-selected",f)};return(f,w)=>{var q,k;const M=oo("RecursiveSubPlan",!0);return p(),g("div",{class:le(["recursive-sub-plan",l()])},[s("div",{class:"sub-plan-header",onClick:y},[s("div",ls,[T(r(R),{icon:m(),class:"sub-plan-status-icon"},null,8,["icon"]),s("div",rs,[s("div",is,[re(i(f.subPlan.title||f.$t("chat.subPlan"))+" #"+i(f.subPlanIndex+1)+" ",1),(f.nestingLevel??0)>0?(p(),g("span",cs,"(L"+i((f.nestingLevel??0)+1)+")",1)):L("",!0)]),s("div",ds,i(f.subPlan.currentPlanId),1)])]),s("div",us,[s("div",{class:le(["sub-plan-status-badge",c()])},i(d()),3),f.subPlan.parentActToolCall?(p(),g("div",ps,[T(r(R),{icon:"carbon:function",class:"trigger-icon"}),s("span",hs,i(f.subPlan.parentActToolCall.name),1)])):L("",!0)])]),(q=f.subPlan.agentExecutionSequence)!=null&&q.length?(p(),g("div",ms,[s("div",fs,[s("span",gs,i(f.$t("chat.progress"))+": "+i(h())+" / "+i(f.subPlan.agentExecutionSequence.length),1),s("div",vs,[s("div",{class:"progress-fill",style:ze({width:u()+"%"})},null,4)])])])):L("",!0),(k=f.subPlan.agentExecutionSequence)!=null&&k.length?(p(),g("div",bs,[s("div",ys,[s("span",_s,i(f.$t("chat.agentExecutions"))+":",1)]),s("div",Ss,[(p(!0),g(ue,null,me(f.subPlan.agentExecutionSequence,(x,V)=>{var Z,Y;return p(),g("div",{key:x.id||V,class:le(["agent-step-item",b(x.status)]),onClick:z=>v(V,x)},[s("div",$s,[T(r(R),{icon:F(x.status),class:"agent-icon"},null,8,["icon"]),s("span",Ps,i(x.agentName||f.$t("chat.unknownAgent")),1),s("div",{class:le(["agent-status-badge",b(x.status)])},i(N(x.status)),3)]),s("div",ks,[x.result?(p(),g("div",Es,[s("div",Cs,[T(r(R),{icon:"carbon:checkmark",class:"result-icon"}),s("span",Ts,i(f.$t("chat.agentResult"))+":",1)]),s("pre",Rs,i(x.result),1)])):L("",!0),x.errorMessage?(p(),g("div",Is,[s("div",As,[T(r(R),{icon:"carbon:warning",class:"error-icon"}),s("span",xs,i(f.$t("chat.errorMessage"))+":",1)]),s("pre",Ms,i(x.errorMessage),1)])):L("",!0),(Z=x.thinkActSteps)!=null&&Z.length?(p(),g("div",Fs,[s("div",Ds,[T(r(R),{icon:"carbon:thinking",class:"think-act-icon"}),s("span",Ns,i(f.$t("chat.thinkActSteps"))+" ("+i(x.thinkActSteps.length)+")",1)]),s("div",Us,[(p(!0),g(ue,null,me(x.thinkActSteps.slice(0,f.maxVisibleSteps??2),(z,X)=>(p(),g("div",{key:z.id||X,class:"think-act-step-preview",onClick:Se(G=>E(V,X,x),["stop"])},[s("span",Os,"#"+i(X+1),1),s("span",Bs,i(z.actionDescription||f.$t("chat.thinking")),1),T(r(R),{icon:"carbon:arrow-right",class:"step-arrow"})],8,Ls))),128)),x.thinkActSteps.length>(f.maxVisibleSteps??2)?(p(),g("div",qs,[s("span",js,i(f.$t("chat.andMoreSteps",{count:x.thinkActSteps.length-(f.maxVisibleSteps??2)})),1)])):L("",!0)])])):L("",!0),A(x)?(p(),g("div",Vs,[s("div",Gs,[T(r(R),{icon:"carbon:tree-view-alt",class:"nested-icon"}),s("span",Hs,i(f.$t("chat.nestedSubPlans")),1)]),s("div",Js,[(p(!0),g(ue,null,me(P(x),(z,X)=>(p(),pe(M,{key:z.id||X,"sub-plan":z.subPlanExecutionRecord,"sub-plan-index":X,"nesting-level":(f.nestingLevel??0)+1,"max-nesting-depth":f.maxNestingDepth??3,"max-visible-steps":f.maxVisibleSteps??2,onSubPlanSelected:$,onStepSelected:_},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):L("",!0),(Y=x.subPlanExecutionRecords)!=null&&Y.length?(p(),g("div",Ws,[s("div",zs,[T(r(R),{icon:"carbon:tree-view",class:"direct-icon"}),s("span",Ks,i(f.$t("chat.directSubPlans")),1)]),s("div",Xs,[(p(!0),g(ue,null,me(x.subPlanExecutionRecords,(z,X)=>(p(),pe(M,{key:z.currentPlanId||X,"sub-plan":z,"sub-plan-index":X,"nesting-level":(f.nestingLevel??0)+1,"max-nesting-depth":f.maxNestingDepth??3,"max-visible-steps":f.maxVisibleSteps??2,onSubPlanSelected:$,onStepSelected:_},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):L("",!0)])],10,ws)}),128))])])):L("",!0)],2)}}}),Ys=ye(Qs,[["__scopeId","data-v-5dcf159c"]]),Zs={class:"execution-details"},en={key:0,class:"plan-overview"},tn={class:"plan-header"},on={class:"plan-title"},sn={key:0,class:"parent-tool-call"},nn={class:"parent-tool-header"},an={class:"tool-label"},ln={class:"tool-name"},rn={key:0,class:"tool-parameters"},cn={class:"param-label"},dn={class:"param-content"},un={key:1,class:"agent-execution-container"},pn={class:"section-title"},hn=["onClick"],mn={class:"agent-info"},fn={class:"agent-details"},gn={class:"agent-name"},vn={class:"request-content"},bn={class:"agent-controls"},yn={class:"agent-execution-info"},_n={key:0,class:"agent-result"},Sn={class:"result-header"},wn={class:"result-label"},$n={class:"result-content"},Pn={key:1,class:"agent-error"},kn={class:"error-header"},En={class:"error-label"},Cn={class:"error-content"},Tn={key:0,class:"sub-plans-container"},Rn={class:"sub-plans-header"},In={class:"sub-plans-title"},An={class:"sub-plans-list"},xn=be({__name:"ExecutionDetails",props:{planExecution:{}},emits:["sub-plan-selected","step-selected"],setup(n,{emit:e}){const o=n,t=e,{t:a}=Ae(),l=he(()=>o.planExecution.agentExecutionSequence??[]),c=P=>{P.stepId?t("step-selected",P.stepId):console.warn("[ExecutionDetails] Agent execution has no stepId:",P)},d=()=>o.planExecution.completed?"completed":l.value.some(v=>v.status==="RUNNING")?"running":l.value.some(v=>v.status==="FINISHED")?"in-progress":"pending",m=()=>{switch(d()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},u=P=>{switch(P){case"RUNNING":return"running";case"FINISHED":return"completed";case"IDLE":default:return"pending"}},h=P=>{switch(P){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},b=P=>{switch(P){case"RUNNING":return"carbon:play";case"FINISHED":return"carbon:checkmark";case"IDLE":default:return"carbon:dot-mark"}},F=(P,y,v)=>{t("sub-plan-selected",P,y,v)},N=P=>{t("step-selected",P)},A=P=>{if(!P)return"";try{const y=JSON.parse(P);return JSON.stringify(y,null,2)}catch{return P}};return(P,y)=>{var v,E,$;return p(),g("div",Zs,[P.planExecution?(p(),g("div",en,[s("div",tn,[s("h3",on,i(P.planExecution.title||P.$t("chat.planExecution")),1),s("div",{class:le(["plan-status-badge",d()])},i(m()),3)]),P.planExecution.parentActToolCall?(p(),g("div",sn,[s("div",nn,[T(r(R),{icon:"carbon:flow",class:"tool-icon"}),s("span",an,i(P.$t("chat.triggeredByTool"))+":",1),s("span",ln,i(P.planExecution.parentActToolCall.name),1)]),P.planExecution.parentActToolCall.parameters?(p(),g("div",rn,[s("span",cn,i(P.$t("common.parameters"))+":",1),s("pre",dn,i(A(P.planExecution.parentActToolCall.parameters)),1)])):L("",!0)])):L("",!0)])):L("",!0),(((E=(v=P.planExecution)==null?void 0:v.agentExecutionSequence)==null?void 0:E.length)??0)>0?(p(),g("div",un,[s("h4",pn,i(P.$t("chat.agentExecutionSequence")),1),(p(!0),g(ue,null,me(($=P.planExecution)==null?void 0:$.agentExecutionSequence,(_,f)=>{var w;return p(),g("div",{key:_.id||f,class:le(["agent-execution-item",u(_.status)])},[s("div",{class:"agent-header",onClick:M=>c(_)},[s("div",mn,[T(r(R),{icon:b(_.status),class:"agent-status-icon"},null,8,["icon"]),s("div",fn,[s("div",gn,i(_.agentName||P.$t("chat.unknownAgent")),1),s("pre",vn,i(_.agentRequest),1)])]),s("div",bn,[s("div",{class:le(["agent-status-badge",u(_.status)])},i(h(_.status)),3),T(r(R),{icon:"carbon:arrow-right",class:"step-select-icon"})])],8,hn),s("div",yn,[_.result?(p(),g("div",_n,[s("div",Sn,[T(r(R),{icon:"carbon:checkmark",class:"result-icon"}),s("span",wn,i(P.$t("chat.agentResult"))+":",1)]),s("pre",$n,i(_.result),1)])):L("",!0),_.errorMessage?(p(),g("div",Pn,[s("div",kn,[T(r(R),{icon:"carbon:warning",class:"error-icon"}),s("span",En,i(P.$t("chat.errorMessage"))+":",1)]),s("pre",Cn,i(_.errorMessage),1)])):L("",!0)]),(w=_.subPlanExecutionRecords)!=null&&w.length?(p(),g("div",Tn,[s("div",Rn,[T(r(R),{icon:"carbon:tree-view",class:"sub-plans-icon"}),s("span",In,i(P.$t("chat.subPlanExecutions"))+" ("+i(_.subPlanExecutionRecords.length)+") ",1)]),s("div",An,[(p(!0),g(ue,null,me(_.subPlanExecutionRecords,(M,q)=>(p(),pe(Ys,{key:M.currentPlanId||q,"sub-plan":M,"sub-plan-index":q,"nesting-level":0,"max-nesting-depth":3,"max-visible-steps":2,onSubPlanSelected:F,onStepSelected:N},null,8,["sub-plan","sub-plan-index"]))),128))])])):L("",!0)],2)}),128))])):L("",!0)])}}}),lo=ye(xn,[["__scopeId","data-v-3fdaaeed"]]),Mn={key:0,class:"thinking-section"},Fn={class:"thinking-header"},Dn={class:"thinking-avatar"},Nn={class:"thinking-label"},Un={class:"thinking-content"},Ln={key:0,class:"thinking"},On={key:2,class:"default-processing"},Bn={class:"processing-indicator"},qn=be({__name:"ThinkingSection",props:{thinking:{},thinkingDetails:{},planExecution:{},stepActions:{},genericInput:{},hasContent:{type:Boolean}},emits:["agent-selected","sub-plan-selected","user-input-submitted","step-selected"],setup(n,{emit:e}){const o=n,t=e,a=he(()=>{var u,h,b,F;return(o.thinking??!1)||(((h=(u=o.thinkingDetails)==null?void 0:u.agentExecutionSequence)==null?void 0:h.length)??0)>0||(((F=(b=o.planExecution)==null?void 0:b.agentExecutionSequence)==null?void 0:F.length)??0)>0}),l=(u,h)=>{t("agent-selected",u,h)},c=(u,h,b)=>{t("sub-plan-selected",u,h,b)},d=u=>{t("user-input-submitted",u)},m=u=>{t("step-selected",u)};return(u,h)=>a.value?(p(),g("div",Mn,[s("div",Fn,[s("div",Dn,[T(r(R),{icon:"carbon:thinking",class:"thinking-icon"})]),s("div",Nn,i(u.$t("chat.thinkingLabel")),1)]),s("div",Un,[u.thinking?(p(),g("div",Ln,[T(r(R),{icon:"carbon:thinking",class:"thinking-icon"}),s("span",null,i(u.thinking),1)])):L("",!0),u.thinkingDetails||u.planExecution?(p(),pe(lo,{key:1,"plan-execution":u.thinkingDetails||u.planExecution,"step-actions":u.stepActions||[],"generic-input":u.genericInput||"",onAgentSelected:l,onSubPlanSelected:c,onUserInputSubmitted:d,onStepSelected:m},null,8,["plan-execution","step-actions","generic-input"])):!u.hasContent&&u.thinking?(p(),g("div",On,[s("div",Bn,[h[0]||(h[0]=s("div",{class:"thinking-dots"},[s("span"),s("span"),s("span")],-1)),s("span",null,i(u.thinking||u.$t("chat.thinkingProcessing")),1)])])):L("",!0)])])):L("",!0)}}),jn=ye(qn,[["__scopeId","data-v-1cb833fc"]]),Vn={class:"user-input-form-container"},Gn={class:"user-input-header"},Hn={class:"user-input-title"},Jn={class:"user-input-message"},Wn={key:0,class:"form-description"},zn={key:0,class:"form-grid"},Kn=["for"],Xn=["id","name","placeholder","required","onUpdate:modelValue"],Qn=["id","name","placeholder","required","onUpdate:modelValue"],Yn=["id","name","placeholder","required","onUpdate:modelValue"],Zn=["id","name","placeholder","required","onUpdate:modelValue"],ea=["id","name","placeholder","required","onUpdate:modelValue"],ta=["id","name","required","onUpdate:modelValue"],oa={value:""},sa=["value"],na={key:6,class:"checkbox-group"},aa=["id","name","value","onUpdate:modelValue"],la={class:"checkbox-label"},ra={key:7,class:"radio-group"},ia=["id","name","value","onUpdate:modelValue"],ca={class:"radio-label"},da=["id","name","placeholder","required","onUpdate:modelValue"],ua={key:1,class:"form-group"},pa={for:"form-input-genericInput"},ha={type:"submit",class:"submit-user-input-btn"},ma=be({__name:"UserInputForm",props:{userInputWaitState:{},planId:{},genericInput:{}},emits:["user-input-submitted"],setup(n,{emit:e}){const o=n,t=e;Ae();const a=nt({}),l=D(o.genericInput??""),c=D(!1),d=D(null),m=()=>{var N;const F=(N=o.userInputWaitState)==null?void 0:N.formInputs;F&&F.length>0&&(!c.value||Object.keys(a).length!==F.length)&&(F.forEach((P,y)=>{(!(y in a)||P.type==="checkbox"&&!Array.isArray(a[y])||P.type!=="checkbox"&&a[y]==="")&&(P.type==="checkbox"?a[y]=[]:a[y]="")}),c.value=!0)};Fe(()=>{m()}),fe(()=>{var F;return(F=o.userInputWaitState)==null?void 0:F.formInputs},()=>{d.value&&clearTimeout(d.value),d.value=setTimeout(()=>{c.value=!1,m()},100)},{deep:!0});const u=async()=>{var F;try{const N={},A=(F=o.userInputWaitState)==null?void 0:F.formInputs;A&&A.length>0?Object.entries(a).forEach(([P,y])=>{const v=parseInt(P,10),$=A[v].label||`input_${P}`;Array.isArray(y)?N[$]=y.join(", "):N[$]=y}):N.genericInput=l.value,console.log("[UserInputForm] Submitting user input:",N,"for planId:",o.planId),o.planId?(await mt.submitFormInput(o.planId,N),console.log("[UserInputForm] User input submitted successfully")):console.error("[UserInputForm] No planId available for user input submission"),t("user-input-submitted",N)}catch(N){console.error("[UserInputForm] User input submission failed:",N)}},h=F=>F?Array.isArray(F)?F:typeof F=="string"?F.split(",").map(N=>N.trim()).filter(N=>N.length>0):[]:[],b=F=>typeof F=="boolean"?F:typeof F=="string"?F==="true":!1;return Ie(()=>{d.value&&clearTimeout(d.value)}),(F,N)=>{var A,P,y,v,E;return p(),g("div",Vn,[s("div",Gn,[T(r(R),{icon:"carbon:user",class:"user-icon"}),s("h4",Hn,i(F.$t("chat.userInputRequired")),1)]),s("p",Jn,i(((A=F.userInputWaitState)==null?void 0:A.title)??F.$t("chat.userInput.message")),1),(P=F.userInputWaitState)!=null&&P.formDescription?(p(),g("p",Wn,i((y=F.userInputWaitState)==null?void 0:y.formDescription),1)):L("",!0),s("form",{onSubmit:Se(u,["prevent"]),class:"user-input-form"},[(v=F.userInputWaitState)!=null&&v.formInputs&&F.userInputWaitState.formInputs.length>0?(p(),g("div",zn,[(p(!0),g(ue,null,me((E=F.userInputWaitState)==null?void 0:E.formInputs,($,_)=>(p(),g("div",{key:_,class:"form-group"},[s("label",{for:`form-input-${$.label.replace(/\W+/g,"_")}`},i($.label)+i(b($.required)?" *":"")+": ",9,Kn),!$.type||$.type==="text"?de((p(),g("input",{key:0,type:"text",id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,placeholder:$.placeholder||"",required:b($.required),"onUpdate:modelValue":f=>a[_]=f,class:"form-input"},null,8,Xn)),[[ve,a[_]]]):$.type==="email"?de((p(),g("input",{key:1,type:"email",id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,placeholder:$.placeholder||"",required:b($.required),"onUpdate:modelValue":f=>a[_]=f,class:"form-input"},null,8,Qn)),[[ve,a[_]]]):$.type==="number"?de((p(),g("input",{key:2,type:"number",id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,placeholder:$.placeholder||"",required:b($.required),"onUpdate:modelValue":f=>a[_]=f,class:"form-input"},null,8,Yn)),[[ve,a[_]]]):$.type==="password"?de((p(),g("input",{key:3,type:"password",id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,placeholder:$.placeholder||"",required:b($.required),"onUpdate:modelValue":f=>a[_]=f,class:"form-input"},null,8,Zn)),[[ve,a[_]]]):$.type==="textarea"?de((p(),g("textarea",{key:4,id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,placeholder:$.placeholder||"",required:b($.required),"onUpdate:modelValue":f=>a[_]=f,class:"form-input form-textarea",rows:"4"},null,8,ea)),[[ve,a[_]]]):$.type==="select"&&$.options?de((p(),g("select",{key:5,id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,required:b($.required),"onUpdate:modelValue":f=>a[_]=f,class:"form-input form-select"},[s("option",oa,i(F.$t("selectCommon.pleaseSelect")),1),(p(!0),g(ue,null,me(h($.options),f=>(p(),g("option",{key:f,value:f},i(f),9,sa))),128))],8,ta)),[[Dt,a[_]]]):$.type==="checkbox"&&$.options?(p(),g("div",na,[(p(!0),g(ue,null,me(h($.options),f=>(p(),g("label",{key:f,class:"checkbox-item"},[de(s("input",{type:"checkbox",id:`form-input-${$.label.replace(/\W+/g,"_")}-${f.replace(/\W+/g,"_")}`,name:$.label,value:f,"onUpdate:modelValue":w=>a[_]=w,class:"form-checkbox"},null,8,aa),[[Et,a[_]]]),s("span",la,i(f),1)]))),128))])):$.type==="radio"&&$.options?(p(),g("div",ra,[(p(!0),g(ue,null,me(h($.options),f=>(p(),g("label",{key:f,class:"radio-item"},[de(s("input",{type:"radio",id:`form-input-${$.label.replace(/\W+/g,"_")}-${f.replace(/\W+/g,"_")}`,name:$.label,value:f,"onUpdate:modelValue":w=>a[_]=w,class:"form-radio"},null,8,ia),[[Lo,a[_]]]),s("span",ca,i(f),1)]))),128))])):de((p(),g("input",{key:8,type:"text",id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,placeholder:$.placeholder||"",required:b($.required),"onUpdate:modelValue":f=>a[_]=f,class:"form-input"},null,8,da)),[[ve,a[_]]])]))),128))])):(p(),g("div",ua,[s("label",pa,i(F.$t("common.input"))+":",1),de(s("input",{type:"text",id:"form-input-genericInput",name:"genericInput","onUpdate:modelValue":N[0]||(N[0]=$=>l.value=$),class:"form-input"},null,512),[[ve,l.value]])])),s("button",ha,i(F.$t("chat.userInput.submit")),1)],32)])}}}),fa=ye(ma,[["__scopeId","data-v-fc42d4b8"]]),ga={class:"response-section"},va={class:"response-header"},ba={class:"response-avatar"},ya={class:"response-name"},_a={key:0,class:"response-timestamp"},Sa={class:"response-content"},wa={key:1,class:"final-response"},$a=["innerHTML"],Pa={class:"response-actions"},ka=["title"],Ea=["title"],Ca={key:2,class:"response-placeholder"},Ta={class:"typing-indicator"},Ra={class:"typing-text"},Ia={key:3,class:"response-error"},Aa={class:"error-text"},xa={key:4,class:"response-empty"},Ma={class:"empty-text"},Fa=be({__name:"ResponseSection",props:{content:{},isStreaming:{type:Boolean},error:{},timestamp:{},userInputWaitState:{},planId:{},genericInput:{}},emits:["copy","regenerate","retry","user-input-submitted"],setup(n,{emit:e}){const o=n,t=e,{formatResponseText:a,formatTimestamp:l}=Ut(),c=async()=>{if(o.content)try{const h=o.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(h),t("copy")}catch(h){console.error("Failed to copy to clipboard:",h)}},d=()=>{t("regenerate")},m=()=>{t("retry")},u=h=>{console.log("[ResponseSection] User input submitted:",h),t("user-input-submitted",h)};return(h,b)=>{var F;return p(),g("div",ga,[s("div",va,[s("div",ba,[T(r(R),{icon:"carbon:bot",class:"bot-icon"})]),s("div",ya,i(h.$t("chat.botName")),1),h.timestamp?(p(),g("div",_a,i(r(l)(h.timestamp)),1)):L("",!0)]),s("div",Sa,[(F=h.userInputWaitState)!=null&&F.waiting?(p(),pe(fa,so({key:0,"user-input-wait-state":h.userInputWaitState},h.planId?{"plan-id":h.planId}:{},{"generic-input":h.genericInput??"",onUserInputSubmitted:u}),null,16,["user-input-wait-state","generic-input"])):L("",!0),h.content?(p(),g("div",wa,[s("div",{class:"response-text",innerHTML:r(a)(h.content)},null,8,$a),s("div",Pa,[s("button",{class:"action-btn copy-btn",onClick:c,title:h.$t("chat.copyResponse")},[T(r(R),{icon:"carbon:copy"})],8,ka),s("button",{class:"action-btn regenerate-btn",onClick:d,title:h.$t("chat.regenerateResponse")},[T(r(R),{icon:"carbon:renew"})],8,Ea)])])):h.isStreaming?(p(),g("div",Ca,[s("div",Ta,[b[0]||(b[0]=s("div",{class:"typing-dots"},[s("span"),s("span"),s("span")],-1)),s("span",Ra,i(h.$t("chat.thinkingResponse")),1)])])):h.error?(p(),g("div",Ia,[T(r(R),{icon:"carbon:warning",class:"error-icon"}),s("span",Aa,i(h.error),1),s("button",{class:"retry-btn",onClick:m},i(h.$t("chat.retry")),1)])):(p(),g("div",xa,[s("span",Ma,i(h.$t("chat.waitingForResponse")),1)]))])])}}}),Da=ye(Fa,[["__scopeId","data-v-6581a34f"]]),Na={class:"assistant-message"},Ua=be({__name:"AssistantMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(n,{emit:e}){const o=n,t=e,a=()=>{t("copy",o.message.id)},l=()=>{t("regenerate",o.message.id)},c=()=>{t("retry",o.message.id)},d=(u,h)=>{console.log("[AssistantMessage] User input submitted:",h,"for message:",u.id)},m=u=>{console.log("[AssistantMessage] Step selected:",u),t("step-selected",u)};return(u,h)=>{var b,F,N,A;return p(),g("div",Na,[u.message.thinkingDetails?(p(),pe(jn,{key:0,"thinking-details":u.message.thinkingDetails,onStepSelected:m},null,8,["thinking-details"])):L("",!0),u.message.planExecution?(p(),pe(lo,{key:1,"plan-execution":u.message.planExecution,"step-actions":u.message.stepActions||[],"generic-input":u.message.genericInput||"",onStepSelected:m},null,8,["plan-execution","step-actions","generic-input"])):L("",!0),u.message.content||u.message.error||u.isStreaming||(F=(b=u.message.planExecution)==null?void 0:b.userInputWaitState)!=null&&F.waiting?(p(),pe(Da,so({key:2,content:u.message.content||"","is-streaming":u.isStreaming||!1},{...u.message.error?{error:u.message.error}:{},...(N=u.message.planExecution)!=null&&N.userInputWaitState?{userInputWaitState:u.message.planExecution.userInputWaitState}:{},...(A=u.message.planExecution)!=null&&A.currentPlanId?{planId:u.message.planExecution.currentPlanId}:{}},{timestamp:u.message.timestamp,"generic-input":u.message.genericInput||"",onCopy:a,onRegenerate:l,onRetry:c,onUserInputSubmitted:h[0]||(h[0]=P=>d(u.message,P))}),null,16,["content","is-streaming","timestamp","generic-input"])):L("",!0)])}}}),La=ye(Ua,[["__scopeId","data-v-3810c279"]]),Oa=be({__name:"ChatMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(n,{emit:e}){const o=n,t=e,{getMessageClasses:a}=Ut(),l=he(()=>a(o.message)),c=h=>{t("copy",h)},d=h=>{t("regenerate",h)},m=h=>{t("retry",h)},u=h=>{t("step-selected",h)};return(h,b)=>(p(),g("div",{class:le(["chat-message",l.value])},[h.message.type==="user"?(p(),pe(as,{key:0,message:h.message},null,8,["message"])):h.message.type==="assistant"?(p(),pe(La,{key:1,message:h.message,"is-streaming":h.isStreaming||!1,onCopy:c,onRegenerate:d,onRetry:m,onStepSelected:u},null,8,["message","is-streaming"])):L("",!0)],2))}}),Ba=ye(Oa,[["__scopeId","data-v-218b3735"]]);function Ct(n){const e={...n};return"agentExecutionSequence"in n&&Array.isArray(n.agentExecutionSequence)&&(e.agentExecutionSequence=n.agentExecutionSequence.map(o=>qa(o))),e}function qa(n){const e={...n};return"subPlanExecutionRecords"in n&&Array.isArray(n.subPlanExecutionRecords)&&(e.subPlanExecutionRecords=n.subPlanExecutionRecords.map(o=>Ct(o))),e}function ja(n){const e={...n};return"thinkingDetails"in n&&n.thinkingDetails&&(e.thinkingDetails=Ct(n.thinkingDetails)),"planExecution"in n&&n.planExecution&&(e.planExecution=Ct(n.planExecution)),"attachments"in n&&Array.isArray(n.attachments)&&(e.attachments=[...n.attachments]),e}function Va(){const n=D([]),e=D(!1),o=D(null),t=D(null),a=he(()=>n.value.length>0?n.value[n.value.length-1]:null),l=he(()=>o.value!==null),c=he(()=>n.value.length>0),d=(_,f,w)=>{const M={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:_,content:f,timestamp:new Date,isStreaming:!1,...w};return n.value.push(M),M},m=(_,f)=>{const w=n.value.findIndex(M=>M.id===_);w!==-1&&(n.value[w]={...n.value[w],...f})},u=_=>{const f=n.value.findIndex(w=>w.id===_);f!==-1&&n.value.splice(f,1)},h=()=>{n.value=[],o.value=null,t.value=null},b=_=>{o.value=_,m(_,{isStreaming:!0})},F=_=>{_&&m(_,{isStreaming:!1}),o.value===_&&(o.value=null)},N=_=>{t.value=_},A=(_,f,w="content")=>{const M=n.value.find(q=>q.id===_);M&&typeof M[w]=="string"&&m(_,{[w]:M[w]+f})},P=(_,f)=>{m(_,{thinkingDetails:f})},y=(_,f)=>{m(_,{thinking:f})},v=(_,f)=>{m(_,{planExecution:f})},E=_=>n.value.find(f=>f.id===_),$=_=>n.value.findIndex(f=>f.id===_);return{messages:tt(n),isLoading:e,streamingMessageId:tt(o),activeMessageId:tt(t),lastMessage:a,isStreaming:l,hasMessages:c,addMessage:d,updateMessage:m,removeMessage:u,clearMessages:h,startStreaming:b,stopStreaming:F,setActiveMessage:N,appendToMessage:A,updateMessageThinking:y,updateMessageThinkingDetails:P,updateMessagePlanExecution:v,findMessage:E,getMessageIndex:$}}function Ga(n){const e=D(!1),o=D(!0),t=150,a=async(y=!0)=>{n.value&&(await Ce(),n.value.scrollTo({top:n.value.scrollHeight,behavior:y?"smooth":"auto"}))},l=()=>{if(!n.value)return!1;const{scrollTop:y,scrollHeight:v,clientHeight:E}=n.value;return v-y-E<t},c=()=>{if(!n.value)return;const y=l();e.value=!y&&n.value.scrollHeight>n.value.clientHeight,y&&(o.value=!0)},d=()=>{c(),l()||(o.value=!1)},m=async()=>{o.value&&await a()},u=async()=>{o.value=!0,await a()},h=(y,v=!0)=>{if(!n.value)return;const E=n.value.querySelector(`[data-message-id="${y}"]`);E&&E.scrollIntoView({behavior:v?"smooth":"auto",block:"center"})},b=()=>{if(!n.value)return{scrollTop:0,scrollHeight:0,clientHeight:0,isAtTop:!0,isAtBottom:!0,scrollPercentage:0};const{scrollTop:y,scrollHeight:v,clientHeight:E}=n.value,$=y===0,_=y+E>=v-5,f=v>E?y/(v-E)*100:100;return{scrollTop:y,scrollHeight:v,clientHeight:E,isAtTop:$,isAtBottom:_,scrollPercentage:f}},F=()=>{n.value&&n.value.addEventListener("scroll",d,{passive:!0})},N=()=>{n.value&&n.value.removeEventListener("scroll",d)},A=()=>{F(),c()},P=()=>{N()};return Fe(()=>{Ce(()=>{A()})}),Ie(()=>{P()}),{showScrollToBottom:tt(e),isAutoScrollEnabled:tt(o),scrollToBottom:a,autoScrollToBottom:m,forceScrollToBottom:u,scrollToMessage:h,isNearBottom:l,checkScrollPosition:c,getScrollInfo:b,addScrollListener:F,removeScrollListener:N,initializeScrollBehavior:A,cleanupScrollBehavior:P}}const Ge=class Ge{constructor(){ke(this,"POLL_INTERVAL",5e3);ke(this,"state",nt({activePlanId:null,lastSequenceSize:0,isPolling:!1,pollTimer:null}));ke(this,"callbacks",{});ke(this,"planExecutionCache",new Map);ke(this,"uiStateCache",new Map);console.log("[PlanExecutionManager] Initialized with callback-based event system")}getCachedPlanRecord(e){return this.planExecutionCache.get(e)}getCachedUIState(e){return this.uiStateCache.get(e)}setCachedUIState(e,o){this.uiStateCache.set(e,o),console.log(`[PlanExecutionManager] Cached UI state for rootPlanId: ${e}`)}getAllCachedRecords(){return new Map(this.planExecutionCache)}hasCachedPlanRecord(e){return this.planExecutionCache.has(e)}setCachedPlanRecord(e,o){this.planExecutionCache.set(e,o),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${e}`)}clearCachedPlanRecord(e){const o=this.planExecutionCache.delete(e);return o&&console.log(`[PlanExecutionManager] Cleared cached plan execution record for rootPlanId: ${e}`),o}clearAllCachedRecords(){const e=this.planExecutionCache.size,o=this.uiStateCache.size;this.planExecutionCache.clear(),this.uiStateCache.clear(),console.log(`[PlanExecutionManager] Cleared all caches - Plans: ${e}, UI States: ${o}`)}static getInstance(){return Ge.instance||(Ge.instance=new Ge),Ge.instance}getActivePlanId(){return this.state.activePlanId}getState(){return this.state}setEventCallbacks(e){this.callbacks={...this.callbacks,...e},console.log("[PlanExecutionManager] Event callbacks set:",Object.keys(e))}async handleUserMessageSendRequested(e){if(this.validateAndPrepareUIForNewRequest(e))try{if(await this.sendUserMessageAndSetPlanId(e),this.state.activePlanId)this.initiatePlanExecutionSequence(e,this.state.activePlanId);else throw new Error("Failed to get valid plan ID")}catch(o){console.error("[PlanExecutionManager] Failed to send user message:",o);const t=this.state.activePlanId??"error";this.setCachedUIState(t,{enabled:!0}),this.emitChatInputUpdateState(t),this.state.activePlanId=null}}handlePlanExecutionRequested(e,o){console.log("[PlanExecutionManager] Received plan execution request:",{planId:e,query:o}),e?(this.state.activePlanId=e,this.initiatePlanExecutionSequence(o??"Execute Plan",e)):console.error("[PlanExecutionManager] Invalid plan execution request: missing planId")}handleCachedPlanExecution(e,o){const t=this.getCachedPlanRecord(e);return t!=null&&t.currentPlanId?(console.log(`[PlanExecutionManager] Found cached plan execution record for rootPlanId: ${e}`),this.handlePlanExecutionRequested(t.currentPlanId,o),!0):(console.log(`[PlanExecutionManager] No cached plan execution record found for rootPlanId: ${e}`),!1)}validateAndPrepareUIForNewRequest(e){if(!e)return console.warn("[PlanExecutionManager] Query is empty"),!1;if(this.state.activePlanId)return!1;this.emitChatInputClear();const o=this.state.activePlanId??"ui-state";return this.setCachedUIState(o,{enabled:!1,placeholder:"Processing..."}),this.emitChatInputUpdateState(o),!0}async sendUserMessageAndSetPlanId(e){try{const o=await Go.sendMessage({input:e});if(o!=null&&o.planId)return this.state.activePlanId=o.planId,o;if(o!=null&&o.planTemplateId)return this.state.activePlanId=o.planTemplateId,{...o,planId:o.planTemplateId};throw console.error("[PlanExecutionManager] Failed to get planId from response:",o),new Error("Failed to get valid planId from API response")}catch(o){throw console.error("[PlanExecutionManager] API call failed:",o),o}}initiatePlanExecutionSequence(e,o){console.log(`[PlanExecutionManager] Starting plan execution sequence for query: "${e}", planId: ${o}`);const t=o;ot().setTaskRunning(o),console.log("[PlanExecutionManager] Task marked as running with planId:",o),this.emitDialogRoundStart(t),this.startPolling()}handlePlanCompletion(e){this.emitPlanCompleted(e.rootPlanId??""),this.state.lastSequenceSize=0,this.stopPolling();const o=ot();o.currentTask&&o.currentTask.isRunning&&(o.currentTask.isRunning=!1,console.log("[PlanExecutionManager] Task marked as completed"));try{setTimeout(async()=>{if(this.state.activePlanId)try{await ut.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}},5e3)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}e.completed&&(this.state.activePlanId=null,this.emitChatInputUpdateState(e.rootPlanId??""))}handlePlanError(e){this.emitPlanError(e.message??""),this.state.lastSequenceSize=0,this.stopPolling();const o=ot();o.currentTask&&o.currentTask.isRunning&&(o.currentTask.isRunning=!1,console.log("[PlanExecutionManager] Task marked as stopped due to error"));try{setTimeout(async()=>{if(this.state.activePlanId)try{await ut.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}},5e3)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}}async pollPlanStatus(){if(this.state.activePlanId){if(this.state.isPolling){console.log("[PlanExecutionManager] Previous polling still in progress, skipping");return}try{this.state.isPolling=!0;const e=await this.getPlanDetails(this.state.activePlanId);if(!e){console.warn("[PlanExecutionManager] No details received from API - this might be a temporary network issue");return}if(e.status&&e.status==="failed"&&e.message&&!e.message.includes("Failed to get detailed information")){this.handlePlanError(e);return}e.rootPlanId&&this.setCachedPlanRecord(e.rootPlanId,e),this.emitPlanUpdate(e.rootPlanId??""),e.completed&&this.handlePlanCompletion(e)}catch(e){console.error("[PlanExecutionManager] Failed to poll plan status:",e)}finally{this.state.isPolling=!1}}}async getPlanDetails(e){try{const o=await mt.getDetails(e);return o!=null&&o.rootPlanId&&(this.planExecutionCache.set(o.rootPlanId,o),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${o.rootPlanId}`)),o}catch(o){return console.error("[PlanExecutionManager] Failed to get plan details:",o),{currentPlanId:e,status:"failed",message:o instanceof Error?o.message:"Failed to get plan"}}}startPolling(){this.state.pollTimer&&clearInterval(this.state.pollTimer),this.state.pollTimer=window.setInterval(()=>{this.pollPlanStatus()},this.POLL_INTERVAL),console.log("[PlanExecutionManager] Started polling")}async pollPlanStatusImmediately(){console.log("[PlanExecutionManager] Polling plan status immediately"),await this.pollPlanStatus()}stopPolling(){this.state.pollTimer&&(clearInterval(this.state.pollTimer),this.state.pollTimer=null),console.log("[PlanExecutionManager] Stopped polling")}cleanup(){this.stopPolling(),this.state.activePlanId=null,this.state.lastSequenceSize=0,this.state.isPolling=!1,this.clearAllCachedRecords()}emitChatInputClear(){this.callbacks.onChatInputClear&&this.callbacks.onChatInputClear()}emitChatInputUpdateState(e){this.callbacks.onChatInputUpdateState&&this.callbacks.onChatInputUpdateState(e)}emitDialogRoundStart(e){this.callbacks.onDialogRoundStart&&this.callbacks.onDialogRoundStart(e)}emitPlanUpdate(e){this.callbacks.onPlanUpdate&&this.callbacks.onPlanUpdate(e)}emitPlanCompleted(e){this.callbacks.onPlanCompleted&&this.callbacks.onPlanCompleted(e)}emitPlanError(e){this.callbacks.onPlanError&&this.callbacks.onPlanError(e)}};ke(Ge,"instance",null);let Tt=Ge;const Ue=Tt.getInstance(),Ha={class:"chat-container"},Ja={key:0,class:"loading-message"},Wa={class:"loading-content"},za=["title"],Ka=be({__name:"ChatContainer",emits:["step-selected"],setup(n,{expose:e,emit:o}){const t=o,{t:a}=Ae(),{messages:l,isLoading:c,streamingMessageId:d,addMessage:m,updateMessage:u,startStreaming:h,stopStreaming:b,findMessage:F}=Va(),N=D(null),{scrollToBottom:A,autoScrollToBottom:P,showScrollToBottom:y}=Ga(N),v=D(),E=z=>d.value===z,$=he(()=>l.value.map(ja)),_=()=>{},f=z=>{const X=z.target;if(X.classList.contains("md-copy-btn")){const G=X.getAttribute("data-raw");if(G){const te=decodeURIComponent(G);navigator.clipboard.writeText(te).then(()=>{X.textContent=a("chat.copied"),setTimeout(()=>{X.textContent=a("chat.copy")},1e3)})}}},w=async z=>{const X=F(z);if(X)try{const G=X.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(G)}catch(G){console.error("Failed to copy message:",G)}},M=z=>{const X=F(z);X&&X.type==="assistant"&&(u(z,{content:""}),h(z))},q=z=>{F(z)&&(u(z,{content:""}),h(z))},k=z=>{console.log("[ChatContainer] Step selected:",z),t("step-selected",z)},x=z=>{console.log("[ChatContainer] Plan update received:",z);const X=Ue.getCachedPlanRecord(z);if(!X){console.warn("[ChatContainer] No cached plan data found for rootPlanId:",z);return}console.log("[ChatContainer] Retrieved plan details from cache:",X);const G=l.value.findIndex(te=>{var K;return((K=te.planExecution)==null?void 0:K.currentPlanId)===X.currentPlanId&&te.type==="assistant"});if(G!==-1){const te=l.value[G],K={planExecution:JSON.parse(JSON.stringify(X))};if(!X.agentExecutionSequence||X.agentExecutionSequence.length===0){if(console.log("[ChatContainer] Handling simple response without agent execution sequence"),X.completed){K.thinking="";const U=X.summary??X.result??X.message??"Execution completed";K.content=U,console.log("[ChatContainer] Set simple response content:",U)}}else console.log("[ChatContainer] Handling detailed plan with agent execution sequence");u(te.id,K)}},V=z=>{if(console.log("[ChatContainer] Plan completed:",z),z.rootPlanId){const X=l.value.findIndex(G=>{var te;return((te=G.planExecution)==null?void 0:te.currentPlanId)===z.rootPlanId});if(X!==-1){const G=l.value[X],te=z.summary??z.result??"Execution completed";u(G.id,{thinking:"",content:te}),console.log("[ChatContainer] Updated completed message:",te)}}},Z=z=>{console.log("[ChatContainer] Dialog round start:",z)},Y=z=>{console.log("[ChatContainer] Plan error:",z),m("assistant",`Error: ${z}`),console.error("[ChatContainer] Plan execution error:",z)};return Fe(()=>{fe(l,()=>{Ce(()=>{P()})},{deep:!0}),Ue.setEventCallbacks({onPlanUpdate:x,onPlanCompleted:V,onDialogRoundStart:Z,onPlanError:Y})}),Ie(()=>{v.value&&clearInterval(v.value)}),e({scrollToBottom:A,handlePlanUpdate:x,handlePlanCompleted:V,handleDialogRoundStart:Z,handlePlanError:Y,addMessage:m,updateMessage:u,startStreaming:h,stopStreaming:b}),(z,X)=>(p(),g("div",Ha,[s("div",{class:"messages",ref_key:"messagesRef",ref:N,onScroll:_,onClick:f},[(p(!0),g(ue,null,me($.value,G=>(p(),pe(Ba,{key:G.id,message:G,"is-streaming":E(G.id),onCopy:w,onRegenerate:M,onRetry:q,onStepSelected:k},null,8,["message","is-streaming"]))),128)),r(c)?(p(),g("div",Ja,[s("div",Wa,[T(r(R),{icon:"carbon:circle-dash",class:"loading-icon"}),s("span",null,i(z.$t("chat.processing")),1)])])):L("",!0)],544),T(Nt,{name:"scroll-button"},{default:Ke(()=>[r(y)?(p(),g("button",{key:0,class:"scroll-to-bottom",onClick:X[0]||(X[0]=()=>r(A)()),title:z.$t("chat.scrollToBottom")},[T(r(R),{icon:"carbon:chevron-down"})],8,za)):L("",!0)]),_:1})]))}}),Xa=ye(Ka,[["__scopeId","data-v-3aa5b9a4"]]);class Qa{constructor(){ke(this,"isCollapsed",!1);ke(this,"selectMemoryId","");ke(this,"loadMessages",()=>{});ke(this,"intervalId")}toggleSidebar(){this.isCollapsed=!this.isCollapsed,this.isCollapsed?(this.loadMessages(),this.intervalId=window.setInterval(()=>{this.loadMessages()},3e3)):clearInterval(this.intervalId)}selectMemory(e){this.toggleSidebar(),this.selectMemoryId=e}setMemory(e){this.selectMemoryId=e}defaultMemoryId(){this.selectMemoryId=this.generateRandomId()}clearMemoryId(){this.selectMemoryId=""}generateRandomId(){return Math.random().toString(36).substring(2,10)}setLoadMessages(e){this.loadMessages=e}}const Oe=nt(new Qa);class jt{static async uploadFiles(e){try{console.log("[FileUploadApiService] Uploading files:",e.length);const o=new FormData;e.forEach(l=>{o.append("files",l)});const t=await fetch("/api/file-upload/upload",{method:"POST",body:o});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();return console.log("[FileUploadApiService] Files uploaded successfully:",a.successfulFiles,"uploadKey:",a.uploadKey),a}catch(o){throw console.error("[FileUploadApiService] Error uploading files:",o),o}}static async getUploadedFiles(e){try{console.log("[FileUploadApiService] Getting uploaded files for uploadKey:",e);const o=await fetch(`/api/file-upload/files/${encodeURIComponent(e)}`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const t=await o.json();return console.log("[FileUploadApiService] Got uploaded files:",t.totalCount,"for uploadKey:",e),t}catch(o){throw console.error("[FileUploadApiService] Error getting uploaded files:",o),o}}static async deleteFile(e,o){try{console.log("[FileUploadApiService] Deleting file:",o,"from uploadKey:",e);const t=await fetch(`/api/file-upload/files/${encodeURIComponent(e)}/${encodeURIComponent(o)}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();return console.log("[FileUploadApiService] File deleted successfully:",a.success),a}catch(t){throw console.error("[FileUploadApiService] Error deleting file:",t),t}}static async getUploadConfig(){try{console.log("[FileUploadApiService] Getting upload configuration");const e=await fetch("/api/file-upload/config");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const o=await e.json();return console.log("[FileUploadApiService] Got upload configuration:",o),o}catch(e){throw console.error("[FileUploadApiService] Error getting upload configuration:",e),e}}}const Ya={class:"file-upload-component"},Za=["accept"],el={key:0},tl={key:1},ol={key:0,class:"files-list"},sl={class:"file-name"},nl={class:"file-size"},al=["onClick","title"],ll={key:0,class:"upload-progress"},rl=be({__name:"FileUploadComponent",props:{acceptedFileTypes:{default:".pdf,.txt,.md,.doc,.docx,.csv,.xlsx,.xls,.json,.xml,.html,.htm,.log,.java,.py,.js,.ts,.sql,.sh,.bat,.yaml,.yml,.properties,.conf,.ini,.jpg,.jpeg,.png,.gif"},disabled:{type:Boolean,default:!1}},emits:["files-uploaded","files-removed","upload-key-changed","upload-started","upload-completed","upload-error"],setup(n,{expose:e,emit:o}){const{t}=Ae(),a=n,l=o,c=D(),d=D([]),m=D(!1),u=D(null),h=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),d.value=[],u.value=null,l("upload-key-changed",null)};Ie(()=>{h()}),fe(()=>d.value,y=>{l("files-removed",y)},{deep:!0});const b=()=>{a.disabled||c.value&&c.value.click()},F=async y=>{const v=y.target,E=v.files;if(!E||E.length===0)return;const $=Array.from(E);console.log("[FileUpload] Selected files for upload:",$.map(_=>_.name)),await N($),v.value=""},N=async y=>{if(y.length!==0){m.value=!0,l("upload-started");try{const v=await jt.uploadFiles(y);v.success&&(!u.value&&v.uploadKey?(u.value=v.uploadKey,console.log("[FileUpload] Set uploadKey:",u.value),d.value=v.uploadedFiles):u.value?(console.log("[FileUpload] Using existing uploadKey:",u.value),d.value=[...d.value,...v.uploadedFiles]):(console.warn("[FileUpload] No uploadKey returned from upload"),d.value=v.uploadedFiles),v.uploadKey&&(u.value=v.uploadKey,console.log("[Input] Saved uploadKey locally:",v.uploadKey),l("upload-key-changed",u.value)),console.log("[Input] Updated global uploadedFiles state:",d.value),l("files-uploaded",d.value,u.value)),console.log("Files uploaded successfully:",v),l("upload-completed")}catch(v){console.error("File upload error:",v),l("upload-error",v)}finally{m.value=!1}}},A=async y=>{try{if(console.log("ðŸ—‘ï¸ Removing file:",y.originalName,"from uploadKey:",u),u.value){const v=await jt.deleteFile(u.value,y.originalName);v.success?console.log("âœ… File deleted from server successfully"):console.error("âŒ Failed to delete file from server:",v.error)}d.value=d.value.filter(v=>v.originalName!==y.originalName),d.value.length===0&&(console.log("[FileUpload] ðŸ§¹ Clearing uploadKey to force new plan for new files"),u.value=null,l("upload-key-changed",null)),console.log("ðŸŽ‰ File removal completed, remaining files:",d.value.length)}catch(v){console.error("âŒ Error removing file:",v),l("upload-error",v)}},P=y=>{if(y===0)return"0 Bytes";const v=1024,E=["Bytes","KB","MB","GB"],$=Math.floor(Math.log(y)/Math.log(v));return parseFloat((y/Math.pow(v,$)).toFixed(2))+" "+E[$]};return e({uploadedFiles:d,uploadKey:u,resetSession:h,uploadFiles:N,removeFile:A,isUploading:m}),(y,v)=>(p(),g("div",Ya,[s("input",{ref_key:"fileInputRef",ref:c,type:"file",multiple:"",style:{display:"none"},onChange:F,accept:y.acceptedFileTypes||""},null,40,Za),s("div",{class:le(["uploaded-files",{"has-files":d.value.length>0}])},[s("div",{class:"files-header",onClick:b},[T(r(R),{icon:"carbon:attachment"}),d.value.length===0?(p(),g("span",el,i(r(t)("input.attachFile")),1)):(p(),g("span",tl,i(r(t)("input.attachedFiles"))+" ("+i(d.value.length)+")",1))]),d.value.length>0?(p(),g("div",ol,[(p(!0),g(ue,null,me(d.value,E=>(p(),g("div",{key:E.originalName,class:"file-item"},[T(r(R),{icon:"carbon:document",class:"file-icon"}),s("span",sl,i(E.originalName),1),s("span",nl,"("+i(P(E.size))+")",1),s("button",{onClick:$=>A(E),class:"remove-btn",title:r(t)("input.removeFile")},[T(r(R),{icon:"carbon:close"})],8,al)]))),128))])):L("",!0)],2),m.value?(p(),g("div",ll,[T(r(R),{icon:"carbon:rotate--clockwise",class:"loading-icon"}),s("span",null,i(r(t)("input.uploading")),1)])):L("",!0)]))}}),ro=ye(rl,[["__scopeId","data-v-d1f7078c"]]),il={class:"input-area"},cl={class:"input-container"},dl=["placeholder","disabled"],ul=["title"],pl=["disabled","title"],hl=["title"],ml=be({__name:"InputArea",props:{placeholder:{default:""},disabled:{type:Boolean,default:!1},initialValue:{default:""}},emits:["send","clear","update-state","plan-mode-clicked"],setup(n,{expose:e,emit:o}){const{t}=Ae(),a=ot(),l=he(()=>a.hasRunningTask()),c=n,d=o,m=D(),u=D(),h=D(""),b=he(()=>c.placeholder||t("input.placeholder")),F=D(b.value),N=D([]),A=D(null),P=()=>{var G;console.log("[FileUpload] Resetting session and clearing uploadKey"),(G=u.value)==null||G.resetSession()};Ie(()=>{P()});const y=(G,te)=>{N.value=G.map(K=>K.originalName),A.value=te,console.log("[InputArea] Files uploaded:",G.length,"uploadKey:",te),N.value.length>0&&(F.value=t("input.filesAttached",{count:N.value.length}))},v=G=>{N.value=G.map(te=>te.originalName),console.log("[InputArea] Files removed, remaining:",G.length),N.value.length===0?F.value=b.value:F.value=t("input.filesAttached",{count:N.value.length})},E=G=>{A.value=G,console.log("[InputArea] Upload key changed:",G)},$=()=>{console.log("[InputArea] Upload started")},_=()=>{console.log("[InputArea] Upload completed")},f=G=>{console.error("[InputArea] Upload error:",G)},w=he(()=>!!c.disabled),M=()=>{Ce(()=>{m.value&&(m.value.style.height="auto",m.value.style.height=Math.min(m.value.scrollHeight,120)+"px")})},q=G=>{G.key==="Enter"&&!G.shiftKey&&(G.preventDefault(),k())},k=()=>{if(!h.value.trim()||w.value)return;const te={input:h.value.trim(),memoryId:Oe.selectMemoryId,uploadedFiles:N.value};A.value?(te.uploadKey=A.value,console.log("[InputArea] Including uploadKey in message:",A.value)):console.log("[InputArea] No uploadKey available for message"),d("send",te),Z()},x=()=>{d("plan-mode-clicked")},V=async()=>{console.log("[InputArea] Stop button clicked"),await a.stopCurrentTask()?console.log("[InputArea] Task stopped successfully"):console.error("[InputArea] Failed to stop task")},Z=()=>{h.value="",M(),d("clear")},Y=(G,te)=>{te&&(F.value=G?te:t("input.waiting")),d("update-state",G,te)},z=G=>{h.value=G,M()},X=()=>h.value.trim();return fe(()=>c.initialValue,G=>{G.trim()&&(h.value=G,M())},{immediate:!0}),e({clearInput:Z,updateState:Y,setInputValue:z,getQuery:X,resetSession:P,focus:()=>{var G;return(G=m.value)==null?void 0:G.focus()},get uploadedFiles(){var G,te;return((te=(G=u.value)==null?void 0:G.uploadedFiles)==null?void 0:te.map(K=>K.originalName))||[]},get uploadKey(){var G;return((G=u.value)==null?void 0:G.uploadKey)||null}}),Fe(()=>{}),Ie(()=>{}),(G,te)=>(p(),g("div",il,[T(ro,{ref_key:"fileUploadRef",ref:u,disabled:w.value,onFilesUploaded:y,onFilesRemoved:v,onUploadKeyChanged:E,onUploadStarted:$,onUploadCompleted:_,onUploadError:f},null,8,["disabled"]),s("div",cl,[de(s("textarea",{"onUpdate:modelValue":te[0]||(te[0]=K=>h.value=K),ref_key:"inputRef",ref:m,class:"chat-input",placeholder:F.value,disabled:w.value,onKeydown:q,onInput:M},null,40,dl),[[ve,h.value]]),s("button",{class:"plan-mode-btn",title:G.$t("input.planMode"),onClick:x},[T(r(R),{icon:"carbon:document"}),re(" "+i(G.$t("input.planMode")),1)],8,ul),l.value?(p(),g("button",{key:1,class:"send-button stop-button",onClick:V,title:G.$t("input.stop")},[T(r(R),{icon:"carbon:stop-filled"}),re(" "+i(G.$t("input.stop")),1)],8,hl)):(p(),g("button",{key:0,class:"send-button",disabled:!h.value.trim()||w.value,onClick:k,title:G.$t("input.send")},[T(r(R),{icon:"carbon:send-alt"}),re(" "+i(G.$t("input.send")),1)],8,pl))])]))}}),fl=ye(ml,[["__scopeId","data-v-f3b9d060"]]);class rt{static async handleResponse(e){if(!e.ok)try{const o=await e.json();throw new Error(o.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getMemories(){try{const e=await fetch(`${this.BASE_URL}`);return(await(await this.handleResponse(e)).json()).memories??[]}catch(e){throw console.error("Failed to get memory list:",e),e}}static async getMemory(e){try{const o=await fetch(`${this.BASE_URL}/single?conversationId=${e}`),a=await(await this.handleResponse(o)).json();if(!a.data)throw new Error("Memory not found");return a.data}catch(o){throw console.error("Failed to get memory:",o),o}}static async createMemory(e,o){try{const t=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,memory_name:o})}),l=await(await this.handleResponse(t)).json();if(!l.data)throw new Error("Failed to create memory");return l.data}catch(t){throw console.error("Failed to create memory:",t),t}}static async updateMemory(e,o){try{const t=await fetch(`${this.BASE_URL}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,memory_name:o})}),l=await(await this.handleResponse(t)).json();if(!l.data)throw new Error("Failed to update memory");return l.data}catch(t){throw console.error("Failed to update memory:",t),t}}static async deleteMemory(e){try{const o=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE"});await this.handleResponse(o)}catch(o){throw console.error("Failed to delete memory:",o),o}}static async generateConversationId(){try{const e=await fetch(`${this.BASE_URL}/generate-id`),t=await(await this.handleResponse(e)).json();if(!t.data)throw new Error("Failed to generate conversation ID");return t.data}catch(e){throw console.error("Failed to generate conversation ID:",e),e}}}ke(rt,"BASE_URL","/api/memories");const gl={key:0,class:"app-container"},vl={class:"app-content"},bl={class:"header"},yl={class:"relative"},_l={class:"title-edit-group"},Sl={id:"main-title",class:"main-title"},wl={key:0,id:"title-edit-container",class:"title-edit-container"},$l={class:"search-bar"},Pl={class:"search-container"},kl=["placeholder"],El={class:"message-list",id:"message-list"},Cl={class:"message-header"},Tl={class:"message-content"},Rl={class:"sender-info"},Il=["onClick"],Al={class:"sender-name"},xl=["onClick"],Ml={class:"action-buttons"},Fl=["onClick"],Dl={class:"action-buttons"},Nl=["onClick"],Ul={class:"message-preview"},Ll={class:"preview-line"},Ol={key:0,class:"preview-line",style:{opacity:"0.8"}},Bl={class:"message-meta"},ql={class:"message-id"},jl={class:"meta-right"},Vl={key:0,class:"unread-count"},Gl={class:"message-time"},Hl=["id"],Jl={style:{display:"flex","flex-direction":"column",gap:"0.75rem"}},Wl={class:"bubble-avatar"},zl={class:"bubble-content"},Kl={class:"bubble-text"},Xl={key:0,class:"empty-state"},Ql={class:"modal-content"},Yl={class:"modal-header"},Zl={class:"modal-title"},er=["placeholder"],tr={id:"name-char-count",class:"char-count",style:{"text-align":"right",display:"block","margin-top":"0.25rem"}},or={class:"modal-footer"},sr={class:"modal-content"},nr={class:"modal-header"},ar={class:"modal-title"},lr={class:"state-text",id:"delete-message"},rr={class:"modal-footer"},ir=be({__name:"Memory",emits:["memory-selected"],setup(n,{emit:e}){const o=D(!1),t=D(""),a=D([]),l=D([]),c=D(!1),d=D(null),m=D(""),u=D(!1),h=D(null),b=new Map,F=e,N=k=>{k.key==="Escape"&&(u.value?M():c.value&&$())};Fe(()=>{Oe.setLoadMessages(A),document.addEventListener("keydown",N)}),Ie(()=>{document.removeEventListener("keydown",N)});const A=async()=>{try{const k=await rt.getMemories();a.value=k.map(x=>({...x,expanded:b.has(x.conversation_id)?b.get(x.conversation_id):!1})),l.value=[...a.value],v()}catch(k){console.error("error:",k),a.value=[],l.value=[]}},P=k=>{Oe.selectMemory(k),F("memory-selected")},y=k=>{const x=typeof k=="string"?parseInt(k,10):k;return isNaN(x)||x<=0?"unknow time":new Date(x.toString().length===13?x:x*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(","," ")},v=()=>{const k=t.value.toLowerCase().trim();if(!k){l.value=[...a.value];return}l.value=a.value.filter(x=>{var z;const V=x.memory_name.toLowerCase().includes(k),Z=x.conversation_id.toLowerCase().includes(k),Y=((z=x.messages)==null?void 0:z.some(X=>X.text.toLowerCase().includes(k)))??!1;return V||Z||Y})},E=(k,x)=>{d.value=k,m.value=x,c.value=!0},$=()=>{c.value=!1,d.value=null},_=async()=>{if(!d.value)return;const k=m.value.trim()||"unknow name",x=a.value.findIndex(V=>V.conversation_id===d.value);if(x!==-1){const V=a.value[x];try{const Z=await rt.updateMemory(V.conversation_id,k);Z.messages||(Z.messages=[]),a.value[x]={...Z,expanded:V.expanded},v(),c.value=!1}catch(Z){console.error("error:",Z)}}},f=k=>{const x=a.value.find(V=>V.conversation_id===k);if(x){x.expanded=!x.expanded,b.set(k,x.expanded);const V=l.value.findIndex(Z=>Z.conversation_id===k);V!==-1&&(l.value[V]={...x})}},w=k=>{h.value=k,u.value=!0},M=()=>{u.value=!1,h.value=null},q=async()=>{if(h.value)try{await rt.deleteMemory(h.value),a.value=a.value.filter(k=>k.conversation_id!==h.value),v(),a.value.length===0&&Oe.clearMemoryId(),u.value=!1,h.value=null}catch(k){console.error("error:",k)}};return(k,x)=>(p(),pe(Oo,{to:"body"},[T(Nt,{name:"modal"},{default:Ke(()=>[r(Oe).isCollapsed?(p(),g("div",gl,[s("div",vl,[s("div",bl,[s("div",yl,[s("div",_l,[s("h1",Sl,[s("span",null,i(k.$t("memory.title")),1)])]),o.value?(p(),g("div",wl)):L("",!0)]),s("button",{class:"close-btn",onClick:x[0]||(x[0]=V=>r(Oe).toggleSidebar())},[T(r(R),{icon:"carbon:close"})])]),s("div",$l,[s("div",Pl,[T(r(R),{class:"search-container-icon",icon:"carbon:search"}),de(s("input",{type:"text",placeholder:k.$t("memory.searchPlaceholder"),class:"search-input","onUpdate:modelValue":x[1]||(x[1]=V=>t.value=V),onInput:v},null,40,kl),[[ve,t.value]])])]),s("div",El,[s("div",null,[(p(!0),g(ue,null,me(l.value,V=>(p(),g("div",{class:le(["message-item",{expanded:V.expanded}]),key:V.conversation_id},[s("div",Cl,[s("div",Tl,[s("div",Rl,[s("div",{class:"sender-div",onClick:Se(Z=>P(V.conversation_id),["stop"])},[s("h3",Al,i(V.memory_name),1)],8,Il),s("div",{class:"toggle-container",onClick:Se(Z=>E(V.conversation_id,V.memory_name),["stop"])},[T(r(R),{icon:"carbon:edit",class:"edit-btn"})],8,xl),s("div",Ml,[s("button",{class:"delete-btn",onClick:Se(Z=>f(V.conversation_id),["stop"])},[T(r(R),{id:"toggle-"+V.conversation_id,icon:"carbon:chevron-down",class:"down-btn"},null,8,["id"])],8,Fl)]),s("div",Dl,[s("button",{class:"delete-btn",onClick:Se(Z=>w(V.conversation_id),["stop"])},[T(r(R),{icon:"carbon:delete"})],8,Nl)])]),s("div",Ul,[s("p",Ll,i(V.messages&&V.messages.length>0?V.messages[0].text:"none message"),1),V.messages&&V.messages.length>1?(p(),g("p",Ol,i(V.messages[1].text),1)):L("",!0)]),s("div",Bl,[s("span",ql,"ID: "+i(V.conversation_id),1),s("div",jl,[V.messages&&V.messages.length>0?(p(),g("span",Vl,i(V.messages.length)+" "+i(k.$t("memory.size")),1)):L("",!0),s("span",Gl,i(y(V.create_time)),1)])])])]),V.expanded?(p(),g("div",{key:0,id:"content-"+V.conversation_id,class:"expanded-content"},[s("div",Jl,[(p(!0),g(ue,null,me(V.messages,(Z,Y)=>(p(),g("div",{class:"message-bubble",key:Y},[s("div",Wl,i(Z.messageType),1),s("div",zl,[s("p",Kl,i(Z.text),1)])]))),128))])],8,Hl)):L("",!0)],2))),128))]),l.value.length===0&&t.value?(p(),g("div",Xl,x[3]||(x[3]=[s("p",{class:"state-text"},"none message",-1)]))):L("",!0)]),c.value?(p(),g("div",{key:0,id:"name-edit-modal",class:"modal-overlay",onClick:Se($,["self"])},[s("div",Ql,[s("div",Yl,[s("h3",Zl,i(k.$t("memory.changeName")),1),de(s("input",{type:"text","onUpdate:modelValue":x[2]||(x[2]=V=>m.value=V),class:"edit-input",placeholder:k.$t("memory.newNamePlaceholder")},null,8,er),[[ve,m.value]]),s("span",tr,i(m.value.length),1)]),s("div",or,[s("button",{id:"cancel-name",class:"modal-btn cancel-btn",onClick:$},i(k.$t("memory.cancel")),1),s("button",{id:"save-name",class:"modal-btn confirm-btn",onClick:_},i(k.$t("memory.save")),1)])])])):L("",!0),u.value?(p(),g("div",{key:1,id:"delete-modal",class:"modal-overlay",onClick:Se(M,["self"])},[s("div",sr,[s("div",nr,[s("h3",ar,i(k.$t("memory.deleteHint")),1),s("p",lr,i(k.$t("memory.deleteHintPrefix"))+" "+i(h.value)+" "+i(k.$t("memory.deleteHintSuffix")),1)]),s("div",rr,[s("button",{id:"cancel-delete",class:"modal-btn cancel-btn",onClick:M},i(k.$t("memory.cancel")),1),s("button",{id:"confirm-delete",class:"modal-btn delete-btn-confirm",onClick:q},i(k.$t("memory.delete")),1)])])])):L("",!0)])])):L("",!0)]),_:1})]))}}),cr=ye(ir,[["__scopeId","data-v-4dca2d9f"]]),dr="/api/executor";async function io(n){try{const e=await fetch(`${dr}/agent-execution/${n}`);if(!e.ok){if(e.status===404)return console.warn(`Agent execution detail not found for stepId: ${n}`),null;throw new Error(`HTTP error! status: ${e.status}`)}return await e.json()}catch(e){return console.error(`Error fetching agent execution detail for stepId: ${n}:`,e),null}}async function ur(n){return console.log(`Refreshing agent execution detail for stepId: ${n}`),io(n)}class Ve{static async handleResponse(e){if(!e.ok)try{const o=await e.json();throw new Error(o.message??`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getFileTree(e){try{const o=await fetch(`${this.BASE_URL}/tree/${e}`),a=await(await this.handleResponse(o)).json();if(!a.success)throw new Error(a.message??"Failed to get file tree");return a.data}catch(o){throw console.error("Failed to get file tree:",o),o}}static async getFileContent(e,o){try{const t=await fetch(`${this.BASE_URL}/content/${e}?path=${encodeURIComponent(o)}`),l=await(await this.handleResponse(t)).json();if(!l.success)throw new Error(l.message??"Failed to get file content");return l.data}catch(t){throw console.error("Failed to get file content:",t),t}}static async downloadFile(e,o,t){try{const a=await fetch(`${this.BASE_URL}/download/${e}?path=${encodeURIComponent(o)}`);await this.handleResponse(a);const l=await a.blob(),c=window.URL.createObjectURL(l),d=document.createElement("a");d.href=c,d.download=t??o.split("/").pop()??"download",document.body.appendChild(d),d.click(),window.URL.revokeObjectURL(c),document.body.removeChild(d)}catch(a){throw console.error("Failed to download file:",a),a}}static isTextFile(e,o){const t=["text/","application/json","application/xml","application/javascript","application/typescript"],a=[".txt",".md",".json",".xml",".html",".css",".js",".ts",".vue",".jsx",".tsx",".py",".java",".cpp",".c",".h",".sh",".bat",".yml",".yaml",".properties",".conf",".cfg"];if(t.some(c=>e.startsWith(c)))return!0;const l=o.toLowerCase();return a.some(c=>l.endsWith(c))}static getFileIcon(e){if(e.type==="directory")return"carbon:folder";const o=e.name.toLowerCase();return o.endsWith(".js")?"vscode-icons:file-type-js":o.endsWith(".ts")?"vscode-icons:file-type-typescript":o.endsWith(".vue")?"vscode-icons:file-type-vue":o.endsWith(".java")?"vscode-icons:file-type-java":o.endsWith(".py")?"vscode-icons:file-type-python":o.endsWith(".json")?"vscode-icons:file-type-json":o.endsWith(".xml")?"vscode-icons:file-type-xml":o.endsWith(".html")?"vscode-icons:file-type-html":o.endsWith(".css")?"vscode-icons:file-type-css":o.endsWith(".md")?"vscode-icons:file-type-markdown":o.endsWith(".yml")||o.endsWith(".yaml")?"vscode-icons:file-type-yaml":o.endsWith(".pdf")?"vscode-icons:file-type-pdf2":o.endsWith(".doc")||o.endsWith(".docx")?"vscode-icons:file-type-word":o.endsWith(".xls")||o.endsWith(".xlsx")?"vscode-icons:file-type-excel":o.endsWith(".ppt")||o.endsWith(".pptx")?"vscode-icons:file-type-powerpoint":o.match(/\.(jpg|jpeg|png|gif|bmp|svg)$/)?"carbon:image":o.match(/\.(zip|rar|7z|tar|gz)$/)?"carbon:archive":"carbon:document"}}ke(Ve,"BASE_URL","/api/file-browser");const pr={class:"file-tree-node"},hr={class:"node-icon"},mr={class:"node-name"},fr={key:1,class:"file-size"},gr={key:2,class:"node-actions"},vr={key:0,class:"children"},br=be({__name:"FileTreeNode",props:{node:{},level:{}},emits:["file-selected","download-file"],setup(n,{emit:e}){const o=n,t=e,a=D(o.level===0),l=D(!1),c=D(!1),d=D({}),m=()=>{o.node.type==="directory"&&(a.value=!a.value)},u=()=>{o.node.type==="directory"?m():h()},h=()=>{o.node.type==="file"&&t("file-selected",o.node),N()},b=()=>{t("download-file",o.node),N()},F=v=>{v.preventDefault(),c.value=!0,d.value={position:"fixed",top:`${v.clientY}px`,left:`${v.clientX}px`,zIndex:1e3},setTimeout(()=>{document.addEventListener("click",N)},0)},N=()=>{c.value=!1,document.removeEventListener("click",N)},A=async()=>{try{await navigator.clipboard.writeText(o.node.path)}catch(v){console.error("Failed to copy path:",v)}N()},P=()=>o.node.type==="directory"?a.value?"carbon:folder-open":"carbon:folder":Ve.getFileIcon(o.node),y=v=>{if(v===0)return"0 B";const E=1024,$=["B","KB","MB","GB"],_=Math.floor(Math.log(v)/Math.log(E));return parseFloat((v/Math.pow(E,_)).toFixed(1))+" "+$[_]};return Ie(()=>{document.removeEventListener("click",N)}),(v,E)=>{const $=oo("FileTreeNode",!0);return p(),g("div",pr,[s("div",{class:le(["node-content",{"is-directory":v.node.type==="directory","is-file":v.node.type==="file","is-expanded":a.value}]),style:ze({paddingLeft:`${v.level*16+12}px`}),onClick:u,onContextmenu:Se(F,["prevent"])},[v.node.type==="directory"?(p(),g("div",{key:0,class:"expand-icon",onClick:Se(m,["stop"])},[T(r(R),{icon:a.value?"carbon:chevron-down":"carbon:chevron-right",class:"chevron-icon"},null,8,["icon"])])):L("",!0),s("div",hr,[T(r(R),{icon:P()},null,8,["icon"])]),s("span",mr,i(v.node.name),1),v.node.type==="file"?(p(),g("span",fr,i(y(v.node.size)),1)):L("",!0),l.value?(p(),g("div",gr,[v.node.type==="file"?(p(),g("button",{key:0,onClick:E[0]||(E[0]=Se(_=>v.$emit("download-file",v.node),["stop"])),class:"action-btn download-btn",title:"Download"},[T(r(R),{icon:"carbon:download"})])):L("",!0)])):L("",!0)],38),v.node.type==="directory"&&a.value&&v.node.children?(p(),g("div",vr,[(p(!0),g(ue,null,me(v.node.children,_=>(p(),pe($,{key:_.path,node:_,level:v.level+1,onFileSelected:E[1]||(E[1]=f=>v.$emit("file-selected",f)),onDownloadFile:E[2]||(E[2]=f=>v.$emit("download-file",f))},null,8,["node","level"]))),128))])):L("",!0),c.value?(p(),g("div",{key:1,class:"context-menu",style:ze(d.value),onClick:E[3]||(E[3]=Se(()=>{},["stop"]))},[s("div",{class:"context-menu-item",onClick:h},[T(r(R),{icon:"carbon:view"}),E[4]||(E[4]=s("span",null,"Open",-1))]),v.node.type==="file"?(p(),g("div",{key:0,class:"context-menu-item",onClick:b},[T(r(R),{icon:"carbon:download"}),E[5]||(E[5]=s("span",null,"Download",-1))])):L("",!0),E[7]||(E[7]=s("div",{class:"context-menu-divider"},null,-1)),s("div",{class:"context-menu-item",onClick:A},[T(r(R),{icon:"carbon:copy"}),E[6]||(E[6]=s("span",null,"Copy Path",-1))])],4)):L("",!0)])}}}),yr=ye(br,[["__scopeId","data-v-e4a376d5"]]),_r={class:"file-browser"},Sr={class:"file-browser-header"},wr={class:"header-actions"},$r=["disabled","title"],Pr={class:"file-browser-content"},kr={class:"file-tree-panel"},Er={key:0,class:"loading-state"},Cr={key:1,class:"error-state"},Tr={key:0,class:"waiting-for-files"},Rr={class:"message-content"},Ir={class:"tips"},Ar=["disabled"],xr={key:1,class:"actual-error"},Mr={key:2,class:"empty-state"},Fr={key:3,class:"file-tree"},Dr={key:0,class:"file-content-panel"},Nr={class:"file-content-header"},Ur={class:"file-info"},Lr={class:"file-name"},Or={class:"file-size"},Br={class:"file-actions"},qr=["title"],jr=["title"],Vr={class:"file-content-body"},Gr={key:0,class:"loading-content"},Hr={key:1,class:"content-error"},Jr={key:2,class:"file-content"},Wr={key:0,class:"text-content"},zr={key:1,class:"binary-content"},Kr=be({__name:"index",props:{planId:{}},setup(n){const e=n,{t:o}=Ae(),t=D(!1),a=D(null),l=D(null),c=D(null),d=D(null),m=D(!1),u=D(null),h=D(null),b=he(()=>!d.value||!c.value?!1:Ve.isTextFile(d.value.mimeType,c.value.name)),F=he(()=>a.value&&(a.value.includes("Plan directory not found")||a.value.includes("not found"))),N=()=>{h.value&&(clearTimeout(h.value),h.value=null)},A=()=>{N(),h.value=window.setTimeout(()=>{F.value&&P()},5e3)},P=async()=>{if(e.planId){t.value=!0,a.value=null,N();try{l.value=await Ve.getFileTree(e.planId)}catch(f){a.value=f instanceof Error?f.message:o("fileBrowser.loadError"),console.error("Failed to load file tree:",f);const w=f instanceof Error?f.message:"";(w.includes("Plan directory not found")||w.includes("not found"))&&A()}finally{t.value=!1}}},y=async f=>{if(f.type!=="directory"){c.value=f,d.value=null,m.value=!0,u.value=null;try{d.value=await Ve.getFileContent(e.planId,f.path)}catch(w){u.value=w instanceof Error?w.message:o("fileBrowser.contentLoadError"),console.error("Failed to load file content:",w)}finally{m.value=!1}}},v=async f=>{try{await Ve.downloadFile(e.planId,f.path,f.name)}catch(w){console.error("Failed to download file:",w)}},E=()=>{c.value=null,d.value=null,u.value=null},$=f=>Ve.getFileIcon(f),_=f=>{if(f===0)return"0 B";const w=1024,M=["B","KB","MB","GB"],q=Math.floor(Math.log(f)/Math.log(w));return parseFloat((f/Math.pow(w,q)).toFixed(1))+" "+M[q]};return fe(()=>e.planId,f=>{f&&(c.value=null,d.value=null,P())},{immediate:!0}),Fe(()=>{e.planId&&P()}),Ie(()=>{N()}),(f,w)=>(p(),g("div",_r,[s("div",Sr,[s("h3",null,i(f.$t("fileBrowser.title")),1),s("div",wr,[s("button",{class:"refresh-btn",onClick:P,disabled:t.value,title:f.$t("fileBrowser.refresh")},[T(r(R),{icon:"carbon:refresh",class:le({rotating:t.value}),style:{color:"#ffffff",fontSize:"18px",width:"18px",height:"18px"}},null,8,["class"])],8,$r)])]),s("div",Pr,[s("div",kr,[t.value?(p(),g("div",Er,[T(r(R),{icon:"carbon:loading",class:"rotating"}),s("span",null,i(f.$t("fileBrowser.loading")),1)])):a.value?(p(),g("div",Cr,[F.value?(p(),g("div",Tr,[T(r(R),{icon:"carbon:time",class:"rotating"}),s("div",Rr,[s("h3",null,i(f.$t("fileBrowser.waitingForGeneration")),1),s("p",null,i(f.$t("fileBrowser.planExecuting")),1),s("div",Ir,[T(r(R),{icon:"carbon:information"}),s("span",null,i(f.$t("fileBrowser.filesTip")),1)])]),s("button",{onClick:P,class:"retry-btn",disabled:t.value},[T(r(R),{icon:"carbon:refresh",class:le({rotating:t.value})},null,8,["class"]),re(" "+i(t.value?f.$t("fileBrowser.checking"):f.$t("fileBrowser.checkNow")),1)],8,Ar)])):(p(),g("div",xr,[T(r(R),{icon:"carbon:warning"}),s("span",null,i(a.value),1),s("button",{onClick:P,class:"retry-btn"},i(f.$t("fileBrowser.retry")),1)]))])):l.value?(p(),g("div",Fr,[T(yr,{node:l.value,level:0,onFileSelected:y,onDownloadFile:v},null,8,["node"])])):(p(),g("div",Mr,[T(r(R),{icon:"carbon:folder-off"}),s("span",null,i(f.$t("fileBrowser.noFiles")),1)]))]),c.value?(p(),g("div",Dr,[s("div",Nr,[s("div",Ur,[T(r(R),{icon:$(c.value)},null,8,["icon"]),s("span",Lr,i(c.value.name),1),s("span",Or,"("+i(_(c.value.size))+")",1)]),s("div",Br,[s("button",{onClick:w[0]||(w[0]=M=>v(c.value)),class:"download-btn",title:f.$t("fileBrowser.download")},[T(r(R),{icon:"carbon:download"})],8,qr),s("button",{onClick:E,class:"close-btn",title:f.$t("common.close")},[T(r(R),{icon:"carbon:close"})],8,jr)])]),s("div",Vr,[m.value?(p(),g("div",Gr,[T(r(R),{icon:"carbon:loading",class:"rotating"}),s("span",null,i(f.$t("fileBrowser.loadingContent")),1)])):u.value?(p(),g("div",Hr,[T(r(R),{icon:"carbon:warning"}),s("span",null,i(u.value),1)])):d.value?(p(),g("div",Jr,[b.value?(p(),g("div",Wr,[s("pre",null,[s("code",null,i(d.value.content),1)])])):(p(),g("div",zr,[T(r(R),{icon:"carbon:document-unknown"}),s("p",null,i(f.$t("fileBrowser.binaryFile")),1),s("button",{onClick:w[1]||(w[1]=M=>v(c.value)),class:"download-btn-large"},[T(r(R),{icon:"carbon:download"}),re(" "+i(f.$t("fileBrowser.downloadToView")),1)])]))])):L("",!0)])])):L("",!0)])]))}}),Xr=ye(Kr,[["__scopeId","data-v-e7c74fe4"]]),Qr={class:"right-panel"},Yr={class:"preview-header"},Zr={class:"preview-tabs"},ei={class:"preview-content"},ti={key:0,class:"step-details"},oi={key:0,class:"step-info"},si={key:0,class:"agent-info"},ni={class:"info-item"},ai={class:"label"},li={class:"value"},ri={class:"info-item"},ii={class:"label"},ci={class:"value"},di={class:"info-item"},ui={class:"label"},pi={class:"execution-status"},hi={class:"status-item"},mi={class:"status-text"},fi={key:0},gi={key:0,class:"think-act-steps"},vi={class:"steps-container"},bi={class:"step-header"},yi={class:"step-number"},_i={class:"think-section"},Si={class:"think-content"},wi={class:"input"},$i={class:"label"},Pi={class:"output"},ki={class:"label"},Ei={key:0,class:"action-section"},Ci={class:"action-content"},Ti={class:"tool-info"},Ri={class:"label"},Ii={class:"value"},Ai={class:"input"},xi={class:"label"},Mi={class:"output"},Fi={class:"label"},Di={key:0,class:"sub-plan-section"},Ni={class:"sub-plan-content"},Ui={class:"sub-plan-header"},Li={class:"sub-plan-info"},Oi={class:"label"},Bi={class:"value"},qi={key:0,class:"sub-plan-info"},ji={class:"label"},Vi={class:"value"},Gi={class:"sub-plan-status"},Hi={class:"status-text"},Ji={key:0,class:"no-steps-message"},Wi={key:1,class:"no-execution-message"},zi={class:"step-basic-info"},Ki={class:"info-item"},Xi={class:"label"},Qi={class:"value"},Yi={key:0,class:"info-item"},Zi={class:"label"},ec={class:"value"},tc={class:"info-item"},oc={class:"label"},sc={class:"no-execution-hint"},nc={key:2,class:"execution-indicator"},ac={class:"execution-text"},lc={key:1,class:"no-selection"},rc=["title"],ic={key:1,class:"file-browser-container"},cc={key:1,class:"no-plan-message"},dc={class:"message-content"},uc={class:"tips"},pc=be({__name:"RightPanel",props:{currentRootPlanId:{},selectedStepId:{}},setup(n,{expose:e}){const o=n,{t}=Ae(),a=D(),l=D(),c=D("details"),d=D(localStorage.getItem("jmanus-last-plan-id")),m=D(localStorage.getItem("jmanus-has-executed-plan")==="true"),u=D(!1),h=D(!0),b=D(!0),F=he(()=>l.value?l.value.completed?t("rightPanel.status.completed"):l.value.current?t("rightPanel.status.executing"):t("rightPanel.status.waiting"):""),N=he(()=>o.currentRootPlanId?o.currentRootPlanId:d.value),A=he(()=>!N.value&&!m.value),P=async k=>{var x,V,Z;if(console.log("[RightPanel] Step selected:",{stepId:k}),!k){console.warn("[RightPanel] No stepId provided"),l.value=null;return}try{const Y=await io(k);if(!Y){console.warn("[RightPanel] Agent execution detail not found for stepId:",k),l.value=null;return}const z={stepId:k,title:Y.agentName??`Step ${k}`,description:Y.agentDescription??"",agentExecution:Y,completed:Y.status==="FINISHED",current:Y.status==="RUNNING"};l.value=z,console.log("[RightPanel] Step details updated:",z),console.log("[RightPanel] activeTab:",c.value),console.log("[RightPanel] selectedStep.value:",l.value),console.log("[RightPanel] agentExecution:",l.value.agentExecution),console.log("[RightPanel] thinkActSteps:",(x=l.value.agentExecution)==null?void 0:x.thinkActSteps),console.log("[RightPanel] thinkActSteps length:",(Z=(V=l.value.agentExecution)==null?void 0:V.thinkActSteps)==null?void 0:Z.length),await Ce(),console.log("[RightPanel] After nextTick - selectedStep:",l.value),setTimeout(()=>{E()},100),_()}catch(Y){console.error("[RightPanel] Error fetching step details:",Y),l.value=null}},y=async()=>{var k;if(!((k=l.value)!=null&&k.stepId)){console.warn("[RightPanel] No step selected for refresh");return}console.log("[RightPanel] Refreshing current step:",l.value.stepId);try{const x=await ur(l.value.stepId);x&&(l.value.agentExecution=x,l.value.completed=x.status==="FINISHED",l.value.current=x.status==="RUNNING",console.log("[RightPanel] Step refreshed successfully"),_())}catch(x){console.error("[RightPanel] Error refreshing step:",x)}};fe(()=>o.selectedStepId,async k=>{k?await P(k):l.value=null},{immediate:!0});const v=k=>{a.value=k??void 0},E=()=>{if(!a.value)return;const{scrollTop:k,scrollHeight:x,clientHeight:V}=a.value,Z=x-k-V<50,Y=x>V;h.value=Z,u.value=Y&&!Z,Z?b.value=!0:x-k-V>100&&(b.value=!1),console.log("[RightPanel] Scroll state check:",{scrollTop:k,scrollHeight:x,clientHeight:V,isAtBottom:Z,hasScrollableContent:Y,showButton:u.value,shouldAutoScroll:b.value})},$=()=>{a.value&&(a.value.scrollTo({top:a.value.scrollHeight,behavior:"smooth"}),Ce(()=>{b.value=!0,E()}))},_=()=>{!b.value||!a.value||Ce(()=>{a.value&&(a.value.scrollTop=a.value.scrollHeight,console.log("[RightPanel] Auto scroll to bottom"))})},f=k=>{if(k===null||typeof k>"u"||k==="")return"N/A";try{const x=typeof k=="object"?k:JSON.parse(k);return JSON.stringify(x,null,2)}catch{return String(k)}},w=()=>{l.value=null,b.value=!0,a.value&&a.value.removeEventListener("scroll",E)},M=()=>{const k=()=>{const x=a.value;return x?(v(x),x.addEventListener("scroll",E),b.value=!0,E(),console.log("[RightPanel] Scroll listener initialized successfully"),!0):(console.log("[RightPanel] Scroll container not found, retrying..."),!1)};Ce(()=>{k()||setTimeout(()=>{k()},100)})};return fe(()=>o.currentRootPlanId,(k,x)=>{k&&k!==x?(d.value=k,m.value=!0,localStorage.setItem("jmanus-last-plan-id",k),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] New plan started:",k)):!k&&x&&console.log("[RightPanel] Plan execution finished, keeping last plan:",d.value)},{immediate:!0}),Fe(()=>{console.log("[RightPanel] Component mounted"),Ce(()=>{M()})}),Ie(()=>{console.log("[RightPanel] Component unmounting, cleaning up..."),w()}),e({handleStepSelected:P,refreshCurrentStep:y,updateDisplayedPlanProgress:k=>{console.log("[RightPanel] updateDisplayedPlanProgress called with rootPlanId:",k),k&&(d.value=k,m.value=!0,localStorage.setItem("jmanus-last-plan-id",k),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] Plan progress updated:",k))}}),(k,x)=>{var V,Z;return p(),g("div",Qr,[s("div",Yr,[s("div",Zr,[s("div",{class:le(["tab-item",{active:c.value==="details"}]),onClick:x[0]||(x[0]=Y=>c.value="details")},[T(r(R),{icon:"carbon:events"}),s("span",null,i(r(t)("rightPanel.stepExecutionDetails")),1)],2),s("div",{class:le(["tab-item",{active:c.value==="files"}]),onClick:x[1]||(x[1]=Y=>c.value="files")},[T(r(R),{icon:"carbon:folder"}),s("span",null,i(r(t)("fileBrowser.title")),1)],2)])]),s("div",ei,[c.value==="details"?(p(),g("div",ti,[l.value?(p(),g("div",oi,[s("h3",null,i(l.value.title||l.value.description||r(t)("rightPanel.defaultStepTitle",{number:1})),1),l.value.agentExecution?(p(),g("div",si,[s("div",ni,[s("span",ai,i(r(t)("rightPanel.executingAgent"))+":",1),s("span",li,i(l.value.agentExecution.agentName),1)]),s("div",ri,[s("span",ii,i(r(t)("rightPanel.callingModel"))+":",1),s("span",ci,i(l.value.agentExecution.modelName),1)]),s("div",di,[s("span",ui,i(r(t)("rightPanel.executionResult"))+":",1),s("span",{class:le(["value",{success:l.value.agentExecution.status==="FINISHED"}])},i(l.value.agentExecution.status||r(t)("rightPanel.executing")),3)])])):L("",!0),s("div",pi,[s("div",hi,[l.value.completed?(p(),pe(r(R),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):l.value.current?(p(),pe(r(R),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})):(p(),pe(r(R),{key:2,icon:"carbon:time",class:"status-icon pending"})),s("span",mi,i(F.value),1)])])])):L("",!0),s("div",{ref_key:"scrollContainer",ref:a,class:"step-details-scroll-container",onScroll:E},[l.value?(p(),g("div",fi,[(V=l.value.agentExecution)!=null&&V.thinkActSteps&&l.value.agentExecution.thinkActSteps.length>0?(p(),g("div",gi,[s("h4",null,i(r(t)("rightPanel.thinkAndActionSteps")),1),s("div",vi,[(p(!0),g(ue,null,me(l.value.agentExecution.thinkActSteps,(Y,z)=>(p(),g("div",{key:z,class:"think-act-step"},[s("div",bi,[s("span",yi,"#"+i(z+1),1),s("span",{class:le(["step-status",Y.status])},i(Y.status||r(t)("rightPanel.executing")),3)]),s("div",_i,[s("h5",null,[T(r(R),{icon:"carbon:thinking"}),re(" "+i(r(t)("rightPanel.thinking")),1)]),s("div",Si,[s("div",wi,[s("span",$i,i(r(t)("rightPanel.input"))+":",1),s("pre",null,i(f(Y.thinkInput)),1)]),s("div",Pi,[s("span",ki,i(r(t)("rightPanel.output"))+":",1),s("pre",null,i(f(Y.thinkOutput)),1)])])]),Y.actionNeeded?(p(),g("div",Ei,[s("h5",null,[T(r(R),{icon:"carbon:play"}),re(" "+i(r(t)("rightPanel.action")),1)]),s("div",Ci,[(p(!0),g(ue,null,me(Y.actToolInfoList,(X,G)=>(p(),g("div",{key:G},[s("div",Ti,[s("span",Ri,i(r(t)("rightPanel.tool"))+":",1),s("span",Ii,i(X.name||""),1)]),s("div",Ai,[s("span",xi,i(r(t)("rightPanel.toolParameters"))+":",1),s("pre",null,i(f(X.parameters)),1)]),s("div",Mi,[s("span",Fi,i(r(t)("rightPanel.executionResult"))+":",1),s("pre",null,i(f(X.result)),1)])]))),128))]),Y.subPlanExecutionRecord?(p(),g("div",Di,[s("h5",null,[T(r(R),{icon:"carbon:tree-view"}),re(" "+i(r(t)("rightPanel.subPlan")),1)]),s("div",Ni,[s("div",Ui,[s("div",Li,[s("span",Oi,i(k.$t("rightPanel.subPlanId"))+":",1),s("span",Bi,i(Y.subPlanExecutionRecord.currentPlanId),1)]),Y.subPlanExecutionRecord.title?(p(),g("div",qi,[s("span",ji,i(k.$t("rightPanel.title"))+":",1),s("span",Vi,i(Y.subPlanExecutionRecord.title),1)])):L("",!0),s("div",Gi,[Y.subPlanExecutionRecord.completed?(p(),pe(r(R),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):(p(),pe(r(R),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})),s("span",Hi,i(Y.subPlanExecutionRecord.completed?k.$t("rightPanel.status.completed"):k.$t("rightPanel.status.executing")),1)])])])])):L("",!0)])):L("",!0)]))),128))]),l.value.agentExecution&&!((Z=l.value.agentExecution.thinkActSteps)!=null&&Z.length)?(p(),g("div",Ji,[s("p",null,i(r(t)("rightPanel.noStepDetails")),1)])):l.value.agentExecution?L("",!0):(p(),g("div",Wi,[T(r(R),{icon:"carbon:information",class:"info-icon"}),s("h4",null,i(r(t)("rightPanel.stepInfo")),1),s("div",zi,[s("div",Ki,[s("span",Xi,i(r(t)("rightPanel.stepName"))+":",1),s("span",Qi,i(l.value.title||l.value.description||l.value.stepId),1)]),l.value.description?(p(),g("div",Yi,[s("span",Zi,i(k.$t("rightPanel.description"))+":",1),s("span",ec,i(l.value.description),1)])):L("",!0),s("div",tc,[s("span",oc,i(k.$t("rightPanel.status.label"))+":",1),s("span",{class:le(["value",{"status-completed":l.value.completed,"status-current":l.value.current,"status-pending":!l.value.completed&&!l.value.current}])},i(l.value.completed?k.$t("rightPanel.status.completed"):l.value.current?k.$t("rightPanel.status.executing"):k.$t("rightPanel.status.pending")),3)])]),s("p",sc,i(r(t)("rightPanel.noExecutionInfo")),1)])),l.value.current&&!l.value.completed?(p(),g("div",nc,[x[2]||(x[2]=s("div",{class:"execution-waves"},[s("div",{class:"wave wave-1"}),s("div",{class:"wave wave-2"}),s("div",{class:"wave wave-3"})],-1)),s("p",ac,[T(r(R),{icon:"carbon:in-progress",class:"rotating-icon"}),re(" "+i(r(t)("rightPanel.stepExecuting")),1)])])):L("",!0)])):(p(),g("div",lc,[T(r(R),{icon:"carbon:events",class:"empty-icon"}),s("h3",null,i(r(t)("rightPanel.noStepSelected")),1),s("p",null,i(r(t)("rightPanel.selectStepHint")),1)]))])):L("",!0),T(Nt,{name:"scroll-button"},{default:Ke(()=>[u.value?(p(),g("button",{key:0,onClick:$,class:"scroll-to-bottom-btn",title:r(t)("rightPanel.scrollToBottom")},[T(r(R),{icon:"carbon:chevron-down"})],8,rc)):L("",!0)]),_:1})],544)])):L("",!0),c.value==="files"?(p(),g("div",ic,[N.value?(p(),pe(Xr,{key:0,"plan-id":N.value},null,8,["plan-id"])):A.value?(p(),g("div",cc,[T(r(R),{icon:"carbon:folder-off"}),s("div",dc,[s("h3",null,i(r(t)("fileBrowser.noFilesYet")),1),s("p",null,i(r(t)("fileBrowser.noPlanExecuting")),1),s("div",uc,[T(r(R),{icon:"carbon:information"}),s("span",null,i(r(t)("fileBrowser.startTaskTip")),1)])])])):L("",!0)])):L("",!0)])])}}}),hc=ye(pc,[["__scopeId","data-v-3ea813c1"]]);class Le{static async getCoordinatorToolConfig(){try{const e=await fetch(`${this.BASE_URL}/config`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get coordinator tool config: ${e.status}`);return await e.json()}catch(e){return console.error("Failed to get CoordinatorTool configuration:",e),{enabled:!0,success:!1,message:e.message}}}static async getAllEndpoints(){try{const e=await fetch(`${this.BASE_URL}/endpoints`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get endpoints: ${e.status}`);return await e.json()}catch(e){throw console.error("Failed to get endpoints:",e),new Error("Failed to get endpoints: "+e.message)}}static async getCoordinatorToolsByTemplate(e){console.log("[CoordinatorToolApiService] Starting to get coordinator tool, planTemplateId:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/get-get-or-new-by-template/${e}`);try{const o=await fetch(`${this.BASE_URL}/get-or-new-by-template/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",o.status),console.log("[CoordinatorToolApiService] Response status text:",o.statusText),o.status===404)return console.log("[CoordinatorToolApiService] 404"),null;if(!o.ok){const a=await o.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to get coordinator tools: ${o.status} - ${a}`)}const t=await o.json();return console.log("[CoordinatorToolApiService] Successfully got coordinator tool, result:",t),t}catch(o){throw console.error("[CoordinatorToolApiService] Failed to get coordinator tool:",o),new Error("Failed to get coordinator tool: "+o.message)}}static async getOrNewCoordinatorToolsByTemplate(e){console.log("[CoordinatorToolApiService] Starting to get or create coordinator tool, planTemplateId:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/get-or-new-by-template/${e}`);try{const o=await fetch(`${this.BASE_URL}/get-or-new-by-template/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",o.status),console.log("[CoordinatorToolApiService] Response status text:",o.statusText),!o.ok){const a=await o.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to get coordinator tools: ${o.status} - ${a}`)}const t=await o.json();return console.log("[CoordinatorToolApiService] Successfully got coordinator tool, result:",t),t}catch(o){throw console.error("[CoordinatorToolApiService] Failed to get coordinator tool:",o),new Error("Failed to get coordinator tool: "+o.message)}}static async createCoordinatorTool(e){console.log("[CoordinatorToolApiService] Starting to create coordinator tool"),console.log("[CoordinatorToolApiService] Original data:",JSON.stringify(e,null,2)),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}`);const o={id:e.id,toolName:e.toolName,toolDescription:e.toolDescription,inputSchema:e.inputSchema,planTemplateId:e.planTemplateId,httpEndpoint:e.httpEndpoint,mcpEndpoint:e.mcpEndpoint,serviceGroup:e.serviceGroup,enableInternalToolcall:e.enableInternalToolcall,enableHttpService:e.enableHttpService,enableMcpService:e.enableMcpService};console.log("[CoordinatorToolApiService] Cleaned sending data:",JSON.stringify(o,null,2));try{const t=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(console.log("[CoordinatorToolApiService] Response status:",t.status),console.log("[CoordinatorToolApiService] Response status text:",t.statusText),!t.ok){let l="Unknown error";try{const c=await t.json();l=c.message||c.error||l}catch{l=await t.text()||l}throw console.error("[CoordinatorToolApiService] Response error content:",l),new Error(`Failed to create coordinator tool: ${t.status} - ${l}`)}const a=await t.json();return console.log("[CoordinatorToolApiService] Created successfully, result:",a),a}catch(t){throw console.error("[CoordinatorToolApiService] Failed to create coordinator tool:",t),new Error("Failed to create coordinator tool: "+t.message)}}static async updateCoordinatorTool(e,o){console.log("[CoordinatorToolApiService] Starting to update coordinator tool, ID:",e),console.log("[CoordinatorToolApiService] Sending data:",o),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/${e}`);const t={id:o.id,toolName:o.toolName,toolDescription:o.toolDescription,inputSchema:o.inputSchema,planTemplateId:o.planTemplateId,httpEndpoint:o.httpEndpoint,mcpEndpoint:o.mcpEndpoint,serviceGroup:o.serviceGroup,enableInternalToolcall:o.enableInternalToolcall,enableHttpService:o.enableHttpService,enableMcpService:o.enableMcpService};console.log("[CoordinatorToolApiService] Cleaned sending data:",t);try{const a=await fetch(`${this.BASE_URL}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(console.log("[CoordinatorToolApiService] Response status:",a.status),console.log("[CoordinatorToolApiService] Response status text:",a.statusText),!a.ok){let c="Unknown error";try{const d=await a.json();c=d.message||d.error||c}catch{c=await a.text()||c}throw console.error("[CoordinatorToolApiService] Response error content:",c),new Error(`Failed to update coordinator tool: ${a.status} - ${c}`)}const l=await a.json();return console.log("[CoordinatorToolApiService] Updated successfully, result:",l),l}catch(a){throw console.error("[CoordinatorToolApiService] Failed to update coordinator tool:",a),new Error("Failed to update coordinator tool: "+a.message)}}static async deleteCoordinatorTool(e){console.log("[CoordinatorToolApiService] Starting to delete coordinator tool, ID:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/${e}`);try{const o=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",o.status),console.log("[CoordinatorToolApiService] Response status text:",o.statusText),!o.ok){const a=await o.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to delete coordinator tool: ${o.status} - ${a}`)}const t=await o.json();return console.log("[CoordinatorToolApiService] Deleted successfully, result:",t),t}catch(o){throw console.error("[CoordinatorToolApiService] Failed to delete coordinator tool:",o),new Error("Failed to delete coordinator tool: "+o.message)}}}ke(Le,"BASE_URL","/api/coordinator-tools");class Lt{static async getParameterRequirements(e){try{const o=await fetch(`${this.BASE_URL}/${e}/parameters`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error(`Failed to get parameter requirements: ${o.statusText}`);return await o.json()}catch(o){throw console.error("Error getting parameter requirements:",o),o}}}ke(Lt,"BASE_URL","/api/plan-template");const mc={class:"modal-form wide-modal"},fc={class:"form-section"},gc={class:"form-item"},vc=["placeholder"],bc={class:"field-description"},yc={class:"form-section"},_c={class:"form-item"},Sc=["placeholder"],wc={class:"field-description"},$c={class:"form-section"},Pc={class:"form-item"},kc={class:"service-group-autocomplete"},Ec=["placeholder"],Cc={key:0,class:"service-group-dropdown"},Tc=["onMousedown"],Rc={class:"field-description"},Ic={class:"form-section"},Ac={class:"section-title"},xc={key:0,class:"params-help-text"},Mc={class:"parameter-table"},Fc=["onUpdate:modelValue","placeholder","readonly"],Dc=["onUpdate:modelValue","placeholder"],Nc={class:"form-section"},Uc={class:"service-publish-options"},Lc={class:"internal-toolcall-publish-option"},Oc={class:"checkbox-label"},Bc={class:"checkbox-text"},qc={class:"checkbox-description"},jc={class:"http-publish-option"},Vc={class:"checkbox-label"},Gc={class:"checkbox-text"},Hc={class:"checkbox-description"},Jc={class:"button-container"},Wc=["disabled"],zc=["disabled"],Kc=be({__name:"PublishServiceModal",props:{modelValue:{type:Boolean,default:!1},planTemplateId:{default:""},planDescription:{default:""}},emits:["update:modelValue","published"],setup(n,{expose:e,emit:o}){const{t}=Ae(),a=n,l=o,c=he({get:()=>a.modelValue,set:U=>l("update:modelValue",U)}),d=D(""),m=D(""),u=D(!1),h=D(!1),b=D(null),F=D(!1),N=D(!1),A=D(!0),P=D({parameters:[],hasParameters:!1,requirements:""}),y=D(!1),v=D(!1),E=D([]),$=D(!1),_=nt({serviceName:"",userRequest:"",endpoint:"",serviceGroup:"",parameters:[]}),f=he(()=>{const U=_.serviceGroup.trim();if(!U)return E.value;const J=U.toLowerCase();return E.value.filter(Q=>Q.toLowerCase().includes(J))}),w=he(()=>{var J;const U=(J=b.value)==null?void 0:J.id;return t(U?"mcpService.updateService":"mcpService.createService")}),M=()=>{_.serviceName="",_.userRequest=a.planDescription||"",_.endpoint="",_.serviceGroup="",P.value.hasParameters||(_.parameters=[]),b.value=null,F.value=!1};fe(()=>_.userRequest,U=>{const J=U.trim();J&&(_.serviceName.trim()||(_.serviceName=J))});const q=async()=>{if(!$.value){$.value=!0;try{const U=await Ho.getAvailableTools(),J=new Set;U.forEach(Q=>{Q.serviceGroup&&J.add(Q.serviceGroup)}),E.value=Array.from(J).sort()}catch(U){console.error("[PublishModal] Failed to load service groups:",U),E.value=[]}finally{$.value=!1}}},k=()=>{v.value=!0},x=()=>{setTimeout(()=>{v.value=!1},200)},V=U=>{_.serviceGroup=U,v.value=!1},Z=async()=>{if(!a.planTemplateId){P.value={parameters:[],hasParameters:!1,requirements:""};return}y.value=!0;try{const U=await Lt.getParameterRequirements(a.planTemplateId);P.value=U,U.hasParameters&&(_.parameters=U.parameters.map(J=>({name:J,description:""})))}catch(U){console.error("[PublishModal] Failed to load parameter requirements:",U),U instanceof Error&&!U.message.includes("404")&&console.warn("[PublishModal] Parameter requirements not available yet, will retry later"),P.value={parameters:[],hasParameters:!1,requirements:""}}finally{y.value=!1}},Y=(U,J)=>{J==="success"?(m.value=U,setTimeout(()=>{m.value=""},3e3)):J==="error"&&(d.value=U,setTimeout(()=>{d.value=""},5e3))},z=()=>{if(!_.serviceName.trim())return Y(t("mcpService.toolNameRequiredError"),"error"),!1;if(!_.userRequest.trim())return Y(t("mcpService.toolDescriptionRequiredError"),"error"),!1;if(!_.serviceGroup.trim())return Y(t("mcpService.serviceGroupRequiredError"),"error"),!1;if(!A.value&&!N.value)return Y("Please select at least one service type","error"),!1;for(let U=0;U<_.parameters.length;U++){const J=_.parameters[U];if(J.name&&!J.description.trim())return Y(`Parameter "${J.name}" description cannot be empty`,"error"),!1;if(J.description&&!J.name.trim())return Y(`Parameter description "${J.description}" corresponding name cannot be empty`,"error"),!1}return!0},X=async()=>{if(console.log("[PublishModal] Starting to handle publish request"),console.log("[PublishModal] Form data:",_),console.log("[PublishModal] Current tool:",b.value),console.log("[PublishModal] Publish as HTTP service:",N.value),!z()){console.log("[PublishModal] Form validation failed");return}u.value=!0;try{b.value||(console.log("[PublishModal] No current tool data, getting or creating first"),b.value=await Le.getOrNewCoordinatorToolsByTemplate(a.planTemplateId)),console.log("[PublishModal] Updating tool information"),b.value.toolName=_.serviceName.trim(),b.value.toolDescription=_.userRequest.trim(),b.value.serviceGroup=_.serviceGroup.trim(),b.value.planTemplateId=a.planTemplateId,b.value.enableInternalToolcall=A.value,b.value.enableHttpService=N.value,b.value.enableMcpService=!1,b.value.mcpEndpoint=void 0;const U=_.parameters.filter(Q=>Q.name.trim()&&Q.description.trim()).map(Q=>({name:Q.name.trim(),description:Q.description.trim(),type:"string"}));if(b.value.inputSchema=JSON.stringify(U),console.log("[PublishModal] Updated tool information:",b.value),b.value.id)console.log("[PublishModal] Updating existing tool, ID:",b.value.id),await Le.updateCoordinatorTool(b.value.id,b.value);else{console.log("[PublishModal] Creating new tool");const Q=await Le.createCoordinatorTool(b.value);b.value=Q}const J=[];if(A.value&&J.push("Internal Method Call"),N.value&&J.push("HTTP Service"),J.length>0){console.log("[PublishModal] Step 5: Publishing service, ID:",b.value.id,"Enabled services:",J.join(", "));const Q=[];A.value&&Q.push(`Internal Call: ${_.serviceName}`),console.log("[PublishModal] Service published successfully"),Y(t("mcpService.publishSuccess"),"success"),l("published",b.value)}else console.log("[PublishModal] Only saving tool, not publishing as any service"),Y(t("mcpService.saveSuccess"),"success"),l("published",b.value)}catch(U){console.error("[PublishModal] Failed to publish service:",U),Y(t("mcpService.publishFailed")+": "+U.message,"error")}finally{u.value=!1}},G=async()=>{var U;if(!h.value&&confirm(t("mcpService.deleteConfirmMessage"))){if(!((U=b.value)!=null&&U.id)){Y(t("mcpService.deleteFailed")+": "+t("mcpService.selectPlanTemplateFirst"),"error");return}h.value=!0;try{console.log("[PublishModal] Starting to delete MCP service, ID:",b.value.id);const J=await Le.deleteCoordinatorTool(b.value.id);if(J.success)console.log("[PublishModal] Deleted successfully"),Y(t("mcpService.deleteSuccess"),"success"),c.value=!1,l("published",null);else throw new Error(J.message)}catch(J){console.error("[PublishModal] Failed to delete MCP service:",J),Y(t("mcpService.deleteFailed")+": "+J.message,"error")}finally{h.value=!1}}},te=async()=>{c.value&&(console.log("[PublishModal] Modal opened, starting to initialize data"),M(),await K())},K=async()=>{if(!a.planTemplateId){console.log("[PublishModal] "+t("mcpService.noPlanTemplateId"));return}try{console.log("[PublishModal] Starting to load coordinator tool data, planTemplateId:",a.planTemplateId);const U=await Le.getOrNewCoordinatorToolsByTemplate(a.planTemplateId);console.log("[PublishModal] Get coordinator tool data result:",U),b.value=U,F.value=!!U.id;const J=[];if(U.enableMcpService&&U.mcpEndpoint){const Q=window.location.origin;J.push(`MCP: ${Q}/mcp${U.mcpEndpoint}`)}U.enableInternalToolcall&&J.push(`Internal Call: ${U.toolName}`),console.log("[PublishModal] Load tool data completed"),_.serviceName=U.toolName||"",_.userRequest=U.toolDescription||a.planDescription||"",_.serviceGroup=U.serviceGroup??"",N.value=U.enableHttpService??!1,A.value=U.enableInternalToolcall??!1;try{if(U.inputSchema){const Q=JSON.parse(U.inputSchema);Array.isArray(Q)&&Q.length>0?(_.parameters=Q.map(O=>({name:O.name||"",description:O.description||""})),console.log("[PublishModal] Load parameters from inputSchema:",_.parameters)):console.log("[PublishModal] inputSchema is empty, keeping existing parameters:",_.parameters)}}catch(Q){console.warn("[PublishModal] "+t("mcpService.parseInputSchemaFailed")+":",Q),console.log("[PublishModal] Parsing failed, keeping existing parameters:",_.parameters)}console.log("[PublishModal] Form data filled:",_)}catch(U){console.error("[PublishModal] "+t("mcpService.loadToolDataFailed")+":",U),Y(t("mcpService.loadToolDataFailed")+": "+U.message,"error")}};return fe(()=>a.modelValue,te),fe(()=>a.planTemplateId,(U,J)=>{U&&U!==J&&(J&&U.startsWith("planTemplate-")?setTimeout(()=>{Z()},1e3):Z())}),fe(c,U=>{U&&q()}),Fe(async()=>{c.value&&(console.log("[PublishModal] Initialize when component mounted"),M(),await K(),await Z())}),e({loadParameterRequirements:Z}),(U,J)=>(p(),g(ue,null,[T(ao,{modelValue:c.value,"onUpdate:modelValue":J[6]||(J[6]=Q=>c.value=Q),title:w.value,onConfirm:X},{footer:Ke(()=>{var Q;return[s("div",Jc,[F.value&&((Q=b.value)!=null&&Q.id)?(p(),g("button",{key:0,class:"action-btn danger",onClick:G,disabled:h.value},[h.value?(p(),pe(r(R),{key:0,icon:"carbon:loading",class:"loading-icon"})):(p(),pe(r(R),{key:1,icon:"carbon:trash-can"})),re(" "+i(h.value?r(t)("mcpService.deleting"):r(t)("mcpService.delete")),1)],8,Wc)):L("",!0),s("button",{class:"action-btn primary",onClick:X,disabled:u.value},[u.value?(p(),pe(r(R),{key:0,icon:"carbon:loading",class:"loading-icon"})):(p(),pe(r(R),{key:1,icon:"carbon:cloud-upload"})),re(" "+i(u.value?r(t)("mcpService.publishing"):r(t)("mcpService.publishAsService")),1)],8,zc)])]}),default:Ke(()=>[s("div",mc,[s("div",fc,[s("div",gc,[s("label",null,i(r(t)("mcpService.toolNameRequired")),1),de(s("input",{type:"text","onUpdate:modelValue":J[0]||(J[0]=Q=>_.serviceName=Q),placeholder:r(t)("mcpService.toolNamePlaceholder"),class:le({error:!_.serviceName||!_.serviceName.trim()}),required:""},null,10,vc),[[ve,_.serviceName]]),s("div",bc,i(r(t)("mcpService.toolNameDescription")),1)])]),s("div",yc,[s("div",_c,[s("label",null,i(r(t)("mcpService.toolDescriptionRequired")),1),de(s("textarea",{"onUpdate:modelValue":J[1]||(J[1]=Q=>_.userRequest=Q),placeholder:r(t)("mcpService.toolDescriptionPlaceholder"),class:le([{error:!_.userRequest||!_.userRequest.trim()},"description-field"]),rows:"4",required:""},null,10,Sc),[[ve,_.userRequest]]),s("div",wc,i(r(t)("mcpService.toolDescriptionDescription")),1)])]),s("div",$c,[s("div",Pc,[s("label",null,i(r(t)("mcpService.serviceGroup")),1),s("div",kc,[de(s("input",{type:"text","onUpdate:modelValue":J[2]||(J[2]=Q=>_.serviceGroup=Q),onInput:k,onFocus:J[3]||(J[3]=Q=>v.value=!0),onBlur:x,placeholder:r(t)("mcpService.serviceGroupPlaceholder"),class:le({error:!_.serviceGroup||!_.serviceGroup.trim()}),required:""},null,42,Ec),[[ve,_.serviceGroup]]),v.value&&f.value.length>0?(p(),g("div",Cc,[(p(!0),g(ue,null,me(f.value,Q=>(p(),g("div",{key:Q,class:"service-group-option",onMousedown:O=>V(Q)},i(Q),41,Tc))),128))])):L("",!0)]),s("div",Rc,i(r(t)("mcpService.serviceGroupDescription")),1)])]),s("div",Ic,[s("div",Ac,i(r(t)("mcpService.parameterConfig")),1),P.value.hasParameters?(p(),g("div",xc,i(r(t)("sidebar.parameterRequirementsHelp")),1)):L("",!0),s("div",Mc,[s("table",null,[s("thead",null,[s("tr",null,[s("th",null,i(r(t)("mcpService.parameterName")),1),s("th",null,i(r(t)("mcpService.parameterDescription")),1)])]),s("tbody",null,[(p(!0),g(ue,null,me(_.parameters,(Q,O)=>(p(),g("tr",{key:O},[s("td",null,[de(s("input",{type:"text","onUpdate:modelValue":B=>Q.name=B,placeholder:r(t)("mcpService.parameterName"),class:le(["parameter-input",{"readonly-input":P.value.hasParameters}]),readonly:P.value.hasParameters,required:""},null,10,Fc),[[ve,Q.name]])]),s("td",null,[de(s("input",{type:"text","onUpdate:modelValue":B=>Q.description=B,placeholder:r(t)("mcpService.parameterDescription"),class:"parameter-input",required:""},null,8,Dc),[[ve,Q.description]])])]))),128))])])])]),s("div",Nc,[s("div",Uc,[s("div",Lc,[s("label",Oc,[de(s("input",{type:"checkbox","onUpdate:modelValue":J[4]||(J[4]=Q=>A.value=Q),class:"checkbox-input"},null,512),[[Et,A.value]]),s("span",Bc,i(r(t)("mcpService.publishAsInternalToolcall")),1)]),s("div",qc,i(r(t)("mcpService.publishAsInternalToolcallDescription")),1)]),s("div",jc,[s("label",Vc,[de(s("input",{type:"checkbox","onUpdate:modelValue":J[5]||(J[5]=Q=>N.value=Q),class:"checkbox-input"},null,512),[[Et,N.value]]),s("span",Gc,i(r(t)("mcpService.publishAsHttpService")),1)]),s("div",Hc,i(r(t)("mcpService.publishAsHttpServiceDescription")),1)])])])])]),_:1},8,["modelValue","title"]),d.value?(p(),g("div",{key:0,class:"error-toast",onClick:J[7]||(J[7]=Q=>d.value="")},[T(r(R),{icon:"carbon:error"}),re(" "+i(d.value),1)])):L("",!0),m.value?(p(),g("div",{key:1,class:"success-toast",onClick:J[8]||(J[8]=Q=>m.value="")},[T(r(R),{icon:"carbon:checkmark"}),re(" "+i(m.value),1)])):L("",!0)],64))}}),Xc=ye(Kc,[["__scopeId","data-v-93d9068f"]]),Qc={class:"config-section"},Yc={class:"section-header"},Zc={class:"execution-content"},ed={class:"params-requirements-group"},td={class:"params-help-text"},od={key:0,class:"parameter-fields"},sd={class:"parameter-label"},nd=["onUpdate:modelValue","placeholder","onInput"],ad={key:0,class:"parameter-error"},ld={key:1,class:"validation-message"},rd=["disabled"],id=["disabled"],cd={key:1,class:"call-example-wrapper"},dd={class:"call-example-header"},ud={class:"call-example-title"},pd={class:"call-example-description"},hd={class:"internal-call-wrapper"},md={class:"call-info"},fd={class:"call-method"},gd={class:"call-endpoint"},vd={key:0,class:"call-endpoint"},bd={class:"call-description"},yd={class:"call-example"},_d={class:"example-code"},Sd={key:2,class:"call-example-wrapper"},wd={class:"call-example-header"},$d={class:"call-example-title"},Pd={class:"call-example-description"},kd={class:"http-api-urls-wrapper"},Ed={class:"tab-container"},Cd={class:"tab-header"},Td=["onClick"],Rd={class:"tab-content"},Id={class:"http-api-url-display"},Ad={class:"api-method"},xd={class:"api-endpoint"},Md={class:"api-description"},Fd={key:0,class:"api-example"},Dd={class:"example-code"},Nd={key:3,class:"call-example-wrapper"},Ud={class:"call-example-header"},Ld={class:"call-example-title"},Od={class:"call-example-description"},Bd={class:"mcp-call-wrapper"},qd={class:"call-info"},jd={class:"call-method"},Vd={class:"call-endpoint"},Gd={class:"call-description"},Hd={class:"call-example"},Jd={class:"example-code"},Wd=be({__name:"ExecutionController",props:{currentPlanTemplateId:{default:""},isExecuting:{type:Boolean,default:!1},isGenerating:{type:Boolean,default:!1},showPublishButton:{type:Boolean,default:!0},toolInfo:{default:()=>({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""})}},emits:["executePlan","publishMcpService","clearParams","updateExecutionParams"],setup(n,{expose:e,emit:o}){const{t}=Ae(),a=n,l=o,c=D(""),d=D({parameters:[],hasParameters:!1,requirements:""}),m=D({}),u=D(!1),h=D("get-sync"),b=D({}),F=D(!1),N=D(!1),A=D(),P=D([]),y=D(null),v=D([{id:"get-sync",label:"GET + Sync",method:"GET",endpoint:"/api/executor/executeByToolNameSync/{toolName}",description:"Synchronous GET request - returns execution result immediately",example:`GET /api/executor/executeByToolNameSync/my-tool?allParams={"rawParam":"test"}
Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-sync",label:"POST + Sync",method:"POST",endpoint:"/api/executor/executeByToolNameSync",description:"Synchronous POST request - returns execution result immediately",example:`POST /api/executor/executeByToolNameSync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-async",label:"POST + Async",method:"POST",endpoint:"/api/executor/executeByToolNameAsync",description:"Asynchronous POST request - returns task ID, check status separately",example:`POST /api/executor/executeByToolNameAsync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "planId": "plan-123",
  "status": "processing",
  "message": "Task submitted, processing",
  "memoryId": "ABC12345",
  "toolName": "my-tool",
  "planTemplateId": "template-456"
}

# Check execution status and get detailed results:
GET /api/executor/details/{planId}
Response: {
  "currentPlanId": "plan-123",
  "title": "Plan Title",
  "status": "completed",
  "summary": "Execution completed successfully",
  "agentExecutionSequence": [...],
  "userInputWaitState": null,
  "structureResult": {
    "message": [
      {
        "name": "Product A",
        "price": "100",
        "quantity": "5"
      }
    ],
    "fileList": [
      {
        "fileName": "report.md",
        "fileDescription": "Generated report with product information"
      }
    ]
  }
}`}]),E=he(()=>a.toolInfo.enableInternalToolcall??a.toolInfo.enableHttpService??a.toolInfo.enableMcpService),$=he(()=>E.value?t("sidebar.updateServiceStatus"):t("sidebar.publishMcpService")),_=he(()=>a.isExecuting||a.isGenerating?!1:d.value.hasParameters?d.value.parameters.every(K=>{const U=m.value[K];return typeof U=="string"&&U.trim()!==""}):!0),f=(K,U)=>{P.value=K.map(J=>J.originalName),y.value=U,console.log("[ExecutionController] Files uploaded:",K.length,"uploadKey:",U)},w=K=>{P.value=K.map(U=>U.originalName),console.log("[ExecutionController] Files removed, remaining:",K.length)},M=K=>{y.value=K,console.log("[ExecutionController] Upload key changed:",K)},q=()=>{console.log("[ExecutionController] Upload started")},k=()=>{console.log("[ExecutionController] Upload completed")},x=K=>{console.error("[ExecutionController] Upload error:",K)},V=()=>{if(console.log("[ExecutionController] ðŸš€ Execute button clicked"),N.value=!0,console.log("[ExecutionController] ðŸ”’ Set isExecutingPlan to true"),!G()){console.log("[ExecutionController] âŒ Parameter validation failed:",b.value),N.value=!1;return}const K=d.value.hasParameters&&Object.keys(m.value).length>0?m.value:void 0;console.log("[ExecutionController] ðŸ”„ Replacement params:",K);const U={title:"",planData:{title:"",steps:[],directResponse:!1},params:void 0,replacementParams:K,uploadedFiles:P.value,uploadKey:y.value};console.log("[ExecutionController] ðŸ“¤ Emitting executePlan with payload:",JSON.stringify(U,null,2)),l("executePlan",U)},Z=()=>{l("publishMcpService")},Y=()=>{console.log("[ExecutionController] ðŸ§¹ clearExecutionParams called"),c.value="",m.value={},N.value=!1,console.log("[ExecutionController] ðŸ”“ Reset isExecutingPlan to false"),console.log("[ExecutionController] âœ… After clear - parameterValues cleared"),l("clearParams")},z=async()=>{if(console.log("[ExecutionController] ðŸ”„ loadParameterRequirements called for templateId:",a.currentPlanTemplateId),console.log("[ExecutionController] ðŸ“Š Current parameterRequirements before load:",JSON.stringify(d.value,null,2)),!a.currentPlanTemplateId){console.log("[ExecutionController] âŒ No template ID, resetting parameters"),d.value={parameters:[],hasParameters:!1,requirements:""},m.value={};return}d.value={parameters:[],hasParameters:!1,requirements:""},m.value={},console.log("[ExecutionController] ðŸ§¹ Cleared previous data before loading new template"),u.value=!0;try{console.log("[ExecutionController] ðŸŒ Fetching parameter requirements from API...");const K=await Lt.getParameterRequirements(a.currentPlanTemplateId);console.log("[ExecutionController] ðŸ“¥ Received requirements from API:",JSON.stringify(K,null,2)),d.value=K;const U={};K.parameters.forEach(J=>{U[J]=m.value[J]||""}),m.value=U,console.log("[ExecutionController] âœ… Updated parameterRequirements:",JSON.stringify(d.value,null,2)),console.log("[ExecutionController] âœ… Updated parameterValues:",JSON.stringify(m.value,null,2)),te()}catch(K){console.error("[ExecutionController] âŒ Failed to load parameter requirements:",K),K instanceof Error&&!K.message.includes("404")&&console.warn("[ExecutionController] âš ï¸ Parameter requirements not available yet, will retry later"),d.value={parameters:[],hasParameters:!1,requirements:""},m.value={},console.log("[ExecutionController] ðŸ”„ Reset parameterRequirements due to error:",JSON.stringify(d.value,null,2)),console.log("[ExecutionController] ðŸ”„ Cleared parameterValues:",JSON.stringify(m.value,null,2))}finally{u.value=!1,console.log("[ExecutionController] âœ… loadParameterRequirements completed")}},X=(K,U)=>{m.value[K]=U,b.value[K]&&delete b.value[K],te()},G=()=>{if(b.value={},F.value=!1,!d.value.hasParameters)return!0;let K=!1;return d.value.parameters.forEach(U=>{(m.value[U]?m.value[U].trim():"")||(b.value[U]=`${U} is required`,K=!0)}),F.value=K,!K},te=()=>{d.value.hasParameters?c.value=JSON.stringify(m.value,null,2):c.value="",l("updateExecutionParams",c.value)};return fe(()=>a.currentPlanTemplateId,(K,U)=>{if(K&&K!==U){if(N.value){console.log("[ExecutionController] â¸ï¸ Skipping parameter reload - plan is executing");return}console.log("[ExecutionController] ðŸ”„ Template ID changed, will reload parameters"),U&&K.startsWith("planTemplate-")?(console.log("[ExecutionController] â° New template detected, retrying with delay..."),setTimeout(()=>{console.log("[ExecutionController] â° Delay timeout, calling loadParameterRequirements"),z()},1e3)):(console.log("[ExecutionController] ðŸš€ Immediate reload of parameters"),z())}}),fe(()=>c.value,K=>{l("updateExecutionParams",K)}),Fe(()=>{z()}),e({executionParams:c,clearExecutionParams:Y,loadParameterRequirements:z,fileUploadRef:A,uploadedFiles:P,uploadKey:y}),(K,U)=>{var J,Q,O,B,oe;return p(),g("div",Qc,[s("div",Yc,[T(r(R),{icon:"carbon:play",width:"16"}),s("span",null,i(r(t)("sidebar.executionController")),1)]),s("div",Zc,[s("div",ed,[s("label",null,i(r(t)("sidebar.parameterRequirements")),1),s("div",td,i(r(t)("sidebar.parameterRequirementsHelp")),1),d.value.hasParameters?(p(),g("div",od,[(p(!0),g(ue,null,me(d.value.parameters,C=>(p(),g("div",{key:C,class:"parameter-field"},[s("label",sd,[re(i(C)+" ",1),U[0]||(U[0]=s("span",{class:"required"},"*",-1))]),de(s("input",{"onUpdate:modelValue":W=>m.value[C]=W,class:le(["parameter-input",{error:b.value[C]}]),placeholder:r(t)("sidebar.enterValueFor",{param:C}),onInput:W=>X(C,W.target.value),required:""},null,42,nd),[[ve,m.value[C]]]),b.value[C]?(p(),g("div",ad,i(b.value[C]),1)):L("",!0)]))),128))])):L("",!0),d.value.hasParameters&&!_.value&&!a.isExecuting&&!a.isGenerating?(p(),g("div",ld,[T(r(R),{icon:"carbon:warning",width:"14"}),re(" "+i(r(t)("sidebar.fillAllRequiredParameters")),1)])):L("",!0)]),T(ro,{ref_key:"fileUploadRef",ref:A,disabled:a.isExecuting||a.isGenerating,onFilesUploaded:f,onFilesRemoved:w,onUploadKeyChanged:M,onUploadStarted:q,onUploadCompleted:k,onUploadError:x},null,8,["disabled"]),s("button",{class:"btn btn-primary execute-btn",onClick:V,disabled:!_.value},[T(r(R),{icon:a.isExecuting?"carbon:circle-dash":"carbon:play",width:"16",class:le({spinning:a.isExecuting})},null,8,["icon","class"]),re(" "+i(a.isExecuting?r(t)("sidebar.executing"):r(t)("sidebar.executePlan")),1)],8,rd),K.showPublishButton?(p(),g("button",{key:0,class:"btn publish-mcp-btn",onClick:Z,disabled:!K.currentPlanTemplateId},[T(r(R),{icon:"carbon:application",width:"16"}),re(" "+i($.value),1)],8,id)):L("",!0),(J=K.toolInfo)!=null&&J.enableInternalToolcall?(p(),g("div",cd,[s("div",dd,[s("h4",ud,i(r(t)("sidebar.internalCall")),1),s("p",pd,i(r(t)("sidebar.internalCallDescription")),1)]),s("div",hd,[s("div",md,[s("div",fd,i(r(t)("sidebar.internalMethodCall")),1),s("div",gd,i(r(t)("sidebar.toolName"))+": "+i(((Q=K.toolInfo)==null?void 0:Q.toolName)||K.currentPlanTemplateId),1),(O=K.toolInfo)!=null&&O.serviceGroup?(p(),g("div",vd,i(r(t)("sidebar.serviceGroup"))+": "+i(K.toolInfo.serviceGroup),1)):L("",!0),s("div",bd,i(r(t)("sidebar.internalCallUsage")),1),s("div",yd,[s("strong",null,i(r(t)("sidebar.usage"))+":",1),s("pre",_d,i(r(t)("sidebar.internalCallExample")),1)])])])])):L("",!0),(B=K.toolInfo)!=null&&B.enableHttpService?(p(),g("div",Sd,[s("div",wd,[s("h4",$d,i(r(t)("sidebar.httpCallExample")),1),s("p",Pd,i(r(t)("sidebar.httpCallDescription")),1)]),s("div",kd,[s("div",Ed,[s("div",Cd,[(p(!0),g(ue,null,me(v.value,C=>(p(),g("button",{key:C.id,class:le(["tab-button",{active:h.value===C.id}]),onClick:W=>h.value=C.id},i(C.label),11,Td))),128))]),s("div",Rd,[(p(!0),g(ue,null,me(v.value,C=>de((p(),g("div",{key:C.id,class:"tab-panel"},[s("div",Id,[s("div",Ad,i(C.method),1),s("div",xd,i(C.endpoint),1),s("div",Md,i(C.description),1),C.example?(p(),g("div",Fd,[s("strong",null,i(r(t)("sidebar.example"))+":",1),s("pre",Dd,i(C.example),1)])):L("",!0)])])),[[Bo,h.value===C.id]])),128))])])])])):L("",!0),(oe=K.toolInfo)!=null&&oe.enableMcpService?(p(),g("div",Nd,[s("div",Ud,[s("h4",Ld,i(r(t)("sidebar.mcpCall")),1),s("p",Od,i(r(t)("sidebar.mcpCallDescription")),1)]),s("div",Bd,[s("div",qd,[s("div",jd,i(r(t)("sidebar.mcpServiceCall")),1),s("div",Vd,i(r(t)("sidebar.mcpEndpoint"))+": /mcp/execute",1),s("div",Gd,i(r(t)("sidebar.mcpCallUsage")),1),s("div",Hd,[s("strong",null,i(r(t)("sidebar.usage"))+":",1),s("pre",Jd,i(r(t)("sidebar.mcpCallExample")),1)])])])])):L("",!0)])])}}}),zd=ye(Wd,[["__scopeId","data-v-82031dab"]]);function co(n,e){const o=D(!1),t=nt({title:"",steps:[],directResponse:!1,planTemplateId:n.currentPlanTemplateId||"",planType:"dynamic_agent"}),a=y=>{console.log("[JsonEditorLogic] parseJsonToVisual called with jsonContent:",y),console.log("[JsonEditorLogic] parseJsonToVisual called with currentPlanTemplateId:",n.currentPlanTemplateId);try{if(!y){console.log("[JsonEditorLogic] No jsonContent, resetting to default"),Object.assign(t,{title:"",steps:[],directResponse:!1,planTemplateId:n.currentPlanTemplateId||"",planType:"dynamic_agent"}),console.log("[JsonEditorLogic] Reset displayData to:",t);return}const v=JSON.parse(y);console.log("[JsonEditorLogic] Parsed JSON:",v),t.title=v.title||"",t.directResponse=!1,t.planTemplateId=v.planTemplateId||n.currentPlanTemplateId||"",t.planType=v.planType||"dynamic_agent",t.steps=(v.steps||[]).map(E=>({stepRequirement:E.stepRequirement||"",agentName:E.agentName||"",modelName:E.modelName||null,selectedToolKeys:E.selectedToolKeys||[],terminateColumns:E.terminateColumns||""})),console.log("[JsonEditorLogic] Updated displayData to:",t)}catch(v){console.warn("Failed to parse JSON content:",v),Object.assign(t,{title:"",steps:[],directResponse:!1,planTemplateId:n.currentPlanTemplateId||"",planType:"dynamic_agent"}),console.log("[JsonEditorLogic] Error occurred, reset displayData to:",t)}},l=()=>{try{const y={title:t.title,steps:t.steps.map(v=>({stepRequirement:v.stepRequirement,agentName:v.agentName,modelName:v.modelName??"",selectedToolKeys:v.selectedToolKeys,terminateColumns:v.terminateColumns})),directResponse:t.directResponse,planTemplateId:t.planTemplateId,planType:t.planType};return JSON.stringify(y,null,2)}catch(y){return console.error("Failed to convert visual data to JSON:",y),"{}"}},c=he(()=>l());return fe(()=>n.jsonContent,(y,v)=>{console.log("[JsonEditorLogic] Watch triggered - jsonContent changed from",v,"to",y),a(y)},{immediate:!0}),fe(t,()=>{const y=l();e("update:jsonContent",y)},{deep:!0}),fe(()=>n.currentPlanTemplateId,y=>{y&&(t.planTemplateId=y)}),{showJsonPreview:o,displayData:t,formattedJsonOutput:c,addStep:()=>{const y={stepRequirement:"",agentName:"ConfigurableDynaAgent",modelName:null,selectedToolKeys:[],terminateColumns:"",agentType:"",stepContent:""};t.steps.push(y)},removeStep:y=>{y>=0&&y<t.steps.length&&t.steps.splice(y,1)},moveStepUp:y=>{if(y>0){const v=t.steps.splice(y,1)[0];t.steps.splice(y-1,0,v)}},moveStepDown:y=>{if(y<t.steps.length-1){const v=t.steps.splice(y,1)[0];t.steps.splice(y+1,0,v)}},toggleJsonPreview:()=>{o.value=!o.value},closeJsonPreview:()=>{o.value=!1},handleRollback:()=>{e("rollback")},handleRestore:()=>{e("restore")},handleSave:()=>{e("save")}}}const Kd={class:"config-section"},Xd={class:"section-header"},Qd={class:"visual-editor"},Yd={class:"plan-basic-info"},Zd={class:"form-row"},eu={class:"form-label"},tu=["placeholder"],ou={class:"steps-section"},su={class:"steps-header"},nu={class:"form-label"},au={class:"steps-container"},lu={class:"step-header"},ru={class:"step-number"},iu={class:"step-actions"},cu=["onClick","disabled","title"],du=["onClick","disabled","title"],uu=["onClick","title"],pu={class:"step-content"},hu={class:"form-row"},mu={class:"form-label"},fu={class:"agent-selector"},gu=["onUpdate:modelValue"],vu={value:""},bu=["title"],yu={class:"form-row"},_u={class:"form-label"},Su=["onUpdate:modelValue","placeholder"],wu={class:"form-row"},$u={class:"form-label"},Pu=["onUpdate:modelValue","placeholder"],ku={key:0,class:"empty-steps"},Eu={class:"plan-id-section"},Cu={class:"form-row"},Tu={class:"form-label"},Ru={key:0,class:"json-preview"},Iu={class:"preview-header"},Au={class:"form-label"},xu={class:"json-code"},Mu={class:"editor-footer"},Fu={class:"section-actions"},Du=["disabled","title"],Nu=["disabled","title"],Uu=["disabled"],Lu=be({__name:"JsonEditor",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},hiddenFields:{default:()=>[]},currentPlanTemplateId:{default:""}},emits:["rollback","restore","save","update:jsonContent"],setup(n,{emit:e}){const o=n,t=e,{showJsonPreview:a,displayData:l,formattedJsonOutput:c,addStep:d,removeStep:m,moveStepUp:u,moveStepDown:h,handleRollback:b,handleRestore:F,handleSave:N,toggleJsonPreview:A,closeJsonPreview:P}=co(o,t),y=v=>{const E=v.target;E.style.height="auto";const $=20,_=Math.ceil(E.scrollHeight/$),f=4,w=12,M=Math.max(f,Math.min(w,_)),q=M*$;E.style.height=`${q}px`,E.rows=M,_>w?E.style.overflowY="auto":E.style.overflowY="hidden"};return(v,E)=>(p(),g("div",Kd,[s("div",Xd,[T(r(R),{icon:"carbon:code",width:"16"}),s("span",null,i(v.$t("sidebar.jsonTemplate")),1)]),s("div",Qd,[s("div",Yd,[s("div",Zd,[s("label",eu,i(v.$t("sidebar.title")),1),de(s("input",{"onUpdate:modelValue":E[0]||(E[0]=$=>r(l).title=$),type:"text",class:"form-input",placeholder:v.$t("sidebar.titlePlaceholder")},null,8,tu),[[ve,r(l).title]])])]),s("div",ou,[s("div",su,[s("label",nu,i(v.$t("sidebar.tasks")),1)]),s("div",au,[(p(!0),g(ue,null,me(r(l).steps,($,_)=>(p(),g("div",{key:_,class:"step-item"},[s("div",lu,[s("span",ru,i(v.$t("sidebar.subtask"))+" "+i(_+1),1),s("div",iu,[s("button",{onClick:f=>r(u)(_),disabled:_===0,class:"btn btn-xs",title:v.$t("sidebar.moveUp")},[T(r(R),{icon:"carbon:chevron-up",width:"12"})],8,cu),s("button",{onClick:f=>r(h)(_),disabled:_===r(l).steps.length-1,class:"btn btn-xs",title:v.$t("sidebar.moveDown")},[T(r(R),{icon:"carbon:chevron-down",width:"12"})],8,du),s("button",{onClick:f=>r(m)(_),class:"btn btn-xs btn-danger",title:v.$t("sidebar.removeStep")},[T(r(R),{icon:"carbon:trash-can",width:"12"})],8,uu)])]),s("div",pu,[s("div",hu,[s("label",mu,i(v.$t("sidebar.agent")),1),s("div",fu,[de(s("select",{"onUpdate:modelValue":f=>$.agentName=f,class:"form-select agent-select"},[s("option",vu,i(v.$t("sidebar.selectAgent")),1),E[10]||(E[10]=qo('<option value="DEFAULT_AGENT" data-v-91f01967>DEFAULT_AGENT</option><option value="BROWSER_AGENT" data-v-91f01967>BROWSER_AGENT</option><option value="TEXT_FILE_AGENT" data-v-91f01967>TEXT_FILE_AGENT</option><option value="JSX_GENERATOR_AGENT" data-v-91f01967>JSX_GENERATOR_AGENT</option><option value="FILE_MANAGER_AGENT" data-v-91f01967>FILE_MANAGER_AGENT</option>',5))],8,gu),[[Dt,$.agentName]]),s("button",{onClick:E[1]||(E[1]=(...f)=>r(d)&&r(d)(...f)),class:"btn btn-sm btn-add-step",title:v.$t("sidebar.addStep")},[T(r(R),{icon:"carbon:add",width:"14"})],8,bu)])]),s("div",yu,[s("label",_u,i(v.$t("sidebar.stepRequirement")),1),de(s("textarea",{"onUpdate:modelValue":f=>$.stepContent=f,class:"form-textarea auto-resize",placeholder:v.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:E[2]||(E[2]=f=>y(f))},null,40,Su),[[ve,$.stepContent]])]),s("div",wu,[s("label",$u,i(v.$t("sidebar.terminateColumns")),1),de(s("input",{"onUpdate:modelValue":f=>$.terminateColumns=f,type:"text",class:"form-input",placeholder:v.$t("sidebar.terminateColumnsPlaceholder")},null,8,Pu),[[ve,$.terminateColumns]])])])]))),128)),r(l).steps.length===0?(p(),g("div",ku,[T(r(R),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),s("p",null,i(v.$t("sidebar.noSteps")),1),s("button",{onClick:E[3]||(E[3]=(...$)=>r(d)&&r(d)(...$)),class:"btn btn-primary"},[T(r(R),{icon:"carbon:add",width:"14"}),re(" "+i(v.$t("sidebar.addFirstStep")),1)])])):L("",!0)])]),s("div",Eu,[s("div",Cu,[s("label",Tu,i(v.$t("sidebar.planId")),1),de(s("input",{"onUpdate:modelValue":E[4]||(E[4]=$=>r(l).planTemplateId=$),type:"text",class:"form-input",placeholder:"planTemplate-1756109892045"},null,512),[[ve,r(l).planTemplateId]])])]),r(a)?(p(),g("div",Ru,[s("div",Iu,[s("label",Au,i(v.$t("sidebar.jsonPreview")),1),s("button",{onClick:E[5]||(E[5]=(...$)=>r(P)&&r(P)(...$)),class:"btn btn-xs"},[T(r(R),{icon:"carbon:close",width:"12"})])]),s("pre",xu,i(r(c)),1)])):L("",!0),s("div",Mu,[s("button",{onClick:E[6]||(E[6]=(...$)=>r(A)&&r(A)(...$)),class:"btn btn-sm btn-secondary"},[T(r(R),{icon:"carbon:code",width:"14"}),re(" "+i(r(a)?v.$t("sidebar.hideJson"):v.$t("sidebar.showJson")),1)]),s("div",Fu,[s("button",{class:"btn btn-sm",onClick:E[7]||(E[7]=(...$)=>r(b)&&r(b)(...$)),disabled:!(v.canRollback??!1),title:v.$t("sidebar.rollback")},[T(r(R),{icon:"carbon:undo",width:"14"})],8,Du),s("button",{class:"btn btn-sm",onClick:E[8]||(E[8]=(...$)=>r(F)&&r(F)(...$)),disabled:!(v.canRestore??!1),title:v.$t("sidebar.restore")},[T(r(R),{icon:"carbon:redo",width:"14"})],8,Nu),s("button",{class:"btn btn-primary",onClick:E[9]||(E[9]=(...$)=>r(N)&&r(N)(...$)),disabled:v.isGenerating||v.isExecuting},[T(r(R),{icon:"carbon:save",width:"14"}),E[11]||(E[11]=re(" Save "))],8,Uu)])])])]))}}),Ou=ye(Lu,[["__scopeId","data-v-91f01967"]]);function uo(n,e){return function(){return n.apply(e,arguments)}}const{toString:Bu}=Object.prototype,{getPrototypeOf:Ot}=Object,{iterator:ft,toStringTag:po}=Symbol,gt=(n=>e=>{const o=Bu.call(e);return n[o]||(n[o]=o.slice(8,-1).toLowerCase())})(Object.create(null)),De=n=>(n=n.toLowerCase(),e=>gt(e)===n),vt=n=>e=>typeof e===n,{isArray:Xe}=Array,st=vt("undefined");function qu(n){return n!==null&&!st(n)&&n.constructor!==null&&!st(n.constructor)&&Te(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const ho=De("ArrayBuffer");function ju(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&ho(n.buffer),e}const Vu=vt("string"),Te=vt("function"),mo=vt("number"),bt=n=>n!==null&&typeof n=="object",Gu=n=>n===!0||n===!1,it=n=>{if(gt(n)!=="object")return!1;const e=Ot(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(po in n)&&!(ft in n)},Hu=De("Date"),Ju=De("File"),Wu=De("Blob"),zu=De("FileList"),Ku=n=>bt(n)&&Te(n.pipe),Xu=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||Te(n.append)&&((e=gt(n))==="formdata"||e==="object"&&Te(n.toString)&&n.toString()==="[object FormData]"))},Qu=De("URLSearchParams"),[Yu,Zu,ep,tp]=["ReadableStream","Request","Response","Headers"].map(De),op=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function at(n,e,{allOwnKeys:o=!1}={}){if(n===null||typeof n>"u")return;let t,a;if(typeof n!="object"&&(n=[n]),Xe(n))for(t=0,a=n.length;t<a;t++)e.call(null,n[t],t,n);else{const l=o?Object.getOwnPropertyNames(n):Object.keys(n),c=l.length;let d;for(t=0;t<c;t++)d=l[t],e.call(null,n[d],d,n)}}function fo(n,e){e=e.toLowerCase();const o=Object.keys(n);let t=o.length,a;for(;t-- >0;)if(a=o[t],e===a.toLowerCase())return a;return null}const He=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,go=n=>!st(n)&&n!==He;function Rt(){const{caseless:n}=go(this)&&this||{},e={},o=(t,a)=>{const l=n&&fo(e,a)||a;it(e[l])&&it(t)?e[l]=Rt(e[l],t):it(t)?e[l]=Rt({},t):Xe(t)?e[l]=t.slice():e[l]=t};for(let t=0,a=arguments.length;t<a;t++)arguments[t]&&at(arguments[t],o);return e}const sp=(n,e,o,{allOwnKeys:t}={})=>(at(e,(a,l)=>{o&&Te(a)?n[l]=uo(a,o):n[l]=a},{allOwnKeys:t}),n),np=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),ap=(n,e,o,t)=>{n.prototype=Object.create(e.prototype,t),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),o&&Object.assign(n.prototype,o)},lp=(n,e,o,t)=>{let a,l,c;const d={};if(e=e||{},n==null)return e;do{for(a=Object.getOwnPropertyNames(n),l=a.length;l-- >0;)c=a[l],(!t||t(c,n,e))&&!d[c]&&(e[c]=n[c],d[c]=!0);n=o!==!1&&Ot(n)}while(n&&(!o||o(n,e))&&n!==Object.prototype);return e},rp=(n,e,o)=>{n=String(n),(o===void 0||o>n.length)&&(o=n.length),o-=e.length;const t=n.indexOf(e,o);return t!==-1&&t===o},ip=n=>{if(!n)return null;if(Xe(n))return n;let e=n.length;if(!mo(e))return null;const o=new Array(e);for(;e-- >0;)o[e]=n[e];return o},cp=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&Ot(Uint8Array)),dp=(n,e)=>{const t=(n&&n[ft]).call(n);let a;for(;(a=t.next())&&!a.done;){const l=a.value;e.call(n,l[0],l[1])}},up=(n,e)=>{let o;const t=[];for(;(o=n.exec(e))!==null;)t.push(o);return t},pp=De("HTMLFormElement"),hp=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(o,t,a){return t.toUpperCase()+a}),Vt=(({hasOwnProperty:n})=>(e,o)=>n.call(e,o))(Object.prototype),mp=De("RegExp"),vo=(n,e)=>{const o=Object.getOwnPropertyDescriptors(n),t={};at(o,(a,l)=>{let c;(c=e(a,l,n))!==!1&&(t[l]=c||a)}),Object.defineProperties(n,t)},fp=n=>{vo(n,(e,o)=>{if(Te(n)&&["arguments","caller","callee"].indexOf(o)!==-1)return!1;const t=n[o];if(Te(t)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+o+"'")})}})},gp=(n,e)=>{const o={},t=a=>{a.forEach(l=>{o[l]=!0})};return Xe(n)?t(n):t(String(n).split(e)),o},vp=()=>{},bp=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e;function yp(n){return!!(n&&Te(n.append)&&n[po]==="FormData"&&n[ft])}const _p=n=>{const e=new Array(10),o=(t,a)=>{if(bt(t)){if(e.indexOf(t)>=0)return;if(!("toJSON"in t)){e[a]=t;const l=Xe(t)?[]:{};return at(t,(c,d)=>{const m=o(c,a+1);!st(m)&&(l[d]=m)}),e[a]=void 0,l}}return t};return o(n,0)},Sp=De("AsyncFunction"),wp=n=>n&&(bt(n)||Te(n))&&Te(n.then)&&Te(n.catch),bo=((n,e)=>n?setImmediate:e?((o,t)=>(He.addEventListener("message",({source:a,data:l})=>{a===He&&l===o&&t.length&&t.shift()()},!1),a=>{t.push(a),He.postMessage(o,"*")}))(`axios@${Math.random()}`,[]):o=>setTimeout(o))(typeof setImmediate=="function",Te(He.postMessage)),$p=typeof queueMicrotask<"u"?queueMicrotask.bind(He):typeof process<"u"&&process.nextTick||bo,Pp=n=>n!=null&&Te(n[ft]),I={isArray:Xe,isArrayBuffer:ho,isBuffer:qu,isFormData:Xu,isArrayBufferView:ju,isString:Vu,isNumber:mo,isBoolean:Gu,isObject:bt,isPlainObject:it,isReadableStream:Yu,isRequest:Zu,isResponse:ep,isHeaders:tp,isUndefined:st,isDate:Hu,isFile:Ju,isBlob:Wu,isRegExp:mp,isFunction:Te,isStream:Ku,isURLSearchParams:Qu,isTypedArray:cp,isFileList:zu,forEach:at,merge:Rt,extend:sp,trim:op,stripBOM:np,inherits:ap,toFlatObject:lp,kindOf:gt,kindOfTest:De,endsWith:rp,toArray:ip,forEachEntry:dp,matchAll:up,isHTMLForm:pp,hasOwnProperty:Vt,hasOwnProp:Vt,reduceDescriptors:vo,freezeMethods:fp,toObjectSet:gp,toCamelCase:hp,noop:vp,toFiniteNumber:bp,findKey:fo,global:He,isContextDefined:go,isSpecCompliantForm:yp,toJSONObject:_p,isAsyncFn:Sp,isThenable:wp,setImmediate:bo,asap:$p,isIterable:Pp};function se(n,e,o,t,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),o&&(this.config=o),t&&(this.request=t),a&&(this.response=a,this.status=a.status?a.status:null)}I.inherits(se,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:I.toJSONObject(this.config),code:this.code,status:this.status}}});const yo=se.prototype,_o={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{_o[n]={value:n}});Object.defineProperties(se,_o);Object.defineProperty(yo,"isAxiosError",{value:!0});se.from=(n,e,o,t,a,l)=>{const c=Object.create(yo);return I.toFlatObject(n,c,function(m){return m!==Error.prototype},d=>d!=="isAxiosError"),se.call(c,n.message,e,o,t,a),c.cause=n,c.name=n.name,l&&Object.assign(c,l),c};const kp=null;function It(n){return I.isPlainObject(n)||I.isArray(n)}function So(n){return I.endsWith(n,"[]")?n.slice(0,-2):n}function Gt(n,e,o){return n?n.concat(e).map(function(a,l){return a=So(a),!o&&l?"["+a+"]":a}).join(o?".":""):e}function Ep(n){return I.isArray(n)&&!n.some(It)}const Cp=I.toFlatObject(I,{},null,function(e){return/^is[A-Z]/.test(e)});function yt(n,e,o){if(!I.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,o=I.toFlatObject(o,{metaTokens:!0,dots:!1,indexes:!1},!1,function(P,y){return!I.isUndefined(y[P])});const t=o.metaTokens,a=o.visitor||h,l=o.dots,c=o.indexes,m=(o.Blob||typeof Blob<"u"&&Blob)&&I.isSpecCompliantForm(e);if(!I.isFunction(a))throw new TypeError("visitor must be a function");function u(A){if(A===null)return"";if(I.isDate(A))return A.toISOString();if(!m&&I.isBlob(A))throw new se("Blob is not supported. Use a Buffer instead.");return I.isArrayBuffer(A)||I.isTypedArray(A)?m&&typeof Blob=="function"?new Blob([A]):Buffer.from(A):A}function h(A,P,y){let v=A;if(A&&!y&&typeof A=="object"){if(I.endsWith(P,"{}"))P=t?P:P.slice(0,-2),A=JSON.stringify(A);else if(I.isArray(A)&&Ep(A)||(I.isFileList(A)||I.endsWith(P,"[]"))&&(v=I.toArray(A)))return P=So(P),v.forEach(function($,_){!(I.isUndefined($)||$===null)&&e.append(c===!0?Gt([P],_,l):c===null?P:P+"[]",u($))}),!1}return It(A)?!0:(e.append(Gt(y,P,l),u(A)),!1)}const b=[],F=Object.assign(Cp,{defaultVisitor:h,convertValue:u,isVisitable:It});function N(A,P){if(!I.isUndefined(A)){if(b.indexOf(A)!==-1)throw Error("Circular reference detected in "+P.join("."));b.push(A),I.forEach(A,function(v,E){(!(I.isUndefined(v)||v===null)&&a.call(e,v,I.isString(E)?E.trim():E,P,F))===!0&&N(v,P?P.concat(E):[E])}),b.pop()}}if(!I.isObject(n))throw new TypeError("data must be an object");return N(n),e}function Ht(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(t){return e[t]})}function Bt(n,e){this._pairs=[],n&&yt(n,this,e)}const wo=Bt.prototype;wo.append=function(e,o){this._pairs.push([e,o])};wo.toString=function(e){const o=e?function(t){return e.call(this,t,Ht)}:Ht;return this._pairs.map(function(a){return o(a[0])+"="+o(a[1])},"").join("&")};function Tp(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function $o(n,e,o){if(!e)return n;const t=o&&o.encode||Tp;I.isFunction(o)&&(o={serialize:o});const a=o&&o.serialize;let l;if(a?l=a(e,o):l=I.isURLSearchParams(e)?e.toString():new Bt(e,o).toString(t),l){const c=n.indexOf("#");c!==-1&&(n=n.slice(0,c)),n+=(n.indexOf("?")===-1?"?":"&")+l}return n}class Jt{constructor(){this.handlers=[]}use(e,o,t){return this.handlers.push({fulfilled:e,rejected:o,synchronous:t?t.synchronous:!1,runWhen:t?t.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){I.forEach(this.handlers,function(t){t!==null&&e(t)})}}const Po={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Rp=typeof URLSearchParams<"u"?URLSearchParams:Bt,Ip=typeof FormData<"u"?FormData:null,Ap=typeof Blob<"u"?Blob:null,xp={isBrowser:!0,classes:{URLSearchParams:Rp,FormData:Ip,Blob:Ap},protocols:["http","https","file","blob","url","data"]},qt=typeof window<"u"&&typeof document<"u",At=typeof navigator=="object"&&navigator||void 0,Mp=qt&&(!At||["ReactNative","NativeScript","NS"].indexOf(At.product)<0),Fp=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Dp=qt&&window.location.href||"http://localhost",Np=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:qt,hasStandardBrowserEnv:Mp,hasStandardBrowserWebWorkerEnv:Fp,navigator:At,origin:Dp},Symbol.toStringTag,{value:"Module"})),Ee={...Np,...xp};function Up(n,e){return yt(n,new Ee.classes.URLSearchParams,Object.assign({visitor:function(o,t,a,l){return Ee.isNode&&I.isBuffer(o)?(this.append(t,o.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)}},e))}function Lp(n){return I.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Op(n){const e={},o=Object.keys(n);let t;const a=o.length;let l;for(t=0;t<a;t++)l=o[t],e[l]=n[l];return e}function ko(n){function e(o,t,a,l){let c=o[l++];if(c==="__proto__")return!0;const d=Number.isFinite(+c),m=l>=o.length;return c=!c&&I.isArray(a)?a.length:c,m?(I.hasOwnProp(a,c)?a[c]=[a[c],t]:a[c]=t,!d):((!a[c]||!I.isObject(a[c]))&&(a[c]=[]),e(o,t,a[c],l)&&I.isArray(a[c])&&(a[c]=Op(a[c])),!d)}if(I.isFormData(n)&&I.isFunction(n.entries)){const o={};return I.forEachEntry(n,(t,a)=>{e(Lp(t),a,o,0)}),o}return null}function Bp(n,e,o){if(I.isString(n))try{return(e||JSON.parse)(n),I.trim(n)}catch(t){if(t.name!=="SyntaxError")throw t}return(o||JSON.stringify)(n)}const lt={transitional:Po,adapter:["xhr","http","fetch"],transformRequest:[function(e,o){const t=o.getContentType()||"",a=t.indexOf("application/json")>-1,l=I.isObject(e);if(l&&I.isHTMLForm(e)&&(e=new FormData(e)),I.isFormData(e))return a?JSON.stringify(ko(e)):e;if(I.isArrayBuffer(e)||I.isBuffer(e)||I.isStream(e)||I.isFile(e)||I.isBlob(e)||I.isReadableStream(e))return e;if(I.isArrayBufferView(e))return e.buffer;if(I.isURLSearchParams(e))return o.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let d;if(l){if(t.indexOf("application/x-www-form-urlencoded")>-1)return Up(e,this.formSerializer).toString();if((d=I.isFileList(e))||t.indexOf("multipart/form-data")>-1){const m=this.env&&this.env.FormData;return yt(d?{"files[]":e}:e,m&&new m,this.formSerializer)}}return l||a?(o.setContentType("application/json",!1),Bp(e)):e}],transformResponse:[function(e){const o=this.transitional||lt.transitional,t=o&&o.forcedJSONParsing,a=this.responseType==="json";if(I.isResponse(e)||I.isReadableStream(e))return e;if(e&&I.isString(e)&&(t&&!this.responseType||a)){const c=!(o&&o.silentJSONParsing)&&a;try{return JSON.parse(e)}catch(d){if(c)throw d.name==="SyntaxError"?se.from(d,se.ERR_BAD_RESPONSE,this,null,this.response):d}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ee.classes.FormData,Blob:Ee.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};I.forEach(["delete","get","head","post","put","patch"],n=>{lt.headers[n]={}});const qp=I.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),jp=n=>{const e={};let o,t,a;return n&&n.split(`
`).forEach(function(c){a=c.indexOf(":"),o=c.substring(0,a).trim().toLowerCase(),t=c.substring(a+1).trim(),!(!o||e[o]&&qp[o])&&(o==="set-cookie"?e[o]?e[o].push(t):e[o]=[t]:e[o]=e[o]?e[o]+", "+t:t)}),e},Wt=Symbol("internals");function Ze(n){return n&&String(n).trim().toLowerCase()}function ct(n){return n===!1||n==null?n:I.isArray(n)?n.map(ct):String(n)}function Vp(n){const e=Object.create(null),o=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let t;for(;t=o.exec(n);)e[t[1]]=t[2];return e}const Gp=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function $t(n,e,o,t,a){if(I.isFunction(t))return t.call(this,e,o);if(a&&(e=o),!!I.isString(e)){if(I.isString(t))return e.indexOf(t)!==-1;if(I.isRegExp(t))return t.test(e)}}function Hp(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,o,t)=>o.toUpperCase()+t)}function Jp(n,e){const o=I.toCamelCase(" "+e);["get","set","has"].forEach(t=>{Object.defineProperty(n,t+o,{value:function(a,l,c){return this[t].call(this,e,a,l,c)},configurable:!0})})}let Re=class{constructor(e){e&&this.set(e)}set(e,o,t){const a=this;function l(d,m,u){const h=Ze(m);if(!h)throw new Error("header name must be a non-empty string");const b=I.findKey(a,h);(!b||a[b]===void 0||u===!0||u===void 0&&a[b]!==!1)&&(a[b||m]=ct(d))}const c=(d,m)=>I.forEach(d,(u,h)=>l(u,h,m));if(I.isPlainObject(e)||e instanceof this.constructor)c(e,o);else if(I.isString(e)&&(e=e.trim())&&!Gp(e))c(jp(e),o);else if(I.isObject(e)&&I.isIterable(e)){let d={},m,u;for(const h of e){if(!I.isArray(h))throw TypeError("Object iterator must return a key-value pair");d[u=h[0]]=(m=d[u])?I.isArray(m)?[...m,h[1]]:[m,h[1]]:h[1]}c(d,o)}else e!=null&&l(o,e,t);return this}get(e,o){if(e=Ze(e),e){const t=I.findKey(this,e);if(t){const a=this[t];if(!o)return a;if(o===!0)return Vp(a);if(I.isFunction(o))return o.call(this,a,t);if(I.isRegExp(o))return o.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,o){if(e=Ze(e),e){const t=I.findKey(this,e);return!!(t&&this[t]!==void 0&&(!o||$t(this,this[t],t,o)))}return!1}delete(e,o){const t=this;let a=!1;function l(c){if(c=Ze(c),c){const d=I.findKey(t,c);d&&(!o||$t(t,t[d],d,o))&&(delete t[d],a=!0)}}return I.isArray(e)?e.forEach(l):l(e),a}clear(e){const o=Object.keys(this);let t=o.length,a=!1;for(;t--;){const l=o[t];(!e||$t(this,this[l],l,e,!0))&&(delete this[l],a=!0)}return a}normalize(e){const o=this,t={};return I.forEach(this,(a,l)=>{const c=I.findKey(t,l);if(c){o[c]=ct(a),delete o[l];return}const d=e?Hp(l):String(l).trim();d!==l&&delete o[l],o[d]=ct(a),t[d]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const o=Object.create(null);return I.forEach(this,(t,a)=>{t!=null&&t!==!1&&(o[a]=e&&I.isArray(t)?t.join(", "):t)}),o}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,o])=>e+": "+o).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...o){const t=new this(e);return o.forEach(a=>t.set(a)),t}static accessor(e){const t=(this[Wt]=this[Wt]={accessors:{}}).accessors,a=this.prototype;function l(c){const d=Ze(c);t[d]||(Jp(a,c),t[d]=!0)}return I.isArray(e)?e.forEach(l):l(e),this}};Re.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);I.reduceDescriptors(Re.prototype,({value:n},e)=>{let o=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(t){this[o]=t}}});I.freezeMethods(Re);function Pt(n,e){const o=this||lt,t=e||o,a=Re.from(t.headers);let l=t.data;return I.forEach(n,function(d){l=d.call(o,l,a.normalize(),e?e.status:void 0)}),a.normalize(),l}function Eo(n){return!!(n&&n.__CANCEL__)}function Qe(n,e,o){se.call(this,n??"canceled",se.ERR_CANCELED,e,o),this.name="CanceledError"}I.inherits(Qe,se,{__CANCEL__:!0});function Co(n,e,o){const t=o.config.validateStatus;!o.status||!t||t(o.status)?n(o):e(new se("Request failed with status code "+o.status,[se.ERR_BAD_REQUEST,se.ERR_BAD_RESPONSE][Math.floor(o.status/100)-4],o.config,o.request,o))}function Wp(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function zp(n,e){n=n||10;const o=new Array(n),t=new Array(n);let a=0,l=0,c;return e=e!==void 0?e:1e3,function(m){const u=Date.now(),h=t[l];c||(c=u),o[a]=m,t[a]=u;let b=l,F=0;for(;b!==a;)F+=o[b++],b=b%n;if(a=(a+1)%n,a===l&&(l=(l+1)%n),u-c<e)return;const N=h&&u-h;return N?Math.round(F*1e3/N):void 0}}function Kp(n,e){let o=0,t=1e3/e,a,l;const c=(u,h=Date.now())=>{o=h,a=null,l&&(clearTimeout(l),l=null),n.apply(null,u)};return[(...u)=>{const h=Date.now(),b=h-o;b>=t?c(u,h):(a=u,l||(l=setTimeout(()=>{l=null,c(a)},t-b)))},()=>a&&c(a)]}const pt=(n,e,o=3)=>{let t=0;const a=zp(50,250);return Kp(l=>{const c=l.loaded,d=l.lengthComputable?l.total:void 0,m=c-t,u=a(m),h=c<=d;t=c;const b={loaded:c,total:d,progress:d?c/d:void 0,bytes:m,rate:u||void 0,estimated:u&&d&&h?(d-c)/u:void 0,event:l,lengthComputable:d!=null,[e?"download":"upload"]:!0};n(b)},o)},zt=(n,e)=>{const o=n!=null;return[t=>e[0]({lengthComputable:o,total:n,loaded:t}),e[1]]},Kt=n=>(...e)=>I.asap(()=>n(...e)),Xp=Ee.hasStandardBrowserEnv?((n,e)=>o=>(o=new URL(o,Ee.origin),n.protocol===o.protocol&&n.host===o.host&&(e||n.port===o.port)))(new URL(Ee.origin),Ee.navigator&&/(msie|trident)/i.test(Ee.navigator.userAgent)):()=>!0,Qp=Ee.hasStandardBrowserEnv?{write(n,e,o,t,a,l){const c=[n+"="+encodeURIComponent(e)];I.isNumber(o)&&c.push("expires="+new Date(o).toGMTString()),I.isString(t)&&c.push("path="+t),I.isString(a)&&c.push("domain="+a),l===!0&&c.push("secure"),document.cookie=c.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Yp(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function Zp(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function To(n,e,o){let t=!Yp(e);return n&&(t||o==!1)?Zp(n,e):e}const Xt=n=>n instanceof Re?{...n}:n;function We(n,e){e=e||{};const o={};function t(u,h,b,F){return I.isPlainObject(u)&&I.isPlainObject(h)?I.merge.call({caseless:F},u,h):I.isPlainObject(h)?I.merge({},h):I.isArray(h)?h.slice():h}function a(u,h,b,F){if(I.isUndefined(h)){if(!I.isUndefined(u))return t(void 0,u,b,F)}else return t(u,h,b,F)}function l(u,h){if(!I.isUndefined(h))return t(void 0,h)}function c(u,h){if(I.isUndefined(h)){if(!I.isUndefined(u))return t(void 0,u)}else return t(void 0,h)}function d(u,h,b){if(b in e)return t(u,h);if(b in n)return t(void 0,u)}const m={url:l,method:l,data:l,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:d,headers:(u,h,b)=>a(Xt(u),Xt(h),b,!0)};return I.forEach(Object.keys(Object.assign({},n,e)),function(h){const b=m[h]||a,F=b(n[h],e[h],h);I.isUndefined(F)&&b!==d||(o[h]=F)}),o}const Ro=n=>{const e=We({},n);let{data:o,withXSRFToken:t,xsrfHeaderName:a,xsrfCookieName:l,headers:c,auth:d}=e;e.headers=c=Re.from(c),e.url=$o(To(e.baseURL,e.url,e.allowAbsoluteUrls),n.params,n.paramsSerializer),d&&c.set("Authorization","Basic "+btoa((d.username||"")+":"+(d.password?unescape(encodeURIComponent(d.password)):"")));let m;if(I.isFormData(o)){if(Ee.hasStandardBrowserEnv||Ee.hasStandardBrowserWebWorkerEnv)c.setContentType(void 0);else if((m=c.getContentType())!==!1){const[u,...h]=m?m.split(";").map(b=>b.trim()).filter(Boolean):[];c.setContentType([u||"multipart/form-data",...h].join("; "))}}if(Ee.hasStandardBrowserEnv&&(t&&I.isFunction(t)&&(t=t(e)),t||t!==!1&&Xp(e.url))){const u=a&&l&&Qp.read(l);u&&c.set(a,u)}return e},eh=typeof XMLHttpRequest<"u",th=eh&&function(n){return new Promise(function(o,t){const a=Ro(n);let l=a.data;const c=Re.from(a.headers).normalize();let{responseType:d,onUploadProgress:m,onDownloadProgress:u}=a,h,b,F,N,A;function P(){N&&N(),A&&A(),a.cancelToken&&a.cancelToken.unsubscribe(h),a.signal&&a.signal.removeEventListener("abort",h)}let y=new XMLHttpRequest;y.open(a.method.toUpperCase(),a.url,!0),y.timeout=a.timeout;function v(){if(!y)return;const $=Re.from("getAllResponseHeaders"in y&&y.getAllResponseHeaders()),f={data:!d||d==="text"||d==="json"?y.responseText:y.response,status:y.status,statusText:y.statusText,headers:$,config:n,request:y};Co(function(M){o(M),P()},function(M){t(M),P()},f),y=null}"onloadend"in y?y.onloadend=v:y.onreadystatechange=function(){!y||y.readyState!==4||y.status===0&&!(y.responseURL&&y.responseURL.indexOf("file:")===0)||setTimeout(v)},y.onabort=function(){y&&(t(new se("Request aborted",se.ECONNABORTED,n,y)),y=null)},y.onerror=function(){t(new se("Network Error",se.ERR_NETWORK,n,y)),y=null},y.ontimeout=function(){let _=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const f=a.transitional||Po;a.timeoutErrorMessage&&(_=a.timeoutErrorMessage),t(new se(_,f.clarifyTimeoutError?se.ETIMEDOUT:se.ECONNABORTED,n,y)),y=null},l===void 0&&c.setContentType(null),"setRequestHeader"in y&&I.forEach(c.toJSON(),function(_,f){y.setRequestHeader(f,_)}),I.isUndefined(a.withCredentials)||(y.withCredentials=!!a.withCredentials),d&&d!=="json"&&(y.responseType=a.responseType),u&&([F,A]=pt(u,!0),y.addEventListener("progress",F)),m&&y.upload&&([b,N]=pt(m),y.upload.addEventListener("progress",b),y.upload.addEventListener("loadend",N)),(a.cancelToken||a.signal)&&(h=$=>{y&&(t(!$||$.type?new Qe(null,n,y):$),y.abort(),y=null)},a.cancelToken&&a.cancelToken.subscribe(h),a.signal&&(a.signal.aborted?h():a.signal.addEventListener("abort",h)));const E=Wp(a.url);if(E&&Ee.protocols.indexOf(E)===-1){t(new se("Unsupported protocol "+E+":",se.ERR_BAD_REQUEST,n));return}y.send(l||null)})},oh=(n,e)=>{const{length:o}=n=n?n.filter(Boolean):[];if(e||o){let t=new AbortController,a;const l=function(u){if(!a){a=!0,d();const h=u instanceof Error?u:this.reason;t.abort(h instanceof se?h:new Qe(h instanceof Error?h.message:h))}};let c=e&&setTimeout(()=>{c=null,l(new se(`timeout ${e} of ms exceeded`,se.ETIMEDOUT))},e);const d=()=>{n&&(c&&clearTimeout(c),c=null,n.forEach(u=>{u.unsubscribe?u.unsubscribe(l):u.removeEventListener("abort",l)}),n=null)};n.forEach(u=>u.addEventListener("abort",l));const{signal:m}=t;return m.unsubscribe=()=>I.asap(d),m}},sh=function*(n,e){let o=n.byteLength;if(o<e){yield n;return}let t=0,a;for(;t<o;)a=t+e,yield n.slice(t,a),t=a},nh=async function*(n,e){for await(const o of ah(n))yield*sh(o,e)},ah=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:o,value:t}=await e.read();if(o)break;yield t}}finally{await e.cancel()}},Qt=(n,e,o,t)=>{const a=nh(n,e);let l=0,c,d=m=>{c||(c=!0,t&&t(m))};return new ReadableStream({async pull(m){try{const{done:u,value:h}=await a.next();if(u){d(),m.close();return}let b=h.byteLength;if(o){let F=l+=b;o(F)}m.enqueue(new Uint8Array(h))}catch(u){throw d(u),u}},cancel(m){return d(m),a.return()}},{highWaterMark:2})},_t=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Io=_t&&typeof ReadableStream=="function",lh=_t&&(typeof TextEncoder=="function"?(n=>e=>n.encode(e))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),Ao=(n,...e)=>{try{return!!n(...e)}catch{return!1}},rh=Io&&Ao(()=>{let n=!1;const e=new Request(Ee.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e}),Yt=64*1024,xt=Io&&Ao(()=>I.isReadableStream(new Response("").body)),ht={stream:xt&&(n=>n.body)};_t&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!ht[e]&&(ht[e]=I.isFunction(n[e])?o=>o[e]():(o,t)=>{throw new se(`Response type '${e}' is not supported`,se.ERR_NOT_SUPPORT,t)})})})(new Response);const ih=async n=>{if(n==null)return 0;if(I.isBlob(n))return n.size;if(I.isSpecCompliantForm(n))return(await new Request(Ee.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(I.isArrayBufferView(n)||I.isArrayBuffer(n))return n.byteLength;if(I.isURLSearchParams(n)&&(n=n+""),I.isString(n))return(await lh(n)).byteLength},ch=async(n,e)=>{const o=I.toFiniteNumber(n.getContentLength());return o??ih(e)},dh=_t&&(async n=>{let{url:e,method:o,data:t,signal:a,cancelToken:l,timeout:c,onDownloadProgress:d,onUploadProgress:m,responseType:u,headers:h,withCredentials:b="same-origin",fetchOptions:F}=Ro(n);u=u?(u+"").toLowerCase():"text";let N=oh([a,l&&l.toAbortSignal()],c),A;const P=N&&N.unsubscribe&&(()=>{N.unsubscribe()});let y;try{if(m&&rh&&o!=="get"&&o!=="head"&&(y=await ch(h,t))!==0){let f=new Request(e,{method:"POST",body:t,duplex:"half"}),w;if(I.isFormData(t)&&(w=f.headers.get("content-type"))&&h.setContentType(w),f.body){const[M,q]=zt(y,pt(Kt(m)));t=Qt(f.body,Yt,M,q)}}I.isString(b)||(b=b?"include":"omit");const v="credentials"in Request.prototype;A=new Request(e,{...F,signal:N,method:o.toUpperCase(),headers:h.normalize().toJSON(),body:t,duplex:"half",credentials:v?b:void 0});let E=await fetch(A);const $=xt&&(u==="stream"||u==="response");if(xt&&(d||$&&P)){const f={};["status","statusText","headers"].forEach(k=>{f[k]=E[k]});const w=I.toFiniteNumber(E.headers.get("content-length")),[M,q]=d&&zt(w,pt(Kt(d),!0))||[];E=new Response(Qt(E.body,Yt,M,()=>{q&&q(),P&&P()}),f)}u=u||"text";let _=await ht[I.findKey(ht,u)||"text"](E,n);return!$&&P&&P(),await new Promise((f,w)=>{Co(f,w,{data:_,headers:Re.from(E.headers),status:E.status,statusText:E.statusText,config:n,request:A})})}catch(v){throw P&&P(),v&&v.name==="TypeError"&&/Load failed|fetch/i.test(v.message)?Object.assign(new se("Network Error",se.ERR_NETWORK,n,A),{cause:v.cause||v}):se.from(v,v&&v.code,n,A)}}),Mt={http:kp,xhr:th,fetch:dh};I.forEach(Mt,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const Zt=n=>`- ${n}`,uh=n=>I.isFunction(n)||n===null||n===!1,xo={getAdapter:n=>{n=I.isArray(n)?n:[n];const{length:e}=n;let o,t;const a={};for(let l=0;l<e;l++){o=n[l];let c;if(t=o,!uh(o)&&(t=Mt[(c=String(o)).toLowerCase()],t===void 0))throw new se(`Unknown adapter '${c}'`);if(t)break;a[c||"#"+l]=t}if(!t){const l=Object.entries(a).map(([d,m])=>`adapter ${d} `+(m===!1?"is not supported by the environment":"is not available in the build"));let c=e?l.length>1?`since :
`+l.map(Zt).join(`
`):" "+Zt(l[0]):"as no adapter specified";throw new se("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return t},adapters:Mt};function kt(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Qe(null,n)}function eo(n){return kt(n),n.headers=Re.from(n.headers),n.data=Pt.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),xo.getAdapter(n.adapter||lt.adapter)(n).then(function(t){return kt(n),t.data=Pt.call(n,n.transformResponse,t),t.headers=Re.from(t.headers),t},function(t){return Eo(t)||(kt(n),t&&t.response&&(t.response.data=Pt.call(n,n.transformResponse,t.response),t.response.headers=Re.from(t.response.headers))),Promise.reject(t)})}const Mo="1.9.0",St={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{St[n]=function(t){return typeof t===n||"a"+(e<1?"n ":" ")+n}});const to={};St.transitional=function(e,o,t){function a(l,c){return"[Axios v"+Mo+"] Transitional option '"+l+"'"+c+(t?". "+t:"")}return(l,c,d)=>{if(e===!1)throw new se(a(c," has been removed"+(o?" in "+o:"")),se.ERR_DEPRECATED);return o&&!to[c]&&(to[c]=!0,console.warn(a(c," has been deprecated since v"+o+" and will be removed in the near future"))),e?e(l,c,d):!0}};St.spelling=function(e){return(o,t)=>(console.warn(`${t} is likely a misspelling of ${e}`),!0)};function ph(n,e,o){if(typeof n!="object")throw new se("options must be an object",se.ERR_BAD_OPTION_VALUE);const t=Object.keys(n);let a=t.length;for(;a-- >0;){const l=t[a],c=e[l];if(c){const d=n[l],m=d===void 0||c(d,l,n);if(m!==!0)throw new se("option "+l+" must be "+m,se.ERR_BAD_OPTION_VALUE);continue}if(o!==!0)throw new se("Unknown option "+l,se.ERR_BAD_OPTION)}}const dt={assertOptions:ph,validators:St},Ne=dt.validators;let Je=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Jt,response:new Jt}}async request(e,o){try{return await this._request(e,o)}catch(t){if(t instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const l=a.stack?a.stack.replace(/^.+\n/,""):"";try{t.stack?l&&!String(t.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(t.stack+=`
`+l):t.stack=l}catch{}}throw t}}_request(e,o){typeof e=="string"?(o=o||{},o.url=e):o=e||{},o=We(this.defaults,o);const{transitional:t,paramsSerializer:a,headers:l}=o;t!==void 0&&dt.assertOptions(t,{silentJSONParsing:Ne.transitional(Ne.boolean),forcedJSONParsing:Ne.transitional(Ne.boolean),clarifyTimeoutError:Ne.transitional(Ne.boolean)},!1),a!=null&&(I.isFunction(a)?o.paramsSerializer={serialize:a}:dt.assertOptions(a,{encode:Ne.function,serialize:Ne.function},!0)),o.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?o.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:o.allowAbsoluteUrls=!0),dt.assertOptions(o,{baseUrl:Ne.spelling("baseURL"),withXsrfToken:Ne.spelling("withXSRFToken")},!0),o.method=(o.method||this.defaults.method||"get").toLowerCase();let c=l&&I.merge(l.common,l[o.method]);l&&I.forEach(["delete","get","head","post","put","patch","common"],A=>{delete l[A]}),o.headers=Re.concat(c,l);const d=[];let m=!0;this.interceptors.request.forEach(function(P){typeof P.runWhen=="function"&&P.runWhen(o)===!1||(m=m&&P.synchronous,d.unshift(P.fulfilled,P.rejected))});const u=[];this.interceptors.response.forEach(function(P){u.push(P.fulfilled,P.rejected)});let h,b=0,F;if(!m){const A=[eo.bind(this),void 0];for(A.unshift.apply(A,d),A.push.apply(A,u),F=A.length,h=Promise.resolve(o);b<F;)h=h.then(A[b++],A[b++]);return h}F=d.length;let N=o;for(b=0;b<F;){const A=d[b++],P=d[b++];try{N=A(N)}catch(y){P.call(this,y);break}}try{h=eo.call(this,N)}catch(A){return Promise.reject(A)}for(b=0,F=u.length;b<F;)h=h.then(u[b++],u[b++]);return h}getUri(e){e=We(this.defaults,e);const o=To(e.baseURL,e.url,e.allowAbsoluteUrls);return $o(o,e.params,e.paramsSerializer)}};I.forEach(["delete","get","head","options"],function(e){Je.prototype[e]=function(o,t){return this.request(We(t||{},{method:e,url:o,data:(t||{}).data}))}});I.forEach(["post","put","patch"],function(e){function o(t){return function(l,c,d){return this.request(We(d||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:l,data:c}))}}Je.prototype[e]=o(),Je.prototype[e+"Form"]=o(!0)});let hh=class Fo{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let o;this.promise=new Promise(function(l){o=l});const t=this;this.promise.then(a=>{if(!t._listeners)return;let l=t._listeners.length;for(;l-- >0;)t._listeners[l](a);t._listeners=null}),this.promise.then=a=>{let l;const c=new Promise(d=>{t.subscribe(d),l=d}).then(a);return c.cancel=function(){t.unsubscribe(l)},c},e(function(l,c,d){t.reason||(t.reason=new Qe(l,c,d),o(t.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const o=this._listeners.indexOf(e);o!==-1&&this._listeners.splice(o,1)}toAbortSignal(){const e=new AbortController,o=t=>{e.abort(t)};return this.subscribe(o),e.signal.unsubscribe=()=>this.unsubscribe(o),e.signal}static source(){let e;return{token:new Fo(function(a){e=a}),cancel:e}}};function mh(n){return function(o){return n.apply(null,o)}}function fh(n){return I.isObject(n)&&n.isAxiosError===!0}const Ft={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ft).forEach(([n,e])=>{Ft[e]=n});function Do(n){const e=new Je(n),o=uo(Je.prototype.request,e);return I.extend(o,Je.prototype,e,{allOwnKeys:!0}),I.extend(o,e,null,{allOwnKeys:!0}),o.create=function(a){return Do(We(n,a))},o}const we=Do(lt);we.Axios=Je;we.CanceledError=Qe;we.CancelToken=hh;we.isCancel=Eo;we.VERSION=Mo;we.toFormData=yt;we.AxiosError=se;we.Cancel=we.CanceledError;we.all=function(e){return Promise.all(e)};we.spread=mh;we.isAxiosError=fh;we.mergeConfig=We;we.AxiosHeaders=Re;we.formToJSON=n=>ko(I.isHTMLForm(n)?new FormData(n):n);we.getAdapter=xo.getAdapter;we.HttpStatusCode=Ft;we.default=we;const{Axios:dg,AxiosError:ug,CanceledError:pg,isCancel:hg,CancelToken:mg,VERSION:fg,all:gg,Cancel:vg,isAxiosError:bg,spread:yg,toFormData:_g,AxiosHeaders:Sg,HttpStatusCode:wg,formToJSON:$g,getAdapter:Pg,mergeConfig:kg}=we;class gh{static async getAvailableModels(){try{return(await we({url:"/api/models/available-models",method:"GET",baseURL:""})).data}catch(e){return console.error("Failed to fetch available models:",e),{options:[],total:0}}}}const vh={class:"assigned-tools"},bh={class:"section-header"},yh={class:"tool-info"},_h={class:"tool-name"},Sh={class:"tool-desc"},wh={key:0,class:"no-tools"},$h=be({__name:"AssignedTools",props:{title:{},selectedToolIds:{},availableTools:{},addButtonText:{default:"Add/Remove Tools"},emptyText:{default:"No tools assigned"},showAddButton:{type:Boolean,default:!0},useGridLayout:{type:Boolean,default:!1}},emits:["add-tools","tools-filtered"],setup(n,{emit:e}){const o=n,t=e,a=he(()=>o.selectedToolIds.filter(d=>o.availableTools.some(m=>m.key===d)));fe(a,d=>{d.length!==o.selectedToolIds.length&&t("tools-filtered",d)},{immediate:!0});const l=d=>{const m=o.availableTools.find(h=>h.key===d);return m?`${m.serviceGroup||"Ungrouped"}.${m.name}`:d},c=d=>{const m=o.availableTools.find(u=>u.key===d);return m?m.description:""};return(d,m)=>(p(),g("div",vh,[s("div",bh,[s("span",null,i(d.title)+" ("+i(a.value.length)+")",1),d.showAddButton?(p(),g("button",{key:0,class:"action-btn small",onClick:m[0]||(m[0]=u=>d.$emit("add-tools"))},[T(r(R),{icon:"carbon:add"}),re(" "+i(d.addButtonText),1)])):L("",!0)]),s("div",{class:le(["tools-grid",{"grid-layout":d.useGridLayout}])},[(p(!0),g(ue,null,me(a.value,u=>(p(),g("div",{key:u,class:"tool-item assigned"},[s("div",yh,[s("span",_h,i(l(u)),1),s("span",Sh,i(c(u)),1)])]))),128)),a.value.length===0?(p(),g("div",wh,[T(r(R),{icon:"carbon:tool-box"}),s("span",null,i(d.emptyText),1)])):L("",!0)],2)]))}}),Ph=ye($h,[["__scopeId","data-v-0033a342"]]),kh={class:"tool-selection-content"},Eh={class:"tool-controls"},Ch={class:"search-container"},Th=["placeholder"],Rh={class:"sort-container"},Ih={value:"group"},Ah={value:"name"},xh={value:"enabled"},Mh={class:"tool-summary"},Fh={class:"summary-text"},Dh={key:0,class:"tool-groups"},Nh=["onClick"],Uh={class:"group-title-area"},Lh={class:"group-name"},Oh={class:"group-count"},Bh={class:"group-enable-all"},qh=["checked","onChange","data-group"],jh={class:"enable-label"},Vh={class:"tool-info"},Gh={class:"tool-selection-name"},Hh={key:0,class:"tool-selection-desc"},Jh={class:"tool-actions"},Wh=["checked","onChange"],zh={key:1,class:"empty-state"},Kh=be({__name:"ToolSelectionModal",props:{modelValue:{type:Boolean},tools:{},selectedToolIds:{}},emits:["update:modelValue","confirm"],setup(n,{emit:e}){const o=n,t=e,a=he({get:()=>o.modelValue,set:w=>t("update:modelValue",w)}),l=D(""),c=D("group"),d=D(new Set),m=D([]),u=(w,M)=>{const q=document.querySelector(`input[data-group="${w}"]`);q&&(q.indeterminate=v(M))};fe(()=>o.selectedToolIds,w=>{m.value=[...w]},{immediate:!0});const h=he(()=>{let w=o.tools.filter(M=>M.key);if(w=w.filter(M=>M.selectable===!0),l.value){const M=l.value.toLowerCase();w=w.filter(q=>q.name.toLowerCase().includes(M)||q.description.toLowerCase().includes(M)||q.serviceGroup.toLowerCase().includes(M))}switch(c.value){case"name":w=[...w].sort((M,q)=>M.name.localeCompare(q.name));break;case"enabled":w=[...w].sort((M,q)=>{const k=m.value.includes(M.key),x=m.value.includes(q.key);return k&&!x?-1:!k&&x?1:M.name.localeCompare(q.name)});break;case"group":default:w=[...w].sort((M,q)=>{const k=M.serviceGroup||"Ungrouped",x=q.serviceGroup||"Ungrouped";return k!==x?k.localeCompare(x):M.name.localeCompare(q.name)});break}return w}),b=he(()=>{const w=new Map;return h.value.forEach(M=>{const q=M.serviceGroup||"Ungrouped";w.has(q)||w.set(q,[]),w.get(q).push(M)}),new Map([...w.entries()].sort())}),F=he(()=>h.value.length);fe([m,b],()=>{Ce(()=>{for(const[w,M]of b.value)u(w,M)})},{flush:"post",deep:!1});const N=w=>m.value.includes(w),A=(w,M)=>{M.stopPropagation();const k=M.target.checked;if(!w){console.error("toolKey is undefined, cannot proceed");return}k?m.value.includes(w)||(m.value=[...m.value,w]):m.value=m.value.filter(x=>x!==w)},P=w=>w.filter(M=>m.value.includes(M.key)),y=w=>w.length>0&&w.every(M=>m.value.includes(M.key)),v=w=>{const M=P(w).length;return M>0&&M<w.length},E=(w,M)=>{M.stopPropagation();const k=M.target.checked,x=w.map(V=>V.key);if(k){const V=[...m.value];x.forEach(Z=>{V.includes(Z)||V.push(Z)}),m.value=V}else m.value=m.value.filter(V=>!x.includes(V))},$=w=>{d.value.has(w)?d.value.delete(w):d.value.add(w)},_=()=>{t("confirm",[...m.value]),t("update:modelValue",!1)},f=()=>{m.value=[...o.selectedToolIds],t("update:modelValue",!1)};return fe(a,w=>{if(w){d.value.clear();const M=Array.from(b.value.keys());M.length>1&&M.slice(1).forEach(q=>{d.value.add(q)})}}),(w,M)=>(p(),pe(ao,{modelValue:a.value,"onUpdate:modelValue":[M[4]||(M[4]=q=>a.value=q),f],title:w.$t("toolSelection.title"),onConfirm:_},{default:Ke(()=>[s("div",kh,[s("div",Eh,[s("div",Ch,[de(s("input",{"onUpdate:modelValue":M[0]||(M[0]=q=>l.value=q),type:"text",class:"search-input",placeholder:w.$t("toolSelection.searchPlaceholder")},null,8,Th),[[ve,l.value]])]),s("div",Rh,[de(s("select",{"onUpdate:modelValue":M[1]||(M[1]=q=>c.value=q),class:"sort-select"},[s("option",Ih,i(w.$t("toolSelection.sortByGroup")),1),s("option",Ah,i(w.$t("toolSelection.sortByName")),1),s("option",xh,i(w.$t("toolSelection.sortByStatus")),1)],512),[[Dt,c.value]])])]),s("div",Mh,[s("span",Fh,i(w.$t("toolSelection.summary",{groups:b.value.size,tools:F.value,selected:m.value.length})),1)]),b.value.size>0?(p(),g("div",Dh,[(p(!0),g(ue,null,me(b.value,([q,k])=>(p(),g("div",{key:q,class:"tool-group"},[s("div",{class:le(["tool-group-header",{collapsed:d.value.has(q)}]),onClick:x=>$(q)},[s("div",Uh,[T(r(R),{icon:d.value.has(q)?"carbon:chevron-right":"carbon:chevron-down",class:"collapse-icon"},null,8,["icon"]),T(r(R),{icon:"carbon:folder",class:"group-icon"}),s("span",Lh,i(q),1),s("span",Oh," ("+i(P(k).length)+"/"+i(k.length)+") ",1)]),s("div",{class:"group-actions",onClick:M[2]||(M[2]=Se(()=>{},["stop"]))},[s("label",Bh,[s("input",{type:"checkbox",class:"group-enable-checkbox",checked:y(k),onChange:x=>E(k,x),"data-group":q},null,40,qh),s("span",jh,i(w.$t("toolSelection.enableAll")),1)])])],10,Nh),s("div",{class:le(["tool-group-content",{collapsed:d.value.has(q)}])},[(p(!0),g(ue,null,me(k,x=>(p(),g("div",{key:x.key,class:"tool-selection-item"},[s("div",Vh,[s("div",Gh,i(x.name),1),x.description?(p(),g("div",Hh,i(x.description),1)):L("",!0)]),s("div",Jh,[s("label",{class:"tool-enable-switch",onClick:M[3]||(M[3]=Se(()=>{},["stop"]))},[s("input",{type:"checkbox",class:"tool-enable-checkbox",checked:N(x.key),onChange:V=>A(x.key,V)},null,40,Wh),M[5]||(M[5]=s("span",{class:"tool-enable-slider"},null,-1))])])]))),128))],2)]))),128))])):(p(),g("div",zh,[T(r(R),{icon:"carbon:tools",class:"empty-icon"}),s("p",null,i(w.$t("toolSelection.noToolsFound")),1)]))])]),_:1},8,["modelValue","title"]))}}),Xh=ye(Kh,[["__scopeId","data-v-197aa115"]]),Qh={class:"config-section"},Yh={class:"section-header"},Zh={key:0,class:"error-section"},em={class:"error-message"},tm={class:"error-content"},om={class:"error-title"},sm={class:"error-description"},nm={key:1,class:"visual-editor"},am={class:"plan-basic-info"},lm={class:"form-row"},rm={class:"form-label"},im=["placeholder"],cm={key:0,class:"field-error-message"},dm={class:"form-row"},um={class:"form-label"},pm=["value","placeholder"],hm={class:"steps-section"},mm={class:"steps-header"},fm={class:"form-label"},gm={class:"steps-actions"},vm=["title"],bm={class:"steps-container"},ym={class:"step-header"},_m={class:"step-number"},Sm={class:"step-actions"},wm=["onClick","disabled","title"],$m=["onClick","disabled","title"],Pm=["onClick","title"],km={class:"step-content"},Em={class:"form-row"},Cm={class:"form-label"},Tm=["onUpdate:modelValue","placeholder"],Rm={class:"form-row"},Im={class:"form-label"},Am=["onUpdate:modelValue","placeholder"],xm={key:0,class:"preview-section"},Mm={class:"preview-label"},Fm={class:"preview-content"},Dm={class:"preview-text"},Nm={class:"preview-table-header"},Um={class:"form-row"},Lm={class:"form-label"},Om={class:"model-selector-wrapper"},Bm={class:"model-input-wrapper"},qm=["value","placeholder","disabled","onClick","onFocus","onInput","onKeydown"],jm={key:0,class:"dropdown-item disabled"},Vm={key:1,class:"dropdown-item disabled error"},Gm={key:2,class:"dropdown-item disabled"},Hm=["onClick","onMouseenter"],Jm=["onClick","onMouseenter"],Wm=["title"],zm={key:0,class:"error-message"},Km={class:"form-row"},Xm={key:0,class:"empty-steps"},Qm={key:0,class:"json-preview"},Ym={class:"preview-header"},Zm={class:"form-label"},ef={class:"json-code"},tf={class:"editor-footer"},of={class:"section-actions"},sf=["disabled","title"],nf=["disabled","title"],af=["disabled","title"],lf=["disabled"],rf=be({__name:"JsonEditorV2",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},currentPlanTemplateId:{default:""}},emits:["rollback","restore","save","copy-plan","update:jsonContent"],setup(n,{emit:e}){const{t:o}=Ae(),t=n,a=e,l={...t,hiddenFields:[]},{showJsonPreview:c,displayData:d,formattedJsonOutput:m,addStep:u,removeStep:h,moveStepUp:b,moveStepDown:F,handleRollback:N,handleRestore:A,handleSave:P,toggleJsonPreview:y,closeJsonPreview:v}=co(l,a),E=D(null),$=D(""),_=D([]),f=D(!1),w=D(""),M=D(new Map),q=D(new Set),k=D(new Map),x=S=>M.value.get(S)??"",V=(S,H)=>{M.value.set(S,H)},Z=S=>{const H=x(S);if(!H.trim())return _.value;const ae=H.toLowerCase().trim();return _.value.filter(ne=>ne.value.toLowerCase().includes(ae)||ne.label.toLowerCase().includes(ae))},Y=S=>{const H=d.steps[S],ae=x(S);return q.value.has(S)&&ae!==""?ae:H.modelName??""},z=S=>f.value||w.value||d.steps[S].modelName?"":o("sidebar.modelNameDescription")||"",X=S=>q.value.has(S),G=S=>{f.value||q.value.add(S)},te=S=>{q.value.delete(S),k.value.set(S,-1);const H=d.steps[S];V(S,H.modelName??"")},K=S=>{X(S)?te(S):G(S)},U=(S,H)=>{const ae=d.steps[H];ae.modelName=S,V(H,S),te(H)},J=(S,H)=>{const ae=S.target;V(H,ae.value),G(H)},Q=S=>k.value.get(S)??-1,O=(S,H)=>{k.value.set(S,H)},B=S=>{const H=Q(S),ae=Z(S);H>=0&&H<ae.length?U(ae[H].value,S):H===-1?U("",S):ae.length>0?U(ae[0].value,S):d.steps[S].modelName||U("",S)},oe=S=>{if(!X(S)){G(S),O(S,0);return}const ae=Z(S).length+1,ne=Q(S),ie=Math.min(ne+1,ae-1);O(S,ie)},C=S=>{if(!X(S)){G(S);const ne=Z(S);O(S,ne.length);return}const H=Q(S),ae=Math.max(H-1,-1);O(S,ae)},W=S=>{S.target.closest(".model-selector")||q.value.clear()};fe(()=>d.steps,S=>{S.forEach((H,ae)=>{M.value.has(ae)||V(ae,H.modelName??"")})},{deep:!0,immediate:!0});const ge=D(!1),ee=D(-1),_e=async()=>{if(!f.value){f.value=!0,w.value="";try{const S=await gh.getAvailableModels();_.value=S.options}catch(S){console.error("Failed to load models:",S),w.value=S instanceof Error?S.message:"Failed to load models",_.value=[]}finally{f.value=!1}}},xe=S=>{ee.value=S,ge.value=!0,console.log("[JsonEditorV2] Available tools from store:",j.availableTools)},Be=S=>{ee.value>=0&&ee.value<d.steps.length&&(d.steps[ee.value].selectedToolKeys=[...S]),ge.value=!1,ee.value=-1},qe=(S,H)=>{S>=0&&S<d.steps.length&&(d.steps[S].selectedToolKeys=[...H])},Me=()=>{a("copy-plan")},Pe=()=>{try{E.value=null,d.title||(d.title=""),d.directResponse=!1}catch(S){const H=`Failed to initialize JsonEditorV2: ${S instanceof Error?S.message:"Unknown error"}`;E.value=H,console.error(H,S)}};fe(()=>d,S=>{try{S.title.trim()?$.value="":$.value="Title is required field",E.value=null}catch(H){E.value=`Invalid data structure: ${H instanceof Error?H.message:"Unknown error"}`,$.value=""}},{immediate:!0,deep:!0}),fe(()=>t.jsonContent,(S,H)=>{if(console.log("[JsonEditorV2] Props watch triggered - jsonContent changed from",H,"to",S),S&&S!==H){console.log("[JsonEditorV2] Force parsing new jsonContent:",S);try{const ae=JSON.parse(S);console.log("[JsonEditorV2] Parsed new jsonContent:",ae),Object.assign(d,{title:ae.title||"",steps:ae.steps||[],directResponse:!1,planTemplateId:ae.planTemplateId||t.currentPlanTemplateId||"",planType:ae.planType||"dynamic_agent"}),console.log("[JsonEditorV2] Updated displayData with new content:",d)}catch(ae){console.warn("[JsonEditorV2] Failed to parse new jsonContent:",ae)}}},{immediate:!0}),Fe(()=>{if(console.log("[JsonEditorV2] Component mounted with jsonContent:",t.jsonContent),console.log("[JsonEditorV2] Component mounted with currentPlanTemplateId:",t.currentPlanTemplateId),console.log("[JsonEditorV2] Component mounted with displayData:",d),t.jsonContent){console.log("[JsonEditorV2] Force parsing jsonContent on mount:",t.jsonContent);try{const S=JSON.parse(t.jsonContent);console.log("[JsonEditorV2] Parsed jsonContent on mount:",S),Object.assign(d,{title:S.title||"",steps:S.steps||[],directResponse:!1,planTemplateId:S.planTemplateId||t.currentPlanTemplateId||"",planType:S.planType||"dynamic_agent"}),console.log("[JsonEditorV2] Updated displayData on mount:",d)}catch(S){console.warn("[JsonEditorV2] Failed to parse jsonContent on mount:",S)}}Pe(),_e(),document.addEventListener("click",W)}),Ie(()=>{document.removeEventListener("click",W)});const $e=S=>{const H=S.target;H.style.height="auto";const ae=20,ne=Math.ceil(H.scrollHeight/ae),ie=4,ce=12,Ye=Math.max(ie,Math.min(ce,ne)),wt=Ye*ae;H.style.height=`${wt}px`,H.rows=Ye,ne>ce?H.style.overflowY="auto":H.style.overflowY="hidden"},je=S=>{if(!S.trim())return"";const H=S.split(",").map(ae=>ae.trim()).filter(ae=>ae.length>0);return H.length===0?"":`|${H.join("|")}|`};return(S,H)=>{var ae;return p(),g("div",Qh,[s("div",Yh,[T(r(R),{icon:"carbon:code",width:"16"}),s("span",null,i(S.$t("sidebar.dynamicAgentPlan")),1)]),E.value?(p(),g("div",Zh,[s("div",em,[T(r(R),{icon:"carbon:warning",width:"16"}),s("div",tm,[s("div",om,i(S.$t("sidebar.planTypeError")),1),s("div",sm,i(E.value),1)])])])):(p(),g("div",nm,[s("div",am,[s("div",lm,[s("label",rm,i(S.$t("sidebar.title")),1),de(s("input",{"onUpdate:modelValue":H[0]||(H[0]=ne=>r(d).title=ne),type:"text",class:le(["form-input",{error:$.value}]),placeholder:S.$t("sidebar.titlePlaceholder")},null,10,im),[[ve,r(d).title]]),$.value?(p(),g("div",cm,[T(r(R),{icon:"carbon:warning",width:"12"}),re(" "+i($.value),1)])):L("",!0)]),s("div",dm,[s("label",um,i(S.$t("sidebar.planTemplateId")),1),s("input",{value:S.currentPlanTemplateId,type:"text",class:"form-input readonly-input",readonly:"",placeholder:S.$t("sidebar.planTemplateIdPlaceholder")},null,8,pm)])]),s("div",hm,[s("div",mm,[s("label",fm,i(S.$t("sidebar.tasks")),1),s("div",gm,[s("button",{onClick:H[1]||(H[1]=(...ne)=>r(u)&&r(u)(...ne)),class:"btn btn-xs",title:S.$t("sidebar.addStep")},[T(r(R),{icon:"carbon:add",width:"12"})],8,vm)])]),s("div",bm,[(p(!0),g(ue,null,me(r(d).steps,(ne,ie)=>(p(),g("div",{key:ie,class:"step-item"},[s("div",ym,[s("span",_m,i(S.$t("sidebar.subtask"))+" "+i(ie+1),1),s("div",Sm,[s("button",{onClick:ce=>r(b)(ie),disabled:ie===0,class:"btn btn-xs",title:S.$t("sidebar.moveUp")},[T(r(R),{icon:"carbon:chevron-up",width:"12"})],8,wm),s("button",{onClick:ce=>r(F)(ie),disabled:ie===r(d).steps.length-1,class:"btn btn-xs",title:S.$t("sidebar.moveDown")},[T(r(R),{icon:"carbon:chevron-down",width:"12"})],8,$m),s("button",{onClick:ce=>r(h)(ie),class:"btn btn-xs btn-danger",title:S.$t("sidebar.removeStep")},[T(r(R),{icon:"carbon:trash-can",width:"12"})],8,Pm)])]),s("div",km,[s("div",Em,[s("label",Cm,i(S.$t("sidebar.stepRequirement")),1),de(s("textarea",{"onUpdate:modelValue":ce=>ne.stepRequirement=ce,class:"form-textarea auto-resize",placeholder:S.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:H[2]||(H[2]=ce=>$e(ce))},null,40,Tm),[[ve,ne.stepRequirement]])]),s("div",Rm,[s("label",Im,i(S.$t("sidebar.terminateColumns")),1),de(s("textarea",{"onUpdate:modelValue":ce=>ne.terminateColumns=ce,class:"form-textarea auto-resize",placeholder:S.$t("sidebar.terminateColumnsPlaceholder"),rows:"4",onInput:H[3]||(H[3]=ce=>$e(ce))},null,40,Am),[[ve,ne.terminateColumns]]),ne.terminateColumns&&ne.terminateColumns.trim()?(p(),g("div",xm,[s("div",Mm,i(S.$t("sidebar.preview"))+":",1),s("div",Fm,[s("div",Dm,[re(i(S.$t("sidebar.systemWillReturnListWithTableHeaderFormat"))+": ",1),s("span",Nm,i(je(ne.terminateColumns)),1)])])])):L("",!0)]),s("div",Um,[s("label",Lm,i(S.$t("sidebar.modelName")),1),s("div",Om,[s("div",{class:le(["model-selector",{"is-open":X(ie),"is-disabled":f.value}])},[s("div",Bm,[s("input",{value:Y(ie),type:"text",class:"form-input model-search-input",placeholder:z(ie),disabled:f.value,onClick:Se(ce=>G(ie),["stop"]),onFocus:ce=>G(ie),onInput:ce=>J(ce,ie),onKeydown:[et(ce=>te(ie),["escape"]),et(Se(ce=>B(ie),["prevent"]),["enter"]),et(Se(ce=>oe(ie),["prevent"]),["down"]),et(Se(ce=>C(ie),["prevent"]),["up"])]},null,40,qm),T(r(R),{icon:"carbon:chevron-down",width:"14",class:le(["dropdown-arrow",{"is-open":X(ie)}]),onClick:Se(ce=>K(ie),["stop"])},null,8,["class","onClick"])]),X(ie)?(p(),g("div",{key:0,class:"model-dropdown",onClick:H[4]||(H[4]=Se(()=>{},["stop"]))},[f.value?(p(),g("div",jm,i(S.$t("sidebar.loading")),1)):w.value?(p(),g("div",Vm,i(S.$t("sidebar.modelLoadError")),1)):Z(ie).length===0?(p(),g("div",Gm,i(S.$t("sidebar.noModelsFound")),1)):L("",!0),(p(!0),g(ue,null,me(Z(ie),(ce,Ye)=>(p(),g("div",{key:ce.value,class:le(["dropdown-item",{"is-selected":ne.modelName===ce.value,"is-highlighted":Q(ie)===Ye}]),onClick:wt=>U(ce.value,ie),onMouseenter:wt=>O(ie,Ye)},[re(i(ce.value)+" ",1),ne.modelName===ce.value?(p(),pe(r(R),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"})):L("",!0)],42,Hm))),128)),s("div",{class:le(["dropdown-item",{"is-selected":!ne.modelName,"is-highlighted":Q(ie)===-1}]),onClick:ce=>U("",ie),onMouseenter:ce=>O(ie,-1)},[re(i(S.$t("sidebar.noModelSelected"))+" ",1),ne.modelName?L("",!0):(p(),pe(r(R),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"}))],42,Jm)])):L("",!0)],2),w.value?(p(),g("button",{key:0,onClick:_e,class:"btn btn-sm btn-danger",title:S.$t("sidebar.retryLoadModels")},[T(r(R),{icon:"carbon:warning",width:"14"}),re(" "+i(S.$t("sidebar.retry")),1)],8,Wm)):L("",!0)]),w.value?(p(),g("div",zm,[T(r(R),{icon:"carbon:warning",width:"12"}),re(" "+i(w.value),1)])):L("",!0)]),s("div",Km,[T(Ph,{title:S.$t("sidebar.selectedTools"),"selected-tool-ids":ne.selectedToolKeys,"available-tools":r(j).availableTools,"add-button-text":S.$t("sidebar.addRemoveTools"),"empty-text":S.$t("sidebar.noTools"),"use-grid-layout":!0,onAddTools:ce=>xe(ie),onToolsFiltered:ce=>qe(ie,ce)},null,8,["title","selected-tool-ids","available-tools","add-button-text","empty-text","onAddTools","onToolsFiltered"])])])]))),128)),r(d).steps.length===0?(p(),g("div",Xm,[T(r(R),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),s("p",null,i(S.$t("sidebar.noSteps")),1),s("button",{onClick:H[5]||(H[5]=(...ne)=>r(u)&&r(u)(...ne)),class:"btn btn-primary"},[T(r(R),{icon:"carbon:add",width:"14"}),re(" "+i(S.$t("sidebar.addFirstStep")),1)])])):L("",!0)])]),r(c)?(p(),g("div",Qm,[s("div",Ym,[s("label",Zm,i(S.$t("sidebar.jsonPreview")),1),s("button",{onClick:H[6]||(H[6]=(...ne)=>r(v)&&r(v)(...ne)),class:"btn btn-xs"},[T(r(R),{icon:"carbon:close",width:"12"})])]),s("pre",ef,i(r(m)),1)])):L("",!0),s("div",tf,[s("button",{onClick:H[7]||(H[7]=(...ne)=>r(y)&&r(y)(...ne)),class:"btn btn-sm btn-secondary"},[T(r(R),{icon:"carbon:code",width:"14"}),re(" "+i(r(c)?S.$t("sidebar.hideJson"):S.$t("sidebar.showJson")),1)]),s("div",of,[s("button",{class:"btn btn-sm",onClick:Me,disabled:S.isGenerating||S.isExecuting,title:S.$t("sidebar.copyPlan")},[T(r(R),{icon:"carbon:copy",width:"14"}),re(" "+i(S.$t("sidebar.copyPlan")),1)],8,sf),s("button",{class:"btn btn-sm",onClick:H[8]||(H[8]=(...ne)=>r(N)&&r(N)(...ne)),disabled:!(S.canRollback??!1),title:S.$t("sidebar.rollback")},[T(r(R),{icon:"carbon:undo",width:"14"})],8,nf),s("button",{class:"btn btn-sm",onClick:H[9]||(H[9]=(...ne)=>r(A)&&r(A)(...ne)),disabled:!(S.canRestore??!1),title:S.$t("sidebar.restore")},[T(r(R),{icon:"carbon:redo",width:"14"})],8,af),s("button",{class:"btn btn-primary",onClick:H[10]||(H[10]=(...ne)=>r(P)&&r(P)(...ne)),disabled:S.isGenerating||S.isExecuting},[T(r(R),{icon:"carbon:save",width:"14"}),H[12]||(H[12]=re(" Save "))],8,lf)])])])),T(Xh,{modelValue:ge.value,"onUpdate:modelValue":H[11]||(H[11]=ne=>ge.value=ne),tools:r(j).availableTools,"selected-tool-ids":ee.value>=0?((ae=r(d).steps[ee.value])==null?void 0:ae.selectedToolKeys)||[]:[],onConfirm:Be},null,8,["modelValue","tools","selected-tool-ids"])])}}}),cf=ye(rf,[["__scopeId","data-v-91854736"]]),df={class:"sidebar-content"},uf={class:"sidebar-content-header"},pf={class:"sidebar-content-title"},hf={class:"tab-switcher"},mf=["disabled"],ff={key:0,class:"tab-content"},gf={class:"new-task-section"},vf={class:"sidebar-content-list"},bf={key:0,class:"loading-state"},yf={key:1,class:"error-state"},_f={key:2,class:"empty-state"},Sf=["onClick"],wf={class:"task-icon"},$f={class:"task-details"},Pf={class:"task-title"},kf={class:"task-preview"},Ef={class:"task-time"},Cf={class:"task-actions"},Tf=["title","onClick"],Rf={key:1,class:"tab-content config-tab"},If={key:0,class:"config-container"},Af={class:"template-info-header"},xf={class:"template-info"},Mf={class:"template-id"},Ff=["title"],Df={class:"modal-header"},Nf={class:"modal-body"},Uf={class:"form-row"},Lf={class:"form-label"},Of=["placeholder"],Bf={class:"modal-footer"},qf=["disabled"],jf=be({__name:"Sidebar",emits:["planExecutionRequested"],setup(n,{expose:e,emit:o}){const{t}=Ae(),a=Wo(),l=D(80),c=D(!1),d=D(0),m=D(0),u=D(null),h=D({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}),b=D({}),F=D(null),N=D({enabled:!0,success:!0}),A=he(()=>N.value.enabled);fe(()=>j.currentPlanTemplateId,(C,W)=>{console.log("[Sidebar] currentPlanTemplateId changed from",W,"to",C)}),fe(()=>j.jsonContent,(C,W)=>{console.log("[Sidebar] jsonContent changed from",W,"to",C)});const P=async()=>{try{const C=await Le.getCoordinatorToolConfig();N.value=C}catch(C){console.error("Failed to load CoordinatorTool configuration:",C),N.value={enabled:!0,success:!1,message:C instanceof Error?C.message:"Unknown error"}}},y=o,v=async()=>{try{const C=await j.saveTemplate();C!=null&&C.duplicate?a.success(t("sidebar.saveCompleted",{message:C.message,versionCount:C.versionCount})):C!=null&&C.saved?(a.success(t("sidebar.saveSuccess",{message:C.message,versionCount:C.versionCount})),E()):C!=null&&C.message&&a.success(t("sidebar.saveStatus",{message:C.message}))}catch(C){console.error("Failed to save plan modifications:",C),a.error(C.message||t("sidebar.saveFailed"))}},E=async()=>{await new Promise(C=>setTimeout(C,1e3)),console.log("[Sidebar] ðŸ”„ Refreshing parameter requirements for templateId:",j.currentPlanTemplateId),await Ce(),u.value?(console.log("[Sidebar] ðŸ“ž Calling ExecutionController.loadParameterRequirements()"),u.value.loadParameterRequirements(),setTimeout(()=>{u.value&&(console.log("[Sidebar] ðŸ”„ Retry: Calling ExecutionController.loadParameterRequirements() again"),u.value.loadParameterRequirements())},2e3)):console.warn("[Sidebar] âš ï¸ ExecutionController ref not available"),F.value?(console.log("[Sidebar] ðŸ“ž Calling PublishMcpServiceModal.loadParameterRequirements()"),F.value.loadParameterRequirements()):console.warn("[Sidebar] âš ï¸ PublishMcpServiceModal ref not available")},$=()=>{try{typeof j.rollbackVersion=="function"?j.rollbackVersion():console.warn("rollbackVersion method is not available")}catch(C){console.error("Error during rollback operation:",C),a.error(t("sidebar.rollbackFailed")||"Rollback failed")}},_=()=>{try{typeof j.restoreVersion=="function"?j.restoreVersion():console.warn("restoreVersion method is not available")}catch(C){console.error("Error during restore operation:",C),a.error(t("sidebar.restoreFailed")||"Restore failed")}},f=async C=>{var W;console.log("[Sidebar] ðŸŽ¯ handleExecutePlan called with payload:",JSON.stringify(C,null,2)),console.log("[Sidebar] ðŸ“Š Current sidebarStore state:",{currentPlanTemplateId:j.currentPlanTemplateId,selectedTemplate:(W=j.selectedTemplate)==null?void 0:W.id,jsonContent:j.jsonContent.substring(0,100)+"..."});try{const ge=j.preparePlanExecution();if(console.log("[Sidebar] ðŸ“‹ Prepared plan data:",JSON.stringify(ge,null,2)),!ge){console.log("[Sidebar] âŒ No plan data available, returning");return}const ee={...ge,uploadedFiles:C.uploadedFiles,uploadKey:C.uploadKey};C.replacementParams&&Object.keys(C.replacementParams).length>0&&(console.log("[Sidebar] ðŸ”„ Processing replacement parameters:",C.replacementParams),ee.replacementParams=C.replacementParams),console.log("[Sidebar] âœ… Final plan data:",JSON.stringify(ee,null,2));const _e={...C,title:ee.title,planData:ee.planData,params:ee.params,uploadedFiles:ee.uploadedFiles,uploadKey:ee.uploadKey};console.log("[Sidebar] ðŸ“¤ Emitting planExecutionRequested with final payload:",JSON.stringify(_e,null,2)),y("planExecutionRequested",_e),console.log("[Sidebar] âœ… Event emitted successfully")}catch(ge){console.error("[Sidebar] âŒ Error executing plan:",ge),a.error(t("sidebar.executeFailed")+": "+ge.message)}finally{console.log("[Sidebar] ðŸ§¹ Cleaning up after execution"),j.finishPlanExecution(),j.clearExecutionParams(),u.value&&(console.log("[Sidebar] ðŸ§¹ Calling ExecutionController.clearExecutionParams"),u.value.clearExecutionParams()),console.log("[Sidebar] âœ… Cleanup completed")}},w=D(!1),M=D(!1),q=D(""),k=D(!1),x=()=>{if(console.log("[Sidebar] Publish MCP service button clicked"),console.log("[Sidebar] currentPlanTemplateId:",j.currentPlanTemplateId),!j.currentPlanTemplateId){console.log("[Sidebar] No plan template selected, showing warning"),a.error(t("mcpService.selectPlanTemplateFirst"));return}console.log("[Sidebar] Opening publish MCP service modal"),w.value=!0},V=async C=>{C===null?(console.log("MCP service deleted successfully"),a.success(t("mcpService.deleteSuccess")),h.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}):(console.log("MCP service published successfully:",C),a.success(t("mcpService.publishSuccess")),h.value={...C,toolName:C.toolName,serviceGroup:C.serviceGroup??""}),console.log("[Sidebar] ðŸ”„ Reloading available tools after service publish/delete"),await j.loadAvailableTools(),await J()},Z=()=>{j.clearExecutionParams()},Y=C=>{j.executionParams=C},z=()=>{if(console.log("[Sidebar] Copy plan clicked"),!j.selectedTemplate){console.log("[Sidebar] No template selected, cannot copy"),a.error(t("sidebar.selectPlanFirst"));return}q.value=(j.selectedTemplate.title??t("sidebar.unnamedPlan"))+" (copy)",console.log("[Sidebar] Opening copy plan modal"),M.value=!0},X=()=>{M.value=!1,q.value="",k.value=!1},G=async()=>{if(!q.value.trim()){a.error(t("sidebar.titleRequired"));return}if(!j.selectedTemplate||!j.jsonContent){a.error(t("sidebar.noPlanToCopy"));return}k.value=!0;try{const W={...JSON.parse(j.jsonContent),title:q.value.trim(),planTemplateId:""},{PlanActApiService:ge}=await no(async()=>{const{PlanActApiService:_e}=await import("./sidebar-hQWcOc6U.js").then(xe=>xe.p);return{PlanActApiService:_e}},__vite__mapDeps([0,1,2,3])),ee=await ge.savePlanTemplate("",JSON.stringify(W));ee.saved?(a.success(t("sidebar.copyPlanSuccess",{title:q.value.trim()})),await j.loadPlanTemplateList(),X()):a.error(t("sidebar.copyPlanFailed",{message:ee.message||"Unknown error"}))}catch(C){console.error("[Sidebar] Error copying plan:",C),a.error(t("sidebar.copyPlanFailed",{message:C.message||"Unknown error"}))}finally{k.value=!1}},te=async C=>{if(!C){h.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""};return}try{const W=await Le.getCoordinatorToolsByTemplate(C);W?h.value={...W,toolName:W.toolName,serviceGroup:W.serviceGroup??""}:h.value={toolName:"",toolDescription:"",planTemplateId:C,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}catch(W){console.error("Failed to load tool information:",W),h.value={toolName:"",toolDescription:"",planTemplateId:C,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}},K=C=>{if(isNaN(C.getTime()))return console.warn("Invalid date received:",C),t("time.unknown");const ge=new Date().getTime()-C.getTime(),ee=Math.floor(ge/6e4),_e=Math.floor(ge/36e5),xe=Math.floor(ge/864e5);return ee<1?t("time.now"):ee<60?t("time.minuteAgo",{count:ee}):_e<24?t("time.hourAgo",{count:_e}):xe<30?t("time.dayAgo",{count:xe}):C.toLocaleDateString("zh-CN")},U=C=>{const W=b.value[C.id];return W!=null&&W.toolName?`${t("sidebar.publishedTool")}: ${W.toolName}`:""},J=async()=>{for(const C of j.planTemplateList)try{const W=await Le.getCoordinatorToolsByTemplate(C.id);W!=null&&W.toolName&&(b.value[C.id]=W)}catch(W){console.debug(`No tool found for template ${C.id}:`,W)}},Q=C=>{c.value=!0,d.value=C.clientX,m.value=l.value,document.addEventListener("mousemove",O),document.addEventListener("mouseup",B),document.body.style.cursor="col-resize",document.body.style.userSelect="none",C.preventDefault()},O=C=>{if(!c.value)return;const W=window.innerWidth,ee=(C.clientX-d.value)/W*100;let _e=m.value+ee;_e=Math.max(15,Math.min(100,_e)),l.value=_e},B=()=>{c.value=!1,document.removeEventListener("mousemove",O),document.removeEventListener("mouseup",B),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("sidebarWidth",l.value.toString())},oe=()=>{l.value=80,localStorage.setItem("sidebarWidth","80")};return fe(()=>j.currentPlanTemplateId,C=>{te(C)},{immediate:!0}),Fe(async()=>{await j.loadPlanTemplateList(),await J(),P(),j.loadAvailableTools();const C=localStorage.getItem("sidebarWidth");C&&(l.value=parseFloat(C))}),Ie(()=>{document.removeEventListener("mousemove",O),document.removeEventListener("mouseup",B)}),e({loadPlanTemplateList:j.loadPlanTemplateList,toggleSidebar:j.toggleSidebar,currentPlanTemplateId:j.currentPlanTemplateId}),(C,W)=>{var ge;return p(),g(ue,null,[s("div",{class:le(["sidebar-wrapper",{"sidebar-wrapper-collapsed":r(j).isCollapsed}]),style:ze({width:l.value+"%"})},[s("div",df,[s("div",uf,[s("div",pf,i(C.$t("sidebar.title")),1)]),s("div",hf,[s("button",{class:le(["tab-button",{active:r(j).currentTab==="list"}]),onClick:W[0]||(W[0]=ee=>r(j).switchToTab("list"))},[T(r(R),{icon:"carbon:list",width:"16"}),re(" "+i(C.$t("sidebar.templateList")),1)],2),s("button",{class:le(["tab-button",{active:r(j).currentTab==="config"}]),onClick:W[1]||(W[1]=ee=>r(j).switchToTab("config")),disabled:!r(j).selectedTemplate},[T(r(R),{icon:"carbon:settings",width:"16"}),re(" "+i(C.$t("sidebar.configuration")),1)],10,mf)]),r(j).currentTab==="list"?(p(),g("div",ff,[s("div",gf,[s("button",{class:"new-task-btn",onClick:W[2]||(W[2]=()=>r(j).createNewTemplate(r(j).planType))},[T(r(R),{icon:"carbon:add",width:"16"}),re(" "+i(C.$t("sidebar.newPlan"))+" ",1),W[10]||(W[10]=s("span",{class:"shortcut"},"âŒ˜ K",-1))])]),s("div",vf,[r(j).isLoading?(p(),g("div",bf,[T(r(R),{icon:"carbon:circle-dash",width:"20",class:"spinning"}),s("span",null,i(C.$t("sidebar.loading")),1)])):r(j).errorMessage?(p(),g("div",yf,[T(r(R),{icon:"carbon:warning",width:"20"}),s("span",null,i(r(j).errorMessage),1),s("button",{onClick:W[3]||(W[3]=(...ee)=>r(j).loadPlanTemplateList&&r(j).loadPlanTemplateList(...ee)),class:"retry-btn"},i(C.$t("sidebar.retry")),1)])):r(j).planTemplateList.length===0?(p(),g("div",_f,[T(r(R),{icon:"carbon:document",width:"32"}),s("span",null,i(C.$t("sidebar.noTemplates")),1)])):(p(!0),g(ue,{key:3},me(r(j).sortedTemplates,ee=>(p(),g("div",{key:ee.id,class:le(["sidebar-content-list-item",{"sidebar-content-list-item-active":ee.id===r(j).currentPlanTemplateId}]),onClick:_e=>r(j).selectTemplate(ee)},[s("div",wf,[T(r(R),{icon:"carbon:document",width:"20"})]),s("div",$f,[s("div",Pf,i(ee.title||C.$t("sidebar.unnamedPlan")),1),s("div",kf,i(U(ee)),1)]),s("div",Ef,i(K(r(j).parseDateTime(ee.updateTime||ee.createTime))),1),s("div",Cf,[s("button",{class:"delete-task-btn",title:C.$t("sidebar.deleteTemplate"),onClick:Se(_e=>r(j).deleteTemplate(ee),["stop"])},[T(r(R),{icon:"carbon:close",width:"16"})],8,Tf)])],10,Sf))),128))])])):r(j).currentTab==="config"?(p(),g("div",Rf,[r(j).selectedTemplate?(p(),g("div",If,[s("div",Af,[s("div",xf,[s("h3",null,i(r(j).selectedTemplate.title||C.$t("sidebar.unnamedPlan")),1),s("span",Mf,"ID: "+i(r(j).selectedTemplate.id),1)]),s("button",{class:"back-to-list-btn",onClick:W[4]||(W[4]=ee=>r(j).switchToTab("list"))},[T(r(R),{icon:"carbon:arrow-left",width:"16"})])]),r(j).planType==="dynamic_agent"?(p(),pe(cf,{key:r(j).currentPlanTemplateId||"default","json-content":r(j).jsonContent,"can-rollback":r(j).canRollback,"can-restore":r(j).canRestore,"is-generating":r(j).isGenerating,"is-executing":r(j).isExecuting,"current-plan-template-id":r(j).currentPlanTemplateId||"",onRollback:$,onRestore:_,onSave:v,onCopyPlan:z,"onUpdate:jsonContent":W[5]||(W[5]=ee=>r(j).jsonContent=ee)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])):(p(),pe(Ou,{key:"simple-"+(r(j).currentPlanTemplateId||"default"),"json-content":r(j).jsonContent,"can-rollback":r(j).canRollback,"can-restore":r(j).canRestore,"is-generating":r(j).isGenerating,"is-executing":r(j).isExecuting,"current-plan-template-id":r(j).currentPlanTemplateId||"",onRollback:$,onRestore:_,onSave:v,"onUpdate:jsonContent":W[6]||(W[6]=ee=>r(j).jsonContent=ee)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])),T(zd,{ref_key:"executionControllerRef",ref:u,"current-plan-template-id":r(j).currentPlanTemplateId||"","is-executing":r(j).isExecuting,"is-generating":r(j).isGenerating,"show-publish-button":A.value,"tool-info":h.value,onExecutePlan:f,onPublishMcpService:x,onClearParams:Z,onUpdateExecutionParams:Y},null,8,["current-plan-template-id","is-executing","is-generating","show-publish-button","tool-info"])])):L("",!0)])):L("",!0)]),s("div",{class:"sidebar-resizer",onMousedown:Q,onDblclick:oe,title:C.$t("sidebar.resizeHint")},W[11]||(W[11]=[s("div",{class:"resizer-line"},null,-1)]),40,Ff)],6),T(Xc,{ref_key:"publishMcpModalRef",ref:F,modelValue:w.value,"onUpdate:modelValue":W[7]||(W[7]=ee=>w.value=ee),"plan-template-id":r(j).currentPlanTemplateId||"","plan-description":((ge=r(j).selectedTemplate)==null?void 0:ge.description)||"",onPublished:V},null,8,["modelValue","plan-template-id","plan-description"]),M.value?(p(),g("div",{key:0,class:"modal-overlay",onClick:X},[s("div",{class:"modal-content",onClick:W[9]||(W[9]=Se(()=>{},["stop"]))},[s("div",Df,[s("h3",null,i(C.$t("sidebar.copyPlan")),1),s("button",{class:"close-btn",onClick:X},[T(r(R),{icon:"carbon:close",width:"16"})])]),s("div",Nf,[s("div",Uf,[s("label",Lf,i(C.$t("sidebar.newPlanTitle")),1),de(s("input",{"onUpdate:modelValue":W[8]||(W[8]=ee=>q.value=ee),type:"text",class:"form-input",placeholder:C.$t("sidebar.enterNewPlanTitle"),onKeyup:et(G,["enter"])},null,40,Of),[[ve,q.value]])])]),s("div",Bf,[s("button",{class:"btn btn-secondary",onClick:X},i(C.$t("common.cancel")),1),s("button",{class:"btn btn-primary",onClick:G,disabled:!q.value.trim()||k.value},[k.value?(p(),pe(r(R),{key:0,icon:"carbon:loading",width:"16",class:"spinning"})):L("",!0),re(" "+i(k.value?C.$t("sidebar.copying"):C.$t("sidebar.copyPlan")),1)],8,qf)])])])):L("",!0)],64)}}}),Vf=ye(jf,[["__scopeId","data-v-7cb4cac5"]]),Gf={class:"direct-page"},Hf={class:"direct-chat"},Jf={class:"chat-header"},Wf={class:"header-actions"},zf=["title"],Kf=["title"],Xf=["title"],Qf={class:"chat-content"},Yf=["title"],Zf={class:"message-content"},eg=be({__name:"index",setup(n){const e=jo(),o=Vo(),t=ot(),{t:a}=Ae(),{message:l}=zo(),c=D(""),d=D(""),m=D(),u=D(),h=D(),b=D(),F=D(!1),N=D(!1),A=D(null),P=D(50),y=D(!1),v=D(0),E=D(0),$=he(()=>{if(j.isCollapsed)return P.value;let O=26;b.value&&b.value.sidebarWidth!==void 0&&(O=b.value.sidebarWidth);const B=100-O;return Math.max(20,Math.min(B,P.value))});Fe(()=>{if(console.log("[Direct] onMounted called"),console.log("[Direct] taskStore.currentTask:",t.currentTask),console.log("[Direct] taskStore.hasUnprocessedTask():",t.hasUnprocessedTask()),Ue.setEventCallbacks({onPlanUpdate:B=>{console.log("[Direct] Plan update event received for rootPlanId:",B),q(B)&&(console.log("[Direct] Processing plan update for current rootPlanId:",B),u.value&&typeof u.value.handlePlanUpdate=="function"?(console.log("[Direct] Calling chatRef.handlePlanUpdate with rootPlanId:",B),u.value.handlePlanUpdate(B)):console.warn("[Direct] chatRef.handlePlanUpdate method not available"),m.value&&typeof m.value.updateDisplayedPlanProgress=="function"?(console.log("[Direct] Calling rightPanelRef.updateDisplayedPlanProgress with rootPlanId:",B),m.value.updateDisplayedPlanProgress(B)):console.warn("[Direct] rightPanelRef.updateDisplayedPlanProgress method not available"))},onPlanCompleted:B=>{if(console.log("[Direct] Plan completed event received for rootPlanId:",B),!!q(B)){if(console.log("[Direct] Processing plan completion for current rootPlanId:",B),u.value&&typeof u.value.handlePlanCompleted=="function"){const oe=Ue.getCachedPlanRecord(B);oe&&oe.completed?oe.summary&&oe.summary.trim().length>0?(console.log("[Direct]  Plan details are valid and complete from polling cache, updating UI"),u.value.handlePlanCompleted(oe)):(console.warn("[Direct]  Plan completed but summary is empty, still proceeding with available data"),u.value.handlePlanCompleted(oe)):(console.warn("[Direct]  Plan details incomplete in cache, attempting API fallback"),mt.getDetails(B).then(C=>{console.log("[Direct]  Got fresh details from API:",C),C&&C.completed?(console.log("[Direct] Fresh details from API are valid, updating UI"),Ue.setCachedPlanRecord(B,C),u.value.handlePlanCompleted(C)):(console.warn("[Direct]  API details also incomplete, using best available data"),u.value.handlePlanCompleted(oe??{planId:B}))}).catch(C=>{console.error("[Direct] API call failed (likely record deleted), using cached data:",C),u.value.handlePlanCompleted(oe??{planId:B})}))}else console.warn("[Direct] chatRef.handlePlanCompleted method not available");A.value=null,console.log("[Direct] ðŸ§¹ Cleared currentRootPlanId after plan completion"),h.value&&typeof h.value.resetSession=="function"&&(console.log("[Direct] ðŸ§¹ Calling inputRef.resetSession to clear sessionPlanId"),h.value.resetSession())}},onDialogRoundStart:B=>{console.log("[Direct] Dialog round start event received for rootPlanId:",B),A.value=B,console.log("[Direct] Set currentRootPlanId to:",B),u.value&&typeof u.value.handleDialogRoundStart=="function"?(console.log("[Direct] Calling chatRef.handleDialogRoundStart with planId:",B),u.value.handleDialogRoundStart(B)):console.warn("[Direct] chatRef.handleDialogRoundStart method not available")},onChatInputClear:()=>{console.log("[Direct] Chat input clear event received"),V()},onChatInputUpdateState:B=>{if(console.log("[Direct] Chat input update state event received for rootPlanId:",B),!q(B,!0))return;const oe=Ue.getCachedUIState(B);oe&&Y(oe.enabled,oe.placeholder)},onPlanError:B=>{u.value.handlePlanError(B)}}),console.log("[Direct] Event callbacks registered to planExecutionManager"),j.loadPlanTemplateList(),t.hasUnprocessedTask()&&t.currentTask){const B=t.currentTask.prompt;console.log("[Direct] Found unprocessed task from store:",B),B.trim()?(t.markTaskAsProcessed(),Ce(async()=>{try{console.log("[Direct] Calling handleChatSendMessage with taskContent:",B),await k({input:B})}catch(oe){console.warn("[Direct] handleChatSendMessage failed, falling back to prompt:",oe),c.value=B}})):(console.log("[Direct] Task has empty content, marking as processed without execution"),t.markTaskAsProcessed())}else{const B=t.getAndClearTaskToInput();B?(d.value=B,console.log("[Direct] Setting inputOnlyContent for input only:",d.value)):(c.value=e.query.prompt||"",console.log("[Direct] Received task from URL:",c.value),console.log("[Direct] No unprocessed task in store"))}const O=localStorage.getItem("directPanelWidth");O&&(P.value=parseFloat(O)),console.log("[Direct] Final prompt value:",c.value),d.value&&Ce(()=>{h.value&&typeof h.value.setInputValue=="function"&&(h.value.setInputValue(d.value),console.log("[Direct] Set input value:",d.value),d.value="")}),window.addEventListener("plan-execution-requested",B=>{console.log("[DirectView] Received plan-execution-requested event:",B.detail),U(B.detail)})}),fe(()=>t.currentTask,O=>{if(console.log("[Direct] Watch taskStore.currentTask triggered, newTask:",O),O&&!O.processed&&O.prompt.trim()){const B=O.prompt;t.markTaskAsProcessed(),console.log("[Direct] Received new task from store:",B),Ce(async()=>{try{console.log("[Direct] Directly executing new task via handleChatSendMessage:",B),await k({input:B})}catch(oe){console.warn("[Direct] handleChatSendMessage failed for new task:",oe)}})}else console.log("[Direct] Task is null, already processed, or has empty prompt - ignoring")},{immediate:!1}),fe(()=>c.value,(O,B)=>{console.log("[Direct] prompt value changed from:",B,"to:",O)},{immediate:!1}),fe(()=>t.taskToInput,O=>{console.log("[Direct] Watch taskStore.taskToInput triggered, newTaskToInput:",O),O.trim()&&(console.log("[Direct] Setting input value from taskToInput:",O),Ce(()=>{h.value&&typeof h.value.setInputValue=="function"&&(h.value.setInputValue(O.trim()),console.log("[Direct] Input value set from taskToInput watch:",O.trim()),t.getAndClearTaskToInput())}))},{immediate:!1}),Ie(()=>{console.log("[Direct] onUnmounted called, cleaning up resources"),A.value=null,Ue.cleanup(),document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",w),window.removeEventListener("plan-execution-requested",O=>{U(O.detail)})});const _=O=>{y.value=!0,v.value=O.clientX,E.value=P.value,document.addEventListener("mousemove",f),document.addEventListener("mouseup",w),document.body.style.cursor="col-resize",document.body.style.userSelect="none",O.preventDefault()},f=O=>{if(!y.value)return;const B=window.innerWidth,C=(O.clientX-v.value)/B*100;let W=E.value+C;W=Math.max(20,Math.min(80,W)),P.value=W},w=()=>{y.value=!1,document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",w),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("directPanelWidth",P.value.toString())},M=()=>{P.value=50,localStorage.setItem("directPanelWidth","50")},q=(O,B=!1)=>!A.value||O===A.value||B&&(O==="ui-state"||O==="error")?!0:(console.log("[Direct] Ignoring event for non-current rootPlanId:",O,"current:",A.value),!1),k=async O=>{var oe,C,W,ge,ee,_e,xe,Be,qe;let B=null;try{if(console.log("[DirectView] Processing send-message event:",O),!O.input.trim()){console.warn("[DirectView] Empty input detected, skipping backend request");return}const Me=(oe=u.value)==null?void 0:oe.addMessage("user",O.input);O.attachments&&Me&&((C=u.value)==null||C.updateMessage(Me.id,{attachments:O.attachments})),B=(W=u.value)==null?void 0:W.addMessage("assistant","",{thinking:a("chat.thinkingProcessing")}),B&&((ge=u.value)==null||ge.startStreaming(B.id));const{DirectApiService:Pe}=await no(async()=>{const{DirectApiService:je}=await import("./sidebar-hQWcOc6U.js").then(S=>S.d);return{DirectApiService:je}},__vite__mapDeps([0,1,2,3]));console.log("[DirectView] Calling DirectApiService.sendMessageWithDefaultPlan");const $e=await Pe.sendMessageWithDefaultPlan(O);console.log("[DirectView] API response received:",$e),$e.planId&&B?((ee=u.value)==null||ee.updateMessage(B.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:$e.planId,rootPlanId:$e.planId,status:"running"}}),A.value=$e.planId,console.log("[DirectView] Set currentRootPlanId to:",$e.planId),Ue.handlePlanExecutionRequested($e.planId,O.input),console.log("[DirectView] Started polling for plan execution updates")):B&&((_e=u.value)==null||_e.updateMessage(B.id,{content:$e.message||$e.result||"No response received from backend"}),(xe=u.value)==null||xe.stopStreaming(B.id))}catch(Me){console.error("[DirectView] Send message failed:",Me),(Be=u.value)==null||Be.addMessage("assistant",`Error: ${(Me==null?void 0:Me.message)||"Failed to send message"}`),B&&((qe=u.value)==null||qe.stopStreaming(B.id))}},x=async O=>{console.log("[DirectView] Send message from input:",JSON.stringify(O)),await k(O)},V=()=>{console.log("[DirectView] Input cleared"),h.value&&typeof h.value.clear=="function"&&h.value.clear()},Z=()=>{console.log("[DirectView] Input focused")},Y=(O,B)=>{console.log("[DirectView] Input state updated:",O,B),N.value=!O},z=O=>{console.log("[DirectView] Step selected:",O),m.value&&typeof m.value.handleStepSelected=="function"?(console.log("[DirectView] Forwarding step selection to right panel:",O),m.value.handleStepSelected(O)):console.warn("[DirectView] rightPanelRef.handleStepSelected method not available")},X=(O,B,oe,C)=>{console.log("[DirectView] Sub plan step selected:",{parentPlanId:O,subPlanId:B,stepIndex:oe,subStepIndex:C}),m.value&&typeof m.value.handleSubPlanStepSelected=="function"?(console.log("[DirectView] Forwarding sub plan step selection to right panel:",{parentPlanId:O,subPlanId:B,stepIndex:oe,subStepIndex:C}),m.value.handleSubPlanStepSelected(O,B,oe,C)):console.warn("[DirectView] rightPanelRef.handleSubPlanStepSelected method not available")},G=()=>{console.log("[DirectView] Plan mode button clicked"),j.toggleSidebar(),console.log("[DirectView] Sidebar toggled, isCollapsed:",j.isCollapsed)},te=()=>{o.push("/home")},K=()=>{o.push("/configs")},U=async O=>{var C,W,ge,ee,_e,xe,Be,qe,Me;if(console.log("[DirectView] Plan execution requested:",O),F.value){console.log("[DirectView] Plan execution already in progress, ignoring request");return}F.value=!0;let B=!1,oe=null;try{console.log("[DirectView] Adding messages for plan execution:",O.title),(C=u.value)==null||C.addMessage("user",O.title),B=!0,oe=(W=u.value)==null?void 0:W.addMessage("assistant","",{thinking:a("chat.planningExecution")}),oe&&((ge=u.value)==null||ge.startStreaming(oe.id),console.log("[DirectView] Added assistant message for plan execution:",oe.id))}catch(Pe){console.warn("[DirectView] Failed to add messages:",Pe)}try{const Pe=O.planData.planTemplateId;if(!Pe)throw new Error(a("direct.planTemplateIdNotFound"));console.log("[Direct] Executing plan with templateId:",Pe,"params:",O.params),console.log("[Direct] About to call PlanActApiService.executePlan");const $e=O.uploadedFiles??[],je=O.uploadKey??void 0;console.log("[Direct] ðŸ” DEBUG - InputArea uploadedFiles:",$e),console.log("[Direct] ðŸ” DEBUG - InputArea uploadKey:",je),console.log("[Direct] Executing with uploaded files:",$e.length),console.log("[Direct] Executing with replacement params:",O.replacementParams);let S;if((ee=O.params)!=null&&ee.trim()?(console.log("[Direct] Calling executePlan with rawParam:",O.params.trim()),S=await ut.executePlan(Pe,O.params.trim(),$e,O.replacementParams,je)):(console.log("[Direct] Calling executePlan without rawParam"),S=await ut.executePlan(Pe,void 0,$e,O.replacementParams,je)),console.log("[Direct] Plan execution API response:",S),S.planId&&oe)console.log("[Direct] Got planId from response:",S.planId,"starting plan execution"),(_e=u.value)==null||_e.updateMessage(oe.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:S.planId,rootPlanId:S.planId,status:"running"}}),A.value=S.planId,console.log("[Direct] Set currentRootPlanId to:",S.planId),console.log("[Direct] Delegating plan execution to planExecutionManager"),Ue.handlePlanExecutionRequested(S.planId,O.title);else throw console.error("[Direct] No planId in response:",S),new Error(a("direct.executionFailedNoPlanId"))}catch(Pe){console.error("[Direct] Plan execution failed:",Pe),console.error("[Direct] Error details:",{message:Pe.message,stack:Pe.stack}),A.value=null;try{console.log("[Direct] Adding error messages to chat"),B||(xe=u.value)==null||xe.addMessage("user",O.title),oe?((Be=u.value)==null||Be.updateMessage(oe.id,{content:`${a("direct.executionFailed")}: ${Pe.message||a("common.unknownError")}`,thinking:void 0}),(qe=u.value)==null||qe.stopStreaming(oe.id)):(Me=u.value)==null||Me.addMessage("assistant",`${a("direct.executionFailed")}: ${Pe.message||a("common.unknownError")}`)}catch($e){console.error("[Direct] Failed to add error messages:",$e),alert(`${a("direct.executionFailed")}: ${Pe.message||a("common.unknownError")}`)}}finally{console.log("[Direct] Plan execution finished, resetting isExecutingPlan flag"),F.value=!1}},J=()=>{u.value.showMemory()},Q=()=>{Oe.clearMemoryId(),u.value.newChat()};return(O,B)=>(p(),g("div",Gf,[s("div",Hf,[T(Vf,{ref_key:"sidebarRef",ref:b,onPlanExecutionRequested:U},null,512),s("div",{class:"left-panel",style:ze({width:$.value+"%"})},[s("div",Jf,[s("button",{class:"back-button",onClick:te},[T(r(R),{icon:"carbon:arrow-left"})]),s("h2",null,i(O.$t("conversation")),1),s("div",Wf,[T(Jo),s("button",{class:"config-button",onClick:Q,title:O.$t("memory.newChat")},[T(r(R),{icon:"carbon:add",width:"20"})],8,zf),s("button",{class:"config-button",onClick:K,title:O.$t("direct.configuration")},[T(r(R),{icon:"carbon:settings-adjust",width:"20"})],8,Kf),s("button",{class:"cron-task-btn",onClick:B[0]||(B[0]=oe=>r(Oe).toggleSidebar()),title:O.$t("memory.selectMemory")},[T(r(R),{icon:"carbon:calendar",width:"20"})],8,Xf)])]),s("div",Qf,[T(Xa,{ref_key:"chatRef",ref:u,mode:"direct","initial-prompt":c.value||"",onStepSelected:z,onSubPlanStepSelected:X},null,8,["initial-prompt"])]),(p(),pe(fl,{key:O.$i18n.locale,ref_key:"inputRef",ref:h,disabled:N.value,placeholder:N.value?r(a)("input.waiting"):r(a)("input.placeholder"),"initial-value":c.value,onSend:x,onClear:V,onFocus:Z,onUpdateState:Y,onPlanModeClicked:G},null,8,["disabled","placeholder","initial-value"]))],4),s("div",{class:"panel-resizer",onMousedown:_,onDblclick:M,title:O.$t("direct.panelResizeHint")},B[1]||(B[1]=[s("div",{class:"resizer-line"},null,-1)]),40,Yf),T(hc,{ref_key:"rightPanelRef",ref:m,style:ze({width:100-P.value+"%"}),"current-root-plan-id":A.value},null,8,["style","current-root-plan-id"])]),T(cr,{onMemorySelected:J}),r(l).show?(p(),g("div",{key:0,class:le(["message-toast",r(l).type])},[s("div",Zf,[s("span",null,i(r(l).text),1)])],2)):L("",!0)]))}}),Eg=ye(eg,[["__scopeId","data-v-e8d32f85"]]);export{Eg as default};
//# sourceMappingURL=index-tvOkUtoO.js.map
