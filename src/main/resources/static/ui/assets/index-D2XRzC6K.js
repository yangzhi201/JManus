var Ms=Object.defineProperty;var Us=(n,e,t)=>e in n?Ms(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var me=(n,e,t)=>Us(n,typeof e!="symbol"?e+"":e,t);import{d as ce,u as we,c as le,r as U,B as st,C as ie,o as Se,a as g,b as p,F as oe,g as k,f as V,p as Ee,h as ee,i as r,t as c,e as s,w as te,m as re,n as se,q as ae,D as wt,l as ne,E as ot,G as Ns,j as pe,A as be,H as $e,I as Zt,z as qe,T as Ue,J as Ye,K as es,v as Ls,M as ts,N as Ze,y as ss,O as Bs,_ as Os}from"./index-BzpuArMA.js";import{I as C,_ as de}from"./_plugin-vue_export-helper-CJZCuUvD.js";import{s as z,P as et,u as os}from"./sidebar-U86cmuOs.js";import{M as ns,u as as,a as qs}from"./useMessage-B5hIriOk.js";import{L as Lt}from"./llm-check-BVkAKrj3.js";import{L as Vs}from"./LanguageSwitcher-DP-ttqwM.js";class Ae{static async getCoordinatorToolConfig(){try{const e=await fetch(`${this.BASE_URL}/config`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get coordinator tool config: ${e.status}`);return await e.json()}catch(e){return console.error("Failed to get CoordinatorTool configuration:",e),{enabled:!0,success:!1,message:e.message}}}static async getAllEndpoints(){try{const e=await fetch(`${this.BASE_URL}/endpoints`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get endpoints: ${e.status}`);return await e.json()}catch(e){throw console.error("Failed to get endpoints:",e),new Error("Failed to get endpoints: "+e.message)}}static async getCoordinatorToolsByTemplate(e){console.log("[CoordinatorToolApiService] Starting to get coordinator tool, planTemplateId:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/get-get-or-new-by-template/${e}`);try{const t=await fetch(`${this.BASE_URL}/get-or-new-by-template/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",t.status),console.log("[CoordinatorToolApiService] Response status text:",t.statusText),t.status===404)return console.log("[CoordinatorToolApiService] 404"),null;if(!t.ok){const a=await t.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to get coordinator tools: ${t.status} - ${a}`)}const o=await t.json();return console.log("[CoordinatorToolApiService] Successfully got coordinator tool, result:",o),o}catch(t){throw console.error("[CoordinatorToolApiService] Failed to get coordinator tool:",t),new Error("Failed to get coordinator tool: "+t.message)}}static async getOrNewCoordinatorToolsByTemplate(e){console.log("[CoordinatorToolApiService] Starting to get or create coordinator tool, planTemplateId:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/get-or-new-by-template/${e}`);try{const t=await fetch(`${this.BASE_URL}/get-or-new-by-template/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",t.status),console.log("[CoordinatorToolApiService] Response status text:",t.statusText),!t.ok){const a=await t.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to get coordinator tools: ${t.status} - ${a}`)}const o=await t.json();return console.log("[CoordinatorToolApiService] Successfully got coordinator tool, result:",o),o}catch(t){throw console.error("[CoordinatorToolApiService] Failed to get coordinator tool:",t),new Error("Failed to get coordinator tool: "+t.message)}}static async createCoordinatorTool(e){console.log("[CoordinatorToolApiService] Starting to create coordinator tool"),console.log("[CoordinatorToolApiService] Original data:",JSON.stringify(e,null,2)),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}`);const t={id:e.id,toolName:e.toolName,toolDescription:e.toolDescription,inputSchema:e.inputSchema,planTemplateId:e.planTemplateId,httpEndpoint:e.httpEndpoint,mcpEndpoint:e.mcpEndpoint,serviceGroup:e.serviceGroup,enableInternalToolcall:e.enableInternalToolcall,enableHttpService:e.enableHttpService,enableMcpService:e.enableMcpService};console.log("[CoordinatorToolApiService] Cleaned sending data:",JSON.stringify(t,null,2));try{const o=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(console.log("[CoordinatorToolApiService] Response status:",o.status),console.log("[CoordinatorToolApiService] Response status text:",o.statusText),!o.ok){let l="Unknown error";try{const i=await o.json();l=i.message||i.error||l}catch{l=await o.text()||l}throw console.error("[CoordinatorToolApiService] Response error content:",l),new Error(`Failed to create coordinator tool: ${o.status} - ${l}`)}const a=await o.json();return console.log("[CoordinatorToolApiService] Created successfully, result:",a),a}catch(o){throw console.error("[CoordinatorToolApiService] Failed to create coordinator tool:",o),new Error("Failed to create coordinator tool: "+o.message)}}static async updateCoordinatorTool(e,t){console.log("[CoordinatorToolApiService] Starting to update coordinator tool, ID:",e),console.log("[CoordinatorToolApiService] Sending data:",t),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/${e}`);const o={id:t.id,toolName:t.toolName,toolDescription:t.toolDescription,inputSchema:t.inputSchema,planTemplateId:t.planTemplateId,httpEndpoint:t.httpEndpoint,mcpEndpoint:t.mcpEndpoint,serviceGroup:t.serviceGroup,enableInternalToolcall:t.enableInternalToolcall,enableHttpService:t.enableHttpService,enableMcpService:t.enableMcpService};console.log("[CoordinatorToolApiService] Cleaned sending data:",o);try{const a=await fetch(`${this.BASE_URL}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(console.log("[CoordinatorToolApiService] Response status:",a.status),console.log("[CoordinatorToolApiService] Response status text:",a.statusText),!a.ok){let i="Unknown error";try{const u=await a.json();i=u.message||u.error||i}catch{i=await a.text()||i}throw console.error("[CoordinatorToolApiService] Response error content:",i),new Error(`Failed to update coordinator tool: ${a.status} - ${i}`)}const l=await a.json();return console.log("[CoordinatorToolApiService] Updated successfully, result:",l),l}catch(a){throw console.error("[CoordinatorToolApiService] Failed to update coordinator tool:",a),new Error("Failed to update coordinator tool: "+a.message)}}static async deleteCoordinatorTool(e){console.log("[CoordinatorToolApiService] Starting to delete coordinator tool, ID:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/${e}`);try{const t=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",t.status),console.log("[CoordinatorToolApiService] Response status text:",t.statusText),!t.ok){const a=await t.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to delete coordinator tool: ${t.status} - ${a}`)}const o=await t.json();return console.log("[CoordinatorToolApiService] Deleted successfully, result:",o),o}catch(t){throw console.error("[CoordinatorToolApiService] Failed to delete coordinator tool:",t),new Error("Failed to delete coordinator tool: "+t.message)}}}me(Ae,"BASE_URL","/api/coordinator-tools");class xt{static async getParameterRequirements(e){try{const t=await fetch(`${this.BASE_URL}/${e}/parameters`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to get parameter requirements: ${t.statusText}`);return await t.json()}catch(t){throw console.error("Error getting parameter requirements:",t),t}}}me(xt,"BASE_URL","/api/plan-template");const js={class:"modal-form wide-modal"},Hs={class:"form-section"},Gs={class:"form-item"},Ws=["placeholder"],zs={class:"field-description"},Js={class:"form-section"},Ks={class:"form-item"},Xs=["placeholder"],Qs={class:"field-description"},Ys={class:"form-section"},Zs={class:"form-item"},eo=["placeholder"],to={class:"field-description"},so={class:"form-section"},oo={class:"section-title"},no={key:0,class:"params-help-text"},ao={class:"parameter-table"},lo=["onUpdate:modelValue","placeholder","readonly"],ro=["onUpdate:modelValue","placeholder"],io={class:"form-section"},co={class:"service-publish-options"},uo={class:"internal-toolcall-publish-option"},po={class:"checkbox-label"},ho={class:"checkbox-text"},mo={class:"checkbox-description"},fo={class:"http-publish-option"},vo={class:"checkbox-label"},go={class:"checkbox-text"},bo={class:"checkbox-description"},yo={class:"button-container"},_o=["disabled"],$o=["disabled"],So=ce({__name:"PublishServiceModal",props:{modelValue:{type:Boolean,default:!1},planTemplateId:{default:""},planTitle:{default:""},planDescription:{default:""}},emits:["update:modelValue","published"],setup(n,{expose:e,emit:t}){const{t:o}=we(),a=n,l=t,i=le({get:()=>a.modelValue,set:x=>l("update:modelValue",x)}),u=U(""),f=U(""),d=U(!1),m=U(!1),y=U(null),F=U(!1),B=U(!1),$=U(!0),S=U({parameters:[],hasParameters:!1,requirements:""}),_=U(!1),h=st({serviceName:"",userRequest:"",endpoint:"",serviceGroup:"",parameters:[]}),T=le(()=>{var q;const x=(q=y.value)==null?void 0:q.id;return o(x?"mcpService.updateService":"mcpService.createService")}),w=()=>{h.serviceName="",h.userRequest=a.planDescription||"",h.endpoint="",h.serviceGroup="",S.value.hasParameters||(h.parameters=[]),y.value=null,F.value=!1},R=async()=>{if(!a.planTemplateId){S.value={parameters:[],hasParameters:!1,requirements:""};return}_.value=!0;try{const x=await xt.getParameterRequirements(a.planTemplateId);S.value=x,x.hasParameters&&(h.parameters=x.parameters.map(q=>({name:q,description:""})))}catch(x){console.error("[PublishModal] Failed to load parameter requirements:",x),x instanceof Error&&!x.message.includes("404")&&console.warn("[PublishModal] Parameter requirements not available yet, will retry later"),S.value={parameters:[],hasParameters:!1,requirements:""}}finally{_.value=!1}},v=(x,q)=>{q==="success"?(f.value=x,setTimeout(()=>{f.value=""},3e3)):q==="error"&&(u.value=x,setTimeout(()=>{u.value=""},5e3))},P=()=>{if(!h.serviceName.trim())return v(o("mcpService.toolNameRequiredError"),"error"),!1;if(!h.userRequest.trim())return v(o("mcpService.toolDescriptionRequiredError"),"error"),!1;if(!h.serviceGroup.trim())return v(o("mcpService.serviceGroupRequiredError"),"error"),!1;if(!$.value&&!B.value)return v("Please select at least one service type","error"),!1;for(let x=0;x<h.parameters.length;x++){const q=h.parameters[x];if(q.name&&!q.description.trim())return v(`Parameter "${q.name}" description cannot be empty`,"error"),!1;if(q.description&&!q.name.trim())return v(`Parameter description "${q.description}" corresponding name cannot be empty`,"error"),!1}return!0},M=async()=>{if(console.log("[PublishModal] Starting to handle publish request"),console.log("[PublishModal] Form data:",h),console.log("[PublishModal] Current tool:",y.value),console.log("[PublishModal] Publish as HTTP service:",B.value),!P()){console.log("[PublishModal] Form validation failed");return}d.value=!0;try{y.value||(console.log("[PublishModal] No current tool data, getting or creating first"),y.value=await Ae.getOrNewCoordinatorToolsByTemplate(a.planTemplateId)),console.log("[PublishModal] Updating tool information"),y.value.toolName=h.serviceName.trim(),y.value.toolDescription=h.userRequest.trim(),y.value.serviceGroup=h.serviceGroup.trim(),y.value.planTemplateId=a.planTemplateId,y.value.enableInternalToolcall=$.value,y.value.enableHttpService=B.value,y.value.enableMcpService=!1,y.value.mcpEndpoint=void 0;const x=h.parameters.filter(b=>b.name.trim()&&b.description.trim()).map(b=>({name:b.name.trim(),description:b.description.trim(),type:"string"}));if(y.value.inputSchema=JSON.stringify(x),console.log("[PublishModal] Updated tool information:",y.value),y.value.id)console.log("[PublishModal] Updating existing tool, ID:",y.value.id),await Ae.updateCoordinatorTool(y.value.id,y.value);else{console.log("[PublishModal] Creating new tool");const b=await Ae.createCoordinatorTool(y.value);y.value=b}const q=[];if($.value&&q.push("Internal Method Call"),B.value&&q.push("HTTP Service"),q.length>0){console.log("[PublishModal] Step 5: Publishing service, ID:",y.value.id,"Enabled services:",q.join(", "));const b=[];$.value&&b.push(`Internal Call: ${h.serviceName}`),console.log("[PublishModal] Service published successfully"),v(o("mcpService.publishSuccess"),"success"),l("published",y.value)}else console.log("[PublishModal] Only saving tool, not publishing as any service"),v(o("mcpService.saveSuccess"),"success"),l("published",y.value)}catch(x){console.error("[PublishModal] Failed to publish service:",x),v(o("mcpService.publishFailed")+": "+x.message,"error")}finally{d.value=!1}},W=async()=>{var x;if(!m.value&&confirm(o("mcpService.deleteConfirmMessage"))){if(!((x=y.value)!=null&&x.id)){v(o("mcpService.deleteFailed")+": "+o("mcpService.selectPlanTemplateFirst"),"error");return}m.value=!0;try{console.log("[PublishModal] Starting to delete MCP service, ID:",y.value.id);const q=await Ae.deleteCoordinatorTool(y.value.id);if(q.success)console.log("[PublishModal] Deleted successfully"),v(o("mcpService.deleteSuccess"),"success"),i.value=!1,l("published",null);else throw new Error(q.message)}catch(q){console.error("[PublishModal] Failed to delete MCP service:",q),v(o("mcpService.deleteFailed")+": "+q.message,"error")}finally{m.value=!1}}},E=async()=>{i.value&&(console.log("[PublishModal] Modal opened, starting to initialize data"),w(),await A())},A=async()=>{if(!a.planTemplateId){console.log("[PublishModal] "+o("mcpService.noPlanTemplateId"));return}try{console.log("[PublishModal] Starting to load coordinator tool data, planTemplateId:",a.planTemplateId);const x=await Ae.getOrNewCoordinatorToolsByTemplate(a.planTemplateId);console.log("[PublishModal] Get coordinator tool data result:",x),y.value=x,F.value=!!x.id;const q=[];if(x.enableMcpService&&x.mcpEndpoint){const b=window.location.origin;q.push(`MCP: ${b}/mcp${x.mcpEndpoint}`)}x.enableInternalToolcall&&q.push(`Internal Call: ${x.toolName}`),console.log("[PublishModal] Load tool data completed"),h.serviceName=x.toolName||"",h.userRequest=x.toolDescription||a.planDescription||"",h.serviceGroup=x.serviceGroup||"",B.value=x.enableHttpService||!1,$.value=x.enableInternalToolcall||!1;try{if(x.inputSchema){const b=JSON.parse(x.inputSchema);Array.isArray(b)&&b.length>0?(h.parameters=b.map(D=>({name:D.name||"",description:D.description||""})),console.log("[PublishModal] Load parameters from inputSchema:",h.parameters)):console.log("[PublishModal] inputSchema is empty, keeping existing parameters:",h.parameters)}}catch(b){console.warn("[PublishModal] "+o("mcpService.parseInputSchemaFailed")+":",b),console.log("[PublishModal] Parsing failed, keeping existing parameters:",h.parameters)}console.log("[PublishModal] Form data filled:",h)}catch(x){console.error("[PublishModal] "+o("mcpService.loadToolDataFailed")+":",x),v(o("mcpService.loadToolDataFailed")+": "+x.message,"error")}};return ie(()=>a.modelValue,E),ie(()=>a.planTemplateId,(x,q)=>{x&&x!==q&&(q&&x.startsWith("planTemplate-")?setTimeout(()=>{R()},1e3):R())}),Se(async()=>{i.value&&(console.log("[PublishModal] Initialize when component mounted"),w(),await A(),await R())}),e({loadParameterRequirements:R}),(x,q)=>(p(),g(oe,null,[k(ns,{modelValue:i.value,"onUpdate:modelValue":q[5]||(q[5]=b=>i.value=b),title:T.value,onConfirm:M},{footer:Ee(()=>{var b;return[s("div",yo,[F.value&&((b=y.value)!=null&&b.id)?(p(),g("button",{key:0,class:"action-btn danger",onClick:W,disabled:m.value},[m.value?(p(),ne(r(C),{key:0,icon:"carbon:loading",class:"loading-icon"})):(p(),ne(r(C),{key:1,icon:"carbon:trash-can"})),ee(" "+c(m.value?r(o)("mcpService.deleting"):r(o)("mcpService.delete")),1)],8,_o)):V("",!0),s("button",{class:"action-btn primary",onClick:M,disabled:d.value},[d.value?(p(),ne(r(C),{key:0,icon:"carbon:loading",class:"loading-icon"})):(p(),ne(r(C),{key:1,icon:"carbon:cloud-upload"})),ee(" "+c(d.value?r(o)("mcpService.publishing"):r(o)("mcpService.publishAsService")),1)],8,$o)])]}),default:Ee(()=>[s("div",js,[s("div",Hs,[s("div",Gs,[s("label",null,c(r(o)("mcpService.toolNameRequired")),1),te(s("input",{type:"text","onUpdate:modelValue":q[0]||(q[0]=b=>h.serviceName=b),placeholder:r(o)("mcpService.toolNamePlaceholder"),class:se({error:!h.serviceName||!h.serviceName.trim()}),required:""},null,10,Ws),[[re,h.serviceName]]),s("div",zs,c(r(o)("mcpService.toolNameDescription")),1)])]),s("div",Js,[s("div",Ks,[s("label",null,c(r(o)("mcpService.toolDescriptionRequired")),1),te(s("textarea",{"onUpdate:modelValue":q[1]||(q[1]=b=>h.userRequest=b),placeholder:r(o)("mcpService.toolDescriptionPlaceholder"),class:se([{error:!h.userRequest||!h.userRequest.trim()},"description-field"]),rows:"4",required:""},null,10,Xs),[[re,h.userRequest]]),s("div",Qs,c(r(o)("mcpService.toolDescriptionDescription")),1)])]),s("div",Ys,[s("div",Zs,[s("label",null,c(r(o)("mcpService.serviceGroup")),1),te(s("input",{type:"text","onUpdate:modelValue":q[2]||(q[2]=b=>h.serviceGroup=b),placeholder:r(o)("mcpService.serviceGroupPlaceholder"),class:se({error:!h.serviceGroup||!h.serviceGroup.trim()}),required:""},null,10,eo),[[re,h.serviceGroup]]),s("div",to,c(r(o)("mcpService.serviceGroupDescription")),1)])]),s("div",so,[s("div",oo,c(r(o)("mcpService.parameterConfig")),1),S.value.hasParameters?(p(),g("div",no,c(r(o)("sidebar.parameterRequirementsHelp")),1)):V("",!0),s("div",ao,[s("table",null,[s("thead",null,[s("tr",null,[s("th",null,c(r(o)("mcpService.parameterName")),1),s("th",null,c(r(o)("mcpService.parameterDescription")),1)])]),s("tbody",null,[(p(!0),g(oe,null,ae(h.parameters,(b,D)=>(p(),g("tr",{key:D},[s("td",null,[te(s("input",{type:"text","onUpdate:modelValue":J=>b.name=J,placeholder:r(o)("mcpService.parameterName"),class:se(["parameter-input",{"readonly-input":S.value.hasParameters}]),readonly:S.value.hasParameters,required:""},null,10,lo),[[re,b.name]])]),s("td",null,[te(s("input",{type:"text","onUpdate:modelValue":J=>b.description=J,placeholder:r(o)("mcpService.parameterDescription"),class:"parameter-input",required:""},null,8,ro),[[re,b.description]])])]))),128))])])])]),s("div",io,[s("div",co,[s("div",uo,[s("label",po,[te(s("input",{type:"checkbox","onUpdate:modelValue":q[3]||(q[3]=b=>$.value=b),class:"checkbox-input"},null,512),[[wt,$.value]]),s("span",ho,c(r(o)("mcpService.publishAsInternalToolcall")),1)]),s("div",mo,c(r(o)("mcpService.publishAsInternalToolcallDescription")),1)]),s("div",fo,[s("label",vo,[te(s("input",{type:"checkbox","onUpdate:modelValue":q[4]||(q[4]=b=>B.value=b),class:"checkbox-input"},null,512),[[wt,B.value]]),s("span",go,c(r(o)("mcpService.publishAsHttpService")),1)]),s("div",bo,c(r(o)("mcpService.publishAsHttpServiceDescription")),1)])])])])]),_:1},8,["modelValue","title"]),u.value?(p(),g("div",{key:0,class:"error-toast",onClick:q[6]||(q[6]=b=>u.value="")},[k(r(C),{icon:"carbon:error"}),ee(" "+c(u.value),1)])):V("",!0),f.value?(p(),g("div",{key:1,class:"success-toast",onClick:q[7]||(q[7]=b=>f.value="")},[k(r(C),{icon:"carbon:checkmark"}),ee(" "+c(f.value),1)])):V("",!0)],64))}}),wo=de(So,[["__scopeId","data-v-d478032a"]]);function ls(n,e){const t=U(!1),o=st({title:"",steps:[],directResponse:!1,planTemplateId:n.currentPlanTemplateId||"",planType:"dynamic_agent"}),a=_=>{try{if(!_){Object.assign(o,{title:"",steps:[],directResponse:!1,planTemplateId:n.currentPlanTemplateId||"",planType:"dynamic_agent"});return}const h=JSON.parse(_);o.title=h.title||"",o.directResponse=!1,o.planTemplateId=h.planTemplateId||n.currentPlanTemplateId||"",o.planType=h.planType||"dynamic_agent",o.steps=(h.steps||[]).map(T=>({stepRequirement:T.stepRequirement||"",agentName:T.agentName||"",modelName:T.modelName||null,selectedToolKeys:T.selectedToolKeys||[],terminateColumns:T.terminateColumns||""}))}catch(h){console.warn("Failed to parse JSON content:",h)}},l=()=>{try{const _={title:o.title,steps:o.steps.map(h=>({stepRequirement:h.stepRequirement,agentName:h.agentName,modelName:h.modelName||"",selectedToolKeys:h.selectedToolKeys,terminateColumns:h.terminateColumns})),directResponse:o.directResponse,planTemplateId:o.planTemplateId,planType:o.planType};return JSON.stringify(_,null,2)}catch(_){return console.error("Failed to convert visual data to JSON:",_),"{}"}},i=le(()=>l());return ie(()=>n.jsonContent,_=>{a(_)},{immediate:!0}),ie(o,()=>{const _=l();e("update:jsonContent",_)},{deep:!0}),ie(()=>n.currentPlanTemplateId,_=>{_&&(o.planTemplateId=_)}),{showJsonPreview:t,displayData:o,formattedJsonOutput:i,addStep:()=>{const _={stepRequirement:"",agentName:"ConfigurableDynaAgent",modelName:null,selectedToolKeys:[],terminateColumns:"",agentType:"",stepContent:""};o.steps.push(_)},removeStep:_=>{_>=0&&_<o.steps.length&&o.steps.splice(_,1)},moveStepUp:_=>{if(_>0){const h=o.steps.splice(_,1)[0];o.steps.splice(_-1,0,h)}},moveStepDown:_=>{if(_<o.steps.length-1){const h=o.steps.splice(_,1)[0];o.steps.splice(_+1,0,h)}},toggleJsonPreview:()=>{t.value=!t.value},closeJsonPreview:()=>{t.value=!1},handleRollback:()=>{e("rollback")},handleRestore:()=>{e("restore")},handleSave:()=>{e("save")}}}const ko={class:"config-section"},To={class:"section-header"},Po={class:"visual-editor"},Co={class:"plan-basic-info"},Eo={class:"form-row"},Ro={class:"form-label"},Io=["placeholder"],Ao={class:"steps-section"},xo={class:"steps-header"},Do={class:"form-label"},Fo={class:"steps-container"},Mo={class:"step-header"},Uo={class:"step-number"},No={class:"step-actions"},Lo=["onClick","disabled","title"],Bo=["onClick","disabled","title"],Oo=["onClick","title"],qo={class:"step-content"},Vo={class:"form-row"},jo={class:"form-label"},Ho={class:"agent-selector"},Go=["onUpdate:modelValue"],Wo={value:""},zo=["title"],Jo={class:"form-row"},Ko={class:"form-label"},Xo=["onUpdate:modelValue","placeholder"],Qo={class:"form-row"},Yo={class:"form-label"},Zo=["onUpdate:modelValue","placeholder"],en={key:0,class:"empty-steps"},tn={class:"plan-id-section"},sn={class:"form-row"},on={class:"form-label"},nn={key:0,class:"json-preview"},an={class:"preview-header"},ln={class:"form-label"},rn={class:"json-code"},cn={class:"editor-footer"},dn={class:"section-actions"},un=["disabled","title"],pn=["disabled","title"],hn=["disabled"],mn=ce({__name:"JsonEditor",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},hiddenFields:{default:()=>["currentPlanId","userRequest","rootPlanId"]},currentPlanTemplateId:{}},emits:["rollback","restore","save","update:jsonContent"],setup(n,{emit:e}){const t=n,o=e,{showJsonPreview:a,displayData:l,formattedJsonOutput:i,addStep:u,removeStep:f,moveStepUp:d,moveStepDown:m,handleRollback:y,handleRestore:F,handleSave:B,toggleJsonPreview:$,closeJsonPreview:S}=ls(t,o),_=h=>{const T=h.target;if(!T)return;T.style.height="auto";const w=20,R=Math.ceil(T.scrollHeight/w),v=4,P=12,M=Math.max(v,Math.min(P,R)),W=M*w;T.style.height=`${W}px`,T.rows=M,R>P?T.style.overflowY="auto":T.style.overflowY="hidden"};return(h,T)=>(p(),g("div",ko,[s("div",To,[k(r(C),{icon:"carbon:code",width:"16"}),s("span",null,c(h.$t("sidebar.jsonTemplate")),1)]),s("div",Po,[s("div",Co,[s("div",Eo,[s("label",Ro,c(h.$t("sidebar.title")),1),te(s("input",{"onUpdate:modelValue":T[0]||(T[0]=w=>r(l).title=w),type:"text",class:"form-input",placeholder:h.$t("sidebar.titlePlaceholder")},null,8,Io),[[re,r(l).title]])])]),s("div",Ao,[s("div",xo,[s("label",Do,c(h.$t("sidebar.tasks")),1)]),s("div",Fo,[(p(!0),g(oe,null,ae(r(l).steps,(w,R)=>(p(),g("div",{key:R,class:"step-item"},[s("div",Mo,[s("span",Uo,c(h.$t("sidebar.subtask"))+" "+c(R+1),1),s("div",No,[s("button",{onClick:v=>r(d)(R),disabled:R===0,class:"btn btn-xs",title:h.$t("sidebar.moveUp")},[k(r(C),{icon:"carbon:chevron-up",width:"12"})],8,Lo),s("button",{onClick:v=>r(m)(R),disabled:R===r(l).steps.length-1,class:"btn btn-xs",title:h.$t("sidebar.moveDown")},[k(r(C),{icon:"carbon:chevron-down",width:"12"})],8,Bo),s("button",{onClick:v=>r(f)(R),class:"btn btn-xs btn-danger",title:h.$t("sidebar.removeStep")},[k(r(C),{icon:"carbon:trash-can",width:"12"})],8,Oo)])]),s("div",qo,[s("div",Vo,[s("label",jo,c(h.$t("sidebar.agent")),1),s("div",Ho,[te(s("select",{"onUpdate:modelValue":v=>w.agentName=v,class:"form-select agent-select"},[s("option",Wo,c(h.$t("sidebar.selectAgent")),1),T[10]||(T[10]=Ns('<option value="DEFAULT_AGENT" data-v-228d1ada>DEFAULT_AGENT</option><option value="BROWSER_AGENT" data-v-228d1ada>BROWSER_AGENT</option><option value="TEXT_FILE_AGENT" data-v-228d1ada>TEXT_FILE_AGENT</option><option value="JSX_GENERATOR_AGENT" data-v-228d1ada>JSX_GENERATOR_AGENT</option><option value="FILE_MANAGER_AGENT" data-v-228d1ada>FILE_MANAGER_AGENT</option>',5))],8,Go),[[ot,w.agentName]]),s("button",{onClick:T[1]||(T[1]=(...v)=>r(u)&&r(u)(...v)),class:"btn btn-sm btn-add-step",title:h.$t("sidebar.addStep")},[k(r(C),{icon:"carbon:add",width:"14"})],8,zo)])]),s("div",Jo,[s("label",Ko,c(h.$t("sidebar.stepRequirement")),1),te(s("textarea",{"onUpdate:modelValue":v=>w.stepContent=v,class:"form-textarea auto-resize",placeholder:h.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:T[2]||(T[2]=v=>_(v))},null,40,Xo),[[re,w.stepContent]])]),s("div",Qo,[s("label",Yo,c(h.$t("sidebar.terminateColumns")),1),te(s("input",{"onUpdate:modelValue":v=>w.terminateColumns=v,type:"text",class:"form-input",placeholder:h.$t("sidebar.terminateColumnsPlaceholder")},null,8,Zo),[[re,w.terminateColumns]])])])]))),128)),r(l).steps.length===0?(p(),g("div",en,[k(r(C),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),s("p",null,c(h.$t("sidebar.noSteps")),1),s("button",{onClick:T[3]||(T[3]=(...w)=>r(u)&&r(u)(...w)),class:"btn btn-primary"},[k(r(C),{icon:"carbon:add",width:"14"}),ee(" "+c(h.$t("sidebar.addFirstStep")),1)])])):V("",!0)])]),s("div",tn,[s("div",sn,[s("label",on,c(h.$t("sidebar.planId")),1),te(s("input",{"onUpdate:modelValue":T[4]||(T[4]=w=>r(l).planTemplateId=w),type:"text",class:"form-input",placeholder:"planTemplate-1756109892045"},null,512),[[re,r(l).planTemplateId]])])]),r(a)?(p(),g("div",nn,[s("div",an,[s("label",ln,c(h.$t("sidebar.jsonPreview")),1),s("button",{onClick:T[5]||(T[5]=(...w)=>r(S)&&r(S)(...w)),class:"btn btn-xs"},[k(r(C),{icon:"carbon:close",width:"12"})])]),s("pre",rn,c(r(i)),1)])):V("",!0),s("div",cn,[s("button",{onClick:T[6]||(T[6]=(...w)=>r($)&&r($)(...w)),class:"btn btn-sm btn-secondary"},[k(r(C),{icon:"carbon:code",width:"14"}),ee(" "+c(r(a)?h.$t("sidebar.hideJson"):h.$t("sidebar.showJson")),1)]),s("div",dn,[s("button",{class:"btn btn-sm",onClick:T[7]||(T[7]=(...w)=>r(y)&&r(y)(...w)),disabled:!(h.canRollback??!1),title:h.$t("sidebar.rollback")},[k(r(C),{icon:"carbon:undo",width:"14"})],8,un),s("button",{class:"btn btn-sm",onClick:T[8]||(T[8]=(...w)=>r(F)&&r(F)(...w)),disabled:!(h.canRestore??!1),title:h.$t("sidebar.restore")},[k(r(C),{icon:"carbon:redo",width:"14"})],8,pn),s("button",{class:"btn btn-primary",onClick:T[9]||(T[9]=(...w)=>r(B)&&r(B)(...w)),disabled:h.isGenerating||h.isExecuting},[k(r(C),{icon:"carbon:save",width:"14"}),T[11]||(T[11]=ee(" Save "))],8,hn)])])])]))}}),fn=de(mn,[["__scopeId","data-v-228d1ada"]]),vn={class:"tool-selection-content"},gn={class:"tool-controls"},bn={class:"search-container"},yn=["placeholder"],_n={class:"sort-container"},$n={value:"group"},Sn={value:"name"},wn={value:"enabled"},kn={class:"tool-summary"},Tn={class:"summary-text"},Pn={key:0,class:"tool-groups"},Cn=["onClick"],En={class:"group-title-area"},Rn={class:"group-name"},In={class:"group-count"},An={class:"group-enable-all"},xn=["checked","onChange","data-group"],Dn={class:"enable-label"},Fn={class:"tool-info"},Mn={class:"tool-selection-name"},Un={key:0,class:"tool-selection-desc"},Nn={class:"tool-actions"},Ln=["checked","onChange"],Bn={key:1,class:"empty-state"},On=ce({__name:"ToolSelectionModal",props:{modelValue:{type:Boolean},tools:{},selectedToolIds:{}},emits:["update:modelValue","confirm"],setup(n,{emit:e}){const t=n,o=e,a=le({get:()=>t.modelValue,set:P=>o("update:modelValue",P)}),l=U(""),i=U("group"),u=U(new Set),f=U([]),d=(P,M)=>{const W=document.querySelector(`input[data-group="${P}"]`);W&&(W.indeterminate=h(M))};ie(()=>t.selectedToolIds,P=>{f.value=[...P]},{immediate:!0});const m=le(()=>{let P=t.tools.filter(M=>M.key);if(P=P.filter(M=>M.selectable===!0),l.value){const M=l.value.toLowerCase();P=P.filter(W=>W.name.toLowerCase().includes(M)||W.description.toLowerCase().includes(M)||(W.serviceGroup.toLowerCase().includes(M)??!1))}switch(i.value){case"name":P=[...P].sort((M,W)=>M.name.localeCompare(W.name));break;case"enabled":P=[...P].sort((M,W)=>{const E=f.value.includes(M.key),A=f.value.includes(W.key);return E&&!A?-1:!E&&A?1:M.name.localeCompare(W.name)});break;case"group":default:P=[...P].sort((M,W)=>{const E=M.serviceGroup??"Ungrouped",A=W.serviceGroup??"Ungrouped";return E!==A?E.localeCompare(A):M.name.localeCompare(W.name)});break}return P}),y=le(()=>{const P=new Map;return m.value.forEach(M=>{const W=M.serviceGroup??"Ungrouped";P.has(W)||P.set(W,[]),P.get(W).push(M)}),new Map([...P.entries()].sort())}),F=le(()=>m.value.length);ie([f,y],()=>{be(()=>{for(const[P,M]of y.value)d(P,M)})},{flush:"post",deep:!1});const B=P=>f.value.includes(P),$=(P,M)=>{M.stopPropagation();const E=M.target.checked;if(!P){console.error("toolKey is undefined, cannot proceed");return}E?f.value.includes(P)||(f.value=[...f.value,P]):f.value=f.value.filter(A=>A!==P)},S=P=>P.filter(M=>f.value.includes(M.key)),_=P=>P.length>0&&P.every(M=>f.value.includes(M.key)),h=P=>{const M=S(P).length;return M>0&&M<P.length},T=(P,M)=>{M.stopPropagation();const E=M.target.checked,A=P.map(x=>x.key);if(E){const x=[...f.value];A.forEach(q=>{x.includes(q)||x.push(q)}),f.value=x}else f.value=f.value.filter(x=>!A.includes(x))},w=P=>{u.value.has(P)?u.value.delete(P):u.value.add(P)},R=()=>{o("confirm",[...f.value]),o("update:modelValue",!1)},v=()=>{f.value=[...t.selectedToolIds],o("update:modelValue",!1)};return ie(a,P=>{if(P){u.value.clear();const M=Array.from(y.value.keys());M.length>1&&M.slice(1).forEach(W=>{u.value.add(W)})}}),(P,M)=>(p(),ne(ns,{modelValue:a.value,"onUpdate:modelValue":[M[4]||(M[4]=W=>a.value=W),v],title:P.$t("toolSelection.title"),onConfirm:R},{default:Ee(()=>[s("div",vn,[s("div",gn,[s("div",bn,[te(s("input",{"onUpdate:modelValue":M[0]||(M[0]=W=>l.value=W),type:"text",class:"search-input",placeholder:P.$t("toolSelection.searchPlaceholder")},null,8,yn),[[re,l.value]])]),s("div",_n,[te(s("select",{"onUpdate:modelValue":M[1]||(M[1]=W=>i.value=W),class:"sort-select"},[s("option",$n,c(P.$t("toolSelection.sortByGroup")),1),s("option",Sn,c(P.$t("toolSelection.sortByName")),1),s("option",wn,c(P.$t("toolSelection.sortByStatus")),1)],512),[[ot,i.value]])])]),s("div",kn,[s("span",Tn,c(P.$t("toolSelection.summary",{groups:y.value.size,tools:F.value,selected:f.value.length})),1)]),y.value.size>0?(p(),g("div",Pn,[(p(!0),g(oe,null,ae(y.value,([W,E])=>(p(),g("div",{key:W,class:"tool-group"},[s("div",{class:se(["tool-group-header",{collapsed:u.value.has(W)}]),onClick:A=>w(W)},[s("div",En,[k(r(C),{icon:u.value.has(W)?"carbon:chevron-right":"carbon:chevron-down",class:"collapse-icon"},null,8,["icon"]),k(r(C),{icon:"carbon:folder",class:"group-icon"}),s("span",Rn,c(W),1),s("span",In," ("+c(S(E).length)+"/"+c(E.length)+") ",1)]),s("div",{class:"group-actions",onClick:M[2]||(M[2]=pe(()=>{},["stop"]))},[s("label",An,[s("input",{type:"checkbox",class:"group-enable-checkbox",checked:_(E),onChange:A=>T(E,A),"data-group":W},null,40,xn),s("span",Dn,c(P.$t("toolSelection.enableAll")),1)])])],10,Cn),s("div",{class:se(["tool-group-content",{collapsed:u.value.has(W)}])},[(p(!0),g(oe,null,ae(E,A=>(p(),g("div",{key:A.key,class:"tool-selection-item"},[s("div",Fn,[s("div",Mn,c(A.name),1),A.description?(p(),g("div",Un,c(A.description),1)):V("",!0)]),s("div",Nn,[s("label",{class:"tool-enable-switch",onClick:M[3]||(M[3]=pe(()=>{},["stop"]))},[s("input",{type:"checkbox",class:"tool-enable-checkbox",checked:B(A.key),onChange:x=>$(A.key,x)},null,40,Ln),M[5]||(M[5]=s("span",{class:"tool-enable-slider"},null,-1))])])]))),128))],2)]))),128))])):(p(),g("div",Bn,[k(r(C),{icon:"carbon:tools",class:"empty-icon"}),s("p",null,c(P.$t("toolSelection.noToolsFound")),1)]))])]),_:1},8,["modelValue","title"]))}}),qn=de(On,[["__scopeId","data-v-9917118c"]]),Vn={class:"assigned-tools"},jn={class:"section-header"},Hn={class:"tool-info"},Gn={class:"tool-name"},Wn={class:"tool-desc"},zn={key:0,class:"no-tools"},Jn=ce({__name:"AssignedTools",props:{title:{},selectedToolIds:{},availableTools:{},addButtonText:{default:"Add/Remove Tools"},emptyText:{default:"No tools assigned"},showAddButton:{type:Boolean,default:!0},useGridLayout:{type:Boolean,default:!1}},emits:["add-tools","tools-filtered"],setup(n,{emit:e}){const t=n,o=e,a=le(()=>t.selectedToolIds.filter(u=>t.availableTools.some(f=>f.key===u)));ie(a,u=>{u.length!==t.selectedToolIds.length&&o("tools-filtered",u)},{immediate:!0});const l=u=>{const f=t.availableTools.find(d=>d.key===u);return f?f.name:u},i=u=>{const f=t.availableTools.find(d=>d.key===u);return f?f.description:""};return(u,f)=>(p(),g("div",Vn,[s("div",jn,[s("span",null,c(u.title)+" ("+c(a.value.length)+")",1),u.showAddButton?(p(),g("button",{key:0,class:"action-btn small",onClick:f[0]||(f[0]=d=>u.$emit("add-tools"))},[k(r(C),{icon:"carbon:add"}),ee(" "+c(u.addButtonText),1)])):V("",!0)]),s("div",{class:se(["tools-grid",{"grid-layout":u.useGridLayout}])},[(p(!0),g(oe,null,ae(a.value,d=>(p(),g("div",{key:d,class:"tool-item assigned"},[s("div",Hn,[s("span",Gn,c(l(d)),1),s("span",Wn,c(i(d)),1)])]))),128)),a.value.length===0?(p(),g("div",zn,[k(r(C),{icon:"carbon:tool-box"}),s("span",null,c(u.emptyText),1)])):V("",!0)],2)]))}}),Kn=de(Jn,[["__scopeId","data-v-b5fd8074"]]);function rs(n,e){return function(){return n.apply(e,arguments)}}const{toString:Xn}=Object.prototype,{getPrototypeOf:Dt}=Object,{iterator:pt,toStringTag:is}=Symbol,ht=(n=>e=>{const t=Xn.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Te=n=>(n=n.toLowerCase(),e=>ht(e)===n),mt=n=>e=>typeof e===n,{isArray:Ve}=Array,tt=mt("undefined");function Qn(n){return n!==null&&!tt(n)&&n.constructor!==null&&!tt(n.constructor)&&ye(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const cs=Te("ArrayBuffer");function Yn(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&cs(n.buffer),e}const Zn=mt("string"),ye=mt("function"),ds=mt("number"),ft=n=>n!==null&&typeof n=="object",ea=n=>n===!0||n===!1,lt=n=>{if(ht(n)!=="object")return!1;const e=Dt(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(is in n)&&!(pt in n)},ta=Te("Date"),sa=Te("File"),oa=Te("Blob"),na=Te("FileList"),aa=n=>ft(n)&&ye(n.pipe),la=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||ye(n.append)&&((e=ht(n))==="formdata"||e==="object"&&ye(n.toString)&&n.toString()==="[object FormData]"))},ra=Te("URLSearchParams"),[ia,ca,da,ua]=["ReadableStream","Request","Response","Headers"].map(Te),pa=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function nt(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let o,a;if(typeof n!="object"&&(n=[n]),Ve(n))for(o=0,a=n.length;o<a;o++)e.call(null,n[o],o,n);else{const l=t?Object.getOwnPropertyNames(n):Object.keys(n),i=l.length;let u;for(o=0;o<i;o++)u=l[o],e.call(null,n[u],u,n)}}function us(n,e){e=e.toLowerCase();const t=Object.keys(n);let o=t.length,a;for(;o-- >0;)if(a=t[o],e===a.toLowerCase())return a;return null}const Me=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,ps=n=>!tt(n)&&n!==Me;function kt(){const{caseless:n}=ps(this)&&this||{},e={},t=(o,a)=>{const l=n&&us(e,a)||a;lt(e[l])&&lt(o)?e[l]=kt(e[l],o):lt(o)?e[l]=kt({},o):Ve(o)?e[l]=o.slice():e[l]=o};for(let o=0,a=arguments.length;o<a;o++)arguments[o]&&nt(arguments[o],t);return e}const ha=(n,e,t,{allOwnKeys:o}={})=>(nt(e,(a,l)=>{t&&ye(a)?n[l]=rs(a,t):n[l]=a},{allOwnKeys:o}),n),ma=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),fa=(n,e,t,o)=>{n.prototype=Object.create(e.prototype,o),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},va=(n,e,t,o)=>{let a,l,i;const u={};if(e=e||{},n==null)return e;do{for(a=Object.getOwnPropertyNames(n),l=a.length;l-- >0;)i=a[l],(!o||o(i,n,e))&&!u[i]&&(e[i]=n[i],u[i]=!0);n=t!==!1&&Dt(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},ga=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const o=n.indexOf(e,t);return o!==-1&&o===t},ba=n=>{if(!n)return null;if(Ve(n))return n;let e=n.length;if(!ds(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},ya=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&Dt(Uint8Array)),_a=(n,e)=>{const o=(n&&n[pt]).call(n);let a;for(;(a=o.next())&&!a.done;){const l=a.value;e.call(n,l[0],l[1])}},$a=(n,e)=>{let t;const o=[];for(;(t=n.exec(e))!==null;)o.push(t);return o},Sa=Te("HTMLFormElement"),wa=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,o,a){return o.toUpperCase()+a}),Bt=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),ka=Te("RegExp"),hs=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),o={};nt(t,(a,l)=>{let i;(i=e(a,l,n))!==!1&&(o[l]=i||a)}),Object.defineProperties(n,o)},Ta=n=>{hs(n,(e,t)=>{if(ye(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const o=n[t];if(ye(o)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},Pa=(n,e)=>{const t={},o=a=>{a.forEach(l=>{t[l]=!0})};return Ve(n)?o(n):o(String(n).split(e)),t},Ca=()=>{},Ea=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e;function Ra(n){return!!(n&&ye(n.append)&&n[is]==="FormData"&&n[pt])}const Ia=n=>{const e=new Array(10),t=(o,a)=>{if(ft(o)){if(e.indexOf(o)>=0)return;if(!("toJSON"in o)){e[a]=o;const l=Ve(o)?[]:{};return nt(o,(i,u)=>{const f=t(i,a+1);!tt(f)&&(l[u]=f)}),e[a]=void 0,l}}return o};return t(n,0)},Aa=Te("AsyncFunction"),xa=n=>n&&(ft(n)||ye(n))&&ye(n.then)&&ye(n.catch),ms=((n,e)=>n?setImmediate:e?((t,o)=>(Me.addEventListener("message",({source:a,data:l})=>{a===Me&&l===t&&o.length&&o.shift()()},!1),a=>{o.push(a),Me.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",ye(Me.postMessage)),Da=typeof queueMicrotask<"u"?queueMicrotask.bind(Me):typeof process<"u"&&process.nextTick||ms,Fa=n=>n!=null&&ye(n[pt]),I={isArray:Ve,isArrayBuffer:cs,isBuffer:Qn,isFormData:la,isArrayBufferView:Yn,isString:Zn,isNumber:ds,isBoolean:ea,isObject:ft,isPlainObject:lt,isReadableStream:ia,isRequest:ca,isResponse:da,isHeaders:ua,isUndefined:tt,isDate:ta,isFile:sa,isBlob:oa,isRegExp:ka,isFunction:ye,isStream:aa,isURLSearchParams:ra,isTypedArray:ya,isFileList:na,forEach:nt,merge:kt,extend:ha,trim:pa,stripBOM:ma,inherits:fa,toFlatObject:va,kindOf:ht,kindOfTest:Te,endsWith:ga,toArray:ba,forEachEntry:_a,matchAll:$a,isHTMLForm:Sa,hasOwnProperty:Bt,hasOwnProp:Bt,reduceDescriptors:hs,freezeMethods:Ta,toObjectSet:Pa,toCamelCase:wa,noop:Ca,toFiniteNumber:Ea,findKey:us,global:Me,isContextDefined:ps,isSpecCompliantForm:Ra,toJSONObject:Ia,isAsyncFn:Aa,isThenable:xa,setImmediate:ms,asap:Da,isIterable:Fa};function Z(n,e,t,o,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),o&&(this.request=o),a&&(this.response=a,this.status=a.status?a.status:null)}I.inherits(Z,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:I.toJSONObject(this.config),code:this.code,status:this.status}}});const fs=Z.prototype,vs={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{vs[n]={value:n}});Object.defineProperties(Z,vs);Object.defineProperty(fs,"isAxiosError",{value:!0});Z.from=(n,e,t,o,a,l)=>{const i=Object.create(fs);return I.toFlatObject(n,i,function(f){return f!==Error.prototype},u=>u!=="isAxiosError"),Z.call(i,n.message,e,t,o,a),i.cause=n,i.name=n.name,l&&Object.assign(i,l),i};const Ma=null;function Tt(n){return I.isPlainObject(n)||I.isArray(n)}function gs(n){return I.endsWith(n,"[]")?n.slice(0,-2):n}function Ot(n,e,t){return n?n.concat(e).map(function(a,l){return a=gs(a),!t&&l?"["+a+"]":a}).join(t?".":""):e}function Ua(n){return I.isArray(n)&&!n.some(Tt)}const Na=I.toFlatObject(I,{},null,function(e){return/^is[A-Z]/.test(e)});function vt(n,e,t){if(!I.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=I.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(S,_){return!I.isUndefined(_[S])});const o=t.metaTokens,a=t.visitor||m,l=t.dots,i=t.indexes,f=(t.Blob||typeof Blob<"u"&&Blob)&&I.isSpecCompliantForm(e);if(!I.isFunction(a))throw new TypeError("visitor must be a function");function d($){if($===null)return"";if(I.isDate($))return $.toISOString();if(!f&&I.isBlob($))throw new Z("Blob is not supported. Use a Buffer instead.");return I.isArrayBuffer($)||I.isTypedArray($)?f&&typeof Blob=="function"?new Blob([$]):Buffer.from($):$}function m($,S,_){let h=$;if($&&!_&&typeof $=="object"){if(I.endsWith(S,"{}"))S=o?S:S.slice(0,-2),$=JSON.stringify($);else if(I.isArray($)&&Ua($)||(I.isFileList($)||I.endsWith(S,"[]"))&&(h=I.toArray($)))return S=gs(S),h.forEach(function(w,R){!(I.isUndefined(w)||w===null)&&e.append(i===!0?Ot([S],R,l):i===null?S:S+"[]",d(w))}),!1}return Tt($)?!0:(e.append(Ot(_,S,l),d($)),!1)}const y=[],F=Object.assign(Na,{defaultVisitor:m,convertValue:d,isVisitable:Tt});function B($,S){if(!I.isUndefined($)){if(y.indexOf($)!==-1)throw Error("Circular reference detected in "+S.join("."));y.push($),I.forEach($,function(h,T){(!(I.isUndefined(h)||h===null)&&a.call(e,h,I.isString(T)?T.trim():T,S,F))===!0&&B(h,S?S.concat(T):[T])}),y.pop()}}if(!I.isObject(n))throw new TypeError("data must be an object");return B(n),e}function qt(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(o){return e[o]})}function Ft(n,e){this._pairs=[],n&&vt(n,this,e)}const bs=Ft.prototype;bs.append=function(e,t){this._pairs.push([e,t])};bs.toString=function(e){const t=e?function(o){return e.call(this,o,qt)}:qt;return this._pairs.map(function(a){return t(a[0])+"="+t(a[1])},"").join("&")};function La(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ys(n,e,t){if(!e)return n;const o=t&&t.encode||La;I.isFunction(t)&&(t={serialize:t});const a=t&&t.serialize;let l;if(a?l=a(e,t):l=I.isURLSearchParams(e)?e.toString():new Ft(e,t).toString(o),l){const i=n.indexOf("#");i!==-1&&(n=n.slice(0,i)),n+=(n.indexOf("?")===-1?"?":"&")+l}return n}class Vt{constructor(){this.handlers=[]}use(e,t,o){return this.handlers.push({fulfilled:e,rejected:t,synchronous:o?o.synchronous:!1,runWhen:o?o.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){I.forEach(this.handlers,function(o){o!==null&&e(o)})}}const _s={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Ba=typeof URLSearchParams<"u"?URLSearchParams:Ft,Oa=typeof FormData<"u"?FormData:null,qa=typeof Blob<"u"?Blob:null,Va={isBrowser:!0,classes:{URLSearchParams:Ba,FormData:Oa,Blob:qa},protocols:["http","https","file","blob","url","data"]},Mt=typeof window<"u"&&typeof document<"u",Pt=typeof navigator=="object"&&navigator||void 0,ja=Mt&&(!Pt||["ReactNative","NativeScript","NS"].indexOf(Pt.product)<0),Ha=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Ga=Mt&&window.location.href||"http://localhost",Wa=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Mt,hasStandardBrowserEnv:ja,hasStandardBrowserWebWorkerEnv:Ha,navigator:Pt,origin:Ga},Symbol.toStringTag,{value:"Module"})),ve={...Wa,...Va};function za(n,e){return vt(n,new ve.classes.URLSearchParams,Object.assign({visitor:function(t,o,a,l){return ve.isNode&&I.isBuffer(t)?(this.append(o,t.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)}},e))}function Ja(n){return I.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Ka(n){const e={},t=Object.keys(n);let o;const a=t.length;let l;for(o=0;o<a;o++)l=t[o],e[l]=n[l];return e}function $s(n){function e(t,o,a,l){let i=t[l++];if(i==="__proto__")return!0;const u=Number.isFinite(+i),f=l>=t.length;return i=!i&&I.isArray(a)?a.length:i,f?(I.hasOwnProp(a,i)?a[i]=[a[i],o]:a[i]=o,!u):((!a[i]||!I.isObject(a[i]))&&(a[i]=[]),e(t,o,a[i],l)&&I.isArray(a[i])&&(a[i]=Ka(a[i])),!u)}if(I.isFormData(n)&&I.isFunction(n.entries)){const t={};return I.forEachEntry(n,(o,a)=>{e(Ja(o),a,t,0)}),t}return null}function Xa(n,e,t){if(I.isString(n))try{return(e||JSON.parse)(n),I.trim(n)}catch(o){if(o.name!=="SyntaxError")throw o}return(t||JSON.stringify)(n)}const at={transitional:_s,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const o=t.getContentType()||"",a=o.indexOf("application/json")>-1,l=I.isObject(e);if(l&&I.isHTMLForm(e)&&(e=new FormData(e)),I.isFormData(e))return a?JSON.stringify($s(e)):e;if(I.isArrayBuffer(e)||I.isBuffer(e)||I.isStream(e)||I.isFile(e)||I.isBlob(e)||I.isReadableStream(e))return e;if(I.isArrayBufferView(e))return e.buffer;if(I.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(l){if(o.indexOf("application/x-www-form-urlencoded")>-1)return za(e,this.formSerializer).toString();if((u=I.isFileList(e))||o.indexOf("multipart/form-data")>-1){const f=this.env&&this.env.FormData;return vt(u?{"files[]":e}:e,f&&new f,this.formSerializer)}}return l||a?(t.setContentType("application/json",!1),Xa(e)):e}],transformResponse:[function(e){const t=this.transitional||at.transitional,o=t&&t.forcedJSONParsing,a=this.responseType==="json";if(I.isResponse(e)||I.isReadableStream(e))return e;if(e&&I.isString(e)&&(o&&!this.responseType||a)){const i=!(t&&t.silentJSONParsing)&&a;try{return JSON.parse(e)}catch(u){if(i)throw u.name==="SyntaxError"?Z.from(u,Z.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ve.classes.FormData,Blob:ve.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};I.forEach(["delete","get","head","post","put","patch"],n=>{at.headers[n]={}});const Qa=I.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Ya=n=>{const e={};let t,o,a;return n&&n.split(`
`).forEach(function(i){a=i.indexOf(":"),t=i.substring(0,a).trim().toLowerCase(),o=i.substring(a+1).trim(),!(!t||e[t]&&Qa[t])&&(t==="set-cookie"?e[t]?e[t].push(o):e[t]=[o]:e[t]=e[t]?e[t]+", "+o:o)}),e},jt=Symbol("internals");function Qe(n){return n&&String(n).trim().toLowerCase()}function rt(n){return n===!1||n==null?n:I.isArray(n)?n.map(rt):String(n)}function Za(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let o;for(;o=t.exec(n);)e[o[1]]=o[2];return e}const el=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function _t(n,e,t,o,a){if(I.isFunction(o))return o.call(this,e,t);if(a&&(e=t),!!I.isString(e)){if(I.isString(o))return e.indexOf(o)!==-1;if(I.isRegExp(o))return o.test(e)}}function tl(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,o)=>t.toUpperCase()+o)}function sl(n,e){const t=I.toCamelCase(" "+e);["get","set","has"].forEach(o=>{Object.defineProperty(n,o+t,{value:function(a,l,i){return this[o].call(this,e,a,l,i)},configurable:!0})})}let _e=class{constructor(e){e&&this.set(e)}set(e,t,o){const a=this;function l(u,f,d){const m=Qe(f);if(!m)throw new Error("header name must be a non-empty string");const y=I.findKey(a,m);(!y||a[y]===void 0||d===!0||d===void 0&&a[y]!==!1)&&(a[y||f]=rt(u))}const i=(u,f)=>I.forEach(u,(d,m)=>l(d,m,f));if(I.isPlainObject(e)||e instanceof this.constructor)i(e,t);else if(I.isString(e)&&(e=e.trim())&&!el(e))i(Ya(e),t);else if(I.isObject(e)&&I.isIterable(e)){let u={},f,d;for(const m of e){if(!I.isArray(m))throw TypeError("Object iterator must return a key-value pair");u[d=m[0]]=(f=u[d])?I.isArray(f)?[...f,m[1]]:[f,m[1]]:m[1]}i(u,t)}else e!=null&&l(t,e,o);return this}get(e,t){if(e=Qe(e),e){const o=I.findKey(this,e);if(o){const a=this[o];if(!t)return a;if(t===!0)return Za(a);if(I.isFunction(t))return t.call(this,a,o);if(I.isRegExp(t))return t.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Qe(e),e){const o=I.findKey(this,e);return!!(o&&this[o]!==void 0&&(!t||_t(this,this[o],o,t)))}return!1}delete(e,t){const o=this;let a=!1;function l(i){if(i=Qe(i),i){const u=I.findKey(o,i);u&&(!t||_t(o,o[u],u,t))&&(delete o[u],a=!0)}}return I.isArray(e)?e.forEach(l):l(e),a}clear(e){const t=Object.keys(this);let o=t.length,a=!1;for(;o--;){const l=t[o];(!e||_t(this,this[l],l,e,!0))&&(delete this[l],a=!0)}return a}normalize(e){const t=this,o={};return I.forEach(this,(a,l)=>{const i=I.findKey(o,l);if(i){t[i]=rt(a),delete t[l];return}const u=e?tl(l):String(l).trim();u!==l&&delete t[l],t[u]=rt(a),o[u]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return I.forEach(this,(o,a)=>{o!=null&&o!==!1&&(t[a]=e&&I.isArray(o)?o.join(", "):o)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const o=new this(e);return t.forEach(a=>o.set(a)),o}static accessor(e){const o=(this[jt]=this[jt]={accessors:{}}).accessors,a=this.prototype;function l(i){const u=Qe(i);o[u]||(sl(a,i),o[u]=!0)}return I.isArray(e)?e.forEach(l):l(e),this}};_e.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);I.reduceDescriptors(_e.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(o){this[t]=o}}});I.freezeMethods(_e);function $t(n,e){const t=this||at,o=e||t,a=_e.from(o.headers);let l=o.data;return I.forEach(n,function(u){l=u.call(t,l,a.normalize(),e?e.status:void 0)}),a.normalize(),l}function Ss(n){return!!(n&&n.__CANCEL__)}function je(n,e,t){Z.call(this,n??"canceled",Z.ERR_CANCELED,e,t),this.name="CanceledError"}I.inherits(je,Z,{__CANCEL__:!0});function ws(n,e,t){const o=t.config.validateStatus;!t.status||!o||o(t.status)?n(t):e(new Z("Request failed with status code "+t.status,[Z.ERR_BAD_REQUEST,Z.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function ol(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function nl(n,e){n=n||10;const t=new Array(n),o=new Array(n);let a=0,l=0,i;return e=e!==void 0?e:1e3,function(f){const d=Date.now(),m=o[l];i||(i=d),t[a]=f,o[a]=d;let y=l,F=0;for(;y!==a;)F+=t[y++],y=y%n;if(a=(a+1)%n,a===l&&(l=(l+1)%n),d-i<e)return;const B=m&&d-m;return B?Math.round(F*1e3/B):void 0}}function al(n,e){let t=0,o=1e3/e,a,l;const i=(d,m=Date.now())=>{t=m,a=null,l&&(clearTimeout(l),l=null),n.apply(null,d)};return[(...d)=>{const m=Date.now(),y=m-t;y>=o?i(d,m):(a=d,l||(l=setTimeout(()=>{l=null,i(a)},o-y)))},()=>a&&i(a)]}const dt=(n,e,t=3)=>{let o=0;const a=nl(50,250);return al(l=>{const i=l.loaded,u=l.lengthComputable?l.total:void 0,f=i-o,d=a(f),m=i<=u;o=i;const y={loaded:i,total:u,progress:u?i/u:void 0,bytes:f,rate:d||void 0,estimated:d&&u&&m?(u-i)/d:void 0,event:l,lengthComputable:u!=null,[e?"download":"upload"]:!0};n(y)},t)},Ht=(n,e)=>{const t=n!=null;return[o=>e[0]({lengthComputable:t,total:n,loaded:o}),e[1]]},Gt=n=>(...e)=>I.asap(()=>n(...e)),ll=ve.hasStandardBrowserEnv?((n,e)=>t=>(t=new URL(t,ve.origin),n.protocol===t.protocol&&n.host===t.host&&(e||n.port===t.port)))(new URL(ve.origin),ve.navigator&&/(msie|trident)/i.test(ve.navigator.userAgent)):()=>!0,rl=ve.hasStandardBrowserEnv?{write(n,e,t,o,a,l){const i=[n+"="+encodeURIComponent(e)];I.isNumber(t)&&i.push("expires="+new Date(t).toGMTString()),I.isString(o)&&i.push("path="+o),I.isString(a)&&i.push("domain="+a),l===!0&&i.push("secure"),document.cookie=i.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function il(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function cl(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function ks(n,e,t){let o=!il(e);return n&&(o||t==!1)?cl(n,e):e}const Wt=n=>n instanceof _e?{...n}:n;function Le(n,e){e=e||{};const t={};function o(d,m,y,F){return I.isPlainObject(d)&&I.isPlainObject(m)?I.merge.call({caseless:F},d,m):I.isPlainObject(m)?I.merge({},m):I.isArray(m)?m.slice():m}function a(d,m,y,F){if(I.isUndefined(m)){if(!I.isUndefined(d))return o(void 0,d,y,F)}else return o(d,m,y,F)}function l(d,m){if(!I.isUndefined(m))return o(void 0,m)}function i(d,m){if(I.isUndefined(m)){if(!I.isUndefined(d))return o(void 0,d)}else return o(void 0,m)}function u(d,m,y){if(y in e)return o(d,m);if(y in n)return o(void 0,d)}const f={url:l,method:l,data:l,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:u,headers:(d,m,y)=>a(Wt(d),Wt(m),y,!0)};return I.forEach(Object.keys(Object.assign({},n,e)),function(m){const y=f[m]||a,F=y(n[m],e[m],m);I.isUndefined(F)&&y!==u||(t[m]=F)}),t}const Ts=n=>{const e=Le({},n);let{data:t,withXSRFToken:o,xsrfHeaderName:a,xsrfCookieName:l,headers:i,auth:u}=e;e.headers=i=_e.from(i),e.url=ys(ks(e.baseURL,e.url,e.allowAbsoluteUrls),n.params,n.paramsSerializer),u&&i.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):"")));let f;if(I.isFormData(t)){if(ve.hasStandardBrowserEnv||ve.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if((f=i.getContentType())!==!1){const[d,...m]=f?f.split(";").map(y=>y.trim()).filter(Boolean):[];i.setContentType([d||"multipart/form-data",...m].join("; "))}}if(ve.hasStandardBrowserEnv&&(o&&I.isFunction(o)&&(o=o(e)),o||o!==!1&&ll(e.url))){const d=a&&l&&rl.read(l);d&&i.set(a,d)}return e},dl=typeof XMLHttpRequest<"u",ul=dl&&function(n){return new Promise(function(t,o){const a=Ts(n);let l=a.data;const i=_e.from(a.headers).normalize();let{responseType:u,onUploadProgress:f,onDownloadProgress:d}=a,m,y,F,B,$;function S(){B&&B(),$&&$(),a.cancelToken&&a.cancelToken.unsubscribe(m),a.signal&&a.signal.removeEventListener("abort",m)}let _=new XMLHttpRequest;_.open(a.method.toUpperCase(),a.url,!0),_.timeout=a.timeout;function h(){if(!_)return;const w=_e.from("getAllResponseHeaders"in _&&_.getAllResponseHeaders()),v={data:!u||u==="text"||u==="json"?_.responseText:_.response,status:_.status,statusText:_.statusText,headers:w,config:n,request:_};ws(function(M){t(M),S()},function(M){o(M),S()},v),_=null}"onloadend"in _?_.onloadend=h:_.onreadystatechange=function(){!_||_.readyState!==4||_.status===0&&!(_.responseURL&&_.responseURL.indexOf("file:")===0)||setTimeout(h)},_.onabort=function(){_&&(o(new Z("Request aborted",Z.ECONNABORTED,n,_)),_=null)},_.onerror=function(){o(new Z("Network Error",Z.ERR_NETWORK,n,_)),_=null},_.ontimeout=function(){let R=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const v=a.transitional||_s;a.timeoutErrorMessage&&(R=a.timeoutErrorMessage),o(new Z(R,v.clarifyTimeoutError?Z.ETIMEDOUT:Z.ECONNABORTED,n,_)),_=null},l===void 0&&i.setContentType(null),"setRequestHeader"in _&&I.forEach(i.toJSON(),function(R,v){_.setRequestHeader(v,R)}),I.isUndefined(a.withCredentials)||(_.withCredentials=!!a.withCredentials),u&&u!=="json"&&(_.responseType=a.responseType),d&&([F,$]=dt(d,!0),_.addEventListener("progress",F)),f&&_.upload&&([y,B]=dt(f),_.upload.addEventListener("progress",y),_.upload.addEventListener("loadend",B)),(a.cancelToken||a.signal)&&(m=w=>{_&&(o(!w||w.type?new je(null,n,_):w),_.abort(),_=null)},a.cancelToken&&a.cancelToken.subscribe(m),a.signal&&(a.signal.aborted?m():a.signal.addEventListener("abort",m)));const T=ol(a.url);if(T&&ve.protocols.indexOf(T)===-1){o(new Z("Unsupported protocol "+T+":",Z.ERR_BAD_REQUEST,n));return}_.send(l||null)})},pl=(n,e)=>{const{length:t}=n=n?n.filter(Boolean):[];if(e||t){let o=new AbortController,a;const l=function(d){if(!a){a=!0,u();const m=d instanceof Error?d:this.reason;o.abort(m instanceof Z?m:new je(m instanceof Error?m.message:m))}};let i=e&&setTimeout(()=>{i=null,l(new Z(`timeout ${e} of ms exceeded`,Z.ETIMEDOUT))},e);const u=()=>{n&&(i&&clearTimeout(i),i=null,n.forEach(d=>{d.unsubscribe?d.unsubscribe(l):d.removeEventListener("abort",l)}),n=null)};n.forEach(d=>d.addEventListener("abort",l));const{signal:f}=o;return f.unsubscribe=()=>I.asap(u),f}},hl=function*(n,e){let t=n.byteLength;if(t<e){yield n;return}let o=0,a;for(;o<t;)a=o+e,yield n.slice(o,a),o=a},ml=async function*(n,e){for await(const t of fl(n))yield*hl(t,e)},fl=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:t,value:o}=await e.read();if(t)break;yield o}}finally{await e.cancel()}},zt=(n,e,t,o)=>{const a=ml(n,e);let l=0,i,u=f=>{i||(i=!0,o&&o(f))};return new ReadableStream({async pull(f){try{const{done:d,value:m}=await a.next();if(d){u(),f.close();return}let y=m.byteLength;if(t){let F=l+=y;t(F)}f.enqueue(new Uint8Array(m))}catch(d){throw u(d),d}},cancel(f){return u(f),a.return()}},{highWaterMark:2})},gt=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Ps=gt&&typeof ReadableStream=="function",vl=gt&&(typeof TextEncoder=="function"?(n=>e=>n.encode(e))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),Cs=(n,...e)=>{try{return!!n(...e)}catch{return!1}},gl=Ps&&Cs(()=>{let n=!1;const e=new Request(ve.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e}),Jt=64*1024,Ct=Ps&&Cs(()=>I.isReadableStream(new Response("").body)),ut={stream:Ct&&(n=>n.body)};gt&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!ut[e]&&(ut[e]=I.isFunction(n[e])?t=>t[e]():(t,o)=>{throw new Z(`Response type '${e}' is not supported`,Z.ERR_NOT_SUPPORT,o)})})})(new Response);const bl=async n=>{if(n==null)return 0;if(I.isBlob(n))return n.size;if(I.isSpecCompliantForm(n))return(await new Request(ve.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(I.isArrayBufferView(n)||I.isArrayBuffer(n))return n.byteLength;if(I.isURLSearchParams(n)&&(n=n+""),I.isString(n))return(await vl(n)).byteLength},yl=async(n,e)=>{const t=I.toFiniteNumber(n.getContentLength());return t??bl(e)},_l=gt&&(async n=>{let{url:e,method:t,data:o,signal:a,cancelToken:l,timeout:i,onDownloadProgress:u,onUploadProgress:f,responseType:d,headers:m,withCredentials:y="same-origin",fetchOptions:F}=Ts(n);d=d?(d+"").toLowerCase():"text";let B=pl([a,l&&l.toAbortSignal()],i),$;const S=B&&B.unsubscribe&&(()=>{B.unsubscribe()});let _;try{if(f&&gl&&t!=="get"&&t!=="head"&&(_=await yl(m,o))!==0){let v=new Request(e,{method:"POST",body:o,duplex:"half"}),P;if(I.isFormData(o)&&(P=v.headers.get("content-type"))&&m.setContentType(P),v.body){const[M,W]=Ht(_,dt(Gt(f)));o=zt(v.body,Jt,M,W)}}I.isString(y)||(y=y?"include":"omit");const h="credentials"in Request.prototype;$=new Request(e,{...F,signal:B,method:t.toUpperCase(),headers:m.normalize().toJSON(),body:o,duplex:"half",credentials:h?y:void 0});let T=await fetch($);const w=Ct&&(d==="stream"||d==="response");if(Ct&&(u||w&&S)){const v={};["status","statusText","headers"].forEach(E=>{v[E]=T[E]});const P=I.toFiniteNumber(T.headers.get("content-length")),[M,W]=u&&Ht(P,dt(Gt(u),!0))||[];T=new Response(zt(T.body,Jt,M,()=>{W&&W(),S&&S()}),v)}d=d||"text";let R=await ut[I.findKey(ut,d)||"text"](T,n);return!w&&S&&S(),await new Promise((v,P)=>{ws(v,P,{data:R,headers:_e.from(T.headers),status:T.status,statusText:T.statusText,config:n,request:$})})}catch(h){throw S&&S(),h&&h.name==="TypeError"&&/Load failed|fetch/i.test(h.message)?Object.assign(new Z("Network Error",Z.ERR_NETWORK,n,$),{cause:h.cause||h}):Z.from(h,h&&h.code,n,$)}}),Et={http:Ma,xhr:ul,fetch:_l};I.forEach(Et,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const Kt=n=>`- ${n}`,$l=n=>I.isFunction(n)||n===null||n===!1,Es={getAdapter:n=>{n=I.isArray(n)?n:[n];const{length:e}=n;let t,o;const a={};for(let l=0;l<e;l++){t=n[l];let i;if(o=t,!$l(t)&&(o=Et[(i=String(t)).toLowerCase()],o===void 0))throw new Z(`Unknown adapter '${i}'`);if(o)break;a[i||"#"+l]=o}if(!o){const l=Object.entries(a).map(([u,f])=>`adapter ${u} `+(f===!1?"is not supported by the environment":"is not available in the build"));let i=e?l.length>1?`since :
`+l.map(Kt).join(`
`):" "+Kt(l[0]):"as no adapter specified";throw new Z("There is no suitable adapter to dispatch the request "+i,"ERR_NOT_SUPPORT")}return o},adapters:Et};function St(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new je(null,n)}function Xt(n){return St(n),n.headers=_e.from(n.headers),n.data=$t.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),Es.getAdapter(n.adapter||at.adapter)(n).then(function(o){return St(n),o.data=$t.call(n,n.transformResponse,o),o.headers=_e.from(o.headers),o},function(o){return Ss(o)||(St(n),o&&o.response&&(o.response.data=$t.call(n,n.transformResponse,o.response),o.response.headers=_e.from(o.response.headers))),Promise.reject(o)})}const Rs="1.9.0",bt={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{bt[n]=function(o){return typeof o===n||"a"+(e<1?"n ":" ")+n}});const Qt={};bt.transitional=function(e,t,o){function a(l,i){return"[Axios v"+Rs+"] Transitional option '"+l+"'"+i+(o?". "+o:"")}return(l,i,u)=>{if(e===!1)throw new Z(a(i," has been removed"+(t?" in "+t:"")),Z.ERR_DEPRECATED);return t&&!Qt[i]&&(Qt[i]=!0,console.warn(a(i," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(l,i,u):!0}};bt.spelling=function(e){return(t,o)=>(console.warn(`${o} is likely a misspelling of ${e}`),!0)};function Sl(n,e,t){if(typeof n!="object")throw new Z("options must be an object",Z.ERR_BAD_OPTION_VALUE);const o=Object.keys(n);let a=o.length;for(;a-- >0;){const l=o[a],i=e[l];if(i){const u=n[l],f=u===void 0||i(u,l,n);if(f!==!0)throw new Z("option "+l+" must be "+f,Z.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Z("Unknown option "+l,Z.ERR_BAD_OPTION)}}const it={assertOptions:Sl,validators:bt},Ce=it.validators;let Ne=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Vt,response:new Vt}}async request(e,t){try{return await this._request(e,t)}catch(o){if(o instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const l=a.stack?a.stack.replace(/^.+\n/,""):"";try{o.stack?l&&!String(o.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(o.stack+=`
`+l):o.stack=l}catch{}}throw o}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Le(this.defaults,t);const{transitional:o,paramsSerializer:a,headers:l}=t;o!==void 0&&it.assertOptions(o,{silentJSONParsing:Ce.transitional(Ce.boolean),forcedJSONParsing:Ce.transitional(Ce.boolean),clarifyTimeoutError:Ce.transitional(Ce.boolean)},!1),a!=null&&(I.isFunction(a)?t.paramsSerializer={serialize:a}:it.assertOptions(a,{encode:Ce.function,serialize:Ce.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),it.assertOptions(t,{baseUrl:Ce.spelling("baseURL"),withXsrfToken:Ce.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let i=l&&I.merge(l.common,l[t.method]);l&&I.forEach(["delete","get","head","post","put","patch","common"],$=>{delete l[$]}),t.headers=_e.concat(i,l);const u=[];let f=!0;this.interceptors.request.forEach(function(S){typeof S.runWhen=="function"&&S.runWhen(t)===!1||(f=f&&S.synchronous,u.unshift(S.fulfilled,S.rejected))});const d=[];this.interceptors.response.forEach(function(S){d.push(S.fulfilled,S.rejected)});let m,y=0,F;if(!f){const $=[Xt.bind(this),void 0];for($.unshift.apply($,u),$.push.apply($,d),F=$.length,m=Promise.resolve(t);y<F;)m=m.then($[y++],$[y++]);return m}F=u.length;let B=t;for(y=0;y<F;){const $=u[y++],S=u[y++];try{B=$(B)}catch(_){S.call(this,_);break}}try{m=Xt.call(this,B)}catch($){return Promise.reject($)}for(y=0,F=d.length;y<F;)m=m.then(d[y++],d[y++]);return m}getUri(e){e=Le(this.defaults,e);const t=ks(e.baseURL,e.url,e.allowAbsoluteUrls);return ys(t,e.params,e.paramsSerializer)}};I.forEach(["delete","get","head","options"],function(e){Ne.prototype[e]=function(t,o){return this.request(Le(o||{},{method:e,url:t,data:(o||{}).data}))}});I.forEach(["post","put","patch"],function(e){function t(o){return function(l,i,u){return this.request(Le(u||{},{method:e,headers:o?{"Content-Type":"multipart/form-data"}:{},url:l,data:i}))}}Ne.prototype[e]=t(),Ne.prototype[e+"Form"]=t(!0)});let wl=class Is{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(l){t=l});const o=this;this.promise.then(a=>{if(!o._listeners)return;let l=o._listeners.length;for(;l-- >0;)o._listeners[l](a);o._listeners=null}),this.promise.then=a=>{let l;const i=new Promise(u=>{o.subscribe(u),l=u}).then(a);return i.cancel=function(){o.unsubscribe(l)},i},e(function(l,i,u){o.reason||(o.reason=new je(l,i,u),t(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=o=>{e.abort(o)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new Is(function(a){e=a}),cancel:e}}};function kl(n){return function(t){return n.apply(null,t)}}function Tl(n){return I.isObject(n)&&n.isAxiosError===!0}const Rt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Rt).forEach(([n,e])=>{Rt[e]=n});function As(n){const e=new Ne(n),t=rs(Ne.prototype.request,e);return I.extend(t,Ne.prototype,e,{allOwnKeys:!0}),I.extend(t,e,null,{allOwnKeys:!0}),t.create=function(a){return As(Le(n,a))},t}const he=As(at);he.Axios=Ne;he.CanceledError=je;he.CancelToken=wl;he.isCancel=Ss;he.VERSION=Rs;he.toFormData=vt;he.AxiosError=Z;he.Cancel=he.CanceledError;he.all=function(e){return Promise.all(e)};he.spread=kl;he.isAxiosError=Tl;he.mergeConfig=Le;he.AxiosHeaders=_e;he.formToJSON=n=>$s(I.isHTMLForm(n)?new FormData(n):n);he.getAdapter=Es.getAdapter;he.HttpStatusCode=Rt;he.default=he;const{Axios:rg,AxiosError:ig,CanceledError:cg,isCancel:dg,CancelToken:ug,VERSION:pg,all:hg,Cancel:mg,isAxiosError:fg,spread:vg,toFormData:gg,AxiosHeaders:bg,HttpStatusCode:yg,formToJSON:_g,getAdapter:$g,mergeConfig:Sg}=he;class Pl{static async getAvailableModels(){try{return(await he({url:"/api/models/available-models",method:"GET",baseURL:""})).data}catch(e){return console.error("Failed to fetch available models:",e),{options:[],total:0}}}}const Cl={class:"config-section"},El={class:"section-header"},Rl={key:0,class:"error-section"},Il={class:"error-message"},Al={class:"error-content"},xl={class:"error-title"},Dl={class:"error-description"},Fl={key:1,class:"visual-editor"},Ml={class:"plan-basic-info"},Ul={class:"form-row"},Nl={class:"form-label"},Ll=["placeholder"],Bl={key:0,class:"field-error-message"},Ol={class:"form-row"},ql={class:"form-label"},Vl=["value","placeholder"],jl={class:"steps-section"},Hl={class:"steps-header"},Gl={class:"form-label"},Wl={class:"steps-actions"},zl=["title"],Jl={class:"steps-container"},Kl={class:"step-header"},Xl={class:"step-number"},Ql={class:"step-actions"},Yl=["onClick","disabled","title"],Zl=["onClick","disabled","title"],er=["onClick","title"],tr={class:"step-content"},sr={class:"form-row"},or={class:"form-label"},nr=["onUpdate:modelValue","placeholder"],ar={class:"form-row"},lr={class:"form-label"},rr=["onUpdate:modelValue","placeholder"],ir={class:"form-row"},cr={class:"form-label"},dr={class:"model-selector"},ur=["onUpdate:modelValue","disabled"],pr={key:0,disabled:"",value:""},hr={key:1,disabled:"",value:""},mr={value:"",disabled:""},fr={value:""},vr=["value","title"],gr=["title"],br={key:0,class:"error-message"},yr={class:"form-row"},_r={key:0,class:"empty-steps"},$r={key:0,class:"json-preview"},Sr={class:"preview-header"},wr={class:"form-label"},kr={class:"json-code"},Tr={class:"editor-footer"},Pr={class:"section-actions"},Cr=["disabled","title"],Er=["disabled","title"],Rr=["disabled"],Ir=ce({__name:"JsonEditorV2",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},hiddenFields:{default:()=>[]},currentPlanTemplateId:{default:""}},emits:["rollback","restore","save","update:jsonContent"],setup(n,{emit:e}){const t=n,o=e,{showJsonPreview:a,displayData:l,formattedJsonOutput:i,addStep:u,removeStep:f,moveStepUp:d,moveStepDown:m,handleRollback:y,handleRestore:F,handleSave:B,toggleJsonPreview:$,closeJsonPreview:S}=ls(t,o),_=U(null),h=U(""),T=U([]),w=U(!1),R=U(""),v=U(!1),P=U(-1),M=async()=>{if(!w.value){w.value=!0,R.value="";try{const b=await Pl.getAvailableModels();b&&b.options?T.value=b.options:T.value=[]}catch(b){console.error("Failed to load models:",b),R.value=b instanceof Error?b.message:"Failed to load models",T.value=[]}finally{w.value=!1}}},W=b=>{P.value=b,v.value=!0,console.log("[JsonEditorV2] Available tools from store:",z.availableTools)},E=b=>{P.value>=0&&P.value<l.steps.length&&(l.steps[P.value].selectedToolKeys=[...b]),v.value=!1,P.value=-1},A=(b,D)=>{b>=0&&b<l.steps.length&&(l.steps[b].selectedToolKeys=[...D])},x=()=>{try{_.value=null,l.title||(l.title=""),l.steps||(l.steps=[]),l.directResponse=!1}catch(b){const D=`Failed to initialize JsonEditorV2: ${b instanceof Error?b.message:"Unknown error"}`;_.value=D,console.error(D,b)}};ie(()=>l,b=>{try{b.title.trim()?h.value="":h.value="Title is required field",_.value=null}catch(D){_.value=`Invalid data structure: ${D instanceof Error?D.message:"Unknown error"}`,h.value=""}},{immediate:!0,deep:!0}),Se(()=>{x(),M()});const q=b=>{const D=b.target;if(!D)return;D.style.height="auto";const J=20,X=Math.ceil(D.scrollHeight/J),L=4,N=12,Q=Math.max(L,Math.min(N,X)),O=Q*J;D.style.height=`${O}px`,D.rows=Q,X>N?D.style.overflowY="auto":D.style.overflowY="hidden"};return(b,D)=>{var J;return p(),g("div",Cl,[s("div",El,[k(r(C),{icon:"carbon:code",width:"16"}),s("span",null,c(b.$t("sidebar.dynamicAgentPlan")),1)]),_.value?(p(),g("div",Rl,[s("div",Il,[k(r(C),{icon:"carbon:warning",width:"16"}),s("div",Al,[s("div",xl,c(b.$t("sidebar.planTypeError")),1),s("div",Dl,c(_.value),1)])])])):(p(),g("div",Fl,[s("div",Ml,[s("div",Ul,[s("label",Nl,c(b.$t("sidebar.title")),1),te(s("input",{"onUpdate:modelValue":D[0]||(D[0]=X=>r(l).title=X),type:"text",class:se(["form-input",{error:h.value}]),placeholder:b.$t("sidebar.titlePlaceholder")},null,10,Ll),[[re,r(l).title]]),h.value?(p(),g("div",Bl,[k(r(C),{icon:"carbon:warning",width:"12"}),ee(" "+c(h.value),1)])):V("",!0)]),s("div",Ol,[s("label",ql,c(b.$t("sidebar.planTemplateId")),1),s("input",{value:b.currentPlanTemplateId,type:"text",class:"form-input readonly-input",readonly:"",placeholder:b.$t("sidebar.planTemplateIdPlaceholder")},null,8,Vl)])]),s("div",jl,[s("div",Hl,[s("label",Gl,c(b.$t("sidebar.tasks")),1),s("div",Wl,[s("button",{onClick:D[1]||(D[1]=(...X)=>r(u)&&r(u)(...X)),class:"btn btn-xs",title:b.$t("sidebar.addStep")},[k(r(C),{icon:"carbon:add",width:"12"})],8,zl)])]),s("div",Jl,[(p(!0),g(oe,null,ae(r(l).steps,(X,L)=>(p(),g("div",{key:L,class:"step-item"},[s("div",Kl,[s("span",Xl,c(b.$t("sidebar.subtask"))+" "+c(L+1),1),s("div",Ql,[s("button",{onClick:N=>r(d)(L),disabled:L===0,class:"btn btn-xs",title:b.$t("sidebar.moveUp")},[k(r(C),{icon:"carbon:chevron-up",width:"12"})],8,Yl),s("button",{onClick:N=>r(m)(L),disabled:L===r(l).steps.length-1,class:"btn btn-xs",title:b.$t("sidebar.moveDown")},[k(r(C),{icon:"carbon:chevron-down",width:"12"})],8,Zl),s("button",{onClick:N=>r(f)(L),class:"btn btn-xs btn-danger",title:b.$t("sidebar.removeStep")},[k(r(C),{icon:"carbon:trash-can",width:"12"})],8,er)])]),s("div",tr,[s("div",sr,[s("label",or,c(b.$t("sidebar.stepRequirement")),1),te(s("textarea",{"onUpdate:modelValue":N=>X.stepRequirement=N,class:"form-textarea auto-resize",placeholder:b.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:D[2]||(D[2]=N=>q(N))},null,40,nr),[[re,X.stepRequirement]])]),s("div",ar,[s("label",lr,c(b.$t("sidebar.terminateColumns")),1),te(s("textarea",{"onUpdate:modelValue":N=>X.terminateColumns=N,class:"form-textarea auto-resize",placeholder:b.$t("sidebar.terminateColumnsPlaceholder"),rows:"4",onInput:D[3]||(D[3]=N=>q(N))},null,40,rr),[[re,X.terminateColumns]])]),s("div",ir,[s("label",cr,c(b.$t("sidebar.modelName")),1),s("div",dr,[te(s("select",{"onUpdate:modelValue":N=>X.modelName=N,class:"form-select model-select",disabled:w.value},[w.value?(p(),g("option",pr,c(b.$t("sidebar.loading")),1)):R.value?(p(),g("option",hr,c(b.$t("sidebar.modelLoadError")),1)):V("",!0),s("option",mr,c(b.$t("sidebar.modelNameDescription")),1),s("option",fr,c(b.$t("sidebar.noModelSelected")),1),(p(!0),g(oe,null,ae(T.value,N=>(p(),g("option",{key:N.value,value:N.value,title:N.label},c(N.label),9,vr))),128))],8,ur),[[ot,X.modelName]]),R.value?(p(),g("button",{key:0,onClick:M,class:"btn btn-sm btn-danger",title:b.$t("sidebar.retryLoadModels")},[k(r(C),{icon:"carbon:warning",width:"14"}),ee(" "+c(b.$t("sidebar.retry")),1)],8,gr)):V("",!0)]),R.value?(p(),g("div",br,[k(r(C),{icon:"carbon:warning",width:"12"}),ee(" "+c(R.value),1)])):V("",!0)]),s("div",yr,[k(Kn,{title:b.$t("sidebar.selectedTools"),"selected-tool-ids":X.selectedToolKeys,"available-tools":r(z).availableTools,"add-button-text":b.$t("sidebar.addRemoveTools"),"empty-text":b.$t("sidebar.noTools"),"use-grid-layout":!0,onAddTools:N=>W(L),onToolsFiltered:N=>A(L,N)},null,8,["title","selected-tool-ids","available-tools","add-button-text","empty-text","onAddTools","onToolsFiltered"])])])]))),128)),r(l).steps.length===0?(p(),g("div",_r,[k(r(C),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),s("p",null,c(b.$t("sidebar.noSteps")),1),s("button",{onClick:D[4]||(D[4]=(...X)=>r(u)&&r(u)(...X)),class:"btn btn-primary"},[k(r(C),{icon:"carbon:add",width:"14"}),ee(" "+c(b.$t("sidebar.addFirstStep")),1)])])):V("",!0)])]),r(a)?(p(),g("div",$r,[s("div",Sr,[s("label",wr,c(b.$t("sidebar.jsonPreview")),1),s("button",{onClick:D[5]||(D[5]=(...X)=>r(S)&&r(S)(...X)),class:"btn btn-xs"},[k(r(C),{icon:"carbon:close",width:"12"})])]),s("pre",kr,c(r(i)),1)])):V("",!0),s("div",Tr,[s("button",{onClick:D[6]||(D[6]=(...X)=>r($)&&r($)(...X)),class:"btn btn-sm btn-secondary"},[k(r(C),{icon:"carbon:code",width:"14"}),ee(" "+c(r(a)?b.$t("sidebar.hideJson"):b.$t("sidebar.showJson")),1)]),s("div",Pr,[s("button",{class:"btn btn-sm",onClick:D[7]||(D[7]=(...X)=>r(y)&&r(y)(...X)),disabled:!(b.canRollback??!1),title:b.$t("sidebar.rollback")},[k(r(C),{icon:"carbon:undo",width:"14"})],8,Cr),s("button",{class:"btn btn-sm",onClick:D[8]||(D[8]=(...X)=>r(F)&&r(F)(...X)),disabled:!(b.canRestore??!1),title:b.$t("sidebar.restore")},[k(r(C),{icon:"carbon:redo",width:"14"})],8,Er),s("button",{class:"btn btn-primary",onClick:D[9]||(D[9]=(...X)=>r(B)&&r(B)(...X)),disabled:b.isGenerating||b.isExecuting},[k(r(C),{icon:"carbon:save",width:"14"}),D[11]||(D[11]=ee(" Save "))],8,Rr)])])])),k(qn,{modelValue:v.value,"onUpdate:modelValue":D[10]||(D[10]=X=>v.value=X),tools:r(z).availableTools,"selected-tool-ids":P.value>=0?((J=r(l).steps[P.value])==null?void 0:J.selectedToolKeys)||[]:[],onConfirm:E},null,8,["modelValue","tools","selected-tool-ids"])])}}}),Ar=de(Ir,[["__scopeId","data-v-fe6ad815"]]);class Yt{static async uploadFiles(e){try{console.log("[FileUploadApiService] Uploading files:",e.length);const t=new FormData;e.forEach(l=>{t.append("files",l)});const o=await fetch("/api/file-upload/upload",{method:"POST",body:t});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const a=await o.json();return console.log("[FileUploadApiService] Files uploaded successfully:",a.successfulFiles,"uploadKey:",a.uploadKey),a}catch(t){throw console.error("[FileUploadApiService] Error uploading files:",t),t}}static async getUploadedFiles(e){try{console.log("[FileUploadApiService] Getting uploaded files for uploadKey:",e);const t=await fetch(`/api/file-upload/files/${encodeURIComponent(e)}`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const o=await t.json();return console.log("[FileUploadApiService] Got uploaded files:",o.totalCount,"for uploadKey:",e),o}catch(t){throw console.error("[FileUploadApiService] Error getting uploaded files:",t),t}}static async deleteFile(e,t){try{console.log("[FileUploadApiService] Deleting file:",t,"from uploadKey:",e);const o=await fetch(`/api/file-upload/files/${encodeURIComponent(e)}/${encodeURIComponent(t)}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const a=await o.json();return console.log("[FileUploadApiService] File deleted successfully:",a.success),a}catch(o){throw console.error("[FileUploadApiService] Error deleting file:",o),o}}static async getUploadConfig(){try{console.log("[FileUploadApiService] Getting upload configuration");const e=await fetch("/api/file-upload/config");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();return console.log("[FileUploadApiService] Got upload configuration:",t),t}catch(e){throw console.error("[FileUploadApiService] Error getting upload configuration:",e),e}}}const xr={class:"file-upload-component"},Dr=["accept"],Fr={key:0},Mr={key:1},Ur={key:0,class:"files-list"},Nr={class:"file-name"},Lr={class:"file-size"},Br=["onClick","title"],Or={key:0,class:"upload-progress"},qr=ce({__name:"FileUploadComponent",props:{acceptedFileTypes:{default:".pdf,.txt,.md,.doc,.docx,.csv,.xlsx,.xls,.json,.xml,.html,.htm,.log,.java,.py,.js,.ts,.sql,.sh,.bat,.yaml,.yml,.properties,.conf,.ini,.jpg,.jpeg,.png,.gif"},disabled:{type:Boolean,default:!1}},emits:["files-uploaded","files-removed","upload-key-changed","upload-started","upload-completed","upload-error"],setup(n,{expose:e,emit:t}){const{t:o}=we(),a=n,l=t,i=U(),u=U([]),f=U(!1),d=U(null),m=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),u.value=[],d.value=null,l("upload-key-changed",null)};$e(()=>{m()}),ie(()=>u.value,_=>{l("files-removed",_)},{deep:!0});const y=()=>{a.disabled||i.value&&i.value.click()},F=async _=>{const h=_.target,T=h.files;if(!T||T.length===0)return;const w=Array.from(T);console.log("[FileUpload] Selected files for upload:",w.map(R=>R.name)),await B(w),h&&(h.value="")},B=async _=>{if(_.length!==0){f.value=!0,l("upload-started");try{const h=await Yt.uploadFiles(_);h.success&&h.uploadedFiles&&(!d.value&&h.uploadKey?(d.value=h.uploadKey,console.log("[FileUpload] Set uploadKey:",d.value),u.value=h.uploadedFiles):d.value?(console.log("[FileUpload] Using existing uploadKey:",d.value),u.value=[...u.value,...h.uploadedFiles]):(console.warn("[FileUpload] No uploadKey returned from upload"),u.value=h.uploadedFiles),h.uploadKey&&(d.value=h.uploadKey,console.log("[Input] Saved uploadKey locally:",h.uploadKey),l("upload-key-changed",d.value)),console.log("[Input] Updated global uploadedFiles state:",u.value),l("files-uploaded",u.value,d.value)),console.log("Files uploaded successfully:",h),l("upload-completed")}catch(h){console.error("File upload error:",h),l("upload-error",h)}finally{f.value=!1}}},$=async _=>{try{if(console.log(" Removing file:",_.originalName,"from uploadKey:",d),d.value){const h=await Yt.deleteFile(d.value,_.originalName);h.success?console.log(" File deleted from server successfully"):console.error(" Failed to delete file from server:",h.error)}u.value=u.value.filter(h=>h.originalName!==_.originalName),u.value.length===0&&(console.log("[FileUpload]  Clearing uploadKey to force new plan for new files"),d.value=null,l("upload-key-changed",null)),console.log(" File removal completed, remaining files:",u.value.length)}catch(h){console.error(" Error removing file:",h),l("upload-error",h)}},S=_=>{if(_===0)return"0 Bytes";const h=1024,T=["Bytes","KB","MB","GB"],w=Math.floor(Math.log(_)/Math.log(h));return parseFloat((_/Math.pow(h,w)).toFixed(2))+" "+T[w]};return e({uploadedFiles:u,uploadKey:d,resetSession:m,uploadFiles:B,removeFile:$,isUploading:f}),(_,h)=>(p(),g("div",xr,[s("input",{ref_key:"fileInputRef",ref:i,type:"file",multiple:"",style:{display:"none"},onChange:F,accept:_.acceptedFileTypes||""},null,40,Dr),s("div",{class:se(["uploaded-files",{"has-files":u.value.length>0}])},[s("div",{class:"files-header",onClick:y},[k(r(C),{icon:"carbon:attachment"}),u.value.length===0?(p(),g("span",Fr,c(r(o)("input.attachFile")),1)):(p(),g("span",Mr,c(r(o)("input.attachedFiles"))+" ("+c(u.value.length)+")",1))]),u.value.length>0?(p(),g("div",Ur,[(p(!0),g(oe,null,ae(u.value,T=>(p(),g("div",{key:T.originalName,class:"file-item"},[k(r(C),{icon:"carbon:document",class:"file-icon"}),s("span",Nr,c(T.originalName),1),s("span",Lr,"("+c(S(T.size))+")",1),s("button",{onClick:w=>$(T),class:"remove-btn",title:r(o)("input.removeFile")},[k(r(C),{icon:"carbon:close"})],8,Br)]))),128))])):V("",!0)],2),f.value?(p(),g("div",Or,[k(r(C),{icon:"carbon:rotate--clockwise",class:"loading-icon"}),s("span",null,c(r(o)("input.uploading")),1)])):V("",!0)]))}}),xs=de(qr,[["__scopeId","data-v-608b06f9"]]),Vr={class:"config-section"},jr={class:"section-header"},Hr={class:"execution-content"},Gr={class:"params-requirements-group"},Wr={class:"params-help-text"},zr={key:0,class:"parameter-fields"},Jr={class:"parameter-label"},Kr=["onUpdate:modelValue","placeholder","onInput"],Xr={key:0,class:"parameter-error"},Qr={key:1,class:"validation-message"},Yr=["disabled"],Zr=["disabled"],ei={key:1,class:"call-example-wrapper"},ti={class:"call-example-header"},si={class:"call-example-title"},oi={class:"call-example-description"},ni={class:"internal-call-wrapper"},ai={class:"call-info"},li={class:"call-method"},ri={class:"call-endpoint"},ii={key:0,class:"call-endpoint"},ci={class:"call-description"},di={class:"call-example"},ui={class:"example-code"},pi={key:2,class:"call-example-wrapper"},hi={class:"call-example-header"},mi={class:"call-example-title"},fi={class:"call-example-description"},vi={class:"http-api-urls-wrapper"},gi={class:"tab-container"},bi={class:"tab-header"},yi=["onClick"],_i={class:"tab-content"},$i={class:"http-api-url-display"},Si={class:"api-method"},wi={class:"api-endpoint"},ki={class:"api-description"},Ti={key:0,class:"api-example"},Pi={class:"example-code"},Ci={key:3,class:"call-example-wrapper"},Ei={class:"call-example-header"},Ri={class:"call-example-title"},Ii={class:"call-example-description"},Ai={class:"mcp-call-wrapper"},xi={class:"call-info"},Di={class:"call-method"},Fi={class:"call-endpoint"},Mi={class:"call-description"},Ui={class:"call-example"},Ni={class:"example-code"},Li=ce({__name:"ExecutionController",props:{currentPlanTemplateId:{default:""},isExecuting:{type:Boolean,default:!1},isGenerating:{type:Boolean,default:!1},showPublishButton:{type:Boolean,default:!0},toolInfo:{default:()=>({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""})}},emits:["executePlan","publishMcpService","clearParams","updateExecutionParams"],setup(n,{expose:e,emit:t}){const{t:o}=we(),a=n,l=t,i=U(""),u=U({parameters:[],hasParameters:!1,requirements:""}),f=U({}),d=U(!1),m=U("get-sync"),y=U({}),F=U(!1),B=U(!1),$=U(),S=U([]),_=U(null),h=U([{id:"get-sync",label:"GET + Sync",method:"GET",endpoint:"/api/executor/executeByToolNameSync/{toolName}",description:"Synchronous GET request - returns execution result immediately",example:`GET /api/executor/executeByToolNameSync/my-tool?allParams={"rawParam":"test"}
Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-sync",label:"POST + Sync",method:"POST",endpoint:"/api/executor/executeByToolNameSync",description:"Synchronous POST request - returns execution result immediately",example:`POST /api/executor/executeByToolNameSync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-async",label:"POST + Async",method:"POST",endpoint:"/api/executor/executeByToolNameAsync",description:"Asynchronous POST request - returns task ID, check status separately",example:`POST /api/executor/executeByToolNameAsync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "planId": "plan-123",
  "status": "processing",
  "message": "Task submitted, processing",
  "memoryId": "ABC12345",
  "toolName": "my-tool",
  "planTemplateId": "template-456"
}

# Check execution status and get detailed results:
GET /api/executor/details/{planId}
Response: {
  "currentPlanId": "plan-123",
  "title": "Plan Title",
  "status": "completed",
  "summary": "Execution completed successfully",
  "agentExecutionSequence": [...],
  "userInputWaitState": null
}`}]),T=le(()=>a.toolInfo.enableInternalToolcall||a.toolInfo.enableHttpService||a.toolInfo.enableMcpService),w=le(()=>T.value?o("sidebar.updateServiceStatus"):o("sidebar.publishMcpService")),R=le(()=>a.isExecuting||a.isGenerating?!1:u.value.hasParameters?u.value.parameters.every(N=>f.value[N].trim()):!0),v=(N,Q)=>{S.value=N.map(O=>O.originalName),_.value=Q,console.log("[ExecutionController] Files uploaded:",N.length,"uploadKey:",Q)},P=N=>{S.value=N.map(Q=>Q.originalName),console.log("[ExecutionController] Files removed, remaining:",N.length)},M=N=>{_.value=N,console.log("[ExecutionController] Upload key changed:",N)},W=()=>{console.log("[ExecutionController] Upload started")},E=()=>{console.log("[ExecutionController] Upload completed")},A=N=>{console.error("[ExecutionController] Upload error:",N)},x=()=>{if(console.log("[ExecutionController]  Execute button clicked"),B.value=!0,console.log("[ExecutionController]  Set isExecutingPlan to true"),!X()){console.log("[ExecutionController]  Parameter validation failed:",y.value),B.value=!1;return}const N=u.value.hasParameters&&Object.keys(f.value).length>0?f.value:void 0;console.log("[ExecutionController]  Replacement params:",N);const Q={title:"",planData:{title:"",steps:[],directResponse:!1},params:void 0,replacementParams:N,uploadedFiles:S.value,uploadKey:_.value};console.log("[ExecutionController]  Emitting executePlan with payload:",JSON.stringify(Q,null,2)),l("executePlan",Q)},q=()=>{l("publishMcpService")},b=()=>{console.log("[ExecutionController]  clearExecutionParams called"),i.value="",f.value={},B.value=!1,console.log("[ExecutionController]  Reset isExecutingPlan to false"),console.log("[ExecutionController]  After clear - parameterValues cleared"),l("clearParams")},D=async()=>{if(console.log("[ExecutionController]  loadParameterRequirements called for templateId:",a.currentPlanTemplateId),console.log("[ExecutionController]  Current parameterRequirements before load:",JSON.stringify(u.value,null,2)),!a.currentPlanTemplateId){console.log("[ExecutionController]  No template ID, resetting parameters"),u.value={parameters:[],hasParameters:!1,requirements:""},f.value={};return}d.value=!0;try{console.log("[ExecutionController]  Fetching parameter requirements from API...");const N=await xt.getParameterRequirements(a.currentPlanTemplateId);console.log("[ExecutionController]  Received requirements from API:",JSON.stringify(N,null,2)),u.value=N;const Q={};N.parameters.forEach(O=>{Q[O]=f.value[O]||""}),f.value=Q,console.log("[ExecutionController]  Updated parameterRequirements:",JSON.stringify(u.value,null,2)),console.log("[ExecutionController]  Updated parameterValues:",JSON.stringify(f.value,null,2)),L()}catch(N){console.error("[ExecutionController]  Failed to load parameter requirements:",N),N instanceof Error&&!N.message.includes("404")&&console.warn("[ExecutionController]  Parameter requirements not available yet, will retry later"),u.value={parameters:[],hasParameters:!1,requirements:""},console.log("[ExecutionController]  Reset parameterRequirements due to error:",JSON.stringify(u.value,null,2))}finally{d.value=!1,console.log("[ExecutionController]  loadParameterRequirements completed")}},J=(N,Q)=>{f.value[N]=Q,y.value[N]&&delete y.value[N],L()},X=()=>{if(y.value={},F.value=!1,!u.value.hasParameters)return!0;let N=!1;return u.value.parameters.forEach(Q=>{f.value[Q].trim()||(y.value[Q]=`${Q} is required`,N=!0)}),F.value=N,!N},L=()=>{u.value.hasParameters?i.value=JSON.stringify(f.value,null,2):i.value="",l("updateExecutionParams",i.value)};return ie(()=>a.currentPlanTemplateId,(N,Q)=>{if(N&&N!==Q){if(B.value){console.log("[ExecutionController]  Skipping parameter reload - plan is executing");return}console.log("[ExecutionController]  Template ID changed, will reload parameters"),Q&&N.startsWith("planTemplate-")?(console.log("[ExecutionController]  New template detected, retrying with delay..."),setTimeout(()=>{console.log("[ExecutionController]  Delay timeout, calling loadParameterRequirements"),D()},1e3)):(console.log("[ExecutionController]  Immediate reload of parameters"),D())}}),ie(()=>i.value,N=>{l("updateExecutionParams",N)}),Se(()=>{D()}),e({executionParams:i,clearExecutionParams:b,loadParameterRequirements:D,fileUploadRef:$,uploadedFiles:S,uploadKey:_}),(N,Q)=>{var O,G,Y,j,H;return p(),g("div",Vr,[s("div",jr,[k(r(C),{icon:"carbon:play",width:"16"}),s("span",null,c(r(o)("sidebar.executionController")),1)]),s("div",Hr,[s("div",Gr,[s("label",null,c(r(o)("sidebar.parameterRequirements")),1),s("div",Wr,c(r(o)("sidebar.parameterRequirementsHelp")),1),u.value.hasParameters?(p(),g("div",zr,[(p(!0),g(oe,null,ae(u.value.parameters,K=>(p(),g("div",{key:K,class:"parameter-field"},[s("label",Jr,[ee(c(K)+" ",1),Q[0]||(Q[0]=s("span",{class:"required"},"*",-1))]),te(s("input",{"onUpdate:modelValue":ue=>f.value[K]=ue,class:se(["parameter-input",{error:y.value[K]}]),placeholder:r(o)("sidebar.enterValueFor",{param:K}),onInput:ue=>J(K,ue.target.value),required:""},null,42,Kr),[[re,f.value[K]]]),y.value[K]?(p(),g("div",Xr,c(y.value[K]),1)):V("",!0)]))),128))])):V("",!0),u.value.hasParameters&&!R.value&&!a.isExecuting&&!a.isGenerating?(p(),g("div",Qr,[k(r(C),{icon:"carbon:warning",width:"14"}),ee(" "+c(r(o)("sidebar.fillAllRequiredParameters")),1)])):V("",!0)]),k(xs,{ref_key:"fileUploadRef",ref:$,disabled:a.isExecuting||a.isGenerating,onFilesUploaded:v,onFilesRemoved:P,onUploadKeyChanged:M,onUploadStarted:W,onUploadCompleted:E,onUploadError:A},null,8,["disabled"]),s("button",{class:"btn btn-primary execute-btn",onClick:x,disabled:!R.value},[k(r(C),{icon:a.isExecuting?"carbon:circle-dash":"carbon:play",width:"16",class:se({spinning:a.isExecuting})},null,8,["icon","class"]),ee(" "+c(a.isExecuting?r(o)("sidebar.executing"):r(o)("sidebar.executePlan")),1)],8,Yr),N.showPublishButton?(p(),g("button",{key:0,class:"btn publish-mcp-btn",onClick:q,disabled:!N.currentPlanTemplateId},[k(r(C),{icon:"carbon:application",width:"16"}),ee(" "+c(w.value),1)],8,Zr)):V("",!0),(O=N.toolInfo)!=null&&O.enableInternalToolcall?(p(),g("div",ei,[s("div",ti,[s("h4",si,c(r(o)("sidebar.internalCall")),1),s("p",oi,c(r(o)("sidebar.internalCallDescription")),1)]),s("div",ni,[s("div",ai,[s("div",li,c(r(o)("sidebar.internalMethodCall")),1),s("div",ri,c(r(o)("sidebar.toolName"))+": "+c(((G=N.toolInfo)==null?void 0:G.toolName)||N.currentPlanTemplateId),1),(Y=N.toolInfo)!=null&&Y.serviceGroup?(p(),g("div",ii,c(r(o)("sidebar.serviceGroup"))+": "+c(N.toolInfo.serviceGroup),1)):V("",!0),s("div",ci,c(r(o)("sidebar.internalCallUsage")),1),s("div",di,[s("strong",null,c(r(o)("sidebar.usage"))+":",1),s("pre",ui,c(r(o)("sidebar.internalCallExample")),1)])])])])):V("",!0),(j=N.toolInfo)!=null&&j.enableHttpService?(p(),g("div",pi,[s("div",hi,[s("h4",mi,c(r(o)("sidebar.httpCallExample")),1),s("p",fi,c(r(o)("sidebar.httpCallDescription")),1)]),s("div",vi,[s("div",gi,[s("div",bi,[(p(!0),g(oe,null,ae(h.value,K=>(p(),g("button",{key:K.id,class:se(["tab-button",{active:m.value===K.id}]),onClick:ue=>m.value=K.id},c(K.label),11,yi))),128))]),s("div",_i,[(p(!0),g(oe,null,ae(h.value,K=>te((p(),g("div",{key:K.id,class:"tab-panel"},[s("div",$i,[s("div",Si,c(K.method),1),s("div",wi,c(K.endpoint),1),s("div",ki,c(K.description),1),K.example?(p(),g("div",Ti,[s("strong",null,c(r(o)("sidebar.example"))+":",1),s("pre",Pi,c(K.example),1)])):V("",!0)])])),[[Zt,m.value===K.id]])),128))])])])])):V("",!0),(H=N.toolInfo)!=null&&H.enableMcpService?(p(),g("div",Ci,[s("div",Ei,[s("h4",Ri,c(r(o)("sidebar.mcpCall")),1),s("p",Ii,c(r(o)("sidebar.mcpCallDescription")),1)]),s("div",Ai,[s("div",xi,[s("div",Di,c(r(o)("sidebar.mcpServiceCall")),1),s("div",Fi,c(r(o)("sidebar.mcpEndpoint"))+": /mcp/execute",1),s("div",Mi,c(r(o)("sidebar.mcpCallUsage")),1),s("div",Ui,[s("strong",null,c(r(o)("sidebar.usage"))+":",1),s("pre",Ni,c(r(o)("sidebar.mcpCallExample")),1)])])])])):V("",!0)])])}}}),Bi=de(Li,[["__scopeId","data-v-1c47e1da"]]),Oi={class:"sidebar-content"},qi={class:"sidebar-content-header"},Vi={class:"sidebar-content-title"},ji={class:"tab-switcher"},Hi=["disabled"],Gi={key:0,class:"tab-content"},Wi={class:"new-task-section"},zi={class:"sidebar-content-list"},Ji={key:0,class:"loading-state"},Ki={key:1,class:"error-state"},Xi={key:2,class:"empty-state"},Qi=["onClick"],Yi={class:"task-icon"},Zi={class:"task-details"},ec={class:"task-title"},tc={class:"task-preview"},sc={class:"task-time"},oc={class:"task-actions"},nc=["title","onClick"],ac={key:1,class:"tab-content config-tab"},lc={key:0,class:"config-container"},rc={class:"template-info-header"},ic={class:"template-info"},cc={class:"template-id"},dc=["title"],uc=ce({__name:"Sidebar",emits:["planExecutionRequested"],setup(n,{expose:e,emit:t}){const{t:o}=we(),a=as(),l=U(80),i=U(!1),u=U(0),f=U(0),d=U(null),m=U({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}),y=U(null),F=U({enabled:!0,success:!0}),B=le(()=>F.value.enabled),$=async()=>{try{const L=await Ae.getCoordinatorToolConfig();F.value=L}catch(L){console.error("Failed to load CoordinatorTool configuration:",L),F.value={enabled:!0,success:!1,message:L instanceof Error?L.message:"Unknown error"}}},S=t,_=async()=>{try{const L=await z.saveTemplate();L!=null&&L.duplicate?a.success(o("sidebar.saveCompleted",{message:L.message,versionCount:L.versionCount})):L!=null&&L.saved?(a.success(o("sidebar.saveSuccess",{message:L.message,versionCount:L.versionCount})),h()):L!=null&&L.message&&a.success(o("sidebar.saveStatus",{message:L.message}))}catch(L){console.error("Failed to save plan modifications:",L),a.error(L.message||o("sidebar.saveFailed"))}},h=async()=>{await new Promise(L=>setTimeout(L,1e3)),console.log("[Sidebar]  Refreshing parameter requirements for templateId:",z.currentPlanTemplateId),await be(),d.value?(console.log("[Sidebar]  Calling ExecutionController.loadParameterRequirements()"),d.value.loadParameterRequirements(),setTimeout(()=>{d.value&&(console.log("[Sidebar]  Retry: Calling ExecutionController.loadParameterRequirements() again"),d.value.loadParameterRequirements())},2e3)):console.warn("[Sidebar]  ExecutionController ref not available"),y.value?(console.log("[Sidebar]  Calling PublishMcpServiceModal.loadParameterRequirements()"),y.value.loadParameterRequirements()):console.warn("[Sidebar]  PublishMcpServiceModal ref not available")},T=()=>{try{z&&typeof z.rollbackVersion=="function"?z.rollbackVersion():console.warn("sidebarStore or rollbackVersion method is not available")}catch(L){console.error("Error during rollback operation:",L),a.error(o("sidebar.rollbackFailed")||"Rollback failed")}},w=()=>{try{z&&typeof z.restoreVersion=="function"?z.restoreVersion():console.warn("sidebarStore or restoreVersion method is not available")}catch(L){console.error("Error during restore operation:",L),a.error(o("sidebar.restoreFailed")||"Restore failed")}},R=async L=>{var N;console.log("[Sidebar]  handleExecutePlan called with payload:",JSON.stringify(L,null,2)),console.log("[Sidebar]  Current sidebarStore state:",{currentPlanTemplateId:z.currentPlanTemplateId,selectedTemplate:(N=z.selectedTemplate)==null?void 0:N.id,jsonContent:z.jsonContent.substring(0,100)+"..."});try{const Q=z.preparePlanExecution();if(console.log("[Sidebar]  Prepared plan data:",JSON.stringify(Q,null,2)),!Q){console.log("[Sidebar]  No plan data available, returning");return}const O={...Q,uploadedFiles:L.uploadedFiles,uploadKey:L.uploadKey};L.replacementParams&&Object.keys(L.replacementParams).length>0&&(console.log("[Sidebar]  Processing replacement parameters:",L.replacementParams),O.replacementParams=L.replacementParams),console.log("[Sidebar]  Final plan data:",JSON.stringify(O,null,2));const G={...L,title:O.title,planData:O.planData,params:O.params,uploadedFiles:O.uploadedFiles,uploadKey:O.uploadKey};console.log("[Sidebar]  Emitting planExecutionRequested with final payload:",JSON.stringify(G,null,2)),S("planExecutionRequested",G),console.log("[Sidebar]  Event emitted successfully")}catch(Q){console.error("[Sidebar]  Error executing plan:",Q),a.error(o("sidebar.executeFailed")+": "+Q.message)}finally{console.log("[Sidebar]  Cleaning up after execution"),z.finishPlanExecution(),z.clearExecutionParams(),d.value&&(console.log("[Sidebar]  Calling ExecutionController.clearExecutionParams"),d.value.clearExecutionParams()),console.log("[Sidebar]  Cleanup completed")}},v=U(!1),P=()=>{if(console.log("[Sidebar] Publish MCP service button clicked"),console.log("[Sidebar] currentPlanTemplateId:",z.currentPlanTemplateId),!z.currentPlanTemplateId){console.log("[Sidebar] No plan template selected, showing warning"),a.error(o("mcpService.selectPlanTemplateFirst"));return}console.log("[Sidebar] Opening publish MCP service modal"),v.value=!0},M=async L=>{L===null?(console.log("MCP service deleted successfully"),a.success(o("mcpService.deleteSuccess")),m.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}):(console.log("MCP service published successfully:",L),a.success(o("mcpService.publishSuccess")),m.value={...L,toolName:L.toolName||"",serviceGroup:L.serviceGroup||""}),console.log("[Sidebar]  Reloading available tools after service publish/delete"),await z.loadAvailableTools()},W=()=>{z.clearExecutionParams()},E=L=>{z.executionParams=L},A=async L=>{if(!L){m.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""};return}try{const N=await Ae.getCoordinatorToolsByTemplate(L);N?m.value={...N,toolName:N.toolName||"",serviceGroup:N.serviceGroup||""}:m.value={toolName:"",toolDescription:"",planTemplateId:L,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}catch(N){console.error("Failed to load tool information:",N),m.value={toolName:"",toolDescription:"",planTemplateId:L,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}},x=L=>{if(isNaN(L.getTime()))return console.warn("Invalid date received:",L),o("time.unknown");const Q=new Date().getTime()-L.getTime(),O=Math.floor(Q/6e4),G=Math.floor(Q/36e5),Y=Math.floor(Q/864e5);return O<1?o("time.now"):O<60?o("time.minuteAgo",{count:O}):G<24?o("time.hourAgo",{count:G}):Y<30?o("time.dayAgo",{count:Y}):L.toLocaleDateString("zh-CN")},q=(L,N)=>!L||L.length<=N?L:L.substring(0,N)+"...",b=L=>{i.value=!0,u.value=L.clientX,f.value=l.value,document.addEventListener("mousemove",D),document.addEventListener("mouseup",J),document.body.style.cursor="col-resize",document.body.style.userSelect="none",L.preventDefault()},D=L=>{if(!i.value)return;const N=window.innerWidth,O=(L.clientX-u.value)/N*100;let G=f.value+O;G=Math.max(15,Math.min(100,G)),l.value=G},J=()=>{i.value=!1,document.removeEventListener("mousemove",D),document.removeEventListener("mouseup",J),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("sidebarWidth",l.value.toString())},X=()=>{l.value=80,localStorage.setItem("sidebarWidth","80")};return ie(()=>z.currentPlanTemplateId,L=>{A(L)},{immediate:!0}),Se(()=>{z.loadPlanTemplateList(),$(),z.loadAvailableTools();const L=localStorage.getItem("sidebarWidth");L&&(l.value=parseFloat(L))}),$e(()=>{document.removeEventListener("mousemove",D),document.removeEventListener("mouseup",J)}),e({loadPlanTemplateList:z.loadPlanTemplateList,toggleSidebar:z.toggleSidebar,currentPlanTemplateId:z.currentPlanTemplateId}),(L,N)=>{var Q,O;return p(),g(oe,null,[s("div",{class:se(["sidebar-wrapper",{"sidebar-wrapper-collapsed":r(z).isCollapsed}]),style:qe({width:l.value+"%"})},[s("div",Oi,[s("div",qi,[s("div",Vi,c(L.$t("sidebar.title")),1)]),s("div",ji,[s("button",{class:se(["tab-button",{active:r(z).currentTab==="list"}]),onClick:N[0]||(N[0]=G=>r(z).switchToTab("list"))},[k(r(C),{icon:"carbon:list",width:"16"}),ee(" "+c(L.$t("sidebar.templateList")),1)],2),s("button",{class:se(["tab-button",{active:r(z).currentTab==="config"}]),onClick:N[1]||(N[1]=G=>r(z).switchToTab("config")),disabled:!r(z).selectedTemplate},[k(r(C),{icon:"carbon:settings",width:"16"}),ee(" "+c(L.$t("sidebar.configuration")),1)],10,Hi)]),r(z).currentTab==="list"?(p(),g("div",Gi,[s("div",Wi,[s("button",{class:"new-task-btn",onClick:N[2]||(N[2]=()=>r(z).createNewTemplate(r(z).planType))},[k(r(C),{icon:"carbon:add",width:"16"}),ee(" "+c(L.$t("sidebar.newPlan"))+" ",1),N[8]||(N[8]=s("span",{class:"shortcut"}," K",-1))])]),s("div",zi,[r(z).isLoading?(p(),g("div",Ji,[k(r(C),{icon:"carbon:circle-dash",width:"20",class:"spinning"}),s("span",null,c(L.$t("sidebar.loading")),1)])):r(z).errorMessage?(p(),g("div",Ki,[k(r(C),{icon:"carbon:warning",width:"20"}),s("span",null,c(r(z).errorMessage),1),s("button",{onClick:N[3]||(N[3]=(...G)=>r(z).loadPlanTemplateList&&r(z).loadPlanTemplateList(...G)),class:"retry-btn"},c(L.$t("sidebar.retry")),1)])):r(z).planTemplateList.length===0?(p(),g("div",Xi,[k(r(C),{icon:"carbon:document",width:"32"}),s("span",null,c(L.$t("sidebar.noTemplates")),1)])):(p(!0),g(oe,{key:3},ae(r(z).sortedTemplates,G=>(p(),g("div",{key:G.id,class:se(["sidebar-content-list-item",{"sidebar-content-list-item-active":G.id===r(z).currentPlanTemplateId}]),onClick:Y=>r(z).selectTemplate(G)},[s("div",Yi,[k(r(C),{icon:"carbon:document",width:"20"})]),s("div",Zi,[s("div",ec,c(G.title||L.$t("sidebar.unnamedPlan")),1),s("div",tc,c(q(G.description||L.$t("sidebar.noDescription"),40)),1)]),s("div",sc,c(x(r(z).parseDateTime(G.updateTime||G.createTime))),1),s("div",oc,[s("button",{class:"delete-task-btn",title:L.$t("sidebar.deleteTemplate"),onClick:pe(Y=>r(z).deleteTemplate(G),["stop"])},[k(r(C),{icon:"carbon:close",width:"16"})],8,nc)])],10,Qi))),128))])])):r(z).currentTab==="config"?(p(),g("div",ac,[r(z).selectedTemplate?(p(),g("div",lc,[s("div",rc,[s("div",ic,[s("h3",null,c(r(z).selectedTemplate.title||L.$t("sidebar.unnamedPlan")),1),s("span",cc,"ID: "+c(r(z).selectedTemplate.id),1)]),s("button",{class:"back-to-list-btn",onClick:N[4]||(N[4]=G=>r(z).switchToTab("list"))},[k(r(C),{icon:"carbon:arrow-left",width:"16"})])]),r(z).planType==="dynamic_agent"?(p(),ne(Ar,{key:0,"json-content":r(z).jsonContent,"can-rollback":r(z).canRollback,"can-restore":r(z).canRestore,"is-generating":r(z).isGenerating,"is-executing":r(z).isExecuting,"current-plan-template-id":r(z).currentPlanTemplateId||"",onRollback:T,onRestore:w,onSave:_,"onUpdate:jsonContent":N[5]||(N[5]=G=>r(z).jsonContent=G)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])):(p(),ne(fn,{key:1,"json-content":r(z).jsonContent,"can-rollback":r(z).canRollback,"can-restore":r(z).canRestore,"is-generating":r(z).isGenerating,"is-executing":r(z).isExecuting,"current-plan-template-id":r(z).currentPlanTemplateId||"",onRollback:T,onRestore:w,onSave:_,"onUpdate:jsonContent":N[6]||(N[6]=G=>r(z).jsonContent=G)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])),k(Bi,{ref_key:"executionControllerRef",ref:d,"current-plan-template-id":r(z).currentPlanTemplateId||"","is-executing":r(z).isExecuting,"is-generating":r(z).isGenerating,"show-publish-button":B.value,"tool-info":m.value,onExecutePlan:R,onPublishMcpService:P,onClearParams:W,onUpdateExecutionParams:E},null,8,["current-plan-template-id","is-executing","is-generating","show-publish-button","tool-info"])])):V("",!0)])):V("",!0)]),s("div",{class:"sidebar-resizer",onMousedown:b,onDblclick:X,title:L.$t("sidebar.resizeHint")},N[9]||(N[9]=[s("div",{class:"resizer-line"},null,-1)]),40,dc)],6),k(wo,{ref_key:"publishMcpModalRef",ref:y,modelValue:v.value,"onUpdate:modelValue":N[7]||(N[7]=G=>v.value=G),"plan-template-id":r(z).currentPlanTemplateId||"","plan-title":((Q=r(z).selectedTemplate)==null?void 0:Q.title)||"","plan-description":((O=r(z).selectedTemplate)==null?void 0:O.description)||"",onPublished:M},null,8,["modelValue","plan-template-id","plan-title","plan-description"])],64)}}}),pc=de(uc,[["__scopeId","data-v-5ddd39f5"]]);class ct{static async handleResponse(e){if(!e.ok)try{const t=await e.json();throw new Error(t.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getMemories(){try{const e=await fetch(`${this.BASE_URL}`);return(await(await this.handleResponse(e)).json()).memories||[]}catch(e){throw console.error("Failed to get memory list:",e),e}}static async getMemory(e){try{const t=await fetch(`${this.BASE_URL}/single?conversationId=${e}`),a=await(await this.handleResponse(t)).json();if(!a.data)throw new Error("Memory not found");return a.data}catch(t){throw console.error("Failed to get memory:",t),t}}static async createMemory(e,t){try{const o=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,memory_name:t})}),l=await(await this.handleResponse(o)).json();if(!l.data)throw new Error("Failed to create memory");return l.data}catch(o){throw console.error("Failed to create memory:",o),o}}static async updateMemory(e,t){try{const o=await fetch(`${this.BASE_URL}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,memory_name:t})}),l=await(await this.handleResponse(o)).json();if(!l.data)throw new Error("Failed to update memory");return l.data}catch(o){throw console.error("Failed to update memory:",o),o}}static async deleteMemory(e){try{const t=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE"});await this.handleResponse(t)}catch(t){throw console.error("Failed to delete memory:",t),t}}static async generateConversationId(){try{const e=await fetch(`${this.BASE_URL}/generate-id`),o=await(await this.handleResponse(e)).json();if(!o.data)throw new Error("Failed to generate conversation ID");return o.data}catch(e){throw console.error("Failed to generate conversation ID:",e),e}}}me(ct,"BASE_URL","/api/memories");class hc{constructor(){me(this,"isCollapsed",!1);me(this,"selectMemoryId","");me(this,"loadMessages",()=>{});me(this,"intervalId")}toggleSidebar(){this.isCollapsed=!this.isCollapsed,this.isCollapsed?(this.loadMessages(),this.intervalId=window.setInterval(()=>{this.loadMessages()},3e3)):clearInterval(this.intervalId)}selectMemory(e){this.toggleSidebar(),this.selectMemoryId=e}setMemory(e){this.selectMemoryId=e}defaultMemoryId(){this.selectMemoryId=this.generateRandomId()}clearMemoryId(){this.selectMemoryId=""}generateRandomId(){return Math.random().toString(36).substring(2,10)}setLoadMessages(e){this.loadMessages=e}}const xe=st(new hc),mc={key:0,class:"app-container"},fc={class:"app-content"},vc={class:"header"},gc={class:"relative"},bc={class:"title-edit-group"},yc={id:"main-title",class:"main-title"},_c={key:0,id:"title-edit-container",class:"title-edit-container"},$c={class:"search-bar"},Sc={class:"search-container"},wc=["placeholder"],kc={class:"message-list",id:"message-list"},Tc={class:"message-header"},Pc={class:"message-content"},Cc={class:"sender-info"},Ec=["onClick"],Rc={class:"sender-name"},Ic=["onClick"],Ac={class:"action-buttons"},xc=["onClick"],Dc={class:"action-buttons"},Fc=["onClick"],Mc={class:"message-preview"},Uc={class:"preview-line"},Nc={key:0,class:"preview-line",style:{opacity:"0.8"}},Lc={class:"message-meta"},Bc={class:"message-id"},Oc={class:"meta-right"},qc={key:0,class:"unread-count"},Vc={class:"message-time"},jc=["id"],Hc={style:{display:"flex","flex-direction":"column",gap:"0.75rem"}},Gc={class:"bubble-avatar"},Wc={class:"bubble-content"},zc={class:"bubble-text"},Jc={key:0,class:"empty-state"},Kc={class:"modal-content"},Xc={class:"modal-header"},Qc={class:"modal-title"},Yc=["placeholder"],Zc={id:"name-char-count",class:"char-count",style:{"text-align":"right",display:"block","margin-top":"0.25rem"}},ed={class:"modal-footer"},td={class:"modal-content"},sd={class:"modal-header"},od={class:"modal-title"},nd={class:"state-text",id:"delete-message"},ad={class:"modal-footer"},ld=ce({__name:"Memory",emits:["memory-selected"],setup(n,{emit:e}){const t=U(!1),o=U(""),a=U([]),l=U([]),i=U(!1),u=U(null),f=U(""),d=U(!1),m=U(null),y=new Map,F=e,B=E=>{E.key==="Escape"&&(d.value?M():i.value&&w())};Se(()=>{xe.setLoadMessages($),document.addEventListener("keydown",B)}),$e(()=>{document.removeEventListener("keydown",B)});const $=async()=>{try{const E=await ct.getMemories();a.value?a.value=E.map(A=>({...A,expanded:y.has(A.conversation_id)?y.get(A.conversation_id):!1})):a.value=E.map(A=>({...A,expanded:!1})),l.value=[...a.value],h()}catch(E){console.error("error:",E),a.value=[],l.value=[]}},S=E=>{xe.selectMemory(E),F("memory-selected")},_=E=>{const A=typeof E=="string"?parseInt(E,10):E;return isNaN(A)||A<=0?"unknow time":new Date(A.toString().length===13?A:A*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(","," ")},h=()=>{const E=o.value.toLowerCase().trim();if(!E){l.value=[...a.value];return}l.value=a.value.filter(A=>{var D;const x=A.memory_name.toLowerCase().includes(E),q=A.conversation_id.toLowerCase().includes(E),b=((D=A.messages)==null?void 0:D.some(J=>J.text.toLowerCase().includes(E)))||!1;return x||q||b})},T=(E,A)=>{u.value=E,f.value=A,i.value=!0},w=()=>{i.value=!1,u.value=null},R=async()=>{if(!u.value)return;const E=f.value.trim()||"unknow name",A=a.value.findIndex(x=>x.conversation_id===u.value);if(A!==-1){const x=a.value[A];try{const q=await ct.updateMemory(x.conversation_id,E);q.messages||(q.messages=[]),a.value[A]={...q,expanded:x.expanded},h(),i.value=!1}catch(q){console.error("error:",q)}}},v=E=>{const A=a.value.find(x=>x.conversation_id===E);if(A){A.expanded=!A.expanded,y.set(E,A.expanded);const x=l.value.findIndex(q=>q.conversation_id===E);x!==-1&&(l.value[x]={...A})}},P=E=>{m.value=E,d.value=!0},M=()=>{d.value=!1,m.value=null},W=async()=>{if(m.value)try{await ct.deleteMemory(m.value),a.value=a.value.filter(E=>E.conversation_id!==m.value),h(),a.value.length===0&&xe.clearMemoryId(),d.value=!1,m.value=null}catch(E){console.error("error:",E)}};return(E,A)=>(p(),ne(Ye,{to:"body"},[k(Ue,{name:"modal"},{default:Ee(()=>[r(xe).isCollapsed?(p(),g("div",mc,[s("div",fc,[s("div",vc,[s("div",gc,[s("div",bc,[s("h1",yc,[s("span",null,c(E.$t("memory.title")),1)])]),t.value?(p(),g("div",_c)):V("",!0)]),s("button",{class:"close-btn",onClick:A[0]||(A[0]=x=>r(xe).toggleSidebar())},[k(r(C),{icon:"carbon:close"})])]),s("div",$c,[s("div",Sc,[k(r(C),{class:"search-container-icon",icon:"carbon:search"}),te(s("input",{type:"text",placeholder:E.$t("memory.searchPlaceholder"),class:"search-input","onUpdate:modelValue":A[1]||(A[1]=x=>o.value=x),onInput:h},null,40,wc),[[re,o.value]])])]),s("div",kc,[s("div",null,[(p(!0),g(oe,null,ae(l.value,x=>(p(),g("div",{class:se(["message-item",{expanded:x.expanded}]),key:x.conversation_id},[s("div",Tc,[s("div",Pc,[s("div",Cc,[s("div",{class:"sender-div",onClick:pe(q=>S(x.conversation_id),["stop"])},[s("h3",Rc,c(x.memory_name),1)],8,Ec),s("div",{class:"toggle-container",onClick:pe(q=>T(x.conversation_id,x.memory_name),["stop"])},[k(r(C),{icon:"carbon:edit",class:"edit-btn"})],8,Ic),s("div",Ac,[s("button",{class:"delete-btn",onClick:pe(q=>v(x.conversation_id),["stop"])},[k(r(C),{id:"toggle-"+x.conversation_id,icon:"carbon:chevron-down",class:"down-btn"},null,8,["id"])],8,xc)]),s("div",Dc,[s("button",{class:"delete-btn",onClick:pe(q=>P(x.conversation_id),["stop"])},[k(r(C),{icon:"carbon:delete"})],8,Fc)])]),s("div",Mc,[s("p",Uc,c(x.messages&&x.messages.length>0?x.messages[0].text:"none message"),1),x.messages&&x.messages.length>1?(p(),g("p",Nc,c(x.messages[1].text),1)):V("",!0)]),s("div",Lc,[s("span",Bc,"ID: "+c(x.conversation_id),1),s("div",Oc,[x.messages&&x.messages.length>0?(p(),g("span",qc,c(x.messages.length)+" "+c(E.$t("memory.size")),1)):V("",!0),s("span",Vc,c(_(x.create_time)),1)])])])]),x.expanded?(p(),g("div",{key:0,id:"content-"+x.conversation_id,class:"expanded-content"},[s("div",Hc,[(p(!0),g(oe,null,ae(x.messages,(q,b)=>(p(),g("div",{class:"message-bubble",key:b},[s("div",Gc,c(q.messageType),1),s("div",Wc,[s("p",zc,c(q.text),1)])]))),128))])],8,jc)):V("",!0)],2))),128))]),l.value.length===0&&o.value?(p(),g("div",Jc,A[3]||(A[3]=[s("p",{class:"state-text"},"none message",-1)]))):V("",!0)]),i.value?(p(),g("div",{key:0,id:"name-edit-modal",class:"modal-overlay",onClick:pe(w,["self"])},[s("div",Kc,[s("div",Xc,[s("h3",Qc,c(E.$t("memory.changeName")),1),te(s("input",{type:"text","onUpdate:modelValue":A[2]||(A[2]=x=>f.value=x),class:"edit-input",placeholder:E.$t("memory.newNamePlaceholder")},null,8,Yc),[[re,f.value]]),s("span",Zc,c(f.value.length),1)]),s("div",ed,[s("button",{id:"cancel-name",class:"modal-btn cancel-btn",onClick:w},c(E.$t("memory.cancel")),1),s("button",{id:"save-name",class:"modal-btn confirm-btn",onClick:R},c(E.$t("memory.save")),1)])])])):V("",!0),d.value?(p(),g("div",{key:1,id:"delete-modal",class:"modal-overlay",onClick:pe(M,["self"])},[s("div",td,[s("div",sd,[s("h3",od,c(E.$t("memory.deleteHint")),1),s("p",nd,c(E.$t("memory.deleteHintPrefix"))+" "+c(m.value)+" "+c(E.$t("memory.deleteHintSuffix")),1)]),s("div",ad,[s("button",{id:"cancel-delete",class:"modal-btn cancel-btn",onClick:M},c(E.$t("memory.cancel")),1),s("button",{id:"confirm-delete",class:"modal-btn delete-btn-confirm",onClick:W},c(E.$t("memory.delete")),1)])])])):V("",!0)])])):V("",!0)]),_:1})]))}}),rd=de(ld,[["__scopeId","data-v-ca286acb"]]),id="/api/executor";async function Ds(n){try{const e=await fetch(`${id}/agent-execution/${n}`);if(!e.ok){if(e.status===404)return console.warn(`Agent execution detail not found for stepId: ${n}`),null;throw new Error(`HTTP error! status: ${e.status}`)}return await e.json()}catch(e){return console.error(`Error fetching agent execution detail for stepId: ${n}:`,e),null}}async function cd(n){return console.log(`Refreshing agent execution detail for stepId: ${n}`),Ds(n)}class De{static async handleResponse(e){if(!e.ok)try{const t=await e.json();throw new Error(t.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getFileTree(e){try{const t=await fetch(`${this.BASE_URL}/tree/${e}`),a=await(await this.handleResponse(t)).json();if(!a.success)throw new Error(a.message||"Failed to get file tree");return a.data}catch(t){throw console.error("Failed to get file tree:",t),t}}static async getFileContent(e,t){try{const o=await fetch(`${this.BASE_URL}/content/${e}?path=${encodeURIComponent(t)}`),l=await(await this.handleResponse(o)).json();if(!l.success)throw new Error(l.message||"Failed to get file content");return l.data}catch(o){throw console.error("Failed to get file content:",o),o}}static async downloadFile(e,t,o){try{const a=await fetch(`${this.BASE_URL}/download/${e}?path=${encodeURIComponent(t)}`);await this.handleResponse(a);const l=await a.blob(),i=window.URL.createObjectURL(l),u=document.createElement("a");u.href=i,u.download=o||t.split("/").pop()||"download",document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(i),document.body.removeChild(u)}catch(a){throw console.error("Failed to download file:",a),a}}static isTextFile(e,t){const o=["text/","application/json","application/xml","application/javascript","application/typescript"],a=[".txt",".md",".json",".xml",".html",".css",".js",".ts",".vue",".jsx",".tsx",".py",".java",".cpp",".c",".h",".sh",".bat",".yml",".yaml",".properties",".conf",".cfg"];if(o.some(i=>e.startsWith(i)))return!0;const l=t.toLowerCase();return a.some(i=>l.endsWith(i))}static getFileIcon(e){if(e.type==="directory")return"carbon:folder";const t=e.name.toLowerCase();return t.endsWith(".js")?"vscode-icons:file-type-js":t.endsWith(".ts")?"vscode-icons:file-type-typescript":t.endsWith(".vue")?"vscode-icons:file-type-vue":t.endsWith(".java")?"vscode-icons:file-type-java":t.endsWith(".py")?"vscode-icons:file-type-python":t.endsWith(".json")?"vscode-icons:file-type-json":t.endsWith(".xml")?"vscode-icons:file-type-xml":t.endsWith(".html")?"vscode-icons:file-type-html":t.endsWith(".css")?"vscode-icons:file-type-css":t.endsWith(".md")?"vscode-icons:file-type-markdown":t.endsWith(".yml")||t.endsWith(".yaml")?"vscode-icons:file-type-yaml":t.endsWith(".pdf")?"vscode-icons:file-type-pdf2":t.endsWith(".doc")||t.endsWith(".docx")?"vscode-icons:file-type-word":t.endsWith(".xls")||t.endsWith(".xlsx")?"vscode-icons:file-type-excel":t.endsWith(".ppt")||t.endsWith(".pptx")?"vscode-icons:file-type-powerpoint":t.match(/\.(jpg|jpeg|png|gif|bmp|svg)$/)?"carbon:image":t.match(/\.(zip|rar|7z|tar|gz)$/)?"carbon:archive":"carbon:document"}}me(De,"BASE_URL","/api/file-browser");const dd={class:"file-tree-node"},ud={class:"node-icon"},pd={class:"node-name"},hd={key:1,class:"file-size"},md={key:2,class:"node-actions"},fd={key:0,class:"children"},vd=ce({__name:"FileTreeNode",props:{node:{},level:{}},emits:["file-selected","download-file"],setup(n,{emit:e}){const t=n,o=e,a=U(t.level===0),l=U(!1),i=U(!1),u=U({}),f=()=>{t.node.type==="directory"&&(a.value=!a.value)},d=()=>{t.node.type==="directory"?f():m()},m=()=>{t.node.type==="file"&&o("file-selected",t.node),B()},y=()=>{o("download-file",t.node),B()},F=h=>{h.preventDefault(),i.value=!0,u.value={position:"fixed",top:`${h.clientY}px`,left:`${h.clientX}px`,zIndex:1e3},setTimeout(()=>{document.addEventListener("click",B)},0)},B=()=>{i.value=!1,document.removeEventListener("click",B)},$=async()=>{try{await navigator.clipboard.writeText(t.node.path)}catch(h){console.error("Failed to copy path:",h)}B()},S=()=>t.node.type==="directory"?a.value?"carbon:folder-open":"carbon:folder":De.getFileIcon(t.node),_=h=>{if(h===0)return"0 B";const T=1024,w=["B","KB","MB","GB"],R=Math.floor(Math.log(h)/Math.log(T));return parseFloat((h/Math.pow(T,R)).toFixed(1))+" "+w[R]};return $e(()=>{document.removeEventListener("click",B)}),(h,T)=>{const w=es("FileTreeNode",!0);return p(),g("div",dd,[s("div",{class:se(["node-content",{"is-directory":h.node.type==="directory","is-file":h.node.type==="file","is-expanded":a.value}]),style:qe({paddingLeft:`${h.level*16+12}px`}),onClick:d,onContextmenu:pe(F,["prevent"])},[h.node.type==="directory"?(p(),g("div",{key:0,class:"expand-icon",onClick:pe(f,["stop"])},[k(r(C),{icon:a.value?"carbon:chevron-down":"carbon:chevron-right",class:"chevron-icon"},null,8,["icon"])])):V("",!0),s("div",ud,[k(r(C),{icon:S()},null,8,["icon"])]),s("span",pd,c(h.node.name),1),h.node.type==="file"?(p(),g("span",hd,c(_(h.node.size)),1)):V("",!0),l.value?(p(),g("div",md,[h.node.type==="file"?(p(),g("button",{key:0,onClick:T[0]||(T[0]=pe(R=>h.$emit("download-file",h.node),["stop"])),class:"action-btn download-btn",title:"Download"},[k(r(C),{icon:"carbon:download"})])):V("",!0)])):V("",!0)],38),h.node.type==="directory"&&a.value&&h.node.children?(p(),g("div",fd,[(p(!0),g(oe,null,ae(h.node.children,R=>(p(),ne(w,{key:R.path,node:R,level:h.level+1,onFileSelected:T[1]||(T[1]=v=>h.$emit("file-selected",v)),onDownloadFile:T[2]||(T[2]=v=>h.$emit("download-file",v))},null,8,["node","level"]))),128))])):V("",!0),i.value?(p(),g("div",{key:1,class:"context-menu",style:qe(u.value),onClick:T[3]||(T[3]=pe(()=>{},["stop"]))},[s("div",{class:"context-menu-item",onClick:m},[k(r(C),{icon:"carbon:view"}),T[4]||(T[4]=s("span",null,"Open",-1))]),h.node.type==="file"?(p(),g("div",{key:0,class:"context-menu-item",onClick:y},[k(r(C),{icon:"carbon:download"}),T[5]||(T[5]=s("span",null,"Download",-1))])):V("",!0),T[7]||(T[7]=s("div",{class:"context-menu-divider"},null,-1)),s("div",{class:"context-menu-item",onClick:$},[k(r(C),{icon:"carbon:copy"}),T[6]||(T[6]=s("span",null,"Copy Path",-1))])],4)):V("",!0)])}}}),gd=de(vd,[["__scopeId","data-v-e4a376d5"]]),bd={class:"file-browser"},yd={class:"file-browser-header"},_d={class:"header-actions"},$d=["disabled","title"],Sd={class:"file-browser-content"},wd={class:"file-tree-panel"},kd={key:0,class:"loading-state"},Td={key:1,class:"error-state"},Pd={key:0,class:"waiting-for-files"},Cd={class:"message-content"},Ed={class:"tips"},Rd=["disabled"],Id={key:1,class:"actual-error"},Ad={key:2,class:"empty-state"},xd={key:3,class:"file-tree"},Dd={key:0,class:"file-content-panel"},Fd={class:"file-content-header"},Md={class:"file-info"},Ud={class:"file-name"},Nd={class:"file-size"},Ld={class:"file-actions"},Bd=["title"],Od=["title"],qd={class:"file-content-body"},Vd={key:0,class:"loading-content"},jd={key:1,class:"content-error"},Hd={key:2,class:"file-content"},Gd={key:0,class:"text-content"},Wd={key:1,class:"binary-content"},zd=ce({__name:"index",props:{planId:{}},setup(n){const e=n,{t}=we(),o=U(!1),a=U(null),l=U(null),i=U(null),u=U(null),f=U(!1),d=U(null),m=U(null),y=le(()=>!u.value||!i.value?!1:De.isTextFile(u.value.mimeType,i.value.name)),F=le(()=>a.value&&(a.value.includes("Plan directory not found")||a.value.includes("not found"))),B=()=>{m.value&&(clearTimeout(m.value),m.value=null)},$=()=>{B(),m.value=window.setTimeout(()=>{F.value&&S()},5e3)},S=async()=>{if(e.planId){o.value=!0,a.value=null,B();try{l.value=await De.getFileTree(e.planId)}catch(v){a.value=v instanceof Error?v.message:t("fileBrowser.loadError"),console.error("Failed to load file tree:",v);const P=v instanceof Error?v.message:"";(P.includes("Plan directory not found")||P.includes("not found"))&&$()}finally{o.value=!1}}},_=async v=>{if(v.type!=="directory"){i.value=v,u.value=null,f.value=!0,d.value=null;try{u.value=await De.getFileContent(e.planId,v.path)}catch(P){d.value=P instanceof Error?P.message:t("fileBrowser.contentLoadError"),console.error("Failed to load file content:",P)}finally{f.value=!1}}},h=async v=>{try{await De.downloadFile(e.planId,v.path,v.name)}catch(P){console.error("Failed to download file:",P)}},T=()=>{i.value=null,u.value=null,d.value=null},w=v=>De.getFileIcon(v),R=v=>{if(v===0)return"0 B";const P=1024,M=["B","KB","MB","GB"],W=Math.floor(Math.log(v)/Math.log(P));return parseFloat((v/Math.pow(P,W)).toFixed(1))+" "+M[W]};return ie(()=>e.planId,v=>{v&&(i.value=null,u.value=null,S())},{immediate:!0}),Se(()=>{e.planId&&S()}),$e(()=>{B()}),(v,P)=>(p(),g("div",bd,[s("div",yd,[s("h3",null,c(v.$t("fileBrowser.title")),1),s("div",_d,[s("button",{class:"refresh-btn",onClick:S,disabled:o.value,title:v.$t("fileBrowser.refresh")},[k(r(C),{icon:"carbon:refresh",class:se({rotating:o.value}),style:{color:"#ffffff",fontSize:"18px",width:"18px",height:"18px"}},null,8,["class"])],8,$d)])]),s("div",Sd,[s("div",wd,[o.value?(p(),g("div",kd,[k(r(C),{icon:"carbon:loading",class:"rotating"}),s("span",null,c(v.$t("fileBrowser.loading")),1)])):a.value?(p(),g("div",Td,[F.value?(p(),g("div",Pd,[k(r(C),{icon:"carbon:time",class:"rotating"}),s("div",Cd,[s("h3",null,c(v.$t("fileBrowser.waitingForGeneration")),1),s("p",null,c(v.$t("fileBrowser.planExecuting")),1),s("div",Ed,[k(r(C),{icon:"carbon:information"}),s("span",null,c(v.$t("fileBrowser.filesTip")),1)])]),s("button",{onClick:S,class:"retry-btn",disabled:o.value},[k(r(C),{icon:"carbon:refresh",class:se({rotating:o.value})},null,8,["class"]),ee(" "+c(o.value?v.$t("fileBrowser.checking"):v.$t("fileBrowser.checkNow")),1)],8,Rd)])):(p(),g("div",Id,[k(r(C),{icon:"carbon:warning"}),s("span",null,c(a.value),1),s("button",{onClick:S,class:"retry-btn"},c(v.$t("fileBrowser.retry")),1)]))])):l.value?(p(),g("div",xd,[k(gd,{node:l.value,level:0,onFileSelected:_,onDownloadFile:h},null,8,["node"])])):(p(),g("div",Ad,[k(r(C),{icon:"carbon:folder-off"}),s("span",null,c(v.$t("fileBrowser.noFiles")),1)]))]),i.value?(p(),g("div",Dd,[s("div",Fd,[s("div",Md,[k(r(C),{icon:w(i.value)},null,8,["icon"]),s("span",Ud,c(i.value.name),1),s("span",Nd,"("+c(R(i.value.size))+")",1)]),s("div",Ld,[s("button",{onClick:P[0]||(P[0]=M=>h(i.value)),class:"download-btn",title:v.$t("fileBrowser.download")},[k(r(C),{icon:"carbon:download"})],8,Bd),s("button",{onClick:T,class:"close-btn",title:v.$t("common.close")},[k(r(C),{icon:"carbon:close"})],8,Od)])]),s("div",qd,[f.value?(p(),g("div",Vd,[k(r(C),{icon:"carbon:loading",class:"rotating"}),s("span",null,c(v.$t("fileBrowser.loadingContent")),1)])):d.value?(p(),g("div",jd,[k(r(C),{icon:"carbon:warning"}),s("span",null,c(d.value),1)])):u.value?(p(),g("div",Hd,[y.value?(p(),g("div",Gd,[s("pre",null,[s("code",null,c(u.value.content),1)])])):(p(),g("div",Wd,[k(r(C),{icon:"carbon:document-unknown"}),s("p",null,c(v.$t("fileBrowser.binaryFile")),1),s("button",{onClick:P[1]||(P[1]=M=>h(i.value)),class:"download-btn-large"},[k(r(C),{icon:"carbon:download"}),ee(" "+c(v.$t("fileBrowser.downloadToView")),1)])]))])):V("",!0)])])):V("",!0)])]))}}),Jd=de(zd,[["__scopeId","data-v-e7c74fe4"]]),Kd={class:"right-panel"},Xd={class:"preview-header"},Qd={class:"preview-tabs"},Yd={class:"preview-content"},Zd={key:0,class:"step-details"},eu={key:0,class:"step-info"},tu={key:0,class:"agent-info"},su={class:"info-item"},ou={class:"label"},nu={class:"value"},au={class:"info-item"},lu={class:"label"},ru={class:"value"},iu={class:"info-item"},cu={class:"label"},du={class:"execution-status"},uu={class:"status-item"},pu={class:"status-text"},hu={key:0},mu={key:0,class:"think-act-steps"},fu={class:"steps-container"},vu={class:"step-header"},gu={class:"step-number"},bu={class:"think-section"},yu={class:"think-content"},_u={class:"input"},$u={class:"label"},Su={class:"output"},wu={class:"label"},ku={key:0,class:"action-section"},Tu={class:"action-content"},Pu={class:"tool-info"},Cu={class:"label"},Eu={class:"value"},Ru={class:"input"},Iu={class:"label"},Au={class:"output"},xu={class:"label"},Du={key:0,class:"sub-plan-section"},Fu={class:"sub-plan-content"},Mu={class:"sub-plan-header"},Uu={class:"sub-plan-info"},Nu={class:"label"},Lu={class:"value"},Bu={key:0,class:"sub-plan-info"},Ou={class:"label"},qu={class:"value"},Vu={class:"sub-plan-status"},ju={class:"status-text"},Hu={key:0,class:"no-steps-message"},Gu={key:1,class:"no-execution-message"},Wu={class:"step-basic-info"},zu={class:"info-item"},Ju={class:"label"},Ku={class:"value"},Xu={key:0,class:"info-item"},Qu={class:"label"},Yu={class:"value"},Zu={class:"info-item"},ep={class:"label"},tp={class:"no-execution-hint"},sp={key:2,class:"execution-indicator"},op={class:"execution-text"},np={key:1,class:"no-selection"},ap=["title"],lp={key:1,class:"file-browser-container"},rp={key:1,class:"no-plan-message"},ip={class:"message-content"},cp={class:"tips"},dp=ce({__name:"RightPanel",props:{currentRootPlanId:{},selectedStepId:{}},setup(n,{expose:e}){const t=n,{t:o}=we(),a=U(),l=U(),i=U("details"),u=U(localStorage.getItem("jmanus-last-plan-id")),f=U(localStorage.getItem("jmanus-has-executed-plan")==="true"),d=U(!1),m=U(!0),y=U(!0),F=le(()=>l.value?l.value.completed?o("rightPanel.status.completed"):l.value.current?o("rightPanel.status.executing"):o("rightPanel.status.waiting"):""),B=le(()=>t.currentRootPlanId?t.currentRootPlanId:u.value),$=le(()=>!B.value&&!f.value),S=async E=>{var A,x,q;if(console.log("[RightPanel] Step selected:",{stepId:E}),!E){console.warn("[RightPanel] No stepId provided"),l.value=null;return}try{const b=await Ds(E);if(!b){console.warn("[RightPanel] Agent execution detail not found for stepId:",E),l.value=null;return}const D={stepId:E,title:b.agentName||`Step ${E}`,description:b.agentDescription||"",agentExecution:b,completed:b.status==="FINISHED",current:b.status==="RUNNING"};l.value=D,console.log("[RightPanel] Step details updated:",D),console.log("[RightPanel] activeTab:",i.value),console.log("[RightPanel] selectedStep.value:",l.value),console.log("[RightPanel] agentExecution:",l.value.agentExecution),console.log("[RightPanel] thinkActSteps:",(A=l.value.agentExecution)==null?void 0:A.thinkActSteps),console.log("[RightPanel] thinkActSteps length:",(q=(x=l.value.agentExecution)==null?void 0:x.thinkActSteps)==null?void 0:q.length),await be(),console.log("[RightPanel] After nextTick - selectedStep:",l.value),setTimeout(()=>{T()},100),R()}catch(b){console.error("[RightPanel] Error fetching step details:",b),l.value=null}},_=async()=>{var E;if(!((E=l.value)!=null&&E.stepId)){console.warn("[RightPanel] No step selected for refresh");return}console.log("[RightPanel] Refreshing current step:",l.value.stepId);try{const A=await cd(l.value.stepId);A&&l.value&&(l.value.agentExecution=A,l.value.completed=A.status==="FINISHED",l.value.current=A.status==="RUNNING",console.log("[RightPanel] Step refreshed successfully"),R())}catch(A){console.error("[RightPanel] Error refreshing step:",A)}};ie(()=>t.selectedStepId,async E=>{E?await S(E):l.value=null},{immediate:!0});const h=E=>{a.value=E??void 0},T=()=>{if(!a.value)return;const{scrollTop:E,scrollHeight:A,clientHeight:x}=a.value,q=A-E-x<50,b=A>x;m.value=q,d.value=b&&!q,q?y.value=!0:A-E-x>100&&(y.value=!1),console.log("[RightPanel] Scroll state check:",{scrollTop:E,scrollHeight:A,clientHeight:x,isAtBottom:q,hasScrollableContent:b,showButton:d.value,shouldAutoScroll:y.value})},w=()=>{a.value&&(a.value.scrollTo({top:a.value.scrollHeight,behavior:"smooth"}),be(()=>{y.value=!0,T()}))},R=()=>{!y.value||!a.value||be(()=>{a.value&&(a.value.scrollTop=a.value.scrollHeight,console.log("[RightPanel] Auto scroll to bottom"))})},v=E=>{if(E===null||typeof E>"u"||E==="")return"N/A";try{const A=typeof E=="object"?E:JSON.parse(E);return JSON.stringify(A,null,2)}catch{return String(E)}},P=()=>{l.value=null,y.value=!0,a.value&&a.value.removeEventListener("scroll",T)},M=()=>{const E=()=>{const A=a.value;return A?(h(A),A.addEventListener("scroll",T),y.value=!0,T(),console.log("[RightPanel] Scroll listener initialized successfully"),!0):(console.log("[RightPanel] Scroll container not found, retrying..."),!1)};be(()=>{E()||setTimeout(()=>{E()},100)})};return ie(()=>t.currentRootPlanId,(E,A)=>{E&&E!==A?(u.value=E,f.value=!0,localStorage.setItem("jmanus-last-plan-id",E),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] New plan started:",E)):!E&&A&&console.log("[RightPanel] Plan execution finished, keeping last plan:",u.value)},{immediate:!0}),Se(()=>{console.log("[RightPanel] Component mounted"),be(()=>{M()})}),$e(()=>{console.log("[RightPanel] Component unmounting, cleaning up..."),P()}),e({handleStepSelected:S,refreshCurrentStep:_,updateDisplayedPlanProgress:E=>{console.log("[RightPanel] updateDisplayedPlanProgress called with rootPlanId:",E),E&&(u.value=E,f.value=!0,localStorage.setItem("jmanus-last-plan-id",E),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] Plan progress updated:",E))}}),(E,A)=>{var x,q;return p(),g("div",Kd,[s("div",Xd,[s("div",Qd,[s("div",{class:se(["tab-item",{active:i.value==="details"}]),onClick:A[0]||(A[0]=b=>i.value="details")},[k(r(C),{icon:"carbon:events"}),s("span",null,c(r(o)("rightPanel.stepExecutionDetails")),1)],2),s("div",{class:se(["tab-item",{active:i.value==="files"}]),onClick:A[1]||(A[1]=b=>i.value="files")},[k(r(C),{icon:"carbon:folder"}),s("span",null,c(r(o)("fileBrowser.title")),1)],2)])]),s("div",Yd,[i.value==="details"?(p(),g("div",Zd,[l.value?(p(),g("div",eu,[s("h3",null,c(l.value.title||l.value.description||r(o)("rightPanel.defaultStepTitle",{number:1})),1),l.value.agentExecution?(p(),g("div",tu,[s("div",su,[s("span",ou,c(r(o)("rightPanel.executingAgent"))+":",1),s("span",nu,c(l.value.agentExecution.agentName),1)]),s("div",au,[s("span",lu,c(r(o)("rightPanel.callingModel"))+":",1),s("span",ru,c(l.value.agentExecution.modelName),1)]),s("div",iu,[s("span",cu,c(r(o)("rightPanel.executionResult"))+":",1),s("span",{class:se(["value",{success:l.value.agentExecution.status==="FINISHED"}])},c(l.value.agentExecution.status||r(o)("rightPanel.executing")),3)])])):V("",!0),s("div",du,[s("div",uu,[l.value.completed?(p(),ne(r(C),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):l.value.current?(p(),ne(r(C),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})):(p(),ne(r(C),{key:2,icon:"carbon:time",class:"status-icon pending"})),s("span",pu,c(F.value),1)])])])):V("",!0),s("div",{ref_key:"scrollContainer",ref:a,class:"step-details-scroll-container",onScroll:T},[l.value?(p(),g("div",hu,[(x=l.value.agentExecution)!=null&&x.thinkActSteps&&l.value.agentExecution.thinkActSteps.length>0?(p(),g("div",mu,[s("h4",null,c(r(o)("rightPanel.thinkAndActionSteps")),1),s("div",fu,[(p(!0),g(oe,null,ae(l.value.agentExecution.thinkActSteps,(b,D)=>(p(),g("div",{key:D,class:"think-act-step"},[s("div",vu,[s("span",gu,"#"+c(D+1),1),s("span",{class:se(["step-status",b.status])},c(b.status||r(o)("rightPanel.executing")),3)]),s("div",bu,[s("h5",null,[k(r(C),{icon:"carbon:thinking"}),ee(" "+c(r(o)("rightPanel.thinking")),1)]),s("div",yu,[s("div",_u,[s("span",$u,c(r(o)("rightPanel.input"))+":",1),s("pre",null,c(v(b.thinkInput)),1)]),s("div",Su,[s("span",wu,c(r(o)("rightPanel.output"))+":",1),s("pre",null,c(v(b.thinkOutput)),1)])])]),b.actionNeeded?(p(),g("div",ku,[s("h5",null,[k(r(C),{icon:"carbon:play"}),ee(" "+c(r(o)("rightPanel.action")),1)]),s("div",Tu,[(p(!0),g(oe,null,ae(b.actToolInfoList,(J,X)=>(p(),g("div",{key:X},[s("div",Pu,[s("span",Cu,c(r(o)("rightPanel.tool"))+":",1),s("span",Eu,c(J.name||""),1)]),s("div",Ru,[s("span",Iu,c(r(o)("rightPanel.toolParameters"))+":",1),s("pre",null,c(v(J.parameters)),1)]),s("div",Au,[s("span",xu,c(r(o)("rightPanel.executionResult"))+":",1),s("pre",null,c(v(J.result)),1)])]))),128))]),b.subPlanExecutionRecord?(p(),g("div",Du,[s("h5",null,[k(r(C),{icon:"carbon:tree-view"}),ee(" "+c(r(o)("rightPanel.subPlan")),1)]),s("div",Fu,[s("div",Mu,[s("div",Uu,[s("span",Nu,c(E.$t("rightPanel.subPlanId"))+":",1),s("span",Lu,c(b.subPlanExecutionRecord.currentPlanId),1)]),b.subPlanExecutionRecord.title?(p(),g("div",Bu,[s("span",Ou,c(E.$t("rightPanel.title"))+":",1),s("span",qu,c(b.subPlanExecutionRecord.title),1)])):V("",!0),s("div",Vu,[b.subPlanExecutionRecord.completed?(p(),ne(r(C),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):(p(),ne(r(C),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})),s("span",ju,c(b.subPlanExecutionRecord.completed?E.$t("rightPanel.status.completed"):E.$t("rightPanel.status.executing")),1)])])])])):V("",!0)])):V("",!0)]))),128))]),l.value.agentExecution&&!((q=l.value.agentExecution.thinkActSteps)!=null&&q.length)?(p(),g("div",Hu,[s("p",null,c(r(o)("rightPanel.noStepDetails")),1)])):l.value.agentExecution?V("",!0):(p(),g("div",Gu,[k(r(C),{icon:"carbon:information",class:"info-icon"}),s("h4",null,c(r(o)("rightPanel.stepInfo")),1),s("div",Wu,[s("div",zu,[s("span",Ju,c(r(o)("rightPanel.stepName"))+":",1),s("span",Ku,c(l.value.title||l.value.description||l.value.stepId),1)]),l.value.description?(p(),g("div",Xu,[s("span",Qu,c(E.$t("rightPanel.description"))+":",1),s("span",Yu,c(l.value.description),1)])):V("",!0),s("div",Zu,[s("span",ep,c(E.$t("rightPanel.status.label"))+":",1),s("span",{class:se(["value",{"status-completed":l.value.completed,"status-current":l.value.current,"status-pending":!l.value.completed&&!l.value.current}])},c(l.value.completed?E.$t("rightPanel.status.completed"):l.value.current?E.$t("rightPanel.status.executing"):E.$t("rightPanel.status.pending")),3)])]),s("p",tp,c(r(o)("rightPanel.noExecutionInfo")),1)])),l.value.current&&!l.value.completed?(p(),g("div",sp,[A[2]||(A[2]=s("div",{class:"execution-waves"},[s("div",{class:"wave wave-1"}),s("div",{class:"wave wave-2"}),s("div",{class:"wave wave-3"})],-1)),s("p",op,[k(r(C),{icon:"carbon:in-progress",class:"rotating-icon"}),ee(" "+c(r(o)("rightPanel.stepExecuting")),1)])])):V("",!0)])):(p(),g("div",np,[k(r(C),{icon:"carbon:events",class:"empty-icon"}),s("h3",null,c(r(o)("rightPanel.noStepSelected")),1),s("p",null,c(r(o)("rightPanel.selectStepHint")),1)]))])):V("",!0),k(Ue,{name:"scroll-button"},{default:Ee(()=>[d.value?(p(),g("button",{key:0,onClick:w,class:"scroll-to-bottom-btn",title:r(o)("rightPanel.scrollToBottom")},[k(r(C),{icon:"carbon:chevron-down"})],8,ap)):V("",!0)]),_:1})],544)])):V("",!0),i.value==="files"?(p(),g("div",lp,[B.value?(p(),ne(Jd,{key:0,"plan-id":B.value},null,8,["plan-id"])):$.value?(p(),g("div",rp,[k(r(C),{icon:"carbon:folder-off"}),s("div",ip,[s("h3",null,c(r(o)("fileBrowser.noFilesYet")),1),s("p",null,c(r(o)("fileBrowser.noPlanExecuting")),1),s("div",cp,[k(r(C),{icon:"carbon:information"}),s("span",null,c(r(o)("fileBrowser.startTaskTip")),1)])])])):V("",!0)])):V("",!0)])])}}}),up=de(dp,[["__scopeId","data-v-ea214380"]]);function Ut(){return{formatResponseText:f=>f?f.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\n/g,"<br>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>"):"",formatTimestamp:f=>{const m=new Date().getTime()-f.getTime();return m<6e4?"Just now":m<36e5?`${Math.floor(m/6e4)} minutes ago`:m<864e5?`${Math.floor(m/36e5)} hours ago`:f.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},getMessageClasses:f=>le(()=>({user:f.type==="user",assistant:f.type==="assistant",streaming:f.isStreaming,"has-error":!!f.error,"has-thinking":!!f.thinking,"has-execution":!!f.planExecution})),formatFileSize:f=>{if(f===0)return"0 B";const d=1024,m=["B","KB","MB","GB"],y=Math.floor(Math.log(f)/Math.log(d));return parseFloat((f/Math.pow(d,y)).toFixed(2))+" "+m[y]},truncateText:(f,d=100)=>!f||f.length<=d?f:f.substring(0,d)+"...",stripHtml:f=>f.replace(/<[^>]*>/g,""),hasDisplayableContent:f=>!!(f.content||f.thinking||f.planExecution||f.error),getMessageStatus:f=>f.error?"Send failed":f.isStreaming?"Typing...":f.type==="assistant"&&!f.content&&!f.thinking?"Waiting for response":""}}const pp=["data-message-id"],hp={class:"user-content"},mp={class:"message-text"},fp={key:0,class:"attachments"},vp={class:"attachment-name"},gp={class:"attachment-size"},bp={class:"message-timestamp"},yp={key:0,class:"message-status error"},_p={class:"status-text"},$p=ce({__name:"UserMessage",props:{message:{}},setup(n){const{formatTimestamp:e,formatFileSize:t}=Ut();return(o,a)=>{var l;return p(),g("div",{class:"user-message","data-message-id":o.message.id},[s("div",hp,[s("div",mp,c(o.message.content),1),(l=o.message.attachments)!=null&&l.length?(p(),g("div",fp,[(p(!0),g(oe,null,ae(o.message.attachments,(i,u)=>(p(),g("div",{key:u,class:"attachment-item"},[k(r(C),{icon:"carbon:document",class:"attachment-icon"}),s("span",vp,c(i.name),1),s("span",gp,c(r(t)(i.size)),1)]))),128))])):V("",!0),s("div",bp,c(r(e)(o.message.timestamp)),1)]),o.message.error?(p(),g("div",yp,[k(r(C),{icon:"carbon:warning",class:"status-icon"}),s("span",_p,c(o.message.error),1)])):V("",!0)],8,pp)}}}),Sp=de($p,[["__scopeId","data-v-94372507"]]),wp={class:"sub-plan-info"},kp={class:"sub-plan-details"},Tp={class:"sub-plan-title"},Pp={key:0,class:"nesting-level"},Cp={class:"sub-plan-id"},Ep={class:"sub-plan-meta"},Rp={key:0,class:"trigger-tool"},Ip={class:"trigger-text"},Ap={key:0,class:"sub-plan-progress"},xp={class:"progress-info"},Dp={class:"progress-text"},Fp={class:"progress-bar"},Mp={key:1,class:"sub-plan-agents-steps"},Up={class:"agents-steps-header"},Np={class:"agents-label"},Lp={class:"agents-steps-list"},Bp=["onClick"],Op={class:"agent-step-header"},qp={class:"agent-name"},Vp={class:"sub-agent-execution-info"},jp={key:0,class:"agent-result"},Hp={class:"result-header"},Gp={class:"result-label"},Wp={class:"result-content"},zp={key:1,class:"agent-error"},Jp={class:"error-header"},Kp={class:"error-label"},Xp={class:"error-content"},Qp={key:2,class:"think-act-preview"},Yp={class:"think-act-header"},Zp={class:"think-act-label"},eh={class:"think-act-steps-preview"},th=["onClick"],sh={class:"step-number"},oh={class:"step-description"},nh={key:0,class:"more-steps"},ah={class:"more-steps-text"},lh={key:3,class:"nested-sub-plans"},rh={class:"nested-sub-plans-header"},ih={class:"nested-label"},ch={class:"nested-sub-plans-list"},dh={key:4,class:"direct-sub-plans"},uh={class:"direct-sub-plans-header"},ph={class:"direct-label"},hh={class:"direct-sub-plans-list"},mh=ce({__name:"RecursiveSubPlan",props:{subPlan:{},subPlanIndex:{},nestingLevel:{default:0},maxNestingDepth:{default:3},maxVisibleSteps:{default:2}},emits:["sub-plan-selected","step-selected"],setup(n,{emit:e}){const t=n,o=e,{t:a}=we(),l=()=>`nesting-level-${t.nestingLevel}`,i=()=>{var M,W;return t.subPlan.completed?"completed":((M=t.subPlan.agentExecutionSequence)==null?void 0:M.some(E=>E.status==="RUNNING"))?"running":((W=t.subPlan.agentExecutionSequence)==null?void 0:W.some(E=>E.status==="FINISHED"))?"in-progress":"pending"},u=()=>{switch(i()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},f=()=>{switch(i()){case"completed":return"carbon:checkmark";case"running":return"carbon:play";case"in-progress":return"carbon:in-progress";case"pending":default:return"carbon:dot-mark"}},d=()=>{var P;if(!((P=t.subPlan.agentExecutionSequence)!=null&&P.length))return 0;if(t.subPlan.completed)return 100;const v=m();return Math.min(100,v/t.subPlan.agentExecutionSequence.length*100)},m=()=>{var v;return(v=t.subPlan.agentExecutionSequence)!=null&&v.length?t.subPlan.agentExecutionSequence.filter(P=>P.status==="FINISHED").length:0},y=v=>{switch(v){case"FINISHED":return"completed";case"RUNNING":return"running";case"IDLE":default:return"pending"}},F=v=>{switch(v){case"FINISHED":return"carbon:checkmark";case"RUNNING":return"carbon:play";case"IDLE":default:return"carbon:dot-mark"}},B=v=>{switch(v){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},$=v=>{var P;return((P=v.thinkActSteps)==null?void 0:P.some(M=>M.subPlanExecutionRecord))??!1},S=v=>{var P;return((P=v.thinkActSteps)==null?void 0:P.filter(M=>M.subPlanExecutionRecord))??[]},_=()=>{o("sub-plan-selected",-1,t.subPlanIndex,t.subPlan)},h=(v,P)=>{const M=P.stepId||`subplan-${t.subPlanIndex}-agent-${v}`;o("step-selected",M)},T=(v,P,M)=>{const W=M.stepId||`subplan-${t.subPlanIndex}-agent-${v}`;o("step-selected",W)},w=(v,P,M)=>{o("sub-plan-selected",v,P,M)},R=v=>{o("step-selected",v)};return(v,P)=>{var W,E;const M=es("RecursiveSubPlan",!0);return p(),g("div",{class:se(["recursive-sub-plan",l()])},[s("div",{class:"sub-plan-header",onClick:_},[s("div",wp,[k(r(C),{icon:f(),class:"sub-plan-status-icon"},null,8,["icon"]),s("div",kp,[s("div",Tp,[ee(c(v.subPlan.title||v.$t("chat.subPlan"))+" #"+c(v.subPlanIndex+1)+" ",1),(v.nestingLevel??0)>0?(p(),g("span",Pp,"(L"+c((v.nestingLevel??0)+1)+")",1)):V("",!0)]),s("div",Cp,c(v.subPlan.currentPlanId),1)])]),s("div",Ep,[s("div",{class:se(["sub-plan-status-badge",i()])},c(u()),3),v.subPlan.parentActToolCall?(p(),g("div",Rp,[k(r(C),{icon:"carbon:function",class:"trigger-icon"}),s("span",Ip,c(v.subPlan.parentActToolCall.name),1)])):V("",!0)])]),(W=v.subPlan.agentExecutionSequence)!=null&&W.length?(p(),g("div",Ap,[s("div",xp,[s("span",Dp,c(v.$t("chat.progress"))+": "+c(m())+" / "+c(v.subPlan.agentExecutionSequence.length),1),s("div",Fp,[s("div",{class:"progress-fill",style:qe({width:d()+"%"})},null,4)])])])):V("",!0),(E=v.subPlan.agentExecutionSequence)!=null&&E.length?(p(),g("div",Mp,[s("div",Up,[s("span",Np,c(v.$t("chat.agentExecutions"))+":",1)]),s("div",Lp,[(p(!0),g(oe,null,ae(v.subPlan.agentExecutionSequence,(A,x)=>{var q,b;return p(),g("div",{key:A.id||x,class:se(["agent-step-item",y(A.status)]),onClick:D=>h(x,A)},[s("div",Op,[k(r(C),{icon:F(A.status),class:"agent-icon"},null,8,["icon"]),s("span",qp,c(A.agentName||v.$t("chat.unknownAgent")),1),s("div",{class:se(["agent-status-badge",y(A.status)])},c(B(A.status)),3)]),s("div",Vp,[A.result?(p(),g("div",jp,[s("div",Hp,[k(r(C),{icon:"carbon:checkmark",class:"result-icon"}),s("span",Gp,c(v.$t("chat.agentResult"))+":",1)]),s("pre",Wp,c(A.result),1)])):V("",!0),A.errorMessage?(p(),g("div",zp,[s("div",Jp,[k(r(C),{icon:"carbon:warning",class:"error-icon"}),s("span",Kp,c(v.$t("chat.errorMessage"))+":",1)]),s("pre",Xp,c(A.errorMessage),1)])):V("",!0),(q=A.thinkActSteps)!=null&&q.length?(p(),g("div",Qp,[s("div",Yp,[k(r(C),{icon:"carbon:thinking",class:"think-act-icon"}),s("span",Zp,c(v.$t("chat.thinkActSteps"))+" ("+c(A.thinkActSteps.length)+")",1)]),s("div",eh,[(p(!0),g(oe,null,ae(A.thinkActSteps.slice(0,v.maxVisibleSteps??2),(D,J)=>(p(),g("div",{key:D.id||J,class:"think-act-step-preview",onClick:pe(X=>T(x,J,A),["stop"])},[s("span",sh,"#"+c(J+1),1),s("span",oh,c(D.actionDescription||v.$t("chat.thinking")),1),k(r(C),{icon:"carbon:arrow-right",class:"step-arrow"})],8,th))),128)),A.thinkActSteps.length>(v.maxVisibleSteps??2)?(p(),g("div",nh,[s("span",ah,c(v.$t("chat.andMoreSteps",{count:A.thinkActSteps.length-(v.maxVisibleSteps??2)})),1)])):V("",!0)])])):V("",!0),$(A)?(p(),g("div",lh,[s("div",rh,[k(r(C),{icon:"carbon:tree-view-alt",class:"nested-icon"}),s("span",ih,c(v.$t("chat.nestedSubPlans")),1)]),s("div",ch,[(p(!0),g(oe,null,ae(S(A),(D,J)=>(p(),ne(M,{key:D.id||J,"sub-plan":D.subPlanExecutionRecord,"sub-plan-index":J,"nesting-level":(v.nestingLevel??0)+1,"max-nesting-depth":v.maxNestingDepth??3,"max-visible-steps":v.maxVisibleSteps??2,onSubPlanSelected:w,onStepSelected:R},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):V("",!0),(b=A.subPlanExecutionRecords)!=null&&b.length?(p(),g("div",dh,[s("div",uh,[k(r(C),{icon:"carbon:tree-view",class:"direct-icon"}),s("span",ph,c(v.$t("chat.directSubPlans")),1)]),s("div",hh,[(p(!0),g(oe,null,ae(A.subPlanExecutionRecords,(D,J)=>(p(),ne(M,{key:D.currentPlanId||J,"sub-plan":D,"sub-plan-index":J,"nesting-level":(v.nestingLevel??0)+1,"max-nesting-depth":v.maxNestingDepth??3,"max-visible-steps":v.maxVisibleSteps??2,onSubPlanSelected:w,onStepSelected:R},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):V("",!0)])],10,Bp)}),128))])])):V("",!0)],2)}}}),fh=de(mh,[["__scopeId","data-v-5ef3cbb7"]]),vh={class:"execution-details"},gh={key:0,class:"plan-overview"},bh={class:"plan-header"},yh={class:"plan-title"},_h={key:0,class:"parent-tool-call"},$h={class:"parent-tool-header"},Sh={class:"tool-label"},wh={class:"tool-name"},kh={key:0,class:"tool-parameters"},Th={class:"param-label"},Ph={class:"param-content"},Ch={key:1,class:"agent-execution-container"},Eh={class:"section-title"},Rh=["onClick"],Ih={class:"agent-info"},Ah={class:"agent-details"},xh={class:"agent-name"},Dh={class:"request-content"},Fh={class:"agent-controls"},Mh={class:"agent-execution-info"},Uh={key:0,class:"agent-result"},Nh={class:"result-header"},Lh={class:"result-label"},Bh={class:"result-content"},Oh={key:1,class:"agent-error"},qh={class:"error-header"},Vh={class:"error-label"},jh={class:"error-content"},Hh={key:0,class:"sub-plans-container"},Gh={class:"sub-plans-header"},Wh={class:"sub-plans-title"},zh={class:"sub-plans-list"},Jh=ce({__name:"ExecutionDetails",props:{planExecution:{},genericInput:{}},emits:["agent-selected","sub-plan-selected","user-input-submitted","step-selected"],setup(n,{emit:e}){const t=n,o=e,{t:a}=we(),l=le(()=>t.planExecution.agentExecutionSequence??[]),i=S=>{S.stepId?o("step-selected",S.stepId):console.warn("[ExecutionDetails] Agent execution has no stepId:",S)},u=()=>t.planExecution?t.planExecution.completed?"completed":l.value.some(h=>h.status==="RUNNING")?"running":l.value.some(h=>h.status==="FINISHED")?"in-progress":"pending":"unknown",f=()=>{switch(u()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},d=S=>{switch(S){case"RUNNING":return"running";case"FINISHED":return"completed";case"IDLE":default:return"pending"}},m=S=>{switch(S){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},y=S=>{switch(S){case"RUNNING":return"carbon:play";case"FINISHED":return"carbon:checkmark";case"IDLE":default:return"carbon:dot-mark"}},F=(S,_,h)=>{o("sub-plan-selected",S,_,h)},B=S=>{o("step-selected",S)},$=S=>{if(!S)return"";try{const _=JSON.parse(S);return JSON.stringify(_,null,2)}catch{return S}};return(S,_)=>{var h,T,w;return p(),g("div",vh,[S.planExecution?(p(),g("div",gh,[s("div",bh,[s("h3",yh,c(S.planExecution.title||S.$t("chat.planExecution")),1),s("div",{class:se(["plan-status-badge",u()])},c(f()),3)]),S.planExecution.parentActToolCall?(p(),g("div",_h,[s("div",$h,[k(r(C),{icon:"carbon:flow",class:"tool-icon"}),s("span",Sh,c(S.$t("chat.triggeredByTool"))+":",1),s("span",wh,c(S.planExecution.parentActToolCall.name),1)]),S.planExecution.parentActToolCall.parameters?(p(),g("div",kh,[s("span",Th,c(S.$t("common.parameters"))+":",1),s("pre",Ph,c($(S.planExecution.parentActToolCall.parameters)),1)])):V("",!0)])):V("",!0)])):V("",!0),(((T=(h=S.planExecution)==null?void 0:h.agentExecutionSequence)==null?void 0:T.length)??0)>0?(p(),g("div",Ch,[s("h4",Eh,c(S.$t("chat.agentExecutionSequence")),1),(p(!0),g(oe,null,ae((w=S.planExecution)==null?void 0:w.agentExecutionSequence,(R,v)=>{var P;return p(),g("div",{key:R.id||v,class:se(["agent-execution-item",d(R.status)])},[s("div",{class:"agent-header",onClick:M=>i(R)},[s("div",Ih,[k(r(C),{icon:y(R.status),class:"agent-status-icon"},null,8,["icon"]),s("div",Ah,[s("div",xh,c(R.agentName||S.$t("chat.unknownAgent")),1),s("pre",Dh,c(R.agentRequest),1)])]),s("div",Fh,[s("div",{class:se(["agent-status-badge",d(R.status)])},c(m(R.status)),3),k(r(C),{icon:"carbon:arrow-right",class:"step-select-icon"})])],8,Rh),s("div",Mh,[R.result?(p(),g("div",Uh,[s("div",Nh,[k(r(C),{icon:"carbon:checkmark",class:"result-icon"}),s("span",Lh,c(S.$t("chat.agentResult"))+":",1)]),s("pre",Bh,c(R.result),1)])):V("",!0),R.errorMessage?(p(),g("div",Oh,[s("div",qh,[k(r(C),{icon:"carbon:warning",class:"error-icon"}),s("span",Vh,c(S.$t("chat.errorMessage"))+":",1)]),s("pre",jh,c(R.errorMessage),1)])):V("",!0)]),(P=R.subPlanExecutionRecords)!=null&&P.length?(p(),g("div",Hh,[s("div",Gh,[k(r(C),{icon:"carbon:tree-view",class:"sub-plans-icon"}),s("span",Wh,c(S.$t("chat.subPlanExecutions"))+" ("+c(R.subPlanExecutionRecords.length)+") ",1)]),s("div",zh,[(p(!0),g(oe,null,ae(R.subPlanExecutionRecords,(M,W)=>(p(),ne(fh,{key:M.currentPlanId||W,"sub-plan":M,"sub-plan-index":W,"nesting-level":0,"max-nesting-depth":3,"max-visible-steps":2,onSubPlanSelected:F,onStepSelected:B},null,8,["sub-plan","sub-plan-index"]))),128))])])):V("",!0)],2)}),128))])):V("",!0)])}}}),Fs=de(Jh,[["__scopeId","data-v-7d199533"]]),Kh={key:0,class:"thinking-section"},Xh={class:"thinking-header"},Qh={class:"thinking-avatar"},Yh={class:"thinking-label"},Zh={class:"thinking-content"},em={key:0,class:"thinking"},tm={key:2,class:"default-processing"},sm={class:"processing-indicator"},om=ce({__name:"ThinkingSection",props:{thinking:{},thinkingDetails:{},planExecution:{},stepActions:{},genericInput:{},hasContent:{type:Boolean}},emits:["agent-selected","sub-plan-selected","user-input-submitted","step-selected"],setup(n,{emit:e}){const t=n,o=e,a=le(()=>{var d,m,y,F;return t.thinking||(((m=(d=t.thinkingDetails)==null?void 0:d.agentExecutionSequence)==null?void 0:m.length)??0)>0||(((F=(y=t.planExecution)==null?void 0:y.agentExecutionSequence)==null?void 0:F.length)??0)>0}),l=(d,m)=>{o("agent-selected",d,m)},i=(d,m,y)=>{o("sub-plan-selected",d,m,y)},u=d=>{o("user-input-submitted",d)},f=d=>{o("step-selected",d)};return(d,m)=>a.value?(p(),g("div",Kh,[s("div",Xh,[s("div",Qh,[k(r(C),{icon:"carbon:thinking",class:"thinking-icon"})]),s("div",Yh,c(d.$t("chat.thinkingLabel")),1)]),s("div",Zh,[d.thinking?(p(),g("div",em,[k(r(C),{icon:"carbon:thinking",class:"thinking-icon"}),s("span",null,c(d.thinking),1)])):V("",!0),d.thinkingDetails||d.planExecution?(p(),ne(Fs,{key:1,"plan-execution":d.thinkingDetails||d.planExecution,"step-actions":d.stepActions||[],"generic-input":d.genericInput||"",onAgentSelected:l,onSubPlanSelected:i,onUserInputSubmitted:u,onStepSelected:f},null,8,["plan-execution","step-actions","generic-input"])):!d.hasContent&&d.thinking?(p(),g("div",tm,[s("div",sm,[m[0]||(m[0]=s("div",{class:"thinking-dots"},[s("span"),s("span"),s("span")],-1)),s("span",null,c(d.thinking||d.$t("chat.thinkingProcessing")),1)])])):V("",!0)])])):V("",!0)}}),nm=de(om,[["__scopeId","data-v-c341487f"]]);class yt{static async getDetails(e){try{const t=await fetch(`${this.BASE_URL}/details/${e}`);if(t.status===404)return null;if(!t.ok){const l=await t.text();throw new Error(`Failed to get detailed information: ${t.status} - ${l}`)}const o=await t.text(),a=JSON.parse(o);return a&&typeof a=="object"&&!a.currentPlanId&&(a.currentPlanId=e),a}catch(t){return console.error("[CommonApiService] Failed to get plan details:",t),null}}static async submitFormInput(e,t){const o=await fetch(`${this.BASE_URL}/submit-input/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!o.ok){let l;try{l=await o.json()}catch{l={message:`Failed to submit form input: ${o.status}`}}throw new Error(l.message||`Failed to submit form input: ${o.status}`)}const a=o.headers.get("content-type");return a&&a.indexOf("application/json")!==-1?await o.json():{success:!0}}static async getAllPrompts(){try{const e=await fetch(this.BASE_URL);return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get Prompt list:",e),e}}static async handleResponse(e){if(!e.ok)try{const t=await e.json();throw new Error(t.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}}me(yt,"BASE_URL","/api/executor");const am={class:"user-input-form-container"},lm={class:"user-input-header"},rm={class:"user-input-title"},im={class:"user-input-message"},cm={key:0,class:"form-description"},dm={key:0,class:"form-grid"},um=["for"],pm=["id","name","placeholder","required","onUpdate:modelValue"],hm=["id","name","placeholder","required","onUpdate:modelValue"],mm=["id","name","placeholder","required","onUpdate:modelValue"],fm=["id","name","placeholder","required","onUpdate:modelValue"],vm=["id","name","placeholder","required","onUpdate:modelValue"],gm=["id","name","required","onUpdate:modelValue"],bm={value:""},ym=["value"],_m={key:6,class:"checkbox-group"},$m=["id","name","value","onUpdate:modelValue"],Sm={class:"checkbox-label"},wm={key:7,class:"radio-group"},km=["id","name","value","onUpdate:modelValue"],Tm={class:"radio-label"},Pm=["id","name","placeholder","required","onUpdate:modelValue"],Cm={key:1,class:"form-group"},Em={for:"form-input-genericInput"},Rm={type:"submit",class:"submit-user-input-btn"},Im=ce({__name:"UserInputForm",props:{userInputWaitState:{},planId:{},genericInput:{}},emits:["user-input-submitted"],setup(n,{emit:e}){const t=n,o=e;we();const a=st({}),l=U(t.genericInput||""),i=U(!1),u=U(null),f=()=>{var B;const F=(B=t.userInputWaitState)==null?void 0:B.formInputs;F&&F.length>0&&(!i.value||Object.keys(a).length!==F.length)&&(F.forEach((S,_)=>{(!(_ in a)||S.type==="checkbox"&&!Array.isArray(a[_])||S.type!=="checkbox"&&a[_]==="")&&(S.type==="checkbox"?a[_]=[]:a[_]="")}),i.value=!0)};Se(()=>{f()}),ie(()=>{var F;return(F=t.userInputWaitState)==null?void 0:F.formInputs},()=>{u.value&&clearTimeout(u.value),u.value=setTimeout(()=>{i.value=!1,f()},100)},{deep:!0});const d=async()=>{var F;try{const B={},$=(F=t.userInputWaitState)==null?void 0:F.formInputs;$&&$.length>0?Object.entries(a).forEach(([S,_])=>{const h=parseInt(S,10),T=$[h];if(T){const w=T.label||`input_${S}`;Array.isArray(_)?B[w]=_.join(", "):B[w]=_}}):B.genericInput=l.value,console.log("[UserInputForm] Submitting user input:",B,"for planId:",t.planId),t.planId?(await yt.submitFormInput(t.planId,B),console.log("[UserInputForm] User input submitted successfully")):console.error("[UserInputForm] No planId available for user input submission"),o("user-input-submitted",B)}catch(B){console.error("[UserInputForm] User input submission failed:",B)}},m=F=>F?Array.isArray(F)?F:typeof F=="string"?F.split(",").map(B=>B.trim()).filter(B=>B.length>0):[]:[],y=F=>typeof F=="boolean"?F:typeof F=="string"?F==="true":!1;return $e(()=>{u.value&&clearTimeout(u.value)}),(F,B)=>{var $,S,_,h,T;return p(),g("div",am,[s("div",lm,[k(r(C),{icon:"carbon:user",class:"user-icon"}),s("h4",rm,c(F.$t("chat.userInputRequired")),1)]),s("p",im,c((($=F.userInputWaitState)==null?void 0:$.title)??F.$t("chat.userInput.message")),1),(S=F.userInputWaitState)!=null&&S.formDescription?(p(),g("p",cm,c((_=F.userInputWaitState)==null?void 0:_.formDescription),1)):V("",!0),s("form",{onSubmit:pe(d,["prevent"]),class:"user-input-form"},[(h=F.userInputWaitState)!=null&&h.formInputs&&F.userInputWaitState.formInputs.length>0?(p(),g("div",dm,[(p(!0),g(oe,null,ae((T=F.userInputWaitState)==null?void 0:T.formInputs,(w,R)=>(p(),g("div",{key:R,class:"form-group"},[s("label",{for:`form-input-${w.label.replace(/\W+/g,"_")}`},c(w.label)+c(y(w.required)?" *":"")+": ",9,um),!w.type||w.type==="text"?te((p(),g("input",{key:0,type:"text",id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:y(w.required),"onUpdate:modelValue":v=>a[R]=v,class:"form-input"},null,8,pm)),[[re,a[R]]]):w.type==="email"?te((p(),g("input",{key:1,type:"email",id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:y(w.required),"onUpdate:modelValue":v=>a[R]=v,class:"form-input"},null,8,hm)),[[re,a[R]]]):w.type==="number"?te((p(),g("input",{key:2,type:"number",id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:y(w.required),"onUpdate:modelValue":v=>a[R]=v,class:"form-input"},null,8,mm)),[[re,a[R]]]):w.type==="password"?te((p(),g("input",{key:3,type:"password",id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:y(w.required),"onUpdate:modelValue":v=>a[R]=v,class:"form-input"},null,8,fm)),[[re,a[R]]]):w.type==="textarea"?te((p(),g("textarea",{key:4,id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:y(w.required),"onUpdate:modelValue":v=>a[R]=v,class:"form-input form-textarea",rows:"4"},null,8,vm)),[[re,a[R]]]):w.type==="select"&&w.options?te((p(),g("select",{key:5,id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,required:y(w.required),"onUpdate:modelValue":v=>a[R]=v,class:"form-input form-select"},[s("option",bm,c(F.$t("selectCommon.pleaseSelect")),1),(p(!0),g(oe,null,ae(m(w.options),v=>(p(),g("option",{key:v,value:v},c(v),9,ym))),128))],8,gm)),[[ot,a[R]]]):w.type==="checkbox"&&w.options?(p(),g("div",_m,[(p(!0),g(oe,null,ae(m(w.options),v=>(p(),g("label",{key:v,class:"checkbox-item"},[te(s("input",{type:"checkbox",id:`form-input-${w.label.replace(/\W+/g,"_")}-${v.replace(/\W+/g,"_")}`,name:w.label,value:v,"onUpdate:modelValue":P=>a[R]=P,class:"form-checkbox"},null,8,$m),[[wt,a[R]]]),s("span",Sm,c(v),1)]))),128))])):w.type==="radio"&&w.options?(p(),g("div",wm,[(p(!0),g(oe,null,ae(m(w.options),v=>(p(),g("label",{key:v,class:"radio-item"},[te(s("input",{type:"radio",id:`form-input-${w.label.replace(/\W+/g,"_")}-${v.replace(/\W+/g,"_")}`,name:w.label,value:v,"onUpdate:modelValue":P=>a[R]=P,class:"form-radio"},null,8,km),[[Ls,a[R]]]),s("span",Tm,c(v),1)]))),128))])):te((p(),g("input",{key:8,type:"text",id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:y(w.required),"onUpdate:modelValue":v=>a[R]=v,class:"form-input"},null,8,Pm)),[[re,a[R]]])]))),128))])):(p(),g("div",Cm,[s("label",Em,c(F.$t("common.input"))+":",1),te(s("input",{type:"text",id:"form-input-genericInput",name:"genericInput","onUpdate:modelValue":B[0]||(B[0]=w=>l.value=w),class:"form-input"},null,512),[[re,l.value]])])),s("button",Rm,c(F.$t("chat.userInput.submit")),1)],32)])}}}),Am=de(Im,[["__scopeId","data-v-043b591c"]]),xm={class:"response-section"},Dm={class:"response-header"},Fm={class:"response-avatar"},Mm={class:"response-name"},Um={key:0,class:"response-timestamp"},Nm={class:"response-content"},Lm={key:1,class:"final-response"},Bm=["innerHTML"],Om={class:"response-actions"},qm=["title"],Vm=["title"],jm={key:2,class:"response-placeholder"},Hm={class:"typing-indicator"},Gm={class:"typing-text"},Wm={key:3,class:"response-error"},zm={class:"error-text"},Jm={key:4,class:"response-empty"},Km={class:"empty-text"},Xm=ce({__name:"ResponseSection",props:{content:{},isStreaming:{type:Boolean},error:{},timestamp:{},userInputWaitState:{},planId:{},genericInput:{}},emits:["copy","regenerate","retry","user-input-submitted"],setup(n,{emit:e}){const t=n,o=e,{formatResponseText:a,formatTimestamp:l}=Ut(),i=async()=>{if(t.content)try{const m=t.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(m),o("copy")}catch(m){console.error("Failed to copy to clipboard:",m)}},u=()=>{o("regenerate")},f=()=>{o("retry")},d=m=>{console.log("[ResponseSection] User input submitted:",m),o("user-input-submitted",m)};return(m,y)=>{var F;return p(),g("div",xm,[s("div",Dm,[s("div",Fm,[k(r(C),{icon:"carbon:bot",class:"bot-icon"})]),s("div",Mm,c(m.$t("chat.botName")),1),m.timestamp?(p(),g("div",Um,c(r(l)(m.timestamp)),1)):V("",!0)]),s("div",Nm,[(F=m.userInputWaitState)!=null&&F.waiting?(p(),ne(Am,ts({key:0,"user-input-wait-state":m.userInputWaitState},m.planId?{"plan-id":m.planId}:{},{"generic-input":m.genericInput??"",onUserInputSubmitted:d}),null,16,["user-input-wait-state","generic-input"])):V("",!0),m.content?(p(),g("div",Lm,[s("div",{class:"response-text",innerHTML:r(a)(m.content)},null,8,Bm),s("div",Om,[s("button",{class:"action-btn copy-btn",onClick:i,title:m.$t("chat.copyResponse")},[k(r(C),{icon:"carbon:copy"})],8,qm),s("button",{class:"action-btn regenerate-btn",onClick:u,title:m.$t("chat.regenerateResponse")},[k(r(C),{icon:"carbon:renew"})],8,Vm)])])):m.isStreaming?(p(),g("div",jm,[s("div",Hm,[y[0]||(y[0]=s("div",{class:"typing-dots"},[s("span"),s("span"),s("span")],-1)),s("span",Gm,c(m.$t("chat.thinkingResponse")),1)])])):m.error?(p(),g("div",Wm,[k(r(C),{icon:"carbon:warning",class:"error-icon"}),s("span",zm,c(m.error),1),s("button",{class:"retry-btn",onClick:f},c(m.$t("chat.retry")),1)])):(p(),g("div",Jm,[s("span",Km,c(m.$t("chat.waitingForResponse")),1)]))])])}}}),Qm=de(Xm,[["__scopeId","data-v-6581a34f"]]),Ym={class:"assistant-message"},Zm=ce({__name:"AssistantMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(n,{emit:e}){const t=n,o=e,a=()=>{o("copy",t.message.id)},l=()=>{o("regenerate",t.message.id)},i=()=>{o("retry",t.message.id)},u=(d,m)=>{console.log("[AssistantMessage] User input submitted:",m,"for message:",d.id)},f=d=>{console.log("[AssistantMessage] Step selected:",d),o("step-selected",d)};return(d,m)=>{var y,F,B,$;return p(),g("div",Ym,[d.message.thinkingDetails?(p(),ne(nm,{key:0,"thinking-details":d.message.thinkingDetails,onStepSelected:f},null,8,["thinking-details"])):V("",!0),d.message.planExecution?(p(),ne(Fs,{key:1,"plan-execution":d.message.planExecution,"step-actions":d.message.stepActions||[],"generic-input":d.message.genericInput||"",onStepSelected:f},null,8,["plan-execution","step-actions","generic-input"])):V("",!0),d.message.content||d.message.error||d.isStreaming||(F=(y=d.message.planExecution)==null?void 0:y.userInputWaitState)!=null&&F.waiting?(p(),ne(Qm,ts({key:2,content:d.message.content||"","is-streaming":d.isStreaming||!1},{...d.message.error?{error:d.message.error}:{},...(B=d.message.planExecution)!=null&&B.userInputWaitState?{userInputWaitState:d.message.planExecution.userInputWaitState}:{},...($=d.message.planExecution)!=null&&$.currentPlanId?{planId:d.message.planExecution.currentPlanId}:{}},{timestamp:d.message.timestamp,"generic-input":d.message.genericInput||"",onCopy:a,onRegenerate:l,onRetry:i,onUserInputSubmitted:m[0]||(m[0]=S=>u(d.message,S))}),null,16,["content","is-streaming","timestamp","generic-input"])):V("",!0)])}}}),ef=de(Zm,[["__scopeId","data-v-3810c279"]]),tf=ce({__name:"ChatMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(n,{emit:e}){const t=n,o=e,{getMessageClasses:a}=Ut(),l=le(()=>a(t.message)),i=m=>{o("copy",m)},u=m=>{o("regenerate",m)},f=m=>{o("retry",m)},d=m=>{o("step-selected",m)};return(m,y)=>(p(),g("div",{class:se(["chat-message",l.value])},[m.message.type==="user"?(p(),ne(Sp,{key:0,message:m.message},null,8,["message"])):m.message.type==="assistant"?(p(),ne(ef,{key:1,message:m.message,"is-streaming":m.isStreaming||!1,onCopy:i,onRegenerate:u,onRetry:f,onStepSelected:d},null,8,["message","is-streaming"])):V("",!0)],2))}}),sf=de(tf,[["__scopeId","data-v-218b3735"]]);function It(n){const e={...n};return"agentExecutionSequence"in n&&Array.isArray(n.agentExecutionSequence)&&(e.agentExecutionSequence=n.agentExecutionSequence.map(t=>of(t))),e}function of(n){const e={...n};return"subPlanExecutionRecords"in n&&Array.isArray(n.subPlanExecutionRecords)&&(e.subPlanExecutionRecords=n.subPlanExecutionRecords.map(t=>It(t))),e}function nf(n){const e={...n};return"thinkingDetails"in n&&n.thinkingDetails&&(e.thinkingDetails=It(n.thinkingDetails)),"planExecution"in n&&n.planExecution&&(e.planExecution=It(n.planExecution)),"attachments"in n&&Array.isArray(n.attachments)&&(e.attachments=[...n.attachments]),e}function af(){const n=U([]),e=U(!1),t=U(null),o=U(null),a=le(()=>n.value.length>0?n.value[n.value.length-1]:null),l=le(()=>t.value!==null),i=le(()=>n.value.length>0),u=(R,v,P)=>{const M={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:R,content:v,timestamp:new Date,isStreaming:!1,...P};return n.value.push(M),M},f=(R,v)=>{const P=n.value.findIndex(M=>M.id===R);P!==-1&&(n.value[P]={...n.value[P],...v})},d=R=>{const v=n.value.findIndex(P=>P.id===R);v!==-1&&n.value.splice(v,1)},m=()=>{n.value=[],t.value=null,o.value=null},y=R=>{t.value=R,f(R,{isStreaming:!0})},F=R=>{R&&f(R,{isStreaming:!1}),t.value===R&&(t.value=null)},B=R=>{o.value=R},$=(R,v,P="content")=>{const M=n.value.find(W=>W.id===R);M&&typeof M[P]=="string"&&f(R,{[P]:M[P]+v})},S=(R,v)=>{f(R,{thinkingDetails:v})},_=(R,v)=>{f(R,{thinking:v})},h=(R,v)=>{f(R,{planExecution:v})},T=R=>n.value.find(v=>v.id===R),w=R=>n.value.findIndex(v=>v.id===R);return{messages:Ze(n),isLoading:e,streamingMessageId:Ze(t),activeMessageId:Ze(o),lastMessage:a,isStreaming:l,hasMessages:i,addMessage:u,updateMessage:f,removeMessage:d,clearMessages:m,startStreaming:y,stopStreaming:F,setActiveMessage:B,appendToMessage:$,updateMessageThinking:_,updateMessageThinkingDetails:S,updateMessagePlanExecution:h,findMessage:T,getMessageIndex:w}}function lf(n){const e=U(!1),t=U(!0),o=150,a=async(_=!0)=>{n.value&&(await be(),n.value.scrollTo({top:n.value.scrollHeight,behavior:_?"smooth":"auto"}))},l=()=>{if(!n.value)return!1;const{scrollTop:_,scrollHeight:h,clientHeight:T}=n.value;return h-_-T<o},i=()=>{if(!n.value)return;const _=l();e.value=!_&&n.value.scrollHeight>n.value.clientHeight,_&&(t.value=!0)},u=()=>{i(),l()||(t.value=!1)},f=async()=>{t.value&&await a()},d=async()=>{t.value=!0,await a()},m=(_,h=!0)=>{if(!n.value)return;const T=n.value.querySelector(`[data-message-id="${_}"]`);T&&T.scrollIntoView({behavior:h?"smooth":"auto",block:"center"})},y=()=>{if(!n.value)return{scrollTop:0,scrollHeight:0,clientHeight:0,isAtTop:!0,isAtBottom:!0,scrollPercentage:0};const{scrollTop:_,scrollHeight:h,clientHeight:T}=n.value,w=_===0,R=_+T>=h-5,v=h>T?_/(h-T)*100:100;return{scrollTop:_,scrollHeight:h,clientHeight:T,isAtTop:w,isAtBottom:R,scrollPercentage:v}},F=()=>{n.value&&n.value.addEventListener("scroll",u,{passive:!0})},B=()=>{n.value&&n.value.removeEventListener("scroll",u)},$=()=>{F(),i()},S=()=>{B()};return Se(()=>{be(()=>{$()})}),$e(()=>{S()}),{showScrollToBottom:Ze(e),isAutoScrollEnabled:Ze(t),scrollToBottom:a,autoScrollToBottom:f,forceScrollToBottom:d,scrollToMessage:m,isNearBottom:l,checkScrollPosition:i,getScrollInfo:y,addScrollListener:F,removeScrollListener:B,initializeScrollBehavior:$,cleanupScrollBehavior:S}}class Nt{static async sendMessage(e){return Lt.withLlmCheck(async()=>{const t={...e,isVueRequest:!0},o=await fetch(`${this.BASE_URL}/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!o.ok)throw new Error(`API request failed: ${o.status}`);return await o.json()})}static async sendMessageWithDefaultPlan(e){return Lt.withLlmCheck(async()=>{const t="default-plan-id-001000222",o={userRequirement:e.input},a={toolName:t,replacementParams:o,isVueRequest:!0};e.uploadedFiles&&e.uploadedFiles.length>0&&(a.uploadedFiles=e.uploadedFiles,console.log("[DirectApiService] Including uploaded files:",e.uploadedFiles.length)),e.uploadKey&&(a.uploadKey=e.uploadKey,console.log("[DirectApiService] Including uploadKey:",e.uploadKey)),console.log("[DirectApiService] Sending message with default plan:",a);const l=await fetch(`${this.BASE_URL}/executeByToolNameAsync`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!l.ok)throw new Error(`API request failed: ${l.status}`);return await l.json()})}}me(Nt,"BASE_URL","/api/executor");const rf=Object.freeze(Object.defineProperty({__proto__:null,DirectApiService:Nt},Symbol.toStringTag,{value:"Module"})),Fe=class Fe{constructor(){me(this,"POLL_INTERVAL",5e3);me(this,"state",st({activePlanId:null,lastSequenceSize:0,isPolling:!1,pollTimer:null}));me(this,"callbacks",{});me(this,"planExecutionCache",new Map);me(this,"uiStateCache",new Map);console.log("[PlanExecutionManager] Initialized with callback-based event system")}getCachedPlanRecord(e){return this.planExecutionCache.get(e)}getCachedUIState(e){return this.uiStateCache.get(e)}setCachedUIState(e,t){this.uiStateCache.set(e,t),console.log(`[PlanExecutionManager] Cached UI state for rootPlanId: ${e}`)}getAllCachedRecords(){return new Map(this.planExecutionCache)}hasCachedPlanRecord(e){return this.planExecutionCache.has(e)}setCachedPlanRecord(e,t){this.planExecutionCache.set(e,t),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${e}`)}clearCachedPlanRecord(e){const t=this.planExecutionCache.delete(e);return t&&console.log(`[PlanExecutionManager] Cleared cached plan execution record for rootPlanId: ${e}`),t}clearAllCachedRecords(){const e=this.planExecutionCache.size,t=this.uiStateCache.size;this.planExecutionCache.clear(),this.uiStateCache.clear(),console.log(`[PlanExecutionManager] Cleared all caches - Plans: ${e}, UI States: ${t}`)}static getInstance(){return Fe.instance||(Fe.instance=new Fe),Fe.instance}getActivePlanId(){return this.state.activePlanId}getState(){return this.state}setEventCallbacks(e){this.callbacks={...this.callbacks,...e},console.log("[PlanExecutionManager] Event callbacks set:",Object.keys(e))}async handleUserMessageSendRequested(e){if(this.validateAndPrepareUIForNewRequest(e))try{if(await this.sendUserMessageAndSetPlanId(e),this.state.activePlanId)this.initiatePlanExecutionSequence(e,this.state.activePlanId);else throw new Error("Failed to get valid plan ID")}catch(t){console.error("[PlanExecutionManager] Failed to send user message:",t);const o=this.state.activePlanId??"error";this.setCachedUIState(o,{enabled:!0}),this.emitChatInputUpdateState(o),this.state.activePlanId=null}}handlePlanExecutionRequested(e,t){console.log("[PlanExecutionManager] Received plan execution request:",{planId:e,query:t}),e?(this.state.activePlanId=e,this.initiatePlanExecutionSequence(t??"Execute Plan",e)):console.error("[PlanExecutionManager] Invalid plan execution request: missing planId")}handleCachedPlanExecution(e,t){const o=this.getCachedPlanRecord(e);return o!=null&&o.currentPlanId?(console.log(`[PlanExecutionManager] Found cached plan execution record for rootPlanId: ${e}`),this.handlePlanExecutionRequested(o.currentPlanId,t),!0):(console.log(`[PlanExecutionManager] No cached plan execution record found for rootPlanId: ${e}`),!1)}validateAndPrepareUIForNewRequest(e){if(!e)return console.warn("[PlanExecutionManager] Query is empty"),!1;if(this.state.activePlanId)return!1;this.emitChatInputClear();const t=this.state.activePlanId??"ui-state";return this.setCachedUIState(t,{enabled:!1,placeholder:"Processing..."}),this.emitChatInputUpdateState(t),!0}async sendUserMessageAndSetPlanId(e){try{const t=await Nt.sendMessage({input:e});if(t!=null&&t.planId)return this.state.activePlanId=t.planId,t;if(t!=null&&t.planTemplateId)return this.state.activePlanId=t.planTemplateId,{...t,planId:t.planTemplateId};throw console.error("[PlanExecutionManager] Failed to get planId from response:",t),new Error("Failed to get valid planId from API response")}catch(t){throw console.error("[PlanExecutionManager] API call failed:",t),t}}initiatePlanExecutionSequence(e,t){console.log(`[PlanExecutionManager] Starting plan execution sequence for query: "${e}", planId: ${t}`);const o=t;this.emitDialogRoundStart(o),this.startPolling()}handlePlanCompletion(e){this.emitPlanCompleted(e.rootPlanId??""),this.state.lastSequenceSize=0,this.stopPolling();try{setTimeout(async()=>{if(this.state.activePlanId)try{await et.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}},5e3)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}e.completed&&(this.state.activePlanId=null,this.emitChatInputUpdateState(e.rootPlanId??""))}handlePlanError(e){this.emitPlanError(e.message??""),this.state.lastSequenceSize=0,this.stopPolling();try{setTimeout(async()=>{if(this.state.activePlanId)try{await et.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}},5e3)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}}async pollPlanStatus(){if(this.state.activePlanId){if(this.state.isPolling){console.log("[PlanExecutionManager] Previous polling still in progress, skipping");return}try{this.state.isPolling=!0;const e=await this.getPlanDetails(this.state.activePlanId);if(!e){console.warn("[PlanExecutionManager] No details received from API - this might be a temporary network issue");return}if(e.status&&e.status==="failed"&&e.message&&!e.message.includes("Failed to get detailed information")){this.handlePlanError(e);return}e.rootPlanId&&this.setCachedPlanRecord(e.rootPlanId,e),this.emitPlanUpdate(e.rootPlanId??""),e.completed&&this.handlePlanCompletion(e)}catch(e){console.error("[PlanExecutionManager] Failed to poll plan status:",e)}finally{this.state.isPolling=!1}}}async getPlanDetails(e){try{const t=await yt.getDetails(e);return t!=null&&t.rootPlanId&&(this.planExecutionCache.set(t.rootPlanId,t),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${t.rootPlanId}`)),t}catch(t){return console.error("[PlanExecutionManager] Failed to get plan details:",t),{currentPlanId:e,status:"failed",message:t instanceof Error?t.message:"Failed to get plan"}}}startPolling(){this.state.pollTimer&&clearInterval(this.state.pollTimer),this.state.pollTimer=window.setInterval(()=>{this.pollPlanStatus()},this.POLL_INTERVAL),console.log("[PlanExecutionManager] Started polling")}async pollPlanStatusImmediately(){console.log("[PlanExecutionManager] Polling plan status immediately"),await this.pollPlanStatus()}stopPolling(){this.state.pollTimer&&(clearInterval(this.state.pollTimer),this.state.pollTimer=null),console.log("[PlanExecutionManager] Stopped polling")}cleanup(){this.stopPolling(),this.state.activePlanId=null,this.state.lastSequenceSize=0,this.state.isPolling=!1,this.clearAllCachedRecords()}emitChatInputClear(){this.callbacks.onChatInputClear&&this.callbacks.onChatInputClear()}emitChatInputUpdateState(e){this.callbacks.onChatInputUpdateState&&this.callbacks.onChatInputUpdateState(e)}emitDialogRoundStart(e){this.callbacks.onDialogRoundStart&&this.callbacks.onDialogRoundStart(e)}emitPlanUpdate(e){this.callbacks.onPlanUpdate&&this.callbacks.onPlanUpdate(e)}emitPlanCompleted(e){this.callbacks.onPlanCompleted&&this.callbacks.onPlanCompleted(e)}emitPlanError(e){this.callbacks.onPlanError&&this.callbacks.onPlanError(e)}};me(Fe,"instance",null);let At=Fe;const Ie=At.getInstance(),cf={class:"chat-container"},df={key:0,class:"loading-message"},uf={class:"loading-content"},pf=["title"],hf=ce({__name:"ChatContainer",props:{mode:{default:"plan"},initialPrompt:{default:""}},emits:["step-selected"],setup(n,{expose:e,emit:t}){const o=t,{t:a}=we(),{messages:l,isLoading:i,streamingMessageId:u,addMessage:f,updateMessage:d,startStreaming:m,stopStreaming:y,findMessage:F}=af(),B=U(null),{scrollToBottom:$,autoScrollToBottom:S,showScrollToBottom:_}=lf(B),h=U(),T=D=>u.value===D,w=le(()=>l.value.map(nf)),R=()=>{},v=D=>{const J=D.target;if(J.classList.contains("md-copy-btn")){const X=J.getAttribute("data-raw");if(X){const L=decodeURIComponent(X);navigator.clipboard.writeText(L).then(()=>{J.textContent=a("chat.copied"),setTimeout(()=>{J.textContent=a("chat.copy")},1e3)})}}},P=async D=>{const J=F(D);if(J)try{const X=J.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(X)}catch(X){console.error("Failed to copy message:",X)}},M=D=>{const J=F(D);J&&J.type==="assistant"&&(d(D,{content:""}),m(D))},W=D=>{F(D)&&(d(D,{content:""}),m(D))},E=D=>{console.log("[ChatContainer] Step selected:",D),o("step-selected",D)},A=D=>{console.log("[ChatContainer] Plan update received:",D);const J=Ie.getCachedPlanRecord(D);if(!J){console.warn("[ChatContainer] No cached plan data found for rootPlanId:",D);return}console.log("[ChatContainer] Retrieved plan details from cache:",J);const X=l.value.findIndex(L=>{var N;return((N=L.planExecution)==null?void 0:N.currentPlanId)===J.currentPlanId&&L.type==="assistant"});if(X!==-1){const L=l.value[X],N={planExecution:JSON.parse(JSON.stringify(J))};if(!J.agentExecutionSequence||J.agentExecutionSequence.length===0){if(console.log("[ChatContainer] Handling simple response without agent execution sequence"),J.completed){N.thinking="";const Q=J.summary??J.result??J.message??"Execution completed";N.content=Q,console.log("[ChatContainer] Set simple response content:",Q)}}else console.log("[ChatContainer] Handling detailed plan with agent execution sequence");d(L.id,N)}},x=D=>{if(console.log("[ChatContainer] Plan completed:",D),D.rootPlanId){const J=l.value.findIndex(X=>{var L;return((L=X.planExecution)==null?void 0:L.currentPlanId)===D.rootPlanId});if(J!==-1){const X=l.value[J],L=D.summary??D.result??"Execution completed";d(X.id,{thinking:"",content:L}),console.log("[ChatContainer] Updated completed message:",L)}}},q=D=>{console.log("[ChatContainer] Dialog round start:",D)},b=D=>{console.log("[ChatContainer] Plan error:",D),f("assistant",`Error: ${D}`),console.error("[ChatContainer] Plan execution error:",D)};return Se(()=>{ie(l,()=>{be(()=>{S()})},{deep:!0}),Ie.setEventCallbacks({onPlanUpdate:A,onPlanCompleted:x,onDialogRoundStart:q,onPlanError:b})}),$e(()=>{h.value&&clearInterval(h.value)}),e({scrollToBottom:$,handlePlanUpdate:A,handlePlanCompleted:x,handleDialogRoundStart:q,handlePlanError:b,addMessage:f,updateMessage:d,startStreaming:m,stopStreaming:y}),(D,J)=>(p(),g("div",cf,[s("div",{class:"messages",ref_key:"messagesRef",ref:B,onScroll:R,onClick:v},[(p(!0),g(oe,null,ae(w.value,X=>(p(),ne(sf,{key:X.id,message:X,"is-streaming":T(X.id),onCopy:P,onRegenerate:M,onRetry:W,onStepSelected:E},null,8,["message","is-streaming"]))),128)),r(i)?(p(),g("div",df,[s("div",uf,[k(r(C),{icon:"carbon:circle-dash",class:"loading-icon"}),s("span",null,c(D.$t("chat.processing")),1)])])):V("",!0)],544),k(Ue,{name:"scroll-button"},{default:Ee(()=>[r(_)?(p(),g("button",{key:0,class:"scroll-to-bottom",onClick:J[0]||(J[0]=()=>r($)()),title:D.$t("chat.scrollToBottom")},[k(r(C),{icon:"carbon:chevron-down"})],8,pf)):V("",!0)]),_:1})]))}}),mf=de(hf,[["__scopeId","data-v-e7a5d6c9"]]),ff={class:"input-area"},vf={class:"input-container"},gf=["placeholder","disabled"],bf=["title"],yf=["disabled","title"],_f=ce({__name:"InputArea",props:{placeholder:{default:""},disabled:{type:Boolean,default:!1},initialValue:{default:""}},emits:["send","clear","update-state","plan-mode-clicked"],setup(n,{expose:e,emit:t}){const{t:o}=we(),a=n,l=t,i=U(),u=U(),f=U(""),d=le(()=>a.placeholder||o("input.placeholder")),m=U(d.value),y=U([]),F=U(null),B=()=>{var b;console.log("[FileUpload] Resetting session and clearing uploadKey"),(b=u.value)==null||b.resetSession()};$e(()=>{B()});const $=(b,D)=>{y.value=b.map(J=>J.originalName),F.value=D,console.log("[InputArea] Files uploaded:",b.length,"uploadKey:",D),y.value.length>0&&(m.value=o("input.filesAttached",{count:y.value.length}))},S=b=>{y.value=b.map(D=>D.originalName),console.log("[InputArea] Files removed, remaining:",b.length),y.value.length===0?m.value=d.value:m.value=o("input.filesAttached",{count:y.value.length})},_=b=>{F.value=b,console.log("[InputArea] Upload key changed:",b)},h=()=>{console.log("[InputArea] Upload started")},T=()=>{console.log("[InputArea] Upload completed")},w=b=>{console.error("[InputArea] Upload error:",b)},R=le(()=>!!a.disabled),v=()=>{be(()=>{i.value&&(i.value.style.height="auto",i.value.style.height=Math.min(i.value.scrollHeight,120)+"px")})},P=b=>{b.key==="Enter"&&!b.shiftKey&&(b.preventDefault(),M())},M=()=>{if(!f.value.trim()||R.value)return;const D={input:f.value.trim(),memoryId:xe.selectMemoryId,uploadedFiles:y.value};F.value?(D.uploadKey=F.value,console.log("[InputArea] Including uploadKey in message:",F.value)):console.log("[InputArea] No uploadKey available for message"),l("send",D),E()},W=()=>{l("plan-mode-clicked")},E=()=>{f.value="",v(),l("clear")},A=(b,D)=>{D&&(m.value=b?D:o("input.waiting")),l("update-state",b,D)},x=b=>{f.value=b,v()},q=()=>f.value.trim();return ie(()=>a.initialValue,b=>{b&&b.trim()&&(f.value=b,v())},{immediate:!0}),e({clearInput:E,updateState:A,setInputValue:x,getQuery:q,resetSession:B,focus:()=>{var b;return(b=i.value)==null?void 0:b.focus()},get uploadedFiles(){var b,D;return((D=(b=u.value)==null?void 0:b.uploadedFiles)==null?void 0:D.map(J=>J.originalName))||[]},get uploadKey(){var b;return((b=u.value)==null?void 0:b.uploadKey)||null}}),Se(()=>{}),$e(()=>{}),(b,D)=>(p(),g("div",ff,[k(xs,{ref_key:"fileUploadRef",ref:u,disabled:R.value,onFilesUploaded:$,onFilesRemoved:S,onUploadKeyChanged:_,onUploadStarted:h,onUploadCompleted:T,onUploadError:w},null,8,["disabled"]),s("div",vf,[te(s("textarea",{"onUpdate:modelValue":D[0]||(D[0]=J=>f.value=J),ref_key:"inputRef",ref:i,class:"chat-input",placeholder:m.value,disabled:R.value,onKeydown:P,onInput:v},null,40,gf),[[re,f.value]]),s("button",{class:"plan-mode-btn",title:b.$t("input.planMode"),onClick:W},[k(r(C),{icon:"carbon:document"}),ee(" "+c(b.$t("input.planMode")),1)],8,bf),s("button",{class:"send-button",disabled:!f.value.trim()||R.value,onClick:M,title:b.$t("input.send")},[k(r(C),{icon:"carbon:send-alt"}),ee(" "+c(b.$t("input.send")),1)],8,yf)])]))}}),$f=de(_f,[["__scopeId","data-v-dbfe7de6"]]);class Be{static async getAllCronTasks(){try{const e=await fetch(this.BASE_URL);return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get cron tasks:",e),e}}static async getCronTaskById(e){try{const t=await fetch(`${this.BASE_URL}/${e}`);return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to get cron task by id:",t),t}}static async createCronTask(e){try{const t=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to create cron task:",t),t}}static async updateCronTask(e,t){try{const o=await fetch(`${this.BASE_URL}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await(await this.handleResponse(o)).json()}catch(o){throw console.error("Failed to update cron task:",o),o}}static async updateTaskStatus(e,t){try{const o=await fetch(`${this.BASE_URL}/${e}/status?status=${t}`,{method:"PUT"});await this.handleResponse(o)}catch(o){throw console.error("Failed to update task status:",o),o}}static async deleteCronTask(e){try{const t=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE"});await this.handleResponse(t)}catch(t){throw console.error("Failed to delete cron task:",t),t}}static async handleResponse(e){if(!e.ok)try{const t=await e.json();throw new Error(t.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}}me(Be,"BASE_URL","/api/cron-tasks");const Oe={validateCronExpression(n){const e=n.trim().split(/\s+/);return e.length>=5&&e.length<=6},formatTime(n){return new Date(n).toLocaleString()},async saveTask(n){try{let e;return n.id?e=await Be.updateCronTask(Number(n.id),n):e=await Be.createCronTask(n),e}catch(e){throw console.error("Failed to save cron task:",e),e}},async deleteTask(n){try{await Be.deleteCronTask(String(n))}catch(e){throw console.error("Failed to delete cron task:",e),e}},async toggleTaskStatus(n){if(!n.id)throw new Error("Task ID is required");const e=n.status===0?1:0;return await Be.updateCronTask(Number(n.id),{...n,status:e})},prepareTaskExecution(n){return n.planTemplateId?{useTemplate:!0,planData:{title:n.cronName||"Scheduled Task Execution",planData:{id:n.planTemplateId,planTemplateId:n.planTemplateId,planId:n.planTemplateId},params:n.executionParams||void 0}}:{useTemplate:!1,taskContent:n.planDesc||n.cronName||""}}},Sf={class:"modal-header"},wf={class:"header-actions"},kf={class:"status-switch"},Tf={class:"status-label"},Pf={class:"toggle-switch"},Cf=["checked"],Ef={class:"modal-content"},Rf={class:"form-group"},If={class:"form-label"},Af=["placeholder"],xf={class:"form-group"},Df={class:"form-label"},Ff=["placeholder"],Mf={class:"form-help"},Uf={class:"form-group"},Nf={class:"form-label"},Lf=["placeholder"],Bf={class:"form-group"},Of={class:"form-label"},qf={class:"template-toggle"},Vf={key:0,class:"template-selector"},jf={value:""},Hf=["value"],Gf={class:"form-help"},Wf={key:0,class:"form-group"},zf={class:"time-info"},Jf={class:"time-label"},Kf={class:"time-value"},Xf={key:1,class:"form-group"},Qf={class:"time-info"},Yf={class:"time-label"},Zf={class:"time-value"},ev={class:"modal-footer"},tv=["disabled"],sv=ce({__name:"TaskDetailModal",props:{modelValue:{type:Boolean},task:{}},emits:["update:modelValue","save"],setup(n,{emit:e}){const t=n,o=e,a=U(!1),l=U([]),i=U({cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""}),u=async()=>{try{const $=await et.getAllPlanTemplates();$!=null&&$.templates&&(l.value=$.templates.map(S=>({id:S.id,name:S.title||"Unnamed Template"})))}catch($){console.error("Failed to get template list:",$)}},f=$=>{$.key==="Escape"&&t.modelValue&&o("update:modelValue",!1)};Se(()=>{u(),document.addEventListener("keydown",f)}),$e(()=>{document.removeEventListener("keydown",f)});const d=$=>{$.target===$.currentTarget&&o("update:modelValue",!1)},m=()=>{i.value.linkTemplate=!1,i.value.templateId="",i.value.planTemplateId=""},y=()=>i.value.cronName.trim()?i.value.cronTime.trim()?Oe.validateCronExpression(i.value.cronTime)?i.value.planDesc.trim()?i.value.linkTemplate&&!i.value.templateId?(alert("Please select a plan template"),!1):!0:(alert("Task description cannot be empty"),!1):(alert("Invalid Cron expression format, should be 5-6 parts separated by spaces"),!1):(alert("Cron expression cannot be empty"),!1):(alert("Task name cannot be empty"),!1),F=$=>Oe.formatTime($),B=async()=>{var $;if(y()){a.value=!0;try{const S={...i.value,...(($=t.task)==null?void 0:$.id)!==void 0&&{id:t.task.id},cronName:i.value.cronName.trim(),cronTime:i.value.cronTime.trim(),planDesc:i.value.planDesc.trim(),status:i.value.status,planTemplateId:i.value.linkTemplate&&i.value.templateId||""};o("save",S)}finally{a.value=!1}}};return ie(()=>t.task,$=>{if($){const S=$.templateId||$.planTemplateId||"";i.value={cronName:$.cronName||"",cronTime:$.cronTime||"",planDesc:$.planDesc||"",status:$.status??1,linkTemplate:!!S,templateId:S,planTemplateId:S}}else i.value={cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""}},{immediate:!0}),ie(()=>t.modelValue,$=>{$||(i.value={cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""})}),($,S)=>(p(),ne(Ye,{to:"body"},[k(Ue,{name:"modal"},{default:Ee(()=>{var _,h,T;return[$.modelValue?(p(),g("div",{key:0,class:"modal-overlay",onClick:d},[s("div",{class:"modal-container",onClick:S[8]||(S[8]=pe(()=>{},["stop"]))},[s("div",Sf,[s("h3",null,c($.$t("cronTask.taskDetail")),1),s("div",wf,[s("div",kf,[s("span",Tf,c($.$t("cronTask.taskStatus")),1),s("label",Pf,[s("input",{type:"checkbox",checked:i.value.status===0,onChange:S[0]||(S[0]=w=>i.value.status=i.value.status===0?1:0)},null,40,Cf),S[9]||(S[9]=s("span",{class:"toggle-slider"},null,-1))])]),s("button",{class:"close-btn",onClick:S[1]||(S[1]=w=>$.$emit("update:modelValue",!1))},[k(r(C),{icon:"carbon:close"})])])]),s("div",Ef,[s("form",{onSubmit:pe(B,["prevent"]),class:"task-form"},[s("div",Rf,[s("label",If,c($.$t("cronTask.taskName")),1),te(s("input",{"onUpdate:modelValue":S[2]||(S[2]=w=>i.value.cronName=w),type:"text",class:"form-input",placeholder:$.$t("cronTask.taskNamePlaceholder"),required:""},null,8,Af),[[re,i.value.cronName]])]),s("div",xf,[s("label",Df,c($.$t("cronTask.cronExpression")),1),te(s("input",{"onUpdate:modelValue":S[3]||(S[3]=w=>i.value.cronTime=w),type:"text",class:"form-input",placeholder:$.$t("cronTask.cronExpressionPlaceholder"),required:""},null,8,Ff),[[re,i.value.cronTime]]),s("div",Mf,c($.$t("cronTask.cronExpressionHelp")),1)]),s("div",Uf,[s("label",Nf,c($.$t("cronTask.taskDescription")),1),te(s("textarea",{"onUpdate:modelValue":S[4]||(S[4]=w=>i.value.planDesc=w),class:"form-textarea",placeholder:$.$t("cronTask.taskDescriptionPlaceholder"),rows:"4",required:""},null,8,Lf),[[re,i.value.planDesc]])]),s("div",Bf,[s("label",Of,c($.$t("cronTask.planTemplate")),1),s("div",qf,[s("button",{type:"button",class:se(["template-btn",i.value.linkTemplate?"active":""]),onClick:S[5]||(S[5]=w=>i.value.linkTemplate=!0)},[k(r(C),{icon:"carbon:checkmark"}),ee(" "+c($.$t("cronTask.linkTemplate")),1)],2),s("button",{type:"button",class:se(["template-btn",i.value.linkTemplate?"":"active"]),onClick:m},[k(r(C),{icon:"carbon:close"}),ee(" "+c($.$t("cronTask.noTemplate")),1)],2)]),i.value.linkTemplate?(p(),g("div",Vf,[te(s("select",{"onUpdate:modelValue":S[6]||(S[6]=w=>i.value.templateId=w),class:"form-select"},[s("option",jf,c($.$t("cronTask.selectTemplate")),1),(p(!0),g(oe,null,ae(l.value,w=>(p(),g("option",{key:w.id,value:w.id},c(w.name),9,Hf))),128))],512),[[ot,i.value.templateId]]),s("div",Gf,c($.$t("cronTask.templateHelpText")),1)])):V("",!0)]),(_=$.task)!=null&&_.createTime?(p(),g("div",Wf,[s("div",zf,[s("span",Jf,c($.$t("cronTask.createTime"))+":",1),s("span",Kf,c(F($.task.createTime)),1)])])):V("",!0),(h=$.task)!=null&&h.updateTime?(p(),g("div",Xf,[s("div",Qf,[s("span",Yf,c($.$t("cronTask.updateTime"))+":",1),s("span",Zf,c(F($.task.updateTime)),1)])])):V("",!0)],32)]),s("div",ev,[s("button",{type:"button",class:"cancel-btn",onClick:S[7]||(S[7]=w=>$.$emit("update:modelValue",!1))},c($.$t("common.cancel")),1),s("button",{type:"button",class:"save-btn",onClick:B,disabled:a.value},[a.value?(p(),ne(r(C),{key:0,icon:"carbon:loading",class:"loading-icon"})):V("",!0),ee(" "+c((T=t.task)!=null&&T.id?$.$t("common.save"):$.$t("common.create")),1)],8,tv)])])])):V("",!0)]}),_:1})]))}}),ov=de(sv,[["__scopeId","data-v-ed323a6e"]]),nv={class:"modal-header"},av={class:"header-actions"},lv={class:"modal-content"},rv={key:0,class:"loading-container"},iv={key:1,class:"empty-container"},cv={key:2,class:"task-list"},dv=["onClick"],uv={class:"task-main"},pv={class:"task-info"},hv={class:"task-header"},mv={class:"task-name"},fv={class:"task-description"},vv={class:"task-time"},gv=["onClick"],bv=["onClick","disabled","title"],yv=["onClick","title"],_v={class:"dropdown-menu"},$v=["onClick"],Sv=["onClick","disabled"],wv=["onClick","disabled"],kv={class:"confirm-header"},Tv={class:"confirm-content"},Pv={class:"confirm-actions"},Cv=["disabled"],Ev={class:"confirm-header"},Rv={class:"confirm-content"},Iv={class:"create-options"},Av={class:"option-content"},xv={class:"option-title"},Dv={class:"option-desc"},Fv={class:"option-content"},Mv={class:"option-title"},Uv={class:"option-desc"},Nv={class:"confirm-actions"},Lv=ce({__name:"CronTaskModal",props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue"],setup(n,{emit:e}){const t=ss(),o=os(),a=as(),{t:l}=we(),i=n,u=e,f=U([]),d=U(!1),m=U(null),y=U(null),F=U(null),B=U(null),$=U(!1),S=U(null),_=U(!1),h=U(null),T=U(!1),w=O=>{O.target===O.currentTarget&&u("update:modelValue",!1)},R=async()=>{d.value=!0;try{f.value=await Be.getAllCronTasks()}catch(O){console.error("Failed to load cron tasks:",O),a.error(`Failed to load tasks: ${O instanceof Error?O.message:String(O)}`)}finally{d.value=!1}},v=async O=>{m.value=O;try{const G=f.value.find(H=>H.id===O);if(!G){console.error("Task not found:",O);return}u("update:modelValue",!1);const Y=Date.now().toString();await t.push({name:"direct",params:{id:Y}}),await new Promise(H=>setTimeout(H,100));const j=Oe.prepareTaskExecution(G);j.useTemplate&&j.planData?o.emitPlanExecutionRequested(j.planData):j.taskContent&&o.setTask(j.taskContent)}catch(G){console.error("Failed to execute task:",G),a.error(`Execution failed: ${G instanceof Error?G.message:String(G)}`)}finally{m.value=null}},P=O=>{S.value={...O},$.value=!0,B.value=null},M=async O=>{try{await Oe.saveTask(O),await R(),$.value=!1,a.success("Task saved successfully")}catch(G){console.error("Failed to save task:",G),a.error(`Save failed: ${G instanceof Error?G.message:String(G)}`)}},W=O=>{h.value=O,_.value=!0},E=async()=>{var O;if((O=h.value)!=null&&O.id){y.value=h.value.id;try{await Oe.deleteTask(h.value.id),await R(),_.value=!1,h.value=null,a.success("Task deleted successfully")}catch(G){console.error("Failed to delete task:",G),a.error(`Delete failed: ${G instanceof Error?G.message:String(G)}`)}finally{y.value=null}}},A=()=>{_.value=!1,h.value=null},x=O=>{B.value=B.value===O?null:O},q=async O=>{if(O.id){F.value=O.id;try{await Oe.toggleTaskStatus(O),await R(),B.value=null,a.success(`Task ${O.status===0?"disabled":"enabled"} successfully`)}catch(G){console.error("Failed to toggle task status:",G),a.error(`Status toggle failed: ${G instanceof Error?G.message:String(G)}`)}finally{F.value=null}}},b=async O=>{try{await navigator.clipboard.writeText(O),a.success("Cron expression copied successfully")}catch(G){a.error(`Copy failed: ${G instanceof Error?G.message:String(G)}`)}},D=()=>{T.value=!0},J=()=>{T.value=!1;try{u("update:modelValue",!1);const O=l("cronTask.template");o.setTaskToInput(O);const G=Date.now().toString();t.push({name:"direct",params:{id:G}})}catch(O){console.error("Error in createWithJmanus:",O),a.error(`Creation failed: ${O instanceof Error?O.message:String(O)}`)}},X=()=>{T.value=!1,S.value={cronName:"",cronTime:"",planDesc:"",status:0,planTemplateId:""},$.value=!0},L=()=>{T.value=!1},N=O=>{const G=O.target;!G.closest(".action-dropdown")&&!G.closest(".dropdown-menu")&&(B.value=null)},Q=O=>{O.key==="Escape"&&(_.value?A():T.value?L():i.modelValue&&u("update:modelValue",!1))};return Se(()=>{document.addEventListener("click",N,!0),document.addEventListener("keydown",Q)}),$e(()=>{document.removeEventListener("click",N,!0),document.removeEventListener("keydown",Q)}),ie(()=>i.modelValue,O=>{O&&R()}),(O,G)=>(p(),g(oe,null,[(p(),ne(Ye,{to:"body"},[k(Ue,{name:"modal"},{default:Ee(()=>[n.modelValue?(p(),g("div",{key:0,class:"modal-overlay",onClick:w},[s("div",{class:"modal-container",onClick:G[3]||(G[3]=pe(()=>{},["stop"]))},[s("div",nv,[s("h3",null,c(O.$t("cronTask.title")),1),s("div",av,[s("button",{class:"add-task-btn",onClick:[D,G[0]||(G[0]=pe(()=>{},["stop"]))]},[k(r(C),{icon:"carbon:add"}),ee(" "+c(O.$t("cronTask.addTask")),1)]),s("button",{class:"close-btn",onClick:G[1]||(G[1]=Y=>O.$emit("update:modelValue",!1))},[k(r(C),{icon:"carbon:close"})])])]),s("div",lv,[d.value?(p(),g("div",rv,[k(r(C),{icon:"carbon:loading",class:"loading-icon"}),s("span",null,c(O.$t("common.loading")),1)])):f.value.length===0?(p(),g("div",iv,[k(r(C),{icon:"carbon:time",class:"empty-icon"}),s("span",null,c(O.$t("cronTask.noTasks")),1)])):(p(),g("div",cv,[(p(!0),g(oe,null,ae(f.value,Y=>(p(),g("div",{key:Y.id||"",class:"task-item",onClick:j=>P(Y)},[s("div",uv,[s("div",pv,[s("div",hv,[s("div",mv,c(Y.cronName),1),s("div",{class:se(["task-status-badge",Y.status===0?"active":"inactive"])},[k(r(C),{icon:Y.status===0?"carbon:checkmark-filled":"carbon:pause-filled"},null,8,["icon"]),s("span",null,c(Y.status===0?O.$t("cronTask.active"):O.$t("cronTask.inactive")),1)],2)]),s("div",fv,c(Y.planDesc),1),s("div",vv,[k(r(C),{icon:"carbon:time"}),s("span",{class:"cron-readable",style:{cursor:"pointer"},onClick:pe(j=>b(Y.cronTime),["stop"])},c(Y.cronTime),9,gv)])])]),s("div",{class:"task-actions",onClick:G[2]||(G[2]=pe(()=>{},["stop"]))},[s("button",{class:"action-btn execute-btn",onClick:j=>v(Y.id),disabled:m.value===Y.id,title:O.$t("cronTask.executeOnce")},[k(r(C),{icon:m.value===Y.id?"carbon:loading":"carbon:play-filled"},null,8,["icon"]),ee(" "+c(O.$t("cronTask.executeOnce")),1)],8,bv),s("div",{class:se(["action-dropdown",{active:B.value===Y.id}])},[s("button",{class:"action-btn dropdown-btn",onClick:j=>x(Y.id),title:O.$t("cronTask.operations")},[k(r(C),{icon:"carbon:overflow-menu-horizontal"}),ee(" "+c(O.$t("cronTask.operations")),1)],8,yv),te(s("div",_v,[s("button",{class:"dropdown-item edit-btn",onClick:j=>P(Y)},[k(r(C),{icon:"carbon:edit"}),ee(" "+c(O.$t("cronTask.edit")),1)],8,$v),s("button",{class:"dropdown-item toggle-btn",onClick:j=>q(Y),disabled:F.value===Y.id},[k(r(C),{icon:F.value===Y.id?"carbon:loading":Y.status===0?"carbon:pause-filled":"carbon:play-filled"},null,8,["icon"]),ee(" "+c(Y.status===0?O.$t("cronTask.disable"):O.$t("cronTask.enable")),1)],8,Sv),s("button",{class:"dropdown-item delete-btn",onClick:j=>W(Y),disabled:y.value===Y.id},[k(r(C),{icon:y.value===Y.id?"carbon:loading":"carbon:trash-can"},null,8,["icon"]),ee(" "+c(O.$t("cronTask.delete")),1)],8,wv)],512),[[Zt,B.value===Y.id]])],2)])],8,dv))),128))]))])])])):V("",!0)]),_:1})])),k(ov,{modelValue:$.value,"onUpdate:modelValue":G[4]||(G[4]=Y=>$.value=Y),task:S.value,onSave:M},null,8,["modelValue","task"]),(p(),ne(Ye,{to:"body"},[k(Ue,{name:"modal"},{default:Ee(()=>{var Y,j,H,K;return[_.value?(p(),g("div",{key:0,class:"modal-overlay",onClick:A},[s("div",{class:"confirm-modal",onClick:G[5]||(G[5]=pe(()=>{},["stop"]))},[s("div",kv,[k(r(C),{icon:"carbon:warning",class:"warning-icon"}),s("h3",null,c(O.$t("cronTask.deleteConfirm")),1)]),s("div",Tv,[s("p",null,c(O.$t("cronTask.deleteConfirmMessage",{taskName:((Y=h.value)==null?void 0:Y.cronName)||((j=h.value)==null?void 0:j.planDesc)||""})),1)]),s("div",Pv,[s("button",{class:"confirm-btn cancel-btn",onClick:A},c(O.$t("common.cancel")),1),s("button",{class:"confirm-btn delete-btn",onClick:E,disabled:y.value===((H=h.value)==null?void 0:H.id)},[k(r(C),{icon:y.value===((K=h.value)==null?void 0:K.id)?"carbon:loading":"carbon:trash-can"},null,8,["icon"]),ee(" "+c(O.$t("cronTask.delete")),1)],8,Cv)])])])):V("",!0)]}),_:1})])),(p(),ne(Ye,{to:"body"},[k(Ue,{name:"modal"},{default:Ee(()=>[T.value?(p(),g("div",{key:0,class:"modal-overlay",onClick:L},[s("div",{class:"confirm-modal create-options-modal",onClick:G[6]||(G[6]=pe(()=>{},["stop"]))},[s("div",Ev,[k(r(C),{icon:"carbon:time",class:"create-icon"}),s("h3",null,c(O.$t("cronTask.createTask")),1)]),s("div",Rv,[s("p",null,c(O.$t("cronTask.selectCreateMethod")),1),s("div",Iv,[s("button",{class:"create-option-btn jmanus-btn",onClick:J},[k(r(C),{icon:"carbon:ai-status"}),s("div",Av,[s("span",xv,c(O.$t("cronTask.createWithJmanus")),1),s("span",Dv,c(O.$t("cronTask.createWithJmanusDesc")),1)])]),s("button",{class:"create-option-btn manual-btn",onClick:X},[k(r(C),{icon:"carbon:edit"}),s("div",Fv,[s("span",Mv,c(O.$t("cronTask.createManually")),1),s("span",Uv,c(O.$t("cronTask.createManuallyDesc")),1)])])])]),s("div",Nv,[s("button",{class:"confirm-btn cancel-btn",onClick:L},c(O.$t("common.cancel")),1)])])])):V("",!0)]),_:1})]))],64))}}),Bv=de(Lv,[["__scopeId","data-v-a90a3961"]]),Ov={class:"direct-page"},qv={class:"direct-chat"},Vv={class:"chat-header"},jv={class:"header-actions"},Hv=["title"],Gv=["title"],Wv=["title"],zv=["title"],Jv={class:"chat-content"},Kv=["title"],Xv={class:"message-content"},Qv=ce({__name:"index",setup(n){const e=Bs(),t=ss(),o=os(),{t:a}=we(),{message:l}=qs(),i=U(""),u=U(""),f=U(),d=U(),m=U(),y=U(),F=U(!1),B=U(!1),$=U(null),S=U(!1),_=U(50),h=U(!1),T=U(0),w=U(0),R=le(()=>{if(z.isCollapsed)return _.value;let j=26;y.value&&y.value.sidebarWidth!==void 0&&(j=y.value.sidebarWidth);const H=100-j;return Math.max(20,Math.min(H,_.value))});Se(()=>{if(console.log("[Direct] onMounted called"),console.log("[Direct] taskStore.currentTask:",o.currentTask),console.log("[Direct] taskStore.hasUnprocessedTask():",o.hasUnprocessedTask()),Ie.setEventCallbacks({onPlanUpdate:H=>{console.log("[Direct] Plan update event received for rootPlanId:",H),E(H)&&(console.log("[Direct] Processing plan update for current rootPlanId:",H),d.value&&typeof d.value.handlePlanUpdate=="function"?(console.log("[Direct] Calling chatRef.handlePlanUpdate with rootPlanId:",H),d.value.handlePlanUpdate(H)):console.warn("[Direct] chatRef.handlePlanUpdate method not available"),f.value&&typeof f.value.updateDisplayedPlanProgress=="function"?(console.log("[Direct] Calling rightPanelRef.updateDisplayedPlanProgress with rootPlanId:",H),f.value.updateDisplayedPlanProgress(H)):console.warn("[Direct] rightPanelRef.updateDisplayedPlanProgress method not available"))},onPlanCompleted:H=>{if(console.log("[Direct] Plan completed event received for rootPlanId:",H),!!E(H)){if(console.log("[Direct] Processing plan completion for current rootPlanId:",H),d.value&&typeof d.value.handlePlanCompleted=="function"){const K=Ie.getCachedPlanRecord(H);K&&K.completed?K.summary&&K.summary.trim().length>0?(console.log("[Direct]  Plan details are valid and complete from polling cache, updating UI"),d.value.handlePlanCompleted(K)):(console.warn("[Direct]  Plan completed but summary is empty, still proceeding with available data"),d.value.handlePlanCompleted(K)):(console.warn("[Direct]  Plan details incomplete in cache, attempting API fallback"),yt.getDetails(H).then(ue=>{console.log("[Direct]  Got fresh details from API:",ue),ue&&ue.completed?(console.log("[Direct] Fresh details from API are valid, updating UI"),Ie.setCachedPlanRecord(H,ue),d.value.handlePlanCompleted(ue)):(console.warn("[Direct]  API details also incomplete, using best available data"),d.value.handlePlanCompleted(K??{planId:H}))}).catch(ue=>{console.error("[Direct] API call failed (likely record deleted), using cached data:",ue),d.value.handlePlanCompleted(K??{planId:H})}))}else console.warn("[Direct] chatRef.handlePlanCompleted method not available");$.value=null,console.log("[Direct]  Cleared currentRootPlanId after plan completion"),m.value&&typeof m.value.resetSession=="function"&&(console.log("[Direct]  Calling inputRef.resetSession to clear sessionPlanId"),m.value.resetSession())}},onDialogRoundStart:H=>{console.log("[Direct] Dialog round start event received for rootPlanId:",H),$.value=H,console.log("[Direct] Set currentRootPlanId to:",H),d.value&&typeof d.value.handleDialogRoundStart=="function"?(console.log("[Direct] Calling chatRef.handleDialogRoundStart with planId:",H),d.value.handleDialogRoundStart(H)):console.warn("[Direct] chatRef.handleDialogRoundStart method not available")},onChatInputClear:()=>{console.log("[Direct] Chat input clear event received"),q()},onChatInputUpdateState:H=>{if(console.log("[Direct] Chat input update state event received for rootPlanId:",H),!E(H,!0))return;const K=Ie.getCachedUIState(H);K&&D(K.enabled,K.placeholder)},onPlanError:H=>{d.value.handlePlanError(H)}}),console.log("[Direct] Event callbacks registered to planExecutionManager"),z.loadPlanTemplateList(),o.hasUnprocessedTask()&&o.currentTask){const H=o.currentTask.prompt;console.log("[Direct] Found unprocessed task from store:",H),o.markTaskAsProcessed(),be(async()=>{try{console.log("[Direct] Calling handleChatSendMessage with taskContent:",H),await A({input:H})}catch(K){console.warn("[Direct] handleChatSendMessage failed, falling back to prompt:",K),i.value=H}})}else{const H=o.getAndClearTaskToInput();H?(u.value=H,console.log("[Direct] Setting inputOnlyContent for input only:",u.value)):(i.value=e.query.prompt||"",console.log("[Direct] Received task from URL:",i.value),console.log("[Direct] No unprocessed task in store"))}const j=localStorage.getItem("directPanelWidth");j&&(_.value=parseFloat(j)),console.log("[Direct] Final prompt value:",i.value),u.value&&be(()=>{m.value&&typeof m.value.setInputValue=="function"&&(m.value.setInputValue(u.value),console.log("[Direct] Set input value:",u.value),u.value="")}),window.addEventListener("plan-execution-requested",H=>{console.log("[DirectView] Received plan-execution-requested event:",H.detail),O(H.detail)})}),ie(()=>o.currentTask,j=>{if(console.log("[Direct] Watch taskStore.currentTask triggered, newTask:",j),j&&!j.processed){const H=j.prompt;o.markTaskAsProcessed(),console.log("[Direct] Received new task from store:",H),be(async()=>{try{console.log("[Direct] Directly executing new task via handleChatSendMessage:",H),await A({input:H})}catch(K){console.warn("[Direct] handleChatSendMessage failed for new task:",K)}})}else console.log("[Direct] Task is null or already processed, ignoring")},{immediate:!1}),ie(()=>i.value,(j,H)=>{console.log("[Direct] prompt value changed from:",H,"to:",j)},{immediate:!1}),ie(()=>o.taskToInput,j=>{console.log("[Direct] Watch taskStore.taskToInput triggered, newTaskToInput:",j),j.trim()&&(console.log("[Direct] Setting input value from taskToInput:",j),be(()=>{m.value&&typeof m.value.setInputValue=="function"&&(m.value.setInputValue(j.trim()),console.log("[Direct] Input value set from taskToInput watch:",j.trim()),o.getAndClearTaskToInput())}))},{immediate:!1}),$e(()=>{console.log("[Direct] onUnmounted called, cleaning up resources"),$.value=null,Ie.cleanup(),document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",M),window.removeEventListener("plan-execution-requested",j=>{O(j.detail)})});const v=j=>{h.value=!0,T.value=j.clientX,w.value=_.value,document.addEventListener("mousemove",P),document.addEventListener("mouseup",M),document.body.style.cursor="col-resize",document.body.style.userSelect="none",j.preventDefault()},P=j=>{if(!h.value)return;const H=window.innerWidth,ue=(j.clientX-T.value)/H*100;let Re=w.value+ue;Re=Math.max(20,Math.min(80,Re)),_.value=Re},M=()=>{h.value=!1,document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",M),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("directPanelWidth",_.value.toString())},W=()=>{_.value=50,localStorage.setItem("directPanelWidth","50")},E=(j,H=!1)=>!$.value||j===$.value||H&&(j==="ui-state"||j==="error")?!0:(console.log("[Direct] Ignoring event for non-current rootPlanId:",j,"current:",$.value),!1),A=async j=>{var K,ue,Re,He,Ge,We,ze,Je,Ke;let H=null;try{console.log("[DirectView] Processing send-message event:",j);const Pe=(K=d.value)==null?void 0:K.addMessage("user",j.input);j.attachments&&Pe&&((ue=d.value)==null||ue.updateMessage(Pe.id,{attachments:j.attachments})),H=(Re=d.value)==null?void 0:Re.addMessage("assistant","",{thinking:a("chat.thinkingProcessing")}),H&&((He=d.value)==null||He.startStreaming(H.id));const{DirectApiService:ge}=await Os(async()=>{const{DirectApiService:Xe}=await Promise.resolve().then(()=>rf);return{DirectApiService:Xe}},void 0);console.log("[DirectView] Calling DirectApiService.sendMessageWithDefaultPlan");const fe=await ge.sendMessageWithDefaultPlan(j);console.log("[DirectView] API response received:",fe),fe.planId&&H?((Ge=d.value)==null||Ge.updateMessage(H.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:fe.planId,rootPlanId:fe.planId,status:"running"}}),$.value=fe.planId,console.log("[DirectView] Set currentRootPlanId to:",fe.planId),Ie.handlePlanExecutionRequested(fe.planId,j.input),console.log("[DirectView] Started polling for plan execution updates")):H&&((We=d.value)==null||We.updateMessage(H.id,{content:fe.message||fe.result||"No response received from backend"}),(ze=d.value)==null||ze.stopStreaming(H.id))}catch(Pe){console.error("[DirectView] Send message failed:",Pe),(Je=d.value)==null||Je.addMessage("assistant",`Error: ${(Pe==null?void 0:Pe.message)||"Failed to send message"}`),H&&((Ke=d.value)==null||Ke.stopStreaming(H.id))}},x=async j=>{console.log("[DirectView] Send message from input:",JSON.stringify(j)),await A(j)},q=()=>{console.log("[DirectView] Input cleared"),m.value&&typeof m.value.clear=="function"&&m.value.clear()},b=()=>{console.log("[DirectView] Input focused")},D=(j,H)=>{console.log("[DirectView] Input state updated:",j,H),B.value=!j},J=j=>{console.log("[DirectView] Step selected:",j),f.value&&typeof f.value.handleStepSelected=="function"?(console.log("[DirectView] Forwarding step selection to right panel:",j),f.value.handleStepSelected(j)):console.warn("[DirectView] rightPanelRef.handleStepSelected method not available")},X=(j,H,K,ue)=>{console.log("[DirectView] Sub plan step selected:",{parentPlanId:j,subPlanId:H,stepIndex:K,subStepIndex:ue}),f.value&&typeof f.value.handleSubPlanStepSelected=="function"?(console.log("[DirectView] Forwarding sub plan step selection to right panel:",{parentPlanId:j,subPlanId:H,stepIndex:K,subStepIndex:ue}),f.value.handleSubPlanStepSelected(j,H,K,ue)):console.warn("[DirectView] rightPanelRef.handleSubPlanStepSelected method not available")},L=()=>{console.log("[DirectView] Plan mode button clicked"),z.toggleSidebar(),console.log("[DirectView] Sidebar toggled, isCollapsed:",z.isCollapsed)},N=()=>{t.push("/home")},Q=()=>{t.push("/configs")},O=async j=>{var ue,Re,He,Ge,We,ze,Je,Ke,Pe;if(console.log("[DirectView] Plan execution requested:",j),F.value){console.log("[DirectView] Plan execution already in progress, ignoring request");return}F.value=!0;let H=!1,K=null;try{console.log("[DirectView] Adding messages for plan execution:",j.title),(ue=d.value)==null||ue.addMessage("user",j.title),H=!0,K=(Re=d.value)==null?void 0:Re.addMessage("assistant","",{thinking:a("chat.planningExecution")}),K&&((He=d.value)==null||He.startStreaming(K.id),console.log("[DirectView] Added assistant message for plan execution:",K.id))}catch(ge){console.warn("[DirectView] Failed to add messages:",ge)}try{const ge=j.planData.planTemplateId;if(!ge)throw new Error(a("direct.planTemplateIdNotFound"));console.log("[Direct] Executing plan with templateId:",ge,"params:",j.params),console.log("[Direct] About to call PlanActApiService.executePlan");const fe=j.uploadedFiles||[],Xe=j.uploadKey||void 0;console.log("[Direct]  DEBUG - InputArea uploadedFiles:",fe),console.log("[Direct]  DEBUG - InputArea uploadKey:",Xe),console.log("[Direct] Executing with uploaded files:",fe.length??0),console.log("[Direct] Executing with replacement params:",j.replacementParams);let ke;if((Ge=j.params)!=null&&Ge.trim()?(console.log("[Direct] Calling executePlan with rawParam:",j.params.trim()),ke=await et.executePlan(ge,j.params.trim(),fe,j.replacementParams,Xe)):(console.log("[Direct] Calling executePlan without rawParam"),ke=await et.executePlan(ge,void 0,fe,j.replacementParams,Xe)),console.log("[Direct] Plan execution API response:",ke),ke.planId&&K)console.log("[Direct] Got planId from response:",ke.planId,"starting plan execution"),(We=d.value)==null||We.updateMessage(K.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:ke.planId,rootPlanId:ke.planId,status:"running"}}),$.value=ke.planId,console.log("[Direct] Set currentRootPlanId to:",ke.planId),console.log("[Direct] Delegating plan execution to planExecutionManager"),Ie.handlePlanExecutionRequested(ke.planId,j.title);else throw console.error("[Direct] No planId in response:",ke),new Error(a("direct.executionFailedNoPlanId"))}catch(ge){console.error("[Direct] Plan execution failed:",ge),console.error("[Direct] Error details:",{message:ge.message,stack:ge.stack}),$.value=null;try{console.log("[Direct] Adding error messages to chat"),H||(ze=d.value)==null||ze.addMessage("user",j.title),K?((Je=d.value)==null||Je.updateMessage(K.id,{content:`${a("direct.executionFailed")}: ${ge.message||a("common.unknownError")}`,thinking:void 0}),(Ke=d.value)==null||Ke.stopStreaming(K.id)):(Pe=d.value)==null||Pe.addMessage("assistant",`${a("direct.executionFailed")}: ${ge.message||a("common.unknownError")}`)}catch(fe){console.error("[Direct] Failed to add error messages:",fe),alert(`${a("direct.executionFailed")}: ${ge.message||a("common.unknownError")}`)}}finally{console.log("[Direct] Plan execution finished, resetting isExecutingPlan flag"),F.value=!1}},G=()=>{d.value.showMemory()},Y=()=>{xe.clearMemoryId(),d.value.newChat()};return(j,H)=>(p(),g("div",Ov,[s("div",qv,[k(pc,{ref_key:"sidebarRef",ref:y,onPlanExecutionRequested:O},null,512),s("div",{class:"left-panel",style:qe({width:R.value+"%"})},[s("div",Vv,[s("button",{class:"back-button",onClick:N},[k(r(C),{icon:"carbon:arrow-left"})]),s("h2",null,c(j.$t("conversation")),1),s("div",jv,[k(Vs),s("button",{class:"config-button",onClick:Y,title:j.$t("memory.newChat")},[k(r(C),{icon:"carbon:add",width:"20"})],8,Hv),s("button",{class:"config-button",onClick:Q,title:j.$t("direct.configuration")},[k(r(C),{icon:"carbon:settings-adjust",width:"20"})],8,Gv),s("button",{class:"cron-task-btn",onClick:H[0]||(H[0]=K=>S.value=!0),title:j.$t("cronTask.title")},[k(r(C),{icon:"carbon:alarm",width:"20"})],8,Wv),s("button",{class:"cron-task-btn",onClick:H[1]||(H[1]=K=>r(xe).toggleSidebar()),title:j.$t("memory.selectMemory")},[k(r(C),{icon:"carbon:calendar",width:"20"})],8,zv)])]),s("div",Jv,[k(mf,{ref_key:"chatRef",ref:d,mode:"direct","initial-prompt":i.value||"",onStepSelected:J,onSubPlanStepSelected:X},null,8,["initial-prompt"])]),(p(),ne($f,{key:j.$i18n.locale,ref_key:"inputRef",ref:m,disabled:B.value,placeholder:B.value?r(a)("input.waiting"):r(a)("input.placeholder"),"initial-value":i.value,onSend:x,onClear:q,onFocus:b,onUpdateState:D,onPlanModeClicked:L},null,8,["disabled","placeholder","initial-value"]))],4),s("div",{class:"panel-resizer",onMousedown:v,onDblclick:W,title:j.$t("direct.panelResizeHint")},H[3]||(H[3]=[s("div",{class:"resizer-line"},null,-1)]),40,Kv),k(up,{ref_key:"rightPanelRef",ref:f,style:qe({width:100-_.value+"%"}),"current-root-plan-id":$.value},null,8,["style","current-root-plan-id"])]),k(Bv,{modelValue:S.value,"onUpdate:modelValue":H[2]||(H[2]=K=>S.value=K)},null,8,["modelValue"]),k(rd,{onMemorySelected:G}),r(l).show?(p(),g("div",{key:0,class:se(["message-toast",r(l).type])},[s("div",Xv,[s("span",null,c(r(l).text),1)])],2)):V("",!0)]))}}),wg=de(Qv,[["__scopeId","data-v-d0b79972"]]);export{wg as default};
