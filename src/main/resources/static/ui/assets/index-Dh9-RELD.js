var Os=Object.defineProperty;var qs=(o,e,n)=>e in o?Os(o,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[e]=n;var ge=(o,e,n)=>qs(o,typeof e!="symbol"?e+"":e,n);import{d as pe,u as Pe,c as ue,r as F,B as nt,C as de,o as we,a as f,b as p,F as ae,g as w,f as L,p as Fe,h as ne,i as l,t as c,e as t,w as se,m as re,n as oe,q as ie,D as ct,E as Ht,l as le,G as ot,H as js,I as ls,J as Te,z as We,j as fe,T as qe,K as Ze,M as rs,A as ke,v as Vs,N as is,O as et,y as cs,P as Hs,_ as Gs}from"./index-BHwQ6eip.js";import{I as T,_ as he}from"./_plugin-vue_export-helper-BhWU3fnc.js";import{s as H,P as tt,u as ds}from"./sidebar-DT5cYEx1.js";import{M as Ws,A as zs,T as Js,u as us,a as Ks}from"./useMessage-YSxkcgp8.js";import{L as Gt}from"./llm-check-BVkAKrj3.js";import{L as Xs}from"./LanguageSwitcher-DSjYXq_z.js";class Me{static async getCoordinatorToolConfig(){try{const e=await fetch(`${this.BASE_URL}/config`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get coordinator tool config: ${e.status}`);return await e.json()}catch(e){return console.error("Failed to get CoordinatorTool configuration:",e),{enabled:!0,success:!1,message:e.message}}}static async getAllEndpoints(){try{const e=await fetch(`${this.BASE_URL}/endpoints`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get endpoints: ${e.status}`);return await e.json()}catch(e){throw console.error("Failed to get endpoints:",e),new Error("Failed to get endpoints: "+e.message)}}static async getCoordinatorToolsByTemplate(e){console.log("[CoordinatorToolApiService] Starting to get coordinator tool, planTemplateId:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/get-get-or-new-by-template/${e}`);try{const n=await fetch(`${this.BASE_URL}/get-or-new-by-template/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",n.status),console.log("[CoordinatorToolApiService] Response status text:",n.statusText),n.status===404)return console.log("[CoordinatorToolApiService] 404"),null;if(!n.ok){const a=await n.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to get coordinator tools: ${n.status} - ${a}`)}const s=await n.json();return console.log("[CoordinatorToolApiService] Successfully got coordinator tool, result:",s),s}catch(n){throw console.error("[CoordinatorToolApiService] Failed to get coordinator tool:",n),new Error("Failed to get coordinator tool: "+n.message)}}static async getOrNewCoordinatorToolsByTemplate(e){console.log("[CoordinatorToolApiService] Starting to get or create coordinator tool, planTemplateId:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/get-or-new-by-template/${e}`);try{const n=await fetch(`${this.BASE_URL}/get-or-new-by-template/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",n.status),console.log("[CoordinatorToolApiService] Response status text:",n.statusText),!n.ok){const a=await n.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to get coordinator tools: ${n.status} - ${a}`)}const s=await n.json();return console.log("[CoordinatorToolApiService] Successfully got coordinator tool, result:",s),s}catch(n){throw console.error("[CoordinatorToolApiService] Failed to get coordinator tool:",n),new Error("Failed to get coordinator tool: "+n.message)}}static async createCoordinatorTool(e){console.log("[CoordinatorToolApiService] Starting to create coordinator tool"),console.log("[CoordinatorToolApiService] Original data:",JSON.stringify(e,null,2)),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}`);const n={id:e.id,toolName:e.toolName,toolDescription:e.toolDescription,inputSchema:e.inputSchema,planTemplateId:e.planTemplateId,httpEndpoint:e.httpEndpoint,mcpEndpoint:e.mcpEndpoint,serviceGroup:e.serviceGroup,enableInternalToolcall:e.enableInternalToolcall,enableHttpService:e.enableHttpService,enableMcpService:e.enableMcpService};console.log("[CoordinatorToolApiService] Cleaned sending data:",JSON.stringify(n,null,2));try{const s=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(console.log("[CoordinatorToolApiService] Response status:",s.status),console.log("[CoordinatorToolApiService] Response status text:",s.statusText),!s.ok){let r="Unknown error";try{const i=await s.json();r=i.message||i.error||r}catch{r=await s.text()||r}throw console.error("[CoordinatorToolApiService] Response error content:",r),new Error(`Failed to create coordinator tool: ${s.status} - ${r}`)}const a=await s.json();return console.log("[CoordinatorToolApiService] Created successfully, result:",a),a}catch(s){throw console.error("[CoordinatorToolApiService] Failed to create coordinator tool:",s),new Error("Failed to create coordinator tool: "+s.message)}}static async updateCoordinatorTool(e,n){console.log("[CoordinatorToolApiService] Starting to update coordinator tool, ID:",e),console.log("[CoordinatorToolApiService] Sending data:",n),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/${e}`);const s={id:n.id,toolName:n.toolName,toolDescription:n.toolDescription,inputSchema:n.inputSchema,planTemplateId:n.planTemplateId,httpEndpoint:n.httpEndpoint,mcpEndpoint:n.mcpEndpoint,serviceGroup:n.serviceGroup,enableInternalToolcall:n.enableInternalToolcall,enableHttpService:n.enableHttpService,enableMcpService:n.enableMcpService};console.log("[CoordinatorToolApiService] Cleaned sending data:",s);try{const a=await fetch(`${this.BASE_URL}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(console.log("[CoordinatorToolApiService] Response status:",a.status),console.log("[CoordinatorToolApiService] Response status text:",a.statusText),!a.ok){let i="Unknown error";try{const h=await a.json();i=h.message||h.error||i}catch{i=await a.text()||i}throw console.error("[CoordinatorToolApiService] Response error content:",i),new Error(`Failed to update coordinator tool: ${a.status} - ${i}`)}const r=await a.json();return console.log("[CoordinatorToolApiService] Updated successfully, result:",r),r}catch(a){throw console.error("[CoordinatorToolApiService] Failed to update coordinator tool:",a),new Error("Failed to update coordinator tool: "+a.message)}}static async deleteCoordinatorTool(e){console.log("[CoordinatorToolApiService] Starting to delete coordinator tool, ID:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/${e}`);try{const n=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",n.status),console.log("[CoordinatorToolApiService] Response status text:",n.statusText),!n.ok){const a=await n.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to delete coordinator tool: ${n.status} - ${a}`)}const s=await n.json();return console.log("[CoordinatorToolApiService] Deleted successfully, result:",s),s}catch(n){throw console.error("[CoordinatorToolApiService] Failed to delete coordinator tool:",n),new Error("Failed to delete coordinator tool: "+n.message)}}}ge(Me,"BASE_URL","/api/coordinator-tools");class Lt{static async getParameterRequirements(e){try{const n=await fetch(`${this.BASE_URL}/${e}/parameters`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error(`Failed to get parameter requirements: ${n.statusText}`);return await n.json()}catch(n){throw console.error("Error getting parameter requirements:",n),n}}}ge(Lt,"BASE_URL","/api/plan-template");const Ys={class:"modal-form wide-modal"},Qs={class:"form-section"},Zs={class:"form-item"},en=["placeholder"],tn={class:"field-description"},sn={class:"form-section"},nn={class:"form-item"},on=["placeholder"],an={class:"field-description"},ln={class:"form-section"},rn={class:"form-item"},cn=["placeholder"],dn={class:"field-description"},un={class:"form-section"},pn={class:"section-title"},hn={key:0,class:"params-help-text"},mn={class:"parameter-table"},fn=["onUpdate:modelValue","placeholder","readonly"],vn=["onUpdate:modelValue","placeholder"],gn={class:"form-section"},bn={class:"service-publish-options"},yn={class:"internal-toolcall-publish-option"},_n={class:"checkbox-label"},$n={class:"checkbox-text"},wn={class:"checkbox-description"},Sn={class:"http-publish-option"},kn={class:"checkbox-label"},Tn={class:"checkbox-text"},Pn={class:"checkbox-description"},En={class:"mcp-publish-option"},Cn={class:"checkbox-label"},In={class:"checkbox-text"},Rn={class:"checkbox-description"},An={key:0,class:"form-section"},xn={class:"form-item"},Dn={class:"endpoint-description"},Mn={class:"endpoint-container"},Fn={class:"endpoint-row"},Un={class:"custom-select"},Nn={class:"select-input-container"},Ln={class:"input-content"},Bn=["placeholder"],On={class:"dropdown-header"},qn={class:"select-options"},jn=["onClick"],Vn={class:"option-name"},Hn={class:"manual-input-section"},Gn={class:"manual-input-container"},Wn=["placeholder"],zn={key:0,class:"form-item url-item"},Jn={class:"url-container"},Kn=["title"],Xn={class:"url-text"},Yn={class:"button-container"},Qn=["disabled"],Zn=["disabled"],eo=pe({__name:"PublishServiceModal",props:{modelValue:{type:Boolean,default:!1},planTemplateId:{default:""},planTitle:{default:""},planDescription:{default:""}},emits:["update:modelValue","published"],setup(o,{expose:e,emit:n}){const{t:s}=Pe(),a=o,r=n,i=ue({get:()=>a.modelValue,set:V=>r("update:modelValue",V)}),h=F(""),g=F(""),u=F(!1),d=F(!1),b=F([]),R=F(""),M=F(!1),_=F("bottom"),y=F(""),v=F(null),$=F(!1),E=F(!1),S=F(!1),I=F(!0),m=F({parameters:[],hasParameters:!1,requirements:""}),q=F(!1),D=nt({serviceName:"",userRequest:"",endpoint:"",serviceGroup:"",parameters:[]}),W=ue(()=>{const V=v.value&&v.value.id;return s(V?"mcpService.updateService":"mcpService.createService")}),C=()=>{D.serviceName="",D.userRequest=a.planDescription||"",D.endpoint="",D.serviceGroup="",m.value.hasParameters||(D.parameters=[]),v.value=null,R.value="",$.value=!1},U=async()=>{try{b.value=await Me.getAllEndpoints()}catch(V){console.error("Failed to load endpoints:",V),k(s("mcpService.loadEndpointsFailed")+": "+V.message,"error")}},z=async()=>{if(!a.planTemplateId){m.value={parameters:[],hasParameters:!1,requirements:""};return}q.value=!0;try{const V=await Lt.getParameterRequirements(a.planTemplateId);m.value=V,V.hasParameters&&(D.parameters=V.parameters.map(Y=>({name:Y,description:""})))}catch(V){console.error("[PublishModal] Failed to load parameter requirements:",V),V instanceof Error&&!V.message.includes("404")&&console.warn("[PublishModal] Parameter requirements not available yet, will retry later"),m.value={parameters:[],hasParameters:!1,requirements:""}}finally{q.value=!1}},Q=()=>{M.value||P(),M.value=!M.value},P=()=>{const V=document.querySelector(".custom-select");if(!V)return;const Y=V.getBoundingClientRect(),X=window.innerHeight;Y.bottom+200>X?_.value="top":_.value="bottom"},x=V=>{D.endpoint=V,M.value=!1,y.value=""},B=()=>{if(y.value.trim()){const V=y.value.trim().replace(/[^a-zA-Z0-9_/]/g,"");V&&(D.endpoint=V,b.value.includes(V)||b.value.push(V),M.value=!1,y.value="")}},J=()=>{setTimeout(()=>{y.value.trim()&&B()},200)},Z=()=>{b.value.includes(D.endpoint)&&x(D.endpoint)},ee=()=>{b.value.includes(D.endpoint)&&x(D.endpoint)},me=()=>{b.value.includes(D.endpoint)&&x(D.endpoint)},G=async()=>{if(R.value)try{await navigator.clipboard.writeText(R.value),k(s("common.copy")+" "+s("common.success"),"success")}catch(V){console.error("Copy failed:",V),k(s("common.copy")+" "+s("common.error"),"error")}},k=(V,Y)=>{Y==="success"?(g.value=V,setTimeout(()=>{g.value=""},3e3)):Y==="error"&&(h.value=V,setTimeout(()=>{h.value=""},5e3))},j=()=>{if(!D.serviceName||!D.serviceName.trim())return k(s("mcpService.toolNameRequiredError"),"error"),!1;if(!D.userRequest||!D.userRequest.trim())return k(s("mcpService.toolDescriptionRequiredError"),"error"),!1;if(!D.serviceGroup||!D.serviceGroup.trim())return k(s("mcpService.serviceGroupRequiredError"),"error"),!1;if(E.value&&(!D.endpoint||!D.endpoint.trim()))return k(s("mcpService.endpointRequiredError"),"error"),!1;if(!I.value&&!S.value&&!E.value)return k("Please select at least one service type","error"),!1;for(let V=0;V<D.parameters.length;V++){const Y=D.parameters[V];if(Y.name&&!Y.description.trim())return k(`Parameter "${Y.name}" description cannot be empty`,"error"),!1;if(Y.description&&!Y.name.trim())return k(`Parameter description "${Y.description}" corresponding name cannot be empty`,"error"),!1}return!0},N=async()=>{if(console.log("[PublishModal] Starting to handle publish request"),console.log("[PublishModal] Form data:",D),console.log("[PublishModal] Current tool:",v.value),console.log("[PublishModal] Publish as MCP service:",E.value),console.log("[PublishModal] Publish as HTTP service:",S.value),!j()){console.log("[PublishModal] Form validation failed");return}u.value=!0;try{v.value||(console.log("[PublishModal] No current tool data, getting or creating first"),v.value=await Me.getOrNewCoordinatorToolsByTemplate(a.planTemplateId)),console.log("[PublishModal] Updating tool information"),v.value.toolName=D.serviceName.trim(),v.value.toolDescription=D.userRequest.trim(),v.value.serviceGroup=D.serviceGroup.trim(),v.value.planTemplateId=a.planTemplateId,v.value.enableInternalToolcall=I.value,v.value.enableHttpService=S.value,v.value.enableMcpService=E.value,E.value?v.value.mcpEndpoint=D.endpoint.trim():v.value.mcpEndpoint=void 0;const V=D.parameters.filter(X=>X.name.trim()&&X.description.trim()).map(X=>({name:X.name.trim(),description:X.description.trim(),type:"string"}));if(v.value.inputSchema=JSON.stringify(V),console.log("[PublishModal] Updated tool information:",v.value),v.value.id)console.log("[PublishModal] Updating existing tool, ID:",v.value.id),await Me.updateCoordinatorTool(v.value.id,v.value);else{console.log("[PublishModal] Creating new tool");const X=await Me.createCoordinatorTool(v.value);v.value=X}const Y=[];if(I.value&&Y.push("Internal Method Call"),S.value&&Y.push("HTTP Service"),E.value&&Y.push("MCP Service"),Y.length>0){console.log("[PublishModal] Step 5: Publishing service, ID:",v.value.id,"Enabled services:",Y.join(", "));const X=[];if(E.value&&v.value.mcpEndpoint){const ye=window.location.origin;X.push(`MCP: ${ye}/mcp${v.value.mcpEndpoint}`)}I.value&&X.push(`Internal Call: ${D.serviceName}`),R.value=X.join(`
`),console.log("[PublishModal] Service published successfully, service URLs:",R.value),k(s("mcpService.publishSuccess"),"success"),r("published",v.value)}else console.log("[PublishModal] Only saving tool, not publishing as any service"),k(s("mcpService.saveSuccess"),"success"),r("published",v.value)}catch(V){console.error("[PublishModal] Failed to publish service:",V),k(s("mcpService.publishFailed")+": "+V.message,"error")}finally{u.value=!1}},O=async()=>{if(!d.value&&confirm(s("mcpService.deleteConfirmMessage"))){if(!v.value||!v.value.id){k(s("mcpService.deleteFailed")+": "+s("mcpService.selectPlanTemplateFirst"),"error");return}d.value=!0;try{console.log("[PublishModal] Starting to delete MCP service, ID:",v.value.id);const V=await Me.deleteCoordinatorTool(v.value.id);if(V.success)console.log("[PublishModal] Deleted successfully"),k(s("mcpService.deleteSuccess"),"success"),i.value=!1,r("published",null);else throw new Error(V.message)}catch(V){console.error("[PublishModal] Failed to delete MCP service:",V),k(s("mcpService.deleteFailed")+": "+V.message,"error")}finally{d.value=!1}}},K=async()=>{i.value&&(console.log("[PublishModal] Modal opened, starting to initialize data"),C(),await U(),await ce())},ce=async()=>{if(!a.planTemplateId){console.log("[PublishModal] "+s("mcpService.noPlanTemplateId"));return}try{console.log("[PublishModal] Starting to load coordinator tool data, planTemplateId:",a.planTemplateId);const V=await Me.getOrNewCoordinatorToolsByTemplate(a.planTemplateId);console.log("[PublishModal] Get coordinator tool data result:",V),v.value=V,$.value=!!V.id;const Y=[];if(V.enableMcpService&&V.mcpEndpoint){const X=window.location.origin;Y.push(`MCP: ${X}/mcp${V.mcpEndpoint}`)}V.enableInternalToolcall&&Y.push(`Internal Call: ${V.toolName}`),R.value=Y.join(`
`),console.log("[PublishModal] Load tool data - endpointUrl:",R.value),D.serviceName=V.toolName||"",D.userRequest=V.toolDescription||a.planDescription||"",D.serviceGroup=V.serviceGroup||"",E.value=V.enableMcpService||!1,S.value=V.enableHttpService||!1,I.value=V.enableInternalToolcall||!1,V.enableMcpService&&(D.endpoint=V.mcpEndpoint||"");try{if(V.inputSchema){const X=JSON.parse(V.inputSchema);Array.isArray(X)&&X.length>0?(D.parameters=X.map(ye=>({name:ye.name||"",description:ye.description||""})),console.log("[PublishModal] Load parameters from inputSchema:",D.parameters)):console.log("[PublishModal] inputSchema is empty, keeping existing parameters:",D.parameters)}}catch(X){console.warn("[PublishModal] "+s("mcpService.parseInputSchemaFailed")+":",X),console.log("[PublishModal] Parsing failed, keeping existing parameters:",D.parameters)}console.log("[PublishModal] Form data filled:",D)}catch(V){console.error("[PublishModal] "+s("mcpService.loadToolDataFailed")+":",V),k(s("mcpService.loadToolDataFailed")+": "+V.message,"error")}};return de(()=>a.modelValue,K),de(()=>a.planTemplateId,(V,Y)=>{V&&V!==Y&&(Y&&V.startsWith("planTemplate-")?setTimeout(()=>{z()},1e3):z())}),we(async()=>{i.value&&(console.log("[PublishModal] Initialize when component mounted"),C(),await U(),await ce(),await z())}),e({loadParameterRequirements:z}),(V,Y)=>(p(),f(ae,null,[w(Ws,{modelValue:i.value,"onUpdate:modelValue":Y[11]||(Y[11]=X=>i.value=X),title:W.value,onConfirm:N},{footer:Fe(()=>{var X;return[t("div",Yn,[$.value&&((X=v.value)!=null&&X.id)?(p(),f("button",{key:0,class:"action-btn danger",onClick:O,disabled:d.value},[d.value?(p(),le(l(T),{key:0,icon:"carbon:loading",class:"loading-icon"})):(p(),le(l(T),{key:1,icon:"carbon:trash-can"})),ne(" "+c(d.value?l(s)("mcpService.deleting"):l(s)("mcpService.delete")),1)],8,Qn)):L("",!0),t("button",{class:"action-btn primary",onClick:N,disabled:u.value},[u.value?(p(),le(l(T),{key:0,icon:"carbon:loading",class:"loading-icon"})):(p(),le(l(T),{key:1,icon:"carbon:cloud-upload"})),ne(" "+c(u.value?l(s)("mcpService.publishing"):l(s)("mcpService.publishAsService")),1)],8,Zn)])]}),default:Fe(()=>[t("div",Ys,[t("div",Qs,[t("div",Zs,[t("label",null,c(l(s)("mcpService.toolNameRequired")),1),se(t("input",{type:"text","onUpdate:modelValue":Y[0]||(Y[0]=X=>D.serviceName=X),placeholder:l(s)("mcpService.toolNamePlaceholder"),class:oe({error:!D.serviceName||!D.serviceName.trim()}),required:""},null,10,en),[[re,D.serviceName]]),t("div",tn,c(l(s)("mcpService.toolNameDescription")),1)])]),t("div",sn,[t("div",nn,[t("label",null,c(l(s)("mcpService.toolDescriptionRequired")),1),se(t("textarea",{"onUpdate:modelValue":Y[1]||(Y[1]=X=>D.userRequest=X),placeholder:l(s)("mcpService.toolDescriptionPlaceholder"),class:oe([{error:!D.userRequest||!D.userRequest.trim()},"description-field"]),rows:"4",required:""},null,10,on),[[re,D.userRequest]]),t("div",an,c(l(s)("mcpService.toolDescriptionDescription")),1)])]),t("div",ln,[t("div",rn,[t("label",null,c(l(s)("mcpService.serviceGroup")),1),se(t("input",{type:"text","onUpdate:modelValue":Y[2]||(Y[2]=X=>D.serviceGroup=X),placeholder:l(s)("mcpService.serviceGroupPlaceholder"),class:oe({error:!D.serviceGroup||!D.serviceGroup.trim()}),required:""},null,10,cn),[[re,D.serviceGroup]]),t("div",dn,c(l(s)("mcpService.serviceGroupDescription")),1)])]),t("div",un,[t("div",pn,c(l(s)("mcpService.parameterConfig")),1),m.value.hasParameters?(p(),f("div",hn,c(l(s)("sidebar.parameterRequirementsHelp")),1)):L("",!0),t("div",mn,[t("table",null,[t("thead",null,[t("tr",null,[t("th",null,c(l(s)("mcpService.parameterName")),1),t("th",null,c(l(s)("mcpService.parameterDescription")),1)])]),t("tbody",null,[(p(!0),f(ae,null,ie(D.parameters,(X,ye)=>(p(),f("tr",{key:ye},[t("td",null,[se(t("input",{type:"text","onUpdate:modelValue":xe=>X.name=xe,placeholder:l(s)("mcpService.parameterName"),class:oe(["parameter-input",{"readonly-input":m.value.hasParameters}]),readonly:m.value.hasParameters,required:""},null,10,fn),[[re,X.name]])]),t("td",null,[se(t("input",{type:"text","onUpdate:modelValue":xe=>X.description=xe,placeholder:l(s)("mcpService.parameterDescription"),class:"parameter-input",required:""},null,8,vn),[[re,X.description]])])]))),128))])])])]),t("div",gn,[t("div",bn,[t("div",yn,[t("label",_n,[se(t("input",{type:"checkbox","onUpdate:modelValue":Y[3]||(Y[3]=X=>I.value=X),class:"checkbox-input"},null,512),[[ct,I.value]]),t("span",$n,c(l(s)("mcpService.publishAsInternalToolcall")),1)]),t("div",wn,c(l(s)("mcpService.publishAsInternalToolcallDescription")),1)]),t("div",Sn,[t("label",kn,[se(t("input",{type:"checkbox","onUpdate:modelValue":Y[4]||(Y[4]=X=>S.value=X),class:"checkbox-input"},null,512),[[ct,S.value]]),t("span",Tn,c(l(s)("mcpService.publishAsHttpService")),1)]),t("div",Pn,c(l(s)("mcpService.publishAsHttpServiceDescription")),1)]),t("div",En,[t("label",Cn,[se(t("input",{type:"checkbox","onUpdate:modelValue":Y[5]||(Y[5]=X=>E.value=X),class:"checkbox-input"},null,512),[[ct,E.value]]),t("span",In,c(l(s)("mcpService.publishAsMcpService")),1)]),t("div",Rn,c(l(s)("mcpService.publishAsMcpServiceDescription")),1),E.value?(p(),f("div",An,[t("div",xn,[t("label",null,c(l(s)("mcpService.endpointRequired")),1),t("div",Dn,c(l(s)("mcpService.endpointDescription")),1),t("div",Mn,[t("div",Fn,[t("div",Un,[t("div",Nn,[t("div",Ln,[w(l(T),{icon:"carbon:application",width:"16",class:"input-icon"}),se(t("input",{type:"text","onUpdate:modelValue":Y[6]||(Y[6]=X=>D.endpoint=X),placeholder:l(s)("mcpService.endpointPlaceholder"),class:"select-input",onFocus:Y[7]||(Y[7]=X=>M.value=!0),onInput:Z,onKeydown:Ht(ee,["enter"]),onBlur:me},null,40,Bn),[[re,D.endpoint]])]),t("button",{class:"select-arrow-btn",onClick:Q,title:"Expand Options"},[w(l(T),{icon:M.value?"carbon:chevron-up":"carbon:chevron-down",width:"14",class:"chevron"},null,8,["icon"])])]),M.value?(p(),f("div",{key:0,class:oe(["select-dropdown",{"dropdown-top":_.value==="top"}])},[t("div",On,[t("span",null,c(l(s)("mcpService.selectEndpoint")),1),t("button",{class:"close-btn",onClick:Y[8]||(Y[8]=X=>M.value=!1)},[w(l(T),{icon:"carbon:close",width:"12"})])]),t("div",qn,[(p(!0),f(ae,null,ie(b.value,X=>(p(),f("button",{key:X,class:oe(["select-option",{active:D.endpoint===X}]),onClick:ye=>x(X)},[t("span",Vn,c(X),1),D.endpoint===X?(p(),le(l(T),{key:0,icon:"carbon:checkmark",width:"14",class:"check-icon"})):L("",!0)],10,jn))),128))]),t("div",Hn,[t("div",Gn,[se(t("input",{type:"text","onUpdate:modelValue":Y[9]||(Y[9]=X=>y.value=X),placeholder:l(s)("mcpService.manualInput"),class:"manual-input",onKeydown:Ht(B,["enter"]),onBlur:J},null,40,Wn),[[re,y.value]]),t("button",{class:"add-manual-btn",onClick:B},[w(l(T),{icon:"carbon:add",width:"14"})])])])],2)):L("",!0),M.value?(p(),f("div",{key:1,class:"backdrop",onClick:Y[10]||(Y[10]=X=>M.value=!1)})):L("",!0)])])])]),R.value?(p(),f("div",zn,[t("label",null,c(l(s)("mcpService.mcpStreamableUrl")),1),t("div",Jn,[t("div",{class:"url-display",onDblclick:G,title:l(s)("mcpService.copyUrl")+": "+R.value},[t("span",Xn,c(R.value||l(s)("mcpService.mcpStreamableUrlPlaceholder")),1),w(l(T),{icon:"carbon:copy",width:"16",class:"copy-icon"})],40,Kn)])])):L("",!0)])):L("",!0)])])])])]),_:1},8,["modelValue","title"]),h.value?(p(),f("div",{key:0,class:"error-toast",onClick:Y[12]||(Y[12]=X=>h.value="")},[w(l(T),{icon:"carbon:error"}),ne(" "+c(h.value),1)])):L("",!0),g.value?(p(),f("div",{key:1,class:"success-toast",onClick:Y[13]||(Y[13]=X=>g.value="")},[w(l(T),{icon:"carbon:checkmark"}),ne(" "+c(g.value),1)])):L("",!0)],64))}}),to=he(eo,[["__scopeId","data-v-bd88743f"]]);function ps(o,e){const n=F(!1),s=nt({title:"",steps:[],directResponse:!1,planTemplateId:o.currentPlanTemplateId||"",planType:"dynamic_agent"}),a=v=>{try{if(!v){Object.assign(s,{title:"",steps:[],directResponse:!1,planTemplateId:o.currentPlanTemplateId||"",planType:"dynamic_agent"});return}const $=JSON.parse(v);s.title=$.title||"",s.directResponse=!1,s.planTemplateId=$.planTemplateId||o.currentPlanTemplateId||"",s.planType=$.planType||"dynamic_agent",s.steps=($.steps||[]).map(E=>({stepRequirement:E.stepRequirement||"",agentName:E.agentName||"",modelName:E.modelName||null,selectedToolKeys:E.selectedToolKeys||[],terminateColumns:E.terminateColumns||""}))}catch($){console.warn("Failed to parse JSON content:",$)}},r=()=>{try{const v={title:s.title,steps:s.steps.map($=>({stepRequirement:$.stepRequirement,agentName:$.agentName,modelName:$.modelName||"",selectedToolKeys:$.selectedToolKeys,terminateColumns:$.terminateColumns})),directResponse:s.directResponse,planTemplateId:s.planTemplateId,planType:s.planType};return JSON.stringify(v,null,2)}catch(v){return console.error("Failed to convert visual data to JSON:",v),"{}"}},i=ue(()=>r());return de(()=>o.jsonContent,v=>{a(v)},{immediate:!0}),de(s,()=>{const v=r();e("update:jsonContent",v)},{deep:!0}),de(()=>o.currentPlanTemplateId,v=>{v&&(s.planTemplateId=v)}),{showJsonPreview:n,parsedData:s,formattedJsonOutput:i,addStep:()=>{const v={stepRequirement:"",agentName:"ConfigurableDynaAgent",modelName:null,selectedToolKeys:[],terminateColumns:"",agentType:"",stepContent:""};s.steps.push(v)},removeStep:v=>{v>=0&&v<s.steps.length&&s.steps.splice(v,1)},moveStepUp:v=>{if(v>0){const $=s.steps.splice(v,1)[0];s.steps.splice(v-1,0,$)}},moveStepDown:v=>{if(v<s.steps.length-1){const $=s.steps.splice(v,1)[0];s.steps.splice(v+1,0,$)}},toggleJsonPreview:()=>{n.value=!n.value},closeJsonPreview:()=>{n.value=!1},handleRollback:()=>{e("rollback")},handleRestore:()=>{e("restore")},handleSave:()=>{e("save")}}}const so={class:"config-section"},no={class:"section-header"},oo={class:"visual-editor"},ao={class:"plan-basic-info"},lo={class:"form-row"},ro={class:"form-label"},io=["placeholder"],co={class:"steps-section"},uo={class:"steps-header"},po={class:"form-label"},ho={class:"steps-container"},mo={class:"step-header"},fo={class:"step-number"},vo={class:"step-actions"},go=["onClick","disabled","title"],bo=["onClick","disabled","title"],yo=["onClick","title"],_o={class:"step-content"},$o={class:"form-row"},wo={class:"form-label"},So={class:"agent-selector"},ko=["onUpdate:modelValue"],To={value:""},Po=["title"],Eo={class:"form-row"},Co={class:"form-label"},Io=["onUpdate:modelValue","placeholder"],Ro={class:"form-row"},Ao={class:"form-label"},xo=["onUpdate:modelValue","placeholder"],Do={key:0,class:"empty-steps"},Mo={class:"plan-id-section"},Fo={class:"form-row"},Uo={class:"form-label"},No={key:0,class:"json-preview"},Lo={class:"preview-header"},Bo={class:"form-label"},Oo={class:"json-code"},qo={class:"editor-footer"},jo={class:"section-actions"},Vo=["disabled","title"],Ho=["disabled","title"],Go=["disabled"],Wo=pe({__name:"JsonEditor",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},hiddenFields:{default:()=>["currentPlanId","userRequest","rootPlanId"]},currentPlanTemplateId:{}},emits:["rollback","restore","save","update:jsonContent"],setup(o,{emit:e}){const n=o,s=e,{showJsonPreview:a,parsedData:r,formattedJsonOutput:i,addStep:h,removeStep:g,moveStepUp:u,moveStepDown:d,handleRollback:b,handleRestore:R,handleSave:M,toggleJsonPreview:_,closeJsonPreview:y}=ps(n,s),v=$=>{const E=$.target;if(!E)return;E.style.height="auto";const S=20,I=Math.ceil(E.scrollHeight/S),m=4,q=12,D=Math.max(m,Math.min(q,I)),W=D*S;E.style.height=`${W}px`,E.rows=D,I>q?E.style.overflowY="auto":E.style.overflowY="hidden"};return($,E)=>(p(),f("div",so,[t("div",no,[w(l(T),{icon:"carbon:code",width:"16"}),t("span",null,c($.$t("sidebar.jsonTemplate")),1)]),t("div",oo,[t("div",ao,[t("div",lo,[t("label",ro,c($.$t("sidebar.title")),1),se(t("input",{"onUpdate:modelValue":E[0]||(E[0]=S=>l(r).title=S),type:"text",class:"form-input",placeholder:$.$t("sidebar.titlePlaceholder")},null,8,io),[[re,l(r).title]])])]),t("div",co,[t("div",uo,[t("label",po,c($.$t("sidebar.tasks")),1)]),t("div",ho,[(p(!0),f(ae,null,ie(l(r).steps,(S,I)=>(p(),f("div",{key:I,class:"step-item"},[t("div",mo,[t("span",fo,c($.$t("sidebar.subtask"))+" "+c(I+1),1),t("div",vo,[t("button",{onClick:m=>l(u)(I),disabled:I===0,class:"btn btn-xs",title:$.$t("sidebar.moveUp")},[w(l(T),{icon:"carbon:chevron-up",width:"12"})],8,go),t("button",{onClick:m=>l(d)(I),disabled:I===l(r).steps.length-1,class:"btn btn-xs",title:$.$t("sidebar.moveDown")},[w(l(T),{icon:"carbon:chevron-down",width:"12"})],8,bo),t("button",{onClick:m=>l(g)(I),class:"btn btn-xs btn-danger",title:$.$t("sidebar.removeStep")},[w(l(T),{icon:"carbon:trash-can",width:"12"})],8,yo)])]),t("div",_o,[t("div",$o,[t("label",wo,c($.$t("sidebar.agent")),1),t("div",So,[se(t("select",{"onUpdate:modelValue":m=>S.agentName=m,class:"form-select agent-select"},[t("option",To,c($.$t("sidebar.selectAgent")),1),E[10]||(E[10]=js('<option value="DEFAULT_AGENT" data-v-f7391c35>DEFAULT_AGENT</option><option value="BROWSER_AGENT" data-v-f7391c35>BROWSER_AGENT</option><option value="TEXT_FILE_AGENT" data-v-f7391c35>TEXT_FILE_AGENT</option><option value="JSX_GENERATOR_AGENT" data-v-f7391c35>JSX_GENERATOR_AGENT</option><option value="FILE_MANAGER_AGENT" data-v-f7391c35>FILE_MANAGER_AGENT</option>',5))],8,ko),[[ot,S.agentName]]),t("button",{onClick:E[1]||(E[1]=(...m)=>l(h)&&l(h)(...m)),class:"btn btn-sm btn-add-step",title:$.$t("sidebar.addStep")},[w(l(T),{icon:"carbon:add",width:"14"})],8,Po)])]),t("div",Eo,[t("label",Co,c($.$t("sidebar.stepRequirement")),1),se(t("textarea",{"onUpdate:modelValue":m=>S.stepContent=m,class:"form-textarea auto-resize",placeholder:$.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:E[2]||(E[2]=m=>v(m))},null,40,Io),[[re,S.stepContent]])]),t("div",Ro,[t("label",Ao,c($.$t("sidebar.terminateColumns")),1),se(t("input",{"onUpdate:modelValue":m=>S.terminateColumns=m,type:"text",class:"form-input",placeholder:$.$t("sidebar.terminateColumnsPlaceholder")},null,8,xo),[[re,S.terminateColumns]])])])]))),128)),l(r).steps.length===0?(p(),f("div",Do,[w(l(T),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),t("p",null,c($.$t("sidebar.noSteps")),1),t("button",{onClick:E[3]||(E[3]=(...S)=>l(h)&&l(h)(...S)),class:"btn btn-primary"},[w(l(T),{icon:"carbon:add",width:"14"}),ne(" "+c($.$t("sidebar.addFirstStep")),1)])])):L("",!0)])]),t("div",Mo,[t("div",Fo,[t("label",Uo,c($.$t("sidebar.planId")),1),se(t("input",{"onUpdate:modelValue":E[4]||(E[4]=S=>l(r).planTemplateId=S),type:"text",class:"form-input",placeholder:"planTemplate-1756109892045"},null,512),[[re,l(r).planTemplateId]])])]),l(a)?(p(),f("div",No,[t("div",Lo,[t("label",Bo,c($.$t("sidebar.jsonPreview")),1),t("button",{onClick:E[5]||(E[5]=(...S)=>l(y)&&l(y)(...S)),class:"btn btn-xs"},[w(l(T),{icon:"carbon:close",width:"12"})])]),t("pre",Oo,c(l(i)),1)])):L("",!0),t("div",qo,[t("button",{onClick:E[6]||(E[6]=(...S)=>l(_)&&l(_)(...S)),class:"btn btn-sm btn-secondary"},[w(l(T),{icon:"carbon:code",width:"14"}),ne(" "+c(l(a)?$.$t("sidebar.hideJson"):$.$t("sidebar.showJson")),1)]),t("div",jo,[t("button",{class:"btn btn-sm",onClick:E[7]||(E[7]=(...S)=>l(b)&&l(b)(...S)),disabled:!($.canRollback??!1),title:$.$t("sidebar.rollback")},[w(l(T),{icon:"carbon:undo",width:"14"})],8,Vo),t("button",{class:"btn btn-sm",onClick:E[8]||(E[8]=(...S)=>l(R)&&l(R)(...S)),disabled:!($.canRestore??!1),title:$.$t("sidebar.restore")},[w(l(T),{icon:"carbon:redo",width:"14"})],8,Ho),t("button",{class:"btn btn-primary",onClick:E[9]||(E[9]=(...S)=>l(M)&&l(M)(...S)),disabled:$.isGenerating||$.isExecuting},[w(l(T),{icon:"carbon:save",width:"14"}),E[11]||(E[11]=ne(" Save "))],8,Go)])])])]))}}),zo=he(Wo,[["__scopeId","data-v-f7391c35"]]);function hs(o,e){return function(){return o.apply(e,arguments)}}const{toString:Jo}=Object.prototype,{getPrototypeOf:Bt}=Object,{iterator:vt,toStringTag:ms}=Symbol,gt=(o=>e=>{const n=Jo.call(e);return o[n]||(o[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Ie=o=>(o=o.toLowerCase(),e=>gt(e)===o),bt=o=>e=>typeof e===o,{isArray:Je}=Array,st=bt("undefined");function Ko(o){return o!==null&&!st(o)&&o.constructor!==null&&!st(o.constructor)&&_e(o.constructor.isBuffer)&&o.constructor.isBuffer(o)}const fs=Ie("ArrayBuffer");function Xo(o){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(o):e=o&&o.buffer&&fs(o.buffer),e}const Yo=bt("string"),_e=bt("function"),vs=bt("number"),yt=o=>o!==null&&typeof o=="object",Qo=o=>o===!0||o===!1,dt=o=>{if(gt(o)!=="object")return!1;const e=Bt(o);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(ms in o)&&!(vt in o)},Zo=Ie("Date"),ea=Ie("File"),ta=Ie("Blob"),sa=Ie("FileList"),na=o=>yt(o)&&_e(o.pipe),oa=o=>{let e;return o&&(typeof FormData=="function"&&o instanceof FormData||_e(o.append)&&((e=gt(o))==="formdata"||e==="object"&&_e(o.toString)&&o.toString()==="[object FormData]"))},aa=Ie("URLSearchParams"),[la,ra,ia,ca]=["ReadableStream","Request","Response","Headers"].map(Ie),da=o=>o.trim?o.trim():o.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function at(o,e,{allOwnKeys:n=!1}={}){if(o===null||typeof o>"u")return;let s,a;if(typeof o!="object"&&(o=[o]),Je(o))for(s=0,a=o.length;s<a;s++)e.call(null,o[s],s,o);else{const r=n?Object.getOwnPropertyNames(o):Object.keys(o),i=r.length;let h;for(s=0;s<i;s++)h=r[s],e.call(null,o[h],h,o)}}function gs(o,e){e=e.toLowerCase();const n=Object.keys(o);let s=n.length,a;for(;s-- >0;)if(a=n[s],e===a.toLowerCase())return a;return null}const Oe=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,bs=o=>!st(o)&&o!==Oe;function Rt(){const{caseless:o}=bs(this)&&this||{},e={},n=(s,a)=>{const r=o&&gs(e,a)||a;dt(e[r])&&dt(s)?e[r]=Rt(e[r],s):dt(s)?e[r]=Rt({},s):Je(s)?e[r]=s.slice():e[r]=s};for(let s=0,a=arguments.length;s<a;s++)arguments[s]&&at(arguments[s],n);return e}const ua=(o,e,n,{allOwnKeys:s}={})=>(at(e,(a,r)=>{n&&_e(a)?o[r]=hs(a,n):o[r]=a},{allOwnKeys:s}),o),pa=o=>(o.charCodeAt(0)===65279&&(o=o.slice(1)),o),ha=(o,e,n,s)=>{o.prototype=Object.create(e.prototype,s),o.prototype.constructor=o,Object.defineProperty(o,"super",{value:e.prototype}),n&&Object.assign(o.prototype,n)},ma=(o,e,n,s)=>{let a,r,i;const h={};if(e=e||{},o==null)return e;do{for(a=Object.getOwnPropertyNames(o),r=a.length;r-- >0;)i=a[r],(!s||s(i,o,e))&&!h[i]&&(e[i]=o[i],h[i]=!0);o=n!==!1&&Bt(o)}while(o&&(!n||n(o,e))&&o!==Object.prototype);return e},fa=(o,e,n)=>{o=String(o),(n===void 0||n>o.length)&&(n=o.length),n-=e.length;const s=o.indexOf(e,n);return s!==-1&&s===n},va=o=>{if(!o)return null;if(Je(o))return o;let e=o.length;if(!vs(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=o[e];return n},ga=(o=>e=>o&&e instanceof o)(typeof Uint8Array<"u"&&Bt(Uint8Array)),ba=(o,e)=>{const s=(o&&o[vt]).call(o);let a;for(;(a=s.next())&&!a.done;){const r=a.value;e.call(o,r[0],r[1])}},ya=(o,e)=>{let n;const s=[];for(;(n=o.exec(e))!==null;)s.push(n);return s},_a=Ie("HTMLFormElement"),$a=o=>o.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,s,a){return s.toUpperCase()+a}),Wt=(({hasOwnProperty:o})=>(e,n)=>o.call(e,n))(Object.prototype),wa=Ie("RegExp"),ys=(o,e)=>{const n=Object.getOwnPropertyDescriptors(o),s={};at(n,(a,r)=>{let i;(i=e(a,r,o))!==!1&&(s[r]=i||a)}),Object.defineProperties(o,s)},Sa=o=>{ys(o,(e,n)=>{if(_e(o)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const s=o[n];if(_e(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},ka=(o,e)=>{const n={},s=a=>{a.forEach(r=>{n[r]=!0})};return Je(o)?s(o):s(String(o).split(e)),n},Ta=()=>{},Pa=(o,e)=>o!=null&&Number.isFinite(o=+o)?o:e;function Ea(o){return!!(o&&_e(o.append)&&o[ms]==="FormData"&&o[vt])}const Ca=o=>{const e=new Array(10),n=(s,a)=>{if(yt(s)){if(e.indexOf(s)>=0)return;if(!("toJSON"in s)){e[a]=s;const r=Je(s)?[]:{};return at(s,(i,h)=>{const g=n(i,a+1);!st(g)&&(r[h]=g)}),e[a]=void 0,r}}return s};return n(o,0)},Ia=Ie("AsyncFunction"),Ra=o=>o&&(yt(o)||_e(o))&&_e(o.then)&&_e(o.catch),_s=((o,e)=>o?setImmediate:e?((n,s)=>(Oe.addEventListener("message",({source:a,data:r})=>{a===Oe&&r===n&&s.length&&s.shift()()},!1),a=>{s.push(a),Oe.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",_e(Oe.postMessage)),Aa=typeof queueMicrotask<"u"?queueMicrotask.bind(Oe):typeof process<"u"&&process.nextTick||_s,xa=o=>o!=null&&_e(o[vt]),A={isArray:Je,isArrayBuffer:fs,isBuffer:Ko,isFormData:oa,isArrayBufferView:Xo,isString:Yo,isNumber:vs,isBoolean:Qo,isObject:yt,isPlainObject:dt,isReadableStream:la,isRequest:ra,isResponse:ia,isHeaders:ca,isUndefined:st,isDate:Zo,isFile:ea,isBlob:ta,isRegExp:wa,isFunction:_e,isStream:na,isURLSearchParams:aa,isTypedArray:ga,isFileList:sa,forEach:at,merge:Rt,extend:ua,trim:da,stripBOM:pa,inherits:ha,toFlatObject:ma,kindOf:gt,kindOfTest:Ie,endsWith:fa,toArray:va,forEachEntry:ba,matchAll:ya,isHTMLForm:_a,hasOwnProperty:Wt,hasOwnProp:Wt,reduceDescriptors:ys,freezeMethods:Sa,toObjectSet:ka,toCamelCase:$a,noop:Ta,toFiniteNumber:Pa,findKey:gs,global:Oe,isContextDefined:bs,isSpecCompliantForm:Ea,toJSONObject:Ca,isAsyncFn:Ia,isThenable:Ra,setImmediate:_s,asap:Aa,isIterable:xa};function te(o,e,n,s,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=o,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),s&&(this.request=s),a&&(this.response=a,this.status=a.status?a.status:null)}A.inherits(te,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:A.toJSONObject(this.config),code:this.code,status:this.status}}});const $s=te.prototype,ws={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(o=>{ws[o]={value:o}});Object.defineProperties(te,ws);Object.defineProperty($s,"isAxiosError",{value:!0});te.from=(o,e,n,s,a,r)=>{const i=Object.create($s);return A.toFlatObject(o,i,function(g){return g!==Error.prototype},h=>h!=="isAxiosError"),te.call(i,o.message,e,n,s,a),i.cause=o,i.name=o.name,r&&Object.assign(i,r),i};const Da=null;function At(o){return A.isPlainObject(o)||A.isArray(o)}function Ss(o){return A.endsWith(o,"[]")?o.slice(0,-2):o}function zt(o,e,n){return o?o.concat(e).map(function(a,r){return a=Ss(a),!n&&r?"["+a+"]":a}).join(n?".":""):e}function Ma(o){return A.isArray(o)&&!o.some(At)}const Fa=A.toFlatObject(A,{},null,function(e){return/^is[A-Z]/.test(e)});function _t(o,e,n){if(!A.isObject(o))throw new TypeError("target must be an object");e=e||new FormData,n=A.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(y,v){return!A.isUndefined(v[y])});const s=n.metaTokens,a=n.visitor||d,r=n.dots,i=n.indexes,g=(n.Blob||typeof Blob<"u"&&Blob)&&A.isSpecCompliantForm(e);if(!A.isFunction(a))throw new TypeError("visitor must be a function");function u(_){if(_===null)return"";if(A.isDate(_))return _.toISOString();if(!g&&A.isBlob(_))throw new te("Blob is not supported. Use a Buffer instead.");return A.isArrayBuffer(_)||A.isTypedArray(_)?g&&typeof Blob=="function"?new Blob([_]):Buffer.from(_):_}function d(_,y,v){let $=_;if(_&&!v&&typeof _=="object"){if(A.endsWith(y,"{}"))y=s?y:y.slice(0,-2),_=JSON.stringify(_);else if(A.isArray(_)&&Ma(_)||(A.isFileList(_)||A.endsWith(y,"[]"))&&($=A.toArray(_)))return y=Ss(y),$.forEach(function(S,I){!(A.isUndefined(S)||S===null)&&e.append(i===!0?zt([y],I,r):i===null?y:y+"[]",u(S))}),!1}return At(_)?!0:(e.append(zt(v,y,r),u(_)),!1)}const b=[],R=Object.assign(Fa,{defaultVisitor:d,convertValue:u,isVisitable:At});function M(_,y){if(!A.isUndefined(_)){if(b.indexOf(_)!==-1)throw Error("Circular reference detected in "+y.join("."));b.push(_),A.forEach(_,function($,E){(!(A.isUndefined($)||$===null)&&a.call(e,$,A.isString(E)?E.trim():E,y,R))===!0&&M($,y?y.concat(E):[E])}),b.pop()}}if(!A.isObject(o))throw new TypeError("data must be an object");return M(o),e}function Jt(o){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(o).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function Ot(o,e){this._pairs=[],o&&_t(o,this,e)}const ks=Ot.prototype;ks.append=function(e,n){this._pairs.push([e,n])};ks.toString=function(e){const n=e?function(s){return e.call(this,s,Jt)}:Jt;return this._pairs.map(function(a){return n(a[0])+"="+n(a[1])},"").join("&")};function Ua(o){return encodeURIComponent(o).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Ts(o,e,n){if(!e)return o;const s=n&&n.encode||Ua;A.isFunction(n)&&(n={serialize:n});const a=n&&n.serialize;let r;if(a?r=a(e,n):r=A.isURLSearchParams(e)?e.toString():new Ot(e,n).toString(s),r){const i=o.indexOf("#");i!==-1&&(o=o.slice(0,i)),o+=(o.indexOf("?")===-1?"?":"&")+r}return o}class Kt{constructor(){this.handlers=[]}use(e,n,s){return this.handlers.push({fulfilled:e,rejected:n,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){A.forEach(this.handlers,function(s){s!==null&&e(s)})}}const Ps={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Na=typeof URLSearchParams<"u"?URLSearchParams:Ot,La=typeof FormData<"u"?FormData:null,Ba=typeof Blob<"u"?Blob:null,Oa={isBrowser:!0,classes:{URLSearchParams:Na,FormData:La,Blob:Ba},protocols:["http","https","file","blob","url","data"]},qt=typeof window<"u"&&typeof document<"u",xt=typeof navigator=="object"&&navigator||void 0,qa=qt&&(!xt||["ReactNative","NativeScript","NS"].indexOf(xt.product)<0),ja=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Va=qt&&window.location.href||"http://localhost",Ha=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:qt,hasStandardBrowserEnv:qa,hasStandardBrowserWebWorkerEnv:ja,navigator:xt,origin:Va},Symbol.toStringTag,{value:"Module"})),be={...Ha,...Oa};function Ga(o,e){return _t(o,new be.classes.URLSearchParams,Object.assign({visitor:function(n,s,a,r){return be.isNode&&A.isBuffer(n)?(this.append(s,n.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},e))}function Wa(o){return A.matchAll(/\w+|\[(\w*)]/g,o).map(e=>e[0]==="[]"?"":e[1]||e[0])}function za(o){const e={},n=Object.keys(o);let s;const a=n.length;let r;for(s=0;s<a;s++)r=n[s],e[r]=o[r];return e}function Es(o){function e(n,s,a,r){let i=n[r++];if(i==="__proto__")return!0;const h=Number.isFinite(+i),g=r>=n.length;return i=!i&&A.isArray(a)?a.length:i,g?(A.hasOwnProp(a,i)?a[i]=[a[i],s]:a[i]=s,!h):((!a[i]||!A.isObject(a[i]))&&(a[i]=[]),e(n,s,a[i],r)&&A.isArray(a[i])&&(a[i]=za(a[i])),!h)}if(A.isFormData(o)&&A.isFunction(o.entries)){const n={};return A.forEachEntry(o,(s,a)=>{e(Wa(s),a,n,0)}),n}return null}function Ja(o,e,n){if(A.isString(o))try{return(e||JSON.parse)(o),A.trim(o)}catch(s){if(s.name!=="SyntaxError")throw s}return(n||JSON.stringify)(o)}const lt={transitional:Ps,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const s=n.getContentType()||"",a=s.indexOf("application/json")>-1,r=A.isObject(e);if(r&&A.isHTMLForm(e)&&(e=new FormData(e)),A.isFormData(e))return a?JSON.stringify(Es(e)):e;if(A.isArrayBuffer(e)||A.isBuffer(e)||A.isStream(e)||A.isFile(e)||A.isBlob(e)||A.isReadableStream(e))return e;if(A.isArrayBufferView(e))return e.buffer;if(A.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let h;if(r){if(s.indexOf("application/x-www-form-urlencoded")>-1)return Ga(e,this.formSerializer).toString();if((h=A.isFileList(e))||s.indexOf("multipart/form-data")>-1){const g=this.env&&this.env.FormData;return _t(h?{"files[]":e}:e,g&&new g,this.formSerializer)}}return r||a?(n.setContentType("application/json",!1),Ja(e)):e}],transformResponse:[function(e){const n=this.transitional||lt.transitional,s=n&&n.forcedJSONParsing,a=this.responseType==="json";if(A.isResponse(e)||A.isReadableStream(e))return e;if(e&&A.isString(e)&&(s&&!this.responseType||a)){const i=!(n&&n.silentJSONParsing)&&a;try{return JSON.parse(e)}catch(h){if(i)throw h.name==="SyntaxError"?te.from(h,te.ERR_BAD_RESPONSE,this,null,this.response):h}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:be.classes.FormData,Blob:be.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};A.forEach(["delete","get","head","post","put","patch"],o=>{lt.headers[o]={}});const Ka=A.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Xa=o=>{const e={};let n,s,a;return o&&o.split(`
`).forEach(function(i){a=i.indexOf(":"),n=i.substring(0,a).trim().toLowerCase(),s=i.substring(a+1).trim(),!(!n||e[n]&&Ka[n])&&(n==="set-cookie"?e[n]?e[n].push(s):e[n]=[s]:e[n]=e[n]?e[n]+", "+s:s)}),e},Xt=Symbol("internals");function Qe(o){return o&&String(o).trim().toLowerCase()}function ut(o){return o===!1||o==null?o:A.isArray(o)?o.map(ut):String(o)}function Ya(o){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=n.exec(o);)e[s[1]]=s[2];return e}const Qa=o=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(o.trim());function Pt(o,e,n,s,a){if(A.isFunction(s))return s.call(this,e,n);if(a&&(e=n),!!A.isString(e)){if(A.isString(s))return e.indexOf(s)!==-1;if(A.isRegExp(s))return s.test(e)}}function Za(o){return o.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,s)=>n.toUpperCase()+s)}function el(o,e){const n=A.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(o,s+n,{value:function(a,r,i){return this[s].call(this,e,a,r,i)},configurable:!0})})}let $e=class{constructor(e){e&&this.set(e)}set(e,n,s){const a=this;function r(h,g,u){const d=Qe(g);if(!d)throw new Error("header name must be a non-empty string");const b=A.findKey(a,d);(!b||a[b]===void 0||u===!0||u===void 0&&a[b]!==!1)&&(a[b||g]=ut(h))}const i=(h,g)=>A.forEach(h,(u,d)=>r(u,d,g));if(A.isPlainObject(e)||e instanceof this.constructor)i(e,n);else if(A.isString(e)&&(e=e.trim())&&!Qa(e))i(Xa(e),n);else if(A.isObject(e)&&A.isIterable(e)){let h={},g,u;for(const d of e){if(!A.isArray(d))throw TypeError("Object iterator must return a key-value pair");h[u=d[0]]=(g=h[u])?A.isArray(g)?[...g,d[1]]:[g,d[1]]:d[1]}i(h,n)}else e!=null&&r(n,e,s);return this}get(e,n){if(e=Qe(e),e){const s=A.findKey(this,e);if(s){const a=this[s];if(!n)return a;if(n===!0)return Ya(a);if(A.isFunction(n))return n.call(this,a,s);if(A.isRegExp(n))return n.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=Qe(e),e){const s=A.findKey(this,e);return!!(s&&this[s]!==void 0&&(!n||Pt(this,this[s],s,n)))}return!1}delete(e,n){const s=this;let a=!1;function r(i){if(i=Qe(i),i){const h=A.findKey(s,i);h&&(!n||Pt(s,s[h],h,n))&&(delete s[h],a=!0)}}return A.isArray(e)?e.forEach(r):r(e),a}clear(e){const n=Object.keys(this);let s=n.length,a=!1;for(;s--;){const r=n[s];(!e||Pt(this,this[r],r,e,!0))&&(delete this[r],a=!0)}return a}normalize(e){const n=this,s={};return A.forEach(this,(a,r)=>{const i=A.findKey(s,r);if(i){n[i]=ut(a),delete n[r];return}const h=e?Za(r):String(r).trim();h!==r&&delete n[r],n[h]=ut(a),s[h]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return A.forEach(this,(s,a)=>{s!=null&&s!==!1&&(n[a]=e&&A.isArray(s)?s.join(", "):s)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const s=new this(e);return n.forEach(a=>s.set(a)),s}static accessor(e){const s=(this[Xt]=this[Xt]={accessors:{}}).accessors,a=this.prototype;function r(i){const h=Qe(i);s[h]||(el(a,i),s[h]=!0)}return A.isArray(e)?e.forEach(r):r(e),this}};$e.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);A.reduceDescriptors($e.prototype,({value:o},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>o,set(s){this[n]=s}}});A.freezeMethods($e);function Et(o,e){const n=this||lt,s=e||n,a=$e.from(s.headers);let r=s.data;return A.forEach(o,function(h){r=h.call(n,r,a.normalize(),e?e.status:void 0)}),a.normalize(),r}function Cs(o){return!!(o&&o.__CANCEL__)}function Ke(o,e,n){te.call(this,o??"canceled",te.ERR_CANCELED,e,n),this.name="CanceledError"}A.inherits(Ke,te,{__CANCEL__:!0});function Is(o,e,n){const s=n.config.validateStatus;!n.status||!s||s(n.status)?o(n):e(new te("Request failed with status code "+n.status,[te.ERR_BAD_REQUEST,te.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function tl(o){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(o);return e&&e[1]||""}function sl(o,e){o=o||10;const n=new Array(o),s=new Array(o);let a=0,r=0,i;return e=e!==void 0?e:1e3,function(g){const u=Date.now(),d=s[r];i||(i=u),n[a]=g,s[a]=u;let b=r,R=0;for(;b!==a;)R+=n[b++],b=b%o;if(a=(a+1)%o,a===r&&(r=(r+1)%o),u-i<e)return;const M=d&&u-d;return M?Math.round(R*1e3/M):void 0}}function nl(o,e){let n=0,s=1e3/e,a,r;const i=(u,d=Date.now())=>{n=d,a=null,r&&(clearTimeout(r),r=null),o.apply(null,u)};return[(...u)=>{const d=Date.now(),b=d-n;b>=s?i(u,d):(a=u,r||(r=setTimeout(()=>{r=null,i(a)},s-b)))},()=>a&&i(a)]}const mt=(o,e,n=3)=>{let s=0;const a=sl(50,250);return nl(r=>{const i=r.loaded,h=r.lengthComputable?r.total:void 0,g=i-s,u=a(g),d=i<=h;s=i;const b={loaded:i,total:h,progress:h?i/h:void 0,bytes:g,rate:u||void 0,estimated:u&&h&&d?(h-i)/u:void 0,event:r,lengthComputable:h!=null,[e?"download":"upload"]:!0};o(b)},n)},Yt=(o,e)=>{const n=o!=null;return[s=>e[0]({lengthComputable:n,total:o,loaded:s}),e[1]]},Qt=o=>(...e)=>A.asap(()=>o(...e)),ol=be.hasStandardBrowserEnv?((o,e)=>n=>(n=new URL(n,be.origin),o.protocol===n.protocol&&o.host===n.host&&(e||o.port===n.port)))(new URL(be.origin),be.navigator&&/(msie|trident)/i.test(be.navigator.userAgent)):()=>!0,al=be.hasStandardBrowserEnv?{write(o,e,n,s,a,r){const i=[o+"="+encodeURIComponent(e)];A.isNumber(n)&&i.push("expires="+new Date(n).toGMTString()),A.isString(s)&&i.push("path="+s),A.isString(a)&&i.push("domain="+a),r===!0&&i.push("secure"),document.cookie=i.join("; ")},read(o){const e=document.cookie.match(new RegExp("(^|;\\s*)("+o+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(o){this.write(o,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function ll(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)}function rl(o,e){return e?o.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):o}function Rs(o,e,n){let s=!ll(e);return o&&(s||n==!1)?rl(o,e):e}const Zt=o=>o instanceof $e?{...o}:o;function Ve(o,e){e=e||{};const n={};function s(u,d,b,R){return A.isPlainObject(u)&&A.isPlainObject(d)?A.merge.call({caseless:R},u,d):A.isPlainObject(d)?A.merge({},d):A.isArray(d)?d.slice():d}function a(u,d,b,R){if(A.isUndefined(d)){if(!A.isUndefined(u))return s(void 0,u,b,R)}else return s(u,d,b,R)}function r(u,d){if(!A.isUndefined(d))return s(void 0,d)}function i(u,d){if(A.isUndefined(d)){if(!A.isUndefined(u))return s(void 0,u)}else return s(void 0,d)}function h(u,d,b){if(b in e)return s(u,d);if(b in o)return s(void 0,u)}const g={url:r,method:r,data:r,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:h,headers:(u,d,b)=>a(Zt(u),Zt(d),b,!0)};return A.forEach(Object.keys(Object.assign({},o,e)),function(d){const b=g[d]||a,R=b(o[d],e[d],d);A.isUndefined(R)&&b!==h||(n[d]=R)}),n}const As=o=>{const e=Ve({},o);let{data:n,withXSRFToken:s,xsrfHeaderName:a,xsrfCookieName:r,headers:i,auth:h}=e;e.headers=i=$e.from(i),e.url=Ts(Rs(e.baseURL,e.url,e.allowAbsoluteUrls),o.params,o.paramsSerializer),h&&i.set("Authorization","Basic "+btoa((h.username||"")+":"+(h.password?unescape(encodeURIComponent(h.password)):"")));let g;if(A.isFormData(n)){if(be.hasStandardBrowserEnv||be.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if((g=i.getContentType())!==!1){const[u,...d]=g?g.split(";").map(b=>b.trim()).filter(Boolean):[];i.setContentType([u||"multipart/form-data",...d].join("; "))}}if(be.hasStandardBrowserEnv&&(s&&A.isFunction(s)&&(s=s(e)),s||s!==!1&&ol(e.url))){const u=a&&r&&al.read(r);u&&i.set(a,u)}return e},il=typeof XMLHttpRequest<"u",cl=il&&function(o){return new Promise(function(n,s){const a=As(o);let r=a.data;const i=$e.from(a.headers).normalize();let{responseType:h,onUploadProgress:g,onDownloadProgress:u}=a,d,b,R,M,_;function y(){M&&M(),_&&_(),a.cancelToken&&a.cancelToken.unsubscribe(d),a.signal&&a.signal.removeEventListener("abort",d)}let v=new XMLHttpRequest;v.open(a.method.toUpperCase(),a.url,!0),v.timeout=a.timeout;function $(){if(!v)return;const S=$e.from("getAllResponseHeaders"in v&&v.getAllResponseHeaders()),m={data:!h||h==="text"||h==="json"?v.responseText:v.response,status:v.status,statusText:v.statusText,headers:S,config:o,request:v};Is(function(D){n(D),y()},function(D){s(D),y()},m),v=null}"onloadend"in v?v.onloadend=$:v.onreadystatechange=function(){!v||v.readyState!==4||v.status===0&&!(v.responseURL&&v.responseURL.indexOf("file:")===0)||setTimeout($)},v.onabort=function(){v&&(s(new te("Request aborted",te.ECONNABORTED,o,v)),v=null)},v.onerror=function(){s(new te("Network Error",te.ERR_NETWORK,o,v)),v=null},v.ontimeout=function(){let I=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const m=a.transitional||Ps;a.timeoutErrorMessage&&(I=a.timeoutErrorMessage),s(new te(I,m.clarifyTimeoutError?te.ETIMEDOUT:te.ECONNABORTED,o,v)),v=null},r===void 0&&i.setContentType(null),"setRequestHeader"in v&&A.forEach(i.toJSON(),function(I,m){v.setRequestHeader(m,I)}),A.isUndefined(a.withCredentials)||(v.withCredentials=!!a.withCredentials),h&&h!=="json"&&(v.responseType=a.responseType),u&&([R,_]=mt(u,!0),v.addEventListener("progress",R)),g&&v.upload&&([b,M]=mt(g),v.upload.addEventListener("progress",b),v.upload.addEventListener("loadend",M)),(a.cancelToken||a.signal)&&(d=S=>{v&&(s(!S||S.type?new Ke(null,o,v):S),v.abort(),v=null)},a.cancelToken&&a.cancelToken.subscribe(d),a.signal&&(a.signal.aborted?d():a.signal.addEventListener("abort",d)));const E=tl(a.url);if(E&&be.protocols.indexOf(E)===-1){s(new te("Unsupported protocol "+E+":",te.ERR_BAD_REQUEST,o));return}v.send(r||null)})},dl=(o,e)=>{const{length:n}=o=o?o.filter(Boolean):[];if(e||n){let s=new AbortController,a;const r=function(u){if(!a){a=!0,h();const d=u instanceof Error?u:this.reason;s.abort(d instanceof te?d:new Ke(d instanceof Error?d.message:d))}};let i=e&&setTimeout(()=>{i=null,r(new te(`timeout ${e} of ms exceeded`,te.ETIMEDOUT))},e);const h=()=>{o&&(i&&clearTimeout(i),i=null,o.forEach(u=>{u.unsubscribe?u.unsubscribe(r):u.removeEventListener("abort",r)}),o=null)};o.forEach(u=>u.addEventListener("abort",r));const{signal:g}=s;return g.unsubscribe=()=>A.asap(h),g}},ul=function*(o,e){let n=o.byteLength;if(n<e){yield o;return}let s=0,a;for(;s<n;)a=s+e,yield o.slice(s,a),s=a},pl=async function*(o,e){for await(const n of hl(o))yield*ul(n,e)},hl=async function*(o){if(o[Symbol.asyncIterator]){yield*o;return}const e=o.getReader();try{for(;;){const{done:n,value:s}=await e.read();if(n)break;yield s}}finally{await e.cancel()}},es=(o,e,n,s)=>{const a=pl(o,e);let r=0,i,h=g=>{i||(i=!0,s&&s(g))};return new ReadableStream({async pull(g){try{const{done:u,value:d}=await a.next();if(u){h(),g.close();return}let b=d.byteLength;if(n){let R=r+=b;n(R)}g.enqueue(new Uint8Array(d))}catch(u){throw h(u),u}},cancel(g){return h(g),a.return()}},{highWaterMark:2})},$t=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",xs=$t&&typeof ReadableStream=="function",ml=$t&&(typeof TextEncoder=="function"?(o=>e=>o.encode(e))(new TextEncoder):async o=>new Uint8Array(await new Response(o).arrayBuffer())),Ds=(o,...e)=>{try{return!!o(...e)}catch{return!1}},fl=xs&&Ds(()=>{let o=!1;const e=new Request(be.origin,{body:new ReadableStream,method:"POST",get duplex(){return o=!0,"half"}}).headers.has("Content-Type");return o&&!e}),ts=64*1024,Dt=xs&&Ds(()=>A.isReadableStream(new Response("").body)),ft={stream:Dt&&(o=>o.body)};$t&&(o=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!ft[e]&&(ft[e]=A.isFunction(o[e])?n=>n[e]():(n,s)=>{throw new te(`Response type '${e}' is not supported`,te.ERR_NOT_SUPPORT,s)})})})(new Response);const vl=async o=>{if(o==null)return 0;if(A.isBlob(o))return o.size;if(A.isSpecCompliantForm(o))return(await new Request(be.origin,{method:"POST",body:o}).arrayBuffer()).byteLength;if(A.isArrayBufferView(o)||A.isArrayBuffer(o))return o.byteLength;if(A.isURLSearchParams(o)&&(o=o+""),A.isString(o))return(await ml(o)).byteLength},gl=async(o,e)=>{const n=A.toFiniteNumber(o.getContentLength());return n??vl(e)},bl=$t&&(async o=>{let{url:e,method:n,data:s,signal:a,cancelToken:r,timeout:i,onDownloadProgress:h,onUploadProgress:g,responseType:u,headers:d,withCredentials:b="same-origin",fetchOptions:R}=As(o);u=u?(u+"").toLowerCase():"text";let M=dl([a,r&&r.toAbortSignal()],i),_;const y=M&&M.unsubscribe&&(()=>{M.unsubscribe()});let v;try{if(g&&fl&&n!=="get"&&n!=="head"&&(v=await gl(d,s))!==0){let m=new Request(e,{method:"POST",body:s,duplex:"half"}),q;if(A.isFormData(s)&&(q=m.headers.get("content-type"))&&d.setContentType(q),m.body){const[D,W]=Yt(v,mt(Qt(g)));s=es(m.body,ts,D,W)}}A.isString(b)||(b=b?"include":"omit");const $="credentials"in Request.prototype;_=new Request(e,{...R,signal:M,method:n.toUpperCase(),headers:d.normalize().toJSON(),body:s,duplex:"half",credentials:$?b:void 0});let E=await fetch(_);const S=Dt&&(u==="stream"||u==="response");if(Dt&&(h||S&&y)){const m={};["status","statusText","headers"].forEach(C=>{m[C]=E[C]});const q=A.toFiniteNumber(E.headers.get("content-length")),[D,W]=h&&Yt(q,mt(Qt(h),!0))||[];E=new Response(es(E.body,ts,D,()=>{W&&W(),y&&y()}),m)}u=u||"text";let I=await ft[A.findKey(ft,u)||"text"](E,o);return!S&&y&&y(),await new Promise((m,q)=>{Is(m,q,{data:I,headers:$e.from(E.headers),status:E.status,statusText:E.statusText,config:o,request:_})})}catch($){throw y&&y(),$&&$.name==="TypeError"&&/Load failed|fetch/i.test($.message)?Object.assign(new te("Network Error",te.ERR_NETWORK,o,_),{cause:$.cause||$}):te.from($,$&&$.code,o,_)}}),Mt={http:Da,xhr:cl,fetch:bl};A.forEach(Mt,(o,e)=>{if(o){try{Object.defineProperty(o,"name",{value:e})}catch{}Object.defineProperty(o,"adapterName",{value:e})}});const ss=o=>`- ${o}`,yl=o=>A.isFunction(o)||o===null||o===!1,Ms={getAdapter:o=>{o=A.isArray(o)?o:[o];const{length:e}=o;let n,s;const a={};for(let r=0;r<e;r++){n=o[r];let i;if(s=n,!yl(n)&&(s=Mt[(i=String(n)).toLowerCase()],s===void 0))throw new te(`Unknown adapter '${i}'`);if(s)break;a[i||"#"+r]=s}if(!s){const r=Object.entries(a).map(([h,g])=>`adapter ${h} `+(g===!1?"is not supported by the environment":"is not available in the build"));let i=e?r.length>1?`since :
`+r.map(ss).join(`
`):" "+ss(r[0]):"as no adapter specified";throw new te("There is no suitable adapter to dispatch the request "+i,"ERR_NOT_SUPPORT")}return s},adapters:Mt};function Ct(o){if(o.cancelToken&&o.cancelToken.throwIfRequested(),o.signal&&o.signal.aborted)throw new Ke(null,o)}function ns(o){return Ct(o),o.headers=$e.from(o.headers),o.data=Et.call(o,o.transformRequest),["post","put","patch"].indexOf(o.method)!==-1&&o.headers.setContentType("application/x-www-form-urlencoded",!1),Ms.getAdapter(o.adapter||lt.adapter)(o).then(function(s){return Ct(o),s.data=Et.call(o,o.transformResponse,s),s.headers=$e.from(s.headers),s},function(s){return Cs(s)||(Ct(o),s&&s.response&&(s.response.data=Et.call(o,o.transformResponse,s.response),s.response.headers=$e.from(s.response.headers))),Promise.reject(s)})}const Fs="1.9.0",wt={};["object","boolean","number","function","string","symbol"].forEach((o,e)=>{wt[o]=function(s){return typeof s===o||"a"+(e<1?"n ":" ")+o}});const os={};wt.transitional=function(e,n,s){function a(r,i){return"[Axios v"+Fs+"] Transitional option '"+r+"'"+i+(s?". "+s:"")}return(r,i,h)=>{if(e===!1)throw new te(a(i," has been removed"+(n?" in "+n:"")),te.ERR_DEPRECATED);return n&&!os[i]&&(os[i]=!0,console.warn(a(i," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(r,i,h):!0}};wt.spelling=function(e){return(n,s)=>(console.warn(`${s} is likely a misspelling of ${e}`),!0)};function _l(o,e,n){if(typeof o!="object")throw new te("options must be an object",te.ERR_BAD_OPTION_VALUE);const s=Object.keys(o);let a=s.length;for(;a-- >0;){const r=s[a],i=e[r];if(i){const h=o[r],g=h===void 0||i(h,r,o);if(g!==!0)throw new te("option "+r+" must be "+g,te.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new te("Unknown option "+r,te.ERR_BAD_OPTION)}}const pt={assertOptions:_l,validators:wt},Ae=pt.validators;let je=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Kt,response:new Kt}}async request(e,n){try{return await this._request(e,n)}catch(s){if(s instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const r=a.stack?a.stack.replace(/^.+\n/,""):"";try{s.stack?r&&!String(s.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+r):s.stack=r}catch{}}throw s}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=Ve(this.defaults,n);const{transitional:s,paramsSerializer:a,headers:r}=n;s!==void 0&&pt.assertOptions(s,{silentJSONParsing:Ae.transitional(Ae.boolean),forcedJSONParsing:Ae.transitional(Ae.boolean),clarifyTimeoutError:Ae.transitional(Ae.boolean)},!1),a!=null&&(A.isFunction(a)?n.paramsSerializer={serialize:a}:pt.assertOptions(a,{encode:Ae.function,serialize:Ae.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),pt.assertOptions(n,{baseUrl:Ae.spelling("baseURL"),withXsrfToken:Ae.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let i=r&&A.merge(r.common,r[n.method]);r&&A.forEach(["delete","get","head","post","put","patch","common"],_=>{delete r[_]}),n.headers=$e.concat(i,r);const h=[];let g=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(n)===!1||(g=g&&y.synchronous,h.unshift(y.fulfilled,y.rejected))});const u=[];this.interceptors.response.forEach(function(y){u.push(y.fulfilled,y.rejected)});let d,b=0,R;if(!g){const _=[ns.bind(this),void 0];for(_.unshift.apply(_,h),_.push.apply(_,u),R=_.length,d=Promise.resolve(n);b<R;)d=d.then(_[b++],_[b++]);return d}R=h.length;let M=n;for(b=0;b<R;){const _=h[b++],y=h[b++];try{M=_(M)}catch(v){y.call(this,v);break}}try{d=ns.call(this,M)}catch(_){return Promise.reject(_)}for(b=0,R=u.length;b<R;)d=d.then(u[b++],u[b++]);return d}getUri(e){e=Ve(this.defaults,e);const n=Rs(e.baseURL,e.url,e.allowAbsoluteUrls);return Ts(n,e.params,e.paramsSerializer)}};A.forEach(["delete","get","head","options"],function(e){je.prototype[e]=function(n,s){return this.request(Ve(s||{},{method:e,url:n,data:(s||{}).data}))}});A.forEach(["post","put","patch"],function(e){function n(s){return function(r,i,h){return this.request(Ve(h||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:r,data:i}))}}je.prototype[e]=n(),je.prototype[e+"Form"]=n(!0)});let $l=class Us{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(r){n=r});const s=this;this.promise.then(a=>{if(!s._listeners)return;let r=s._listeners.length;for(;r-- >0;)s._listeners[r](a);s._listeners=null}),this.promise.then=a=>{let r;const i=new Promise(h=>{s.subscribe(h),r=h}).then(a);return i.cancel=function(){s.unsubscribe(r)},i},e(function(r,i,h){s.reason||(s.reason=new Ke(r,i,h),n(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=s=>{e.abort(s)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new Us(function(a){e=a}),cancel:e}}};function wl(o){return function(n){return o.apply(null,n)}}function Sl(o){return A.isObject(o)&&o.isAxiosError===!0}const Ft={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ft).forEach(([o,e])=>{Ft[e]=o});function Ns(o){const e=new je(o),n=hs(je.prototype.request,e);return A.extend(n,je.prototype,e,{allOwnKeys:!0}),A.extend(n,e,null,{allOwnKeys:!0}),n.create=function(a){return Ns(Ve(o,a))},n}const ve=Ns(lt);ve.Axios=je;ve.CanceledError=Ke;ve.CancelToken=$l;ve.isCancel=Cs;ve.VERSION=Fs;ve.toFormData=_t;ve.AxiosError=te;ve.Cancel=ve.CanceledError;ve.all=function(e){return Promise.all(e)};ve.spread=wl;ve.isAxiosError=Sl;ve.mergeConfig=Ve;ve.AxiosHeaders=$e;ve.formToJSON=o=>Es(A.isHTMLForm(o)?new FormData(o):o);ve.getAdapter=Ms.getAdapter;ve.HttpStatusCode=Ft;ve.default=ve;const{Axios:Tg,AxiosError:Pg,CanceledError:Eg,isCancel:Cg,CancelToken:Ig,VERSION:Rg,all:Ag,Cancel:xg,isAxiosError:Dg,spread:Mg,toFormData:Fg,AxiosHeaders:Ug,HttpStatusCode:Ng,formToJSON:Lg,getAdapter:Bg,mergeConfig:Og}=ve;class kl{static async getAvailableModels(){try{return(await ve({url:"/api/models/available-models",method:"GET",baseURL:""})).data}catch(e){return console.error("Failed to fetch available models:",e),{options:[],total:0}}}}const Tl={class:"config-section"},Pl={class:"section-header"},El={key:0,class:"error-section"},Cl={class:"error-message"},Il={class:"error-content"},Rl={class:"error-title"},Al={class:"error-description"},xl={key:1,class:"visual-editor"},Dl={class:"plan-basic-info"},Ml={class:"form-row"},Fl={class:"form-label"},Ul=["placeholder"],Nl={key:0,class:"field-error-message"},Ll={class:"form-row"},Bl={class:"form-label"},Ol=["value","placeholder"],ql={class:"steps-section"},jl={class:"steps-header"},Vl={class:"form-label"},Hl={class:"steps-actions"},Gl=["title"],Wl={class:"steps-container"},zl={class:"step-header"},Jl={class:"step-number"},Kl={class:"step-actions"},Xl=["onClick","disabled","title"],Yl=["onClick","disabled","title"],Ql=["onClick","title"],Zl={class:"step-content"},er={class:"form-row"},tr={class:"form-label"},sr=["onUpdate:modelValue","placeholder"],nr={class:"form-row"},or={class:"form-label"},ar=["onUpdate:modelValue","placeholder"],lr={class:"form-row"},rr={class:"form-label"},ir={class:"model-selector"},cr=["onUpdate:modelValue","disabled"],dr={key:0,disabled:"",value:""},ur={key:1,disabled:"",value:""},pr={value:"",disabled:""},hr={value:""},mr=["value","title"],fr=["title"],vr={key:0,class:"error-message"},gr={class:"form-row"},br={key:0,class:"empty-steps"},yr={key:0,class:"json-preview"},_r={class:"preview-header"},$r={class:"form-label"},wr={class:"json-code"},Sr={class:"editor-footer"},kr={class:"section-actions"},Tr=["disabled","title"],Pr=["disabled","title"],Er=["disabled"],Cr=pe({__name:"JsonEditorV2",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},hiddenFields:{default:()=>[]},currentPlanTemplateId:{default:""}},emits:["rollback","restore","save","update:jsonContent"],setup(o,{emit:e}){const n=o,s=e,{showJsonPreview:a,parsedData:r,formattedJsonOutput:i,addStep:h,removeStep:g,moveStepUp:u,moveStepDown:d,handleRollback:b,handleRestore:R,handleSave:M,toggleJsonPreview:_,closeJsonPreview:y}=ps(n,s),v=F(null),$=F(""),E=F([]),S=F(!1),I=F(""),m=F(!1),q=F(-1),D=async()=>{if(!S.value){S.value=!0,I.value="";try{const P=await kl.getAvailableModels();P&&P.options?E.value=P.options:E.value=[]}catch(P){console.error("Failed to load models:",P),I.value=P instanceof Error?P.message:"Failed to load models",E.value=[]}finally{S.value=!1}}},W=P=>{q.value=P,m.value=!0,console.log("[JsonEditorV2] Available tools from store:",H.availableTools)},C=P=>{q.value>=0&&q.value<r.steps.length&&(r.steps[q.value].selectedToolKeys=[...P]),m.value=!1,q.value=-1},U=(P,x)=>{P>=0&&P<r.steps.length&&(r.steps[P].selectedToolKeys=[...x])},z=()=>{try{v.value=null,r.title||(r.title=""),r.steps||(r.steps=[]),r.directResponse=!1}catch(P){const x=`Failed to initialize JsonEditorV2: ${P instanceof Error?P.message:"Unknown error"}`;v.value=x,console.error(x,P)}};de(()=>r,P=>{try{!P.title||!P.title.trim()?$.value="Title is required field":$.value="",v.value=null}catch(x){v.value=`Invalid data structure: ${x instanceof Error?x.message:"Unknown error"}`,$.value=""}},{immediate:!0,deep:!0}),we(()=>{z(),D()});const Q=P=>{const x=P.target;if(!x)return;x.style.height="auto";const B=20,J=Math.ceil(x.scrollHeight/B),Z=4,ee=12,me=Math.max(Z,Math.min(ee,J)),G=me*B;x.style.height=`${G}px`,x.rows=me,J>ee?x.style.overflowY="auto":x.style.overflowY="hidden"};return(P,x)=>{var B;return p(),f("div",Tl,[t("div",Pl,[w(l(T),{icon:"carbon:code",width:"16"}),t("span",null,c(P.$t("sidebar.dynamicAgentPlan")),1)]),v.value?(p(),f("div",El,[t("div",Cl,[w(l(T),{icon:"carbon:warning",width:"16"}),t("div",Il,[t("div",Rl,c(P.$t("sidebar.planTypeError")),1),t("div",Al,c(v.value),1)])])])):(p(),f("div",xl,[t("div",Dl,[t("div",Ml,[t("label",Fl,c(P.$t("sidebar.title")),1),se(t("input",{"onUpdate:modelValue":x[0]||(x[0]=J=>l(r).title=J),type:"text",class:oe(["form-input",{error:$.value}]),placeholder:P.$t("sidebar.titlePlaceholder")},null,10,Ul),[[re,l(r).title]]),$.value?(p(),f("div",Nl,[w(l(T),{icon:"carbon:warning",width:"12"}),ne(" "+c($.value),1)])):L("",!0)]),t("div",Ll,[t("label",Bl,c(P.$t("sidebar.planTemplateId")),1),t("input",{value:P.currentPlanTemplateId,type:"text",class:"form-input readonly-input",readonly:"",placeholder:P.$t("sidebar.planTemplateIdPlaceholder")},null,8,Ol)])]),t("div",ql,[t("div",jl,[t("label",Vl,c(P.$t("sidebar.tasks")),1),t("div",Hl,[t("button",{onClick:x[1]||(x[1]=(...J)=>l(h)&&l(h)(...J)),class:"btn btn-xs",title:P.$t("sidebar.addStep")},[w(l(T),{icon:"carbon:add",width:"12"})],8,Gl)])]),t("div",Wl,[(p(!0),f(ae,null,ie(l(r).steps,(J,Z)=>(p(),f("div",{key:Z,class:"step-item"},[t("div",zl,[t("span",Jl,c(P.$t("sidebar.subtask"))+" "+c(Z+1),1),t("div",Kl,[t("button",{onClick:ee=>l(u)(Z),disabled:Z===0,class:"btn btn-xs",title:P.$t("sidebar.moveUp")},[w(l(T),{icon:"carbon:chevron-up",width:"12"})],8,Xl),t("button",{onClick:ee=>l(d)(Z),disabled:Z===l(r).steps.length-1,class:"btn btn-xs",title:P.$t("sidebar.moveDown")},[w(l(T),{icon:"carbon:chevron-down",width:"12"})],8,Yl),t("button",{onClick:ee=>l(g)(Z),class:"btn btn-xs btn-danger",title:P.$t("sidebar.removeStep")},[w(l(T),{icon:"carbon:trash-can",width:"12"})],8,Ql)])]),t("div",Zl,[t("div",er,[t("label",tr,c(P.$t("sidebar.stepRequirement")),1),se(t("textarea",{"onUpdate:modelValue":ee=>J.stepRequirement=ee,class:"form-textarea auto-resize",placeholder:P.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:x[2]||(x[2]=ee=>Q(ee))},null,40,sr),[[re,J.stepRequirement]])]),t("div",nr,[t("label",or,c(P.$t("sidebar.terminateColumns")),1),se(t("textarea",{"onUpdate:modelValue":ee=>J.terminateColumns=ee,class:"form-textarea auto-resize",placeholder:P.$t("sidebar.terminateColumnsPlaceholder"),rows:"4",onInput:x[3]||(x[3]=ee=>Q(ee))},null,40,ar),[[re,J.terminateColumns]])]),t("div",lr,[t("label",rr,c(P.$t("sidebar.modelName")),1),t("div",ir,[se(t("select",{"onUpdate:modelValue":ee=>J.modelName=ee,class:"form-select model-select",disabled:S.value},[S.value?(p(),f("option",dr,c(P.$t("sidebar.loading")),1)):I.value?(p(),f("option",ur,c(P.$t("sidebar.modelLoadError")),1)):L("",!0),t("option",pr,c(P.$t("sidebar.modelNameDescription")),1),t("option",hr,c(P.$t("sidebar.noModelSelected")),1),(p(!0),f(ae,null,ie(E.value,ee=>(p(),f("option",{key:ee.value,value:ee.value,title:ee.label},c(ee.label),9,mr))),128))],8,cr),[[ot,J.modelName]]),I.value?(p(),f("button",{key:0,onClick:D,class:"btn btn-sm btn-danger",title:P.$t("sidebar.retryLoadModels")},[w(l(T),{icon:"carbon:warning",width:"14"}),ne(" "+c(P.$t("sidebar.retry")),1)],8,fr)):L("",!0)]),I.value?(p(),f("div",vr,[w(l(T),{icon:"carbon:warning",width:"12"}),ne(" "+c(I.value),1)])):L("",!0)]),t("div",gr,[w(zs,{title:P.$t("sidebar.selectedTools"),"selected-tool-ids":J.selectedToolKeys,"available-tools":l(H).availableTools,"add-button-text":P.$t("sidebar.addRemoveTools"),"empty-text":P.$t("sidebar.noTools"),"use-grid-layout":!0,onAddTools:ee=>W(Z),onToolsFiltered:ee=>U(Z,ee)},null,8,["title","selected-tool-ids","available-tools","add-button-text","empty-text","onAddTools","onToolsFiltered"])])])]))),128)),l(r).steps.length===0?(p(),f("div",br,[w(l(T),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),t("p",null,c(P.$t("sidebar.noSteps")),1),t("button",{onClick:x[4]||(x[4]=(...J)=>l(h)&&l(h)(...J)),class:"btn btn-primary"},[w(l(T),{icon:"carbon:add",width:"14"}),ne(" "+c(P.$t("sidebar.addFirstStep")),1)])])):L("",!0)])]),l(a)?(p(),f("div",yr,[t("div",_r,[t("label",$r,c(P.$t("sidebar.jsonPreview")),1),t("button",{onClick:x[5]||(x[5]=(...J)=>l(y)&&l(y)(...J)),class:"btn btn-xs"},[w(l(T),{icon:"carbon:close",width:"12"})])]),t("pre",wr,c(l(i)),1)])):L("",!0),t("div",Sr,[t("button",{onClick:x[6]||(x[6]=(...J)=>l(_)&&l(_)(...J)),class:"btn btn-sm btn-secondary"},[w(l(T),{icon:"carbon:code",width:"14"}),ne(" "+c(l(a)?P.$t("sidebar.hideJson"):P.$t("sidebar.showJson")),1)]),t("div",kr,[t("button",{class:"btn btn-sm",onClick:x[7]||(x[7]=(...J)=>l(b)&&l(b)(...J)),disabled:!(P.canRollback??!1),title:P.$t("sidebar.rollback")},[w(l(T),{icon:"carbon:undo",width:"14"})],8,Tr),t("button",{class:"btn btn-sm",onClick:x[8]||(x[8]=(...J)=>l(R)&&l(R)(...J)),disabled:!(P.canRestore??!1),title:P.$t("sidebar.restore")},[w(l(T),{icon:"carbon:redo",width:"14"})],8,Pr),t("button",{class:"btn btn-primary",onClick:x[9]||(x[9]=(...J)=>l(M)&&l(M)(...J)),disabled:P.isGenerating||P.isExecuting},[w(l(T),{icon:"carbon:save",width:"14"}),x[11]||(x[11]=ne(" Save "))],8,Er)])])])),w(Js,{modelValue:m.value,"onUpdate:modelValue":x[10]||(x[10]=J=>m.value=J),tools:l(H).availableTools,"selected-tool-ids":q.value>=0?((B=l(r).steps[q.value])==null?void 0:B.selectedToolKeys)||[]:[],onConfirm:C},null,8,["modelValue","tools","selected-tool-ids"])])}}}),Ir=he(Cr,[["__scopeId","data-v-78f28b1a"]]),Rr={class:"config-section"},Ar={class:"section-header"},xr={class:"execution-content"},Dr={class:"params-requirements-group"},Mr={class:"params-help-text"},Fr={key:0,class:"parameter-fields"},Ur={class:"parameter-label"},Nr=["onUpdate:modelValue","placeholder","onInput"],Lr={key:0,class:"parameter-error"},Br={key:1,class:"validation-message"},Or=["disabled"],qr=["disabled"],jr={key:1,class:"call-example-wrapper"},Vr={class:"call-example-header"},Hr={class:"call-example-title"},Gr={class:"call-example-description"},Wr={class:"internal-call-wrapper"},zr={class:"call-info"},Jr={class:"call-method"},Kr={class:"call-endpoint"},Xr={key:0,class:"call-endpoint"},Yr={class:"call-description"},Qr={class:"call-example"},Zr={class:"example-code"},ei={key:2,class:"call-example-wrapper"},ti={class:"call-example-header"},si={class:"call-example-title"},ni={class:"call-example-description"},oi={class:"http-api-urls-wrapper"},ai={class:"tab-container"},li={class:"tab-header"},ri=["onClick"],ii={class:"tab-content"},ci={class:"http-api-url-display"},di={class:"api-method"},ui={class:"api-endpoint"},pi={class:"api-description"},hi={key:0,class:"api-example"},mi={class:"example-code"},fi={key:3,class:"call-example-wrapper"},vi={class:"call-example-header"},gi={class:"call-example-title"},bi={class:"call-example-description"},yi={class:"mcp-call-wrapper"},_i={class:"call-info"},$i={class:"call-method"},wi={class:"call-endpoint"},Si={class:"call-description"},ki={class:"call-example"},Ti={class:"example-code"},Pi=pe({__name:"ExecutionController",props:{currentPlanTemplateId:{default:""},isExecuting:{type:Boolean,default:!1},isGenerating:{type:Boolean,default:!1},showPublishButton:{type:Boolean,default:!0},toolInfo:{default:()=>({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""})}},emits:["executePlan","publishMcpService","clearParams","updateExecutionParams"],setup(o,{expose:e,emit:n}){const{t:s}=Pe(),a=o,r=n,i=F(""),h=F({parameters:[],hasParameters:!1,requirements:""}),g=F({}),u=F(!1),d=F("get-sync"),b=F({}),R=F(!1),M=F([{id:"get-sync",label:"GET + Sync",method:"GET",endpoint:"/api/executor/executeByToolNameSync/{toolName}",description:"Synchronous GET request - returns execution result immediately",example:`GET /api/executor/executeByToolNameSync/my-tool?allParams={"rawParam":"test"}
Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-sync",label:"POST + Sync",method:"POST",endpoint:"/api/executor/executeByToolNameSync",description:"Synchronous POST request - returns execution result immediately",example:`POST /api/executor/executeByToolNameSync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-async",label:"POST + Async",method:"POST",endpoint:"/api/executor/executeByToolNameAsync",description:"Asynchronous POST request - returns task ID, check status separately",example:`POST /api/executor/executeByToolNameAsync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "planId": "plan-123",
  "status": "processing",
  "message": "Task submitted, processing",
  "memoryId": "ABC12345",
  "toolName": "my-tool",
  "planTemplateId": "template-456"
}

# Check execution status and get detailed results:
GET /api/executor/details/{planId}
Response: {
  "currentPlanId": "plan-123",
  "title": "Plan Title",
  "status": "completed",
  "summary": "Execution completed successfully",
  "agentExecutionSequence": [...],
  "userInputWaitState": null
}`}]),_=ue(()=>{var W,C,U;return((W=a.toolInfo)==null?void 0:W.enableInternalToolcall)||((C=a.toolInfo)==null?void 0:C.enableHttpService)||((U=a.toolInfo)==null?void 0:U.enableMcpService)}),y=ue(()=>_.value?s("sidebar.updateServiceStatus"):s("sidebar.publishMcpService")),v=ue(()=>a.isExecuting||a.isGenerating?!1:h.value.hasParameters?h.value.parameters.every(W=>{var C;return(C=g.value[W])==null?void 0:C.trim()}):!0),$=()=>{if(!q()){console.log("[ExecutionController] Parameter validation failed:",b.value);return}const W=h.value.hasParameters&&Object.keys(g.value).length>0?g.value:void 0;r("executePlan",W)},E=()=>{r("publishMcpService")},S=()=>{i.value="",r("clearParams")},I=async()=>{if(!a.currentPlanTemplateId){h.value={parameters:[],hasParameters:!1,requirements:""},g.value={};return}u.value=!0;try{const W=await Lt.getParameterRequirements(a.currentPlanTemplateId);h.value=W;const C={};W.parameters.forEach(U=>{C[U]=g.value[U]||""}),g.value=C,D()}catch(W){console.error("Failed to load parameter requirements:",W),W instanceof Error&&!W.message.includes("404")&&console.warn("Parameter requirements not available yet, will retry later"),h.value={parameters:[],hasParameters:!1,requirements:""}}finally{u.value=!1}},m=(W,C)=>{g.value[W]=C,b.value[W]&&delete b.value[W],D()},q=()=>{if(b.value={},R.value=!1,!h.value.hasParameters)return!0;let W=!1;return h.value.parameters.forEach(C=>{var z;((z=g.value[C])==null?void 0:z.trim())||(b.value[C]=`${C} is required`,W=!0)}),R.value=W,!W},D=()=>{h.value.hasParameters?i.value=JSON.stringify(g.value,null,2):i.value="",r("updateExecutionParams",i.value)};return de(()=>a.currentPlanTemplateId,(W,C)=>{W&&W!==C&&(C&&W.startsWith("planTemplate-")?setTimeout(()=>{I()},1e3):I())}),de(()=>i.value,W=>{r("updateExecutionParams",W)}),we(()=>{I()}),e({executionParams:i,clearExecutionParams:S,loadParameterRequirements:I}),(W,C)=>{var U,z,Q,P,x;return p(),f("div",Rr,[t("div",Ar,[w(l(T),{icon:"carbon:play",width:"16"}),t("span",null,c(l(s)("sidebar.executionController")),1)]),t("div",xr,[t("div",Dr,[t("label",null,c(l(s)("sidebar.parameterRequirements")),1),t("div",Mr,c(l(s)("sidebar.parameterRequirementsHelp")),1),h.value.hasParameters?(p(),f("div",Fr,[(p(!0),f(ae,null,ie(h.value.parameters,B=>(p(),f("div",{key:B,class:"parameter-field"},[t("label",Ur,[ne(c(B)+" ",1),C[0]||(C[0]=t("span",{class:"required"},"*",-1))]),se(t("input",{"onUpdate:modelValue":J=>g.value[B]=J,class:oe(["parameter-input",{error:b.value[B]}]),placeholder:l(s)("sidebar.enterValueFor",{param:B}),onInput:J=>m(B,J.target.value),required:""},null,42,Nr),[[re,g.value[B]]]),b.value[B]?(p(),f("div",Lr,c(b.value[B]),1)):L("",!0)]))),128))])):L("",!0),h.value.hasParameters&&!v.value&&!a.isExecuting&&!a.isGenerating?(p(),f("div",Br,[w(l(T),{icon:"carbon:warning",width:"14"}),ne(" "+c(l(s)("sidebar.fillAllRequiredParameters")),1)])):L("",!0)]),t("button",{class:"btn btn-primary execute-btn",onClick:$,disabled:!v.value},[w(l(T),{icon:a.isExecuting?"carbon:circle-dash":"carbon:play",width:"16",class:oe({spinning:a.isExecuting})},null,8,["icon","class"]),ne(" "+c(a.isExecuting?l(s)("sidebar.executing"):l(s)("sidebar.executePlan")),1)],8,Or),W.showPublishButton?(p(),f("button",{key:0,class:"btn publish-mcp-btn",onClick:E,disabled:!W.currentPlanTemplateId},[w(l(T),{icon:"carbon:application",width:"16"}),ne(" "+c(y.value),1)],8,qr)):L("",!0),(U=W.toolInfo)!=null&&U.enableInternalToolcall?(p(),f("div",jr,[t("div",Vr,[t("h4",Hr,c(l(s)("sidebar.internalCall")),1),t("p",Gr,c(l(s)("sidebar.internalCallDescription")),1)]),t("div",Wr,[t("div",zr,[t("div",Jr,c(l(s)("sidebar.internalMethodCall")),1),t("div",Kr,c(l(s)("sidebar.toolName"))+": "+c(((z=W.toolInfo)==null?void 0:z.toolName)||W.currentPlanTemplateId),1),(Q=W.toolInfo)!=null&&Q.serviceGroup?(p(),f("div",Xr,c(l(s)("sidebar.serviceGroup"))+": "+c(W.toolInfo.serviceGroup),1)):L("",!0),t("div",Yr,c(l(s)("sidebar.internalCallUsage")),1),t("div",Qr,[t("strong",null,c(l(s)("sidebar.usage"))+":",1),t("pre",Zr,c(l(s)("sidebar.internalCallExample")),1)])])])])):L("",!0),(P=W.toolInfo)!=null&&P.enableHttpService?(p(),f("div",ei,[t("div",ti,[t("h4",si,c(l(s)("sidebar.httpCallExample")),1),t("p",ni,c(l(s)("sidebar.httpCallDescription")),1)]),t("div",oi,[t("div",ai,[t("div",li,[(p(!0),f(ae,null,ie(M.value,B=>(p(),f("button",{key:B.id,class:oe(["tab-button",{active:d.value===B.id}]),onClick:J=>d.value=B.id},c(B.label),11,ri))),128))]),t("div",ii,[(p(!0),f(ae,null,ie(M.value,B=>se((p(),f("div",{key:B.id,class:"tab-panel"},[t("div",ci,[t("div",di,c(B.method),1),t("div",ui,c(B.endpoint),1),t("div",pi,c(B.description),1),B.example?(p(),f("div",hi,[t("strong",null,c(l(s)("sidebar.example"))+":",1),t("pre",mi,c(B.example),1)])):L("",!0)])])),[[ls,d.value===B.id]])),128))])])])])):L("",!0),(x=W.toolInfo)!=null&&x.enableMcpService?(p(),f("div",fi,[t("div",vi,[t("h4",gi,c(l(s)("sidebar.mcpCall")),1),t("p",bi,c(l(s)("sidebar.mcpCallDescription")),1)]),t("div",yi,[t("div",_i,[t("div",$i,c(l(s)("sidebar.mcpServiceCall")),1),t("div",wi,c(l(s)("sidebar.mcpEndpoint"))+": /mcp/execute",1),t("div",Si,c(l(s)("sidebar.mcpCallUsage")),1),t("div",ki,[t("strong",null,c(l(s)("sidebar.usage"))+":",1),t("pre",Ti,c(l(s)("sidebar.mcpCallExample")),1)])])])])):L("",!0)])])}}}),Ei=he(Pi,[["__scopeId","data-v-cf1e6ebf"]]),Ci={class:"config-section"},Ii={class:"section-header"},Ri={class:"generator-content"},Ai={class:"plan-type-selection"},xi={class:"form-label"},Di={value:"simple"},Mi={value:"dynamic_agent"},Fi={key:0,class:"dynamic-agent-instruction"},Ui=["value"],Ni=["placeholder"],Li={class:"generator-actions"},Bi=["disabled"],Oi=["disabled"],qi=pe({__name:"PlanGenerator",props:{generatorPrompt:{},jsonContent:{},isGenerating:{type:Boolean},planType:{default:"dynamic_agent"}},emits:["generatePlan","updatePlan","updateGeneratorPrompt","updatePlanType"],setup(o,{expose:e,emit:n}){const{t:s}=Pe(),a=o,r=n,i=F(a.generatorPrompt),h=F(a.planType);de(()=>a.generatorPrompt,d=>{i.value=d}),de(i,d=>{r("updateGeneratorPrompt",d)}),de(()=>a.planType,d=>{h.value=d}),de(h,d=>{r("updatePlanType",d)});const g=()=>{r("generatePlan")},u=()=>{r("updatePlan")};return e({generatorPrompt:i}),(d,b)=>(p(),f("div",Ci,[t("div",Ii,[w(l(T),{icon:"carbon:generate",width:"16"}),t("span",null,c(l(s)("sidebar.planGenerator")),1)]),t("div",Ri,[t("div",Ai,[t("label",xi,c(l(s)("sidebar.planType")),1),se(t("select",{"onUpdate:modelValue":b[0]||(b[0]=R=>h.value=R),class:"form-select"},[t("option",Di,c(l(s)("sidebar.simplePlan")),1),t("option",Mi,c(l(s)("sidebar.dynamicAgentPlan")),1)],512),[[ot,h.value]])]),h.value==="dynamic_agent"?(p(),f("div",Fi,[t("textarea",{readonly:"",class:"instruction-textarea",rows:"2",value:l(s)("sidebar.dynamicAgentInstruction")},null,8,Ui)])):(p(),f(ae,{key:1},[se(t("textarea",{"onUpdate:modelValue":b[1]||(b[1]=R=>i.value=R),class:"prompt-input",placeholder:l(s)("sidebar.generatorPlaceholder"),rows:"3"},null,8,Ni),[[re,i.value]]),t("div",Li,[t("button",{class:"btn btn-primary btn-sm",onClick:g,disabled:d.isGenerating||!i.value.trim()},[w(l(T),{icon:d.isGenerating?"carbon:circle-dash":"carbon:generate",width:"14",class:oe({spinning:d.isGenerating})},null,8,["icon","class"]),ne(" "+c(d.isGenerating?l(s)("sidebar.generating"):l(s)("sidebar.generatePlan")),1)],8,Bi),t("button",{class:"btn btn-secondary btn-sm",onClick:u,disabled:d.isGenerating||!i.value.trim()||!d.jsonContent.trim()},[w(l(T),{icon:"carbon:edit",width:"14"}),ne(" "+c(l(s)("sidebar.updatePlan")),1)],8,Oi)])],64))])]))}}),ji=he(qi,[["__scopeId","data-v-ef6f6cb4"]]),Vi={class:"sidebar-content"},Hi={class:"sidebar-content-header"},Gi={class:"sidebar-content-title"},Wi={class:"tab-switcher"},zi=["disabled"],Ji={key:0,class:"tab-content"},Ki={class:"new-task-section"},Xi={class:"sidebar-content-list"},Yi={key:0,class:"loading-state"},Qi={key:1,class:"error-state"},Zi={key:2,class:"empty-state"},ec=["onClick"],tc={class:"task-icon"},sc={class:"task-details"},nc={class:"task-title"},oc={class:"task-preview"},ac={class:"task-time"},lc={class:"task-actions"},rc=["title","onClick"],ic={key:1,class:"tab-content config-tab"},cc={key:0,class:"config-container"},dc={class:"template-info-header"},uc={class:"template-info"},pc={class:"template-id"},hc=["title"],mc=pe({__name:"Sidebar",emits:["planExecutionRequested"],setup(o,{expose:e,emit:n}){const{t:s}=Pe(),a=us(),r=F(80),i=F(!1),h=F(0),g=F(0),u=F(null),d=F({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}),b=F(null),R=F({enabled:!0,success:!0}),M=ue(()=>R.value.enabled),_=async()=>{try{const k=await Me.getCoordinatorToolConfig();R.value=k}catch(k){console.error("Failed to load CoordinatorTool configuration:",k),R.value={enabled:!0,success:!1,message:k instanceof Error?k.message:"Unknown error"}}},y=n,v=async()=>{try{const k=await H.saveTemplate();k!=null&&k.duplicate?a.success(s("sidebar.saveCompleted",{message:k.message,versionCount:k.versionCount})):k!=null&&k.saved?(a.success(s("sidebar.saveSuccess",{message:k.message,versionCount:k.versionCount})),$()):k!=null&&k.message&&a.success(s("sidebar.saveStatus",{message:k.message}))}catch(k){console.error("Failed to save plan modifications:",k),a.error(k.message||s("sidebar.saveFailed"))}},$=async()=>{await new Promise(k=>setTimeout(k,500)),u.value&&u.value.loadParameterRequirements(),b.value&&b.value.loadParameterRequirements()},E=async()=>{var k;try{await H.generatePlan(),a.success(s("sidebar.generateSuccess",{templateId:((k=H.selectedTemplate)==null?void 0:k.id)??s("sidebar.unknown")}))}catch(j){console.error("Failed to generate plan:",j),a.error(s("sidebar.generateFailed")+": "+j.message)}},S=async()=>{try{await H.updatePlan(),a.success(s("sidebar.updateSuccess"))}catch(k){console.error("Failed to update plan:",k),a.error(s("sidebar.updateFailed")+": "+k.message)}},I=()=>{try{H&&typeof H.rollbackVersion=="function"?H.rollbackVersion():console.warn("sidebarStore or rollbackVersion method is not available")}catch(k){console.error("Error during rollback operation:",k),a.error(s("sidebar.rollbackFailed")||"Rollback failed")}},m=()=>{try{H&&typeof H.restoreVersion=="function"?H.restoreVersion():console.warn("sidebarStore or restoreVersion method is not available")}catch(k){console.error("Error during restore operation:",k),a.error(s("sidebar.restoreFailed")||"Restore failed")}},q=async k=>{console.log("[Sidebar] handleExecutePlan called with replacementParams:",k);try{const j=H.preparePlanExecution();if(!j){console.log("[Sidebar] No plan data available, returning");return}k&&Object.keys(k).length>0&&(j.replacementParams=k,console.log("[Sidebar] Added replacement parameters to plan data:",k)),console.log("[Sidebar] Triggering plan execution request:",j),console.log("[Sidebar] Emitting planExecutionRequested event"),y("planExecutionRequested",{title:j.title,planData:j.planData,params:j.params,replacementParams:k}),console.log("[Sidebar] Event emitted")}catch(j){console.error("Error executing plan:",j),a.error(s("sidebar.executeFailed")+": "+j.message)}finally{H.finishPlanExecution()}},D=F(!1),W=()=>{if(console.log("[Sidebar] Publish MCP service button clicked"),console.log("[Sidebar] currentPlanTemplateId:",H.currentPlanTemplateId),!H.currentPlanTemplateId){console.log("[Sidebar] No plan template selected, showing warning"),a.error(s("mcpService.selectPlanTemplateFirst"));return}console.log("[Sidebar] Opening publish MCP service modal"),D.value=!0},C=k=>{k===null?(console.log("MCP service deleted successfully"),a.success(s("mcpService.deleteSuccess")),d.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}):(console.log("MCP service published successfully:",k),a.success(s("mcpService.publishSuccess")),d.value={...k,toolName:k.toolName||"",serviceGroup:k.serviceGroup||""})},U=()=>{H.clearExecutionParams()},z=k=>{H.executionParams=k},Q=k=>{H.generatorPrompt=k},P=k=>{H.planType=k},x=async k=>{if(!k){d.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""};return}try{const j=await Me.getCoordinatorToolsByTemplate(k);j?d.value={...j,toolName:j.toolName||"",serviceGroup:j.serviceGroup||""}:d.value={toolName:"",toolDescription:"",planTemplateId:k,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}catch(j){console.error("Failed to load tool information:",j),d.value={toolName:"",toolDescription:"",planTemplateId:k,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}},B=k=>{if(isNaN(k.getTime()))return console.warn("Invalid date received:",k),s("time.unknown");const N=new Date().getTime()-k.getTime(),O=Math.floor(N/6e4),K=Math.floor(N/36e5),ce=Math.floor(N/864e5);return O<1?s("time.now"):O<60?s("time.minuteAgo",{count:O}):K<24?s("time.hourAgo",{count:K}):ce<30?s("time.dayAgo",{count:ce}):k.toLocaleDateString("zh-CN")},J=(k,j)=>!k||k.length<=j?k:k.substring(0,j)+"...",Z=k=>{i.value=!0,h.value=k.clientX,g.value=r.value,document.addEventListener("mousemove",ee),document.addEventListener("mouseup",me),document.body.style.cursor="col-resize",document.body.style.userSelect="none",k.preventDefault()},ee=k=>{if(!i.value)return;const j=window.innerWidth,O=(k.clientX-h.value)/j*100;let K=g.value+O;K=Math.max(15,Math.min(100,K)),r.value=K},me=()=>{i.value=!1,document.removeEventListener("mousemove",ee),document.removeEventListener("mouseup",me),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("sidebarWidth",r.value.toString())},G=()=>{r.value=80,localStorage.setItem("sidebarWidth","80")};return de(()=>H.currentPlanTemplateId,k=>{x(k)},{immediate:!0}),we(()=>{H.loadPlanTemplateList(),_(),H.loadAvailableTools();const k=localStorage.getItem("sidebarWidth");k&&(r.value=parseFloat(k))}),Te(()=>{document.removeEventListener("mousemove",ee),document.removeEventListener("mouseup",me)}),e({loadPlanTemplateList:H.loadPlanTemplateList,toggleSidebar:H.toggleSidebar,currentPlanTemplateId:H.currentPlanTemplateId}),(k,j)=>{var N,O;return p(),f(ae,null,[t("div",{class:oe(["sidebar-wrapper",{"sidebar-wrapper-collapsed":l(H).isCollapsed}]),style:We({width:r.value+"%"})},[t("div",Vi,[t("div",Hi,[t("div",Gi,c(k.$t("sidebar.title")),1)]),t("div",Wi,[t("button",{class:oe(["tab-button",{active:l(H).currentTab==="list"}]),onClick:j[0]||(j[0]=K=>l(H).switchToTab("list"))},[w(l(T),{icon:"carbon:list",width:"16"}),ne(" "+c(k.$t("sidebar.templateList")),1)],2),t("button",{class:oe(["tab-button",{active:l(H).currentTab==="config"}]),onClick:j[1]||(j[1]=K=>l(H).switchToTab("config")),disabled:!l(H).selectedTemplate},[w(l(T),{icon:"carbon:settings",width:"16"}),ne(" "+c(k.$t("sidebar.configuration")),1)],10,zi)]),l(H).currentTab==="list"?(p(),f("div",Ji,[t("div",Ki,[t("button",{class:"new-task-btn",onClick:j[2]||(j[2]=K=>l(H).createNewTemplate(l(H).planType))},[w(l(T),{icon:"carbon:add",width:"16"}),ne(" "+c(k.$t("sidebar.newPlan"))+" ",1),j[8]||(j[8]=t("span",{class:"shortcut"}," K",-1))])]),t("div",Xi,[l(H).isLoading?(p(),f("div",Yi,[w(l(T),{icon:"carbon:circle-dash",width:"20",class:"spinning"}),t("span",null,c(k.$t("sidebar.loading")),1)])):l(H).errorMessage?(p(),f("div",Qi,[w(l(T),{icon:"carbon:warning",width:"20"}),t("span",null,c(l(H).errorMessage),1),t("button",{onClick:j[3]||(j[3]=(...K)=>l(H).loadPlanTemplateList&&l(H).loadPlanTemplateList(...K)),class:"retry-btn"},c(k.$t("sidebar.retry")),1)])):l(H).planTemplateList.length===0?(p(),f("div",Zi,[w(l(T),{icon:"carbon:document",width:"32"}),t("span",null,c(k.$t("sidebar.noTemplates")),1)])):(p(!0),f(ae,{key:3},ie(l(H).sortedTemplates,K=>(p(),f("div",{key:K.id,class:oe(["sidebar-content-list-item",{"sidebar-content-list-item-active":K.id===l(H).currentPlanTemplateId}]),onClick:ce=>l(H).selectTemplate(K)},[t("div",tc,[w(l(T),{icon:"carbon:document",width:"20"})]),t("div",sc,[t("div",nc,c(K.title||k.$t("sidebar.unnamedPlan")),1),t("div",oc,c(J(K.description||k.$t("sidebar.noDescription"),40)),1)]),t("div",ac,c(B(l(H).parseDateTime(K.updateTime||K.createTime))),1),t("div",lc,[t("button",{class:"delete-task-btn",title:k.$t("sidebar.deleteTemplate"),onClick:fe(ce=>l(H).deleteTemplate(K),["stop"])},[w(l(T),{icon:"carbon:close",width:"16"})],8,rc)])],10,ec))),128))])])):l(H).currentTab==="config"?(p(),f("div",ic,[l(H).selectedTemplate?(p(),f("div",cc,[t("div",dc,[t("div",uc,[t("h3",null,c(l(H).selectedTemplate.title||k.$t("sidebar.unnamedPlan")),1),t("span",pc,"ID: "+c(l(H).selectedTemplate.id),1)]),t("button",{class:"back-to-list-btn",onClick:j[4]||(j[4]=K=>l(H).switchToTab("list"))},[w(l(T),{icon:"carbon:arrow-left",width:"16"})])]),w(ji,{"generator-prompt":l(H).generatorPrompt,"json-content":l(H).jsonContent,"is-generating":l(H).isGenerating,"plan-type":l(H).planType,onGeneratePlan:E,onUpdatePlan:S,onUpdateGeneratorPrompt:Q,onUpdatePlanType:P},null,8,["generator-prompt","json-content","is-generating","plan-type"]),l(H).planType==="dynamic_agent"?(p(),le(Ir,{key:0,"json-content":l(H).jsonContent,"can-rollback":l(H).canRollback,"can-restore":l(H).canRestore,"is-generating":l(H).isGenerating,"is-executing":l(H).isExecuting,"current-plan-template-id":l(H).currentPlanTemplateId||"",onRollback:I,onRestore:m,onSave:v,"onUpdate:jsonContent":j[5]||(j[5]=K=>l(H).jsonContent=K)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])):(p(),le(zo,{key:1,"json-content":l(H).jsonContent,"can-rollback":l(H).canRollback,"can-restore":l(H).canRestore,"is-generating":l(H).isGenerating,"is-executing":l(H).isExecuting,"current-plan-template-id":l(H).currentPlanTemplateId||"",onRollback:I,onRestore:m,onSave:v,"onUpdate:jsonContent":j[6]||(j[6]=K=>l(H).jsonContent=K)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])),w(Ei,{ref_key:"executionControllerRef",ref:u,"current-plan-template-id":l(H).currentPlanTemplateId||"","is-executing":l(H).isExecuting,"is-generating":l(H).isGenerating,"show-publish-button":M.value,"tool-info":d.value,onExecutePlan:q,onPublishMcpService:W,onClearParams:U,onUpdateExecutionParams:z},null,8,["current-plan-template-id","is-executing","is-generating","show-publish-button","tool-info"])])):L("",!0)])):L("",!0)]),t("div",{class:"sidebar-resizer",onMousedown:Z,onDblclick:G,title:k.$t("sidebar.resizeHint")},j[9]||(j[9]=[t("div",{class:"resizer-line"},null,-1)]),40,hc)],6),w(to,{ref_key:"publishMcpModalRef",ref:b,modelValue:D.value,"onUpdate:modelValue":j[7]||(j[7]=K=>D.value=K),"plan-template-id":l(H).currentPlanTemplateId||"","plan-title":((N=l(H).selectedTemplate)==null?void 0:N.title)||"","plan-description":((O=l(H).selectedTemplate)==null?void 0:O.description)||"",onPublished:C},null,8,["modelValue","plan-template-id","plan-title","plan-description"])],64)}}}),fc=he(mc,[["__scopeId","data-v-7b9b059f"]]);class ht{static async handleResponse(e){if(!e.ok)try{const n=await e.json();throw new Error(n.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getMemories(){try{const e=await fetch(`${this.BASE_URL}`);return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get memory list:",e),e}}static async getMemory(e){try{const n=await fetch(`${this.BASE_URL}/single?memoryId=${e}`);return await(await this.handleResponse(n)).json()}catch(n){throw console.error("Failed to get memory :",n),n}}static async update(e,n){try{const s=await fetch(`${this.BASE_URL}/update`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({memoryId:e,memoryName:n})});return await(await this.handleResponse(s)).json()}catch(s){throw console.error("Failed to update memory:",s),s}}static async delete(e){try{const n=await fetch(`${this.BASE_URL}/delete?memoryId=${e}`);await this.handleResponse(n)}catch(n){throw console.error("Failed to update memory:",n),n}}}ge(ht,"BASE_URL","/api/memories");class vc{constructor(){ge(this,"isCollapsed",!1);ge(this,"selectMemoryId","");ge(this,"loadMessages",()=>{});ge(this,"intervalId")}toggleSidebar(){this.isCollapsed=!this.isCollapsed,this.isCollapsed?(this.loadMessages(),this.intervalId=window.setInterval(()=>{this.loadMessages()},3e3)):clearInterval(this.intervalId)}selectMemory(e){this.toggleSidebar(),this.selectMemoryId=e}setMemory(e){this.selectMemoryId=e}defaultMemoryId(){this.selectMemoryId=this.generateRandomId()}clearMemoryId(){this.selectMemoryId=""}generateRandomId(){return Math.random().toString(36).substring(2,10)}setLoadMessages(e){this.loadMessages=e}}const Ue=nt(new vc),gc={key:0,class:"app-container"},bc={class:"app-content"},yc={class:"header"},_c={class:"relative"},$c={class:"title-edit-group"},wc={id:"main-title",class:"main-title"},Sc={key:0,id:"title-edit-container",class:"title-edit-container"},kc={class:"search-bar"},Tc={class:"search-container"},Pc=["placeholder"],Ec={class:"message-list",id:"message-list"},Cc={class:"message-header"},Ic={class:"message-content"},Rc={class:"sender-info"},Ac=["onClick"],xc={class:"sender-name"},Dc=["onClick"],Mc={class:"action-buttons"},Fc=["onClick"],Uc={class:"action-buttons"},Nc=["onClick"],Lc={class:"message-preview"},Bc={class:"preview-line"},Oc={key:0,class:"preview-line",style:{opacity:"0.8"}},qc={class:"message-meta"},jc={class:"message-id"},Vc={class:"meta-right"},Hc={key:0,class:"unread-count"},Gc={class:"message-time"},Wc=["id"],zc={style:{display:"flex","flex-direction":"column",gap:"0.75rem"}},Jc={class:"bubble-avatar"},Kc={class:"bubble-content"},Xc={class:"bubble-text"},Yc={key:0,class:"empty-state"},Qc={class:"modal-content"},Zc={class:"modal-header"},ed={class:"modal-title"},td=["placeholder"],sd={id:"name-char-count",class:"char-count",style:{"text-align":"right",display:"block","margin-top":"0.25rem"}},nd={class:"modal-footer"},od={class:"modal-content"},ad={class:"modal-header"},ld={class:"modal-title"},rd={class:"state-text",id:"delete-message"},id={class:"modal-footer"},cd=pe({__name:"Memory",emits:["memory-selected"],setup(o,{emit:e}){const n=F(!1),s=F(""),a=F([]),r=F([]),i=F(!1),h=F(null),g=F(""),u=F(!1),d=F(null),b=new Map,R=e,M=C=>{C.key==="Escape"&&(u.value?D():i.value&&S())};we(()=>{Ue.setLoadMessages(_),document.addEventListener("keydown",M)}),Te(()=>{document.removeEventListener("keydown",M)});const _=async()=>{try{const C=await ht.getMemories();a.value?a.value=C.map(U=>({...U,expanded:b.has(U.memoryId)?b.get(U.memoryId):!1})):a.value=C.map(U=>({...U,expanded:!1})),r.value=[...a.value],$()}catch(C){console.error("error:",C),a.value=[],r.value=[]}},y=C=>{Ue.selectMemory(C),R("memory-selected")},v=C=>{const U=typeof C=="string"?parseInt(C,10):C;return isNaN(U)||U<=0?"unknow time":new Date(U.toString().length===13?U:U*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(","," ")},$=()=>{const C=s.value.toLowerCase().trim();if(!C){r.value=[...a.value];return}r.value=a.value.filter(U=>{const z=U.memoryName.toLowerCase().includes(C),Q=U.memoryId.toLowerCase().includes(C),P=U.messages.some(x=>x.text.toLowerCase().includes(C));return z||Q||P})},E=(C,U)=>{h.value=C,g.value=U,i.value=!0},S=()=>{i.value=!1,h.value=null},I=async()=>{if(!h.value)return;const C=g.value.trim()||"unknow name",U=a.value.findIndex(z=>z.memoryId===h.value);if(U!==-1){const z=a.value[U];try{const Q=await ht.update(z.memoryId,C);Q.messages||(Q.messages=[]),a.value[U]={...Q,expanded:z.expanded},$(),i.value=!1}catch(Q){console.error("error:",Q)}}},m=C=>{const U=a.value.find(z=>z.memoryId===C);if(U){U.expanded=!U.expanded,b.set(C,U.expanded);const z=r.value.findIndex(Q=>Q.memoryId===C);z!==-1&&(r.value[z]={...U})}},q=C=>{d.value=C,u.value=!0},D=()=>{u.value=!1,d.value=null},W=async()=>{if(d.value)try{await ht.delete(d.value),a.value=a.value.filter(C=>C.memoryId!==d.value),$(),a.value.length===0&&Ue.clearMemoryId(),u.value=!1,d.value=null}catch(C){console.error("error:",C)}};return(C,U)=>(p(),le(Ze,{to:"body"},[w(qe,{name:"modal"},{default:Fe(()=>[l(Ue).isCollapsed?(p(),f("div",gc,[t("div",bc,[t("div",yc,[t("div",_c,[t("div",$c,[t("h1",wc,[t("span",null,c(C.$t("memory.title")),1)])]),n.value?(p(),f("div",Sc)):L("",!0)]),t("button",{class:"close-btn",onClick:U[0]||(U[0]=z=>l(Ue).toggleSidebar())},[w(l(T),{icon:"carbon:close"})])]),t("div",kc,[t("div",Tc,[w(l(T),{class:"search-container-icon",icon:"carbon:search"}),se(t("input",{type:"text",placeholder:C.$t("memory.searchPlaceholder"),class:"search-input","onUpdate:modelValue":U[1]||(U[1]=z=>s.value=z),onInput:$},null,40,Pc),[[re,s.value]])])]),t("div",Ec,[t("div",null,[(p(!0),f(ae,null,ie(r.value,z=>(p(),f("div",{class:oe(["message-item",{expanded:z.expanded}]),key:z.memoryId},[t("div",Cc,[t("div",Ic,[t("div",Rc,[t("div",{class:"sender-div",onClick:fe(Q=>y(z.memoryId),["stop"])},[t("h3",xc,c(z.memoryName),1)],8,Ac),t("div",{class:"toggle-container",onClick:fe(Q=>E(z.memoryId,z.memoryName),["stop"])},[w(l(T),{icon:"carbon:edit",class:"edit-btn"})],8,Dc),t("div",Mc,[t("button",{class:"delete-btn",onClick:fe(Q=>m(z.memoryId),["stop"])},[w(l(T),{id:"toggle-"+z.memoryId,icon:"carbon:chevron-down",class:"down-btn"},null,8,["id"])],8,Fc)]),t("div",Uc,[t("button",{class:"delete-btn",onClick:fe(Q=>q(z.memoryId),["stop"])},[w(l(T),{icon:"carbon:delete"})],8,Nc)])]),t("div",Lc,[t("p",Bc,c(z.messages.length>0?z.messages[0].text:"none message"),1),z.messages.length>1?(p(),f("p",Oc,c(z.messages[1].text),1)):L("",!0)]),t("div",qc,[t("span",jc,"ID: "+c(z.memoryId),1),t("div",Vc,[z.messages.length>0?(p(),f("span",Hc,c(z.messages.length)+" "+c(C.$t("memory.size")),1)):L("",!0),t("span",Gc,c(v(z.createTime)),1)])])])]),z.expanded?(p(),f("div",{key:0,id:"content-"+z.memoryId,class:"expanded-content"},[t("div",zc,[(p(!0),f(ae,null,ie(z.messages,(Q,P)=>(p(),f("div",{class:"message-bubble",key:P},[t("div",Jc,c(Q.messageType),1),t("div",Kc,[t("p",Xc,c(Q.text),1)])]))),128))])],8,Wc)):L("",!0)],2))),128))]),r.value.length===0&&s.value?(p(),f("div",Yc,U[3]||(U[3]=[t("p",{class:"state-text"},"none message",-1)]))):L("",!0)]),i.value?(p(),f("div",{key:0,id:"name-edit-modal",class:"modal-overlay",onClick:fe(S,["self"])},[t("div",Qc,[t("div",Zc,[t("h3",ed,c(C.$t("memory.changeName")),1),se(t("input",{type:"text","onUpdate:modelValue":U[2]||(U[2]=z=>g.value=z),class:"edit-input",placeholder:C.$t("memory.newNamePlaceholder")},null,8,td),[[re,g.value]]),t("span",sd,c(g.value.length),1)]),t("div",nd,[t("button",{id:"cancel-name",class:"modal-btn cancel-btn",onClick:S},c(C.$t("memory.cancel")),1),t("button",{id:"save-name",class:"modal-btn confirm-btn",onClick:I},c(C.$t("memory.save")),1)])])])):L("",!0),u.value?(p(),f("div",{key:1,id:"delete-modal",class:"modal-overlay",onClick:fe(D,["self"])},[t("div",od,[t("div",ad,[t("h3",ld,c(C.$t("memory.deleteHint")),1),t("p",rd,c(C.$t("memory.deleteHintPrefix"))+" "+c(d.value)+" "+c(C.$t("memory.deleteHintSuffix")),1)]),t("div",id,[t("button",{id:"cancel-delete",class:"modal-btn cancel-btn",onClick:D},c(C.$t("memory.cancel")),1),t("button",{id:"confirm-delete",class:"modal-btn delete-btn-confirm",onClick:W},c(C.$t("memory.delete")),1)])])])):L("",!0)])])):L("",!0)]),_:1})]))}}),dd=he(cd,[["__scopeId","data-v-e212f55a"]]),ud="/api/executor";async function Ls(o){try{const e=await fetch(`${ud}/agent-execution/${o}`);if(!e.ok){if(e.status===404)return console.warn(`Agent execution detail not found for stepId: ${o}`),null;throw new Error(`HTTP error! status: ${e.status}`)}return await e.json()}catch(e){return console.error(`Error fetching agent execution detail for stepId: ${o}:`,e),null}}async function pd(o){return console.log(`Refreshing agent execution detail for stepId: ${o}`),Ls(o)}class Le{static async handleResponse(e){if(!e.ok)try{const n=await e.json();throw new Error(n.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getFileTree(e){try{const n=await fetch(`${this.BASE_URL}/tree/${e}`),a=await(await this.handleResponse(n)).json();if(!a.success)throw new Error(a.message||"Failed to get file tree");return a.data}catch(n){throw console.error("Failed to get file tree:",n),n}}static async getFileContent(e,n){try{const s=await fetch(`${this.BASE_URL}/content/${e}?path=${encodeURIComponent(n)}`),r=await(await this.handleResponse(s)).json();if(!r.success)throw new Error(r.message||"Failed to get file content");return r.data}catch(s){throw console.error("Failed to get file content:",s),s}}static async downloadFile(e,n,s){try{const a=await fetch(`${this.BASE_URL}/download/${e}?path=${encodeURIComponent(n)}`);await this.handleResponse(a);const r=await a.blob(),i=window.URL.createObjectURL(r),h=document.createElement("a");h.href=i,h.download=s||n.split("/").pop()||"download",document.body.appendChild(h),h.click(),window.URL.revokeObjectURL(i),document.body.removeChild(h)}catch(a){throw console.error("Failed to download file:",a),a}}static isTextFile(e,n){const s=["text/","application/json","application/xml","application/javascript","application/typescript"],a=[".txt",".md",".json",".xml",".html",".css",".js",".ts",".vue",".jsx",".tsx",".py",".java",".cpp",".c",".h",".sh",".bat",".yml",".yaml",".properties",".conf",".cfg"];if(s.some(i=>e.startsWith(i)))return!0;const r=n.toLowerCase();return a.some(i=>r.endsWith(i))}static getFileIcon(e){if(e.type==="directory")return"carbon:folder";const n=e.name.toLowerCase();return n.endsWith(".js")?"vscode-icons:file-type-js":n.endsWith(".ts")?"vscode-icons:file-type-typescript":n.endsWith(".vue")?"vscode-icons:file-type-vue":n.endsWith(".java")?"vscode-icons:file-type-java":n.endsWith(".py")?"vscode-icons:file-type-python":n.endsWith(".json")?"vscode-icons:file-type-json":n.endsWith(".xml")?"vscode-icons:file-type-xml":n.endsWith(".html")?"vscode-icons:file-type-html":n.endsWith(".css")?"vscode-icons:file-type-css":n.endsWith(".md")?"vscode-icons:file-type-markdown":n.endsWith(".yml")||n.endsWith(".yaml")?"vscode-icons:file-type-yaml":n.endsWith(".pdf")?"vscode-icons:file-type-pdf2":n.endsWith(".doc")||n.endsWith(".docx")?"vscode-icons:file-type-word":n.endsWith(".xls")||n.endsWith(".xlsx")?"vscode-icons:file-type-excel":n.endsWith(".ppt")||n.endsWith(".pptx")?"vscode-icons:file-type-powerpoint":n.match(/\.(jpg|jpeg|png|gif|bmp|svg)$/)?"carbon:image":n.match(/\.(zip|rar|7z|tar|gz)$/)?"carbon:archive":"carbon:document"}}ge(Le,"BASE_URL","/api/file-browser");const hd={class:"file-tree-node"},md={class:"node-icon"},fd={class:"node-name"},vd={key:1,class:"file-size"},gd={key:2,class:"node-actions"},bd={key:0,class:"children"},yd=pe({__name:"FileTreeNode",props:{node:{},level:{}},emits:["file-selected","download-file"],setup(o,{emit:e}){const n=o,s=e,a=F(n.level===0),r=F(!1),i=F(!1),h=F({}),g=()=>{n.node.type==="directory"&&(a.value=!a.value)},u=()=>{n.node.type==="directory"?g():d()},d=()=>{n.node.type==="file"&&s("file-selected",n.node),M()},b=()=>{s("download-file",n.node),M()},R=$=>{$.preventDefault(),i.value=!0,h.value={position:"fixed",top:`${$.clientY}px`,left:`${$.clientX}px`,zIndex:1e3},setTimeout(()=>{document.addEventListener("click",M)},0)},M=()=>{i.value=!1,document.removeEventListener("click",M)},_=async()=>{try{await navigator.clipboard.writeText(n.node.path)}catch($){console.error("Failed to copy path:",$)}M()},y=()=>n.node.type==="directory"?a.value?"carbon:folder-open":"carbon:folder":Le.getFileIcon(n.node),v=$=>{if($===0)return"0 B";const E=1024,S=["B","KB","MB","GB"],I=Math.floor(Math.log($)/Math.log(E));return parseFloat(($/Math.pow(E,I)).toFixed(1))+" "+S[I]};return Te(()=>{document.removeEventListener("click",M)}),($,E)=>{const S=rs("FileTreeNode",!0);return p(),f("div",hd,[t("div",{class:oe(["node-content",{"is-directory":$.node.type==="directory","is-file":$.node.type==="file","is-expanded":a.value}]),style:We({paddingLeft:`${$.level*16+12}px`}),onClick:u,onContextmenu:fe(R,["prevent"])},[$.node.type==="directory"?(p(),f("div",{key:0,class:"expand-icon",onClick:fe(g,["stop"])},[w(l(T),{icon:a.value?"carbon:chevron-down":"carbon:chevron-right",class:"chevron-icon"},null,8,["icon"])])):L("",!0),t("div",md,[w(l(T),{icon:y()},null,8,["icon"])]),t("span",fd,c($.node.name),1),$.node.type==="file"?(p(),f("span",vd,c(v($.node.size)),1)):L("",!0),r.value?(p(),f("div",gd,[$.node.type==="file"?(p(),f("button",{key:0,onClick:E[0]||(E[0]=fe(I=>$.$emit("download-file",$.node),["stop"])),class:"action-btn download-btn",title:"Download"},[w(l(T),{icon:"carbon:download"})])):L("",!0)])):L("",!0)],38),$.node.type==="directory"&&a.value&&$.node.children?(p(),f("div",bd,[(p(!0),f(ae,null,ie($.node.children,I=>(p(),le(S,{key:I.path,node:I,level:$.level+1,onFileSelected:E[1]||(E[1]=m=>$.$emit("file-selected",m)),onDownloadFile:E[2]||(E[2]=m=>$.$emit("download-file",m))},null,8,["node","level"]))),128))])):L("",!0),i.value?(p(),f("div",{key:1,class:"context-menu",style:We(h.value),onClick:E[3]||(E[3]=fe(()=>{},["stop"]))},[t("div",{class:"context-menu-item",onClick:d},[w(l(T),{icon:"carbon:view"}),E[4]||(E[4]=t("span",null,"Open",-1))]),$.node.type==="file"?(p(),f("div",{key:0,class:"context-menu-item",onClick:b},[w(l(T),{icon:"carbon:download"}),E[5]||(E[5]=t("span",null,"Download",-1))])):L("",!0),E[7]||(E[7]=t("div",{class:"context-menu-divider"},null,-1)),t("div",{class:"context-menu-item",onClick:_},[w(l(T),{icon:"carbon:copy"}),E[6]||(E[6]=t("span",null,"Copy Path",-1))])],4)):L("",!0)])}}}),_d=he(yd,[["__scopeId","data-v-e4a376d5"]]),$d={class:"file-browser"},wd={class:"file-browser-header"},Sd={class:"header-actions"},kd=["disabled","title"],Td={class:"file-browser-content"},Pd={class:"file-tree-panel"},Ed={key:0,class:"loading-state"},Cd={key:1,class:"error-state"},Id={key:0,class:"waiting-for-files"},Rd={class:"message-content"},Ad={class:"tips"},xd=["disabled"],Dd={key:1,class:"actual-error"},Md={key:2,class:"empty-state"},Fd={key:3,class:"file-tree"},Ud={key:0,class:"file-content-panel"},Nd={class:"file-content-header"},Ld={class:"file-info"},Bd={class:"file-name"},Od={class:"file-size"},qd={class:"file-actions"},jd=["title"],Vd=["title"],Hd={class:"file-content-body"},Gd={key:0,class:"loading-content"},Wd={key:1,class:"content-error"},zd={key:2,class:"file-content"},Jd={key:0,class:"text-content"},Kd={key:1,class:"binary-content"},Xd=pe({__name:"index",props:{planId:{}},setup(o){const e=o,{t:n}=Pe(),s=F(!1),a=F(null),r=F(null),i=F(null),h=F(null),g=F(!1),u=F(null),d=F(null),b=ue(()=>!h.value||!i.value?!1:Le.isTextFile(h.value.mimeType,i.value.name)),R=ue(()=>a.value&&(a.value.includes("Plan directory not found")||a.value.includes("not found"))),M=()=>{d.value&&(clearTimeout(d.value),d.value=null)},_=()=>{M(),d.value=window.setTimeout(()=>{R.value&&y()},5e3)},y=async()=>{if(e.planId){s.value=!0,a.value=null,M();try{r.value=await Le.getFileTree(e.planId)}catch(m){a.value=m instanceof Error?m.message:n("fileBrowser.loadError"),console.error("Failed to load file tree:",m);const q=m instanceof Error?m.message:"";(q.includes("Plan directory not found")||q.includes("not found"))&&_()}finally{s.value=!1}}},v=async m=>{if(m.type!=="directory"){i.value=m,h.value=null,g.value=!0,u.value=null;try{h.value=await Le.getFileContent(e.planId,m.path)}catch(q){u.value=q instanceof Error?q.message:n("fileBrowser.contentLoadError"),console.error("Failed to load file content:",q)}finally{g.value=!1}}},$=async m=>{try{await Le.downloadFile(e.planId,m.path,m.name)}catch(q){console.error("Failed to download file:",q)}},E=()=>{i.value=null,h.value=null,u.value=null},S=m=>Le.getFileIcon(m),I=m=>{if(m===0)return"0 B";const q=1024,D=["B","KB","MB","GB"],W=Math.floor(Math.log(m)/Math.log(q));return parseFloat((m/Math.pow(q,W)).toFixed(1))+" "+D[W]};return de(()=>e.planId,m=>{m&&(i.value=null,h.value=null,y())},{immediate:!0}),we(()=>{e.planId&&y()}),Te(()=>{M()}),(m,q)=>(p(),f("div",$d,[t("div",wd,[t("h3",null,c(m.$t("fileBrowser.title")),1),t("div",Sd,[t("button",{class:"refresh-btn",onClick:y,disabled:s.value,title:m.$t("fileBrowser.refresh")},[w(l(T),{icon:"carbon:refresh",class:oe({rotating:s.value}),style:{color:"#ffffff",fontSize:"18px",width:"18px",height:"18px"}},null,8,["class"])],8,kd)])]),t("div",Td,[t("div",Pd,[s.value?(p(),f("div",Ed,[w(l(T),{icon:"carbon:loading",class:"rotating"}),t("span",null,c(m.$t("fileBrowser.loading")),1)])):a.value?(p(),f("div",Cd,[R.value?(p(),f("div",Id,[w(l(T),{icon:"carbon:time",class:"rotating"}),t("div",Rd,[t("h3",null,c(m.$t("fileBrowser.waitingForGeneration")),1),t("p",null,c(m.$t("fileBrowser.planExecuting")),1),t("div",Ad,[w(l(T),{icon:"carbon:information"}),t("span",null,c(m.$t("fileBrowser.filesTip")),1)])]),t("button",{onClick:y,class:"retry-btn",disabled:s.value},[w(l(T),{icon:"carbon:refresh",class:oe({rotating:s.value})},null,8,["class"]),ne(" "+c(s.value?m.$t("fileBrowser.checking"):m.$t("fileBrowser.checkNow")),1)],8,xd)])):(p(),f("div",Dd,[w(l(T),{icon:"carbon:warning"}),t("span",null,c(a.value),1),t("button",{onClick:y,class:"retry-btn"},c(m.$t("fileBrowser.retry")),1)]))])):r.value?(p(),f("div",Fd,[w(_d,{node:r.value,level:0,onFileSelected:v,onDownloadFile:$},null,8,["node"])])):(p(),f("div",Md,[w(l(T),{icon:"carbon:folder-off"}),t("span",null,c(m.$t("fileBrowser.noFiles")),1)]))]),i.value?(p(),f("div",Ud,[t("div",Nd,[t("div",Ld,[w(l(T),{icon:S(i.value)},null,8,["icon"]),t("span",Bd,c(i.value.name),1),t("span",Od,"("+c(I(i.value.size))+")",1)]),t("div",qd,[t("button",{onClick:q[0]||(q[0]=D=>$(i.value)),class:"download-btn",title:m.$t("fileBrowser.download")},[w(l(T),{icon:"carbon:download"})],8,jd),t("button",{onClick:E,class:"close-btn",title:m.$t("common.close")},[w(l(T),{icon:"carbon:close"})],8,Vd)])]),t("div",Hd,[g.value?(p(),f("div",Gd,[w(l(T),{icon:"carbon:loading",class:"rotating"}),t("span",null,c(m.$t("fileBrowser.loadingContent")),1)])):u.value?(p(),f("div",Wd,[w(l(T),{icon:"carbon:warning"}),t("span",null,c(u.value),1)])):h.value?(p(),f("div",zd,[b.value?(p(),f("div",Jd,[t("pre",null,[t("code",null,c(h.value.content),1)])])):(p(),f("div",Kd,[w(l(T),{icon:"carbon:document-unknown"}),t("p",null,c(m.$t("fileBrowser.binaryFile")),1),t("button",{onClick:q[1]||(q[1]=D=>$(i.value)),class:"download-btn-large"},[w(l(T),{icon:"carbon:download"}),ne(" "+c(m.$t("fileBrowser.downloadToView")),1)])]))])):L("",!0)])])):L("",!0)])]))}}),Yd=he(Xd,[["__scopeId","data-v-e7c74fe4"]]),Qd={class:"right-panel"},Zd={class:"preview-header"},eu={class:"preview-tabs"},tu={class:"preview-content"},su={key:0,class:"step-details"},nu={key:0,class:"step-info"},ou={key:0,class:"agent-info"},au={class:"info-item"},lu={class:"label"},ru={class:"value"},iu={class:"info-item"},cu={class:"label"},du={class:"value"},uu={class:"info-item"},pu={class:"label"},hu={class:"execution-status"},mu={class:"status-item"},fu={class:"status-text"},vu={key:0},gu={key:0,class:"think-act-steps"},bu={class:"steps-container"},yu={class:"step-header"},_u={class:"step-number"},$u={class:"think-section"},wu={class:"think-content"},Su={class:"input"},ku={class:"label"},Tu={class:"output"},Pu={class:"label"},Eu={key:0,class:"action-section"},Cu={class:"action-content"},Iu={class:"tool-info"},Ru={class:"label"},Au={class:"value"},xu={class:"input"},Du={class:"label"},Mu={class:"output"},Fu={class:"label"},Uu={key:0,class:"sub-plan-section"},Nu={class:"sub-plan-content"},Lu={class:"sub-plan-header"},Bu={class:"sub-plan-info"},Ou={class:"label"},qu={class:"value"},ju={key:0,class:"sub-plan-info"},Vu={class:"label"},Hu={class:"value"},Gu={class:"sub-plan-status"},Wu={class:"status-text"},zu={key:0,class:"no-steps-message"},Ju={key:1,class:"no-execution-message"},Ku={class:"step-basic-info"},Xu={class:"info-item"},Yu={class:"label"},Qu={class:"value"},Zu={key:0,class:"info-item"},ep={class:"label"},tp={class:"value"},sp={class:"info-item"},np={class:"label"},op={class:"no-execution-hint"},ap={key:2,class:"execution-indicator"},lp={class:"execution-text"},rp={key:1,class:"no-selection"},ip=["title"],cp={key:1,class:"file-browser-container"},dp={key:1,class:"no-plan-message"},up={class:"message-content"},pp={class:"tips"},hp=pe({__name:"RightPanel",props:{currentRootPlanId:{},selectedStepId:{}},setup(o,{expose:e}){const n=o,{t:s}=Pe(),a=F(),r=F(),i=F("details"),h=F(localStorage.getItem("jmanus-last-plan-id")),g=F(localStorage.getItem("jmanus-has-executed-plan")==="true"),u=F(!1),d=F(!0),b=F(!0),R=ue(()=>r.value?r.value.completed?s("rightPanel.status.completed"):r.value.current?s("rightPanel.status.executing"):s("rightPanel.status.waiting"):""),M=ue(()=>n.currentRootPlanId?n.currentRootPlanId:h.value),_=ue(()=>!M.value&&!g.value),y=async C=>{var U,z,Q;if(console.log("[RightPanel] Step selected:",{stepId:C}),!C){console.warn("[RightPanel] No stepId provided"),r.value=null;return}try{const P=await Ls(C);if(!P){console.warn("[RightPanel] Agent execution detail not found for stepId:",C),r.value=null;return}const x={stepId:C,title:P.agentName||`Step ${C}`,description:P.agentDescription||"",agentExecution:P,completed:P.status==="FINISHED",current:P.status==="RUNNING"};r.value=x,console.log("[RightPanel] Step details updated:",x),console.log("[RightPanel] activeTab:",i.value),console.log("[RightPanel] selectedStep.value:",r.value),console.log("[RightPanel] agentExecution:",r.value.agentExecution),console.log("[RightPanel] thinkActSteps:",(U=r.value.agentExecution)==null?void 0:U.thinkActSteps),console.log("[RightPanel] thinkActSteps length:",(Q=(z=r.value.agentExecution)==null?void 0:z.thinkActSteps)==null?void 0:Q.length),await ke(),console.log("[RightPanel] After nextTick - selectedStep:",r.value),setTimeout(()=>{E()},100),I()}catch(P){console.error("[RightPanel] Error fetching step details:",P),r.value=null}},v=async()=>{var C;if(!((C=r.value)!=null&&C.stepId)){console.warn("[RightPanel] No step selected for refresh");return}console.log("[RightPanel] Refreshing current step:",r.value.stepId);try{const U=await pd(r.value.stepId);U&&r.value&&(r.value.agentExecution=U,r.value.completed=U.status==="FINISHED",r.value.current=U.status==="RUNNING",console.log("[RightPanel] Step refreshed successfully"),I())}catch(U){console.error("[RightPanel] Error refreshing step:",U)}};de(()=>n.selectedStepId,async C=>{C?await y(C):r.value=null},{immediate:!0});const $=C=>{a.value=C??void 0},E=()=>{if(!a.value)return;const{scrollTop:C,scrollHeight:U,clientHeight:z}=a.value,Q=U-C-z<50,P=U>z;d.value=Q,u.value=P&&!Q,Q?b.value=!0:U-C-z>100&&(b.value=!1),console.log("[RightPanel] Scroll state check:",{scrollTop:C,scrollHeight:U,clientHeight:z,isAtBottom:Q,hasScrollableContent:P,showButton:u.value,shouldAutoScroll:b.value})},S=()=>{a.value&&(a.value.scrollTo({top:a.value.scrollHeight,behavior:"smooth"}),ke(()=>{b.value=!0,E()}))},I=()=>{!b.value||!a.value||ke(()=>{a.value&&(a.value.scrollTop=a.value.scrollHeight,console.log("[RightPanel] Auto scroll to bottom"))})},m=C=>{if(C===null||typeof C>"u"||C==="")return"N/A";try{const U=typeof C=="object"?C:JSON.parse(C);return JSON.stringify(U,null,2)}catch{return String(C)}},q=()=>{r.value=null,b.value=!0,a.value&&a.value.removeEventListener("scroll",E)},D=()=>{const C=()=>{const U=a.value;return U?($(U),U.addEventListener("scroll",E),b.value=!0,E(),console.log("[RightPanel] Scroll listener initialized successfully"),!0):(console.log("[RightPanel] Scroll container not found, retrying..."),!1)};ke(()=>{C()||setTimeout(()=>{C()},100)})};return de(()=>n.currentRootPlanId,(C,U)=>{C&&C!==U?(h.value=C,g.value=!0,localStorage.setItem("jmanus-last-plan-id",C),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] New plan started:",C)):!C&&U&&console.log("[RightPanel] Plan execution finished, keeping last plan:",h.value)},{immediate:!0}),we(()=>{console.log("[RightPanel] Component mounted"),ke(()=>{D()})}),Te(()=>{console.log("[RightPanel] Component unmounting, cleaning up..."),q()}),e({handleStepSelected:y,refreshCurrentStep:v,updateDisplayedPlanProgress:C=>{console.log("[RightPanel] updateDisplayedPlanProgress called with rootPlanId:",C),C&&(h.value=C,g.value=!0,localStorage.setItem("jmanus-last-plan-id",C),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] Plan progress updated:",C))}}),(C,U)=>{var z,Q;return p(),f("div",Qd,[t("div",Zd,[t("div",eu,[t("div",{class:oe(["tab-item",{active:i.value==="details"}]),onClick:U[0]||(U[0]=P=>i.value="details")},[w(l(T),{icon:"carbon:events"}),t("span",null,c(l(s)("rightPanel.stepExecutionDetails")),1)],2),t("div",{class:oe(["tab-item",{active:i.value==="files"}]),onClick:U[1]||(U[1]=P=>i.value="files")},[w(l(T),{icon:"carbon:folder"}),t("span",null,c(l(s)("fileBrowser.title")),1)],2)])]),t("div",tu,[i.value==="details"?(p(),f("div",su,[r.value?(p(),f("div",nu,[t("h3",null,c(r.value.title||r.value.description||l(s)("rightPanel.defaultStepTitle",{number:1})),1),r.value.agentExecution?(p(),f("div",ou,[t("div",au,[t("span",lu,c(l(s)("rightPanel.executingAgent"))+":",1),t("span",ru,c(r.value.agentExecution.agentName),1)]),t("div",iu,[t("span",cu,c(l(s)("rightPanel.callingModel"))+":",1),t("span",du,c(r.value.agentExecution.modelName),1)]),t("div",uu,[t("span",pu,c(l(s)("rightPanel.executionResult"))+":",1),t("span",{class:oe(["value",{success:r.value.agentExecution.status==="FINISHED"}])},c(r.value.agentExecution.status||l(s)("rightPanel.executing")),3)])])):L("",!0),t("div",hu,[t("div",mu,[r.value.completed?(p(),le(l(T),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):r.value.current?(p(),le(l(T),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})):(p(),le(l(T),{key:2,icon:"carbon:time",class:"status-icon pending"})),t("span",fu,c(R.value),1)])])])):L("",!0),t("div",{ref_key:"scrollContainer",ref:a,class:"step-details-scroll-container",onScroll:E},[r.value?(p(),f("div",vu,[(z=r.value.agentExecution)!=null&&z.thinkActSteps&&r.value.agentExecution.thinkActSteps.length>0?(p(),f("div",gu,[t("h4",null,c(l(s)("rightPanel.thinkAndActionSteps")),1),t("div",bu,[(p(!0),f(ae,null,ie(r.value.agentExecution.thinkActSteps,(P,x)=>(p(),f("div",{key:x,class:"think-act-step"},[t("div",yu,[t("span",_u,"#"+c(x+1),1),t("span",{class:oe(["step-status",P.status])},c(P.status||l(s)("rightPanel.executing")),3)]),t("div",$u,[t("h5",null,[w(l(T),{icon:"carbon:thinking"}),ne(" "+c(l(s)("rightPanel.thinking")),1)]),t("div",wu,[t("div",Su,[t("span",ku,c(l(s)("rightPanel.input"))+":",1),t("pre",null,c(m(P.thinkInput)),1)]),t("div",Tu,[t("span",Pu,c(l(s)("rightPanel.output"))+":",1),t("pre",null,c(m(P.thinkOutput)),1)])])]),P.actionNeeded?(p(),f("div",Eu,[t("h5",null,[w(l(T),{icon:"carbon:play"}),ne(" "+c(l(s)("rightPanel.action")),1)]),t("div",Cu,[(p(!0),f(ae,null,ie(P.actToolInfoList,(B,J)=>(p(),f("div",{key:J},[t("div",Iu,[t("span",Ru,c(l(s)("rightPanel.tool"))+":",1),t("span",Au,c(B.name||""),1)]),t("div",xu,[t("span",Du,c(l(s)("rightPanel.toolParameters"))+":",1),t("pre",null,c(m(B.parameters)),1)]),t("div",Mu,[t("span",Fu,c(l(s)("rightPanel.executionResult"))+":",1),t("pre",null,c(m(B.result)),1)])]))),128))]),P.subPlanExecutionRecord?(p(),f("div",Uu,[t("h5",null,[w(l(T),{icon:"carbon:tree-view"}),ne(" "+c(l(s)("rightPanel.subPlan")),1)]),t("div",Nu,[t("div",Lu,[t("div",Bu,[t("span",Ou,c(C.$t("rightPanel.subPlanId"))+":",1),t("span",qu,c(P.subPlanExecutionRecord.currentPlanId),1)]),P.subPlanExecutionRecord.title?(p(),f("div",ju,[t("span",Vu,c(C.$t("rightPanel.title"))+":",1),t("span",Hu,c(P.subPlanExecutionRecord.title),1)])):L("",!0),t("div",Gu,[P.subPlanExecutionRecord.completed?(p(),le(l(T),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):(p(),le(l(T),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})),t("span",Wu,c(P.subPlanExecutionRecord.completed?C.$t("rightPanel.status.completed"):C.$t("rightPanel.status.executing")),1)])])])])):L("",!0)])):L("",!0)]))),128))]),r.value.agentExecution&&!((Q=r.value.agentExecution.thinkActSteps)!=null&&Q.length)?(p(),f("div",zu,[t("p",null,c(l(s)("rightPanel.noStepDetails")),1)])):r.value.agentExecution?L("",!0):(p(),f("div",Ju,[w(l(T),{icon:"carbon:information",class:"info-icon"}),t("h4",null,c(l(s)("rightPanel.stepInfo")),1),t("div",Ku,[t("div",Xu,[t("span",Yu,c(l(s)("rightPanel.stepName"))+":",1),t("span",Qu,c(r.value.title||r.value.description||r.value.stepId),1)]),r.value.description?(p(),f("div",Zu,[t("span",ep,c(C.$t("rightPanel.description"))+":",1),t("span",tp,c(r.value.description),1)])):L("",!0),t("div",sp,[t("span",np,c(C.$t("rightPanel.status.label"))+":",1),t("span",{class:oe(["value",{"status-completed":r.value.completed,"status-current":r.value.current,"status-pending":!r.value.completed&&!r.value.current}])},c(r.value.completed?C.$t("rightPanel.status.completed"):r.value.current?C.$t("rightPanel.status.executing"):C.$t("rightPanel.status.pending")),3)])]),t("p",op,c(l(s)("rightPanel.noExecutionInfo")),1)])),r.value.current&&!r.value.completed?(p(),f("div",ap,[U[2]||(U[2]=t("div",{class:"execution-waves"},[t("div",{class:"wave wave-1"}),t("div",{class:"wave wave-2"}),t("div",{class:"wave wave-3"})],-1)),t("p",lp,[w(l(T),{icon:"carbon:in-progress",class:"rotating-icon"}),ne(" "+c(l(s)("rightPanel.stepExecuting")),1)])])):L("",!0)])):(p(),f("div",rp,[w(l(T),{icon:"carbon:events",class:"empty-icon"}),t("h3",null,c(l(s)("rightPanel.noStepSelected")),1),t("p",null,c(l(s)("rightPanel.selectStepHint")),1)]))])):L("",!0),w(qe,{name:"scroll-button"},{default:Fe(()=>[u.value?(p(),f("button",{key:0,onClick:S,class:"scroll-to-bottom-btn",title:l(s)("rightPanel.scrollToBottom")},[w(l(T),{icon:"carbon:chevron-down"})],8,ip)):L("",!0)]),_:1})],544)])):L("",!0),i.value==="files"?(p(),f("div",cp,[M.value?(p(),le(Yd,{key:0,"plan-id":M.value},null,8,["plan-id"])):_.value?(p(),f("div",dp,[w(l(T),{icon:"carbon:folder-off"}),t("div",up,[t("h3",null,c(l(s)("fileBrowser.noFilesYet")),1),t("p",null,c(l(s)("fileBrowser.noPlanExecuting")),1),t("div",pp,[w(l(T),{icon:"carbon:information"}),t("span",null,c(l(s)("fileBrowser.startTaskTip")),1)])])])):L("",!0)])):L("",!0)])])}}}),mp=he(hp,[["__scopeId","data-v-ea214380"]]);function jt(){return{formatResponseText:g=>g?g.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\n/g,"<br>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>"):"",formatTimestamp:g=>{const d=new Date().getTime()-g.getTime();return d<6e4?"Just now":d<36e5?`${Math.floor(d/6e4)} minutes ago`:d<864e5?`${Math.floor(d/36e5)} hours ago`:g.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},getMessageClasses:g=>ue(()=>({user:g.type==="user",assistant:g.type==="assistant",streaming:g.isStreaming,"has-error":!!g.error,"has-thinking":!!g.thinking,"has-execution":!!g.planExecution})),formatFileSize:g=>{if(g===0)return"0 B";const u=1024,d=["B","KB","MB","GB"],b=Math.floor(Math.log(g)/Math.log(u));return parseFloat((g/Math.pow(u,b)).toFixed(2))+" "+d[b]},truncateText:(g,u=100)=>!g||g.length<=u?g:g.substring(0,u)+"...",stripHtml:g=>g.replace(/<[^>]*>/g,""),hasDisplayableContent:g=>!!(g.content||g.thinking||g.planExecution||g.error),getMessageStatus:g=>g.error?"Send failed":g.isStreaming?"Typing...":g.type==="assistant"&&!g.content&&!g.thinking?"Waiting for response":""}}const fp=["data-message-id"],vp={class:"user-content"},gp={class:"message-text"},bp={key:0,class:"attachments"},yp={class:"attachment-name"},_p={class:"attachment-size"},$p={class:"message-timestamp"},wp={key:0,class:"message-status error"},Sp={class:"status-text"},kp=pe({__name:"UserMessage",props:{message:{}},setup(o){const{formatTimestamp:e,formatFileSize:n}=jt();return(s,a)=>{var r;return p(),f("div",{class:"user-message","data-message-id":s.message.id},[t("div",vp,[t("div",gp,c(s.message.content),1),(r=s.message.attachments)!=null&&r.length?(p(),f("div",bp,[(p(!0),f(ae,null,ie(s.message.attachments,(i,h)=>(p(),f("div",{key:h,class:"attachment-item"},[w(l(T),{icon:"carbon:document",class:"attachment-icon"}),t("span",yp,c(i.name),1),t("span",_p,c(l(n)(i.size)),1)]))),128))])):L("",!0),t("div",$p,c(l(e)(s.message.timestamp)),1)]),s.message.error?(p(),f("div",wp,[w(l(T),{icon:"carbon:warning",class:"status-icon"}),t("span",Sp,c(s.message.error),1)])):L("",!0)],8,fp)}}}),Tp=he(kp,[["__scopeId","data-v-94372507"]]),Pp={class:"sub-plan-info"},Ep={class:"sub-plan-details"},Cp={class:"sub-plan-title"},Ip={key:0,class:"nesting-level"},Rp={class:"sub-plan-id"},Ap={class:"sub-plan-meta"},xp={key:0,class:"trigger-tool"},Dp={class:"trigger-text"},Mp={key:0,class:"sub-plan-progress"},Fp={class:"progress-info"},Up={class:"progress-text"},Np={class:"progress-bar"},Lp={key:1,class:"sub-plan-agents-steps"},Bp={class:"agents-steps-header"},Op={class:"agents-label"},qp={class:"agents-steps-list"},jp=["onClick"],Vp={class:"agent-step-header"},Hp={class:"agent-name"},Gp={class:"sub-agent-execution-info"},Wp={key:0,class:"agent-result"},zp={class:"result-header"},Jp={class:"result-label"},Kp={class:"result-content"},Xp={key:1,class:"agent-error"},Yp={class:"error-header"},Qp={class:"error-label"},Zp={class:"error-content"},eh={key:2,class:"think-act-preview"},th={class:"think-act-header"},sh={class:"think-act-label"},nh={class:"think-act-steps-preview"},oh=["onClick"],ah={class:"step-number"},lh={class:"step-description"},rh={key:0,class:"more-steps"},ih={class:"more-steps-text"},ch={key:3,class:"nested-sub-plans"},dh={class:"nested-sub-plans-header"},uh={class:"nested-label"},ph={class:"nested-sub-plans-list"},hh={key:4,class:"direct-sub-plans"},mh={class:"direct-sub-plans-header"},fh={class:"direct-label"},vh={class:"direct-sub-plans-list"},gh=pe({__name:"RecursiveSubPlan",props:{subPlan:{},subPlanIndex:{},nestingLevel:{default:0},maxNestingDepth:{default:3},maxVisibleSteps:{default:2}},emits:["sub-plan-selected","step-selected"],setup(o,{emit:e}){const n=o,s=e,{t:a}=Pe(),r=()=>`nesting-level-${n.nestingLevel}`,i=()=>{var D,W;return n.subPlan.completed?"completed":((D=n.subPlan.agentExecutionSequence)==null?void 0:D.some(C=>C.status==="RUNNING"))?"running":((W=n.subPlan.agentExecutionSequence)==null?void 0:W.some(C=>C.status==="FINISHED"))?"in-progress":"pending"},h=()=>{switch(i()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},g=()=>{switch(i()){case"completed":return"carbon:checkmark";case"running":return"carbon:play";case"in-progress":return"carbon:in-progress";case"pending":default:return"carbon:dot-mark"}},u=()=>{var q;if(!((q=n.subPlan.agentExecutionSequence)!=null&&q.length))return 0;if(n.subPlan.completed)return 100;const m=d();return Math.min(100,m/n.subPlan.agentExecutionSequence.length*100)},d=()=>{var m;return(m=n.subPlan.agentExecutionSequence)!=null&&m.length?n.subPlan.agentExecutionSequence.filter(q=>q.status==="FINISHED").length:0},b=m=>{switch(m){case"FINISHED":return"completed";case"RUNNING":return"running";case"IDLE":default:return"pending"}},R=m=>{switch(m){case"FINISHED":return"carbon:checkmark";case"RUNNING":return"carbon:play";case"IDLE":default:return"carbon:dot-mark"}},M=m=>{switch(m){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},_=m=>{var q;return((q=m.thinkActSteps)==null?void 0:q.some(D=>D.subPlanExecutionRecord))??!1},y=m=>{var q;return((q=m.thinkActSteps)==null?void 0:q.filter(D=>D.subPlanExecutionRecord))??[]},v=()=>{s("sub-plan-selected",-1,n.subPlanIndex,n.subPlan)},$=(m,q)=>{const D=q.stepId||`subplan-${n.subPlanIndex}-agent-${m}`;s("step-selected",D)},E=(m,q,D)=>{const W=D.stepId||`subplan-${n.subPlanIndex}-agent-${m}`;s("step-selected",W)},S=(m,q,D)=>{s("sub-plan-selected",m,q,D)},I=m=>{s("step-selected",m)};return(m,q)=>{var W,C;const D=rs("RecursiveSubPlan",!0);return p(),f("div",{class:oe(["recursive-sub-plan",r()])},[t("div",{class:"sub-plan-header",onClick:v},[t("div",Pp,[w(l(T),{icon:g(),class:"sub-plan-status-icon"},null,8,["icon"]),t("div",Ep,[t("div",Cp,[ne(c(m.subPlan.title||m.$t("chat.subPlan"))+" #"+c(m.subPlanIndex+1)+" ",1),(m.nestingLevel??0)>0?(p(),f("span",Ip,"(L"+c((m.nestingLevel??0)+1)+")",1)):L("",!0)]),t("div",Rp,c(m.subPlan.currentPlanId),1)])]),t("div",Ap,[t("div",{class:oe(["sub-plan-status-badge",i()])},c(h()),3),m.subPlan.parentActToolCall?(p(),f("div",xp,[w(l(T),{icon:"carbon:function",class:"trigger-icon"}),t("span",Dp,c(m.subPlan.parentActToolCall.name),1)])):L("",!0)])]),(W=m.subPlan.agentExecutionSequence)!=null&&W.length?(p(),f("div",Mp,[t("div",Fp,[t("span",Up,c(m.$t("chat.progress"))+": "+c(d())+" / "+c(m.subPlan.agentExecutionSequence.length),1),t("div",Np,[t("div",{class:"progress-fill",style:We({width:u()+"%"})},null,4)])])])):L("",!0),(C=m.subPlan.agentExecutionSequence)!=null&&C.length?(p(),f("div",Lp,[t("div",Bp,[t("span",Op,c(m.$t("chat.agentExecutions"))+":",1)]),t("div",qp,[(p(!0),f(ae,null,ie(m.subPlan.agentExecutionSequence,(U,z)=>{var Q,P;return p(),f("div",{key:U.id||z,class:oe(["agent-step-item",b(U.status)]),onClick:x=>$(z,U)},[t("div",Vp,[w(l(T),{icon:R(U.status),class:"agent-icon"},null,8,["icon"]),t("span",Hp,c(U.agentName||m.$t("chat.unknownAgent")),1),t("div",{class:oe(["agent-status-badge",b(U.status)])},c(M(U.status)),3)]),t("div",Gp,[U.result?(p(),f("div",Wp,[t("div",zp,[w(l(T),{icon:"carbon:checkmark",class:"result-icon"}),t("span",Jp,c(m.$t("chat.agentResult"))+":",1)]),t("pre",Kp,c(U.result),1)])):L("",!0),U.errorMessage?(p(),f("div",Xp,[t("div",Yp,[w(l(T),{icon:"carbon:warning",class:"error-icon"}),t("span",Qp,c(m.$t("chat.errorMessage"))+":",1)]),t("pre",Zp,c(U.errorMessage),1)])):L("",!0),(Q=U.thinkActSteps)!=null&&Q.length?(p(),f("div",eh,[t("div",th,[w(l(T),{icon:"carbon:thinking",class:"think-act-icon"}),t("span",sh,c(m.$t("chat.thinkActSteps"))+" ("+c(U.thinkActSteps.length)+")",1)]),t("div",nh,[(p(!0),f(ae,null,ie(U.thinkActSteps.slice(0,m.maxVisibleSteps??2),(x,B)=>(p(),f("div",{key:x.id||B,class:"think-act-step-preview",onClick:fe(J=>E(z,B,U),["stop"])},[t("span",ah,"#"+c(B+1),1),t("span",lh,c(x.actionDescription||m.$t("chat.thinking")),1),w(l(T),{icon:"carbon:arrow-right",class:"step-arrow"})],8,oh))),128)),U.thinkActSteps.length>(m.maxVisibleSteps??2)?(p(),f("div",rh,[t("span",ih,c(m.$t("chat.andMoreSteps",{count:U.thinkActSteps.length-(m.maxVisibleSteps??2)})),1)])):L("",!0)])])):L("",!0),_(U)?(p(),f("div",ch,[t("div",dh,[w(l(T),{icon:"carbon:tree-view-alt",class:"nested-icon"}),t("span",uh,c(m.$t("chat.nestedSubPlans")),1)]),t("div",ph,[(p(!0),f(ae,null,ie(y(U),(x,B)=>(p(),le(D,{key:x.id||B,"sub-plan":x.subPlanExecutionRecord,"sub-plan-index":B,"nesting-level":(m.nestingLevel??0)+1,"max-nesting-depth":m.maxNestingDepth??3,"max-visible-steps":m.maxVisibleSteps??2,onSubPlanSelected:S,onStepSelected:I},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):L("",!0),(P=U.subPlanExecutionRecords)!=null&&P.length?(p(),f("div",hh,[t("div",mh,[w(l(T),{icon:"carbon:tree-view",class:"direct-icon"}),t("span",fh,c(m.$t("chat.directSubPlans")),1)]),t("div",vh,[(p(!0),f(ae,null,ie(U.subPlanExecutionRecords,(x,B)=>(p(),le(D,{key:x.currentPlanId||B,"sub-plan":x,"sub-plan-index":B,"nesting-level":(m.nestingLevel??0)+1,"max-nesting-depth":m.maxNestingDepth??3,"max-visible-steps":m.maxVisibleSteps??2,onSubPlanSelected:S,onStepSelected:I},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):L("",!0)])],10,jp)}),128))])])):L("",!0)],2)}}}),bh=he(gh,[["__scopeId","data-v-5ef3cbb7"]]),yh={class:"execution-details"},_h={key:0,class:"plan-overview"},$h={class:"plan-header"},wh={class:"plan-title"},Sh={key:0,class:"parent-tool-call"},kh={class:"parent-tool-header"},Th={class:"tool-label"},Ph={class:"tool-name"},Eh={key:0,class:"tool-parameters"},Ch={class:"param-label"},Ih={class:"param-content"},Rh={key:1,class:"agent-execution-container"},Ah={class:"section-title"},xh=["onClick"],Dh={class:"agent-info"},Mh={class:"agent-details"},Fh={class:"agent-name"},Uh={class:"request-content"},Nh={class:"agent-controls"},Lh={class:"agent-execution-info"},Bh={key:0,class:"agent-result"},Oh={class:"result-header"},qh={class:"result-label"},jh={class:"result-content"},Vh={key:1,class:"agent-error"},Hh={class:"error-header"},Gh={class:"error-label"},Wh={class:"error-content"},zh={key:0,class:"sub-plans-container"},Jh={class:"sub-plans-header"},Kh={class:"sub-plans-title"},Xh={class:"sub-plans-list"},Yh=pe({__name:"ExecutionDetails",props:{planExecution:{},genericInput:{}},emits:["agent-selected","sub-plan-selected","user-input-submitted","step-selected"],setup(o,{emit:e}){const n=o,s=e,{t:a}=Pe(),r=ue(()=>{var y;return((y=n.planExecution)==null?void 0:y.agentExecutionSequence)??[]}),i=y=>{y.stepId?s("step-selected",y.stepId):console.warn("[ExecutionDetails] Agent execution has no stepId:",y)},h=()=>n.planExecution?n.planExecution.completed?"completed":r.value.some($=>$.status==="RUNNING")?"running":r.value.some($=>$.status==="FINISHED")?"in-progress":"pending":"unknown",g=()=>{switch(h()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},u=y=>{switch(y){case"RUNNING":return"running";case"FINISHED":return"completed";case"IDLE":default:return"pending"}},d=y=>{switch(y){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},b=y=>{switch(y){case"RUNNING":return"carbon:play";case"FINISHED":return"carbon:checkmark";case"IDLE":default:return"carbon:dot-mark"}},R=(y,v,$)=>{s("sub-plan-selected",y,v,$)},M=y=>{s("step-selected",y)},_=y=>{if(!y)return"";try{const v=JSON.parse(y);return JSON.stringify(v,null,2)}catch{return y}};return(y,v)=>{var $,E,S;return p(),f("div",yh,[y.planExecution?(p(),f("div",_h,[t("div",$h,[t("h3",wh,c(y.planExecution.title||y.$t("chat.planExecution")),1),t("div",{class:oe(["plan-status-badge",h()])},c(g()),3)]),y.planExecution.parentActToolCall?(p(),f("div",Sh,[t("div",kh,[w(l(T),{icon:"carbon:flow",class:"tool-icon"}),t("span",Th,c(y.$t("chat.triggeredByTool"))+":",1),t("span",Ph,c(y.planExecution.parentActToolCall.name),1)]),y.planExecution.parentActToolCall.parameters?(p(),f("div",Eh,[t("span",Ch,c(y.$t("common.parameters"))+":",1),t("pre",Ih,c(_(y.planExecution.parentActToolCall.parameters)),1)])):L("",!0)])):L("",!0)])):L("",!0),(((E=($=y.planExecution)==null?void 0:$.agentExecutionSequence)==null?void 0:E.length)??0)>0?(p(),f("div",Rh,[t("h4",Ah,c(y.$t("chat.agentExecutionSequence")),1),(p(!0),f(ae,null,ie((S=y.planExecution)==null?void 0:S.agentExecutionSequence,(I,m)=>{var q;return p(),f("div",{key:I.id||m,class:oe(["agent-execution-item",u(I.status)])},[t("div",{class:"agent-header",onClick:D=>i(I)},[t("div",Dh,[w(l(T),{icon:b(I.status),class:"agent-status-icon"},null,8,["icon"]),t("div",Mh,[t("div",Fh,c(I.agentName||y.$t("chat.unknownAgent")),1),t("pre",Uh,c(I.agentRequest),1)])]),t("div",Nh,[t("div",{class:oe(["agent-status-badge",u(I.status)])},c(d(I.status)),3),w(l(T),{icon:"carbon:arrow-right",class:"step-select-icon"})])],8,xh),t("div",Lh,[I.result?(p(),f("div",Bh,[t("div",Oh,[w(l(T),{icon:"carbon:checkmark",class:"result-icon"}),t("span",qh,c(y.$t("chat.agentResult"))+":",1)]),t("pre",jh,c(I.result),1)])):L("",!0),I.errorMessage?(p(),f("div",Vh,[t("div",Hh,[w(l(T),{icon:"carbon:warning",class:"error-icon"}),t("span",Gh,c(y.$t("chat.errorMessage"))+":",1)]),t("pre",Wh,c(I.errorMessage),1)])):L("",!0)]),(q=I.subPlanExecutionRecords)!=null&&q.length?(p(),f("div",zh,[t("div",Jh,[w(l(T),{icon:"carbon:tree-view",class:"sub-plans-icon"}),t("span",Kh,c(y.$t("chat.subPlanExecutions"))+" ("+c(I.subPlanExecutionRecords.length)+") ",1)]),t("div",Xh,[(p(!0),f(ae,null,ie(I.subPlanExecutionRecords,(D,W)=>(p(),le(bh,{key:D.currentPlanId||W,"sub-plan":D,"sub-plan-index":W,"nesting-level":0,"max-nesting-depth":3,"max-visible-steps":2,onSubPlanSelected:R,onStepSelected:M},null,8,["sub-plan","sub-plan-index"]))),128))])])):L("",!0)],2)}),128))])):L("",!0)])}}}),Bs=he(Yh,[["__scopeId","data-v-2d936ebb"]]),Qh={key:0,class:"thinking-section"},Zh={class:"thinking-header"},em={class:"thinking-avatar"},tm={class:"thinking-label"},sm={class:"thinking-content"},nm={key:0,class:"thinking"},om={key:2,class:"default-processing"},am={class:"processing-indicator"},lm=pe({__name:"ThinkingSection",props:{thinking:{},thinkingDetails:{},planExecution:{},stepActions:{},genericInput:{},hasContent:{type:Boolean}},emits:["agent-selected","sub-plan-selected","user-input-submitted","step-selected"],setup(o,{emit:e}){const n=o,s=e,a=ue(()=>{var u,d,b,R;return n.thinking||(((d=(u=n.thinkingDetails)==null?void 0:u.agentExecutionSequence)==null?void 0:d.length)??0)>0||(((R=(b=n.planExecution)==null?void 0:b.agentExecutionSequence)==null?void 0:R.length)??0)>0}),r=(u,d)=>{s("agent-selected",u,d)},i=(u,d,b)=>{s("sub-plan-selected",u,d,b)},h=u=>{s("user-input-submitted",u)},g=u=>{s("step-selected",u)};return(u,d)=>a.value?(p(),f("div",Qh,[t("div",Zh,[t("div",em,[w(l(T),{icon:"carbon:thinking",class:"thinking-icon"})]),t("div",tm,c(u.$t("chat.thinkingLabel")),1)]),t("div",sm,[u.thinking?(p(),f("div",nm,[w(l(T),{icon:"carbon:thinking",class:"thinking-icon"}),t("span",null,c(u.thinking),1)])):L("",!0),u.thinkingDetails||u.planExecution?(p(),le(Bs,{key:1,"plan-execution":u.thinkingDetails||u.planExecution,"step-actions":u.stepActions||[],"generic-input":u.genericInput||"",onAgentSelected:r,onSubPlanSelected:i,onUserInputSubmitted:h,onStepSelected:g},null,8,["plan-execution","step-actions","generic-input"])):!u.hasContent&&u.thinking?(p(),f("div",om,[t("div",am,[d[0]||(d[0]=t("div",{class:"thinking-dots"},[t("span"),t("span"),t("span")],-1)),t("span",null,c(u.thinking||u.$t("chat.thinkingProcessing")),1)])])):L("",!0)])])):L("",!0)}}),rm=he(lm,[["__scopeId","data-v-c341487f"]]);class St{static async getDetails(e){try{const n=await fetch(`${this.BASE_URL}/details/${e}`);if(n.status===404)return null;if(!n.ok){const r=await n.text();throw new Error(`Failed to get detailed information: ${n.status} - ${r}`)}const s=await n.text(),a=JSON.parse(s);return a&&typeof a=="object"&&!a.currentPlanId&&(a.currentPlanId=e),a}catch(n){return console.error("[CommonApiService] Failed to get plan details:",n),null}}static async submitFormInput(e,n){const s=await fetch(`${this.BASE_URL}/submit-input/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!s.ok){let r;try{r=await s.json()}catch{r={message:`Failed to submit form input: ${s.status}`}}throw new Error(r.message||`Failed to submit form input: ${s.status}`)}const a=s.headers.get("content-type");return a&&a.indexOf("application/json")!==-1?await s.json():{success:!0}}static async getAllPrompts(){try{const e=await fetch(this.BASE_URL);return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get Prompt list:",e),e}}static async handleResponse(e){if(!e.ok)try{const n=await e.json();throw new Error(n.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}}ge(St,"BASE_URL","/api/executor");const im={class:"user-input-form-container"},cm={class:"user-input-header"},dm={class:"user-input-title"},um={class:"user-input-message"},pm={key:0,class:"form-description"},hm={key:0,class:"form-grid"},mm=["for"],fm=["id","name","placeholder","required","onUpdate:modelValue"],vm=["id","name","placeholder","required","onUpdate:modelValue"],gm=["id","name","placeholder","required","onUpdate:modelValue"],bm=["id","name","placeholder","required","onUpdate:modelValue"],ym=["id","name","placeholder","required","onUpdate:modelValue"],_m=["id","name","required","onUpdate:modelValue"],$m={value:""},wm=["value"],Sm={key:6,class:"checkbox-group"},km=["id","name","value","onUpdate:modelValue"],Tm={class:"checkbox-label"},Pm={key:7,class:"radio-group"},Em=["id","name","value","onUpdate:modelValue"],Cm={class:"radio-label"},Im=["id","name","placeholder","required","onUpdate:modelValue"],Rm={key:1,class:"form-group"},Am={for:"form-input-genericInput"},xm={type:"submit",class:"submit-user-input-btn"},Dm=pe({__name:"UserInputForm",props:{userInputWaitState:{},planId:{},genericInput:{}},emits:["user-input-submitted"],setup(o,{emit:e}){const n=o,s=e;Pe();const a=nt({}),r=F(n.genericInput||""),i=F(!1),h=F(null),g=()=>{var M;const R=(M=n.userInputWaitState)==null?void 0:M.formInputs;R&&R.length>0&&(!i.value||Object.keys(a).length!==R.length)&&(R.forEach((y,v)=>{(!(v in a)||y.type==="checkbox"&&!Array.isArray(a[v])||y.type!=="checkbox"&&a[v]==="")&&(y.type==="checkbox"?a[v]=[]:a[v]="")}),i.value=!0)};we(()=>{g()}),de(()=>{var R;return(R=n.userInputWaitState)==null?void 0:R.formInputs},()=>{h.value&&clearTimeout(h.value),h.value=setTimeout(()=>{i.value=!1,g()},100)},{deep:!0});const u=async()=>{var R;try{const M={},_=(R=n.userInputWaitState)==null?void 0:R.formInputs;_&&_.length>0?Object.entries(a).forEach(([y,v])=>{const $=parseInt(y,10),E=_[$];if(E){const S=E.label||`input_${y}`;Array.isArray(v)?M[S]=v.join(", "):M[S]=v}}):M.genericInput=r.value,console.log("[UserInputForm] Submitting user input:",M,"for planId:",n.planId),n.planId?(await St.submitFormInput(n.planId,M),console.log("[UserInputForm] User input submitted successfully")):console.error("[UserInputForm] No planId available for user input submission"),s("user-input-submitted",M)}catch(M){console.error("[UserInputForm] User input submission failed:",M)}},d=R=>R?Array.isArray(R)?R:typeof R=="string"?R.split(",").map(M=>M.trim()).filter(M=>M.length>0):[]:[],b=R=>typeof R=="boolean"?R:typeof R=="string"?R==="true":!1;return Te(()=>{h.value&&clearTimeout(h.value)}),(R,M)=>{var _,y,v,$,E;return p(),f("div",im,[t("div",cm,[w(l(T),{icon:"carbon:user",class:"user-icon"}),t("h4",dm,c(R.$t("chat.userInputRequired")),1)]),t("p",um,c(((_=R.userInputWaitState)==null?void 0:_.title)??R.$t("chat.userInput.message")),1),(y=R.userInputWaitState)!=null&&y.formDescription?(p(),f("p",pm,c((v=R.userInputWaitState)==null?void 0:v.formDescription),1)):L("",!0),t("form",{onSubmit:fe(u,["prevent"]),class:"user-input-form"},[($=R.userInputWaitState)!=null&&$.formInputs&&R.userInputWaitState.formInputs.length>0?(p(),f("div",hm,[(p(!0),f(ae,null,ie((E=R.userInputWaitState)==null?void 0:E.formInputs,(S,I)=>(p(),f("div",{key:I,class:"form-group"},[t("label",{for:`form-input-${S.label.replace(/\W+/g,"_")}`},c(S.label)+c(b(S.required)?" *":"")+": ",9,mm),!S.type||S.type==="text"?se((p(),f("input",{key:0,type:"text",id:`form-input-${S.label.replace(/\W+/g,"_")}`,name:S.label,placeholder:S.placeholder||"",required:b(S.required),"onUpdate:modelValue":m=>a[I]=m,class:"form-input"},null,8,fm)),[[re,a[I]]]):S.type==="email"?se((p(),f("input",{key:1,type:"email",id:`form-input-${S.label.replace(/\W+/g,"_")}`,name:S.label,placeholder:S.placeholder||"",required:b(S.required),"onUpdate:modelValue":m=>a[I]=m,class:"form-input"},null,8,vm)),[[re,a[I]]]):S.type==="number"?se((p(),f("input",{key:2,type:"number",id:`form-input-${S.label.replace(/\W+/g,"_")}`,name:S.label,placeholder:S.placeholder||"",required:b(S.required),"onUpdate:modelValue":m=>a[I]=m,class:"form-input"},null,8,gm)),[[re,a[I]]]):S.type==="password"?se((p(),f("input",{key:3,type:"password",id:`form-input-${S.label.replace(/\W+/g,"_")}`,name:S.label,placeholder:S.placeholder||"",required:b(S.required),"onUpdate:modelValue":m=>a[I]=m,class:"form-input"},null,8,bm)),[[re,a[I]]]):S.type==="textarea"?se((p(),f("textarea",{key:4,id:`form-input-${S.label.replace(/\W+/g,"_")}`,name:S.label,placeholder:S.placeholder||"",required:b(S.required),"onUpdate:modelValue":m=>a[I]=m,class:"form-input form-textarea",rows:"4"},null,8,ym)),[[re,a[I]]]):S.type==="select"&&S.options?se((p(),f("select",{key:5,id:`form-input-${S.label.replace(/\W+/g,"_")}`,name:S.label,required:b(S.required),"onUpdate:modelValue":m=>a[I]=m,class:"form-input form-select"},[t("option",$m,c(R.$t("selectCommon.pleaseSelect")),1),(p(!0),f(ae,null,ie(d(S.options),m=>(p(),f("option",{key:m,value:m},c(m),9,wm))),128))],8,_m)),[[ot,a[I]]]):S.type==="checkbox"&&S.options?(p(),f("div",Sm,[(p(!0),f(ae,null,ie(d(S.options),m=>(p(),f("label",{key:m,class:"checkbox-item"},[se(t("input",{type:"checkbox",id:`form-input-${S.label.replace(/\W+/g,"_")}-${m.replace(/\W+/g,"_")}`,name:S.label,value:m,"onUpdate:modelValue":q=>a[I]=q,class:"form-checkbox"},null,8,km),[[ct,a[I]]]),t("span",Tm,c(m),1)]))),128))])):S.type==="radio"&&S.options?(p(),f("div",Pm,[(p(!0),f(ae,null,ie(d(S.options),m=>(p(),f("label",{key:m,class:"radio-item"},[se(t("input",{type:"radio",id:`form-input-${S.label.replace(/\W+/g,"_")}-${m.replace(/\W+/g,"_")}`,name:S.label,value:m,"onUpdate:modelValue":q=>a[I]=q,class:"form-radio"},null,8,Em),[[Vs,a[I]]]),t("span",Cm,c(m),1)]))),128))])):se((p(),f("input",{key:8,type:"text",id:`form-input-${S.label.replace(/\W+/g,"_")}`,name:S.label,placeholder:S.placeholder||"",required:b(S.required),"onUpdate:modelValue":m=>a[I]=m,class:"form-input"},null,8,Im)),[[re,a[I]]])]))),128))])):(p(),f("div",Rm,[t("label",Am,c(R.$t("common.input"))+":",1),se(t("input",{type:"text",id:"form-input-genericInput",name:"genericInput","onUpdate:modelValue":M[0]||(M[0]=S=>r.value=S),class:"form-input"},null,512),[[re,r.value]])])),t("button",xm,c(R.$t("chat.userInput.submit")),1)],32)])}}}),Mm=he(Dm,[["__scopeId","data-v-043b591c"]]),Fm={class:"response-section"},Um={class:"response-header"},Nm={class:"response-avatar"},Lm={class:"response-name"},Bm={key:0,class:"response-timestamp"},Om={class:"response-content"},qm={key:1,class:"final-response"},jm=["innerHTML"],Vm={class:"response-actions"},Hm=["title"],Gm=["title"],Wm={key:2,class:"response-placeholder"},zm={class:"typing-indicator"},Jm={class:"typing-text"},Km={key:3,class:"response-error"},Xm={class:"error-text"},Ym={key:4,class:"response-empty"},Qm={class:"empty-text"},Zm=pe({__name:"ResponseSection",props:{content:{},isStreaming:{type:Boolean},error:{},timestamp:{},userInputWaitState:{},planId:{},genericInput:{}},emits:["copy","regenerate","retry","user-input-submitted"],setup(o,{emit:e}){const n=o,s=e,{formatResponseText:a,formatTimestamp:r}=jt(),i=async()=>{if(n.content)try{const d=n.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(d),s("copy")}catch(d){console.error("Failed to copy to clipboard:",d)}},h=()=>{s("regenerate")},g=()=>{s("retry")},u=d=>{console.log("[ResponseSection] User input submitted:",d),s("user-input-submitted",d)};return(d,b)=>{var R;return p(),f("div",Fm,[t("div",Um,[t("div",Nm,[w(l(T),{icon:"carbon:bot",class:"bot-icon"})]),t("div",Lm,c(d.$t("chat.botName")),1),d.timestamp?(p(),f("div",Bm,c(l(r)(d.timestamp)),1)):L("",!0)]),t("div",Om,[(R=d.userInputWaitState)!=null&&R.waiting?(p(),le(Mm,is({key:0,"user-input-wait-state":d.userInputWaitState},d.planId?{"plan-id":d.planId}:{},{"generic-input":d.genericInput??"",onUserInputSubmitted:u}),null,16,["user-input-wait-state","generic-input"])):L("",!0),d.content?(p(),f("div",qm,[t("div",{class:"response-text",innerHTML:l(a)(d.content)},null,8,jm),t("div",Vm,[t("button",{class:"action-btn copy-btn",onClick:i,title:d.$t("chat.copyResponse")},[w(l(T),{icon:"carbon:copy"})],8,Hm),t("button",{class:"action-btn regenerate-btn",onClick:h,title:d.$t("chat.regenerateResponse")},[w(l(T),{icon:"carbon:renew"})],8,Gm)])])):d.isStreaming?(p(),f("div",Wm,[t("div",zm,[b[0]||(b[0]=t("div",{class:"typing-dots"},[t("span"),t("span"),t("span")],-1)),t("span",Jm,c(d.$t("chat.thinkingResponse")),1)])])):d.error?(p(),f("div",Km,[w(l(T),{icon:"carbon:warning",class:"error-icon"}),t("span",Xm,c(d.error),1),t("button",{class:"retry-btn",onClick:g},c(d.$t("chat.retry")),1)])):(p(),f("div",Ym,[t("span",Qm,c(d.$t("chat.waitingForResponse")),1)]))])])}}}),ef=he(Zm,[["__scopeId","data-v-6581a34f"]]),tf={class:"assistant-message"},sf=pe({__name:"AssistantMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(o,{emit:e}){const n=o,s=e,a=()=>{s("copy",n.message.id)},r=()=>{s("regenerate",n.message.id)},i=()=>{s("retry",n.message.id)},h=(u,d)=>{console.log("[AssistantMessage] User input submitted:",d,"for message:",u.id)},g=u=>{console.log("[AssistantMessage] Step selected:",u),s("step-selected",u)};return(u,d)=>{var b,R,M,_;return p(),f("div",tf,[u.message.thinkingDetails?(p(),le(rm,{key:0,"thinking-details":u.message.thinkingDetails,onStepSelected:g},null,8,["thinking-details"])):L("",!0),u.message.planExecution?(p(),le(Bs,{key:1,"plan-execution":u.message.planExecution,"step-actions":u.message.stepActions||[],"generic-input":u.message.genericInput||"",onStepSelected:g},null,8,["plan-execution","step-actions","generic-input"])):L("",!0),u.message.content||u.message.error||u.isStreaming||(R=(b=u.message.planExecution)==null?void 0:b.userInputWaitState)!=null&&R.waiting?(p(),le(ef,is({key:2,content:u.message.content||"","is-streaming":u.isStreaming||!1},{...u.message.error?{error:u.message.error}:{},...(M=u.message.planExecution)!=null&&M.userInputWaitState?{userInputWaitState:u.message.planExecution.userInputWaitState}:{},...(_=u.message.planExecution)!=null&&_.currentPlanId?{planId:u.message.planExecution.currentPlanId}:{}},{timestamp:u.message.timestamp,"generic-input":u.message.genericInput||"",onCopy:a,onRegenerate:r,onRetry:i,onUserInputSubmitted:d[0]||(d[0]=y=>h(u.message,y))}),null,16,["content","is-streaming","timestamp","generic-input"])):L("",!0)])}}}),nf=he(sf,[["__scopeId","data-v-3810c279"]]),of=pe({__name:"ChatMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(o,{emit:e}){const n=o,s=e,{getMessageClasses:a}=jt(),r=ue(()=>a(n.message)),i=d=>{s("copy",d)},h=d=>{s("regenerate",d)},g=d=>{s("retry",d)},u=d=>{s("step-selected",d)};return(d,b)=>(p(),f("div",{class:oe(["chat-message",r.value])},[d.message.type==="user"?(p(),le(Tp,{key:0,message:d.message},null,8,["message"])):d.message.type==="assistant"?(p(),le(nf,{key:1,message:d.message,"is-streaming":d.isStreaming||!1,onCopy:i,onRegenerate:h,onRetry:g,onStepSelected:u},null,8,["message","is-streaming"])):L("",!0)],2))}}),af=he(of,[["__scopeId","data-v-218b3735"]]);function Ut(o){const e={...o};return"agentExecutionSequence"in o&&Array.isArray(o.agentExecutionSequence)&&(e.agentExecutionSequence=o.agentExecutionSequence.map(n=>lf(n))),e}function lf(o){const e={...o};return"subPlanExecutionRecords"in o&&Array.isArray(o.subPlanExecutionRecords)&&(e.subPlanExecutionRecords=o.subPlanExecutionRecords.map(n=>Ut(n))),e}function rf(o){const e={...o};return"thinkingDetails"in o&&o.thinkingDetails&&(e.thinkingDetails=Ut(o.thinkingDetails)),"planExecution"in o&&o.planExecution&&(e.planExecution=Ut(o.planExecution)),"attachments"in o&&Array.isArray(o.attachments)&&(e.attachments=[...o.attachments]),e}function cf(){const o=F([]),e=F(!1),n=F(null),s=F(null),a=ue(()=>o.value.length>0?o.value[o.value.length-1]:null),r=ue(()=>n.value!==null),i=ue(()=>o.value.length>0),h=(I,m,q)=>{const D={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:I,content:m,timestamp:new Date,isStreaming:!1,...q};return o.value.push(D),D},g=(I,m)=>{const q=o.value.findIndex(D=>D.id===I);q!==-1&&(o.value[q]={...o.value[q],...m})},u=I=>{const m=o.value.findIndex(q=>q.id===I);m!==-1&&o.value.splice(m,1)},d=()=>{o.value=[],n.value=null,s.value=null},b=I=>{n.value=I,g(I,{isStreaming:!0})},R=I=>{I&&g(I,{isStreaming:!1}),n.value===I&&(n.value=null)},M=I=>{s.value=I},_=(I,m,q="content")=>{const D=o.value.find(W=>W.id===I);D&&typeof D[q]=="string"&&g(I,{[q]:D[q]+m})},y=(I,m)=>{g(I,{thinkingDetails:m})},v=(I,m)=>{g(I,{thinking:m})},$=(I,m)=>{g(I,{planExecution:m})},E=I=>o.value.find(m=>m.id===I),S=I=>o.value.findIndex(m=>m.id===I);return{messages:et(o),isLoading:e,streamingMessageId:et(n),activeMessageId:et(s),lastMessage:a,isStreaming:r,hasMessages:i,addMessage:h,updateMessage:g,removeMessage:u,clearMessages:d,startStreaming:b,stopStreaming:R,setActiveMessage:M,appendToMessage:_,updateMessageThinking:v,updateMessageThinkingDetails:y,updateMessagePlanExecution:$,findMessage:E,getMessageIndex:S}}function df(o){const e=F(!1),n=F(!0),s=150,a=async(v=!0)=>{o.value&&(await ke(),o.value.scrollTo({top:o.value.scrollHeight,behavior:v?"smooth":"auto"}))},r=()=>{if(!o.value)return!1;const{scrollTop:v,scrollHeight:$,clientHeight:E}=o.value;return $-v-E<s},i=()=>{if(!o.value)return;const v=r();e.value=!v&&o.value.scrollHeight>o.value.clientHeight,v&&(n.value=!0)},h=()=>{i(),r()||(n.value=!1)},g=async()=>{n.value&&await a()},u=async()=>{n.value=!0,await a()},d=(v,$=!0)=>{if(!o.value)return;const E=o.value.querySelector(`[data-message-id="${v}"]`);E&&E.scrollIntoView({behavior:$?"smooth":"auto",block:"center"})},b=()=>{if(!o.value)return{scrollTop:0,scrollHeight:0,clientHeight:0,isAtTop:!0,isAtBottom:!0,scrollPercentage:0};const{scrollTop:v,scrollHeight:$,clientHeight:E}=o.value,S=v===0,I=v+E>=$-5,m=$>E?v/($-E)*100:100;return{scrollTop:v,scrollHeight:$,clientHeight:E,isAtTop:S,isAtBottom:I,scrollPercentage:m}},R=()=>{o.value&&o.value.addEventListener("scroll",h,{passive:!0})},M=()=>{o.value&&o.value.removeEventListener("scroll",h)},_=()=>{R(),i()},y=()=>{M()};return we(()=>{ke(()=>{_()})}),Te(()=>{y()}),{showScrollToBottom:et(e),isAutoScrollEnabled:et(n),scrollToBottom:a,autoScrollToBottom:g,forceScrollToBottom:u,scrollToMessage:d,isNearBottom:r,checkScrollPosition:i,getScrollInfo:b,addScrollListener:R,removeScrollListener:M,initializeScrollBehavior:_,cleanupScrollBehavior:y}}class Vt{static async sendMessage(e){return Gt.withLlmCheck(async()=>{const n={...e,isVueRequest:!0},s=await fetch(`${this.BASE_URL}/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!s.ok)throw new Error(`API request failed: ${s.status}`);return await s.json()})}static async sendMessageWithDefaultPlan(e){return Gt.withLlmCheck(async()=>{const n="default-plan-id-001000222",s={:e.input},a={toolName:n,replacementParams:s,isVueRequest:!0};console.log("[DirectApiService] Sending message with default plan:",a);const r=await fetch(`${this.BASE_URL}/executeByToolNameAsync`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok)throw new Error(`API request failed: ${r.status}`);return await r.json()})}}ge(Vt,"BASE_URL","/api/executor");const uf=Object.freeze(Object.defineProperty({__proto__:null,DirectApiService:Vt},Symbol.toStringTag,{value:"Module"})),Be=class Be{constructor(){ge(this,"POLL_INTERVAL",5e3);ge(this,"state",nt({activePlanId:null,lastSequenceSize:0,isPolling:!1,pollTimer:null}));ge(this,"callbacks",{});ge(this,"planExecutionCache",new Map);ge(this,"uiStateCache",new Map);console.log("[PlanExecutionManager] Initialized with callback-based event system")}getCachedPlanRecord(e){return this.planExecutionCache.get(e)}getCachedUIState(e){return this.uiStateCache.get(e)}setCachedUIState(e,n){this.uiStateCache.set(e,n),console.log(`[PlanExecutionManager] Cached UI state for rootPlanId: ${e}`)}getAllCachedRecords(){return new Map(this.planExecutionCache)}hasCachedPlanRecord(e){return this.planExecutionCache.has(e)}setCachedPlanRecord(e,n){this.planExecutionCache.set(e,n),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${e}`)}clearCachedPlanRecord(e){const n=this.planExecutionCache.delete(e);return n&&console.log(`[PlanExecutionManager] Cleared cached plan execution record for rootPlanId: ${e}`),n}clearAllCachedRecords(){const e=this.planExecutionCache.size,n=this.uiStateCache.size;this.planExecutionCache.clear(),this.uiStateCache.clear(),console.log(`[PlanExecutionManager] Cleared all caches - Plans: ${e}, UI States: ${n}`)}static getInstance(){return Be.instance||(Be.instance=new Be),Be.instance}getActivePlanId(){return this.state.activePlanId}getState(){return this.state}setEventCallbacks(e){this.callbacks={...this.callbacks,...e},console.log("[PlanExecutionManager] Event callbacks set:",Object.keys(e))}async handleUserMessageSendRequested(e){if(this.validateAndPrepareUIForNewRequest(e))try{if(await this.sendUserMessageAndSetPlanId(e),this.state.activePlanId)this.initiatePlanExecutionSequence(e,this.state.activePlanId);else throw new Error("Failed to get valid plan ID")}catch(n){console.error("[PlanExecutionManager] Failed to send user message:",n);const s=this.state.activePlanId??"error";this.setCachedUIState(s,{enabled:!0}),this.emitChatInputUpdateState(s),this.state.activePlanId=null}}handlePlanExecutionRequested(e,n){console.log("[PlanExecutionManager] Received plan execution request:",{planId:e,query:n}),e?(this.state.activePlanId=e,this.initiatePlanExecutionSequence(n??"Execute Plan",e)):console.error("[PlanExecutionManager] Invalid plan execution request: missing planId")}handleCachedPlanExecution(e,n){const s=this.getCachedPlanRecord(e);return s!=null&&s.currentPlanId?(console.log(`[PlanExecutionManager] Found cached plan execution record for rootPlanId: ${e}`),this.handlePlanExecutionRequested(s.currentPlanId,n),!0):(console.log(`[PlanExecutionManager] No cached plan execution record found for rootPlanId: ${e}`),!1)}validateAndPrepareUIForNewRequest(e){if(!e)return console.warn("[PlanExecutionManager] Query is empty"),!1;if(this.state.activePlanId)return!1;this.emitChatInputClear();const n=this.state.activePlanId??"ui-state";return this.setCachedUIState(n,{enabled:!1,placeholder:"Processing..."}),this.emitChatInputUpdateState(n),!0}async sendUserMessageAndSetPlanId(e){try{const n=await Vt.sendMessage({input:e});if(n!=null&&n.planId)return this.state.activePlanId=n.planId,n;if(n!=null&&n.planTemplateId)return this.state.activePlanId=n.planTemplateId,{...n,planId:n.planTemplateId};throw console.error("[PlanExecutionManager] Failed to get planId from response:",n),new Error("Failed to get valid planId from API response")}catch(n){throw console.error("[PlanExecutionManager] API call failed:",n),n}}initiatePlanExecutionSequence(e,n){console.log(`[PlanExecutionManager] Starting plan execution sequence for query: "${e}", planId: ${n}`);const s=n;this.emitDialogRoundStart(s),this.startPolling()}handlePlanCompletion(e){this.emitPlanCompleted(e.rootPlanId??""),this.state.lastSequenceSize=0,this.stopPolling();try{setTimeout(async()=>{if(this.state.activePlanId)try{await tt.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(n){console.log(`Delete plan execution record failed: ${n.message}`)}},5e3)}catch(n){console.log(`Delete plan execution record failed: ${n.message}`)}e.completed&&(this.state.activePlanId=null,this.emitChatInputUpdateState(e.rootPlanId??""))}handlePlanError(e){this.emitPlanError(e.message??""),this.state.lastSequenceSize=0,this.stopPolling();try{setTimeout(async()=>{if(this.state.activePlanId)try{await tt.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(n){console.log(`Delete plan execution record failed: ${n.message}`)}},5e3)}catch(n){console.log(`Delete plan execution record failed: ${n.message}`)}}async pollPlanStatus(){if(this.state.activePlanId){if(this.state.isPolling){console.log("[PlanExecutionManager] Previous polling still in progress, skipping");return}try{this.state.isPolling=!0;const e=await this.getPlanDetails(this.state.activePlanId);if(!e){console.warn("[PlanExecutionManager] No details received from API - this might be a temporary network issue");return}if(e.status&&e.status==="failed"&&e.message&&!e.message.includes("Failed to get detailed information")){this.handlePlanError(e);return}e.rootPlanId&&this.setCachedPlanRecord(e.rootPlanId,e),this.emitPlanUpdate(e.rootPlanId??""),e.completed&&this.handlePlanCompletion(e)}catch(e){console.error("[PlanExecutionManager] Failed to poll plan status:",e)}finally{this.state.isPolling=!1}}}async getPlanDetails(e){try{const n=await St.getDetails(e);return n!=null&&n.rootPlanId&&(this.planExecutionCache.set(n.rootPlanId,n),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${n.rootPlanId}`)),n}catch(n){return console.error("[PlanExecutionManager] Failed to get plan details:",n),{currentPlanId:e,status:"failed",message:n instanceof Error?n.message:"Failed to get plan"}}}startPolling(){this.state.pollTimer&&clearInterval(this.state.pollTimer),this.state.pollTimer=window.setInterval(()=>{this.pollPlanStatus()},this.POLL_INTERVAL),console.log("[PlanExecutionManager] Started polling")}async pollPlanStatusImmediately(){console.log("[PlanExecutionManager] Polling plan status immediately"),await this.pollPlanStatus()}stopPolling(){this.state.pollTimer&&(clearInterval(this.state.pollTimer),this.state.pollTimer=null),console.log("[PlanExecutionManager] Stopped polling")}cleanup(){this.stopPolling(),this.state.activePlanId=null,this.state.lastSequenceSize=0,this.state.isPolling=!1,this.clearAllCachedRecords()}emitChatInputClear(){this.callbacks.onChatInputClear&&this.callbacks.onChatInputClear()}emitChatInputUpdateState(e){this.callbacks.onChatInputUpdateState&&this.callbacks.onChatInputUpdateState(e)}emitDialogRoundStart(e){this.callbacks.onDialogRoundStart&&this.callbacks.onDialogRoundStart(e)}emitPlanUpdate(e){this.callbacks.onPlanUpdate&&this.callbacks.onPlanUpdate(e)}emitPlanCompleted(e){this.callbacks.onPlanCompleted&&this.callbacks.onPlanCompleted(e)}emitPlanError(e){this.callbacks.onPlanError&&this.callbacks.onPlanError(e)}};ge(Be,"instance",null);let Nt=Be;const De=Nt.getInstance(),pf={class:"chat-container"},hf={key:0,class:"loading-message"},mf={class:"loading-content"},ff=["title"],vf=pe({__name:"ChatContainer",props:{mode:{default:"plan"},initialPrompt:{default:""}},emits:["step-selected"],setup(o,{expose:e,emit:n}){const s=n,{t:a}=Pe(),{messages:r,isLoading:i,streamingMessageId:h,addMessage:g,updateMessage:u,startStreaming:d,stopStreaming:b,findMessage:R}=cf(),M=F(null),{scrollToBottom:_,autoScrollToBottom:y,showScrollToBottom:v}=df(M),$=F(),E=x=>h.value===x,S=ue(()=>r.value.map(rf)),I=()=>{},m=x=>{const B=x.target;if(B.classList.contains("md-copy-btn")){const J=B.getAttribute("data-raw");if(J){const Z=decodeURIComponent(J);navigator.clipboard.writeText(Z).then(()=>{B.textContent=a("chat.copied"),setTimeout(()=>{B.textContent=a("chat.copy")},1e3)})}}},q=async x=>{const B=R(x);if(B)try{const J=B.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(J)}catch(J){console.error("Failed to copy message:",J)}},D=x=>{const B=R(x);B&&B.type==="assistant"&&(u(x,{content:""}),d(x))},W=x=>{R(x)&&(u(x,{content:""}),d(x))},C=x=>{console.log("[ChatContainer] Step selected:",x),s("step-selected",x)},U=x=>{console.log("[ChatContainer] Plan update received:",x);const B=De.getCachedPlanRecord(x);if(!B){console.warn("[ChatContainer] No cached plan data found for rootPlanId:",x);return}console.log("[ChatContainer] Retrieved plan details from cache:",B);const J=r.value.findIndex(Z=>{var ee;return((ee=Z.planExecution)==null?void 0:ee.currentPlanId)===B.currentPlanId&&Z.type==="assistant"});if(J!==-1){const Z=r.value[J],ee={planExecution:JSON.parse(JSON.stringify(B))};if(!B.agentExecutionSequence||B.agentExecutionSequence.length===0){if(console.log("[ChatContainer] Handling simple response without agent execution sequence"),B.completed){ee.thinking="";const me=B.summary??B.result??B.message??"Execution completed";ee.content=me,console.log("[ChatContainer] Set simple response content:",me)}}else console.log("[ChatContainer] Handling detailed plan with agent execution sequence");u(Z.id,ee)}},z=x=>{if(console.log("[ChatContainer] Plan completed:",x),x.rootPlanId){const B=r.value.findIndex(J=>{var Z;return((Z=J.planExecution)==null?void 0:Z.currentPlanId)===x.rootPlanId});if(B!==-1){const J=r.value[B],Z=x.summary??x.result??"Execution completed";u(J.id,{thinking:"",content:Z}),console.log("[ChatContainer] Updated completed message:",Z)}}},Q=x=>{console.log("[ChatContainer] Dialog round start:",x)},P=x=>{console.log("[ChatContainer] Plan error:",x),g("assistant",`Error: ${x}`),console.error("[ChatContainer] Plan execution error:",x)};return we(()=>{de(r,()=>{ke(()=>{y()})},{deep:!0}),De.setEventCallbacks({onPlanUpdate:U,onPlanCompleted:z,onDialogRoundStart:Q,onPlanError:P})}),Te(()=>{$.value&&clearInterval($.value)}),e({scrollToBottom:_,handlePlanUpdate:U,handlePlanCompleted:z,handleDialogRoundStart:Q,handlePlanError:P,addMessage:g,updateMessage:u,startStreaming:d,stopStreaming:b}),(x,B)=>(p(),f("div",pf,[t("div",{class:"messages",ref_key:"messagesRef",ref:M,onScroll:I,onClick:m},[(p(!0),f(ae,null,ie(S.value,J=>(p(),le(af,{key:J.id,message:J,"is-streaming":E(J.id),onCopy:q,onRegenerate:D,onRetry:W,onStepSelected:C},null,8,["message","is-streaming"]))),128)),l(i)?(p(),f("div",hf,[t("div",mf,[w(l(T),{icon:"carbon:circle-dash",class:"loading-icon"}),t("span",null,c(x.$t("chat.processing")),1)])])):L("",!0)],544),w(qe,{name:"scroll-button"},{default:Fe(()=>[l(v)?(p(),f("button",{key:0,class:"scroll-to-bottom",onClick:B[0]||(B[0]=()=>l(_)()),title:x.$t("chat.scrollToBottom")},[w(l(T),{icon:"carbon:chevron-down"})],8,ff)):L("",!0)]),_:1})]))}}),gf=he(vf,[["__scopeId","data-v-e7a5d6c9"]]),kt=F([]),ze=F(null),as=o=>{kt.value=[...o]},It=()=>{kt.value=[],ze.value=null},bf=()=>kt.value,yf=()=>kt.value.length>0,_f=o=>{ze.value=o},$f=()=>ze.value||void 0,wf=()=>ze.value!==null&&ze.value.trim()!=="",Sf=()=>{ze.value=null};class kf{static async deleteFile(e,n){try{console.log("[FileUploadApiService] Deleting file:",n,"from plan:",e);const s=await fetch(`/api/file-upload/files/${e}/${encodeURIComponent(n)}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=await s.json();return console.log("[FileUploadApiService] File deleted successfully:",a),a}catch(s){throw console.error("[FileUploadApiService] Error deleting file:",s),s}}static async getUploadedFiles(e){try{console.log("[FileUploadApiService] Getting uploaded files for plan:",e);const n=await fetch(`/api/file-upload/files/${e}`);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const s=await n.json();return console.log("[FileUploadApiService] Got uploaded files:",s.totalCount),s}catch(n){throw console.error("[FileUploadApiService] Error getting uploaded files:",n),n}}}const Tf={class:"input-area"},Pf={class:"input-container"},Ef=["title"],Cf=["placeholder","disabled"],If=["title"],Rf=["disabled","title"],Af={key:0,class:"uploaded-files"},xf={class:"files-header"},Df={class:"files-list"},Mf={class:"file-name"},Ff={class:"file-size"},Uf=["onClick","title"],Nf={key:1,class:"upload-progress"},Lf=pe({__name:"InputArea",props:{placeholder:{default:""},disabled:{type:Boolean,default:!1},initialValue:{default:""}},emits:["send","clear","update-state","plan-mode-clicked","files-uploaded"],setup(o,{expose:e,emit:n}){const{t:s}=Pe(),a=o,r=n,i=F(),h=F(),g=F(""),u=ue(()=>a.placeholder||s("input.placeholder")),d=F(u.value),b=F([]),R=F(!1),M=F(null),_=()=>{console.log("[FileUpload] Resetting session and clearing sessionPlanId"),M.value=null,b.value=[],It(),Sf()};Te(()=>{_()}),de(()=>b.value.length,(P,x)=>{});const y=ue(()=>!!a.disabled),v=()=>{ke(()=>{i.value&&(i.value.style.height="auto",i.value.style.height=Math.min(i.value.scrollHeight,120)+"px")})},$=P=>{P.key==="Enter"&&!P.shiftKey&&(P.preventDefault(),E())},E=()=>{if(!g.value.trim()||y.value)return;let P=g.value.trim();if(b.value.length>0){const B=b.value.map(J=>`${J.name} (${J.relativePath})`).join(", ");P+=`

[Uploaded files: ${B}]`}const x={input:P,memoryId:Ue.selectMemoryId,uploadedFiles:b.value,sessionPlanId:M.value};r("send",x),C(),b.value=[],It()},S=()=>{r("plan-mode-clicked")},I=()=>{h.value&&h.value.click()},m=async P=>{const x=P.target,B=x.files;if(!B||B.length===0)return;const J=Array.from(B);console.log("[FileUpload] Selected files for upload:",J.map(Z=>Z.name)),await q(J),x&&(x.value="")},q=async P=>{if(P.length!==0){R.value=!0;try{const x=new FormData;P.forEach(ee=>{x.append("files",ee)});let B="/api/file-upload/upload";M.value?(B=`/api/file-upload/upload/${M.value}`,console.log("[FileUpload] Using existing sessionPlanId for batch upload:",M.value)):console.log("[FileUpload] Creating new planId for file upload");const J=await fetch(B,{method:"POST",body:x});if(!J.ok)throw new Error(`Upload failed: ${J.statusText}`);const Z=await J.json();if(Z.uploadedFiles){!M.value&&Z.planId?(M.value=Z.planId,console.log("[FileUpload] Set sessionPlanId:",M.value)):M.value?console.log("[FileUpload] Using existing sessionPlanId:",M.value):console.warn("[FileUpload] No planId returned from upload");const ee=Z.uploadedFiles.map(me=>({name:me.originalName,size:me.size,type:me.extension,planId:Z.planId,relativePath:me.relativePath}));b.value=[...b.value,...ee],r("files-uploaded",ee),as(b.value),Z.planId&&(_f(Z.planId),console.log("[Input] Saved planId to global state:",Z.planId)),console.log("[Input] Updated global uploadedFiles state:",b.value),b.value.length>0&&(d.value=s("input.filesAttached",{count:b.value.length}))}console.log("Files uploaded successfully:",Z)}catch(x){console.error("File upload error:",x)}finally{R.value=!1}}},D=async P=>{try{console.log(" Removing file:",P.name,"from plan:",P.planId),P.planId&&(await kf.deleteFile(P.planId,P.name),console.log(" File deleted from server successfully")),b.value=b.value.filter(x=>x.name!==P.name),b.value.length===0?(d.value=u.value,console.log("[FileUpload]  Clearing sessionPlanId to force new plan for new files"),M.value=null,It()):(d.value=s("input.filesAttached",{count:b.value.length}),as(b.value)),console.log(" File removal completed, remaining files:",b.value.length)}catch(x){console.error(" Error removing file:",x),alert(s("input.fileDeleteError")||"Failed to delete file")}},W=P=>{if(P===0)return"0 Bytes";const x=1024,B=["Bytes","KB","MB","GB"],J=Math.floor(Math.log(P)/Math.log(x));return parseFloat((P/Math.pow(x,J)).toFixed(2))+" "+B[J]},C=()=>{g.value="",v(),r("clear")},U=(P,x)=>{x&&(d.value=P?x:s("input.waiting")),r("update-state",P,x)},z=P=>{g.value=P,v()},Q=()=>g.value.trim();return de(()=>a.initialValue,P=>{P&&P.trim()&&(g.value=P,v())},{immediate:!0}),e({clearInput:C,updateState:U,setInputValue:z,getQuery:Q,resetSession:_,focus:()=>{var P;return(P=i.value)==null?void 0:P.focus()}}),we(()=>{}),Te(()=>{}),(P,x)=>(p(),f("div",Tf,[t("div",Pf,[t("button",{class:"attach-btn",title:P.$t("input.attachFile"),onClick:I},[w(l(T),{icon:"carbon:attachment"})],8,Ef),t("input",{ref_key:"fileInputRef",ref:h,type:"file",multiple:"",style:{display:"none"},onChange:m,accept:".pdf,.txt,.md,.doc,.docx,.csv,.xlsx,.xls,.json,.xml,.html,.htm,.log,.java,.py,.js,.ts,.sql,.sh,.bat,.yaml,.yml,.properties,.conf,.ini"},null,544),se(t("textarea",{"onUpdate:modelValue":x[0]||(x[0]=B=>g.value=B),ref_key:"inputRef",ref:i,class:"chat-input",placeholder:d.value,disabled:y.value,onKeydown:$,onInput:v},null,40,Cf),[[re,g.value]]),t("button",{class:"plan-mode-btn",title:P.$t("input.planMode"),onClick:S},[w(l(T),{icon:"carbon:document"}),ne(" "+c(P.$t("input.planMode")),1)],8,If),t("button",{class:"send-button",disabled:!g.value.trim()||y.value,onClick:E,title:P.$t("input.send")},[w(l(T),{icon:"carbon:send-alt"}),ne(" "+c(P.$t("input.send")),1)],8,Rf)]),b.value.length>0?(p(),f("div",Af,[t("div",xf,[w(l(T),{icon:"carbon:document"}),t("span",null,c(l(s)("input.attachedFiles"))+" ("+c(b.value.length)+")",1)]),t("div",Df,[(p(!0),f(ae,null,ie(b.value,B=>(p(),f("div",{key:B.name,class:"file-item"},[w(l(T),{icon:"carbon:document",class:"file-icon"}),t("span",Mf,c(B.name),1),t("span",Ff,"("+c(W(B.size))+")",1),t("button",{onClick:J=>D(B),class:"remove-btn",title:l(s)("input.removeFile")},[w(l(T),{icon:"carbon:close"})],8,Uf)]))),128))])])):L("",!0),R.value?(p(),f("div",Nf,[w(l(T),{icon:"carbon:rotate--clockwise",class:"loading-icon"}),t("span",null,c(l(s)("input.uploading")),1)])):L("",!0)]))}}),Bf=he(Lf,[["__scopeId","data-v-e54e9908"]]);class He{static async getAllCronTasks(){try{const e=await fetch(this.BASE_URL);return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get cron tasks:",e),e}}static async getCronTaskById(e){try{const n=await fetch(`${this.BASE_URL}/${e}`);return await(await this.handleResponse(n)).json()}catch(n){throw console.error("Failed to get cron task by id:",n),n}}static async createCronTask(e){try{const n=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await(await this.handleResponse(n)).json()}catch(n){throw console.error("Failed to create cron task:",n),n}}static async updateCronTask(e,n){try{const s=await fetch(`${this.BASE_URL}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});return await(await this.handleResponse(s)).json()}catch(s){throw console.error("Failed to update cron task:",s),s}}static async updateTaskStatus(e,n){try{const s=await fetch(`${this.BASE_URL}/${e}/status?status=${n}`,{method:"PUT"});await this.handleResponse(s)}catch(s){throw console.error("Failed to update task status:",s),s}}static async deleteCronTask(e){try{const n=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE"});await this.handleResponse(n)}catch(n){throw console.error("Failed to delete cron task:",n),n}}static async handleResponse(e){if(!e.ok)try{const n=await e.json();throw new Error(n.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}}ge(He,"BASE_URL","/api/cron-tasks");const Ge={validateCronExpression(o){const e=o.trim().split(/\s+/);return e.length>=5&&e.length<=6},formatTime(o){return new Date(o).toLocaleString()},async saveTask(o){try{let e;return o.id?e=await He.updateCronTask(Number(o.id),o):e=await He.createCronTask(o),e}catch(e){throw console.error("Failed to save cron task:",e),e}},async deleteTask(o){try{await He.deleteCronTask(String(o))}catch(e){throw console.error("Failed to delete cron task:",e),e}},async toggleTaskStatus(o){if(!o.id)throw new Error("Task ID is required");const e=o.status===0?1:0;return await He.updateCronTask(Number(o.id),{...o,status:e})},prepareTaskExecution(o){return o.planTemplateId?{useTemplate:!0,planData:{title:o.cronName||"Scheduled Task Execution",planData:{id:o.planTemplateId,planTemplateId:o.planTemplateId,planId:o.planTemplateId},params:o.executionParams||void 0}}:{useTemplate:!1,taskContent:o.planDesc||o.cronName||""}}},Of={class:"modal-header"},qf={class:"header-actions"},jf={class:"status-switch"},Vf={class:"status-label"},Hf={class:"toggle-switch"},Gf=["checked"],Wf={class:"modal-content"},zf={class:"form-group"},Jf={class:"form-label"},Kf=["placeholder"],Xf={class:"form-group"},Yf={class:"form-label"},Qf=["placeholder"],Zf={class:"form-help"},ev={class:"form-group"},tv={class:"form-label"},sv=["placeholder"],nv={class:"form-group"},ov={class:"form-label"},av={class:"template-toggle"},lv={key:0,class:"template-selector"},rv={value:""},iv=["value"],cv={class:"form-help"},dv={key:0,class:"form-group"},uv={class:"time-info"},pv={class:"time-label"},hv={class:"time-value"},mv={key:1,class:"form-group"},fv={class:"time-info"},vv={class:"time-label"},gv={class:"time-value"},bv={class:"modal-footer"},yv=["disabled"],_v=pe({__name:"TaskDetailModal",props:{modelValue:{type:Boolean},task:{}},emits:["update:modelValue","save"],setup(o,{emit:e}){const n=o,s=e,a=F(!1),r=F([]),i=F({cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""}),h=async()=>{try{const _=await tt.getAllPlanTemplates();_&&_.templates&&(r.value=_.templates.map(y=>({id:y.id,name:y.title||"Unnamed Template"})))}catch(_){console.error("Failed to get template list:",_)}},g=_=>{_.key==="Escape"&&n.modelValue&&s("update:modelValue",!1)};we(()=>{h(),document.addEventListener("keydown",g)}),Te(()=>{document.removeEventListener("keydown",g)});const u=_=>{_.target===_.currentTarget&&s("update:modelValue",!1)},d=()=>{i.value.linkTemplate=!1,i.value.templateId="",i.value.planTemplateId=""},b=()=>i.value.cronName.trim()?i.value.cronTime.trim()?Ge.validateCronExpression(i.value.cronTime)?i.value.planDesc.trim()?i.value.linkTemplate&&!i.value.templateId?(alert("Please select a plan template"),!1):!0:(alert("Task description cannot be empty"),!1):(alert("Invalid Cron expression format, should be 5-6 parts separated by spaces"),!1):(alert("Cron expression cannot be empty"),!1):(alert("Task name cannot be empty"),!1),R=_=>Ge.formatTime(_),M=async()=>{var _;if(b()){a.value=!0;try{const y={...i.value,...((_=n.task)==null?void 0:_.id)!==void 0&&{id:n.task.id},cronName:i.value.cronName.trim(),cronTime:i.value.cronTime.trim(),planDesc:i.value.planDesc.trim(),status:i.value.status,planTemplateId:i.value.linkTemplate&&i.value.templateId||""};s("save",y)}finally{a.value=!1}}};return de(()=>n.task,_=>{if(_){const y=_.templateId||_.planTemplateId||"";i.value={cronName:_.cronName||"",cronTime:_.cronTime||"",planDesc:_.planDesc||"",status:_.status??1,linkTemplate:!!y,templateId:y,planTemplateId:y}}else i.value={cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""}},{immediate:!0}),de(()=>n.modelValue,_=>{_||(i.value={cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""})}),(_,y)=>(p(),le(Ze,{to:"body"},[w(qe,{name:"modal"},{default:Fe(()=>{var v,$,E;return[_.modelValue?(p(),f("div",{key:0,class:"modal-overlay",onClick:u},[t("div",{class:"modal-container",onClick:y[8]||(y[8]=fe(()=>{},["stop"]))},[t("div",Of,[t("h3",null,c(_.$t("cronTask.taskDetail")),1),t("div",qf,[t("div",jf,[t("span",Vf,c(_.$t("cronTask.taskStatus")),1),t("label",Hf,[t("input",{type:"checkbox",checked:i.value.status===0,onChange:y[0]||(y[0]=S=>i.value.status=i.value.status===0?1:0)},null,40,Gf),y[9]||(y[9]=t("span",{class:"toggle-slider"},null,-1))])]),t("button",{class:"close-btn",onClick:y[1]||(y[1]=S=>_.$emit("update:modelValue",!1))},[w(l(T),{icon:"carbon:close"})])])]),t("div",Wf,[t("form",{onSubmit:fe(M,["prevent"]),class:"task-form"},[t("div",zf,[t("label",Jf,c(_.$t("cronTask.taskName")),1),se(t("input",{"onUpdate:modelValue":y[2]||(y[2]=S=>i.value.cronName=S),type:"text",class:"form-input",placeholder:_.$t("cronTask.taskNamePlaceholder"),required:""},null,8,Kf),[[re,i.value.cronName]])]),t("div",Xf,[t("label",Yf,c(_.$t("cronTask.cronExpression")),1),se(t("input",{"onUpdate:modelValue":y[3]||(y[3]=S=>i.value.cronTime=S),type:"text",class:"form-input",placeholder:_.$t("cronTask.cronExpressionPlaceholder"),required:""},null,8,Qf),[[re,i.value.cronTime]]),t("div",Zf,c(_.$t("cronTask.cronExpressionHelp")),1)]),t("div",ev,[t("label",tv,c(_.$t("cronTask.taskDescription")),1),se(t("textarea",{"onUpdate:modelValue":y[4]||(y[4]=S=>i.value.planDesc=S),class:"form-textarea",placeholder:_.$t("cronTask.taskDescriptionPlaceholder"),rows:"4",required:""},null,8,sv),[[re,i.value.planDesc]])]),t("div",nv,[t("label",ov,c(_.$t("cronTask.planTemplate")),1),t("div",av,[t("button",{type:"button",class:oe(["template-btn",i.value.linkTemplate?"active":""]),onClick:y[5]||(y[5]=S=>i.value.linkTemplate=!0)},[w(l(T),{icon:"carbon:checkmark"}),ne(" "+c(_.$t("cronTask.linkTemplate")),1)],2),t("button",{type:"button",class:oe(["template-btn",i.value.linkTemplate?"":"active"]),onClick:d},[w(l(T),{icon:"carbon:close"}),ne(" "+c(_.$t("cronTask.noTemplate")),1)],2)]),i.value.linkTemplate?(p(),f("div",lv,[se(t("select",{"onUpdate:modelValue":y[6]||(y[6]=S=>i.value.templateId=S),class:"form-select"},[t("option",rv,c(_.$t("cronTask.selectTemplate")),1),(p(!0),f(ae,null,ie(r.value,S=>(p(),f("option",{key:S.id,value:S.id},c(S.name),9,iv))),128))],512),[[ot,i.value.templateId]]),t("div",cv,c(_.$t("cronTask.templateHelpText")),1)])):L("",!0)]),(v=_.task)!=null&&v.createTime?(p(),f("div",dv,[t("div",uv,[t("span",pv,c(_.$t("cronTask.createTime"))+":",1),t("span",hv,c(R(_.task.createTime)),1)])])):L("",!0),($=_.task)!=null&&$.updateTime?(p(),f("div",mv,[t("div",fv,[t("span",vv,c(_.$t("cronTask.updateTime"))+":",1),t("span",gv,c(R(_.task.updateTime)),1)])])):L("",!0)],32)]),t("div",bv,[t("button",{type:"button",class:"cancel-btn",onClick:y[7]||(y[7]=S=>_.$emit("update:modelValue",!1))},c(_.$t("common.cancel")),1),t("button",{type:"button",class:"save-btn",onClick:M,disabled:a.value},[a.value?(p(),le(l(T),{key:0,icon:"carbon:loading",class:"loading-icon"})):L("",!0),ne(" "+c((E=n.task)!=null&&E.id?_.$t("common.save"):_.$t("common.create")),1)],8,yv)])])])):L("",!0)]}),_:1})]))}}),$v=he(_v,[["__scopeId","data-v-45bbcf14"]]),wv={class:"modal-header"},Sv={class:"header-actions"},kv={class:"modal-content"},Tv={key:0,class:"loading-container"},Pv={key:1,class:"empty-container"},Ev={key:2,class:"task-list"},Cv=["onClick"],Iv={class:"task-main"},Rv={class:"task-info"},Av={class:"task-header"},xv={class:"task-name"},Dv={class:"task-description"},Mv={class:"task-time"},Fv=["onClick"],Uv=["onClick","disabled","title"],Nv=["onClick","title"],Lv={class:"dropdown-menu"},Bv=["onClick"],Ov=["onClick","disabled"],qv=["onClick","disabled"],jv={class:"confirm-header"},Vv={class:"confirm-content"},Hv={class:"confirm-actions"},Gv=["disabled"],Wv={class:"confirm-header"},zv={class:"confirm-content"},Jv={class:"create-options"},Kv={class:"option-content"},Xv={class:"option-title"},Yv={class:"option-desc"},Qv={class:"option-content"},Zv={class:"option-title"},eg={class:"option-desc"},tg={class:"confirm-actions"},sg=pe({__name:"CronTaskModal",props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue"],setup(o,{emit:e}){const n=cs(),s=ds(),a=us(),{t:r}=Pe(),i=o,h=e,g=F([]),u=F(!1),d=F(null),b=F(null),R=F(null),M=F(null),_=F(!1),y=F(null),v=F(!1),$=F(null),E=F(!1),S=G=>{G.target===G.currentTarget&&h("update:modelValue",!1)},I=async()=>{u.value=!0;try{g.value=await He.getAllCronTasks()}catch(G){console.error("Failed to load cron tasks:",G),a.error(`Failed to load tasks: ${G instanceof Error?G.message:String(G)}`)}finally{u.value=!1}},m=async G=>{d.value=G;try{const k=g.value.find(O=>O.id===G);if(!k){console.error("Task not found:",G);return}h("update:modelValue",!1);const j=Date.now().toString();await n.push({name:"direct",params:{id:j}}),await new Promise(O=>setTimeout(O,100));const N=Ge.prepareTaskExecution(k);N.useTemplate&&N.planData?s.emitPlanExecutionRequested(N.planData):N.taskContent&&s.setTask(N.taskContent)}catch(k){console.error("Failed to execute task:",k),a.error(`Execution failed: ${k instanceof Error?k.message:String(k)}`)}finally{d.value=null}},q=G=>{y.value={...G},_.value=!0,M.value=null},D=async G=>{try{await Ge.saveTask(G),await I(),_.value=!1,a.success("Task saved successfully")}catch(k){console.error("Failed to save task:",k),a.error(`Save failed: ${k instanceof Error?k.message:String(k)}`)}},W=G=>{$.value=G,v.value=!0},C=async()=>{var G;if((G=$.value)!=null&&G.id){b.value=$.value.id;try{await Ge.deleteTask($.value.id),await I(),v.value=!1,$.value=null,a.success("Task deleted successfully")}catch(k){console.error("Failed to delete task:",k),a.error(`Delete failed: ${k instanceof Error?k.message:String(k)}`)}finally{b.value=null}}},U=()=>{v.value=!1,$.value=null},z=G=>{M.value=M.value===G?null:G},Q=async G=>{if(G.id){R.value=G.id;try{await Ge.toggleTaskStatus(G),await I(),M.value=null,a.success(`Task ${G.status===0?"disabled":"enabled"} successfully`)}catch(k){console.error("Failed to toggle task status:",k),a.error(`Status toggle failed: ${k instanceof Error?k.message:String(k)}`)}finally{R.value=null}}},P=async G=>{try{await navigator.clipboard.writeText(G),a.success("Cron expression copied successfully")}catch(k){a.error(`Copy failed: ${k instanceof Error?k.message:String(k)}`)}},x=()=>{E.value=!0},B=()=>{E.value=!1;try{h("update:modelValue",!1);const G=r("cronTask.template");s.setTaskToInput(G);const k=Date.now().toString();n.push({name:"direct",params:{id:k}})}catch(G){console.error("Error in createWithJmanus:",G),a.error(`Creation failed: ${G instanceof Error?G.message:String(G)}`)}},J=()=>{E.value=!1,y.value={cronName:"",cronTime:"",planDesc:"",status:0,planTemplateId:""},_.value=!0},Z=()=>{E.value=!1},ee=G=>{const k=G.target;!k.closest(".action-dropdown")&&!k.closest(".dropdown-menu")&&(M.value=null)},me=G=>{G.key==="Escape"&&(v.value?U():E.value?Z():i.modelValue&&h("update:modelValue",!1))};return we(()=>{document.addEventListener("click",ee,!0),document.addEventListener("keydown",me)}),Te(()=>{document.removeEventListener("click",ee,!0),document.removeEventListener("keydown",me)}),de(()=>i.modelValue,G=>{G&&I()}),(G,k)=>(p(),f(ae,null,[(p(),le(Ze,{to:"body"},[w(qe,{name:"modal"},{default:Fe(()=>[o.modelValue?(p(),f("div",{key:0,class:"modal-overlay",onClick:S},[t("div",{class:"modal-container",onClick:k[3]||(k[3]=fe(()=>{},["stop"]))},[t("div",wv,[t("h3",null,c(G.$t("cronTask.title")),1),t("div",Sv,[t("button",{class:"add-task-btn",onClick:[x,k[0]||(k[0]=fe(()=>{},["stop"]))]},[w(l(T),{icon:"carbon:add"}),ne(" "+c(G.$t("cronTask.addTask")),1)]),t("button",{class:"close-btn",onClick:k[1]||(k[1]=j=>G.$emit("update:modelValue",!1))},[w(l(T),{icon:"carbon:close"})])])]),t("div",kv,[u.value?(p(),f("div",Tv,[w(l(T),{icon:"carbon:loading",class:"loading-icon"}),t("span",null,c(G.$t("common.loading")),1)])):g.value.length===0?(p(),f("div",Pv,[w(l(T),{icon:"carbon:time",class:"empty-icon"}),t("span",null,c(G.$t("cronTask.noTasks")),1)])):(p(),f("div",Ev,[(p(!0),f(ae,null,ie(g.value,j=>(p(),f("div",{key:j.id||"",class:"task-item",onClick:N=>q(j)},[t("div",Iv,[t("div",Rv,[t("div",Av,[t("div",xv,c(j.cronName),1),t("div",{class:oe(["task-status-badge",j.status===0?"active":"inactive"])},[w(l(T),{icon:j.status===0?"carbon:checkmark-filled":"carbon:pause-filled"},null,8,["icon"]),t("span",null,c(j.status===0?G.$t("cronTask.active"):G.$t("cronTask.inactive")),1)],2)]),t("div",Dv,c(j.planDesc),1),t("div",Mv,[w(l(T),{icon:"carbon:time"}),t("span",{class:"cron-readable",style:{cursor:"pointer"},onClick:fe(N=>P(j.cronTime),["stop"])},c(j.cronTime),9,Fv)])])]),t("div",{class:"task-actions",onClick:k[2]||(k[2]=fe(()=>{},["stop"]))},[t("button",{class:"action-btn execute-btn",onClick:N=>m(j.id),disabled:d.value===j.id,title:G.$t("cronTask.executeOnce")},[w(l(T),{icon:d.value===j.id?"carbon:loading":"carbon:play-filled"},null,8,["icon"]),ne(" "+c(G.$t("cronTask.executeOnce")),1)],8,Uv),t("div",{class:oe(["action-dropdown",{active:M.value===j.id}])},[t("button",{class:"action-btn dropdown-btn",onClick:N=>z(j.id),title:G.$t("cronTask.operations")},[w(l(T),{icon:"carbon:overflow-menu-horizontal"}),ne(" "+c(G.$t("cronTask.operations")),1)],8,Nv),se(t("div",Lv,[t("button",{class:"dropdown-item edit-btn",onClick:N=>q(j)},[w(l(T),{icon:"carbon:edit"}),ne(" "+c(G.$t("cronTask.edit")),1)],8,Bv),t("button",{class:"dropdown-item toggle-btn",onClick:N=>Q(j),disabled:R.value===j.id},[w(l(T),{icon:R.value===j.id?"carbon:loading":j.status===0?"carbon:pause-filled":"carbon:play-filled"},null,8,["icon"]),ne(" "+c(j.status===0?G.$t("cronTask.disable"):G.$t("cronTask.enable")),1)],8,Ov),t("button",{class:"dropdown-item delete-btn",onClick:N=>W(j),disabled:b.value===j.id},[w(l(T),{icon:b.value===j.id?"carbon:loading":"carbon:trash-can"},null,8,["icon"]),ne(" "+c(G.$t("cronTask.delete")),1)],8,qv)],512),[[ls,M.value===j.id]])],2)])],8,Cv))),128))]))])])])):L("",!0)]),_:1})])),w($v,{modelValue:_.value,"onUpdate:modelValue":k[4]||(k[4]=j=>_.value=j),task:y.value,onSave:D},null,8,["modelValue","task"]),(p(),le(Ze,{to:"body"},[w(qe,{name:"modal"},{default:Fe(()=>{var j,N,O,K;return[v.value?(p(),f("div",{key:0,class:"modal-overlay",onClick:U},[t("div",{class:"confirm-modal",onClick:k[5]||(k[5]=fe(()=>{},["stop"]))},[t("div",jv,[w(l(T),{icon:"carbon:warning",class:"warning-icon"}),t("h3",null,c(G.$t("cronTask.deleteConfirm")),1)]),t("div",Vv,[t("p",null,c(G.$t("cronTask.deleteConfirmMessage",{taskName:((j=$.value)==null?void 0:j.cronName)||((N=$.value)==null?void 0:N.planDesc)||""})),1)]),t("div",Hv,[t("button",{class:"confirm-btn cancel-btn",onClick:U},c(G.$t("common.cancel")),1),t("button",{class:"confirm-btn delete-btn",onClick:C,disabled:b.value===((O=$.value)==null?void 0:O.id)},[w(l(T),{icon:b.value===((K=$.value)==null?void 0:K.id)?"carbon:loading":"carbon:trash-can"},null,8,["icon"]),ne(" "+c(G.$t("cronTask.delete")),1)],8,Gv)])])])):L("",!0)]}),_:1})])),(p(),le(Ze,{to:"body"},[w(qe,{name:"modal"},{default:Fe(()=>[E.value?(p(),f("div",{key:0,class:"modal-overlay",onClick:Z},[t("div",{class:"confirm-modal create-options-modal",onClick:k[6]||(k[6]=fe(()=>{},["stop"]))},[t("div",Wv,[w(l(T),{icon:"carbon:time",class:"create-icon"}),t("h3",null,c(G.$t("cronTask.createTask")),1)]),t("div",zv,[t("p",null,c(G.$t("cronTask.selectCreateMethod")),1),t("div",Jv,[t("button",{class:"create-option-btn jmanus-btn",onClick:B},[w(l(T),{icon:"carbon:ai-status"}),t("div",Kv,[t("span",Xv,c(G.$t("cronTask.createWithJmanus")),1),t("span",Yv,c(G.$t("cronTask.createWithJmanusDesc")),1)])]),t("button",{class:"create-option-btn manual-btn",onClick:J},[w(l(T),{icon:"carbon:edit"}),t("div",Qv,[t("span",Zv,c(G.$t("cronTask.createManually")),1),t("span",eg,c(G.$t("cronTask.createManuallyDesc")),1)])])])]),t("div",tg,[t("button",{class:"confirm-btn cancel-btn",onClick:Z},c(G.$t("common.cancel")),1)])])])):L("",!0)]),_:1})]))],64))}}),ng=he(sg,[["__scopeId","data-v-a90a3961"]]),og={class:"direct-page"},ag={class:"direct-chat"},lg={class:"chat-header"},rg={class:"header-actions"},ig=["title"],cg=["title"],dg=["title"],ug=["title"],pg={class:"chat-content"},hg=["title"],mg={class:"message-content"},fg=pe({__name:"index",setup(o){const e=Hs(),n=cs(),s=ds(),{t:a}=Pe(),{message:r}=Ks(),i=F(""),h=F(""),g=F(),u=F(),d=F(),b=F(),R=F(!1),M=F(!1),_=F(null),y=F(!1),v=F(50),$=F(!1),E=F(0),S=F(0),I=ue(()=>{if(H.isCollapsed)return v.value;let N=26;b.value&&b.value.sidebarWidth!==void 0&&(N=b.value.sidebarWidth);const O=100-N;return Math.max(20,Math.min(O,v.value))});we(()=>{if(console.log("[Direct] onMounted called"),console.log("[Direct] taskStore.currentTask:",s.currentTask),console.log("[Direct] taskStore.hasUnprocessedTask():",s.hasUnprocessedTask()),De.setEventCallbacks({onPlanUpdate:O=>{console.log("[Direct] Plan update event received for rootPlanId:",O),C(O)&&(console.log("[Direct] Processing plan update for current rootPlanId:",O),u.value&&typeof u.value.handlePlanUpdate=="function"?(console.log("[Direct] Calling chatRef.handlePlanUpdate with rootPlanId:",O),u.value.handlePlanUpdate(O)):console.warn("[Direct] chatRef.handlePlanUpdate method not available"),g.value&&typeof g.value.updateDisplayedPlanProgress=="function"?(console.log("[Direct] Calling rightPanelRef.updateDisplayedPlanProgress with rootPlanId:",O),g.value.updateDisplayedPlanProgress(O)):console.warn("[Direct] rightPanelRef.updateDisplayedPlanProgress method not available"))},onPlanCompleted:O=>{if(console.log("[Direct] Plan completed event received for rootPlanId:",O),!!C(O)){if(console.log("[Direct] Processing plan completion for current rootPlanId:",O),u.value&&typeof u.value.handlePlanCompleted=="function"){const K=De.getCachedPlanRecord(O);K&&K.completed?K.summary&&K.summary.trim().length>0?(console.log("[Direct]  Plan details are valid and complete from polling cache, updating UI"),u.value.handlePlanCompleted(K)):(console.warn("[Direct]  Plan completed but summary is empty, still proceeding with available data"),u.value.handlePlanCompleted(K)):(console.warn("[Direct]  Plan details incomplete in cache, attempting API fallback"),St.getDetails(O).then(ce=>{console.log("[Direct]  Got fresh details from API:",ce),ce&&ce.completed?(console.log("[Direct] Fresh details from API are valid, updating UI"),De.setCachedPlanRecord(O,ce),u.value.handlePlanCompleted(ce)):(console.warn("[Direct]  API details also incomplete, using best available data"),u.value.handlePlanCompleted(K??{planId:O}))}).catch(ce=>{console.error("[Direct] API call failed (likely record deleted), using cached data:",ce),u.value.handlePlanCompleted(K??{planId:O})}))}else console.warn("[Direct] chatRef.handlePlanCompleted method not available");_.value=null,console.log("[Direct]  Cleared currentRootPlanId after plan completion"),d.value&&typeof d.value.resetSession=="function"&&(console.log("[Direct]  Calling inputRef.resetSession to clear sessionPlanId"),d.value.resetSession())}},onDialogRoundStart:O=>{console.log("[Direct] Dialog round start event received for rootPlanId:",O),_.value=O,console.log("[Direct] Set currentRootPlanId to:",O),u.value&&typeof u.value.handleDialogRoundStart=="function"?(console.log("[Direct] Calling chatRef.handleDialogRoundStart with planId:",O),u.value.handleDialogRoundStart(O)):console.warn("[Direct] chatRef.handleDialogRoundStart method not available")},onChatInputClear:()=>{console.log("[Direct] Chat input clear event received"),Q()},onChatInputUpdateState:O=>{if(console.log("[Direct] Chat input update state event received for rootPlanId:",O),!C(O,!0))return;const K=De.getCachedUIState(O);K&&x(K.enabled,K.placeholder)},onPlanError:O=>{u.value.handlePlanError(O)}}),console.log("[Direct] Event callbacks registered to planExecutionManager"),H.loadPlanTemplateList(),s.hasUnprocessedTask()&&s.currentTask){const O=s.currentTask.prompt;console.log("[Direct] Found unprocessed task from store:",O),s.markTaskAsProcessed(),ke(async()=>{try{console.log("[Direct] Calling handleChatSendMessage with taskContent:",O),await U({input:O})}catch(K){console.warn("[Direct] handleChatSendMessage failed, falling back to prompt:",K),i.value=O}})}else{const O=s.getAndClearTaskToInput();O?(h.value=O,console.log("[Direct] Setting inputOnlyContent for input only:",h.value)):(i.value=e.query.prompt||"",console.log("[Direct] Received task from URL:",i.value),console.log("[Direct] No unprocessed task in store"))}const N=localStorage.getItem("directPanelWidth");N&&(v.value=parseFloat(N)),console.log("[Direct] Final prompt value:",i.value),h.value&&ke(()=>{d.value&&typeof d.value.setInputValue=="function"&&(d.value.setInputValue(h.value),console.log("[Direct] Set input value:",h.value),h.value="")}),window.addEventListener("plan-execution-requested",O=>{console.log("[DirectView] Received plan-execution-requested event:",O.detail),G(O.detail)})}),de(()=>s.currentTask,N=>{if(console.log("[Direct] Watch taskStore.currentTask triggered, newTask:",N),N&&!N.processed){const O=N.prompt;s.markTaskAsProcessed(),console.log("[Direct] Received new task from store:",O),ke(async()=>{try{console.log("[Direct] Directly executing new task via handleChatSendMessage:",O),await U({input:O})}catch(K){console.warn("[Direct] handleChatSendMessage failed for new task:",K)}})}else console.log("[Direct] Task is null or already processed, ignoring")},{immediate:!1}),de(()=>i.value,(N,O)=>{console.log("[Direct] prompt value changed from:",O,"to:",N)},{immediate:!1}),de(()=>s.taskToInput,N=>{console.log("[Direct] Watch taskStore.taskToInput triggered, newTaskToInput:",N),N!=null&&N.trim()&&(console.log("[Direct] Setting input value from taskToInput:",N),ke(()=>{d.value&&typeof d.value.setInputValue=="function"&&(d.value.setInputValue(N.trim()),console.log("[Direct] Input value set from taskToInput watch:",N.trim()),s.getAndClearTaskToInput())}))},{immediate:!1}),Te(()=>{console.log("[Direct] onUnmounted called, cleaning up resources"),_.value=null,De.cleanup(),document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",D),window.removeEventListener("plan-execution-requested",N=>{G(N.detail)})});const m=N=>{$.value=!0,E.value=N.clientX,S.value=v.value,document.addEventListener("mousemove",q),document.addEventListener("mouseup",D),document.body.style.cursor="col-resize",document.body.style.userSelect="none",N.preventDefault()},q=N=>{if(!$.value)return;const O=window.innerWidth,ce=(N.clientX-E.value)/O*100;let V=S.value+ce;V=Math.max(20,Math.min(80,V)),v.value=V},D=()=>{$.value=!1,document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",D),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("directPanelWidth",v.value.toString())},W=()=>{v.value=50,localStorage.setItem("directPanelWidth","50")},C=(N,O=!1)=>!_.value||N===_.value||O&&(N==="ui-state"||N==="error")?!0:(console.log("[Direct] Ignoring event for non-current rootPlanId:",N,"current:",_.value),!1),U=async N=>{var K,ce,V,Y,X,ye,xe,Xe,Ye;let O=null;try{console.log("[DirectView] Processing send-message event:",N);const Re=(K=u.value)==null?void 0:K.addMessage("user",N.input);N.attachments&&Re&&((ce=u.value)==null||ce.updateMessage(Re.id,{attachments:N.attachments})),O=(V=u.value)==null?void 0:V.addMessage("assistant","",{thinking:a("chat.thinkingProcessing")}),O&&((Y=u.value)==null||Y.startStreaming(O.id));const{DirectApiService:rt}=await Gs(async()=>{const{DirectApiService:it}=await Promise.resolve().then(()=>uf);return{DirectApiService:it}},void 0);console.log("[DirectView] Calling DirectApiService.sendMessageWithDefaultPlan");const Ee=await rt.sendMessageWithDefaultPlan(N);console.log("[DirectView] API response received:",Ee),Ee.planId&&O?((X=u.value)==null||X.updateMessage(O.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:Ee.planId,rootPlanId:Ee.planId,status:"running"}}),_.value=Ee.planId,console.log("[DirectView] Set currentRootPlanId to:",Ee.planId),De.handlePlanExecutionRequested(Ee.planId,N.input),console.log("[DirectView] Started polling for plan execution updates")):O&&((ye=u.value)==null||ye.updateMessage(O.id,{content:Ee.message||Ee.result||"No response received from backend"}),(xe=u.value)==null||xe.stopStreaming(O.id))}catch(Re){console.error("[DirectView] Send message failed:",Re),(Xe=u.value)==null||Xe.addMessage("assistant",`Error: ${(Re==null?void 0:Re.message)||"Failed to send message"}`),O&&((Ye=u.value)==null||Ye.stopStreaming(O.id))}},z=async N=>{console.log("[DirectView] Send message from input:",JSON.stringify(N)),await U(N)},Q=()=>{console.log("[DirectView] Input cleared"),d.value&&typeof d.value.clear=="function"&&d.value.clear()},P=()=>{console.log("[DirectView] Input focused")},x=(N,O)=>{console.log("[DirectView] Input state updated:",N,O),M.value=!N},B=N=>{console.log("[DirectView] Step selected:",N),g.value&&typeof g.value.handleStepSelected=="function"?(console.log("[DirectView] Forwarding step selection to right panel:",N),g.value.handleStepSelected(N)):console.warn("[DirectView] rightPanelRef.handleStepSelected method not available")},J=(N,O,K,ce)=>{console.log("[DirectView] Sub plan step selected:",{parentPlanId:N,subPlanId:O,stepIndex:K,subStepIndex:ce}),g.value&&typeof g.value.handleSubPlanStepSelected=="function"?(console.log("[DirectView] Forwarding sub plan step selection to right panel:",{parentPlanId:N,subPlanId:O,stepIndex:K,subStepIndex:ce}),g.value.handleSubPlanStepSelected(N,O,K,ce)):console.warn("[DirectView] rightPanelRef.handleSubPlanStepSelected method not available")},Z=()=>{console.log("[DirectView] Plan mode button clicked"),H.toggleSidebar(),console.log("[DirectView] Sidebar toggled, isCollapsed:",H.isCollapsed)},ee=()=>{n.push("/home")},me=()=>{n.push("/configs")},G=async N=>{var ce,V,Y,X,ye,xe,Xe,Ye,Re,rt,Ee,it;if(console.log("[DirectView] Plan execution requested:",N),R.value){console.log("[DirectView] Plan execution already in progress, ignoring request");return}R.value=!0;let O=!1,K=null;try{console.log("[DirectView] Adding messages for plan execution:",N.title),(ce=u.value)==null||ce.addMessage("user",N.title),O=!0,K=(V=u.value)==null?void 0:V.addMessage("assistant","",{thinking:a("chat.planningExecution")}),K&&((Y=u.value)==null||Y.startStreaming(K.id),console.log("[DirectView] Added assistant message for plan execution:",K.id))}catch(Se){console.warn("[DirectView] Failed to add messages:",Se)}try{const Se=((X=N.planData)==null?void 0:X.planTemplateId)||((ye=N.planData)==null?void 0:ye.id)||((xe=N.planData)==null?void 0:xe.planId);if(!Se)throw new Error(a("direct.planTemplateIdNotFound"));console.log("[Direct] Executing plan with templateId:",Se,"params:",N.params),console.log("[Direct] About to call PlanActApiService.executePlan");const Ne=yf()?bf():void 0;console.log("[Direct] Executing with uploaded files:",(Ne==null?void 0:Ne.length)??0),console.log("[Direct] Executing with replacement params:",N.replacementParams);const Tt=wf()?$f():void 0;console.log("[Direct] Executing with uploaded files planId:",Tt);let Ce;if((Xe=N.params)!=null&&Xe.trim()?(console.log("[Direct] Calling executePlan with rawParam:",N.params.trim()),Ce=await tt.executePlan(Se,N.params.trim(),Ne,N.replacementParams,Tt)):(console.log("[Direct] Calling executePlan without rawParam"),Ce=await tt.executePlan(Se,void 0,Ne,N.replacementParams,Tt)),console.log("[Direct] Plan execution API response:",Ce),Ce.planId&&K)console.log("[Direct] Got planId from response:",Ce.planId,"starting plan execution"),(Ye=u.value)==null||Ye.updateMessage(K.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:Ce.planId,rootPlanId:Ce.planId,status:"running"}}),_.value=Ce.planId,console.log("[Direct] Set currentRootPlanId to:",Ce.planId),console.log("[Direct] Delegating plan execution to planExecutionManager"),De.handlePlanExecutionRequested(Ce.planId,N.title);else throw console.error("[Direct] No planId in response:",Ce),new Error(a("direct.executionFailedNoPlanId"))}catch(Se){console.error("[Direct] Plan execution failed:",Se),console.error("[Direct] Error details:",{message:Se.message,stack:Se.stack}),_.value=null;try{console.log("[Direct] Adding error messages to chat"),O||(Re=u.value)==null||Re.addMessage("user",N.title),K?((rt=u.value)==null||rt.updateMessage(K.id,{content:`${a("direct.executionFailed")}: ${Se.message||a("common.unknownError")}`,thinking:void 0}),(Ee=u.value)==null||Ee.stopStreaming(K.id)):(it=u.value)==null||it.addMessage("assistant",`${a("direct.executionFailed")}: ${Se.message||a("common.unknownError")}`)}catch(Ne){console.error("[Direct] Failed to add error messages:",Ne),alert(`${a("direct.executionFailed")}: ${Se.message||a("common.unknownError")}`)}}finally{console.log("[Direct] Plan execution finished, resetting isExecutingPlan flag"),R.value=!1}},k=()=>{u.value.showMemory()},j=()=>{Ue.clearMemoryId(),u.value.newChat()};return(N,O)=>(p(),f("div",og,[t("div",ag,[w(fc,{ref_key:"sidebarRef",ref:b,onPlanExecutionRequested:G},null,512),t("div",{class:"left-panel",style:We({width:I.value+"%"})},[t("div",lg,[t("button",{class:"back-button",onClick:ee},[w(l(T),{icon:"carbon:arrow-left"})]),t("h2",null,c(N.$t("conversation")),1),t("div",rg,[w(Xs),t("button",{class:"config-button",onClick:j,title:N.$t("memory.newChat")},[w(l(T),{icon:"carbon:add",width:"20"})],8,ig),t("button",{class:"config-button",onClick:me,title:N.$t("direct.configuration")},[w(l(T),{icon:"carbon:settings-adjust",width:"20"})],8,cg),t("button",{class:"cron-task-btn",onClick:O[0]||(O[0]=K=>y.value=!0),title:N.$t("cronTask.title")},[w(l(T),{icon:"carbon:alarm",width:"20"})],8,dg),t("button",{class:"cron-task-btn",onClick:O[1]||(O[1]=K=>l(Ue).toggleSidebar()),title:N.$t("memory.selectMemory")},[w(l(T),{icon:"carbon:calendar",width:"20"})],8,ug)])]),t("div",pg,[w(gf,{ref_key:"chatRef",ref:u,mode:"direct","initial-prompt":i.value||"",onStepSelected:B,onSubPlanStepSelected:J},null,8,["initial-prompt"])]),(p(),le(Bf,{key:N.$i18n.locale,ref_key:"inputRef",ref:d,disabled:M.value,placeholder:M.value?l(a)("input.waiting"):l(a)("input.placeholder"),"initial-value":i.value,onSend:z,onClear:Q,onFocus:P,onUpdateState:x,onPlanModeClicked:Z},null,8,["disabled","placeholder","initial-value"]))],4),t("div",{class:"panel-resizer",onMousedown:m,onDblclick:W,title:N.$t("direct.panelResizeHint")},O[3]||(O[3]=[t("div",{class:"resizer-line"},null,-1)]),40,hg),w(mp,{ref_key:"rightPanelRef",ref:g,style:We({width:100-v.value+"%"}),"current-root-plan-id":_.value},null,8,["style","current-root-plan-id"])]),w(ng,{modelValue:y.value,"onUpdate:modelValue":O[2]||(O[2]=K=>y.value=K)},null,8,["modelValue"]),w(dd,{onMemorySelected:k}),l(r).show?(p(),f("div",{key:0,class:oe(["message-toast",l(r).type])},[t("div",mg,[t("span",null,c(l(r).text),1)])],2)):L("",!0)]))}}),qg=he(fg,[["__scopeId","data-v-10620159"]]);export{qg as default};
