{"version":3,"file":"coordinator-tool-api-service-BF7g82Kd.js","sources":["../../src/api/coordinator-tool-api-service.ts"],"sourcesContent":["/*\n * Copyright 2025 the original author or authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport interface CoordinatorToolVO {\n  id?: number\n  toolName: string\n  toolDescription: string\n  planTemplateId: string\n  httpEndpoint?: string | undefined\n  mcpEndpoint?: string | undefined\n  inputSchema: string\n  serviceGroup?: string\n  enableInternalToolcall?: boolean\n  enableHttpService?: boolean\n  enableMcpService?: boolean\n  createTime?: string\n  updateTime?: string\n}\n\nexport interface CoordinatorToolConfig {\n  enabled: boolean\n  success: boolean\n  message?: string\n}\n\nexport class CoordinatorToolApiService {\n  private static readonly BASE_URL = '/api/coordinator-tools'\n\n  /**\n   * Get all coordinator tools\n   * @returns List of all coordinator tools\n   */\n  public static async getAllCoordinatorTools(): Promise<CoordinatorToolVO[]> {\n    try {\n      const response = await fetch(`${this.BASE_URL}`, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      })\n\n      if (!response.ok) {\n        throw new Error(`Failed to get coordinator tools: ${response.status}`)\n      }\n\n      const result = await response.json()\n      return result || []\n    } catch (error: any) {\n      console.error('Failed to get coordinator tools:', error)\n      throw new Error('Failed to get coordinator tools: ' + error.message)\n    }\n  }\n\n  /**\n   * Get CoordinatorTool configuration information\n   */\n  public static async getCoordinatorToolConfig(): Promise<CoordinatorToolConfig> {\n    try {\n      const response = await fetch(`${this.BASE_URL}/config`, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      })\n\n      if (!response.ok) {\n        throw new Error(`Failed to get coordinator tool config: ${response.status}`)\n      }\n\n      return await response.json()\n    } catch (error: any) {\n      console.error('Failed to get CoordinatorTool configuration:', error)\n      // Return default configuration\n      return {\n        enabled: true,\n        success: false,\n        message: error.message,\n      }\n    }\n  }\n\n  /**\n   * Get all endpoint list\n   */\n  public static async getAllEndpoints(): Promise<string[]> {\n    try {\n      const response = await fetch(`${this.BASE_URL}/endpoints`, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      })\n\n      if (!response.ok) {\n        throw new Error(`Failed to get endpoints: ${response.status}`)\n      }\n\n      return await response.json()\n    } catch (error: any) {\n      console.error('Failed to get endpoints:', error)\n      throw new Error('Failed to get endpoints: ' + error.message)\n    }\n  }\n\n  /**\n   * Get coordinator tool by plan template ID\n   * @param planTemplateId Plan template ID\n   * @returns Coordinator tool if exists, null if not found\n   */\n  public static async getCoordinatorToolByTemplate(\n    planTemplateId: string\n  ): Promise<CoordinatorToolVO | null> {\n    console.log(\n      '[CoordinatorToolApiService] Getting coordinator tool, planTemplateId:',\n      planTemplateId\n    )\n    console.log(\n      '[CoordinatorToolApiService] Request URL:',\n      `${this.BASE_URL}/by-template/${planTemplateId}`\n    )\n\n    try {\n      const response = await fetch(`${this.BASE_URL}/by-template/${planTemplateId}`, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      })\n\n      console.log('[CoordinatorToolApiService] Response status:', response.status)\n\n      if (!response.ok) {\n        const errorText = await response.text()\n        console.error('[CoordinatorToolApiService] Response error content:', errorText)\n        throw new Error(`Failed to get coordinator tool: ${response.status} - ${errorText}`)\n      }\n\n      // Get response text first to check if empty\n      const text = await response.text()\n\n      // If response body is empty, treat as not found\n      if (!text || text.trim() === '') {\n        console.log(\n          '[CoordinatorToolApiService] Tool not found for planTemplateId (empty response):',\n          planTemplateId\n        )\n        return null\n      }\n\n      // Parse JSON response\n      let result: CoordinatorToolVO | null\n      try {\n        result = JSON.parse(text)\n      } catch (parseError) {\n        console.error('[CoordinatorToolApiService] Failed to parse JSON response:', parseError)\n        return null\n      }\n\n      // If result is null or empty object, treat as not found\n      if (result === null || (typeof result === 'object' && Object.keys(result).length === 0)) {\n        console.log(\n          '[CoordinatorToolApiService] Tool not found for planTemplateId:',\n          planTemplateId\n        )\n        return null\n      }\n\n      console.log('[CoordinatorToolApiService] Successfully got coordinator tool:', result)\n      return result\n    } catch (error: any) {\n      console.error('[CoordinatorToolApiService] Failed to get coordinator tool:', error)\n      throw new Error('Failed to get coordinator tool: ' + error.message)\n    }\n  }\n\n  /**\n   * Create a default coordinator tool VO for a plan template\n   * This creates a VO object but does not save it to the database\n   * @param planTemplateId Plan template ID\n   * @param planTitle Optional plan template title\n   * @param planDescription Optional plan template description\n   * @returns Default coordinator tool VO\n   */\n  public static createDefaultCoordinatorTool(\n    planTemplateId: string,\n    planTitle?: string,\n    planDescription?: string\n  ): CoordinatorToolVO {\n    return {\n      toolName: planTitle ? `tool_${planTitle}` : '',\n      toolDescription: planDescription ?? '',\n      planTemplateId: planTemplateId,\n      inputSchema: '[]',\n      serviceGroup: '',\n      enableInternalToolcall: false,\n      enableHttpService: false,\n      enableMcpService: false,\n    }\n  }\n\n  /**\n   * Create coordinator tool\n   */\n  public static async createCoordinatorTool(tool: CoordinatorToolVO): Promise<CoordinatorToolVO> {\n    console.log('[CoordinatorToolApiService] Starting to create coordinator tool')\n    console.log('[CoordinatorToolApiService] Original data:', JSON.stringify(tool, null, 2))\n    console.log('[CoordinatorToolApiService] Request URL:', `${this.BASE_URL}`)\n\n    // Only send necessary fields, excluding createTime and updateTime\n    const requestData = {\n      id: tool.id,\n      toolName: tool.toolName,\n      toolDescription: tool.toolDescription,\n      inputSchema: tool.inputSchema,\n      planTemplateId: tool.planTemplateId,\n      httpEndpoint: tool.httpEndpoint,\n      mcpEndpoint: tool.mcpEndpoint,\n      serviceGroup: tool.serviceGroup,\n      enableInternalToolcall: tool.enableInternalToolcall,\n      enableHttpService: tool.enableHttpService,\n      enableMcpService: tool.enableMcpService,\n    }\n\n    console.log(\n      '[CoordinatorToolApiService] Cleaned sending data:',\n      JSON.stringify(requestData, null, 2)\n    )\n\n    try {\n      const response = await fetch(`${this.BASE_URL}`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(requestData),\n      })\n\n      console.log('[CoordinatorToolApiService] Response status:', response.status)\n      console.log('[CoordinatorToolApiService] Response status text:', response.statusText)\n\n      if (!response.ok) {\n        let errorMessage = 'Unknown error'\n        try {\n          const errorData = await response.json()\n          errorMessage = errorData.message || errorData.error || errorMessage\n        } catch {\n          // If JSON parsing fails, try to get text\n          const errorText = await response.text()\n          errorMessage = errorText || errorMessage\n        }\n        console.error('[CoordinatorToolApiService] Response error content:', errorMessage)\n        throw new Error(`Failed to create coordinator tool: ${response.status} - ${errorMessage}`)\n      }\n\n      const result = await response.json()\n      console.log('[CoordinatorToolApiService] Created successfully, result:', result)\n      return result\n    } catch (error: any) {\n      console.error('[CoordinatorToolApiService] Failed to create coordinator tool:', error)\n      throw new Error('Failed to create coordinator tool: ' + error.message)\n    }\n  }\n\n  /**\n   * Update coordinator tool\n   */\n  public static async updateCoordinatorTool(\n    id: number,\n    tool: CoordinatorToolVO\n  ): Promise<CoordinatorToolVO> {\n    console.log('[CoordinatorToolApiService] Starting to update coordinator tool, ID:', id)\n    console.log('[CoordinatorToolApiService] Sending data:', tool)\n    console.log('[CoordinatorToolApiService] Request URL:', `${this.BASE_URL}/${id}`)\n\n    // Only send necessary fields, excluding createTime and updateTime\n    const requestData = {\n      id: tool.id,\n      toolName: tool.toolName,\n      toolDescription: tool.toolDescription,\n      inputSchema: tool.inputSchema,\n      planTemplateId: tool.planTemplateId,\n      httpEndpoint: tool.httpEndpoint,\n      mcpEndpoint: tool.mcpEndpoint,\n      serviceGroup: tool.serviceGroup,\n      enableInternalToolcall: tool.enableInternalToolcall,\n      enableHttpService: tool.enableHttpService,\n      enableMcpService: tool.enableMcpService,\n    }\n\n    console.log('[CoordinatorToolApiService] Cleaned sending data:', requestData)\n\n    try {\n      const response = await fetch(`${this.BASE_URL}/${id}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(requestData),\n      })\n\n      console.log('[CoordinatorToolApiService] Response status:', response.status)\n      console.log('[CoordinatorToolApiService] Response status text:', response.statusText)\n\n      if (!response.ok) {\n        let errorMessage = 'Unknown error'\n        try {\n          const errorData = await response.json()\n          errorMessage = errorData.message || errorData.error || errorMessage\n        } catch {\n          // If JSON parsing fails, try to get text\n          const errorText = await response.text()\n          errorMessage = errorText || errorMessage\n        }\n        console.error('[CoordinatorToolApiService] Response error content:', errorMessage)\n        throw new Error(`Failed to update coordinator tool: ${response.status} - ${errorMessage}`)\n      }\n\n      const result = await response.json()\n      console.log('[CoordinatorToolApiService] Updated successfully, result:', result)\n      return result\n    } catch (error: any) {\n      console.error('[CoordinatorToolApiService] Failed to update coordinator tool:', error)\n      throw new Error('Failed to update coordinator tool: ' + error.message)\n    }\n  }\n\n  /**\n   * Delete coordinator tool\n   */\n  public static async deleteCoordinatorTool(\n    id: number\n  ): Promise<{ success: boolean; message: string }> {\n    console.log('[CoordinatorToolApiService] Starting to delete coordinator tool, ID:', id)\n    console.log('[CoordinatorToolApiService] Request URL:', `${this.BASE_URL}/${id}`)\n\n    try {\n      const response = await fetch(`${this.BASE_URL}/${id}`, {\n        method: 'DELETE',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      })\n\n      console.log('[CoordinatorToolApiService] Response status:', response.status)\n      console.log('[CoordinatorToolApiService] Response status text:', response.statusText)\n\n      if (!response.ok) {\n        const errorText = await response.text()\n        console.error('[CoordinatorToolApiService] Response error content:', errorText)\n        throw new Error(`Failed to delete coordinator tool: ${response.status} - ${errorText}`)\n      }\n\n      const result = await response.json()\n      console.log('[CoordinatorToolApiService] Deleted successfully, result:', result)\n      return result\n    } catch (error: any) {\n      console.error('[CoordinatorToolApiService] Failed to delete coordinator tool:', error)\n      throw new Error('Failed to delete coordinator tool: ' + error.message)\n    }\n  }\n}\n"],"names":["CoordinatorToolApiService","response","error","planTemplateId","errorText","text","result","parseError","planTitle","planDescription","tool","requestData","errorMessage","errorData","id","__publicField"],"mappings":"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"}