const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/sidebar-BUbOWah5.js","assets/index-BEAxfoTO.js","assets/index-DN-vOy2S.css","assets/llm-check-S84pbv31.js"])))=>i.map(i=>d[i]);
var Ns=Object.defineProperty;var Us=(n,e,o)=>e in n?Ns(n,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[e]=o;var Re=(n,e,o)=>Us(n,typeof e!="symbol"?e+"":e,o);import{c as fe,d as we,a as g,b as p,e as s,f as V,t as i,F as ie,q as he,g as E,i as r,u as Ue,n as le,h as re,z as We,j as Se,l as me,B as ss,C as nt,r as D,o as De,D as pe,E as Ne,w as de,m as _e,G as mt,H as Et,v as Os,I as os,J as tt,A as Ae,T as Nt,p as Ke,K as Ls,M as Bs,N as qs,O as et,_ as ns,P as Vs,y as js}from"./index-BEAxfoTO.js";import{D as Gs,u as st,P as ut,T as zs,s as q}from"./sidebar-BUbOWah5.js";import{I as T,_ as $e}from"./_plugin-vue_export-helper-hAYVmE1b.js";import{CoordinatorToolApiService as Oe}from"./coordinator-tool-api-service-BF7g82Kd.js";import{L as Js}from"./LanguageSwitcher-CPIVRd3X.js";import{M as as,u as ls,a as Hs}from"./useMessage-OrlQEyP8.js";import"./llm-check-S84pbv31.js";class ft{static async getDetails(e){try{const o=await fetch(`${this.BASE_URL}/details/${e}`);if(o.status===404)return null;if(!o.ok){const l=await o.text();throw new Error(`Failed to get detailed information: ${o.status} - ${l}`)}const t=await o.text(),a=JSON.parse(t);return a&&typeof a=="object"&&!a.currentPlanId&&(a.currentPlanId=e),a}catch(o){return console.error("[CommonApiService] Failed to get plan details:",o),null}}static async submitFormInput(e,o){const t=await fetch(`${this.BASE_URL}/submit-input/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!t.ok){let l;try{l=await t.json()}catch{l={message:`Failed to submit form input: ${t.status}`}}throw new Error(l.message||`Failed to submit form input: ${t.status}`)}const a=t.headers.get("content-type");return a&&a.indexOf("application/json")!==-1?await t.json():{success:!0}}static async getAllPrompts(){try{const e=await fetch(this.BASE_URL);return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get Prompt list:",e),e}}static async handleResponse(e){if(!e.ok)try{const o=await e.json();throw new Error(o.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}}Re(ft,"BASE_URL","/api/executor");function Ut(){return{formatResponseText:h=>h?h.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\n/g,"<br>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>"):"",formatTimestamp:h=>{const m=new Date().getTime()-h.getTime();return m<6e4?"Just now":m<36e5?`${Math.floor(m/6e4)} minutes ago`:m<864e5?`${Math.floor(m/36e5)} hours ago`:h.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},getMessageClasses:h=>fe(()=>({user:h.type==="user",assistant:h.type==="assistant",streaming:h.isStreaming,"has-error":!!h.error,"has-thinking":!!h.thinking,"has-execution":!!h.planExecution})),formatFileSize:h=>{if(h===0)return"0 B";const c=1024,m=["B","KB","MB","GB"],S=Math.floor(Math.log(h)/Math.log(c));return parseFloat((h/Math.pow(c,S)).toFixed(2))+" "+m[S]},truncateText:(h,c=100)=>!h||h.length<=c?h:h.substring(0,c)+"...",stripHtml:h=>h.replace(/<[^>]*>/g,""),hasDisplayableContent:h=>!!(h.content||(h.thinking??!1)||(h.planExecution??!1)||h.error),getMessageStatus:h=>h.error?"Send failed":h.isStreaming?"Typing...":h.type==="assistant"&&!h.content&&!h.thinking?"Waiting for response":""}}const Ws=["data-message-id"],Ks={class:"user-content"},Xs={class:"message-text"},Qs={key:0,class:"attachments"},Ys={class:"attachment-name"},Zs={class:"attachment-size"},eo={class:"message-timestamp"},to={key:0,class:"message-status error"},so={class:"status-text"},oo=we({__name:"UserMessage",props:{message:{}},setup(n){const{formatTimestamp:e,formatFileSize:o}=Ut();return(t,a)=>{var l;return p(),g("div",{class:"user-message","data-message-id":t.message.id},[s("div",Ks,[s("div",Xs,i(t.message.content),1),(l=t.message.attachments)!=null&&l.length?(p(),g("div",Qs,[(p(!0),g(ie,null,he(t.message.attachments,(d,u)=>(p(),g("div",{key:u,class:"attachment-item"},[E(r(T),{icon:"carbon:document",class:"attachment-icon"}),s("span",Ys,i(d.name),1),s("span",Zs,i(r(o)(d.size)),1)]))),128))])):V("",!0),s("div",eo,i(r(e)(t.message.timestamp)),1)]),t.message.error?(p(),g("div",to,[E(r(T),{icon:"carbon:warning",class:"status-icon"}),s("span",so,i(t.message.error),1)])):V("",!0)],8,Ws)}}}),no=$e(oo,[["__scopeId","data-v-94372507"]]),ao={class:"sub-plan-info"},lo={class:"sub-plan-details"},ro={class:"sub-plan-title"},io={key:0,class:"nesting-level"},co={class:"sub-plan-id"},uo={class:"sub-plan-meta"},po={key:0,class:"trigger-tool"},ho={class:"trigger-text"},mo={key:0,class:"sub-plan-progress"},fo={class:"progress-info"},go={class:"progress-text"},vo={class:"progress-bar"},bo={key:1,class:"sub-plan-agents-steps"},yo={class:"agents-steps-header"},_o={class:"agents-label"},So={class:"agents-steps-list"},wo=["onClick"],$o={class:"agent-step-header"},Po={class:"agent-name"},ko={class:"sub-agent-execution-info"},Co={key:0,class:"agent-result"},Eo={class:"result-header"},To={class:"result-label"},Io={class:"result-content"},Ro={key:1,class:"agent-error"},Ao={class:"error-header"},xo={class:"error-label"},Mo={class:"error-content"},Fo={key:2,class:"think-act-preview"},Do={class:"think-act-header"},No={class:"think-act-label"},Uo={class:"think-act-steps-preview"},Oo=["onClick"],Lo={class:"step-number"},Bo={class:"step-description"},qo={key:0,class:"more-steps"},Vo={class:"more-steps-text"},jo={key:3,class:"nested-sub-plans"},Go={class:"nested-sub-plans-header"},zo={class:"nested-label"},Jo={class:"nested-sub-plans-list"},Ho={key:4,class:"direct-sub-plans"},Wo={class:"direct-sub-plans-header"},Ko={class:"direct-label"},Xo={class:"direct-sub-plans-list"},Qo=we({__name:"RecursiveSubPlan",props:{subPlan:{},subPlanIndex:{},nestingLevel:{default:0},maxNestingDepth:{default:3},maxVisibleSteps:{default:2}},emits:["sub-plan-selected","step-selected"],setup(n,{emit:e}){const o=n,t=e,{t:a}=Ue(),l=()=>`nesting-level-${o.nestingLevel}`,d=()=>{var N,z;return o.subPlan.completed?"completed":((N=o.subPlan.agentExecutionSequence)==null?void 0:N.some(k=>k.status==="RUNNING"))?"running":((z=o.subPlan.agentExecutionSequence)==null?void 0:z.some(k=>k.status==="FINISHED"))?"in-progress":"pending"},u=()=>{switch(d()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},h=()=>{switch(d()){case"completed":return"carbon:checkmark";case"running":return"carbon:play";case"in-progress":return"carbon:in-progress";case"pending":default:return"carbon:dot-mark"}},c=()=>{var P;if(!((P=o.subPlan.agentExecutionSequence)!=null&&P.length))return 0;if(o.subPlan.completed)return 100;const f=m();return Math.min(100,f/o.subPlan.agentExecutionSequence.length*100)},m=()=>{var f;return(f=o.subPlan.agentExecutionSequence)!=null&&f.length?o.subPlan.agentExecutionSequence.filter(P=>P.status==="FINISHED").length:0},S=f=>{switch(f){case"FINISHED":return"completed";case"RUNNING":return"running";case"IDLE":default:return"pending"}},A=f=>{switch(f){case"FINISHED":return"carbon:checkmark";case"RUNNING":return"carbon:play";case"IDLE":default:return"carbon:dot-mark"}},L=f=>{switch(f){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},M=f=>{var P;return((P=f.thinkActSteps)==null?void 0:P.some(N=>N.subPlanExecutionRecord))??!1},$=f=>{var P;return((P=f.thinkActSteps)==null?void 0:P.filter(N=>N.subPlanExecutionRecord))??[]},C=()=>{t("sub-plan-selected",-1,o.subPlanIndex,o.subPlan)},b=(f,P)=>{const N=P.stepId??`subplan-${o.subPlanIndex}-agent-${f}`;t("step-selected",N)},y=(f,P,N)=>{const z=N.stepId??`subplan-${o.subPlanIndex}-agent-${f}`;t("step-selected",z)},v=(f,P,N)=>{t("sub-plan-selected",f,P,N)},_=f=>{t("step-selected",f)};return(f,P)=>{var z,k;const N=ss("RecursiveSubPlan",!0);return p(),g("div",{class:le(["recursive-sub-plan",l()])},[s("div",{class:"sub-plan-header",onClick:C},[s("div",ao,[E(r(T),{icon:h(),class:"sub-plan-status-icon"},null,8,["icon"]),s("div",lo,[s("div",ro,[re(i(f.subPlan.title||f.$t("chat.subPlan"))+" #"+i(f.subPlanIndex+1)+" ",1),(f.nestingLevel??0)>0?(p(),g("span",io,"(L"+i((f.nestingLevel??0)+1)+")",1)):V("",!0)]),s("div",co,i(f.subPlan.currentPlanId),1)])]),s("div",uo,[s("div",{class:le(["sub-plan-status-badge",d()])},i(u()),3),f.subPlan.parentActToolCall?(p(),g("div",po,[E(r(T),{icon:"carbon:function",class:"trigger-icon"}),s("span",ho,i(f.subPlan.parentActToolCall.name),1)])):V("",!0)])]),(z=f.subPlan.agentExecutionSequence)!=null&&z.length?(p(),g("div",mo,[s("div",fo,[s("span",go,i(f.$t("chat.progress"))+": "+i(m())+" / "+i(f.subPlan.agentExecutionSequence.length),1),s("div",vo,[s("div",{class:"progress-fill",style:We({width:c()+"%"})},null,4)])])])):V("",!0),(k=f.subPlan.agentExecutionSequence)!=null&&k.length?(p(),g("div",bo,[s("div",yo,[s("span",_o,i(f.$t("chat.agentExecutions"))+":",1)]),s("div",So,[(p(!0),g(ie,null,he(f.subPlan.agentExecutionSequence,(x,j)=>{var Z,Y;return p(),g("div",{key:x.id||j,class:le(["agent-step-item",S(x.status)]),onClick:K=>b(j,x)},[s("div",$o,[E(r(T),{icon:A(x.status),class:"agent-icon"},null,8,["icon"]),s("span",Po,i(x.agentName||f.$t("chat.unknownAgent")),1),s("div",{class:le(["agent-status-badge",S(x.status)])},i(L(x.status)),3)]),s("div",ko,[x.result?(p(),g("div",Co,[s("div",Eo,[E(r(T),{icon:"carbon:checkmark",class:"result-icon"}),s("span",To,i(f.$t("chat.agentResult"))+":",1)]),s("pre",Io,i(x.result),1)])):V("",!0),x.errorMessage?(p(),g("div",Ro,[s("div",Ao,[E(r(T),{icon:"carbon:warning",class:"error-icon"}),s("span",xo,i(f.$t("chat.errorMessage"))+":",1)]),s("pre",Mo,i(x.errorMessage),1)])):V("",!0),(Z=x.thinkActSteps)!=null&&Z.length?(p(),g("div",Fo,[s("div",Do,[E(r(T),{icon:"carbon:thinking",class:"think-act-icon"}),s("span",No,i(f.$t("chat.thinkActSteps"))+" ("+i(x.thinkActSteps.length)+")",1)]),s("div",Uo,[(p(!0),g(ie,null,he(x.thinkActSteps.slice(0,f.maxVisibleSteps??2),(K,X)=>(p(),g("div",{key:K.id||X,class:"think-act-step-preview",onClick:Se(ne=>y(j,X,x),["stop"])},[s("span",Lo,"#"+i(X+1),1),s("span",Bo,i(K.actionDescription||f.$t("chat.thinking")),1),E(r(T),{icon:"carbon:arrow-right",class:"step-arrow"})],8,Oo))),128)),x.thinkActSteps.length>(f.maxVisibleSteps??2)?(p(),g("div",qo,[s("span",Vo,i(f.$t("chat.andMoreSteps",{count:x.thinkActSteps.length-(f.maxVisibleSteps??2)})),1)])):V("",!0)])])):V("",!0),M(x)?(p(),g("div",jo,[s("div",Go,[E(r(T),{icon:"carbon:tree-view-alt",class:"nested-icon"}),s("span",zo,i(f.$t("chat.nestedSubPlans")),1)]),s("div",Jo,[(p(!0),g(ie,null,he($(x),(K,X)=>(p(),me(N,{key:K.id||X,"sub-plan":K.subPlanExecutionRecord,"sub-plan-index":X,"nesting-level":(f.nestingLevel??0)+1,"max-nesting-depth":f.maxNestingDepth??3,"max-visible-steps":f.maxVisibleSteps??2,onSubPlanSelected:v,onStepSelected:_},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):V("",!0),(Y=x.subPlanExecutionRecords)!=null&&Y.length?(p(),g("div",Ho,[s("div",Wo,[E(r(T),{icon:"carbon:tree-view",class:"direct-icon"}),s("span",Ko,i(f.$t("chat.directSubPlans")),1)]),s("div",Xo,[(p(!0),g(ie,null,he(x.subPlanExecutionRecords,(K,X)=>(p(),me(N,{key:K.currentPlanId||X,"sub-plan":K,"sub-plan-index":X,"nesting-level":(f.nestingLevel??0)+1,"max-nesting-depth":f.maxNestingDepth??3,"max-visible-steps":f.maxVisibleSteps??2,onSubPlanSelected:v,onStepSelected:_},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):V("",!0)])],10,wo)}),128))])])):V("",!0)],2)}}}),Yo=$e(Qo,[["__scopeId","data-v-5dcf159c"]]),Zo={class:"execution-details"},en={key:0,class:"plan-overview"},tn={class:"plan-header"},sn={class:"plan-title"},on={key:0,class:"parent-tool-call"},nn={class:"parent-tool-header"},an={class:"tool-label"},ln={class:"tool-name"},rn={key:0,class:"tool-parameters"},cn={class:"param-label"},dn={class:"param-content"},un={key:1,class:"agent-execution-container"},pn={class:"section-title"},hn=["onClick"],mn={class:"agent-info"},fn={class:"agent-details"},gn={class:"agent-name"},vn={class:"request-content"},bn={class:"agent-controls"},yn={class:"agent-execution-info"},_n={key:0,class:"agent-result"},Sn={class:"result-header"},wn={class:"result-label"},$n={class:"result-content"},Pn={key:1,class:"agent-error"},kn={class:"error-header"},Cn={class:"error-label"},En={class:"error-content"},Tn={key:0,class:"sub-plans-container"},In={class:"sub-plans-header"},Rn={class:"sub-plans-title"},An={class:"sub-plans-list"},xn=we({__name:"ExecutionDetails",props:{planExecution:{}},emits:["sub-plan-selected","step-selected"],setup(n,{emit:e}){const o=n,t=e,{t:a}=Ue(),l=fe(()=>o.planExecution.agentExecutionSequence??[]),d=$=>{$.stepId?t("step-selected",$.stepId):console.warn("[ExecutionDetails] Agent execution has no stepId:",$)},u=()=>o.planExecution.completed?"completed":l.value.some(b=>b.status==="RUNNING")?"running":l.value.some(b=>b.status==="FINISHED")?"in-progress":"pending",h=()=>{switch(u()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},c=$=>{switch($){case"RUNNING":return"running";case"FINISHED":return"completed";case"IDLE":default:return"pending"}},m=$=>{switch($){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},S=$=>{switch($){case"RUNNING":return"carbon:play";case"FINISHED":return"carbon:checkmark";case"IDLE":default:return"carbon:dot-mark"}},A=($,C,b)=>{t("sub-plan-selected",$,C,b)},L=$=>{t("step-selected",$)},M=$=>{if(!$)return"";try{const C=JSON.parse($);return JSON.stringify(C,null,2)}catch{return $}};return($,C)=>{var b,y,v;return p(),g("div",Zo,[$.planExecution?(p(),g("div",en,[s("div",tn,[s("h3",sn,i($.planExecution.title||$.$t("chat.planExecution")),1),s("div",{class:le(["plan-status-badge",u()])},i(h()),3)]),$.planExecution.parentActToolCall?(p(),g("div",on,[s("div",nn,[E(r(T),{icon:"carbon:flow",class:"tool-icon"}),s("span",an,i($.$t("chat.triggeredByTool"))+":",1),s("span",ln,i($.planExecution.parentActToolCall.name),1)]),$.planExecution.parentActToolCall.parameters?(p(),g("div",rn,[s("span",cn,i($.$t("common.parameters"))+":",1),s("pre",dn,i(M($.planExecution.parentActToolCall.parameters)),1)])):V("",!0)])):V("",!0)])):V("",!0),(((y=(b=$.planExecution)==null?void 0:b.agentExecutionSequence)==null?void 0:y.length)??0)>0?(p(),g("div",un,[s("h4",pn,i($.$t("chat.agentExecutionSequence")),1),(p(!0),g(ie,null,he((v=$.planExecution)==null?void 0:v.agentExecutionSequence,(_,f)=>{var P;return p(),g("div",{key:_.id||f,class:le(["agent-execution-item",c(_.status)])},[s("div",{class:"agent-header",onClick:N=>d(_)},[s("div",mn,[E(r(T),{icon:S(_.status),class:"agent-status-icon"},null,8,["icon"]),s("div",fn,[s("div",gn,i(_.agentName||$.$t("chat.unknownAgent")),1),s("pre",vn,i(_.agentRequest),1)])]),s("div",bn,[s("div",{class:le(["agent-status-badge",c(_.status)])},i(m(_.status)),3),E(r(T),{icon:"carbon:arrow-right",class:"step-select-icon"})])],8,hn),s("div",yn,[_.result?(p(),g("div",_n,[s("div",Sn,[E(r(T),{icon:"carbon:checkmark",class:"result-icon"}),s("span",wn,i($.$t("chat.agentResult"))+":",1)]),s("pre",$n,i(_.result),1)])):V("",!0),_.errorMessage?(p(),g("div",Pn,[s("div",kn,[E(r(T),{icon:"carbon:warning",class:"error-icon"}),s("span",Cn,i($.$t("chat.errorMessage"))+":",1)]),s("pre",En,i(_.errorMessage),1)])):V("",!0)]),(P=_.subPlanExecutionRecords)!=null&&P.length?(p(),g("div",Tn,[s("div",In,[E(r(T),{icon:"carbon:tree-view",class:"sub-plans-icon"}),s("span",Rn,i($.$t("chat.subPlanExecutions"))+" ("+i(_.subPlanExecutionRecords.length)+") ",1)]),s("div",An,[(p(!0),g(ie,null,he(_.subPlanExecutionRecords,(N,z)=>(p(),me(Yo,{key:N.currentPlanId||z,"sub-plan":N,"sub-plan-index":z,"nesting-level":0,"max-nesting-depth":3,"max-visible-steps":2,onSubPlanSelected:A,onStepSelected:L},null,8,["sub-plan","sub-plan-index"]))),128))])])):V("",!0)],2)}),128))])):V("",!0)])}}}),rs=$e(xn,[["__scopeId","data-v-3fdaaeed"]]),Mn={key:0,class:"thinking-section"},Fn={class:"thinking-header"},Dn={class:"thinking-avatar"},Nn={class:"thinking-label"},Un={class:"thinking-content"},On={key:0,class:"thinking"},Ln={key:2,class:"default-processing"},Bn={class:"processing-indicator"},qn=we({__name:"ThinkingSection",props:{thinking:{},thinkingDetails:{},planExecution:{},stepActions:{},genericInput:{},hasContent:{type:Boolean}},emits:["agent-selected","sub-plan-selected","user-input-submitted","step-selected"],setup(n,{emit:e}){const o=n,t=e,a=fe(()=>{var c,m,S,A;return(o.thinking??!1)||(((m=(c=o.thinkingDetails)==null?void 0:c.agentExecutionSequence)==null?void 0:m.length)??0)>0||(((A=(S=o.planExecution)==null?void 0:S.agentExecutionSequence)==null?void 0:A.length)??0)>0}),l=(c,m)=>{t("agent-selected",c,m)},d=(c,m,S)=>{t("sub-plan-selected",c,m,S)},u=c=>{t("user-input-submitted",c)},h=c=>{t("step-selected",c)};return(c,m)=>a.value?(p(),g("div",Mn,[s("div",Fn,[s("div",Dn,[E(r(T),{icon:"carbon:thinking",class:"thinking-icon"})]),s("div",Nn,i(c.$t("chat.thinkingLabel")),1)]),s("div",Un,[c.thinking?(p(),g("div",On,[E(r(T),{icon:"carbon:thinking",class:"thinking-icon"}),s("span",null,i(c.thinking),1)])):V("",!0),c.thinkingDetails||c.planExecution?(p(),me(rs,{key:1,"plan-execution":c.thinkingDetails||c.planExecution,"step-actions":c.stepActions||[],"generic-input":c.genericInput||"",onAgentSelected:l,onSubPlanSelected:d,onUserInputSubmitted:u,onStepSelected:h},null,8,["plan-execution","step-actions","generic-input"])):!c.hasContent&&c.thinking?(p(),g("div",Ln,[s("div",Bn,[m[0]||(m[0]=s("div",{class:"thinking-dots"},[s("span"),s("span"),s("span")],-1)),s("span",null,i(c.thinking||c.$t("chat.thinkingProcessing")),1)])])):V("",!0)])])):V("",!0)}}),Vn=$e(qn,[["__scopeId","data-v-1cb833fc"]]),jn={class:"user-input-form-container"},Gn={class:"user-input-header"},zn={class:"user-input-title"},Jn={class:"user-input-message"},Hn={key:0,class:"form-description"},Wn={key:0,class:"form-grid"},Kn=["for"],Xn=["id","name","placeholder","required","onUpdate:modelValue"],Qn=["id","name","placeholder","required","onUpdate:modelValue"],Yn=["id","name","placeholder","required","onUpdate:modelValue"],Zn=["id","name","placeholder","required","onUpdate:modelValue"],ea=["id","name","placeholder","required","onUpdate:modelValue"],ta=["id","name","required","onUpdate:modelValue"],sa={value:""},oa=["value"],na={key:6,class:"checkbox-group"},aa=["id","name","value","onUpdate:modelValue"],la={class:"checkbox-label"},ra={key:7,class:"radio-group"},ia=["id","name","value","onUpdate:modelValue"],ca={class:"radio-label"},da=["id","name","placeholder","required","onUpdate:modelValue"],ua={key:1,class:"form-group"},pa={for:"form-input-genericInput"},ha={type:"submit",class:"submit-user-input-btn"},ma=we({__name:"UserInputForm",props:{userInputWaitState:{},planId:{},genericInput:{}},emits:["user-input-submitted"],setup(n,{emit:e}){const o=n,t=e;Ue();const a=nt({}),l=D(o.genericInput??""),d=D(!1),u=D(null),h=()=>{var L;const A=(L=o.userInputWaitState)==null?void 0:L.formInputs;A&&A.length>0&&(!d.value||Object.keys(a).length!==A.length)&&(A.forEach(($,C)=>{(!(C in a)||$.type==="checkbox"&&!Array.isArray(a[C])||$.type!=="checkbox"&&a[C]==="")&&($.type==="checkbox"?a[C]=[]:a[C]="")}),d.value=!0)};De(()=>{h()}),pe(()=>{var A;return(A=o.userInputWaitState)==null?void 0:A.formInputs},()=>{u.value&&clearTimeout(u.value),u.value=setTimeout(()=>{d.value=!1,h()},100)},{deep:!0});const c=async()=>{var A;try{const L={},M=(A=o.userInputWaitState)==null?void 0:A.formInputs;M&&M.length>0?Object.entries(a).forEach(([$,C])=>{const b=parseInt($,10),v=M[b].label||`input_${$}`;Array.isArray(C)?L[v]=C.join(", "):L[v]=C}):L.genericInput=l.value,console.log("[UserInputForm] Submitting user input:",L,"for planId:",o.planId),o.planId?(await ft.submitFormInput(o.planId,L),console.log("[UserInputForm] User input submitted successfully")):console.error("[UserInputForm] No planId available for user input submission"),t("user-input-submitted",L)}catch(L){console.error("[UserInputForm] User input submission failed:",L)}},m=A=>A?Array.isArray(A)?A:typeof A=="string"?A.split(",").map(L=>L.trim()).filter(L=>L.length>0):[]:[],S=A=>typeof A=="boolean"?A:typeof A=="string"?A==="true":!1;return Ne(()=>{u.value&&clearTimeout(u.value)}),(A,L)=>{var M,$,C,b,y;return p(),g("div",jn,[s("div",Gn,[E(r(T),{icon:"carbon:user",class:"user-icon"}),s("h4",zn,i(A.$t("chat.userInputRequired")),1)]),s("p",Jn,i(((M=A.userInputWaitState)==null?void 0:M.title)??A.$t("chat.userInput.message")),1),($=A.userInputWaitState)!=null&&$.formDescription?(p(),g("p",Hn,i((C=A.userInputWaitState)==null?void 0:C.formDescription),1)):V("",!0),s("form",{onSubmit:Se(c,["prevent"]),class:"user-input-form"},[(b=A.userInputWaitState)!=null&&b.formInputs&&A.userInputWaitState.formInputs.length>0?(p(),g("div",Wn,[(p(!0),g(ie,null,he((y=A.userInputWaitState)==null?void 0:y.formInputs,(v,_)=>(p(),g("div",{key:_,class:"form-group"},[s("label",{for:`form-input-${v.label.replace(/\W+/g,"_")}`},i(v.label)+i(S(v.required)?" *":"")+": ",9,Kn),!v.type||v.type==="text"?de((p(),g("input",{key:0,type:"text",id:`form-input-${v.label.replace(/\W+/g,"_")}`,name:v.label,placeholder:v.placeholder||"",required:S(v.required),"onUpdate:modelValue":f=>a[_]=f,class:"form-input"},null,8,Xn)),[[_e,a[_]]]):v.type==="email"?de((p(),g("input",{key:1,type:"email",id:`form-input-${v.label.replace(/\W+/g,"_")}`,name:v.label,placeholder:v.placeholder||"",required:S(v.required),"onUpdate:modelValue":f=>a[_]=f,class:"form-input"},null,8,Qn)),[[_e,a[_]]]):v.type==="number"?de((p(),g("input",{key:2,type:"number",id:`form-input-${v.label.replace(/\W+/g,"_")}`,name:v.label,placeholder:v.placeholder||"",required:S(v.required),"onUpdate:modelValue":f=>a[_]=f,class:"form-input"},null,8,Yn)),[[_e,a[_]]]):v.type==="password"?de((p(),g("input",{key:3,type:"password",id:`form-input-${v.label.replace(/\W+/g,"_")}`,name:v.label,placeholder:v.placeholder||"",required:S(v.required),"onUpdate:modelValue":f=>a[_]=f,class:"form-input"},null,8,Zn)),[[_e,a[_]]]):v.type==="textarea"?de((p(),g("textarea",{key:4,id:`form-input-${v.label.replace(/\W+/g,"_")}`,name:v.label,placeholder:v.placeholder||"",required:S(v.required),"onUpdate:modelValue":f=>a[_]=f,class:"form-input form-textarea",rows:"4"},null,8,ea)),[[_e,a[_]]]):v.type==="select"&&v.options?de((p(),g("select",{key:5,id:`form-input-${v.label.replace(/\W+/g,"_")}`,name:v.label,required:S(v.required),"onUpdate:modelValue":f=>a[_]=f,class:"form-input form-select"},[s("option",sa,i(A.$t("selectCommon.pleaseSelect")),1),(p(!0),g(ie,null,he(m(v.options),f=>(p(),g("option",{key:f,value:f},i(f),9,oa))),128))],8,ta)),[[mt,a[_]]]):v.type==="checkbox"&&v.options?(p(),g("div",na,[(p(!0),g(ie,null,he(m(v.options),f=>(p(),g("label",{key:f,class:"checkbox-item"},[de(s("input",{type:"checkbox",id:`form-input-${v.label.replace(/\W+/g,"_")}-${f.replace(/\W+/g,"_")}`,name:v.label,value:f,"onUpdate:modelValue":P=>a[_]=P,class:"form-checkbox"},null,8,aa),[[Et,a[_]]]),s("span",la,i(f),1)]))),128))])):v.type==="radio"&&v.options?(p(),g("div",ra,[(p(!0),g(ie,null,he(m(v.options),f=>(p(),g("label",{key:f,class:"radio-item"},[de(s("input",{type:"radio",id:`form-input-${v.label.replace(/\W+/g,"_")}-${f.replace(/\W+/g,"_")}`,name:v.label,value:f,"onUpdate:modelValue":P=>a[_]=P,class:"form-radio"},null,8,ia),[[Os,a[_]]]),s("span",ca,i(f),1)]))),128))])):de((p(),g("input",{key:8,type:"text",id:`form-input-${v.label.replace(/\W+/g,"_")}`,name:v.label,placeholder:v.placeholder||"",required:S(v.required),"onUpdate:modelValue":f=>a[_]=f,class:"form-input"},null,8,da)),[[_e,a[_]]])]))),128))])):(p(),g("div",ua,[s("label",pa,i(A.$t("common.input"))+":",1),de(s("input",{type:"text",id:"form-input-genericInput",name:"genericInput","onUpdate:modelValue":L[0]||(L[0]=v=>l.value=v),class:"form-input"},null,512),[[_e,l.value]])])),s("button",ha,i(A.$t("chat.userInput.submit")),1)],32)])}}}),fa=$e(ma,[["__scopeId","data-v-fc42d4b8"]]),ga={class:"response-section"},va={class:"response-header"},ba={class:"response-avatar"},ya={class:"response-name"},_a={key:0,class:"response-timestamp"},Sa={class:"response-content"},wa={key:1,class:"final-response"},$a=["innerHTML"],Pa={class:"response-actions"},ka=["title"],Ca=["title"],Ea={key:2,class:"response-placeholder"},Ta={class:"typing-indicator"},Ia={class:"typing-text"},Ra={key:3,class:"response-error"},Aa={class:"error-text"},xa={key:4,class:"response-empty"},Ma={class:"empty-text"},Fa=we({__name:"ResponseSection",props:{content:{},isStreaming:{type:Boolean},error:{},timestamp:{},userInputWaitState:{},planId:{},genericInput:{}},emits:["copy","regenerate","retry","user-input-submitted"],setup(n,{emit:e}){const o=n,t=e,{formatResponseText:a,formatTimestamp:l}=Ut(),d=async()=>{if(o.content)try{const m=o.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(m),t("copy")}catch(m){console.error("Failed to copy to clipboard:",m)}},u=()=>{t("regenerate")},h=()=>{t("retry")},c=m=>{console.log("[ResponseSection] User input submitted:",m),t("user-input-submitted",m)};return(m,S)=>{var A;return p(),g("div",ga,[s("div",va,[s("div",ba,[E(r(T),{icon:"carbon:bot",class:"bot-icon"})]),s("div",ya,i(m.$t("chat.botName")),1),m.timestamp?(p(),g("div",_a,i(r(l)(m.timestamp)),1)):V("",!0)]),s("div",Sa,[(A=m.userInputWaitState)!=null&&A.waiting?(p(),me(fa,os({key:0,"user-input-wait-state":m.userInputWaitState},m.planId?{"plan-id":m.planId}:{},{"generic-input":m.genericInput??"",onUserInputSubmitted:c}),null,16,["user-input-wait-state","generic-input"])):V("",!0),m.content?(p(),g("div",wa,[s("div",{class:"response-text",innerHTML:r(a)(m.content)},null,8,$a),s("div",Pa,[s("button",{class:"action-btn copy-btn",onClick:d,title:m.$t("chat.copyResponse")},[E(r(T),{icon:"carbon:copy"})],8,ka),s("button",{class:"action-btn regenerate-btn",onClick:u,title:m.$t("chat.regenerateResponse")},[E(r(T),{icon:"carbon:renew"})],8,Ca)])])):m.isStreaming?(p(),g("div",Ea,[s("div",Ta,[S[0]||(S[0]=s("div",{class:"typing-dots"},[s("span"),s("span"),s("span")],-1)),s("span",Ia,i(m.$t("chat.thinkingResponse")),1)])])):m.error?(p(),g("div",Ra,[E(r(T),{icon:"carbon:warning",class:"error-icon"}),s("span",Aa,i(m.error),1),s("button",{class:"retry-btn",onClick:h},i(m.$t("chat.retry")),1)])):(p(),g("div",xa,[s("span",Ma,i(m.$t("chat.waitingForResponse")),1)]))])])}}}),Da=$e(Fa,[["__scopeId","data-v-6581a34f"]]),Na={class:"assistant-message"},Ua=we({__name:"AssistantMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(n,{emit:e}){const o=n,t=e,a=()=>{t("copy",o.message.id)},l=()=>{t("regenerate",o.message.id)},d=()=>{t("retry",o.message.id)},u=(c,m)=>{console.log("[AssistantMessage] User input submitted:",m,"for message:",c.id)},h=c=>{console.log("[AssistantMessage] Step selected:",c),t("step-selected",c)};return(c,m)=>{var S,A,L,M;return p(),g("div",Na,[c.message.thinkingDetails?(p(),me(Vn,{key:0,"thinking-details":c.message.thinkingDetails,onStepSelected:h},null,8,["thinking-details"])):V("",!0),c.message.planExecution?(p(),me(rs,{key:1,"plan-execution":c.message.planExecution,"step-actions":c.message.stepActions||[],"generic-input":c.message.genericInput||"",onStepSelected:h},null,8,["plan-execution","step-actions","generic-input"])):V("",!0),c.message.content||c.message.error||c.isStreaming||(A=(S=c.message.planExecution)==null?void 0:S.userInputWaitState)!=null&&A.waiting?(p(),me(Da,os({key:2,content:c.message.content||"","is-streaming":c.isStreaming||!1},{...c.message.error?{error:c.message.error}:{},...(L=c.message.planExecution)!=null&&L.userInputWaitState?{userInputWaitState:c.message.planExecution.userInputWaitState}:{},...(M=c.message.planExecution)!=null&&M.currentPlanId?{planId:c.message.planExecution.currentPlanId}:{}},{timestamp:c.message.timestamp,"generic-input":c.message.genericInput||"",onCopy:a,onRegenerate:l,onRetry:d,onUserInputSubmitted:m[0]||(m[0]=$=>u(c.message,$))}),null,16,["content","is-streaming","timestamp","generic-input"])):V("",!0)])}}}),Oa=$e(Ua,[["__scopeId","data-v-3810c279"]]),La=we({__name:"ChatMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(n,{emit:e}){const o=n,t=e,{getMessageClasses:a}=Ut(),l=fe(()=>a(o.message)),d=m=>{t("copy",m)},u=m=>{t("regenerate",m)},h=m=>{t("retry",m)},c=m=>{t("step-selected",m)};return(m,S)=>(p(),g("div",{class:le(["chat-message",l.value])},[m.message.type==="user"?(p(),me(no,{key:0,message:m.message},null,8,["message"])):m.message.type==="assistant"?(p(),me(Oa,{key:1,message:m.message,"is-streaming":m.isStreaming||!1,onCopy:d,onRegenerate:u,onRetry:h,onStepSelected:c},null,8,["message","is-streaming"])):V("",!0)],2))}}),Ba=$e(La,[["__scopeId","data-v-218b3735"]]);function Tt(n){const e={...n};return"agentExecutionSequence"in n&&Array.isArray(n.agentExecutionSequence)&&(e.agentExecutionSequence=n.agentExecutionSequence.map(o=>qa(o))),e}function qa(n){const e={...n};return"subPlanExecutionRecords"in n&&Array.isArray(n.subPlanExecutionRecords)&&(e.subPlanExecutionRecords=n.subPlanExecutionRecords.map(o=>Tt(o))),e}function Va(n){const e={...n};return"thinkingDetails"in n&&n.thinkingDetails&&(e.thinkingDetails=Tt(n.thinkingDetails)),"planExecution"in n&&n.planExecution&&(e.planExecution=Tt(n.planExecution)),"attachments"in n&&Array.isArray(n.attachments)&&(e.attachments=[...n.attachments]),e}function ja(){const n=D([]),e=D(!1),o=D(null),t=D(null),a=fe(()=>n.value.length>0?n.value[n.value.length-1]:null),l=fe(()=>o.value!==null),d=fe(()=>n.value.length>0),u=(_,f,P)=>{const N={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:_,content:f,timestamp:new Date,isStreaming:!1,...P};return n.value.push(N),N},h=(_,f)=>{const P=n.value.findIndex(N=>N.id===_);P!==-1&&(n.value[P]={...n.value[P],...f})},c=_=>{const f=n.value.findIndex(P=>P.id===_);f!==-1&&n.value.splice(f,1)},m=()=>{n.value=[],o.value=null,t.value=null},S=_=>{o.value=_,h(_,{isStreaming:!0})},A=_=>{_&&h(_,{isStreaming:!1}),o.value===_&&(o.value=null)},L=_=>{t.value=_},M=(_,f,P="content")=>{const N=n.value.find(z=>z.id===_);N&&typeof N[P]=="string"&&h(_,{[P]:N[P]+f})},$=(_,f)=>{h(_,{thinkingDetails:f})},C=(_,f)=>{h(_,{thinking:f})},b=(_,f)=>{h(_,{planExecution:f})},y=_=>n.value.find(f=>f.id===_),v=_=>n.value.findIndex(f=>f.id===_);return{messages:tt(n),isLoading:e,streamingMessageId:tt(o),activeMessageId:tt(t),lastMessage:a,isStreaming:l,hasMessages:d,addMessage:u,updateMessage:h,removeMessage:c,clearMessages:m,startStreaming:S,stopStreaming:A,setActiveMessage:L,appendToMessage:M,updateMessageThinking:C,updateMessageThinkingDetails:$,updateMessagePlanExecution:b,findMessage:y,getMessageIndex:v}}function Ga(n){const e=D(!1),o=D(!0),t=150,a=async(C=!0)=>{n.value&&(await Ae(),n.value.scrollTo({top:n.value.scrollHeight,behavior:C?"smooth":"auto"}))},l=()=>{if(!n.value)return!1;const{scrollTop:C,scrollHeight:b,clientHeight:y}=n.value;return b-C-y<t},d=()=>{if(!n.value)return;const C=l();e.value=!C&&n.value.scrollHeight>n.value.clientHeight,C&&(o.value=!0)},u=()=>{d(),l()||(o.value=!1)},h=async()=>{o.value&&await a()},c=async()=>{o.value=!0,await a()},m=(C,b=!0)=>{if(!n.value)return;const y=n.value.querySelector(`[data-message-id="${C}"]`);y&&y.scrollIntoView({behavior:b?"smooth":"auto",block:"center"})},S=()=>{if(!n.value)return{scrollTop:0,scrollHeight:0,clientHeight:0,isAtTop:!0,isAtBottom:!0,scrollPercentage:0};const{scrollTop:C,scrollHeight:b,clientHeight:y}=n.value,v=C===0,_=C+y>=b-5,f=b>y?C/(b-y)*100:100;return{scrollTop:C,scrollHeight:b,clientHeight:y,isAtTop:v,isAtBottom:_,scrollPercentage:f}},A=()=>{n.value&&n.value.addEventListener("scroll",u,{passive:!0})},L=()=>{n.value&&n.value.removeEventListener("scroll",u)},M=()=>{A(),d()},$=()=>{L()};return De(()=>{Ae(()=>{M()})}),Ne(()=>{$()}),{showScrollToBottom:tt(e),isAutoScrollEnabled:tt(o),scrollToBottom:a,autoScrollToBottom:h,forceScrollToBottom:c,scrollToMessage:m,isNearBottom:l,checkScrollPosition:d,getScrollInfo:S,addScrollListener:A,removeScrollListener:L,initializeScrollBehavior:M,cleanupScrollBehavior:$}}const Ge=class Ge{constructor(){Re(this,"POLL_INTERVAL",5e3);Re(this,"state",nt({activePlanId:null,lastSequenceSize:0,isPolling:!1,pollTimer:null}));Re(this,"callbacks",{});Re(this,"planExecutionCache",new Map);Re(this,"uiStateCache",new Map);console.log("[PlanExecutionManager] Initialized with callback-based event system")}getCachedPlanRecord(e){return this.planExecutionCache.get(e)}getCachedUIState(e){return this.uiStateCache.get(e)}setCachedUIState(e,o){this.uiStateCache.set(e,o),console.log(`[PlanExecutionManager] Cached UI state for rootPlanId: ${e}`)}getAllCachedRecords(){return new Map(this.planExecutionCache)}hasCachedPlanRecord(e){return this.planExecutionCache.has(e)}setCachedPlanRecord(e,o){this.planExecutionCache.set(e,o),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${e}`)}clearCachedPlanRecord(e){const o=this.planExecutionCache.delete(e);return o&&console.log(`[PlanExecutionManager] Cleared cached plan execution record for rootPlanId: ${e}`),o}clearAllCachedRecords(){const e=this.planExecutionCache.size,o=this.uiStateCache.size;this.planExecutionCache.clear(),this.uiStateCache.clear(),console.log(`[PlanExecutionManager] Cleared all caches - Plans: ${e}, UI States: ${o}`)}static getInstance(){return Ge.instance||(Ge.instance=new Ge),Ge.instance}getActivePlanId(){return this.state.activePlanId}getState(){return this.state}setEventCallbacks(e){this.callbacks={...this.callbacks,...e},console.log("[PlanExecutionManager] Event callbacks set:",Object.keys(e))}async handleUserMessageSendRequested(e){if(this.validateAndPrepareUIForNewRequest(e))try{if(await this.sendUserMessageAndSetPlanId(e),this.state.activePlanId)this.initiatePlanExecutionSequence(e,this.state.activePlanId);else throw new Error("Failed to get valid plan ID")}catch(o){console.error("[PlanExecutionManager] Failed to send user message:",o);const t=this.state.activePlanId??"error";this.setCachedUIState(t,{enabled:!0}),this.emitChatInputUpdateState(t),this.state.activePlanId=null}}handlePlanExecutionRequested(e,o){console.log("[PlanExecutionManager] Received plan execution request:",{planId:e,query:o}),e?(this.state.activePlanId=e,this.initiatePlanExecutionSequence(o??"Execute Plan",e)):console.error("[PlanExecutionManager] Invalid plan execution request: missing planId")}handleCachedPlanExecution(e,o){const t=this.getCachedPlanRecord(e);return t!=null&&t.currentPlanId?(console.log(`[PlanExecutionManager] Found cached plan execution record for rootPlanId: ${e}`),this.handlePlanExecutionRequested(t.currentPlanId,o),!0):(console.log(`[PlanExecutionManager] No cached plan execution record found for rootPlanId: ${e}`),!1)}validateAndPrepareUIForNewRequest(e){if(!e)return console.warn("[PlanExecutionManager] Query is empty"),!1;if(this.state.activePlanId)return!1;this.emitChatInputClear();const o=this.state.activePlanId??"ui-state";return this.setCachedUIState(o,{enabled:!1,placeholder:"Processing..."}),this.emitChatInputUpdateState(o),!0}async sendUserMessageAndSetPlanId(e){try{const o=await Gs.sendMessage({input:e});if(o!=null&&o.planId)return this.state.activePlanId=o.planId,o;if(o!=null&&o.planTemplateId)return this.state.activePlanId=o.planTemplateId,{...o,planId:o.planTemplateId};throw console.error("[PlanExecutionManager] Failed to get planId from response:",o),new Error("Failed to get valid planId from API response")}catch(o){throw console.error("[PlanExecutionManager] API call failed:",o),o}}initiatePlanExecutionSequence(e,o){console.log(`[PlanExecutionManager] Starting plan execution sequence for query: "${e}", planId: ${o}`);const t=o;st().setTaskRunning(o),console.log("[PlanExecutionManager] Task marked as running with planId:",o),this.emitDialogRoundStart(t),this.startPolling()}handlePlanCompletion(e){this.emitPlanCompleted(e.rootPlanId??""),this.state.lastSequenceSize=0,this.stopPolling();const o=st();o.currentTask&&o.currentTask.isRunning&&(o.currentTask.isRunning=!1,console.log("[PlanExecutionManager] Task marked as completed"));try{setTimeout(async()=>{if(this.state.activePlanId)try{await ut.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}},5e3)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}e.completed&&(this.state.activePlanId=null,this.emitChatInputUpdateState(e.rootPlanId??""))}handlePlanError(e){this.emitPlanError(e.message??""),this.state.lastSequenceSize=0,this.stopPolling();const o=st();o.currentTask&&o.currentTask.isRunning&&(o.currentTask.isRunning=!1,console.log("[PlanExecutionManager] Task marked as stopped due to error"));try{setTimeout(async()=>{if(this.state.activePlanId)try{await ut.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}},5e3)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}}async pollPlanStatus(){if(this.state.activePlanId){if(this.state.isPolling){console.log("[PlanExecutionManager] Previous polling still in progress, skipping");return}try{this.state.isPolling=!0;const e=await this.getPlanDetails(this.state.activePlanId);if(!e){console.warn("[PlanExecutionManager] No details received from API - this might be a temporary network issue");return}if(e.status&&e.status==="failed"&&e.message&&!e.message.includes("Failed to get detailed information")){this.handlePlanError(e);return}e.rootPlanId&&this.setCachedPlanRecord(e.rootPlanId,e),this.emitPlanUpdate(e.rootPlanId??""),e.completed&&this.handlePlanCompletion(e)}catch(e){console.error("[PlanExecutionManager] Failed to poll plan status:",e)}finally{this.state.isPolling=!1}}}async getPlanDetails(e){try{const o=await ft.getDetails(e);return o!=null&&o.rootPlanId&&(this.planExecutionCache.set(o.rootPlanId,o),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${o.rootPlanId}`)),o}catch(o){return console.error("[PlanExecutionManager] Failed to get plan details:",o),{currentPlanId:e,status:"failed",message:o instanceof Error?o.message:"Failed to get plan"}}}startPolling(){this.state.pollTimer&&clearInterval(this.state.pollTimer),this.state.pollTimer=window.setInterval(()=>{this.pollPlanStatus()},this.POLL_INTERVAL),console.log("[PlanExecutionManager] Started polling")}async pollPlanStatusImmediately(){console.log("[PlanExecutionManager] Polling plan status immediately"),await this.pollPlanStatus()}stopPolling(){this.state.pollTimer&&(clearInterval(this.state.pollTimer),this.state.pollTimer=null),console.log("[PlanExecutionManager] Stopped polling")}cleanup(){this.stopPolling(),this.state.activePlanId=null,this.state.lastSequenceSize=0,this.state.isPolling=!1,this.clearAllCachedRecords()}emitChatInputClear(){this.callbacks.onChatInputClear&&this.callbacks.onChatInputClear()}emitChatInputUpdateState(e){this.callbacks.onChatInputUpdateState&&this.callbacks.onChatInputUpdateState(e)}emitDialogRoundStart(e){this.callbacks.onDialogRoundStart&&this.callbacks.onDialogRoundStart(e)}emitPlanUpdate(e){this.callbacks.onPlanUpdate&&this.callbacks.onPlanUpdate(e)}emitPlanCompleted(e){this.callbacks.onPlanCompleted&&this.callbacks.onPlanCompleted(e)}emitPlanError(e){this.callbacks.onPlanError&&this.callbacks.onPlanError(e)}};Re(Ge,"instance",null);let It=Ge;const qe=It.getInstance(),za={class:"chat-container"},Ja={key:0,class:"loading-message"},Ha={class:"loading-content"},Wa=["title"],Ka=we({__name:"ChatContainer",emits:["step-selected"],setup(n,{expose:e,emit:o}){const t=o,{t:a}=Ue(),{messages:l,isLoading:d,streamingMessageId:u,addMessage:h,updateMessage:c,startStreaming:m,stopStreaming:S,findMessage:A}=ja(),L=D(null),{scrollToBottom:M,autoScrollToBottom:$,showScrollToBottom:C}=Ga(L),b=D(),y=K=>u.value===K,v=fe(()=>l.value.map(Va)),_=()=>{},f=K=>{const X=K.target;if(X.classList.contains("md-copy-btn")){const ne=X.getAttribute("data-raw");if(ne){const ge=decodeURIComponent(ne);navigator.clipboard.writeText(ge).then(()=>{X.textContent=a("chat.copied"),setTimeout(()=>{X.textContent=a("chat.copy")},1e3)})}}},P=async K=>{const X=A(K);if(X)try{const ne=X.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(ne)}catch(ne){console.error("Failed to copy message:",ne)}},N=K=>{const X=A(K);X&&X.type==="assistant"&&(c(K,{content:""}),m(K))},z=K=>{A(K)&&(c(K,{content:""}),m(K))},k=K=>{console.log("[ChatContainer] Step selected:",K),t("step-selected",K)},x=K=>{console.log("[ChatContainer] Plan update received:",K);const X=qe.getCachedPlanRecord(K);if(!X){console.warn("[ChatContainer] No cached plan data found for rootPlanId:",K);return}console.log("[ChatContainer] Retrieved plan details from cache:",X);const ne=l.value.findIndex(ge=>{var ke;return((ke=ge.planExecution)==null?void 0:ke.currentPlanId)===X.currentPlanId&&ge.type==="assistant"});if(ne!==-1){const ge=l.value[ne],ke={planExecution:JSON.parse(JSON.stringify(X))};if(!X.agentExecutionSequence||X.agentExecutionSequence.length===0){if(console.log("[ChatContainer] Handling simple response without agent execution sequence"),X.completed){ke.thinking="";const H=X.summary??X.result??X.message??"Execution completed";ke.content=H,console.log("[ChatContainer] Set simple response content:",H)}}else console.log("[ChatContainer] Handling detailed plan with agent execution sequence");c(ge.id,ke)}},j=K=>{if(console.log("[ChatContainer] Plan completed:",K),K.rootPlanId){const X=l.value.findIndex(ne=>{var ge;return((ge=ne.planExecution)==null?void 0:ge.currentPlanId)===K.rootPlanId});if(X!==-1){const ne=l.value[X],ge=K.summary??K.result??"Execution completed";c(ne.id,{thinking:"",content:ge}),console.log("[ChatContainer] Updated completed message:",ge)}}},Z=K=>{console.log("[ChatContainer] Dialog round start:",K)},Y=K=>{console.log("[ChatContainer] Plan error:",K),h("assistant",`Error: ${K}`),console.error("[ChatContainer] Plan execution error:",K)};return De(()=>{pe(l,()=>{Ae(()=>{$()})},{deep:!0}),qe.setEventCallbacks({onPlanUpdate:x,onPlanCompleted:j,onDialogRoundStart:Z,onPlanError:Y})}),Ne(()=>{b.value&&clearInterval(b.value)}),e({scrollToBottom:M,handlePlanUpdate:x,handlePlanCompleted:j,handleDialogRoundStart:Z,handlePlanError:Y,addMessage:h,updateMessage:c,startStreaming:m,stopStreaming:S}),(K,X)=>(p(),g("div",za,[s("div",{class:"messages",ref_key:"messagesRef",ref:L,onScroll:_,onClick:f},[(p(!0),g(ie,null,he(v.value,ne=>(p(),me(Ba,{key:ne.id,message:ne,"is-streaming":y(ne.id),onCopy:P,onRegenerate:N,onRetry:z,onStepSelected:k},null,8,["message","is-streaming"]))),128)),r(d)?(p(),g("div",Ja,[s("div",Ha,[E(r(T),{icon:"carbon:circle-dash",class:"loading-icon"}),s("span",null,i(K.$t("chat.processing")),1)])])):V("",!0)],544),E(Nt,{name:"scroll-button"},{default:Ke(()=>[r(C)?(p(),g("button",{key:0,class:"scroll-to-bottom",onClick:X[0]||(X[0]=()=>r(M)()),title:K.$t("chat.scrollToBottom")},[E(r(T),{icon:"carbon:chevron-down"})],8,Wa)):V("",!0)]),_:1})]))}}),Xa=$e(Ka,[["__scopeId","data-v-3aa5b9a4"]]);class Vt{static async uploadFiles(e){try{console.log("[FileUploadApiService] Uploading files:",e.length);const o=new FormData;e.forEach(l=>{o.append("files",l)});const t=await fetch("/api/file-upload/upload",{method:"POST",body:o});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();return console.log("[FileUploadApiService] Files uploaded successfully:",a.successfulFiles,"uploadKey:",a.uploadKey),a}catch(o){throw console.error("[FileUploadApiService] Error uploading files:",o),o}}static async getUploadedFiles(e){try{console.log("[FileUploadApiService] Getting uploaded files for uploadKey:",e);const o=await fetch(`/api/file-upload/files/${encodeURIComponent(e)}`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const t=await o.json();return console.log("[FileUploadApiService] Got uploaded files:",t.totalCount,"for uploadKey:",e),t}catch(o){throw console.error("[FileUploadApiService] Error getting uploaded files:",o),o}}static async deleteFile(e,o){try{console.log("[FileUploadApiService] Deleting file:",o,"from uploadKey:",e);const t=await fetch(`/api/file-upload/files/${encodeURIComponent(e)}/${encodeURIComponent(o)}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();return console.log("[FileUploadApiService] File deleted successfully:",a.success),a}catch(t){throw console.error("[FileUploadApiService] Error deleting file:",t),t}}static async getUploadConfig(){try{console.log("[FileUploadApiService] Getting upload configuration");const e=await fetch("/api/file-upload/config");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const o=await e.json();return console.log("[FileUploadApiService] Got upload configuration:",o),o}catch(e){throw console.error("[FileUploadApiService] Error getting upload configuration:",e),e}}}const Qa={class:"file-upload-component"},Ya=["accept"],Za={key:0},el={key:1},tl={key:0,class:"files-list"},sl={class:"file-name"},ol={class:"file-size"},nl=["onClick","title"],al={key:0,class:"upload-progress"},ll=we({__name:"FileUploadComponent",props:{acceptedFileTypes:{default:".pdf,.txt,.md,.doc,.docx,.csv,.xlsx,.xls,.json,.xml,.html,.htm,.log,.java,.py,.js,.ts,.sql,.sh,.bat,.yaml,.yml,.properties,.conf,.ini,.jpg,.jpeg,.png,.gif"},disabled:{type:Boolean,default:!1}},emits:["files-uploaded","files-removed","upload-key-changed","upload-started","upload-completed","upload-error"],setup(n,{expose:e,emit:o}){const{t}=Ue(),a=n,l=o,d=D(),u=D([]),h=D(!1),c=D(null),m=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),u.value=[],c.value=null,l("upload-key-changed",null)};Ne(()=>{m()}),pe(()=>u.value,C=>{l("files-removed",C)},{deep:!0});const S=()=>{a.disabled||d.value&&d.value.click()},A=async C=>{const b=C.target,y=b.files;if(!y||y.length===0)return;const v=Array.from(y);console.log("[FileUpload] Selected files for upload:",v.map(_=>_.name)),await L(v),b.value=""},L=async C=>{if(C.length!==0){h.value=!0,l("upload-started");try{const b=await Vt.uploadFiles(C);b.success&&(!c.value&&b.uploadKey?(c.value=b.uploadKey,console.log("[FileUpload] Set uploadKey:",c.value),u.value=b.uploadedFiles):c.value?(console.log("[FileUpload] Using existing uploadKey:",c.value),u.value=[...u.value,...b.uploadedFiles]):(console.warn("[FileUpload] No uploadKey returned from upload"),u.value=b.uploadedFiles),b.uploadKey&&(c.value=b.uploadKey,console.log("[Input] Saved uploadKey locally:",b.uploadKey),l("upload-key-changed",c.value)),console.log("[Input] Updated global uploadedFiles state:",u.value),l("files-uploaded",u.value,c.value)),console.log("Files uploaded successfully:",b),l("upload-completed")}catch(b){console.error("File upload error:",b),l("upload-error",b)}finally{h.value=!1}}},M=async C=>{try{if(console.log("ðŸ—‘ï¸ Removing file:",C.originalName,"from uploadKey:",c),c.value){const b=await Vt.deleteFile(c.value,C.originalName);b.success?console.log("âœ… File deleted from server successfully"):console.error("âŒ Failed to delete file from server:",b.error)}u.value=u.value.filter(b=>b.originalName!==C.originalName),u.value.length===0&&(console.log("[FileUpload] ðŸ§¹ Clearing uploadKey to force new plan for new files"),c.value=null,l("upload-key-changed",null)),console.log("ðŸŽ‰ File removal completed, remaining files:",u.value.length)}catch(b){console.error("âŒ Error removing file:",b),l("upload-error",b)}},$=C=>{if(C===0)return"0 Bytes";const b=1024,y=["Bytes","KB","MB","GB"],v=Math.floor(Math.log(C)/Math.log(b));return parseFloat((C/Math.pow(b,v)).toFixed(2))+" "+y[v]};return e({uploadedFiles:u,uploadKey:c,resetSession:m,uploadFiles:L,removeFile:M,isUploading:h}),(C,b)=>(p(),g("div",Qa,[s("input",{ref_key:"fileInputRef",ref:d,type:"file",multiple:"",style:{display:"none"},onChange:A,accept:C.acceptedFileTypes||""},null,40,Ya),s("div",{class:le(["uploaded-files",{"has-files":u.value.length>0}])},[s("div",{class:"files-header",onClick:S},[E(r(T),{icon:"carbon:attachment"}),u.value.length===0?(p(),g("span",Za,i(r(t)("input.attachFile")),1)):(p(),g("span",el,i(r(t)("input.attachedFiles"))+" ("+i(u.value.length)+")",1))]),u.value.length>0?(p(),g("div",tl,[(p(!0),g(ie,null,he(u.value,y=>(p(),g("div",{key:y.originalName,class:"file-item"},[E(r(T),{icon:"carbon:document",class:"file-icon"}),s("span",sl,i(y.originalName),1),s("span",ol,"("+i($(y.size))+")",1),s("button",{onClick:v=>M(y),class:"remove-btn",title:r(t)("input.removeFile")},[E(r(T),{icon:"carbon:close"})],8,nl)]))),128))])):V("",!0)],2),h.value?(p(),g("div",al,[E(r(T),{icon:"carbon:rotate--clockwise",class:"loading-icon"}),s("span",null,i(r(t)("input.uploading")),1)])):V("",!0)]))}}),is=$e(ll,[["__scopeId","data-v-d1f7078c"]]);class rl{constructor(){Re(this,"isCollapsed",!1);Re(this,"selectMemoryId","");Re(this,"loadMessages",()=>{});Re(this,"intervalId")}toggleSidebar(){this.isCollapsed=!this.isCollapsed,this.isCollapsed?(this.loadMessages(),this.intervalId=window.setInterval(()=>{this.loadMessages()},3e3)):clearInterval(this.intervalId)}selectMemory(e){this.toggleSidebar(),this.selectMemoryId=e}setMemory(e){this.selectMemoryId=e}defaultMemoryId(){this.selectMemoryId=this.generateRandomId()}clearMemoryId(){this.selectMemoryId=""}generateRandomId(){return Math.random().toString(36).substring(2,10)}setLoadMessages(e){this.loadMessages=e}}const Ve=nt(new rl),il={class:"input-area"},cl={class:"input-container"},dl={class:"input-row-first"},ul=["placeholder","disabled"],pl={class:"input-row-second"},hl=["title","disabled"],ml={value:""},fl=["value"],gl=["title"],vl=["disabled","title"],bl=["title"],yl=we({__name:"InputArea",props:{placeholder:{default:""},disabled:{type:Boolean,default:!1},initialValue:{default:""},selectionOptions:{default:()=>[]}},emits:["send","clear","update-state","plan-mode-clicked","selection-changed"],setup(n,{expose:e,emit:o}){const{t}=Ue(),a=st(),l=fe(()=>a.hasRunningTask()),d=n,u=o,h=D(),c=D(),m=D(""),S=fe(()=>d.placeholder||t("input.placeholder")),A=D(S.value),L=D([]),M=D(null),$=D(""),C=D([]),b=D(!1),y=async()=>{b.value=!0;try{console.log("[InputArea] Loading inner tools...");const U=await Oe.getAllCoordinatorTools(),R=[];for(const B of U)if(B.enableInternalToolcall)try{const Q=JSON.parse(B.inputSchema||"[]");if(Array.isArray(Q)&&Q.length===1){const ye=Q[0];R.push({value:B.planTemplateId,label:`${B.toolName} (${ye.name})`,toolName:B.toolName,planTemplateId:B.planTemplateId,paramName:ye.name})}}catch(Q){console.warn("[InputArea] Failed to parse inputSchema for tool:",B.toolName,Q)}C.value=R,console.log("[InputArea] Loaded",R.length,"inner tools with single parameter");const O=localStorage.getItem("inputAreaSelectedTool");O&&(R.some(Q=>Q.value===O)?($.value=O,console.log("[InputArea] Restored selected tool from localStorage:",O)):(console.log("[InputArea] Saved tool no longer available, clearing selection"),localStorage.removeItem("inputAreaSelectedTool"),$.value=""))}catch(U){console.error("[InputArea] Failed to load inner tools:",U),C.value=[]}finally{b.value=!1}},v=fe(()=>C.value.length>0?C.value.map(U=>({value:U.value,label:U.label})):d.selectionOptions);pe($,U=>{u("selection-changed",U),localStorage.setItem("inputAreaSelectedTool",U||"")}),De(()=>{y()});const _=()=>{var U;console.log("[FileUpload] Resetting session and clearing uploadKey"),(U=c.value)==null||U.resetSession()};Ne(()=>{_()});const f=(U,R)=>{L.value=U.map(O=>O.originalName),M.value=R,console.log("[InputArea] Files uploaded:",U.length,"uploadKey:",R),L.value.length>0&&(A.value=t("input.filesAttached",{count:L.value.length}))},P=U=>{L.value=U.map(R=>R.originalName),console.log("[InputArea] Files removed, remaining:",U.length),L.value.length===0?A.value=S.value:A.value=t("input.filesAttached",{count:L.value.length})},N=U=>{M.value=U,console.log("[InputArea] Upload key changed:",U)},z=()=>{console.log("[InputArea] Upload started")},k=()=>{console.log("[InputArea] Upload completed")},x=U=>{console.error("[InputArea] Upload error:",U)},j=fe(()=>!!d.disabled),Z=()=>{Ae(()=>{h.value&&(h.value.style.height="auto",h.value.style.height=Math.min(h.value.scrollHeight,120)+"px")})},Y=U=>{U.key==="Enter"&&!U.shiftKey&&(U.preventDefault(),K())},K=async()=>{if(!m.value.trim()||j.value)return;const U=m.value.trim(),R={input:U,memoryId:Ve.selectMemoryId,uploadedFiles:L.value};if(M.value?(R.uploadKey=M.value,console.log("[InputArea] Including uploadKey in message:",M.value)):console.log("[InputArea] No uploadKey available for message"),$.value){const O=C.value.find(B=>B.value===$.value);O&&(R.toolName=O.planTemplateId,R.replacementParams={[O.paramName]:U},console.log("[InputArea] Sending message with tool:",O.toolName))}u("send",R),ge()},X=()=>{u("plan-mode-clicked")},ne=async()=>{console.log("[InputArea] Stop button clicked"),await a.stopCurrentTask()?console.log("[InputArea] Task stopped successfully"):console.error("[InputArea] Failed to stop task")},ge=()=>{m.value="",Z(),u("clear")},ke=(U,R)=>{R&&(A.value=U?R:t("input.waiting")),u("update-state",U,R)},H=U=>{m.value=U,Z()},G=()=>m.value.trim();return pe(()=>d.initialValue,U=>{U.trim()&&(m.value=U,Z())},{immediate:!0}),e({clearInput:ge,updateState:ke,setInputValue:H,getQuery:G,resetSession:_,focus:()=>{var U;return(U=h.value)==null?void 0:U.focus()},get uploadedFiles(){var U,R;return((R=(U=c.value)==null?void 0:U.uploadedFiles)==null?void 0:R.map(O=>O.originalName))||[]},get uploadKey(){var U;return((U=c.value)==null?void 0:U.uploadKey)||null}}),De(()=>{}),Ne(()=>{}),(U,R)=>(p(),g("div",il,[E(is,{ref_key:"fileUploadRef",ref:c,disabled:j.value,onFilesUploaded:f,onFilesRemoved:P,onUploadKeyChanged:N,onUploadStarted:z,onUploadCompleted:k,onUploadError:x},null,8,["disabled"]),s("div",cl,[s("div",dl,[de(s("textarea",{"onUpdate:modelValue":R[0]||(R[0]=O=>m.value=O),ref_key:"inputRef",ref:h,class:"chat-input",placeholder:A.value,disabled:j.value,onKeydown:Y,onInput:Z},null,40,ul),[[_e,m.value]])]),s("div",pl,[de(s("select",{"onUpdate:modelValue":R[1]||(R[1]=O=>$.value=O),class:"selection-input",title:U.$t("input.selectionTitle"),disabled:b.value||j.value},[s("option",ml,i(U.$t("input.defaultFuncAgent")),1),(p(!0),g(ie,null,he(v.value,O=>(p(),g("option",{key:O.value,value:O.value},i(O.label),9,fl))),128))],8,hl),[[mt,$.value]]),s("button",{class:"plan-mode-btn",title:U.$t("input.planMode"),onClick:X},[E(r(T),{icon:"carbon:document"}),re(" "+i(U.$t("input.planMode")),1)],8,gl),l.value?(p(),g("button",{key:1,class:"send-button stop-button",onClick:ne,title:U.$t("input.stop")},[E(r(T),{icon:"carbon:stop-filled"}),re(" "+i(U.$t("input.stop")),1)],8,bl)):(p(),g("button",{key:0,class:"send-button",disabled:!m.value.trim()||j.value,onClick:K,title:U.$t("input.send")},[E(r(T),{icon:"carbon:send-alt"}),re(" "+i(U.$t("input.send")),1)],8,vl))])])]))}}),_l=$e(yl,[["__scopeId","data-v-d9e8df59"]]);class rt{static async handleResponse(e){if(!e.ok)try{const o=await e.json();throw new Error(o.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getMemories(){try{const e=await fetch(`${this.BASE_URL}`);return(await(await this.handleResponse(e)).json()).memories??[]}catch(e){throw console.error("Failed to get memory list:",e),e}}static async getMemory(e){try{const o=await fetch(`${this.BASE_URL}/single?conversationId=${e}`),a=await(await this.handleResponse(o)).json();if(!a.data)throw new Error("Memory not found");return a.data}catch(o){throw console.error("Failed to get memory:",o),o}}static async createMemory(e,o){try{const t=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,memory_name:o})}),l=await(await this.handleResponse(t)).json();if(!l.data)throw new Error("Failed to create memory");return l.data}catch(t){throw console.error("Failed to create memory:",t),t}}static async updateMemory(e,o){try{const t=await fetch(`${this.BASE_URL}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,memory_name:o})}),l=await(await this.handleResponse(t)).json();if(!l.data)throw new Error("Failed to update memory");return l.data}catch(t){throw console.error("Failed to update memory:",t),t}}static async deleteMemory(e){try{const o=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE"});await this.handleResponse(o)}catch(o){throw console.error("Failed to delete memory:",o),o}}static async generateConversationId(){try{const e=await fetch(`${this.BASE_URL}/generate-id`),t=await(await this.handleResponse(e)).json();if(!t.data)throw new Error("Failed to generate conversation ID");return t.data}catch(e){throw console.error("Failed to generate conversation ID:",e),e}}}Re(rt,"BASE_URL","/api/memories");const Sl={key:0,class:"app-container"},wl={class:"app-content"},$l={class:"header"},Pl={class:"relative"},kl={class:"title-edit-group"},Cl={id:"main-title",class:"main-title"},El={key:0,id:"title-edit-container",class:"title-edit-container"},Tl={class:"search-bar"},Il={class:"search-container"},Rl=["placeholder"],Al={class:"message-list",id:"message-list"},xl={class:"message-header"},Ml={class:"message-content"},Fl={class:"sender-info"},Dl=["onClick"],Nl={class:"sender-name"},Ul=["onClick"],Ol={class:"action-buttons"},Ll=["onClick"],Bl={class:"action-buttons"},ql=["onClick"],Vl={class:"message-preview"},jl={class:"preview-line"},Gl={key:0,class:"preview-line",style:{opacity:"0.8"}},zl={class:"message-meta"},Jl={class:"message-id"},Hl={class:"meta-right"},Wl={key:0,class:"unread-count"},Kl={class:"message-time"},Xl=["id"],Ql={style:{display:"flex","flex-direction":"column",gap:"0.75rem"}},Yl={class:"bubble-avatar"},Zl={class:"bubble-content"},er={class:"bubble-text"},tr={key:0,class:"empty-state"},sr={class:"modal-content"},or={class:"modal-header"},nr={class:"modal-title"},ar=["placeholder"],lr={id:"name-char-count",class:"char-count",style:{"text-align":"right",display:"block","margin-top":"0.25rem"}},rr={class:"modal-footer"},ir={class:"modal-content"},cr={class:"modal-header"},dr={class:"modal-title"},ur={class:"state-text",id:"delete-message"},pr={class:"modal-footer"},hr=we({__name:"Memory",emits:["memory-selected"],setup(n,{emit:e}){const o=D(!1),t=D(""),a=D([]),l=D([]),d=D(!1),u=D(null),h=D(""),c=D(!1),m=D(null),S=new Map,A=e,L=k=>{k.key==="Escape"&&(c.value?N():d.value&&v())};De(()=>{Ve.setLoadMessages(M),document.addEventListener("keydown",L)}),Ne(()=>{document.removeEventListener("keydown",L)});const M=async()=>{try{const k=await rt.getMemories();a.value=k.map(x=>({...x,expanded:S.has(x.conversation_id)?S.get(x.conversation_id):!1})),l.value=[...a.value],b()}catch(k){console.error("error:",k),a.value=[],l.value=[]}},$=k=>{Ve.selectMemory(k),A("memory-selected")},C=k=>{const x=typeof k=="string"?parseInt(k,10):k;return isNaN(x)||x<=0?"unknow time":new Date(x.toString().length===13?x:x*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(","," ")},b=()=>{const k=t.value.toLowerCase().trim();if(!k){l.value=[...a.value];return}l.value=a.value.filter(x=>{var K;const j=x.memory_name.toLowerCase().includes(k),Z=x.conversation_id.toLowerCase().includes(k),Y=((K=x.messages)==null?void 0:K.some(X=>X.text.toLowerCase().includes(k)))??!1;return j||Z||Y})},y=(k,x)=>{u.value=k,h.value=x,d.value=!0},v=()=>{d.value=!1,u.value=null},_=async()=>{if(!u.value)return;const k=h.value.trim()||"unknow name",x=a.value.findIndex(j=>j.conversation_id===u.value);if(x!==-1){const j=a.value[x];try{const Z=await rt.updateMemory(j.conversation_id,k);Z.messages||(Z.messages=[]),a.value[x]={...Z,expanded:j.expanded},b(),d.value=!1}catch(Z){console.error("error:",Z)}}},f=k=>{const x=a.value.find(j=>j.conversation_id===k);if(x){x.expanded=!x.expanded,S.set(k,x.expanded);const j=l.value.findIndex(Z=>Z.conversation_id===k);j!==-1&&(l.value[j]={...x})}},P=k=>{m.value=k,c.value=!0},N=()=>{c.value=!1,m.value=null},z=async()=>{if(m.value)try{await rt.deleteMemory(m.value),a.value=a.value.filter(k=>k.conversation_id!==m.value),b(),a.value.length===0&&Ve.clearMemoryId(),c.value=!1,m.value=null}catch(k){console.error("error:",k)}};return(k,x)=>(p(),me(Ls,{to:"body"},[E(Nt,{name:"modal"},{default:Ke(()=>[r(Ve).isCollapsed?(p(),g("div",Sl,[s("div",wl,[s("div",$l,[s("div",Pl,[s("div",kl,[s("h1",Cl,[s("span",null,i(k.$t("memory.title")),1)])]),o.value?(p(),g("div",El)):V("",!0)]),s("button",{class:"close-btn",onClick:x[0]||(x[0]=j=>r(Ve).toggleSidebar())},[E(r(T),{icon:"carbon:close"})])]),s("div",Tl,[s("div",Il,[E(r(T),{class:"search-container-icon",icon:"carbon:search"}),de(s("input",{type:"text",placeholder:k.$t("memory.searchPlaceholder"),class:"search-input","onUpdate:modelValue":x[1]||(x[1]=j=>t.value=j),onInput:b},null,40,Rl),[[_e,t.value]])])]),s("div",Al,[s("div",null,[(p(!0),g(ie,null,he(l.value,j=>(p(),g("div",{class:le(["message-item",{expanded:j.expanded}]),key:j.conversation_id},[s("div",xl,[s("div",Ml,[s("div",Fl,[s("div",{class:"sender-div",onClick:Se(Z=>$(j.conversation_id),["stop"])},[s("h3",Nl,i(j.memory_name),1)],8,Dl),s("div",{class:"toggle-container",onClick:Se(Z=>y(j.conversation_id,j.memory_name),["stop"])},[E(r(T),{icon:"carbon:edit",class:"edit-btn"})],8,Ul),s("div",Ol,[s("button",{class:"delete-btn",onClick:Se(Z=>f(j.conversation_id),["stop"])},[E(r(T),{id:"toggle-"+j.conversation_id,icon:"carbon:chevron-down",class:"down-btn"},null,8,["id"])],8,Ll)]),s("div",Bl,[s("button",{class:"delete-btn",onClick:Se(Z=>P(j.conversation_id),["stop"])},[E(r(T),{icon:"carbon:delete"})],8,ql)])]),s("div",Vl,[s("p",jl,i(j.messages&&j.messages.length>0?j.messages[0].text:"none message"),1),j.messages&&j.messages.length>1?(p(),g("p",Gl,i(j.messages[1].text),1)):V("",!0)]),s("div",zl,[s("span",Jl,"ID: "+i(j.conversation_id),1),s("div",Hl,[j.messages&&j.messages.length>0?(p(),g("span",Wl,i(j.messages.length)+" "+i(k.$t("memory.size")),1)):V("",!0),s("span",Kl,i(C(j.create_time)),1)])])])]),j.expanded?(p(),g("div",{key:0,id:"content-"+j.conversation_id,class:"expanded-content"},[s("div",Ql,[(p(!0),g(ie,null,he(j.messages,(Z,Y)=>(p(),g("div",{class:"message-bubble",key:Y},[s("div",Yl,i(Z.messageType),1),s("div",Zl,[s("p",er,i(Z.text),1)])]))),128))])],8,Xl)):V("",!0)],2))),128))]),l.value.length===0&&t.value?(p(),g("div",tr,x[3]||(x[3]=[s("p",{class:"state-text"},"none message",-1)]))):V("",!0)]),d.value?(p(),g("div",{key:0,id:"name-edit-modal",class:"modal-overlay",onClick:Se(v,["self"])},[s("div",sr,[s("div",or,[s("h3",nr,i(k.$t("memory.changeName")),1),de(s("input",{type:"text","onUpdate:modelValue":x[2]||(x[2]=j=>h.value=j),class:"edit-input",placeholder:k.$t("memory.newNamePlaceholder")},null,8,ar),[[_e,h.value]]),s("span",lr,i(h.value.length),1)]),s("div",rr,[s("button",{id:"cancel-name",class:"modal-btn cancel-btn",onClick:v},i(k.$t("memory.cancel")),1),s("button",{id:"save-name",class:"modal-btn confirm-btn",onClick:_},i(k.$t("memory.save")),1)])])])):V("",!0),c.value?(p(),g("div",{key:1,id:"delete-modal",class:"modal-overlay",onClick:Se(N,["self"])},[s("div",ir,[s("div",cr,[s("h3",dr,i(k.$t("memory.deleteHint")),1),s("p",ur,i(k.$t("memory.deleteHintPrefix"))+" "+i(m.value)+" "+i(k.$t("memory.deleteHintSuffix")),1)]),s("div",pr,[s("button",{id:"cancel-delete",class:"modal-btn cancel-btn",onClick:N},i(k.$t("memory.cancel")),1),s("button",{id:"confirm-delete",class:"modal-btn delete-btn-confirm",onClick:z},i(k.$t("memory.delete")),1)])])])):V("",!0)])])):V("",!0)]),_:1})]))}}),mr=$e(hr,[["__scopeId","data-v-4dca2d9f"]]),fr="/api/executor";async function cs(n){try{const e=await fetch(`${fr}/agent-execution/${n}`);if(!e.ok){if(e.status===404)return console.warn(`Agent execution detail not found for stepId: ${n}`),null;throw new Error(`HTTP error! status: ${e.status}`)}return await e.json()}catch(e){return console.error(`Error fetching agent execution detail for stepId: ${n}:`,e),null}}async function gr(n){return console.log(`Refreshing agent execution detail for stepId: ${n}`),cs(n)}class je{static async handleResponse(e){if(!e.ok)try{const o=await e.json();throw new Error(o.message??`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getFileTree(e){try{const o=await fetch(`${this.BASE_URL}/tree/${e}`),a=await(await this.handleResponse(o)).json();if(!a.success)throw new Error(a.message??"Failed to get file tree");return a.data}catch(o){throw console.error("Failed to get file tree:",o),o}}static async getFileContent(e,o){try{const t=await fetch(`${this.BASE_URL}/content/${e}?path=${encodeURIComponent(o)}`),l=await(await this.handleResponse(t)).json();if(!l.success)throw new Error(l.message??"Failed to get file content");return l.data}catch(t){throw console.error("Failed to get file content:",t),t}}static async downloadFile(e,o,t){try{const a=await fetch(`${this.BASE_URL}/download/${e}?path=${encodeURIComponent(o)}`);await this.handleResponse(a);const l=await a.blob(),d=window.URL.createObjectURL(l),u=document.createElement("a");u.href=d,u.download=t??o.split("/").pop()??"download",document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(d),document.body.removeChild(u)}catch(a){throw console.error("Failed to download file:",a),a}}static isTextFile(e,o){const t=["text/","application/json","application/xml","application/javascript","application/typescript"],a=[".txt",".md",".json",".xml",".html",".css",".js",".ts",".vue",".jsx",".tsx",".py",".java",".cpp",".c",".h",".sh",".bat",".yml",".yaml",".properties",".conf",".cfg"];if(t.some(d=>e.startsWith(d)))return!0;const l=o.toLowerCase();return a.some(d=>l.endsWith(d))}static getFileIcon(e){if(e.type==="directory")return"carbon:folder";const o=e.name.toLowerCase();return o.endsWith(".js")?"vscode-icons:file-type-js":o.endsWith(".ts")?"vscode-icons:file-type-typescript":o.endsWith(".vue")?"vscode-icons:file-type-vue":o.endsWith(".java")?"vscode-icons:file-type-java":o.endsWith(".py")?"vscode-icons:file-type-python":o.endsWith(".json")?"vscode-icons:file-type-json":o.endsWith(".xml")?"vscode-icons:file-type-xml":o.endsWith(".html")?"vscode-icons:file-type-html":o.endsWith(".css")?"vscode-icons:file-type-css":o.endsWith(".md")?"vscode-icons:file-type-markdown":o.endsWith(".yml")||o.endsWith(".yaml")?"vscode-icons:file-type-yaml":o.endsWith(".pdf")?"vscode-icons:file-type-pdf2":o.endsWith(".doc")||o.endsWith(".docx")?"vscode-icons:file-type-word":o.endsWith(".xls")||o.endsWith(".xlsx")?"vscode-icons:file-type-excel":o.endsWith(".ppt")||o.endsWith(".pptx")?"vscode-icons:file-type-powerpoint":o.match(/\.(jpg|jpeg|png|gif|bmp|svg)$/)?"carbon:image":o.match(/\.(zip|rar|7z|tar|gz)$/)?"carbon:archive":"carbon:document"}}Re(je,"BASE_URL","/api/file-browser");const vr={class:"file-tree-node"},br={class:"node-icon"},yr={class:"node-name"},_r={key:1,class:"file-size"},Sr={key:2,class:"node-actions"},wr={key:0,class:"children"},$r=we({__name:"FileTreeNode",props:{node:{},level:{}},emits:["file-selected","download-file"],setup(n,{emit:e}){const o=n,t=e,a=D(o.level===0),l=D(!1),d=D(!1),u=D({}),h=()=>{o.node.type==="directory"&&(a.value=!a.value)},c=()=>{o.node.type==="directory"?h():m()},m=()=>{o.node.type==="file"&&t("file-selected",o.node),L()},S=()=>{t("download-file",o.node),L()},A=b=>{b.preventDefault(),d.value=!0,u.value={position:"fixed",top:`${b.clientY}px`,left:`${b.clientX}px`,zIndex:1e3},setTimeout(()=>{document.addEventListener("click",L)},0)},L=()=>{d.value=!1,document.removeEventListener("click",L)},M=async()=>{try{await navigator.clipboard.writeText(o.node.path)}catch(b){console.error("Failed to copy path:",b)}L()},$=()=>o.node.type==="directory"?a.value?"carbon:folder-open":"carbon:folder":je.getFileIcon(o.node),C=b=>{if(b===0)return"0 B";const y=1024,v=["B","KB","MB","GB"],_=Math.floor(Math.log(b)/Math.log(y));return parseFloat((b/Math.pow(y,_)).toFixed(1))+" "+v[_]};return Ne(()=>{document.removeEventListener("click",L)}),(b,y)=>{const v=ss("FileTreeNode",!0);return p(),g("div",vr,[s("div",{class:le(["node-content",{"is-directory":b.node.type==="directory","is-file":b.node.type==="file","is-expanded":a.value}]),style:We({paddingLeft:`${b.level*16+12}px`}),onClick:c,onContextmenu:Se(A,["prevent"])},[b.node.type==="directory"?(p(),g("div",{key:0,class:"expand-icon",onClick:Se(h,["stop"])},[E(r(T),{icon:a.value?"carbon:chevron-down":"carbon:chevron-right",class:"chevron-icon"},null,8,["icon"])])):V("",!0),s("div",br,[E(r(T),{icon:$()},null,8,["icon"])]),s("span",yr,i(b.node.name),1),b.node.type==="file"?(p(),g("span",_r,i(C(b.node.size)),1)):V("",!0),l.value?(p(),g("div",Sr,[b.node.type==="file"?(p(),g("button",{key:0,onClick:y[0]||(y[0]=Se(_=>b.$emit("download-file",b.node),["stop"])),class:"action-btn download-btn",title:"Download"},[E(r(T),{icon:"carbon:download"})])):V("",!0)])):V("",!0)],38),b.node.type==="directory"&&a.value&&b.node.children?(p(),g("div",wr,[(p(!0),g(ie,null,he(b.node.children,_=>(p(),me(v,{key:_.path,node:_,level:b.level+1,onFileSelected:y[1]||(y[1]=f=>b.$emit("file-selected",f)),onDownloadFile:y[2]||(y[2]=f=>b.$emit("download-file",f))},null,8,["node","level"]))),128))])):V("",!0),d.value?(p(),g("div",{key:1,class:"context-menu",style:We(u.value),onClick:y[3]||(y[3]=Se(()=>{},["stop"]))},[s("div",{class:"context-menu-item",onClick:m},[E(r(T),{icon:"carbon:view"}),y[4]||(y[4]=s("span",null,"Open",-1))]),b.node.type==="file"?(p(),g("div",{key:0,class:"context-menu-item",onClick:S},[E(r(T),{icon:"carbon:download"}),y[5]||(y[5]=s("span",null,"Download",-1))])):V("",!0),y[7]||(y[7]=s("div",{class:"context-menu-divider"},null,-1)),s("div",{class:"context-menu-item",onClick:M},[E(r(T),{icon:"carbon:copy"}),y[6]||(y[6]=s("span",null,"Copy Path",-1))])],4)):V("",!0)])}}}),Pr=$e($r,[["__scopeId","data-v-e4a376d5"]]),kr={class:"file-browser"},Cr={class:"file-browser-header"},Er={class:"header-actions"},Tr=["disabled","title"],Ir={class:"file-browser-content"},Rr={class:"file-tree-panel"},Ar={key:0,class:"loading-state"},xr={key:1,class:"error-state"},Mr={key:0,class:"waiting-for-files"},Fr={class:"message-content"},Dr={class:"tips"},Nr=["disabled"],Ur={key:1,class:"actual-error"},Or={key:2,class:"empty-state"},Lr={key:3,class:"file-tree"},Br={key:0,class:"file-content-panel"},qr={class:"file-content-header"},Vr={class:"file-info"},jr={class:"file-name"},Gr={class:"file-size"},zr={class:"file-actions"},Jr=["title"],Hr=["title"],Wr={class:"file-content-body"},Kr={key:0,class:"loading-content"},Xr={key:1,class:"content-error"},Qr={key:2,class:"file-content"},Yr={key:0,class:"text-content"},Zr={key:1,class:"binary-content"},ei=we({__name:"index",props:{planId:{}},setup(n){const e=n,{t:o}=Ue(),t=D(!1),a=D(null),l=D(null),d=D(null),u=D(null),h=D(!1),c=D(null),m=D(null),S=fe(()=>!u.value||!d.value?!1:je.isTextFile(u.value.mimeType,d.value.name)),A=fe(()=>a.value&&(a.value.includes("Plan directory not found")||a.value.includes("not found"))),L=()=>{m.value&&(clearTimeout(m.value),m.value=null)},M=()=>{L(),m.value=window.setTimeout(()=>{A.value&&$()},5e3)},$=async()=>{if(e.planId){t.value=!0,a.value=null,L();try{l.value=await je.getFileTree(e.planId)}catch(f){a.value=f instanceof Error?f.message:o("fileBrowser.loadError"),console.error("Failed to load file tree:",f);const P=f instanceof Error?f.message:"";(P.includes("Plan directory not found")||P.includes("not found"))&&M()}finally{t.value=!1}}},C=async f=>{if(f.type!=="directory"){d.value=f,u.value=null,h.value=!0,c.value=null;try{u.value=await je.getFileContent(e.planId,f.path)}catch(P){c.value=P instanceof Error?P.message:o("fileBrowser.contentLoadError"),console.error("Failed to load file content:",P)}finally{h.value=!1}}},b=async f=>{try{await je.downloadFile(e.planId,f.path,f.name)}catch(P){console.error("Failed to download file:",P)}},y=()=>{d.value=null,u.value=null,c.value=null},v=f=>je.getFileIcon(f),_=f=>{if(f===0)return"0 B";const P=1024,N=["B","KB","MB","GB"],z=Math.floor(Math.log(f)/Math.log(P));return parseFloat((f/Math.pow(P,z)).toFixed(1))+" "+N[z]};return pe(()=>e.planId,f=>{f&&(d.value=null,u.value=null,$())},{immediate:!0}),De(()=>{e.planId&&$()}),Ne(()=>{L()}),(f,P)=>(p(),g("div",kr,[s("div",Cr,[s("h3",null,i(f.$t("fileBrowser.title")),1),s("div",Er,[s("button",{class:"refresh-btn",onClick:$,disabled:t.value,title:f.$t("fileBrowser.refresh")},[E(r(T),{icon:"carbon:refresh",class:le({rotating:t.value}),style:{color:"#ffffff",fontSize:"18px",width:"18px",height:"18px"}},null,8,["class"])],8,Tr)])]),s("div",Ir,[s("div",Rr,[t.value?(p(),g("div",Ar,[E(r(T),{icon:"carbon:loading",class:"rotating"}),s("span",null,i(f.$t("fileBrowser.loading")),1)])):a.value?(p(),g("div",xr,[A.value?(p(),g("div",Mr,[E(r(T),{icon:"carbon:time",class:"rotating"}),s("div",Fr,[s("h3",null,i(f.$t("fileBrowser.waitingForGeneration")),1),s("p",null,i(f.$t("fileBrowser.planExecuting")),1),s("div",Dr,[E(r(T),{icon:"carbon:information"}),s("span",null,i(f.$t("fileBrowser.filesTip")),1)])]),s("button",{onClick:$,class:"retry-btn",disabled:t.value},[E(r(T),{icon:"carbon:refresh",class:le({rotating:t.value})},null,8,["class"]),re(" "+i(t.value?f.$t("fileBrowser.checking"):f.$t("fileBrowser.checkNow")),1)],8,Nr)])):(p(),g("div",Ur,[E(r(T),{icon:"carbon:warning"}),s("span",null,i(a.value),1),s("button",{onClick:$,class:"retry-btn"},i(f.$t("fileBrowser.retry")),1)]))])):l.value?(p(),g("div",Lr,[E(Pr,{node:l.value,level:0,onFileSelected:C,onDownloadFile:b},null,8,["node"])])):(p(),g("div",Or,[E(r(T),{icon:"carbon:folder-off"}),s("span",null,i(f.$t("fileBrowser.noFiles")),1)]))]),d.value?(p(),g("div",Br,[s("div",qr,[s("div",Vr,[E(r(T),{icon:v(d.value)},null,8,["icon"]),s("span",jr,i(d.value.name),1),s("span",Gr,"("+i(_(d.value.size))+")",1)]),s("div",zr,[s("button",{onClick:P[0]||(P[0]=N=>b(d.value)),class:"download-btn",title:f.$t("fileBrowser.download")},[E(r(T),{icon:"carbon:download"})],8,Jr),s("button",{onClick:y,class:"close-btn",title:f.$t("common.close")},[E(r(T),{icon:"carbon:close"})],8,Hr)])]),s("div",Wr,[h.value?(p(),g("div",Kr,[E(r(T),{icon:"carbon:loading",class:"rotating"}),s("span",null,i(f.$t("fileBrowser.loadingContent")),1)])):c.value?(p(),g("div",Xr,[E(r(T),{icon:"carbon:warning"}),s("span",null,i(c.value),1)])):u.value?(p(),g("div",Qr,[S.value?(p(),g("div",Yr,[s("pre",null,[s("code",null,i(u.value.content),1)])])):(p(),g("div",Zr,[E(r(T),{icon:"carbon:document-unknown"}),s("p",null,i(f.$t("fileBrowser.binaryFile")),1),s("button",{onClick:P[1]||(P[1]=N=>b(d.value)),class:"download-btn-large"},[E(r(T),{icon:"carbon:download"}),re(" "+i(f.$t("fileBrowser.downloadToView")),1)])]))])):V("",!0)])])):V("",!0)])]))}}),ti=$e(ei,[["__scopeId","data-v-e7c74fe4"]]),si={class:"right-panel"},oi={class:"preview-header"},ni={class:"preview-tabs"},ai={class:"preview-content"},li={key:0,class:"step-details"},ri={key:0,class:"step-info"},ii={key:0,class:"agent-info"},ci={class:"info-item"},di={class:"label"},ui={class:"value"},pi={class:"info-item"},hi={class:"label"},mi={class:"value"},fi={class:"info-item"},gi={class:"label"},vi={class:"execution-status"},bi={class:"status-item"},yi={class:"status-text"},_i={key:0},Si={key:0,class:"think-act-steps"},wi={class:"steps-container"},$i={class:"step-header"},Pi={class:"step-number"},ki={class:"think-section"},Ci={class:"think-content"},Ei={class:"input"},Ti={class:"label"},Ii={class:"output"},Ri={class:"label"},Ai={key:0,class:"action-section"},xi={class:"action-content"},Mi={class:"tool-info"},Fi={class:"label"},Di={class:"value"},Ni={class:"input"},Ui={class:"label"},Oi={class:"output"},Li={class:"label"},Bi={key:0,class:"sub-plan-section"},qi={class:"sub-plan-content"},Vi={class:"sub-plan-header"},ji={class:"sub-plan-info"},Gi={class:"label"},zi={class:"value"},Ji={key:0,class:"sub-plan-info"},Hi={class:"label"},Wi={class:"value"},Ki={class:"sub-plan-status"},Xi={class:"status-text"},Qi={key:0,class:"no-steps-message"},Yi={key:1,class:"no-execution-message"},Zi={class:"step-basic-info"},ec={class:"info-item"},tc={class:"label"},sc={class:"value"},oc={key:0,class:"info-item"},nc={class:"label"},ac={class:"value"},lc={class:"info-item"},rc={class:"label"},ic={class:"no-execution-hint"},cc={key:2,class:"execution-indicator"},dc={class:"execution-text"},uc={key:1,class:"no-selection"},pc=["title"],hc={key:1,class:"file-browser-container"},mc={key:1,class:"no-plan-message"},fc={class:"message-content"},gc={class:"tips"},vc=we({__name:"RightPanel",props:{currentRootPlanId:{},selectedStepId:{}},setup(n,{expose:e}){const o=n,{t}=Ue(),a=D(),l=D(),d=D("details"),u=D(localStorage.getItem("jmanus-last-plan-id")),h=D(localStorage.getItem("jmanus-has-executed-plan")==="true"),c=D(!1),m=D(!0),S=D(!0),A=fe(()=>l.value?l.value.completed?t("rightPanel.status.completed"):l.value.current?t("rightPanel.status.executing"):t("rightPanel.status.waiting"):""),L=fe(()=>o.currentRootPlanId?o.currentRootPlanId:u.value),M=fe(()=>!L.value&&!h.value),$=async k=>{var x,j,Z;if(console.log("[RightPanel] Step selected:",{stepId:k}),!k){console.warn("[RightPanel] No stepId provided"),l.value=null;return}try{const Y=await cs(k);if(!Y){console.warn("[RightPanel] Agent execution detail not found for stepId:",k),l.value=null;return}const K={stepId:k,title:Y.agentName??`Step ${k}`,description:Y.agentDescription??"",agentExecution:Y,completed:Y.status==="FINISHED",current:Y.status==="RUNNING"};l.value=K,console.log("[RightPanel] Step details updated:",K),console.log("[RightPanel] activeTab:",d.value),console.log("[RightPanel] selectedStep.value:",l.value),console.log("[RightPanel] agentExecution:",l.value.agentExecution),console.log("[RightPanel] thinkActSteps:",(x=l.value.agentExecution)==null?void 0:x.thinkActSteps),console.log("[RightPanel] thinkActSteps length:",(Z=(j=l.value.agentExecution)==null?void 0:j.thinkActSteps)==null?void 0:Z.length),await Ae(),console.log("[RightPanel] After nextTick - selectedStep:",l.value),setTimeout(()=>{y()},100),_()}catch(Y){console.error("[RightPanel] Error fetching step details:",Y),l.value=null}},C=async()=>{var k;if(!((k=l.value)!=null&&k.stepId)){console.warn("[RightPanel] No step selected for refresh");return}console.log("[RightPanel] Refreshing current step:",l.value.stepId);try{const x=await gr(l.value.stepId);x&&(l.value.agentExecution=x,l.value.completed=x.status==="FINISHED",l.value.current=x.status==="RUNNING",console.log("[RightPanel] Step refreshed successfully"),_())}catch(x){console.error("[RightPanel] Error refreshing step:",x)}};pe(()=>o.selectedStepId,async k=>{k?await $(k):l.value=null},{immediate:!0});const b=k=>{a.value=k??void 0},y=()=>{if(!a.value)return;const{scrollTop:k,scrollHeight:x,clientHeight:j}=a.value,Z=x-k-j<50,Y=x>j;m.value=Z,c.value=Y&&!Z,Z?S.value=!0:x-k-j>100&&(S.value=!1),console.log("[RightPanel] Scroll state check:",{scrollTop:k,scrollHeight:x,clientHeight:j,isAtBottom:Z,hasScrollableContent:Y,showButton:c.value,shouldAutoScroll:S.value})},v=()=>{a.value&&(a.value.scrollTo({top:a.value.scrollHeight,behavior:"smooth"}),Ae(()=>{S.value=!0,y()}))},_=()=>{!S.value||!a.value||Ae(()=>{a.value&&(a.value.scrollTop=a.value.scrollHeight,console.log("[RightPanel] Auto scroll to bottom"))})},f=k=>{if(k===null||typeof k>"u"||k==="")return"N/A";try{const x=typeof k=="object"?k:JSON.parse(k);return JSON.stringify(x,null,2)}catch{return String(k)}},P=()=>{l.value=null,S.value=!0,a.value&&a.value.removeEventListener("scroll",y)},N=()=>{const k=()=>{const x=a.value;return x?(b(x),x.addEventListener("scroll",y),S.value=!0,y(),console.log("[RightPanel] Scroll listener initialized successfully"),!0):(console.log("[RightPanel] Scroll container not found, retrying..."),!1)};Ae(()=>{k()||setTimeout(()=>{k()},100)})};return pe(()=>o.currentRootPlanId,(k,x)=>{k&&k!==x?(u.value=k,h.value=!0,localStorage.setItem("jmanus-last-plan-id",k),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] New plan started:",k)):!k&&x&&console.log("[RightPanel] Plan execution finished, keeping last plan:",u.value)},{immediate:!0}),De(()=>{console.log("[RightPanel] Component mounted"),Ae(()=>{N()})}),Ne(()=>{console.log("[RightPanel] Component unmounting, cleaning up..."),P()}),e({handleStepSelected:$,refreshCurrentStep:C,updateDisplayedPlanProgress:k=>{console.log("[RightPanel] updateDisplayedPlanProgress called with rootPlanId:",k),k&&(u.value=k,h.value=!0,localStorage.setItem("jmanus-last-plan-id",k),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] Plan progress updated:",k))}}),(k,x)=>{var j,Z;return p(),g("div",si,[s("div",oi,[s("div",ni,[s("div",{class:le(["tab-item",{active:d.value==="details"}]),onClick:x[0]||(x[0]=Y=>d.value="details")},[E(r(T),{icon:"carbon:events"}),s("span",null,i(r(t)("rightPanel.stepExecutionDetails")),1)],2),s("div",{class:le(["tab-item",{active:d.value==="files"}]),onClick:x[1]||(x[1]=Y=>d.value="files")},[E(r(T),{icon:"carbon:folder"}),s("span",null,i(r(t)("fileBrowser.title")),1)],2)])]),s("div",ai,[d.value==="details"?(p(),g("div",li,[l.value?(p(),g("div",ri,[s("h3",null,i(l.value.title||l.value.description||r(t)("rightPanel.defaultStepTitle",{number:1})),1),l.value.agentExecution?(p(),g("div",ii,[s("div",ci,[s("span",di,i(r(t)("rightPanel.executingAgent"))+":",1),s("span",ui,i(l.value.agentExecution.agentName),1)]),s("div",pi,[s("span",hi,i(r(t)("rightPanel.callingModel"))+":",1),s("span",mi,i(l.value.agentExecution.modelName),1)]),s("div",fi,[s("span",gi,i(r(t)("rightPanel.executionResult"))+":",1),s("span",{class:le(["value",{success:l.value.agentExecution.status==="FINISHED"}])},i(l.value.agentExecution.status||r(t)("rightPanel.executing")),3)])])):V("",!0),s("div",vi,[s("div",bi,[l.value.completed?(p(),me(r(T),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):l.value.current?(p(),me(r(T),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})):(p(),me(r(T),{key:2,icon:"carbon:time",class:"status-icon pending"})),s("span",yi,i(A.value),1)])])])):V("",!0),s("div",{ref_key:"scrollContainer",ref:a,class:"step-details-scroll-container",onScroll:y},[l.value?(p(),g("div",_i,[(j=l.value.agentExecution)!=null&&j.thinkActSteps&&l.value.agentExecution.thinkActSteps.length>0?(p(),g("div",Si,[s("h4",null,i(r(t)("rightPanel.thinkAndActionSteps")),1),s("div",wi,[(p(!0),g(ie,null,he(l.value.agentExecution.thinkActSteps,(Y,K)=>(p(),g("div",{key:K,class:"think-act-step"},[s("div",$i,[s("span",Pi,"#"+i(K+1),1),s("span",{class:le(["step-status",Y.status])},i(Y.status||r(t)("rightPanel.executing")),3)]),s("div",ki,[s("h5",null,[E(r(T),{icon:"carbon:thinking"}),re(" "+i(r(t)("rightPanel.thinking")),1)]),s("div",Ci,[s("div",Ei,[s("span",Ti,i(r(t)("rightPanel.input"))+":",1),s("pre",null,i(f(Y.thinkInput)),1)]),s("div",Ii,[s("span",Ri,i(r(t)("rightPanel.output"))+":",1),s("pre",null,i(f(Y.thinkOutput)),1)])])]),Y.actionNeeded?(p(),g("div",Ai,[s("h5",null,[E(r(T),{icon:"carbon:play"}),re(" "+i(r(t)("rightPanel.action")),1)]),s("div",xi,[(p(!0),g(ie,null,he(Y.actToolInfoList,(X,ne)=>(p(),g("div",{key:ne},[s("div",Mi,[s("span",Fi,i(r(t)("rightPanel.tool"))+":",1),s("span",Di,i(X.name||""),1)]),s("div",Ni,[s("span",Ui,i(r(t)("rightPanel.toolParameters"))+":",1),s("pre",null,i(f(X.parameters)),1)]),s("div",Oi,[s("span",Li,i(r(t)("rightPanel.executionResult"))+":",1),s("pre",null,i(f(X.result)),1)])]))),128))]),Y.subPlanExecutionRecord?(p(),g("div",Bi,[s("h5",null,[E(r(T),{icon:"carbon:tree-view"}),re(" "+i(r(t)("rightPanel.subPlan")),1)]),s("div",qi,[s("div",Vi,[s("div",ji,[s("span",Gi,i(k.$t("rightPanel.subPlanId"))+":",1),s("span",zi,i(Y.subPlanExecutionRecord.currentPlanId),1)]),Y.subPlanExecutionRecord.title?(p(),g("div",Ji,[s("span",Hi,i(k.$t("rightPanel.title"))+":",1),s("span",Wi,i(Y.subPlanExecutionRecord.title),1)])):V("",!0),s("div",Ki,[Y.subPlanExecutionRecord.completed?(p(),me(r(T),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):(p(),me(r(T),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})),s("span",Xi,i(Y.subPlanExecutionRecord.completed?k.$t("rightPanel.status.completed"):k.$t("rightPanel.status.executing")),1)])])])])):V("",!0)])):V("",!0)]))),128))]),l.value.agentExecution&&!((Z=l.value.agentExecution.thinkActSteps)!=null&&Z.length)?(p(),g("div",Qi,[s("p",null,i(r(t)("rightPanel.noStepDetails")),1)])):l.value.agentExecution?V("",!0):(p(),g("div",Yi,[E(r(T),{icon:"carbon:information",class:"info-icon"}),s("h4",null,i(r(t)("rightPanel.stepInfo")),1),s("div",Zi,[s("div",ec,[s("span",tc,i(r(t)("rightPanel.stepName"))+":",1),s("span",sc,i(l.value.title||l.value.description||l.value.stepId),1)]),l.value.description?(p(),g("div",oc,[s("span",nc,i(k.$t("rightPanel.description"))+":",1),s("span",ac,i(l.value.description),1)])):V("",!0),s("div",lc,[s("span",rc,i(k.$t("rightPanel.status.label"))+":",1),s("span",{class:le(["value",{"status-completed":l.value.completed,"status-current":l.value.current,"status-pending":!l.value.completed&&!l.value.current}])},i(l.value.completed?k.$t("rightPanel.status.completed"):l.value.current?k.$t("rightPanel.status.executing"):k.$t("rightPanel.status.pending")),3)])]),s("p",ic,i(r(t)("rightPanel.noExecutionInfo")),1)])),l.value.current&&!l.value.completed?(p(),g("div",cc,[x[2]||(x[2]=s("div",{class:"execution-waves"},[s("div",{class:"wave wave-1"}),s("div",{class:"wave wave-2"}),s("div",{class:"wave wave-3"})],-1)),s("p",dc,[E(r(T),{icon:"carbon:in-progress",class:"rotating-icon"}),re(" "+i(r(t)("rightPanel.stepExecuting")),1)])])):V("",!0)])):(p(),g("div",uc,[E(r(T),{icon:"carbon:events",class:"empty-icon"}),s("h3",null,i(r(t)("rightPanel.noStepSelected")),1),s("p",null,i(r(t)("rightPanel.selectStepHint")),1)]))])):V("",!0),E(Nt,{name:"scroll-button"},{default:Ke(()=>[c.value?(p(),g("button",{key:0,onClick:v,class:"scroll-to-bottom-btn",title:r(t)("rightPanel.scrollToBottom")},[E(r(T),{icon:"carbon:chevron-down"})],8,pc)):V("",!0)]),_:1})],544)])):V("",!0),d.value==="files"?(p(),g("div",hc,[L.value?(p(),me(ti,{key:0,"plan-id":L.value},null,8,["plan-id"])):M.value?(p(),g("div",mc,[E(r(T),{icon:"carbon:folder-off"}),s("div",fc,[s("h3",null,i(r(t)("fileBrowser.noFilesYet")),1),s("p",null,i(r(t)("fileBrowser.noPlanExecuting")),1),s("div",gc,[E(r(T),{icon:"carbon:information"}),s("span",null,i(r(t)("fileBrowser.startTaskTip")),1)])])])):V("",!0)])):V("",!0)])])}}}),bc=$e(vc,[["__scopeId","data-v-3ea813c1"]]);class Ot{static async getParameterRequirements(e){try{const o=await fetch(`${this.BASE_URL}/${e}/parameters`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error(`Failed to get parameter requirements: ${o.statusText}`);return await o.json()}catch(o){throw console.error("Error getting parameter requirements:",o),o}}}Re(Ot,"BASE_URL","/api/plan-template");const yc={class:"modal-form wide-modal"},_c={class:"form-section"},Sc={class:"form-item"},wc=["placeholder"],$c={class:"field-description"},Pc={class:"form-section"},kc={class:"form-item"},Cc=["placeholder"],Ec={class:"field-description"},Tc={class:"form-section"},Ic={class:"form-item"},Rc={class:"service-group-autocomplete"},Ac=["placeholder"],xc={key:0,class:"service-group-dropdown"},Mc=["onMousedown"],Fc={class:"field-description"},Dc={class:"form-section"},Nc={class:"section-title"},Uc={key:0,class:"params-help-text"},Oc={class:"parameter-table"},Lc=["onUpdate:modelValue","placeholder","readonly"],Bc=["onUpdate:modelValue","placeholder"],qc={class:"form-section"},Vc={class:"service-publish-options"},jc={class:"internal-toolcall-publish-option"},Gc={class:"checkbox-label"},zc={class:"checkbox-text"},Jc={class:"checkbox-description"},Hc={class:"http-publish-option"},Wc={class:"checkbox-label"},Kc={class:"checkbox-text"},Xc={class:"checkbox-description"},Qc={class:"button-container"},Yc=["disabled"],Zc=["disabled"],ed=we({__name:"PublishServiceModal",props:{modelValue:{type:Boolean,default:!1},planTemplateId:{default:""},planDescription:{default:""}},emits:["update:modelValue","published"],setup(n,{expose:e,emit:o}){const{t}=Ue(),a=n,l=o,d=fe({get:()=>a.modelValue,set:H=>l("update:modelValue",H)}),u=D(""),h=D(""),c=D(!1),m=D(!1),S=D(null),A=D(!1),L=D(!1),M=D(!0),$=D({parameters:[],hasParameters:!1,requirements:""}),C=D(!1),b=D(!1),y=D([]),v=D(!1),_=nt({serviceName:"",userRequest:"",endpoint:"",serviceGroup:"",parameters:[]}),f=fe(()=>{const H=_.serviceGroup.trim();if(!H)return y.value;const G=H.toLowerCase();return y.value.filter(U=>U.toLowerCase().includes(G))}),P=fe(()=>{var G;const H=(G=S.value)==null?void 0:G.id;return t(H?"mcpService.updateService":"mcpService.createService")}),N=()=>{_.serviceName="",_.userRequest=a.planDescription||"",_.endpoint="",_.serviceGroup="",$.value.hasParameters||(_.parameters=[]),S.value=null,A.value=!1};pe(()=>_.userRequest,H=>{const G=H.trim();G&&(_.serviceName.trim()||(_.serviceName=G))});const z=async()=>{if(!v.value){v.value=!0;try{const H=await zs.getAvailableTools(),G=new Set;H.forEach(U=>{U.serviceGroup&&G.add(U.serviceGroup)}),y.value=Array.from(G).sort()}catch(H){console.error("[PublishModal] Failed to load service groups:",H),y.value=[]}finally{v.value=!1}}},k=()=>{b.value=!0},x=()=>{setTimeout(()=>{b.value=!1},200)},j=H=>{_.serviceGroup=H,b.value=!1},Z=async()=>{if(!a.planTemplateId){$.value={parameters:[],hasParameters:!1,requirements:""};return}C.value=!0;try{const H=await Ot.getParameterRequirements(a.planTemplateId);$.value=H,H.hasParameters&&(_.parameters=H.parameters.map(G=>({name:G,description:""})))}catch(H){console.error("[PublishModal] Failed to load parameter requirements:",H),H instanceof Error&&!H.message.includes("404")&&console.warn("[PublishModal] Parameter requirements not available yet, will retry later"),$.value={parameters:[],hasParameters:!1,requirements:""}}finally{C.value=!1}},Y=(H,G)=>{G==="success"?(h.value=H,setTimeout(()=>{h.value=""},3e3)):G==="error"&&(u.value=H,setTimeout(()=>{u.value=""},5e3))},K=()=>{if(!_.serviceName.trim())return Y(t("mcpService.toolNameRequiredError"),"error"),!1;if(!_.userRequest.trim())return Y(t("mcpService.toolDescriptionRequiredError"),"error"),!1;if(!_.serviceGroup.trim())return Y(t("mcpService.serviceGroupRequiredError"),"error"),!1;if(!M.value&&!L.value)return Y("Please select at least one service type","error"),!1;for(let H=0;H<_.parameters.length;H++){const G=_.parameters[H];if(G.name&&!G.description.trim())return Y(`Parameter "${G.name}" description cannot be empty`,"error"),!1;if(G.description&&!G.name.trim())return Y(`Parameter description "${G.description}" corresponding name cannot be empty`,"error"),!1}return!0},X=async()=>{if(console.log("[PublishModal] Starting to handle publish request"),console.log("[PublishModal] Form data:",_),console.log("[PublishModal] Current tool:",S.value),console.log("[PublishModal] Publish as HTTP service:",L.value),!K()){console.log("[PublishModal] Form validation failed");return}c.value=!0;try{if(!S.value){console.log("[PublishModal] No current tool data, getting existing tool or creating default");const U=await Oe.getCoordinatorToolByTemplate(a.planTemplateId);U?S.value=U:S.value=Oe.createDefaultCoordinatorTool(a.planTemplateId,void 0,a.planDescription)}console.log("[PublishModal] Updating tool information"),S.value.toolName=_.serviceName.trim(),S.value.toolDescription=_.userRequest.trim(),S.value.serviceGroup=_.serviceGroup.trim(),S.value.planTemplateId=a.planTemplateId,S.value.enableInternalToolcall=M.value,S.value.enableHttpService=L.value,S.value.enableMcpService=!1,S.value.mcpEndpoint=void 0;const H=_.parameters.filter(U=>U.name.trim()&&U.description.trim()).map(U=>({name:U.name.trim(),description:U.description.trim(),type:"string"}));if(S.value.inputSchema=JSON.stringify(H),console.log("[PublishModal] Updated tool information:",S.value),S.value.id)console.log("[PublishModal] Updating existing tool, ID:",S.value.id),await Oe.updateCoordinatorTool(S.value.id,S.value);else{console.log("[PublishModal] Creating new tool");const U=await Oe.createCoordinatorTool(S.value);S.value=U}const G=[];if(M.value&&G.push("Internal Method Call"),L.value&&G.push("HTTP Service"),G.length>0){console.log("[PublishModal] Step 5: Publishing service, ID:",S.value.id,"Enabled services:",G.join(", "));const U=[];M.value&&U.push(`Internal Call: ${_.serviceName}`),console.log("[PublishModal] Service published successfully"),Y(t("mcpService.publishSuccess"),"success"),l("published",S.value)}else console.log("[PublishModal] Only saving tool, not publishing as any service"),Y(t("mcpService.saveSuccess"),"success"),l("published",S.value)}catch(H){console.error("[PublishModal] Failed to publish service:",H),Y(t("mcpService.publishFailed")+": "+H.message,"error")}finally{c.value=!1}},ne=async()=>{var H;if(!m.value&&confirm(t("mcpService.deleteConfirmMessage"))){if(!((H=S.value)!=null&&H.id)){Y(t("mcpService.deleteFailed")+": "+t("mcpService.selectPlanTemplateFirst"),"error");return}m.value=!0;try{console.log("[PublishModal] Starting to delete MCP service, ID:",S.value.id);const G=await Oe.deleteCoordinatorTool(S.value.id);if(G.success)console.log("[PublishModal] Deleted successfully"),Y(t("mcpService.deleteSuccess"),"success"),d.value=!1,l("published",null);else throw new Error(G.message)}catch(G){console.error("[PublishModal] Failed to delete MCP service:",G),Y(t("mcpService.deleteFailed")+": "+G.message,"error")}finally{m.value=!1}}},ge=async()=>{d.value&&(console.log("[PublishModal] Modal opened, starting to initialize data"),N(),await ke())},ke=async()=>{if(!a.planTemplateId){console.log("[PublishModal] "+t("mcpService.noPlanTemplateId"));return}try{console.log("[PublishModal] Starting to load coordinator tool data, planTemplateId:",a.planTemplateId);const H=await Oe.getCoordinatorToolByTemplate(a.planTemplateId);let G;H?(G=H,console.log("[PublishModal] Found existing coordinator tool:",G)):(G=Oe.createDefaultCoordinatorTool(a.planTemplateId,void 0,a.planDescription),console.log("[PublishModal] Created default coordinator tool VO:",G)),S.value=G,A.value=!!G.id;const U=[];if(G.enableMcpService&&G.mcpEndpoint){const R=window.location.origin;U.push(`MCP: ${R}/mcp${G.mcpEndpoint}`)}G.enableInternalToolcall&&U.push(`Internal Call: ${G.toolName}`),console.log("[PublishModal] Load tool data completed"),_.serviceName=G.toolName||"",_.userRequest=G.toolDescription||a.planDescription||"",_.serviceGroup=G.serviceGroup??"",L.value=G.enableHttpService??!1,M.value=G.enableInternalToolcall??!1;try{if(G.inputSchema){const R=JSON.parse(G.inputSchema);Array.isArray(R)&&R.length>0?(_.parameters=R.map(O=>({name:O.name||"",description:O.description||""})),console.log("[PublishModal] Load parameters from inputSchema:",_.parameters)):console.log("[PublishModal] inputSchema is empty, keeping existing parameters:",_.parameters)}}catch(R){console.warn("[PublishModal] "+t("mcpService.parseInputSchemaFailed")+":",R),console.log("[PublishModal] Parsing failed, keeping existing parameters:",_.parameters)}console.log("[PublishModal] Form data filled:",_)}catch(H){console.error("[PublishModal] "+t("mcpService.loadToolDataFailed")+":",H),Y(t("mcpService.loadToolDataFailed")+": "+H.message,"error")}};return pe(()=>a.modelValue,ge),pe(()=>a.planTemplateId,(H,G)=>{H&&H!==G&&(G&&H.startsWith("planTemplate-")?setTimeout(()=>{Z()},1e3):Z())}),pe(d,H=>{H&&z()}),De(async()=>{d.value&&(console.log("[PublishModal] Initialize when component mounted"),N(),await ke(),await Z())}),e({loadParameterRequirements:Z}),(H,G)=>(p(),g(ie,null,[E(as,{modelValue:d.value,"onUpdate:modelValue":G[6]||(G[6]=U=>d.value=U),title:P.value,onConfirm:X},{footer:Ke(()=>{var U;return[s("div",Qc,[A.value&&((U=S.value)!=null&&U.id)?(p(),g("button",{key:0,class:"action-btn danger",onClick:ne,disabled:m.value},[m.value?(p(),me(r(T),{key:0,icon:"carbon:loading",class:"loading-icon"})):(p(),me(r(T),{key:1,icon:"carbon:trash-can"})),re(" "+i(m.value?r(t)("mcpService.deleting"):r(t)("mcpService.delete")),1)],8,Yc)):V("",!0),s("button",{class:"action-btn primary",onClick:X,disabled:c.value},[c.value?(p(),me(r(T),{key:0,icon:"carbon:loading",class:"loading-icon"})):(p(),me(r(T),{key:1,icon:"carbon:cloud-upload"})),re(" "+i(c.value?r(t)("mcpService.publishing"):r(t)("mcpService.publishAsService")),1)],8,Zc)])]}),default:Ke(()=>[s("div",yc,[s("div",_c,[s("div",Sc,[s("label",null,i(r(t)("mcpService.toolNameRequired")),1),de(s("input",{type:"text","onUpdate:modelValue":G[0]||(G[0]=U=>_.serviceName=U),placeholder:r(t)("mcpService.toolNamePlaceholder"),class:le({error:!_.serviceName||!_.serviceName.trim()}),required:""},null,10,wc),[[_e,_.serviceName]]),s("div",$c,i(r(t)("mcpService.toolNameDescription")),1)])]),s("div",Pc,[s("div",kc,[s("label",null,i(r(t)("mcpService.toolDescriptionRequired")),1),de(s("textarea",{"onUpdate:modelValue":G[1]||(G[1]=U=>_.userRequest=U),placeholder:r(t)("mcpService.toolDescriptionPlaceholder"),class:le([{error:!_.userRequest||!_.userRequest.trim()},"description-field"]),rows:"4",required:""},null,10,Cc),[[_e,_.userRequest]]),s("div",Ec,i(r(t)("mcpService.toolDescriptionDescription")),1)])]),s("div",Tc,[s("div",Ic,[s("label",null,i(r(t)("mcpService.serviceGroup")),1),s("div",Rc,[de(s("input",{type:"text","onUpdate:modelValue":G[2]||(G[2]=U=>_.serviceGroup=U),onInput:k,onFocus:G[3]||(G[3]=U=>b.value=!0),onBlur:x,placeholder:r(t)("mcpService.serviceGroupPlaceholder"),class:le({error:!_.serviceGroup||!_.serviceGroup.trim()}),required:""},null,42,Ac),[[_e,_.serviceGroup]]),b.value&&f.value.length>0?(p(),g("div",xc,[(p(!0),g(ie,null,he(f.value,U=>(p(),g("div",{key:U,class:"service-group-option",onMousedown:R=>j(U)},i(U),41,Mc))),128))])):V("",!0)]),s("div",Fc,i(r(t)("mcpService.serviceGroupDescription")),1)])]),s("div",Dc,[s("div",Nc,i(r(t)("mcpService.parameterConfig")),1),$.value.hasParameters?(p(),g("div",Uc,i(r(t)("sidebar.parameterRequirementsHelp")),1)):V("",!0),s("div",Oc,[s("table",null,[s("thead",null,[s("tr",null,[s("th",null,i(r(t)("mcpService.parameterName")),1),s("th",null,i(r(t)("mcpService.parameterDescription")),1)])]),s("tbody",null,[(p(!0),g(ie,null,he(_.parameters,(U,R)=>(p(),g("tr",{key:R},[s("td",null,[de(s("input",{type:"text","onUpdate:modelValue":O=>U.name=O,placeholder:r(t)("mcpService.parameterName"),class:le(["parameter-input",{"readonly-input":$.value.hasParameters}]),readonly:$.value.hasParameters,required:""},null,10,Lc),[[_e,U.name]])]),s("td",null,[de(s("input",{type:"text","onUpdate:modelValue":O=>U.description=O,placeholder:r(t)("mcpService.parameterDescription"),class:"parameter-input",required:""},null,8,Bc),[[_e,U.description]])])]))),128))])])])]),s("div",qc,[s("div",Vc,[s("div",jc,[s("label",Gc,[de(s("input",{type:"checkbox","onUpdate:modelValue":G[4]||(G[4]=U=>M.value=U),class:"checkbox-input"},null,512),[[Et,M.value]]),s("span",zc,i(r(t)("mcpService.publishAsInternalToolcall")),1)]),s("div",Jc,i(r(t)("mcpService.publishAsInternalToolcallDescription")),1)]),s("div",Hc,[s("label",Wc,[de(s("input",{type:"checkbox","onUpdate:modelValue":G[5]||(G[5]=U=>L.value=U),class:"checkbox-input"},null,512),[[Et,L.value]]),s("span",Kc,i(r(t)("mcpService.publishAsHttpService")),1)]),s("div",Xc,i(r(t)("mcpService.publishAsHttpServiceDescription")),1)])])])])]),_:1},8,["modelValue","title"]),u.value?(p(),g("div",{key:0,class:"error-toast",onClick:G[7]||(G[7]=U=>u.value="")},[E(r(T),{icon:"carbon:error"}),re(" "+i(u.value),1)])):V("",!0),h.value?(p(),g("div",{key:1,class:"success-toast",onClick:G[8]||(G[8]=U=>h.value="")},[E(r(T),{icon:"carbon:checkmark"}),re(" "+i(h.value),1)])):V("",!0)],64))}}),td=$e(ed,[["__scopeId","data-v-0d577e02"]]),sd={class:"modal-header"},od={class:"modal-body"},nd={class:"modal-footer"},ad=["disabled"],ld=we({__name:"SaveConfirmationDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","save","continue"],setup(n,{emit:e}){const o=e,t=D(!1),a=()=>{o("update:modelValue",!1)},l=async()=>{t.value=!0;try{o("save"),o("update:modelValue",!1)}finally{t.value=!1}},d=()=>{o("continue"),o("update:modelValue",!1)};return(u,h)=>u.modelValue?(p(),g("div",{key:0,class:"modal-overlay",onClick:a},[s("div",{class:"modal-content",onClick:h[0]||(h[0]=Se(()=>{},["stop"]))},[s("div",sd,[s("h3",null,i(u.$t("sidebar.saveConfirmationTitle")),1),s("button",{class:"close-btn",onClick:a},[E(r(T),{icon:"carbon:close",width:"16"})])]),s("div",od,[s("p",null,i(u.$t("sidebar.saveConfirmationMessage")),1)]),s("div",nd,[s("button",{class:"btn btn-secondary",onClick:a},i(u.$t("common.cancel")),1),s("button",{class:"btn btn-primary",onClick:l,disabled:t.value},[t.value?(p(),me(r(T),{key:0,icon:"carbon:loading",width:"16",class:"spinning"})):V("",!0),re(" "+i(t.value?u.$t("sidebar.saving"):u.$t("common.save")),1)],8,ad),s("button",{class:"btn btn-danger",onClick:d},i(u.$t("sidebar.continueWithoutSave")),1)])])])):V("",!0)}}),rd=$e(ld,[["__scopeId","data-v-8b7aff59"]]),id={class:"config-section"},cd={class:"section-header"},dd={class:"execution-content"},ud={class:"params-requirements-group"},pd={class:"params-help-text"},hd={key:0,class:"parameter-fields"},md={class:"parameter-label"},fd=["onUpdate:modelValue","placeholder","onInput"],gd={key:0,class:"parameter-error"},vd={key:1,class:"validation-message"},bd=["disabled"],yd=["disabled"],_d={key:1,class:"call-example-wrapper"},Sd={class:"call-example-header"},wd={class:"call-example-title"},$d={class:"call-example-description"},Pd={class:"internal-call-wrapper"},kd={class:"call-info"},Cd={class:"call-method"},Ed={class:"call-endpoint"},Td={key:0,class:"call-endpoint"},Id={class:"call-description"},Rd={class:"call-example"},Ad={class:"example-code"},xd={key:2,class:"call-example-wrapper"},Md={class:"call-example-header"},Fd={class:"call-example-title"},Dd={class:"call-example-description"},Nd={class:"http-api-urls-wrapper"},Ud={class:"tab-container"},Od={class:"tab-header"},Ld=["onClick"],Bd={class:"tab-content"},qd={class:"http-api-url-display"},Vd={class:"api-method"},jd={class:"api-endpoint"},Gd={class:"api-description"},zd={key:0,class:"api-example"},Jd={class:"example-code"},Hd={key:3,class:"call-example-wrapper"},Wd={class:"call-example-header"},Kd={class:"call-example-title"},Xd={class:"call-example-description"},Qd={class:"mcp-call-wrapper"},Yd={class:"call-info"},Zd={class:"call-method"},eu={class:"call-endpoint"},tu={class:"call-description"},su={class:"call-example"},ou={class:"example-code"},nu=we({__name:"ExecutionController",props:{currentPlanTemplateId:{default:""},isExecuting:{type:Boolean,default:!1},isGenerating:{type:Boolean,default:!1},showPublishButton:{type:Boolean,default:!0},toolInfo:{default:()=>({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""})}},emits:["executePlan","publishMcpService","clearParams","updateExecutionParams","saveBeforeExecute"],setup(n,{expose:e,emit:o}){const{t}=Ue(),a=ls(),l=n,d=o,u=D(""),h=D({parameters:[],hasParameters:!1,requirements:""}),c=D({}),m=D(!1),S=D("get-sync"),A=D({}),L=D(!1),M=D(!1),$=D(),C=D([]),b=D(null),y=D(!1),v=D(null),_=D([{id:"get-sync",label:"GET + Sync",method:"GET",endpoint:"/api/executor/executeByToolNameSync/{toolName}",description:"Synchronous GET request - returns execution result immediately",example:`GET /api/executor/executeByToolNameSync/my-tool?allParams={"rawParam":"test"}
Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-sync",label:"POST + Sync",method:"POST",endpoint:"/api/executor/executeByToolNameSync",description:"Synchronous POST request - returns execution result immediately",example:`POST /api/executor/executeByToolNameSync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-async",label:"POST + Async",method:"POST",endpoint:"/api/executor/executeByToolNameAsync",description:"Asynchronous POST request - returns task ID, check status separately",example:`POST /api/executor/executeByToolNameAsync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "planId": "plan-123",
  "status": "processing",
  "message": "Task submitted, processing",
  "memoryId": "ABC12345",
  "toolName": "my-tool",
  "planTemplateId": "template-456"
}

# Check execution status and get detailed results:
GET /api/executor/details/{planId}
Response: {
  "currentPlanId": "plan-123",
  "title": "Plan Title",
  "status": "completed",
  "summary": "Execution completed successfully",
  "agentExecutionSequence": [...],
  "userInputWaitState": null,
  "structureResult": {
    "message": [
      {
        "name": "Product A",
        "price": "100",
        "quantity": "5"
      }
    ],
    "fileList": [
      {
        "fileName": "report.md",
        "fileDescription": "Generated report with product information"
      }
    ]
  }
}`}]),f=fe(()=>l.toolInfo.enableInternalToolcall??l.toolInfo.enableHttpService??l.toolInfo.enableMcpService),P=fe(()=>f.value?t("sidebar.updateServiceStatus"):t("sidebar.publishMcpService")),N=fe(()=>l.isExecuting||l.isGenerating?!1:h.value.hasParameters?h.value.parameters.every(B=>{const Q=c.value[B];return typeof Q=="string"&&Q.trim()!==""}):!0),z=(B,Q)=>{C.value=B.map(ye=>ye.originalName),b.value=Q,console.log("[ExecutionController] Files uploaded:",B.length,"uploadKey:",Q)},k=B=>{C.value=B.map(Q=>Q.originalName),console.log("[ExecutionController] Files removed, remaining:",B.length)},x=B=>{b.value=B,console.log("[ExecutionController] Upload key changed:",B)},j=()=>{console.log("[ExecutionController] Upload started")},Z=()=>{console.log("[ExecutionController] Upload completed")},Y=B=>{console.error("[ExecutionController] Upload error:",B)},K=()=>{if(console.log("[ExecutionController] ðŸš€ Execute button clicked"),q.hasTaskRequirementModified){if(console.log("[ExecutionController] âš ï¸ Task requirements modified, showing save confirmation dialog"),!R()){console.log("[ExecutionController] âŒ Parameter validation failed:",A.value);return}const B=h.value.hasParameters&&Object.keys(c.value).length>0?c.value:void 0;v.value={title:"",planData:{title:"",steps:[],directResponse:!1},params:void 0,replacementParams:B,uploadedFiles:C.value,uploadKey:b.value},y.value=!0;return}X()},X=()=>{if(M.value=!0,console.log("[ExecutionController] ðŸ”’ Set isExecutingPlan to true"),!R()){console.log("[ExecutionController] âŒ Parameter validation failed:",A.value),M.value=!1;return}const B=h.value.hasParameters&&Object.keys(c.value).length>0?c.value:void 0;console.log("[ExecutionController] ðŸ”„ Replacement params:",B);const Q={title:"",planData:{title:"",steps:[],directResponse:!1},params:void 0,replacementParams:B,uploadedFiles:C.value,uploadKey:b.value};console.log("[ExecutionController] ðŸ“¤ Emitting executePlan with payload:",JSON.stringify(Q,null,2)),d("executePlan",Q)},ne=async()=>{console.log("[ExecutionController] ðŸ’¾ Save and execute requested");try{d("saveBeforeExecute"),await new Promise(B=>setTimeout(B,500)),v.value&&(console.log("[ExecutionController] ðŸ“¤ Emitting executePlan after save:",JSON.stringify(v.value,null,2)),d("executePlan",v.value),v.value=null)}catch(B){console.error("[ExecutionController] âŒ Failed to save before execute:",B),a.error(B.message||t("sidebar.saveFailed"))}},ge=()=>{console.log("[ExecutionController] â© Continue without save requested"),v.value&&(console.log("[ExecutionController] ðŸ“¤ Emitting executePlan without save:",JSON.stringify(v.value,null,2)),d("executePlan",v.value),v.value=null)},ke=()=>{d("publishMcpService")},H=()=>{console.log("[ExecutionController] ðŸ§¹ clearExecutionParams called"),u.value="",c.value={},M.value=!1,console.log("[ExecutionController] ðŸ”“ Reset isExecutingPlan to false"),console.log("[ExecutionController] âœ… After clear - parameterValues cleared"),d("clearParams")},G=async()=>{if(console.log("[ExecutionController] ðŸ”„ loadParameterRequirements called for templateId:",l.currentPlanTemplateId),console.log("[ExecutionController] ðŸ“Š Current parameterRequirements before load:",JSON.stringify(h.value,null,2)),!l.currentPlanTemplateId){console.log("[ExecutionController] âŒ No template ID, resetting parameters"),h.value={parameters:[],hasParameters:!1,requirements:""},c.value={};return}h.value={parameters:[],hasParameters:!1,requirements:""},c.value={},console.log("[ExecutionController] ðŸ§¹ Cleared previous data before loading new template"),m.value=!0;try{console.log("[ExecutionController] ðŸŒ Fetching parameter requirements from API...");const B=await Ot.getParameterRequirements(l.currentPlanTemplateId);console.log("[ExecutionController] ðŸ“¥ Received requirements from API:",JSON.stringify(B,null,2)),h.value=B;const Q={};B.parameters.forEach(ye=>{Q[ye]=c.value[ye]||""}),c.value=Q,console.log("[ExecutionController] âœ… Updated parameterRequirements:",JSON.stringify(h.value,null,2)),console.log("[ExecutionController] âœ… Updated parameterValues:",JSON.stringify(c.value,null,2)),O()}catch(B){console.error("[ExecutionController] âŒ Failed to load parameter requirements:",B),B instanceof Error&&!B.message.includes("404")&&console.warn("[ExecutionController] âš ï¸ Parameter requirements not available yet, will retry later"),h.value={parameters:[],hasParameters:!1,requirements:""},c.value={},console.log("[ExecutionController] ðŸ”„ Reset parameterRequirements due to error:",JSON.stringify(h.value,null,2)),console.log("[ExecutionController] ðŸ”„ Cleared parameterValues:",JSON.stringify(c.value,null,2))}finally{m.value=!1,console.log("[ExecutionController] âœ… loadParameterRequirements completed")}},U=(B,Q)=>{c.value[B]=Q,A.value[B]&&delete A.value[B],O()},R=()=>{if(A.value={},L.value=!1,!h.value.hasParameters)return!0;let B=!1;return h.value.parameters.forEach(Q=>{(c.value[Q]?c.value[Q].trim():"")||(A.value[Q]=`${Q} is required`,B=!0)}),L.value=B,!B},O=()=>{h.value.hasParameters?u.value=JSON.stringify(c.value,null,2):u.value="",d("updateExecutionParams",u.value)};return pe(()=>l.currentPlanTemplateId,(B,Q)=>{if(B&&B!==Q){if(M.value){console.log("[ExecutionController] â¸ï¸ Skipping parameter reload - plan is executing");return}console.log("[ExecutionController] ðŸ”„ Template ID changed, will reload parameters"),Q&&B.startsWith("planTemplate-")?(console.log("[ExecutionController] â° New template detected, retrying with delay..."),setTimeout(()=>{console.log("[ExecutionController] â° Delay timeout, calling loadParameterRequirements"),G()},1e3)):(console.log("[ExecutionController] ðŸš€ Immediate reload of parameters"),G())}}),pe(()=>u.value,B=>{d("updateExecutionParams",B)}),De(()=>{G()}),e({executionParams:u,clearExecutionParams:H,loadParameterRequirements:G,fileUploadRef:$,uploadedFiles:C,uploadKey:b}),(B,Q)=>{var ye,F,W,ve,ee;return p(),g(ie,null,[s("div",id,[s("div",cd,[E(r(T),{icon:"carbon:play",width:"16"}),s("span",null,i(r(t)("sidebar.executionController")),1)]),s("div",dd,[s("div",ud,[s("label",null,i(r(t)("sidebar.parameterRequirements")),1),s("div",pd,i(r(t)("sidebar.parameterRequirementsHelp")),1),h.value.hasParameters?(p(),g("div",hd,[(p(!0),g(ie,null,he(h.value.parameters,te=>(p(),g("div",{key:te,class:"parameter-field"},[s("label",md,[re(i(te)+" ",1),Q[1]||(Q[1]=s("span",{class:"required"},"*",-1))]),de(s("input",{"onUpdate:modelValue":be=>c.value[te]=be,class:le(["parameter-input",{error:A.value[te]}]),placeholder:r(t)("sidebar.enterValueFor",{param:te}),onInput:be=>U(te,be.target.value),required:""},null,42,fd),[[_e,c.value[te]]]),A.value[te]?(p(),g("div",gd,i(A.value[te]),1)):V("",!0)]))),128))])):V("",!0),h.value.hasParameters&&!N.value&&!l.isExecuting&&!l.isGenerating?(p(),g("div",vd,[E(r(T),{icon:"carbon:warning",width:"14"}),re(" "+i(r(t)("sidebar.fillAllRequiredParameters")),1)])):V("",!0)]),E(is,{ref_key:"fileUploadRef",ref:$,disabled:l.isExecuting||l.isGenerating,onFilesUploaded:z,onFilesRemoved:k,onUploadKeyChanged:x,onUploadStarted:j,onUploadCompleted:Z,onUploadError:Y},null,8,["disabled"]),s("button",{class:"btn btn-primary execute-btn",onClick:K,disabled:!N.value},[E(r(T),{icon:l.isExecuting?"carbon:circle-dash":"carbon:play",width:"16",class:le({spinning:l.isExecuting})},null,8,["icon","class"]),re(" "+i(l.isExecuting?r(t)("sidebar.executing"):r(t)("sidebar.executePlan")),1)],8,bd),B.showPublishButton?(p(),g("button",{key:0,class:"btn publish-mcp-btn",onClick:ke,disabled:!B.currentPlanTemplateId},[E(r(T),{icon:"carbon:application",width:"16"}),re(" "+i(P.value),1)],8,yd)):V("",!0),(ye=B.toolInfo)!=null&&ye.enableInternalToolcall?(p(),g("div",_d,[s("div",Sd,[s("h4",wd,i(r(t)("sidebar.internalCall")),1),s("p",$d,i(r(t)("sidebar.internalCallDescription")),1)]),s("div",Pd,[s("div",kd,[s("div",Cd,i(r(t)("sidebar.internalMethodCall")),1),s("div",Ed,i(r(t)("sidebar.toolName"))+": "+i(((F=B.toolInfo)==null?void 0:F.toolName)||B.currentPlanTemplateId),1),(W=B.toolInfo)!=null&&W.serviceGroup?(p(),g("div",Td,i(r(t)("sidebar.serviceGroup"))+": "+i(B.toolInfo.serviceGroup),1)):V("",!0),s("div",Id,i(r(t)("sidebar.internalCallUsage")),1),s("div",Rd,[s("strong",null,i(r(t)("sidebar.usage"))+":",1),s("pre",Ad,i(r(t)("sidebar.internalCallExample")),1)])])])])):V("",!0),(ve=B.toolInfo)!=null&&ve.enableHttpService?(p(),g("div",xd,[s("div",Md,[s("h4",Fd,i(r(t)("sidebar.httpCallExample")),1),s("p",Dd,i(r(t)("sidebar.httpCallDescription")),1)]),s("div",Nd,[s("div",Ud,[s("div",Od,[(p(!0),g(ie,null,he(_.value,te=>(p(),g("button",{key:te.id,class:le(["tab-button",{active:S.value===te.id}]),onClick:be=>S.value=te.id},i(te.label),11,Ld))),128))]),s("div",Bd,[(p(!0),g(ie,null,he(_.value,te=>de((p(),g("div",{key:te.id,class:"tab-panel"},[s("div",qd,[s("div",Vd,i(te.method),1),s("div",jd,i(te.endpoint),1),s("div",Gd,i(te.description),1),te.example?(p(),g("div",zd,[s("strong",null,i(r(t)("sidebar.example"))+":",1),s("pre",Jd,i(te.example),1)])):V("",!0)])])),[[Bs,S.value===te.id]])),128))])])])])):V("",!0),(ee=B.toolInfo)!=null&&ee.enableMcpService?(p(),g("div",Hd,[s("div",Wd,[s("h4",Kd,i(r(t)("sidebar.mcpCall")),1),s("p",Xd,i(r(t)("sidebar.mcpCallDescription")),1)]),s("div",Qd,[s("div",Yd,[s("div",Zd,i(r(t)("sidebar.mcpServiceCall")),1),s("div",eu,i(r(t)("sidebar.mcpEndpoint"))+": /mcp/execute",1),s("div",tu,i(r(t)("sidebar.mcpCallUsage")),1),s("div",su,[s("strong",null,i(r(t)("sidebar.usage"))+":",1),s("pre",ou,i(r(t)("sidebar.mcpCallExample")),1)])])])])):V("",!0)])]),E(rd,{modelValue:y.value,"onUpdate:modelValue":Q[0]||(Q[0]=te=>y.value=te),onSave:ne,onContinue:ge},null,8,["modelValue"])],64)}}}),au=$e(nu,[["__scopeId","data-v-705ee382"]]);function ds(n,e){const o=D(!1),t=nt({title:"",steps:[],directResponse:!1,planTemplateId:n.currentPlanTemplateId||"",planType:"dynamic_agent"}),a=y=>{console.log("[JsonEditorLogic] parseJsonToVisual called with jsonContent:",y),console.log("[JsonEditorLogic] parseJsonToVisual called with currentPlanTemplateId:",n.currentPlanTemplateId);try{if(!y){console.log("[JsonEditorLogic] No jsonContent, resetting to default"),Object.assign(t,{title:"",steps:[],directResponse:!1,planTemplateId:n.currentPlanTemplateId||"",planType:"dynamic_agent"}),console.log("[JsonEditorLogic] Reset displayData to:",t);return}const v=JSON.parse(y);console.log("[JsonEditorLogic] Parsed JSON:",v),t.title=v.title||"",t.directResponse=!1,t.planTemplateId=v.planTemplateId||n.currentPlanTemplateId||"",t.planType=v.planType||"dynamic_agent",t.steps=(v.steps||[]).map(_=>({stepRequirement:_.stepRequirement||"",agentName:_.agentName||"",modelName:_.modelName||null,selectedToolKeys:_.selectedToolKeys||[],terminateColumns:_.terminateColumns||""})),console.log("[JsonEditorLogic] Updated displayData to:",t)}catch(v){console.warn("Failed to parse JSON content:",v),Object.assign(t,{title:"",steps:[],directResponse:!1,planTemplateId:n.currentPlanTemplateId||"",planType:"dynamic_agent"}),console.log("[JsonEditorLogic] Error occurred, reset displayData to:",t)}},l=()=>{try{const y={title:t.title,steps:t.steps.map(v=>({stepRequirement:v.stepRequirement,agentName:v.agentName,modelName:v.modelName??"",selectedToolKeys:v.selectedToolKeys,terminateColumns:v.terminateColumns})),directResponse:t.directResponse,planTemplateId:t.planTemplateId,planType:t.planType};return JSON.stringify(y,null,2)}catch(y){return console.error("Failed to convert visual data to JSON:",y),"{}"}},d=fe(()=>l());pe(()=>n.jsonContent,(y,v)=>{console.log("[JsonEditorLogic] Watch triggered - jsonContent changed from",v,"to",y),a(y)},{immediate:!0}),pe(t,()=>{const y=l();e("update:jsonContent",y)},{deep:!0}),pe(()=>n.currentPlanTemplateId,y=>{y&&(t.planTemplateId=y)});let u=[],h=!0;return pe(()=>t.steps.map(y=>y.stepRequirement||y.stepContent||""),y=>{if(h){u=[...y],h=!1;return}(y.length!==u.length||y.some((_,f)=>_!==(u[f]||"")))&&(q.hasTaskRequirementModified=!0)},{deep:!0}),pe(()=>n.jsonContent,()=>{h=!0,u=[]}),{showJsonPreview:o,displayData:t,formattedJsonOutput:d,addStep:()=>{const y={stepRequirement:"",agentName:"ConfigurableDynaAgent",modelName:null,selectedToolKeys:[],terminateColumns:"",agentType:"",stepContent:""};t.steps.push(y)},removeStep:y=>{y>=0&&y<t.steps.length&&t.steps.splice(y,1)},moveStepUp:y=>{if(y>0){const v=t.steps.splice(y,1)[0];t.steps.splice(y-1,0,v)}},moveStepDown:y=>{if(y<t.steps.length-1){const v=t.steps.splice(y,1)[0];t.steps.splice(y+1,0,v)}},toggleJsonPreview:()=>{o.value=!o.value},closeJsonPreview:()=>{o.value=!1},handleRollback:()=>{e("rollback")},handleRestore:()=>{e("restore")},handleSave:()=>{e("save")}}}const lu={class:"config-section"},ru={class:"section-header"},iu={class:"visual-editor"},cu={class:"plan-basic-info"},du={class:"form-row"},uu={class:"form-label"},pu=["placeholder"],hu={class:"steps-section"},mu={class:"steps-header"},fu={class:"form-label"},gu={class:"steps-container"},vu={class:"step-header"},bu={class:"step-number"},yu={class:"step-actions"},_u=["onClick","disabled","title"],Su=["onClick","disabled","title"],wu=["onClick","title"],$u={class:"step-content"},Pu={class:"form-row"},ku={class:"form-label"},Cu={class:"agent-selector"},Eu=["onUpdate:modelValue"],Tu={value:""},Iu=["title"],Ru={class:"form-row"},Au={class:"form-label"},xu=["onUpdate:modelValue","placeholder"],Mu={class:"form-row"},Fu={class:"form-label"},Du=["onUpdate:modelValue","placeholder"],Nu={key:0,class:"empty-steps"},Uu={class:"plan-id-section"},Ou={class:"form-row"},Lu={class:"form-label"},Bu={key:0,class:"json-preview"},qu={class:"preview-header"},Vu={class:"form-label"},ju={class:"json-code"},Gu={class:"editor-footer"},zu={class:"section-actions"},Ju=["disabled","title"],Hu=["disabled","title"],Wu=["disabled"],Ku=we({__name:"JsonEditor",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},hiddenFields:{default:()=>[]},currentPlanTemplateId:{default:""}},emits:["rollback","restore","save","update:jsonContent"],setup(n,{emit:e}){const o=n,t=e,{showJsonPreview:a,displayData:l,formattedJsonOutput:d,addStep:u,removeStep:h,moveStepUp:c,moveStepDown:m,handleRollback:S,handleRestore:A,handleSave:L,toggleJsonPreview:M,closeJsonPreview:$}=ds(o,t),C=b=>{const y=b.target;y.style.height="auto";const v=20,_=Math.ceil(y.scrollHeight/v),f=4,P=12,N=Math.max(f,Math.min(P,_)),z=N*v;y.style.height=`${z}px`,y.rows=N,_>P?y.style.overflowY="auto":y.style.overflowY="hidden"};return(b,y)=>(p(),g("div",lu,[s("div",ru,[E(r(T),{icon:"carbon:code",width:"16"}),s("span",null,i(b.$t("sidebar.jsonTemplate")),1)]),s("div",iu,[s("div",cu,[s("div",du,[s("label",uu,i(b.$t("sidebar.title")),1),de(s("input",{"onUpdate:modelValue":y[0]||(y[0]=v=>r(l).title=v),type:"text",class:"form-input",placeholder:b.$t("sidebar.titlePlaceholder")},null,8,pu),[[_e,r(l).title]])])]),s("div",hu,[s("div",mu,[s("label",fu,i(b.$t("sidebar.tasks")),1)]),s("div",gu,[(p(!0),g(ie,null,he(r(l).steps,(v,_)=>(p(),g("div",{key:_,class:"step-item"},[s("div",vu,[s("span",bu,i(b.$t("sidebar.subtask"))+" "+i(_+1),1),s("div",yu,[s("button",{onClick:f=>r(c)(_),disabled:_===0,class:"btn btn-xs",title:b.$t("sidebar.moveUp")},[E(r(T),{icon:"carbon:chevron-up",width:"12"})],8,_u),s("button",{onClick:f=>r(m)(_),disabled:_===r(l).steps.length-1,class:"btn btn-xs",title:b.$t("sidebar.moveDown")},[E(r(T),{icon:"carbon:chevron-down",width:"12"})],8,Su),s("button",{onClick:f=>r(h)(_),class:"btn btn-xs btn-danger",title:b.$t("sidebar.removeStep")},[E(r(T),{icon:"carbon:trash-can",width:"12"})],8,wu)])]),s("div",$u,[s("div",Pu,[s("label",ku,i(b.$t("sidebar.agent")),1),s("div",Cu,[de(s("select",{"onUpdate:modelValue":f=>v.agentName=f,class:"form-select agent-select"},[s("option",Tu,i(b.$t("sidebar.selectAgent")),1),y[10]||(y[10]=qs('<option value="DEFAULT_AGENT" data-v-91f01967>DEFAULT_AGENT</option><option value="BROWSER_AGENT" data-v-91f01967>BROWSER_AGENT</option><option value="TEXT_FILE_AGENT" data-v-91f01967>TEXT_FILE_AGENT</option><option value="JSX_GENERATOR_AGENT" data-v-91f01967>JSX_GENERATOR_AGENT</option><option value="FILE_MANAGER_AGENT" data-v-91f01967>FILE_MANAGER_AGENT</option>',5))],8,Eu),[[mt,v.agentName]]),s("button",{onClick:y[1]||(y[1]=(...f)=>r(u)&&r(u)(...f)),class:"btn btn-sm btn-add-step",title:b.$t("sidebar.addStep")},[E(r(T),{icon:"carbon:add",width:"14"})],8,Iu)])]),s("div",Ru,[s("label",Au,i(b.$t("sidebar.stepRequirement")),1),de(s("textarea",{"onUpdate:modelValue":f=>v.stepContent=f,class:"form-textarea auto-resize",placeholder:b.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:y[2]||(y[2]=f=>C(f))},null,40,xu),[[_e,v.stepContent]])]),s("div",Mu,[s("label",Fu,i(b.$t("sidebar.terminateColumns")),1),de(s("input",{"onUpdate:modelValue":f=>v.terminateColumns=f,type:"text",class:"form-input",placeholder:b.$t("sidebar.terminateColumnsPlaceholder")},null,8,Du),[[_e,v.terminateColumns]])])])]))),128)),r(l).steps.length===0?(p(),g("div",Nu,[E(r(T),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),s("p",null,i(b.$t("sidebar.noSteps")),1),s("button",{onClick:y[3]||(y[3]=(...v)=>r(u)&&r(u)(...v)),class:"btn btn-primary"},[E(r(T),{icon:"carbon:add",width:"14"}),re(" "+i(b.$t("sidebar.addFirstStep")),1)])])):V("",!0)])]),s("div",Uu,[s("div",Ou,[s("label",Lu,i(b.$t("sidebar.planId")),1),de(s("input",{"onUpdate:modelValue":y[4]||(y[4]=v=>r(l).planTemplateId=v),type:"text",class:"form-input",placeholder:"planTemplate-1756109892045"},null,512),[[_e,r(l).planTemplateId]])])]),r(a)?(p(),g("div",Bu,[s("div",qu,[s("label",Vu,i(b.$t("sidebar.jsonPreview")),1),s("button",{onClick:y[5]||(y[5]=(...v)=>r($)&&r($)(...v)),class:"btn btn-xs"},[E(r(T),{icon:"carbon:close",width:"12"})])]),s("pre",ju,i(r(d)),1)])):V("",!0),s("div",Gu,[s("button",{onClick:y[6]||(y[6]=(...v)=>r(M)&&r(M)(...v)),class:"btn btn-sm btn-secondary"},[E(r(T),{icon:"carbon:code",width:"14"}),re(" "+i(r(a)?b.$t("sidebar.hideJson"):b.$t("sidebar.showJson")),1)]),s("div",zu,[s("button",{class:"btn btn-sm",onClick:y[7]||(y[7]=(...v)=>r(S)&&r(S)(...v)),disabled:!(b.canRollback??!1),title:b.$t("sidebar.rollback")},[E(r(T),{icon:"carbon:undo",width:"14"})],8,Ju),s("button",{class:"btn btn-sm",onClick:y[8]||(y[8]=(...v)=>r(A)&&r(A)(...v)),disabled:!(b.canRestore??!1),title:b.$t("sidebar.restore")},[E(r(T),{icon:"carbon:redo",width:"14"})],8,Hu),s("button",{class:"btn btn-primary",onClick:y[9]||(y[9]=(...v)=>r(L)&&r(L)(...v)),disabled:b.isGenerating||b.isExecuting},[E(r(T),{icon:"carbon:save",width:"14"}),y[11]||(y[11]=re(" Save "))],8,Wu)])])])]))}}),Xu=$e(Ku,[["__scopeId","data-v-91f01967"]]);function us(n,e){return function(){return n.apply(e,arguments)}}const{toString:Qu}=Object.prototype,{getPrototypeOf:Lt}=Object,{iterator:gt,toStringTag:ps}=Symbol,vt=(n=>e=>{const o=Qu.call(e);return n[o]||(n[o]=o.slice(8,-1).toLowerCase())})(Object.create(null)),Le=n=>(n=n.toLowerCase(),e=>vt(e)===n),bt=n=>e=>typeof e===n,{isArray:Xe}=Array,ot=bt("undefined");function Yu(n){return n!==null&&!ot(n)&&n.constructor!==null&&!ot(n.constructor)&&Me(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const hs=Le("ArrayBuffer");function Zu(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&hs(n.buffer),e}const ep=bt("string"),Me=bt("function"),ms=bt("number"),yt=n=>n!==null&&typeof n=="object",tp=n=>n===!0||n===!1,it=n=>{if(vt(n)!=="object")return!1;const e=Lt(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(ps in n)&&!(gt in n)},sp=Le("Date"),op=Le("File"),np=Le("Blob"),ap=Le("FileList"),lp=n=>yt(n)&&Me(n.pipe),rp=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||Me(n.append)&&((e=vt(n))==="formdata"||e==="object"&&Me(n.toString)&&n.toString()==="[object FormData]"))},ip=Le("URLSearchParams"),[cp,dp,up,pp]=["ReadableStream","Request","Response","Headers"].map(Le),hp=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function at(n,e,{allOwnKeys:o=!1}={}){if(n===null||typeof n>"u")return;let t,a;if(typeof n!="object"&&(n=[n]),Xe(n))for(t=0,a=n.length;t<a;t++)e.call(null,n[t],t,n);else{const l=o?Object.getOwnPropertyNames(n):Object.keys(n),d=l.length;let u;for(t=0;t<d;t++)u=l[t],e.call(null,n[u],u,n)}}function fs(n,e){e=e.toLowerCase();const o=Object.keys(n);let t=o.length,a;for(;t-- >0;)if(a=o[t],e===a.toLowerCase())return a;return null}const ze=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,gs=n=>!ot(n)&&n!==ze;function Rt(){const{caseless:n}=gs(this)&&this||{},e={},o=(t,a)=>{const l=n&&fs(e,a)||a;it(e[l])&&it(t)?e[l]=Rt(e[l],t):it(t)?e[l]=Rt({},t):Xe(t)?e[l]=t.slice():e[l]=t};for(let t=0,a=arguments.length;t<a;t++)arguments[t]&&at(arguments[t],o);return e}const mp=(n,e,o,{allOwnKeys:t}={})=>(at(e,(a,l)=>{o&&Me(a)?n[l]=us(a,o):n[l]=a},{allOwnKeys:t}),n),fp=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),gp=(n,e,o,t)=>{n.prototype=Object.create(e.prototype,t),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),o&&Object.assign(n.prototype,o)},vp=(n,e,o,t)=>{let a,l,d;const u={};if(e=e||{},n==null)return e;do{for(a=Object.getOwnPropertyNames(n),l=a.length;l-- >0;)d=a[l],(!t||t(d,n,e))&&!u[d]&&(e[d]=n[d],u[d]=!0);n=o!==!1&&Lt(n)}while(n&&(!o||o(n,e))&&n!==Object.prototype);return e},bp=(n,e,o)=>{n=String(n),(o===void 0||o>n.length)&&(o=n.length),o-=e.length;const t=n.indexOf(e,o);return t!==-1&&t===o},yp=n=>{if(!n)return null;if(Xe(n))return n;let e=n.length;if(!ms(e))return null;const o=new Array(e);for(;e-- >0;)o[e]=n[e];return o},_p=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&Lt(Uint8Array)),Sp=(n,e)=>{const t=(n&&n[gt]).call(n);let a;for(;(a=t.next())&&!a.done;){const l=a.value;e.call(n,l[0],l[1])}},wp=(n,e)=>{let o;const t=[];for(;(o=n.exec(e))!==null;)t.push(o);return t},$p=Le("HTMLFormElement"),Pp=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(o,t,a){return t.toUpperCase()+a}),jt=(({hasOwnProperty:n})=>(e,o)=>n.call(e,o))(Object.prototype),kp=Le("RegExp"),vs=(n,e)=>{const o=Object.getOwnPropertyDescriptors(n),t={};at(o,(a,l)=>{let d;(d=e(a,l,n))!==!1&&(t[l]=d||a)}),Object.defineProperties(n,t)},Cp=n=>{vs(n,(e,o)=>{if(Me(n)&&["arguments","caller","callee"].indexOf(o)!==-1)return!1;const t=n[o];if(Me(t)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+o+"'")})}})},Ep=(n,e)=>{const o={},t=a=>{a.forEach(l=>{o[l]=!0})};return Xe(n)?t(n):t(String(n).split(e)),o},Tp=()=>{},Ip=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e;function Rp(n){return!!(n&&Me(n.append)&&n[ps]==="FormData"&&n[gt])}const Ap=n=>{const e=new Array(10),o=(t,a)=>{if(yt(t)){if(e.indexOf(t)>=0)return;if(!("toJSON"in t)){e[a]=t;const l=Xe(t)?[]:{};return at(t,(d,u)=>{const h=o(d,a+1);!ot(h)&&(l[u]=h)}),e[a]=void 0,l}}return t};return o(n,0)},xp=Le("AsyncFunction"),Mp=n=>n&&(yt(n)||Me(n))&&Me(n.then)&&Me(n.catch),bs=((n,e)=>n?setImmediate:e?((o,t)=>(ze.addEventListener("message",({source:a,data:l})=>{a===ze&&l===o&&t.length&&t.shift()()},!1),a=>{t.push(a),ze.postMessage(o,"*")}))(`axios@${Math.random()}`,[]):o=>setTimeout(o))(typeof setImmediate=="function",Me(ze.postMessage)),Fp=typeof queueMicrotask<"u"?queueMicrotask.bind(ze):typeof process<"u"&&process.nextTick||bs,Dp=n=>n!=null&&Me(n[gt]),I={isArray:Xe,isArrayBuffer:hs,isBuffer:Yu,isFormData:rp,isArrayBufferView:Zu,isString:ep,isNumber:ms,isBoolean:tp,isObject:yt,isPlainObject:it,isReadableStream:cp,isRequest:dp,isResponse:up,isHeaders:pp,isUndefined:ot,isDate:sp,isFile:op,isBlob:np,isRegExp:kp,isFunction:Me,isStream:lp,isURLSearchParams:ip,isTypedArray:_p,isFileList:ap,forEach:at,merge:Rt,extend:mp,trim:hp,stripBOM:fp,inherits:gp,toFlatObject:vp,kindOf:vt,kindOfTest:Le,endsWith:bp,toArray:yp,forEachEntry:Sp,matchAll:wp,isHTMLForm:$p,hasOwnProperty:jt,hasOwnProp:jt,reduceDescriptors:vs,freezeMethods:Cp,toObjectSet:Ep,toCamelCase:Pp,noop:Tp,toFiniteNumber:Ip,findKey:fs,global:ze,isContextDefined:gs,isSpecCompliantForm:Rp,toJSONObject:Ap,isAsyncFn:xp,isThenable:Mp,setImmediate:bs,asap:Fp,isIterable:Dp};function se(n,e,o,t,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),o&&(this.config=o),t&&(this.request=t),a&&(this.response=a,this.status=a.status?a.status:null)}I.inherits(se,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:I.toJSONObject(this.config),code:this.code,status:this.status}}});const ys=se.prototype,_s={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{_s[n]={value:n}});Object.defineProperties(se,_s);Object.defineProperty(ys,"isAxiosError",{value:!0});se.from=(n,e,o,t,a,l)=>{const d=Object.create(ys);return I.toFlatObject(n,d,function(h){return h!==Error.prototype},u=>u!=="isAxiosError"),se.call(d,n.message,e,o,t,a),d.cause=n,d.name=n.name,l&&Object.assign(d,l),d};const Np=null;function At(n){return I.isPlainObject(n)||I.isArray(n)}function Ss(n){return I.endsWith(n,"[]")?n.slice(0,-2):n}function Gt(n,e,o){return n?n.concat(e).map(function(a,l){return a=Ss(a),!o&&l?"["+a+"]":a}).join(o?".":""):e}function Up(n){return I.isArray(n)&&!n.some(At)}const Op=I.toFlatObject(I,{},null,function(e){return/^is[A-Z]/.test(e)});function _t(n,e,o){if(!I.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,o=I.toFlatObject(o,{metaTokens:!0,dots:!1,indexes:!1},!1,function($,C){return!I.isUndefined(C[$])});const t=o.metaTokens,a=o.visitor||m,l=o.dots,d=o.indexes,h=(o.Blob||typeof Blob<"u"&&Blob)&&I.isSpecCompliantForm(e);if(!I.isFunction(a))throw new TypeError("visitor must be a function");function c(M){if(M===null)return"";if(I.isDate(M))return M.toISOString();if(!h&&I.isBlob(M))throw new se("Blob is not supported. Use a Buffer instead.");return I.isArrayBuffer(M)||I.isTypedArray(M)?h&&typeof Blob=="function"?new Blob([M]):Buffer.from(M):M}function m(M,$,C){let b=M;if(M&&!C&&typeof M=="object"){if(I.endsWith($,"{}"))$=t?$:$.slice(0,-2),M=JSON.stringify(M);else if(I.isArray(M)&&Up(M)||(I.isFileList(M)||I.endsWith($,"[]"))&&(b=I.toArray(M)))return $=Ss($),b.forEach(function(v,_){!(I.isUndefined(v)||v===null)&&e.append(d===!0?Gt([$],_,l):d===null?$:$+"[]",c(v))}),!1}return At(M)?!0:(e.append(Gt(C,$,l),c(M)),!1)}const S=[],A=Object.assign(Op,{defaultVisitor:m,convertValue:c,isVisitable:At});function L(M,$){if(!I.isUndefined(M)){if(S.indexOf(M)!==-1)throw Error("Circular reference detected in "+$.join("."));S.push(M),I.forEach(M,function(b,y){(!(I.isUndefined(b)||b===null)&&a.call(e,b,I.isString(y)?y.trim():y,$,A))===!0&&L(b,$?$.concat(y):[y])}),S.pop()}}if(!I.isObject(n))throw new TypeError("data must be an object");return L(n),e}function zt(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(t){return e[t]})}function Bt(n,e){this._pairs=[],n&&_t(n,this,e)}const ws=Bt.prototype;ws.append=function(e,o){this._pairs.push([e,o])};ws.toString=function(e){const o=e?function(t){return e.call(this,t,zt)}:zt;return this._pairs.map(function(a){return o(a[0])+"="+o(a[1])},"").join("&")};function Lp(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function $s(n,e,o){if(!e)return n;const t=o&&o.encode||Lp;I.isFunction(o)&&(o={serialize:o});const a=o&&o.serialize;let l;if(a?l=a(e,o):l=I.isURLSearchParams(e)?e.toString():new Bt(e,o).toString(t),l){const d=n.indexOf("#");d!==-1&&(n=n.slice(0,d)),n+=(n.indexOf("?")===-1?"?":"&")+l}return n}class Jt{constructor(){this.handlers=[]}use(e,o,t){return this.handlers.push({fulfilled:e,rejected:o,synchronous:t?t.synchronous:!1,runWhen:t?t.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){I.forEach(this.handlers,function(t){t!==null&&e(t)})}}const Ps={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Bp=typeof URLSearchParams<"u"?URLSearchParams:Bt,qp=typeof FormData<"u"?FormData:null,Vp=typeof Blob<"u"?Blob:null,jp={isBrowser:!0,classes:{URLSearchParams:Bp,FormData:qp,Blob:Vp},protocols:["http","https","file","blob","url","data"]},qt=typeof window<"u"&&typeof document<"u",xt=typeof navigator=="object"&&navigator||void 0,Gp=qt&&(!xt||["ReactNative","NativeScript","NS"].indexOf(xt.product)<0),zp=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Jp=qt&&window.location.href||"http://localhost",Hp=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:qt,hasStandardBrowserEnv:Gp,hasStandardBrowserWebWorkerEnv:zp,navigator:xt,origin:Jp},Symbol.toStringTag,{value:"Module"})),Te={...Hp,...jp};function Wp(n,e){return _t(n,new Te.classes.URLSearchParams,Object.assign({visitor:function(o,t,a,l){return Te.isNode&&I.isBuffer(o)?(this.append(t,o.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)}},e))}function Kp(n){return I.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Xp(n){const e={},o=Object.keys(n);let t;const a=o.length;let l;for(t=0;t<a;t++)l=o[t],e[l]=n[l];return e}function ks(n){function e(o,t,a,l){let d=o[l++];if(d==="__proto__")return!0;const u=Number.isFinite(+d),h=l>=o.length;return d=!d&&I.isArray(a)?a.length:d,h?(I.hasOwnProp(a,d)?a[d]=[a[d],t]:a[d]=t,!u):((!a[d]||!I.isObject(a[d]))&&(a[d]=[]),e(o,t,a[d],l)&&I.isArray(a[d])&&(a[d]=Xp(a[d])),!u)}if(I.isFormData(n)&&I.isFunction(n.entries)){const o={};return I.forEachEntry(n,(t,a)=>{e(Kp(t),a,o,0)}),o}return null}function Qp(n,e,o){if(I.isString(n))try{return(e||JSON.parse)(n),I.trim(n)}catch(t){if(t.name!=="SyntaxError")throw t}return(o||JSON.stringify)(n)}const lt={transitional:Ps,adapter:["xhr","http","fetch"],transformRequest:[function(e,o){const t=o.getContentType()||"",a=t.indexOf("application/json")>-1,l=I.isObject(e);if(l&&I.isHTMLForm(e)&&(e=new FormData(e)),I.isFormData(e))return a?JSON.stringify(ks(e)):e;if(I.isArrayBuffer(e)||I.isBuffer(e)||I.isStream(e)||I.isFile(e)||I.isBlob(e)||I.isReadableStream(e))return e;if(I.isArrayBufferView(e))return e.buffer;if(I.isURLSearchParams(e))return o.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(l){if(t.indexOf("application/x-www-form-urlencoded")>-1)return Wp(e,this.formSerializer).toString();if((u=I.isFileList(e))||t.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return _t(u?{"files[]":e}:e,h&&new h,this.formSerializer)}}return l||a?(o.setContentType("application/json",!1),Qp(e)):e}],transformResponse:[function(e){const o=this.transitional||lt.transitional,t=o&&o.forcedJSONParsing,a=this.responseType==="json";if(I.isResponse(e)||I.isReadableStream(e))return e;if(e&&I.isString(e)&&(t&&!this.responseType||a)){const d=!(o&&o.silentJSONParsing)&&a;try{return JSON.parse(e)}catch(u){if(d)throw u.name==="SyntaxError"?se.from(u,se.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Te.classes.FormData,Blob:Te.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};I.forEach(["delete","get","head","post","put","patch"],n=>{lt.headers[n]={}});const Yp=I.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Zp=n=>{const e={};let o,t,a;return n&&n.split(`
`).forEach(function(d){a=d.indexOf(":"),o=d.substring(0,a).trim().toLowerCase(),t=d.substring(a+1).trim(),!(!o||e[o]&&Yp[o])&&(o==="set-cookie"?e[o]?e[o].push(t):e[o]=[t]:e[o]=e[o]?e[o]+", "+t:t)}),e},Ht=Symbol("internals");function Ze(n){return n&&String(n).trim().toLowerCase()}function ct(n){return n===!1||n==null?n:I.isArray(n)?n.map(ct):String(n)}function eh(n){const e=Object.create(null),o=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let t;for(;t=o.exec(n);)e[t[1]]=t[2];return e}const th=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function Pt(n,e,o,t,a){if(I.isFunction(t))return t.call(this,e,o);if(a&&(e=o),!!I.isString(e)){if(I.isString(t))return e.indexOf(t)!==-1;if(I.isRegExp(t))return t.test(e)}}function sh(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,o,t)=>o.toUpperCase()+t)}function oh(n,e){const o=I.toCamelCase(" "+e);["get","set","has"].forEach(t=>{Object.defineProperty(n,t+o,{value:function(a,l,d){return this[t].call(this,e,a,l,d)},configurable:!0})})}let Fe=class{constructor(e){e&&this.set(e)}set(e,o,t){const a=this;function l(u,h,c){const m=Ze(h);if(!m)throw new Error("header name must be a non-empty string");const S=I.findKey(a,m);(!S||a[S]===void 0||c===!0||c===void 0&&a[S]!==!1)&&(a[S||h]=ct(u))}const d=(u,h)=>I.forEach(u,(c,m)=>l(c,m,h));if(I.isPlainObject(e)||e instanceof this.constructor)d(e,o);else if(I.isString(e)&&(e=e.trim())&&!th(e))d(Zp(e),o);else if(I.isObject(e)&&I.isIterable(e)){let u={},h,c;for(const m of e){if(!I.isArray(m))throw TypeError("Object iterator must return a key-value pair");u[c=m[0]]=(h=u[c])?I.isArray(h)?[...h,m[1]]:[h,m[1]]:m[1]}d(u,o)}else e!=null&&l(o,e,t);return this}get(e,o){if(e=Ze(e),e){const t=I.findKey(this,e);if(t){const a=this[t];if(!o)return a;if(o===!0)return eh(a);if(I.isFunction(o))return o.call(this,a,t);if(I.isRegExp(o))return o.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,o){if(e=Ze(e),e){const t=I.findKey(this,e);return!!(t&&this[t]!==void 0&&(!o||Pt(this,this[t],t,o)))}return!1}delete(e,o){const t=this;let a=!1;function l(d){if(d=Ze(d),d){const u=I.findKey(t,d);u&&(!o||Pt(t,t[u],u,o))&&(delete t[u],a=!0)}}return I.isArray(e)?e.forEach(l):l(e),a}clear(e){const o=Object.keys(this);let t=o.length,a=!1;for(;t--;){const l=o[t];(!e||Pt(this,this[l],l,e,!0))&&(delete this[l],a=!0)}return a}normalize(e){const o=this,t={};return I.forEach(this,(a,l)=>{const d=I.findKey(t,l);if(d){o[d]=ct(a),delete o[l];return}const u=e?sh(l):String(l).trim();u!==l&&delete o[l],o[u]=ct(a),t[u]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const o=Object.create(null);return I.forEach(this,(t,a)=>{t!=null&&t!==!1&&(o[a]=e&&I.isArray(t)?t.join(", "):t)}),o}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,o])=>e+": "+o).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...o){const t=new this(e);return o.forEach(a=>t.set(a)),t}static accessor(e){const t=(this[Ht]=this[Ht]={accessors:{}}).accessors,a=this.prototype;function l(d){const u=Ze(d);t[u]||(oh(a,d),t[u]=!0)}return I.isArray(e)?e.forEach(l):l(e),this}};Fe.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);I.reduceDescriptors(Fe.prototype,({value:n},e)=>{let o=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(t){this[o]=t}}});I.freezeMethods(Fe);function kt(n,e){const o=this||lt,t=e||o,a=Fe.from(t.headers);let l=t.data;return I.forEach(n,function(u){l=u.call(o,l,a.normalize(),e?e.status:void 0)}),a.normalize(),l}function Cs(n){return!!(n&&n.__CANCEL__)}function Qe(n,e,o){se.call(this,n??"canceled",se.ERR_CANCELED,e,o),this.name="CanceledError"}I.inherits(Qe,se,{__CANCEL__:!0});function Es(n,e,o){const t=o.config.validateStatus;!o.status||!t||t(o.status)?n(o):e(new se("Request failed with status code "+o.status,[se.ERR_BAD_REQUEST,se.ERR_BAD_RESPONSE][Math.floor(o.status/100)-4],o.config,o.request,o))}function nh(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function ah(n,e){n=n||10;const o=new Array(n),t=new Array(n);let a=0,l=0,d;return e=e!==void 0?e:1e3,function(h){const c=Date.now(),m=t[l];d||(d=c),o[a]=h,t[a]=c;let S=l,A=0;for(;S!==a;)A+=o[S++],S=S%n;if(a=(a+1)%n,a===l&&(l=(l+1)%n),c-d<e)return;const L=m&&c-m;return L?Math.round(A*1e3/L):void 0}}function lh(n,e){let o=0,t=1e3/e,a,l;const d=(c,m=Date.now())=>{o=m,a=null,l&&(clearTimeout(l),l=null),n.apply(null,c)};return[(...c)=>{const m=Date.now(),S=m-o;S>=t?d(c,m):(a=c,l||(l=setTimeout(()=>{l=null,d(a)},t-S)))},()=>a&&d(a)]}const pt=(n,e,o=3)=>{let t=0;const a=ah(50,250);return lh(l=>{const d=l.loaded,u=l.lengthComputable?l.total:void 0,h=d-t,c=a(h),m=d<=u;t=d;const S={loaded:d,total:u,progress:u?d/u:void 0,bytes:h,rate:c||void 0,estimated:c&&u&&m?(u-d)/c:void 0,event:l,lengthComputable:u!=null,[e?"download":"upload"]:!0};n(S)},o)},Wt=(n,e)=>{const o=n!=null;return[t=>e[0]({lengthComputable:o,total:n,loaded:t}),e[1]]},Kt=n=>(...e)=>I.asap(()=>n(...e)),rh=Te.hasStandardBrowserEnv?((n,e)=>o=>(o=new URL(o,Te.origin),n.protocol===o.protocol&&n.host===o.host&&(e||n.port===o.port)))(new URL(Te.origin),Te.navigator&&/(msie|trident)/i.test(Te.navigator.userAgent)):()=>!0,ih=Te.hasStandardBrowserEnv?{write(n,e,o,t,a,l){const d=[n+"="+encodeURIComponent(e)];I.isNumber(o)&&d.push("expires="+new Date(o).toGMTString()),I.isString(t)&&d.push("path="+t),I.isString(a)&&d.push("domain="+a),l===!0&&d.push("secure"),document.cookie=d.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function ch(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function dh(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function Ts(n,e,o){let t=!ch(e);return n&&(t||o==!1)?dh(n,e):e}const Xt=n=>n instanceof Fe?{...n}:n;function He(n,e){e=e||{};const o={};function t(c,m,S,A){return I.isPlainObject(c)&&I.isPlainObject(m)?I.merge.call({caseless:A},c,m):I.isPlainObject(m)?I.merge({},m):I.isArray(m)?m.slice():m}function a(c,m,S,A){if(I.isUndefined(m)){if(!I.isUndefined(c))return t(void 0,c,S,A)}else return t(c,m,S,A)}function l(c,m){if(!I.isUndefined(m))return t(void 0,m)}function d(c,m){if(I.isUndefined(m)){if(!I.isUndefined(c))return t(void 0,c)}else return t(void 0,m)}function u(c,m,S){if(S in e)return t(c,m);if(S in n)return t(void 0,c)}const h={url:l,method:l,data:l,baseURL:d,transformRequest:d,transformResponse:d,paramsSerializer:d,timeout:d,timeoutMessage:d,withCredentials:d,withXSRFToken:d,adapter:d,responseType:d,xsrfCookieName:d,xsrfHeaderName:d,onUploadProgress:d,onDownloadProgress:d,decompress:d,maxContentLength:d,maxBodyLength:d,beforeRedirect:d,transport:d,httpAgent:d,httpsAgent:d,cancelToken:d,socketPath:d,responseEncoding:d,validateStatus:u,headers:(c,m,S)=>a(Xt(c),Xt(m),S,!0)};return I.forEach(Object.keys(Object.assign({},n,e)),function(m){const S=h[m]||a,A=S(n[m],e[m],m);I.isUndefined(A)&&S!==u||(o[m]=A)}),o}const Is=n=>{const e=He({},n);let{data:o,withXSRFToken:t,xsrfHeaderName:a,xsrfCookieName:l,headers:d,auth:u}=e;e.headers=d=Fe.from(d),e.url=$s(Ts(e.baseURL,e.url,e.allowAbsoluteUrls),n.params,n.paramsSerializer),u&&d.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):"")));let h;if(I.isFormData(o)){if(Te.hasStandardBrowserEnv||Te.hasStandardBrowserWebWorkerEnv)d.setContentType(void 0);else if((h=d.getContentType())!==!1){const[c,...m]=h?h.split(";").map(S=>S.trim()).filter(Boolean):[];d.setContentType([c||"multipart/form-data",...m].join("; "))}}if(Te.hasStandardBrowserEnv&&(t&&I.isFunction(t)&&(t=t(e)),t||t!==!1&&rh(e.url))){const c=a&&l&&ih.read(l);c&&d.set(a,c)}return e},uh=typeof XMLHttpRequest<"u",ph=uh&&function(n){return new Promise(function(o,t){const a=Is(n);let l=a.data;const d=Fe.from(a.headers).normalize();let{responseType:u,onUploadProgress:h,onDownloadProgress:c}=a,m,S,A,L,M;function $(){L&&L(),M&&M(),a.cancelToken&&a.cancelToken.unsubscribe(m),a.signal&&a.signal.removeEventListener("abort",m)}let C=new XMLHttpRequest;C.open(a.method.toUpperCase(),a.url,!0),C.timeout=a.timeout;function b(){if(!C)return;const v=Fe.from("getAllResponseHeaders"in C&&C.getAllResponseHeaders()),f={data:!u||u==="text"||u==="json"?C.responseText:C.response,status:C.status,statusText:C.statusText,headers:v,config:n,request:C};Es(function(N){o(N),$()},function(N){t(N),$()},f),C=null}"onloadend"in C?C.onloadend=b:C.onreadystatechange=function(){!C||C.readyState!==4||C.status===0&&!(C.responseURL&&C.responseURL.indexOf("file:")===0)||setTimeout(b)},C.onabort=function(){C&&(t(new se("Request aborted",se.ECONNABORTED,n,C)),C=null)},C.onerror=function(){t(new se("Network Error",se.ERR_NETWORK,n,C)),C=null},C.ontimeout=function(){let _=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const f=a.transitional||Ps;a.timeoutErrorMessage&&(_=a.timeoutErrorMessage),t(new se(_,f.clarifyTimeoutError?se.ETIMEDOUT:se.ECONNABORTED,n,C)),C=null},l===void 0&&d.setContentType(null),"setRequestHeader"in C&&I.forEach(d.toJSON(),function(_,f){C.setRequestHeader(f,_)}),I.isUndefined(a.withCredentials)||(C.withCredentials=!!a.withCredentials),u&&u!=="json"&&(C.responseType=a.responseType),c&&([A,M]=pt(c,!0),C.addEventListener("progress",A)),h&&C.upload&&([S,L]=pt(h),C.upload.addEventListener("progress",S),C.upload.addEventListener("loadend",L)),(a.cancelToken||a.signal)&&(m=v=>{C&&(t(!v||v.type?new Qe(null,n,C):v),C.abort(),C=null)},a.cancelToken&&a.cancelToken.subscribe(m),a.signal&&(a.signal.aborted?m():a.signal.addEventListener("abort",m)));const y=nh(a.url);if(y&&Te.protocols.indexOf(y)===-1){t(new se("Unsupported protocol "+y+":",se.ERR_BAD_REQUEST,n));return}C.send(l||null)})},hh=(n,e)=>{const{length:o}=n=n?n.filter(Boolean):[];if(e||o){let t=new AbortController,a;const l=function(c){if(!a){a=!0,u();const m=c instanceof Error?c:this.reason;t.abort(m instanceof se?m:new Qe(m instanceof Error?m.message:m))}};let d=e&&setTimeout(()=>{d=null,l(new se(`timeout ${e} of ms exceeded`,se.ETIMEDOUT))},e);const u=()=>{n&&(d&&clearTimeout(d),d=null,n.forEach(c=>{c.unsubscribe?c.unsubscribe(l):c.removeEventListener("abort",l)}),n=null)};n.forEach(c=>c.addEventListener("abort",l));const{signal:h}=t;return h.unsubscribe=()=>I.asap(u),h}},mh=function*(n,e){let o=n.byteLength;if(o<e){yield n;return}let t=0,a;for(;t<o;)a=t+e,yield n.slice(t,a),t=a},fh=async function*(n,e){for await(const o of gh(n))yield*mh(o,e)},gh=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:o,value:t}=await e.read();if(o)break;yield t}}finally{await e.cancel()}},Qt=(n,e,o,t)=>{const a=fh(n,e);let l=0,d,u=h=>{d||(d=!0,t&&t(h))};return new ReadableStream({async pull(h){try{const{done:c,value:m}=await a.next();if(c){u(),h.close();return}let S=m.byteLength;if(o){let A=l+=S;o(A)}h.enqueue(new Uint8Array(m))}catch(c){throw u(c),c}},cancel(h){return u(h),a.return()}},{highWaterMark:2})},St=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Rs=St&&typeof ReadableStream=="function",vh=St&&(typeof TextEncoder=="function"?(n=>e=>n.encode(e))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),As=(n,...e)=>{try{return!!n(...e)}catch{return!1}},bh=Rs&&As(()=>{let n=!1;const e=new Request(Te.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e}),Yt=64*1024,Mt=Rs&&As(()=>I.isReadableStream(new Response("").body)),ht={stream:Mt&&(n=>n.body)};St&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!ht[e]&&(ht[e]=I.isFunction(n[e])?o=>o[e]():(o,t)=>{throw new se(`Response type '${e}' is not supported`,se.ERR_NOT_SUPPORT,t)})})})(new Response);const yh=async n=>{if(n==null)return 0;if(I.isBlob(n))return n.size;if(I.isSpecCompliantForm(n))return(await new Request(Te.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(I.isArrayBufferView(n)||I.isArrayBuffer(n))return n.byteLength;if(I.isURLSearchParams(n)&&(n=n+""),I.isString(n))return(await vh(n)).byteLength},_h=async(n,e)=>{const o=I.toFiniteNumber(n.getContentLength());return o??yh(e)},Sh=St&&(async n=>{let{url:e,method:o,data:t,signal:a,cancelToken:l,timeout:d,onDownloadProgress:u,onUploadProgress:h,responseType:c,headers:m,withCredentials:S="same-origin",fetchOptions:A}=Is(n);c=c?(c+"").toLowerCase():"text";let L=hh([a,l&&l.toAbortSignal()],d),M;const $=L&&L.unsubscribe&&(()=>{L.unsubscribe()});let C;try{if(h&&bh&&o!=="get"&&o!=="head"&&(C=await _h(m,t))!==0){let f=new Request(e,{method:"POST",body:t,duplex:"half"}),P;if(I.isFormData(t)&&(P=f.headers.get("content-type"))&&m.setContentType(P),f.body){const[N,z]=Wt(C,pt(Kt(h)));t=Qt(f.body,Yt,N,z)}}I.isString(S)||(S=S?"include":"omit");const b="credentials"in Request.prototype;M=new Request(e,{...A,signal:L,method:o.toUpperCase(),headers:m.normalize().toJSON(),body:t,duplex:"half",credentials:b?S:void 0});let y=await fetch(M);const v=Mt&&(c==="stream"||c==="response");if(Mt&&(u||v&&$)){const f={};["status","statusText","headers"].forEach(k=>{f[k]=y[k]});const P=I.toFiniteNumber(y.headers.get("content-length")),[N,z]=u&&Wt(P,pt(Kt(u),!0))||[];y=new Response(Qt(y.body,Yt,N,()=>{z&&z(),$&&$()}),f)}c=c||"text";let _=await ht[I.findKey(ht,c)||"text"](y,n);return!v&&$&&$(),await new Promise((f,P)=>{Es(f,P,{data:_,headers:Fe.from(y.headers),status:y.status,statusText:y.statusText,config:n,request:M})})}catch(b){throw $&&$(),b&&b.name==="TypeError"&&/Load failed|fetch/i.test(b.message)?Object.assign(new se("Network Error",se.ERR_NETWORK,n,M),{cause:b.cause||b}):se.from(b,b&&b.code,n,M)}}),Ft={http:Np,xhr:ph,fetch:Sh};I.forEach(Ft,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const Zt=n=>`- ${n}`,wh=n=>I.isFunction(n)||n===null||n===!1,xs={getAdapter:n=>{n=I.isArray(n)?n:[n];const{length:e}=n;let o,t;const a={};for(let l=0;l<e;l++){o=n[l];let d;if(t=o,!wh(o)&&(t=Ft[(d=String(o)).toLowerCase()],t===void 0))throw new se(`Unknown adapter '${d}'`);if(t)break;a[d||"#"+l]=t}if(!t){const l=Object.entries(a).map(([u,h])=>`adapter ${u} `+(h===!1?"is not supported by the environment":"is not available in the build"));let d=e?l.length>1?`since :
`+l.map(Zt).join(`
`):" "+Zt(l[0]):"as no adapter specified";throw new se("There is no suitable adapter to dispatch the request "+d,"ERR_NOT_SUPPORT")}return t},adapters:Ft};function Ct(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Qe(null,n)}function es(n){return Ct(n),n.headers=Fe.from(n.headers),n.data=kt.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),xs.getAdapter(n.adapter||lt.adapter)(n).then(function(t){return Ct(n),t.data=kt.call(n,n.transformResponse,t),t.headers=Fe.from(t.headers),t},function(t){return Cs(t)||(Ct(n),t&&t.response&&(t.response.data=kt.call(n,n.transformResponse,t.response),t.response.headers=Fe.from(t.response.headers))),Promise.reject(t)})}const Ms="1.9.0",wt={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{wt[n]=function(t){return typeof t===n||"a"+(e<1?"n ":" ")+n}});const ts={};wt.transitional=function(e,o,t){function a(l,d){return"[Axios v"+Ms+"] Transitional option '"+l+"'"+d+(t?". "+t:"")}return(l,d,u)=>{if(e===!1)throw new se(a(d," has been removed"+(o?" in "+o:"")),se.ERR_DEPRECATED);return o&&!ts[d]&&(ts[d]=!0,console.warn(a(d," has been deprecated since v"+o+" and will be removed in the near future"))),e?e(l,d,u):!0}};wt.spelling=function(e){return(o,t)=>(console.warn(`${t} is likely a misspelling of ${e}`),!0)};function $h(n,e,o){if(typeof n!="object")throw new se("options must be an object",se.ERR_BAD_OPTION_VALUE);const t=Object.keys(n);let a=t.length;for(;a-- >0;){const l=t[a],d=e[l];if(d){const u=n[l],h=u===void 0||d(u,l,n);if(h!==!0)throw new se("option "+l+" must be "+h,se.ERR_BAD_OPTION_VALUE);continue}if(o!==!0)throw new se("Unknown option "+l,se.ERR_BAD_OPTION)}}const dt={assertOptions:$h,validators:wt},Be=dt.validators;let Je=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Jt,response:new Jt}}async request(e,o){try{return await this._request(e,o)}catch(t){if(t instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const l=a.stack?a.stack.replace(/^.+\n/,""):"";try{t.stack?l&&!String(t.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(t.stack+=`
`+l):t.stack=l}catch{}}throw t}}_request(e,o){typeof e=="string"?(o=o||{},o.url=e):o=e||{},o=He(this.defaults,o);const{transitional:t,paramsSerializer:a,headers:l}=o;t!==void 0&&dt.assertOptions(t,{silentJSONParsing:Be.transitional(Be.boolean),forcedJSONParsing:Be.transitional(Be.boolean),clarifyTimeoutError:Be.transitional(Be.boolean)},!1),a!=null&&(I.isFunction(a)?o.paramsSerializer={serialize:a}:dt.assertOptions(a,{encode:Be.function,serialize:Be.function},!0)),o.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?o.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:o.allowAbsoluteUrls=!0),dt.assertOptions(o,{baseUrl:Be.spelling("baseURL"),withXsrfToken:Be.spelling("withXSRFToken")},!0),o.method=(o.method||this.defaults.method||"get").toLowerCase();let d=l&&I.merge(l.common,l[o.method]);l&&I.forEach(["delete","get","head","post","put","patch","common"],M=>{delete l[M]}),o.headers=Fe.concat(d,l);const u=[];let h=!0;this.interceptors.request.forEach(function($){typeof $.runWhen=="function"&&$.runWhen(o)===!1||(h=h&&$.synchronous,u.unshift($.fulfilled,$.rejected))});const c=[];this.interceptors.response.forEach(function($){c.push($.fulfilled,$.rejected)});let m,S=0,A;if(!h){const M=[es.bind(this),void 0];for(M.unshift.apply(M,u),M.push.apply(M,c),A=M.length,m=Promise.resolve(o);S<A;)m=m.then(M[S++],M[S++]);return m}A=u.length;let L=o;for(S=0;S<A;){const M=u[S++],$=u[S++];try{L=M(L)}catch(C){$.call(this,C);break}}try{m=es.call(this,L)}catch(M){return Promise.reject(M)}for(S=0,A=c.length;S<A;)m=m.then(c[S++],c[S++]);return m}getUri(e){e=He(this.defaults,e);const o=Ts(e.baseURL,e.url,e.allowAbsoluteUrls);return $s(o,e.params,e.paramsSerializer)}};I.forEach(["delete","get","head","options"],function(e){Je.prototype[e]=function(o,t){return this.request(He(t||{},{method:e,url:o,data:(t||{}).data}))}});I.forEach(["post","put","patch"],function(e){function o(t){return function(l,d,u){return this.request(He(u||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:l,data:d}))}}Je.prototype[e]=o(),Je.prototype[e+"Form"]=o(!0)});let Ph=class Fs{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let o;this.promise=new Promise(function(l){o=l});const t=this;this.promise.then(a=>{if(!t._listeners)return;let l=t._listeners.length;for(;l-- >0;)t._listeners[l](a);t._listeners=null}),this.promise.then=a=>{let l;const d=new Promise(u=>{t.subscribe(u),l=u}).then(a);return d.cancel=function(){t.unsubscribe(l)},d},e(function(l,d,u){t.reason||(t.reason=new Qe(l,d,u),o(t.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const o=this._listeners.indexOf(e);o!==-1&&this._listeners.splice(o,1)}toAbortSignal(){const e=new AbortController,o=t=>{e.abort(t)};return this.subscribe(o),e.signal.unsubscribe=()=>this.unsubscribe(o),e.signal}static source(){let e;return{token:new Fs(function(a){e=a}),cancel:e}}};function kh(n){return function(o){return n.apply(null,o)}}function Ch(n){return I.isObject(n)&&n.isAxiosError===!0}const Dt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Dt).forEach(([n,e])=>{Dt[e]=n});function Ds(n){const e=new Je(n),o=us(Je.prototype.request,e);return I.extend(o,Je.prototype,e,{allOwnKeys:!0}),I.extend(o,e,null,{allOwnKeys:!0}),o.create=function(a){return Ds(He(n,a))},o}const Pe=Ds(lt);Pe.Axios=Je;Pe.CanceledError=Qe;Pe.CancelToken=Ph;Pe.isCancel=Cs;Pe.VERSION=Ms;Pe.toFormData=_t;Pe.AxiosError=se;Pe.Cancel=Pe.CanceledError;Pe.all=function(e){return Promise.all(e)};Pe.spread=kh;Pe.isAxiosError=Ch;Pe.mergeConfig=He;Pe.AxiosHeaders=Fe;Pe.formToJSON=n=>ks(I.isHTMLForm(n)?new FormData(n):n);Pe.getAdapter=xs.getAdapter;Pe.HttpStatusCode=Dt;Pe.default=Pe;const{Axios:Fg,AxiosError:Dg,CanceledError:Ng,isCancel:Ug,CancelToken:Og,VERSION:Lg,all:Bg,Cancel:qg,isAxiosError:Vg,spread:jg,toFormData:Gg,AxiosHeaders:zg,HttpStatusCode:Jg,formToJSON:Hg,getAdapter:Wg,mergeConfig:Kg}=Pe;class Eh{static async getAvailableModels(){try{return(await Pe({url:"/api/models/available-models",method:"GET",baseURL:""})).data}catch(e){return console.error("Failed to fetch available models:",e),{options:[],total:0}}}}const Th={class:"assigned-tools"},Ih={class:"section-header"},Rh={class:"tool-info"},Ah={class:"tool-name"},xh={class:"tool-desc"},Mh={key:0,class:"no-tools"},Fh=we({__name:"AssignedTools",props:{title:{},selectedToolIds:{},availableTools:{},addButtonText:{default:"Add/Remove Tools"},emptyText:{default:"No tools assigned"},showAddButton:{type:Boolean,default:!0},useGridLayout:{type:Boolean,default:!1}},emits:["add-tools","tools-filtered"],setup(n,{emit:e}){const o=n,t=e,a=fe(()=>Array.isArray(o.selectedToolIds)?o.selectedToolIds.filter(u=>o.availableTools.some(h=>h.key===u)):[]);pe(a,u=>{const h=o.selectedToolIds.length;u.length!==h&&t("tools-filtered",u)},{immediate:!0});const l=u=>{const h=o.availableTools.find(m=>m.key===u);return h?`${h.serviceGroup||"Ungrouped"}.${h.name}`:u},d=u=>{const h=o.availableTools.find(c=>c.key===u);return h?h.description:""};return(u,h)=>(p(),g("div",Th,[s("div",Ih,[s("span",null,i(u.title)+" ("+i(a.value.length)+")",1),u.showAddButton?(p(),g("button",{key:0,class:"action-btn small",onClick:h[0]||(h[0]=c=>u.$emit("add-tools"))},[E(r(T),{icon:"carbon:add"}),re(" "+i(u.addButtonText),1)])):V("",!0)]),s("div",{class:le(["tools-grid",{"grid-layout":u.useGridLayout}])},[(p(!0),g(ie,null,he(a.value,c=>(p(),g("div",{key:c,class:"tool-item assigned"},[s("div",Rh,[s("span",Ah,i(l(c)),1),s("span",xh,i(d(c)),1)])]))),128)),a.value.length===0?(p(),g("div",Mh,[E(r(T),{icon:"carbon:tool-box"}),s("span",null,i(u.emptyText),1)])):V("",!0)],2)]))}}),Dh=$e(Fh,[["__scopeId","data-v-10f40d60"]]),Nh={class:"tool-selection-content"},Uh={class:"tool-controls"},Oh={class:"search-container"},Lh=["placeholder"],Bh={class:"sort-container"},qh={value:"group"},Vh={value:"name"},jh={value:"enabled"},Gh={class:"tool-summary"},zh={class:"summary-text"},Jh={key:0,class:"tool-groups"},Hh=["onClick"],Wh={class:"group-title-area"},Kh={class:"group-name"},Xh={class:"group-count"},Qh={class:"group-enable-all"},Yh=["checked","onChange","data-group"],Zh={class:"enable-label"},em={class:"tool-info"},tm={class:"tool-selection-name"},sm={key:0,class:"tool-selection-desc"},om={class:"tool-actions"},nm=["checked","onChange"],am={key:1,class:"empty-state"},lm=we({__name:"ToolSelectionModal",props:{modelValue:{type:Boolean},tools:{},selectedToolIds:{}},emits:["update:modelValue","confirm"],setup(n,{emit:e}){const o=n,t=e,a=fe({get:()=>o.modelValue,set:P=>t("update:modelValue",P)}),l=D(""),d=D("group"),u=D(new Set),h=D([]),c=(P,N)=>{const z=document.querySelector(`input[data-group="${P}"]`);z&&(z.indeterminate=b(N))};pe(()=>o.selectedToolIds,P=>{h.value=[...P]},{immediate:!0});const m=fe(()=>{let P=o.tools.filter(N=>N.key);if(P=P.filter(N=>N.selectable===!0),l.value){const N=l.value.toLowerCase();P=P.filter(z=>z.name.toLowerCase().includes(N)||z.description.toLowerCase().includes(N)||z.serviceGroup.toLowerCase().includes(N))}switch(d.value){case"name":P=[...P].sort((N,z)=>N.name.localeCompare(z.name));break;case"enabled":P=[...P].sort((N,z)=>{const k=h.value.includes(N.key),x=h.value.includes(z.key);return k&&!x?-1:!k&&x?1:N.name.localeCompare(z.name)});break;case"group":default:P=[...P].sort((N,z)=>{const k=N.serviceGroup||"Ungrouped",x=z.serviceGroup||"Ungrouped";return k!==x?k.localeCompare(x):N.name.localeCompare(z.name)});break}return P}),S=fe(()=>{const P=new Map;return m.value.forEach(N=>{const z=N.serviceGroup||"Ungrouped";P.has(z)||P.set(z,[]),P.get(z).push(N)}),new Map([...P.entries()].sort())}),A=fe(()=>m.value.length);pe([h,S],()=>{Ae(()=>{for(const[P,N]of S.value)c(P,N)})},{flush:"post",deep:!1});const L=P=>h.value.includes(P),M=(P,N)=>{N.stopPropagation();const k=N.target.checked;if(!P){console.error("toolKey is undefined, cannot proceed");return}k?h.value.includes(P)||(h.value=[...h.value,P]):h.value=h.value.filter(x=>x!==P)},$=P=>P.filter(N=>h.value.includes(N.key)),C=P=>P.length>0&&P.every(N=>h.value.includes(N.key)),b=P=>{const N=$(P).length;return N>0&&N<P.length},y=(P,N)=>{N.stopPropagation();const k=N.target.checked,x=P.map(j=>j.key);if(k){const j=[...h.value];x.forEach(Z=>{j.includes(Z)||j.push(Z)}),h.value=j}else h.value=h.value.filter(j=>!x.includes(j))},v=P=>{u.value.has(P)?u.value.delete(P):u.value.add(P)},_=()=>{t("confirm",[...h.value]),t("update:modelValue",!1)},f=()=>{h.value=[...o.selectedToolIds],t("update:modelValue",!1)};return pe(a,P=>{if(P){u.value.clear();const N=Array.from(S.value.keys());N.length>1&&N.slice(1).forEach(z=>{u.value.add(z)})}}),(P,N)=>(p(),me(as,{modelValue:a.value,"onUpdate:modelValue":[N[4]||(N[4]=z=>a.value=z),f],title:P.$t("toolSelection.title"),onConfirm:_},{default:Ke(()=>[s("div",Nh,[s("div",Uh,[s("div",Oh,[de(s("input",{"onUpdate:modelValue":N[0]||(N[0]=z=>l.value=z),type:"text",class:"search-input",placeholder:P.$t("toolSelection.searchPlaceholder")},null,8,Lh),[[_e,l.value]])]),s("div",Bh,[de(s("select",{"onUpdate:modelValue":N[1]||(N[1]=z=>d.value=z),class:"sort-select"},[s("option",qh,i(P.$t("toolSelection.sortByGroup")),1),s("option",Vh,i(P.$t("toolSelection.sortByName")),1),s("option",jh,i(P.$t("toolSelection.sortByStatus")),1)],512),[[mt,d.value]])])]),s("div",Gh,[s("span",zh,i(P.$t("toolSelection.summary",{groups:S.value.size,tools:A.value,selected:h.value.length})),1)]),S.value.size>0?(p(),g("div",Jh,[(p(!0),g(ie,null,he(S.value,([z,k])=>(p(),g("div",{key:z,class:"tool-group"},[s("div",{class:le(["tool-group-header",{collapsed:u.value.has(z)}]),onClick:x=>v(z)},[s("div",Wh,[E(r(T),{icon:u.value.has(z)?"carbon:chevron-right":"carbon:chevron-down",class:"collapse-icon"},null,8,["icon"]),E(r(T),{icon:"carbon:folder",class:"group-icon"}),s("span",Kh,i(z),1),s("span",Xh," ("+i($(k).length)+"/"+i(k.length)+") ",1)]),s("div",{class:"group-actions",onClick:N[2]||(N[2]=Se(()=>{},["stop"]))},[s("label",Qh,[s("input",{type:"checkbox",class:"group-enable-checkbox",checked:C(k),onChange:x=>y(k,x),"data-group":z},null,40,Yh),s("span",Zh,i(P.$t("toolSelection.enableAll")),1)])])],10,Hh),s("div",{class:le(["tool-group-content",{collapsed:u.value.has(z)}])},[(p(!0),g(ie,null,he(k,x=>(p(),g("div",{key:x.key,class:"tool-selection-item"},[s("div",em,[s("div",tm,i(x.name),1),x.description?(p(),g("div",sm,i(x.description),1)):V("",!0)]),s("div",om,[s("label",{class:"tool-enable-switch",onClick:N[3]||(N[3]=Se(()=>{},["stop"]))},[s("input",{type:"checkbox",class:"tool-enable-checkbox",checked:L(x.key),onChange:j=>M(x.key,j)},null,40,nm),N[5]||(N[5]=s("span",{class:"tool-enable-slider"},null,-1))])])]))),128))],2)]))),128))])):(p(),g("div",am,[E(r(T),{icon:"carbon:tools",class:"empty-icon"}),s("p",null,i(P.$t("toolSelection.noToolsFound")),1)]))])]),_:1},8,["modelValue","title"]))}}),rm=$e(lm,[["__scopeId","data-v-197aa115"]]),im={class:"config-section"},cm={class:"section-header"},dm={key:0,class:"error-section"},um={class:"error-message"},pm={class:"error-content"},hm={class:"error-title"},mm={class:"error-description"},fm={key:1,class:"visual-editor"},gm={class:"plan-basic-info"},vm={class:"form-row"},bm={class:"form-label"},ym=["placeholder"],_m={key:0,class:"field-error-message"},Sm={class:"form-row"},wm={class:"form-label"},$m=["value","placeholder"],Pm={class:"steps-section"},km={class:"steps-header"},Cm={class:"form-label"},Em={class:"steps-actions"},Tm=["title"],Im={class:"steps-container"},Rm={class:"step-header"},Am={class:"step-number"},xm={class:"step-actions"},Mm=["onClick","disabled","title"],Fm=["onClick","disabled","title"],Dm=["onClick","title"],Nm={class:"step-content"},Um={class:"form-row"},Om={class:"form-label"},Lm=["onUpdate:modelValue","placeholder"],Bm={class:"form-row"},qm={class:"form-label"},Vm=["onUpdate:modelValue","placeholder"],jm={key:0,class:"preview-section"},Gm={class:"preview-label"},zm={class:"preview-content"},Jm={class:"preview-text"},Hm={class:"preview-table-header"},Wm={class:"form-row"},Km={class:"form-label"},Xm={class:"model-selector-wrapper"},Qm={class:"model-input-wrapper"},Ym=["value","placeholder","disabled","onClick","onFocus","onInput","onKeydown"],Zm={key:0,class:"dropdown-item disabled"},ef={key:1,class:"dropdown-item disabled error"},tf={key:2,class:"dropdown-item disabled"},sf=["onClick","onMouseenter"],of=["onClick","onMouseenter"],nf=["title"],af={key:0,class:"error-message"},lf={class:"form-row"},rf={key:0,class:"empty-steps"},cf={key:0,class:"json-preview"},df={class:"preview-header"},uf={class:"form-label"},pf={class:"json-code"},hf={class:"editor-footer"},mf={class:"section-actions"},ff=["disabled","title"],gf=["disabled","title"],vf=["disabled","title"],bf=["disabled"],yf=we({__name:"JsonEditorV2",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},currentPlanTemplateId:{default:""}},emits:["rollback","restore","save","copy-plan","update:jsonContent"],setup(n,{emit:e}){const{t:o}=Ue(),t=n,a=e,l={...t,hiddenFields:[]},{showJsonPreview:d,displayData:u,formattedJsonOutput:h,addStep:c,removeStep:m,moveStepUp:S,moveStepDown:A,handleRollback:L,handleRestore:M,handleSave:$,toggleJsonPreview:C,closeJsonPreview:b}=ds(l,a),y=D(null),v=D(""),_=D([]),f=D(!1),P=D(""),N=D(new Map),z=D(new Set),k=D(new Map),x=w=>N.value.get(w)??"",j=(w,J)=>{N.value.set(w,J)},Z=w=>{const J=x(w);if(!J.trim())return _.value;const ae=J.toLowerCase().trim();return _.value.filter(oe=>oe.value.toLowerCase().includes(ae)||oe.label.toLowerCase().includes(ae))},Y=w=>{const J=u.steps[w],ae=x(w);return z.value.has(w)&&ae!==""?ae:J.modelName??""},K=w=>f.value||P.value||u.steps[w].modelName?"":o("sidebar.modelNameDescription")||"",X=w=>z.value.has(w),ne=w=>{f.value||z.value.add(w)},ge=w=>{z.value.delete(w),k.value.set(w,-1);const J=u.steps[w];j(w,J.modelName??"")},ke=w=>{X(w)?ge(w):ne(w)},H=(w,J)=>{const ae=u.steps[J];ae.modelName=w,j(J,w),ge(J)},G=(w,J)=>{const ae=w.target;j(J,ae.value),ne(J)},U=w=>k.value.get(w)??-1,R=(w,J)=>{k.value.set(w,J)},O=w=>{const J=U(w),ae=Z(w);J>=0&&J<ae.length?H(ae[J].value,w):J===-1?H("",w):ae.length>0?H(ae[0].value,w):u.steps[w].modelName||H("",w)},B=w=>{if(!X(w)){ne(w),R(w,0);return}const ae=Z(w).length+1,oe=U(w),ce=Math.min(oe+1,ae-1);R(w,ce)},Q=w=>{if(!X(w)){ne(w);const oe=Z(w);R(w,oe.length);return}const J=U(w),ae=Math.max(J-1,-1);R(w,ae)},ye=w=>{w.target.closest(".model-selector")||z.value.clear()};pe(()=>u.steps,w=>{w.forEach((J,ae)=>{N.value.has(ae)||j(ae,J.modelName??"")})},{deep:!0,immediate:!0});const F=D(!1),W=D(-1),ve=async()=>{if(!f.value){f.value=!0,P.value="";try{const w=await Eh.getAvailableModels();_.value=w.options}catch(w){console.error("Failed to load models:",w),P.value=w instanceof Error?w.message:"Failed to load models",_.value=[]}finally{f.value=!1}}},ee=w=>{W.value=w,F.value=!0,console.log("[JsonEditorV2] Available tools from store:",q.availableTools)},te=w=>{W.value>=0&&W.value<u.steps.length&&(u.steps[W.value].selectedToolKeys=[...w]),F.value=!1,W.value=-1},be=(w,J)=>{w>=0&&w<u.steps.length&&(u.steps[w].selectedToolKeys=[...J])},xe=()=>{a("copy-plan")},Ce=()=>{try{y.value=null,u.title||(u.title=""),u.directResponse=!1}catch(w){const J=`Failed to initialize JsonEditorV2: ${w instanceof Error?w.message:"Unknown error"}`;y.value=J,console.error(J,w)}};pe(()=>u,w=>{try{w.title.trim()?v.value="":v.value="Title is required field",y.value=null}catch(J){y.value=`Invalid data structure: ${J instanceof Error?J.message:"Unknown error"}`,v.value=""}},{immediate:!0,deep:!0}),pe(()=>t.jsonContent,(w,J)=>{if(console.log("[JsonEditorV2] Props watch triggered - jsonContent changed from",J,"to",w),w&&w!==J){console.log("[JsonEditorV2] Force parsing new jsonContent:",w);try{const ae=JSON.parse(w);console.log("[JsonEditorV2] Parsed new jsonContent:",ae),Object.assign(u,{title:ae.title||"",steps:ae.steps||[],directResponse:!1,planTemplateId:ae.planTemplateId||t.currentPlanTemplateId||"",planType:ae.planType||"dynamic_agent"}),console.log("[JsonEditorV2] Updated displayData with new content:",u)}catch(ae){console.warn("[JsonEditorV2] Failed to parse new jsonContent:",ae)}}},{immediate:!0}),De(()=>{if(console.log("[JsonEditorV2] Component mounted with jsonContent:",t.jsonContent),console.log("[JsonEditorV2] Component mounted with currentPlanTemplateId:",t.currentPlanTemplateId),console.log("[JsonEditorV2] Component mounted with displayData:",u),t.jsonContent){console.log("[JsonEditorV2] Force parsing jsonContent on mount:",t.jsonContent);try{const w=JSON.parse(t.jsonContent);console.log("[JsonEditorV2] Parsed jsonContent on mount:",w),Object.assign(u,{title:w.title||"",steps:w.steps||[],directResponse:!1,planTemplateId:w.planTemplateId||t.currentPlanTemplateId||"",planType:w.planType||"dynamic_agent"}),console.log("[JsonEditorV2] Updated displayData on mount:",u)}catch(w){console.warn("[JsonEditorV2] Failed to parse jsonContent on mount:",w)}}Ce(),ve(),document.addEventListener("click",ye)}),Ne(()=>{document.removeEventListener("click",ye)});const Ie=w=>{const J=w.target;J.style.height="auto";const ae=20,oe=Math.ceil(J.scrollHeight/ae),ce=4,ue=12,Ye=Math.max(ce,Math.min(ue,oe)),$t=Ye*ae;J.style.height=`${$t}px`,J.rows=Ye,oe>ue?J.style.overflowY="auto":J.style.overflowY="hidden"},Ee=w=>{if(!w.trim())return"";const J=w.split(",").map(ae=>ae.trim()).filter(ae=>ae.length>0);return J.length===0?"":`|${J.join("|")}|`};return(w,J)=>{var ae;return p(),g("div",im,[s("div",cm,[E(r(T),{icon:"carbon:code",width:"16"}),s("span",null,i(w.$t("sidebar.dynamicAgentPlan")),1)]),y.value?(p(),g("div",dm,[s("div",um,[E(r(T),{icon:"carbon:warning",width:"16"}),s("div",pm,[s("div",hm,i(w.$t("sidebar.planTypeError")),1),s("div",mm,i(y.value),1)])])])):(p(),g("div",fm,[s("div",gm,[s("div",vm,[s("label",bm,i(w.$t("sidebar.title")),1),de(s("input",{"onUpdate:modelValue":J[0]||(J[0]=oe=>r(u).title=oe),type:"text",class:le(["form-input",{error:v.value}]),placeholder:w.$t("sidebar.titlePlaceholder")},null,10,ym),[[_e,r(u).title]]),v.value?(p(),g("div",_m,[E(r(T),{icon:"carbon:warning",width:"12"}),re(" "+i(v.value),1)])):V("",!0)]),s("div",Sm,[s("label",wm,i(w.$t("sidebar.planTemplateId")),1),s("input",{value:w.currentPlanTemplateId,type:"text",class:"form-input readonly-input",readonly:"",placeholder:w.$t("sidebar.planTemplateIdPlaceholder")},null,8,$m)])]),s("div",Pm,[s("div",km,[s("label",Cm,i(w.$t("sidebar.tasks")),1),s("div",Em,[s("button",{onClick:J[1]||(J[1]=(...oe)=>r(c)&&r(c)(...oe)),class:"btn btn-xs",title:w.$t("sidebar.addStep")},[E(r(T),{icon:"carbon:add",width:"12"})],8,Tm)])]),s("div",Im,[(p(!0),g(ie,null,he(r(u).steps,(oe,ce)=>(p(),g("div",{key:ce,class:"step-item"},[s("div",Rm,[s("span",Am,i(w.$t("sidebar.subtask"))+" "+i(ce+1),1),s("div",xm,[s("button",{onClick:ue=>r(S)(ce),disabled:ce===0,class:"btn btn-xs",title:w.$t("sidebar.moveUp")},[E(r(T),{icon:"carbon:chevron-up",width:"12"})],8,Mm),s("button",{onClick:ue=>r(A)(ce),disabled:ce===r(u).steps.length-1,class:"btn btn-xs",title:w.$t("sidebar.moveDown")},[E(r(T),{icon:"carbon:chevron-down",width:"12"})],8,Fm),s("button",{onClick:ue=>r(m)(ce),class:"btn btn-xs btn-danger",title:w.$t("sidebar.removeStep")},[E(r(T),{icon:"carbon:trash-can",width:"12"})],8,Dm)])]),s("div",Nm,[s("div",Um,[s("label",Om,i(w.$t("sidebar.stepRequirement")),1),de(s("textarea",{"onUpdate:modelValue":ue=>oe.stepRequirement=ue,class:"form-textarea auto-resize",placeholder:w.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:J[2]||(J[2]=ue=>Ie(ue))},null,40,Lm),[[_e,oe.stepRequirement]])]),s("div",Bm,[s("label",qm,i(w.$t("sidebar.terminateColumns")),1),de(s("textarea",{"onUpdate:modelValue":ue=>oe.terminateColumns=ue,class:"form-textarea auto-resize",placeholder:w.$t("sidebar.terminateColumnsPlaceholder"),rows:"4",onInput:J[3]||(J[3]=ue=>Ie(ue))},null,40,Vm),[[_e,oe.terminateColumns]]),oe.terminateColumns&&oe.terminateColumns.trim()?(p(),g("div",jm,[s("div",Gm,i(w.$t("sidebar.preview"))+":",1),s("div",zm,[s("div",Jm,[re(i(w.$t("sidebar.systemWillReturnListWithTableHeaderFormat"))+": ",1),s("span",Hm,i(Ee(oe.terminateColumns)),1)])])])):V("",!0)]),s("div",Wm,[s("label",Km,i(w.$t("sidebar.modelName")),1),s("div",Xm,[s("div",{class:le(["model-selector",{"is-open":X(ce),"is-disabled":f.value}])},[s("div",Qm,[s("input",{value:Y(ce),type:"text",class:"form-input model-search-input",placeholder:K(ce),disabled:f.value,onClick:Se(ue=>ne(ce),["stop"]),onFocus:ue=>ne(ce),onInput:ue=>G(ue,ce),onKeydown:[et(ue=>ge(ce),["escape"]),et(Se(ue=>O(ce),["prevent"]),["enter"]),et(Se(ue=>B(ce),["prevent"]),["down"]),et(Se(ue=>Q(ce),["prevent"]),["up"])]},null,40,Ym),E(r(T),{icon:"carbon:chevron-down",width:"14",class:le(["dropdown-arrow",{"is-open":X(ce)}]),onClick:Se(ue=>ke(ce),["stop"])},null,8,["class","onClick"])]),X(ce)?(p(),g("div",{key:0,class:"model-dropdown",onClick:J[4]||(J[4]=Se(()=>{},["stop"]))},[f.value?(p(),g("div",Zm,i(w.$t("sidebar.loading")),1)):P.value?(p(),g("div",ef,i(w.$t("sidebar.modelLoadError")),1)):Z(ce).length===0?(p(),g("div",tf,i(w.$t("sidebar.noModelsFound")),1)):V("",!0),(p(!0),g(ie,null,he(Z(ce),(ue,Ye)=>(p(),g("div",{key:ue.value,class:le(["dropdown-item",{"is-selected":oe.modelName===ue.value,"is-highlighted":U(ce)===Ye}]),onClick:$t=>H(ue.value,ce),onMouseenter:$t=>R(ce,Ye)},[re(i(ue.value)+" ",1),oe.modelName===ue.value?(p(),me(r(T),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"})):V("",!0)],42,sf))),128)),s("div",{class:le(["dropdown-item",{"is-selected":!oe.modelName,"is-highlighted":U(ce)===-1}]),onClick:ue=>H("",ce),onMouseenter:ue=>R(ce,-1)},[re(i(w.$t("sidebar.noModelSelected"))+" ",1),oe.modelName?V("",!0):(p(),me(r(T),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"}))],42,of)])):V("",!0)],2),P.value?(p(),g("button",{key:0,onClick:ve,class:"btn btn-sm btn-danger",title:w.$t("sidebar.retryLoadModels")},[E(r(T),{icon:"carbon:warning",width:"14"}),re(" "+i(w.$t("sidebar.retry")),1)],8,nf)):V("",!0)]),P.value?(p(),g("div",af,[E(r(T),{icon:"carbon:warning",width:"12"}),re(" "+i(P.value),1)])):V("",!0)]),s("div",lf,[E(Dh,{title:w.$t("sidebar.selectedTools"),"selected-tool-ids":oe.selectedToolKeys,"available-tools":r(q).availableTools,"add-button-text":w.$t("sidebar.addRemoveTools"),"empty-text":w.$t("sidebar.noTools"),"use-grid-layout":!0,onAddTools:ue=>ee(ce),onToolsFiltered:ue=>be(ce,ue)},null,8,["title","selected-tool-ids","available-tools","add-button-text","empty-text","onAddTools","onToolsFiltered"])])])]))),128)),r(u).steps.length===0?(p(),g("div",rf,[E(r(T),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),s("p",null,i(w.$t("sidebar.noSteps")),1),s("button",{onClick:J[5]||(J[5]=(...oe)=>r(c)&&r(c)(...oe)),class:"btn btn-primary"},[E(r(T),{icon:"carbon:add",width:"14"}),re(" "+i(w.$t("sidebar.addFirstStep")),1)])])):V("",!0)])]),r(d)?(p(),g("div",cf,[s("div",df,[s("label",uf,i(w.$t("sidebar.jsonPreview")),1),s("button",{onClick:J[6]||(J[6]=(...oe)=>r(b)&&r(b)(...oe)),class:"btn btn-xs"},[E(r(T),{icon:"carbon:close",width:"12"})])]),s("pre",pf,i(r(h)),1)])):V("",!0),s("div",hf,[s("button",{onClick:J[7]||(J[7]=(...oe)=>r(C)&&r(C)(...oe)),class:"btn btn-sm btn-secondary"},[E(r(T),{icon:"carbon:code",width:"14"}),re(" "+i(r(d)?w.$t("sidebar.hideJson"):w.$t("sidebar.showJson")),1)]),s("div",mf,[s("button",{class:"btn btn-sm",onClick:xe,disabled:w.isGenerating||w.isExecuting,title:w.$t("sidebar.copyPlan")},[E(r(T),{icon:"carbon:copy",width:"14"}),re(" "+i(w.$t("sidebar.copyPlan")),1)],8,ff),s("button",{class:"btn btn-sm",onClick:J[8]||(J[8]=(...oe)=>r(L)&&r(L)(...oe)),disabled:!(w.canRollback??!1),title:w.$t("sidebar.rollback")},[E(r(T),{icon:"carbon:undo",width:"14"})],8,gf),s("button",{class:"btn btn-sm",onClick:J[9]||(J[9]=(...oe)=>r(M)&&r(M)(...oe)),disabled:!(w.canRestore??!1),title:w.$t("sidebar.restore")},[E(r(T),{icon:"carbon:redo",width:"14"})],8,vf),s("button",{class:"btn btn-primary",onClick:J[10]||(J[10]=(...oe)=>r($)&&r($)(...oe)),disabled:w.isGenerating||w.isExecuting},[E(r(T),{icon:"carbon:save",width:"14"}),J[12]||(J[12]=re(" Save "))],8,bf)])])])),E(rm,{modelValue:F.value,"onUpdate:modelValue":J[11]||(J[11]=oe=>F.value=oe),tools:r(q).availableTools,"selected-tool-ids":W.value>=0?((ae=r(u).steps[W.value])==null?void 0:ae.selectedToolKeys)||[]:[],onConfirm:te},null,8,["modelValue","tools","selected-tool-ids"])])}}}),_f=$e(yf,[["__scopeId","data-v-91854736"]]),Sf={class:"sidebar-content"},wf={class:"sidebar-content-header"},$f={class:"sidebar-content-title"},Pf={class:"tab-switcher"},kf=["disabled"],Cf={key:0,class:"tab-content"},Ef={class:"organization-section"},Tf={class:"organization-selector"},If={class:"organization-label-row"},Rf={class:"organization-label"},Af=["value"],xf={value:"by_time"},Mf={value:"by_abc"},Ff={value:"by_group_time"},Df={value:"by_group_abc"},Nf={class:"sidebar-content-list"},Uf={key:0,class:"loading-state"},Of={key:1,class:"error-state"},Lf={key:2,class:"empty-state"},Bf=["onClick","title"],qf=["onClick","title"],Vf={class:"group-name"},jf={class:"group-count"},Gf=["onClick"],zf={class:"task-icon"},Jf={class:"task-details"},Hf={class:"task-title"},Wf={class:"task-preview"},Kf={class:"task-time"},Xf={class:"task-actions"},Qf=["title","onClick"],Yf={key:1,class:"tab-content config-tab"},Zf={key:0,class:"config-container"},eg={class:"template-info-header"},tg={class:"template-info"},sg={class:"template-id"},og=["title"],ng={class:"modal-header"},ag={class:"modal-body"},lg={class:"form-row"},rg={class:"form-label"},ig=["placeholder"],cg={class:"modal-footer"},dg=["disabled"],ug=we({__name:"Sidebar",emits:["planExecutionRequested"],setup(n,{expose:e,emit:o}){const{t}=Ue(),a=ls(),l=D(80),d=D(!1),u=D(0),h=D(0),c=D(null),m=D({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}),S=D({}),A=D(null),L=D({enabled:!0,success:!0}),M=fe(()=>L.value.enabled);pe(()=>q.currentPlanTemplateId,(F,W)=>{console.log("[Sidebar] currentPlanTemplateId changed from",W,"to",F)}),pe(()=>q.jsonContent,(F,W)=>{console.log("[Sidebar] jsonContent changed from",W,"to",F)});const $=async()=>{try{const F=await Oe.getCoordinatorToolConfig();L.value=F}catch(F){console.error("Failed to load CoordinatorTool configuration:",F),L.value={enabled:!0,success:!1,message:F instanceof Error?F.message:"Unknown error"}}},C=o,b=async()=>{try{const F=await q.saveTemplate();F!=null&&F.duplicate?a.success(t("sidebar.saveCompleted",{message:F.message,versionCount:F.versionCount})):F!=null&&F.saved?(a.success(t("sidebar.saveSuccess",{message:F.message,versionCount:F.versionCount})),v()):F!=null&&F.message&&a.success(t("sidebar.saveStatus",{message:F.message}))}catch(F){throw console.error("Failed to save plan modifications:",F),a.error(F.message||t("sidebar.saveFailed")),F}},y=async()=>{console.log("[Sidebar] ðŸ’¾ Save before execute requested"),await b()},v=async()=>{await new Promise(F=>setTimeout(F,1e3)),console.log("[Sidebar] ðŸ”„ Refreshing parameter requirements for templateId:",q.currentPlanTemplateId),await Ae(),c.value?(console.log("[Sidebar] ðŸ“ž Calling ExecutionController.loadParameterRequirements()"),c.value.loadParameterRequirements(),setTimeout(()=>{c.value&&(console.log("[Sidebar] ðŸ”„ Retry: Calling ExecutionController.loadParameterRequirements() again"),c.value.loadParameterRequirements())},2e3)):console.warn("[Sidebar] âš ï¸ ExecutionController ref not available"),A.value?(console.log("[Sidebar] ðŸ“ž Calling PublishMcpServiceModal.loadParameterRequirements()"),A.value.loadParameterRequirements()):console.warn("[Sidebar] âš ï¸ PublishMcpServiceModal ref not available")},_=()=>{try{typeof q.rollbackVersion=="function"?q.rollbackVersion():console.warn("rollbackVersion method is not available")}catch(F){console.error("Error during rollback operation:",F),a.error(t("sidebar.rollbackFailed")||"Rollback failed")}},f=()=>{try{typeof q.restoreVersion=="function"?q.restoreVersion():console.warn("restoreVersion method is not available")}catch(F){console.error("Error during restore operation:",F),a.error(t("sidebar.restoreFailed")||"Restore failed")}},P=async F=>{var W;console.log("[Sidebar] ðŸŽ¯ handleExecutePlan called with payload:",JSON.stringify(F,null,2)),console.log("[Sidebar] ðŸ“Š Current sidebarStore state:",{currentPlanTemplateId:q.currentPlanTemplateId,selectedTemplate:(W=q.selectedTemplate)==null?void 0:W.id,jsonContent:q.jsonContent.substring(0,100)+"..."});try{const ve=q.preparePlanExecution();if(console.log("[Sidebar] ðŸ“‹ Prepared plan data:",JSON.stringify(ve,null,2)),!ve){console.log("[Sidebar] âŒ No plan data available, returning");return}const ee={...ve,uploadedFiles:F.uploadedFiles,uploadKey:F.uploadKey};F.replacementParams&&Object.keys(F.replacementParams).length>0&&(console.log("[Sidebar] ðŸ”„ Processing replacement parameters:",F.replacementParams),ee.replacementParams=F.replacementParams),console.log("[Sidebar] âœ… Final plan data:",JSON.stringify(ee,null,2));const te={...F,title:ee.title,planData:ee.planData,params:ee.params,uploadedFiles:ee.uploadedFiles,uploadKey:ee.uploadKey};console.log("[Sidebar] ðŸ“¤ Emitting planExecutionRequested with final payload:",JSON.stringify(te,null,2)),C("planExecutionRequested",te),console.log("[Sidebar] âœ… Event emitted successfully")}catch(ve){console.error("[Sidebar] âŒ Error executing plan:",ve),a.error(t("sidebar.executeFailed")+": "+ve.message)}finally{console.log("[Sidebar] ðŸ§¹ Cleaning up after execution"),q.finishPlanExecution(),q.clearExecutionParams(),c.value&&(console.log("[Sidebar] ðŸ§¹ Calling ExecutionController.clearExecutionParams"),c.value.clearExecutionParams()),console.log("[Sidebar] âœ… Cleanup completed")}},N=D(!1),z=D(!1),k=D(""),x=D(!1),j=()=>{if(console.log("[Sidebar] Publish MCP service button clicked"),console.log("[Sidebar] currentPlanTemplateId:",q.currentPlanTemplateId),!q.currentPlanTemplateId){console.log("[Sidebar] No plan template selected, showing warning"),a.error(t("mcpService.selectPlanTemplateFirst"));return}console.log("[Sidebar] Opening publish MCP service modal"),N.value=!0},Z=async F=>{F===null?(console.log("MCP service deleted successfully"),a.success(t("mcpService.deleteSuccess")),m.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}):(console.log("MCP service published successfully:",F),a.success(t("mcpService.publishSuccess")),m.value={...F,toolName:F.toolName,serviceGroup:F.serviceGroup??""}),console.log("[Sidebar] ðŸ”„ Reloading available tools after service publish/delete"),await q.loadAvailableTools(),await R()},Y=()=>{q.clearExecutionParams()},K=F=>{q.executionParams=F},X=()=>{if(console.log("[Sidebar] Copy plan clicked"),!q.selectedTemplate){console.log("[Sidebar] No template selected, cannot copy"),a.error(t("sidebar.selectPlanFirst"));return}k.value=(q.selectedTemplate.title??t("sidebar.unnamedPlan"))+" (copy)",console.log("[Sidebar] Opening copy plan modal"),z.value=!0},ne=()=>{z.value=!1,k.value="",x.value=!1},ge=async()=>{if(!k.value.trim()){a.error(t("sidebar.titleRequired"));return}if(!q.selectedTemplate||!q.jsonContent){a.error(t("sidebar.noPlanToCopy"));return}x.value=!0;try{const W={...JSON.parse(q.jsonContent),title:k.value.trim(),planTemplateId:""},{PlanActApiService:ve}=await ns(async()=>{const{PlanActApiService:te}=await import("./sidebar-BUbOWah5.js").then(be=>be.p);return{PlanActApiService:te}},__vite__mapDeps([0,1,2,3])),ee=await ve.savePlanTemplate("",JSON.stringify(W));ee.saved?(a.success(t("sidebar.copyPlanSuccess",{title:k.value.trim()})),await q.loadPlanTemplateList(),ne()):a.error(t("sidebar.copyPlanFailed",{message:ee.message||"Unknown error"}))}catch(F){console.error("[Sidebar] Error copying plan:",F),a.error(t("sidebar.copyPlanFailed",{message:F.message||"Unknown error"}))}finally{x.value=!1}},ke=async F=>{if(!F){m.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""};return}try{const W=await Oe.getCoordinatorToolByTemplate(F);W?m.value={...W,toolName:W.toolName,serviceGroup:W.serviceGroup??""}:m.value={toolName:"",toolDescription:"",planTemplateId:F,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}catch(W){console.error("Failed to load tool information:",W),m.value={toolName:"",toolDescription:"",planTemplateId:F,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}},H=F=>{const W=F.target;q.setOrganizationMethod(W.value)},G=F=>{if(isNaN(F.getTime()))return console.warn("Invalid date received:",F),t("time.unknown");const ve=new Date().getTime()-F.getTime(),ee=Math.floor(ve/6e4),te=Math.floor(ve/36e5),be=Math.floor(ve/864e5);return ee<1?t("time.now"):ee<60?t("time.minuteAgo",{count:ee}):te<24?t("time.hourAgo",{count:te}):be<30?t("time.dayAgo",{count:be}):F.toLocaleDateString("zh-CN")},U=F=>{const W=S.value[F.id];return W?`${t("sidebar.publishedTool")}: ${W.toolName}`:""},R=async()=>{for(const F of q.planTemplateList)try{const W=await Oe.getCoordinatorToolByTemplate(F.id);W!=null&&W.toolName&&(S.value[F.id]=W)}catch(W){console.debug(`No tool found for template ${F.id}:`,W)}},O=F=>{d.value=!0,u.value=F.clientX,h.value=l.value,document.addEventListener("mousemove",B),document.addEventListener("mouseup",Q),document.body.style.cursor="col-resize",document.body.style.userSelect="none",F.preventDefault()},B=F=>{if(!d.value)return;const W=window.innerWidth,ee=(F.clientX-u.value)/W*100;let te=h.value+ee;te=Math.max(15,Math.min(100,te)),l.value=te},Q=()=>{d.value=!1,document.removeEventListener("mousemove",B),document.removeEventListener("mouseup",Q),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("sidebarWidth",l.value.toString())},ye=()=>{l.value=80,localStorage.setItem("sidebarWidth","80")};return pe(()=>q.currentPlanTemplateId,F=>{ke(F)},{immediate:!0}),De(async()=>{await q.loadPlanTemplateList(),await R(),$(),q.loadAvailableTools();const F=localStorage.getItem("sidebarWidth");F&&(l.value=parseFloat(F))}),Ne(()=>{document.removeEventListener("mousemove",B),document.removeEventListener("mouseup",Q)}),e({loadPlanTemplateList:q.loadPlanTemplateList,toggleSidebar:q.toggleSidebar,currentPlanTemplateId:q.currentPlanTemplateId}),(F,W)=>{var ve;return p(),g(ie,null,[s("div",{class:le(["sidebar-wrapper",{"sidebar-wrapper-collapsed":r(q).isCollapsed}]),style:We({width:l.value+"%"})},[s("div",Sf,[s("div",wf,[s("div",$f,i(F.$t("sidebar.title")),1)]),s("div",Pf,[s("button",{class:le(["tab-button",{active:r(q).currentTab==="list"}]),onClick:W[0]||(W[0]=ee=>r(q).switchToTab("list"))},[E(r(T),{icon:"carbon:list",width:"16"}),re(" "+i(F.$t("sidebar.templateList")),1)],2),s("button",{class:le(["tab-button",{active:r(q).currentTab==="config"}]),onClick:W[1]||(W[1]=ee=>r(q).switchToTab("config")),disabled:!r(q).selectedTemplate},[E(r(T),{icon:"carbon:settings",width:"16"}),re(" "+i(F.$t("sidebar.configuration")),1)],10,kf)]),r(q).currentTab==="list"?(p(),g("div",Cf,[s("div",Ef,[s("div",Tf,[s("div",If,[s("label",Rf,i(F.$t("sidebar.organizationMethod"))+":",1)]),s("select",{value:r(q).organizationMethod,onChange:H,class:"organization-select"},[s("option",xf,i(F.$t("sidebar.organizationByTime")),1),s("option",Mf,i(F.$t("sidebar.organizationByAbc")),1),s("option",Ff,i(F.$t("sidebar.organizationByGroupTime")),1),s("option",Df,i(F.$t("sidebar.organizationByGroupAbc")),1)],40,Af)]),s("button",{class:"new-task-btn",onClick:W[2]||(W[2]=()=>r(q).createNewTemplate(r(q).planType))},[E(r(T),{icon:"carbon:add",width:"16"}),re(" "+i(F.$t("sidebar.newPlan")),1)])]),s("div",Nf,[r(q).isLoading?(p(),g("div",Uf,[E(r(T),{icon:"carbon:circle-dash",width:"20",class:"spinning"}),s("span",null,i(F.$t("sidebar.loading")),1)])):r(q).errorMessage?(p(),g("div",Of,[E(r(T),{icon:"carbon:warning",width:"20"}),s("span",null,i(r(q).errorMessage),1),s("button",{onClick:W[3]||(W[3]=(...ee)=>r(q).loadPlanTemplateList&&r(q).loadPlanTemplateList(...ee)),class:"retry-btn"},i(F.$t("sidebar.retry")),1)])):r(q).planTemplateList.length===0?(p(),g("div",Lf,[E(r(T),{icon:"carbon:document",width:"32"}),s("span",null,i(F.$t("sidebar.noTemplates")),1)])):(p(!0),g(ie,{key:3},he(r(q).groupedTemplates,([ee,te])=>(p(),g(ie,{key:ee||"ungrouped"},[(r(q).organizationMethod==="by_group_time"||r(q).organizationMethod==="by_group_abc")&&te.length>0?(p(),g("div",{key:0,class:"group-header",onClick:be=>r(q).toggleGroupCollapse(ee),title:r(q).isGroupCollapsed(ee)?F.$t("sidebar.expandGroup"):F.$t("sidebar.collapseGroup")},[s("button",{class:"group-toggle-btn",onClick:Se(be=>r(q).toggleGroupCollapse(ee),["stop"]),title:r(q).isGroupCollapsed(ee)?F.$t("sidebar.expandGroup"):F.$t("sidebar.collapseGroup")},[E(r(T),{icon:r(q).isGroupCollapsed(ee)?"carbon:chevron-right":"carbon:chevron-down",width:"14"},null,8,["icon"])],8,qf),E(r(T),{icon:"carbon:folder",width:"16"}),s("span",Vf,i(ee===null||ee===""?F.$t("sidebar.ungroupedMethods"):ee),1),s("span",jf,"("+i(te.length)+")",1)],8,Bf)):V("",!0),(r(q).organizationMethod==="by_group_time"||r(q).organizationMethod==="by_group_abc")&&r(q).isGroupCollapsed(ee)?V("",!0):(p(!0),g(ie,{key:1},he(te,be=>(p(),g("div",{key:be.id,class:le(["sidebar-content-list-item",{"sidebar-content-list-item-active":be.id===r(q).currentPlanTemplateId,"grouped-item":r(q).organizationMethod==="by_group_time"||r(q).organizationMethod==="by_group_abc"}]),onClick:xe=>r(q).selectTemplate(be)},[s("div",zf,[E(r(T),{icon:"carbon:document",width:"20"})]),s("div",Jf,[s("div",Hf,i(be.title||F.$t("sidebar.unnamedPlan")),1),s("div",Wf,i(U(be)),1)]),s("div",Kf,i(G(r(q).parseDateTime(be.updateTime||be.createTime))),1),s("div",Xf,[s("button",{class:"delete-task-btn",title:F.$t("sidebar.deleteTemplate"),onClick:Se(xe=>r(q).deleteTemplate(be),["stop"])},[E(r(T),{icon:"carbon:close",width:"16"})],8,Qf)])],10,Gf))),128))],64))),128))])])):r(q).currentTab==="config"?(p(),g("div",Yf,[r(q).selectedTemplate?(p(),g("div",Zf,[s("div",eg,[s("div",tg,[s("h3",null,i(r(q).selectedTemplate.title||F.$t("sidebar.unnamedPlan")),1),s("span",sg,"ID: "+i(r(q).selectedTemplate.id),1)]),s("button",{class:"back-to-list-btn",onClick:W[4]||(W[4]=ee=>r(q).switchToTab("list"))},[E(r(T),{icon:"carbon:arrow-left",width:"16"})])]),r(q).planType==="dynamic_agent"?(p(),me(_f,{key:r(q).currentPlanTemplateId||"default","json-content":r(q).jsonContent,"can-rollback":r(q).canRollback,"can-restore":r(q).canRestore,"is-generating":r(q).isGenerating,"is-executing":r(q).isExecuting,"current-plan-template-id":r(q).currentPlanTemplateId||"",onRollback:_,onRestore:f,onSave:b,onCopyPlan:X,"onUpdate:jsonContent":W[5]||(W[5]=ee=>r(q).jsonContent=ee)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])):(p(),me(Xu,{key:"simple-"+(r(q).currentPlanTemplateId||"default"),"json-content":r(q).jsonContent,"can-rollback":r(q).canRollback,"can-restore":r(q).canRestore,"is-generating":r(q).isGenerating,"is-executing":r(q).isExecuting,"current-plan-template-id":r(q).currentPlanTemplateId||"",onRollback:_,onRestore:f,onSave:b,"onUpdate:jsonContent":W[6]||(W[6]=ee=>r(q).jsonContent=ee)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])),E(au,{ref_key:"executionControllerRef",ref:c,"current-plan-template-id":r(q).currentPlanTemplateId||"","is-executing":r(q).isExecuting,"is-generating":r(q).isGenerating,"show-publish-button":M.value,"tool-info":m.value,onExecutePlan:P,onPublishMcpService:j,onClearParams:Y,onUpdateExecutionParams:K,onSaveBeforeExecute:y},null,8,["current-plan-template-id","is-executing","is-generating","show-publish-button","tool-info"])])):V("",!0)])):V("",!0)]),s("div",{class:"sidebar-resizer",onMousedown:O,onDblclick:ye,title:F.$t("sidebar.resizeHint")},W[10]||(W[10]=[s("div",{class:"resizer-line"},null,-1)]),40,og)],6),E(td,{ref_key:"publishMcpModalRef",ref:A,modelValue:N.value,"onUpdate:modelValue":W[7]||(W[7]=ee=>N.value=ee),"plan-template-id":r(q).currentPlanTemplateId||"","plan-description":((ve=r(q).selectedTemplate)==null?void 0:ve.description)||"",onPublished:Z},null,8,["modelValue","plan-template-id","plan-description"]),z.value?(p(),g("div",{key:0,class:"modal-overlay",onClick:ne},[s("div",{class:"modal-content",onClick:W[9]||(W[9]=Se(()=>{},["stop"]))},[s("div",ng,[s("h3",null,i(F.$t("sidebar.copyPlan")),1),s("button",{class:"close-btn",onClick:ne},[E(r(T),{icon:"carbon:close",width:"16"})])]),s("div",ag,[s("div",lg,[s("label",rg,i(F.$t("sidebar.newPlanTitle")),1),de(s("input",{"onUpdate:modelValue":W[8]||(W[8]=ee=>k.value=ee),type:"text",class:"form-input",placeholder:F.$t("sidebar.enterNewPlanTitle"),onKeyup:et(ge,["enter"])},null,40,ig),[[_e,k.value]])])]),s("div",cg,[s("button",{class:"btn btn-secondary",onClick:ne},i(F.$t("common.cancel")),1),s("button",{class:"btn btn-primary",onClick:ge,disabled:!k.value.trim()||x.value},[x.value?(p(),me(r(T),{key:0,icon:"carbon:loading",width:"16",class:"spinning"})):V("",!0),re(" "+i(x.value?F.$t("sidebar.copying"):F.$t("sidebar.copyPlan")),1)],8,dg)])])])):V("",!0)],64)}}}),pg=$e(ug,[["__scopeId","data-v-f8951626"]]),hg={class:"direct-page"},mg={class:"direct-chat"},fg={class:"chat-header"},gg={class:"header-actions"},vg=["title"],bg=["title"],yg=["title"],_g={class:"chat-content"},Sg=["title"],wg={class:"message-content"},$g=we({__name:"index",setup(n){const e=Vs(),o=js(),t=st(),{t:a}=Ue(),{message:l}=Hs(),d=D(""),u=D(""),h=D(),c=D(),m=D(),S=D(),A=D(!1),L=D(!1),M=D(null),$=D(50),C=D(!1),b=D(0),y=D(0),v=fe(()=>{if(q.isCollapsed)return $.value;let R=26;S.value&&S.value.sidebarWidth!==void 0&&(R=S.value.sidebarWidth);const O=100-R;return Math.max(20,Math.min(O,$.value))});De(()=>{if(console.log("[Direct] onMounted called"),console.log("[Direct] taskStore.currentTask:",t.currentTask),console.log("[Direct] taskStore.hasUnprocessedTask():",t.hasUnprocessedTask()),qe.setEventCallbacks({onPlanUpdate:O=>{console.log("[Direct] Plan update event received for rootPlanId:",O),z(O)&&(console.log("[Direct] Processing plan update for current rootPlanId:",O),c.value&&typeof c.value.handlePlanUpdate=="function"?(console.log("[Direct] Calling chatRef.handlePlanUpdate with rootPlanId:",O),c.value.handlePlanUpdate(O)):console.warn("[Direct] chatRef.handlePlanUpdate method not available"),h.value&&typeof h.value.updateDisplayedPlanProgress=="function"?(console.log("[Direct] Calling rightPanelRef.updateDisplayedPlanProgress with rootPlanId:",O),h.value.updateDisplayedPlanProgress(O)):console.warn("[Direct] rightPanelRef.updateDisplayedPlanProgress method not available"))},onPlanCompleted:O=>{if(console.log("[Direct] Plan completed event received for rootPlanId:",O),!!z(O)){if(console.log("[Direct] Processing plan completion for current rootPlanId:",O),c.value&&typeof c.value.handlePlanCompleted=="function"){const B=qe.getCachedPlanRecord(O);B&&B.completed?B.summary&&B.summary.trim().length>0?(console.log("[Direct]  Plan details are valid and complete from polling cache, updating UI"),c.value.handlePlanCompleted(B)):(console.warn("[Direct]  Plan completed but summary is empty, still proceeding with available data"),c.value.handlePlanCompleted(B)):(console.warn("[Direct]  Plan details incomplete in cache, attempting API fallback"),ft.getDetails(O).then(Q=>{console.log("[Direct]  Got fresh details from API:",Q),Q&&Q.completed?(console.log("[Direct] Fresh details from API are valid, updating UI"),qe.setCachedPlanRecord(O,Q),c.value.handlePlanCompleted(Q)):(console.warn("[Direct]  API details also incomplete, using best available data"),c.value.handlePlanCompleted(B??{planId:O}))}).catch(Q=>{console.error("[Direct] API call failed (likely record deleted), using cached data:",Q),c.value.handlePlanCompleted(B??{planId:O})}))}else console.warn("[Direct] chatRef.handlePlanCompleted method not available");M.value=null,console.log("[Direct] ðŸ§¹ Cleared currentRootPlanId after plan completion"),m.value&&typeof m.value.resetSession=="function"&&(console.log("[Direct] ðŸ§¹ Calling inputRef.resetSession to clear sessionPlanId"),m.value.resetSession())}},onDialogRoundStart:O=>{console.log("[Direct] Dialog round start event received for rootPlanId:",O),M.value=O,console.log("[Direct] Set currentRootPlanId to:",O),c.value&&typeof c.value.handleDialogRoundStart=="function"?(console.log("[Direct] Calling chatRef.handleDialogRoundStart with planId:",O),c.value.handleDialogRoundStart(O)):console.warn("[Direct] chatRef.handleDialogRoundStart method not available")},onChatInputClear:()=>{console.log("[Direct] Chat input clear event received"),j()},onChatInputUpdateState:O=>{if(console.log("[Direct] Chat input update state event received for rootPlanId:",O),!z(O,!0))return;const B=qe.getCachedUIState(O);B&&Y(B.enabled,B.placeholder)},onPlanError:O=>{c.value.handlePlanError(O)}}),console.log("[Direct] Event callbacks registered to planExecutionManager"),q.loadPlanTemplateList(),t.hasUnprocessedTask()&&t.currentTask){const O=t.currentTask.prompt;console.log("[Direct] Found unprocessed task from store:",O),O.trim()?(t.markTaskAsProcessed(),Ae(async()=>{try{console.log("[Direct] Calling handleChatSendMessage with taskContent:",O),await k({input:O})}catch(B){console.warn("[Direct] handleChatSendMessage failed, falling back to prompt:",B),d.value=O}})):(console.log("[Direct] Task has empty content, marking as processed without execution"),t.markTaskAsProcessed())}else{const O=t.getAndClearTaskToInput();O?(u.value=O,console.log("[Direct] Setting inputOnlyContent for input only:",u.value)):(d.value=e.query.prompt||"",console.log("[Direct] Received task from URL:",d.value),console.log("[Direct] No unprocessed task in store"))}const R=localStorage.getItem("directPanelWidth");R&&($.value=parseFloat(R)),console.log("[Direct] Final prompt value:",d.value),u.value&&Ae(()=>{m.value&&typeof m.value.setInputValue=="function"&&(m.value.setInputValue(u.value),console.log("[Direct] Set input value:",u.value),u.value="")}),window.addEventListener("plan-execution-requested",O=>{console.log("[DirectView] Received plan-execution-requested event:",O.detail),H(O.detail)})}),pe(()=>t.currentTask,R=>{if(console.log("[Direct] Watch taskStore.currentTask triggered, newTask:",R),R&&!R.processed&&R.prompt.trim()){const O=R.prompt;t.markTaskAsProcessed(),console.log("[Direct] Received new task from store:",O),Ae(async()=>{try{console.log("[Direct] Directly executing new task via handleChatSendMessage:",O),await k({input:O})}catch(B){console.warn("[Direct] handleChatSendMessage failed for new task:",B)}})}else console.log("[Direct] Task is null, already processed, or has empty prompt - ignoring")},{immediate:!1}),pe(()=>d.value,(R,O)=>{console.log("[Direct] prompt value changed from:",O,"to:",R)},{immediate:!1}),pe(()=>t.taskToInput,R=>{console.log("[Direct] Watch taskStore.taskToInput triggered, newTaskToInput:",R),R.trim()&&(console.log("[Direct] Setting input value from taskToInput:",R),Ae(()=>{m.value&&typeof m.value.setInputValue=="function"&&(m.value.setInputValue(R.trim()),console.log("[Direct] Input value set from taskToInput watch:",R.trim()),t.getAndClearTaskToInput())}))},{immediate:!1}),Ne(()=>{console.log("[Direct] onUnmounted called, cleaning up resources"),M.value=null,qe.cleanup(),document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",P),window.removeEventListener("plan-execution-requested",R=>{H(R.detail)})});const _=R=>{C.value=!0,b.value=R.clientX,y.value=$.value,document.addEventListener("mousemove",f),document.addEventListener("mouseup",P),document.body.style.cursor="col-resize",document.body.style.userSelect="none",R.preventDefault()},f=R=>{if(!C.value)return;const O=window.innerWidth,Q=(R.clientX-b.value)/O*100;let ye=y.value+Q;ye=Math.max(20,Math.min(80,ye)),$.value=ye},P=()=>{C.value=!1,document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",P),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("directPanelWidth",$.value.toString())},N=()=>{$.value=50,localStorage.setItem("directPanelWidth","50")},z=(R,O=!1)=>!M.value||R===M.value||O&&(R==="ui-state"||R==="error")?!0:(console.log("[Direct] Ignoring event for non-current rootPlanId:",R,"current:",M.value),!1),k=async R=>{var B,Q,ye,F,W,ve,ee,te,be;let O=null;try{if(console.log("[DirectView] Processing send-message event:",R),!R.input.trim()){console.warn("[DirectView] Empty input detected, skipping backend request");return}const xe=(B=c.value)==null?void 0:B.addMessage("user",R.input);R.attachments&&xe&&((Q=c.value)==null||Q.updateMessage(xe.id,{attachments:R.attachments})),O=(ye=c.value)==null?void 0:ye.addMessage("assistant","",{thinking:a("chat.thinkingProcessing")}),O&&((F=c.value)==null||F.startStreaming(O.id));const{DirectApiService:Ce}=await ns(async()=>{const{DirectApiService:w}=await import("./sidebar-BUbOWah5.js").then(J=>J.d);return{DirectApiService:w}},__vite__mapDeps([0,1,2,3])),Ie=R;let Ee;Ie.toolName&&Ie.replacementParams?(console.log("[DirectView] Calling DirectApiService.executeByToolName with tool:",Ie.toolName),Ee=await Ce.executeByToolName(Ie.toolName,Ie.replacementParams,R.uploadedFiles,R.uploadKey)):(console.log("[DirectView] Calling DirectApiService.sendMessageWithDefaultPlan"),Ee=await Ce.sendMessageWithDefaultPlan(R)),console.log("[DirectView] API response received:",Ee),Ee.planId&&O?((W=c.value)==null||W.updateMessage(O.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:Ee.planId,rootPlanId:Ee.planId,status:"running"}}),M.value=Ee.planId,console.log("[DirectView] Set currentRootPlanId to:",Ee.planId),qe.handlePlanExecutionRequested(Ee.planId,R.input),console.log("[DirectView] Started polling for plan execution updates")):O&&((ve=c.value)==null||ve.updateMessage(O.id,{content:Ee.message||Ee.result||"No response received from backend"}),(ee=c.value)==null||ee.stopStreaming(O.id))}catch(xe){console.error("[DirectView] Send message failed:",xe),(te=c.value)==null||te.addMessage("assistant",`Error: ${(xe==null?void 0:xe.message)||"Failed to send message"}`),O&&((be=c.value)==null||be.stopStreaming(O.id))}},x=async R=>{console.log("[DirectView] Send message from input:",JSON.stringify(R)),await k(R)},j=()=>{console.log("[DirectView] Input cleared"),m.value&&typeof m.value.clear=="function"&&m.value.clear()},Z=()=>{console.log("[DirectView] Input focused")},Y=(R,O)=>{console.log("[DirectView] Input state updated:",R,O),L.value=!R},K=R=>{console.log("[DirectView] Step selected:",R),h.value&&typeof h.value.handleStepSelected=="function"?(console.log("[DirectView] Forwarding step selection to right panel:",R),h.value.handleStepSelected(R)):console.warn("[DirectView] rightPanelRef.handleStepSelected method not available")},X=(R,O,B,Q)=>{console.log("[DirectView] Sub plan step selected:",{parentPlanId:R,subPlanId:O,stepIndex:B,subStepIndex:Q}),h.value&&typeof h.value.handleSubPlanStepSelected=="function"?(console.log("[DirectView] Forwarding sub plan step selection to right panel:",{parentPlanId:R,subPlanId:O,stepIndex:B,subStepIndex:Q}),h.value.handleSubPlanStepSelected(R,O,B,Q)):console.warn("[DirectView] rightPanelRef.handleSubPlanStepSelected method not available")},ne=()=>{console.log("[DirectView] Plan mode button clicked"),q.toggleSidebar(),console.log("[DirectView] Sidebar toggled, isCollapsed:",q.isCollapsed)},ge=()=>{o.push("/home")},ke=()=>{o.push("/configs")},H=async R=>{var Q,ye,F,W,ve,ee,te,be,xe;if(console.log("[DirectView] Plan execution requested:",R),A.value){console.log("[DirectView] Plan execution already in progress, ignoring request");return}A.value=!0;let O=!1,B=null;try{console.log("[DirectView] Adding messages for plan execution:",R.title),(Q=c.value)==null||Q.addMessage("user",R.title),O=!0,B=(ye=c.value)==null?void 0:ye.addMessage("assistant","",{thinking:a("chat.planningExecution")}),B&&((F=c.value)==null||F.startStreaming(B.id),console.log("[DirectView] Added assistant message for plan execution:",B.id))}catch(Ce){console.warn("[DirectView] Failed to add messages:",Ce)}try{const Ce=R.planData.planTemplateId;if(!Ce)throw new Error(a("direct.planTemplateIdNotFound"));console.log("[Direct] Executing plan with templateId:",Ce,"params:",R.params),console.log("[Direct] About to call PlanActApiService.executePlan");const Ie=R.uploadedFiles??[],Ee=R.uploadKey??void 0;console.log("[Direct] ðŸ” DEBUG - InputArea uploadedFiles:",Ie),console.log("[Direct] ðŸ” DEBUG - InputArea uploadKey:",Ee),console.log("[Direct] Executing with uploaded files:",Ie.length),console.log("[Direct] Executing with replacement params:",R.replacementParams);let w;if((W=R.params)!=null&&W.trim()?(console.log("[Direct] Calling executePlan with rawParam:",R.params.trim()),w=await ut.executePlan(Ce,R.params.trim(),Ie,R.replacementParams,Ee)):(console.log("[Direct] Calling executePlan without rawParam"),w=await ut.executePlan(Ce,void 0,Ie,R.replacementParams,Ee)),console.log("[Direct] Plan execution API response:",w),w.planId&&B)console.log("[Direct] Got planId from response:",w.planId,"starting plan execution"),(ve=c.value)==null||ve.updateMessage(B.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:w.planId,rootPlanId:w.planId,status:"running"}}),M.value=w.planId,console.log("[Direct] Set currentRootPlanId to:",w.planId),console.log("[Direct] Delegating plan execution to planExecutionManager"),qe.handlePlanExecutionRequested(w.planId,R.title);else throw console.error("[Direct] No planId in response:",w),new Error(a("direct.executionFailedNoPlanId"))}catch(Ce){console.error("[Direct] Plan execution failed:",Ce),console.error("[Direct] Error details:",{message:Ce.message,stack:Ce.stack}),M.value=null;try{console.log("[Direct] Adding error messages to chat"),O||(ee=c.value)==null||ee.addMessage("user",R.title),B?((te=c.value)==null||te.updateMessage(B.id,{content:`${a("direct.executionFailed")}: ${Ce.message||a("common.unknownError")}`,thinking:void 0}),(be=c.value)==null||be.stopStreaming(B.id)):(xe=c.value)==null||xe.addMessage("assistant",`${a("direct.executionFailed")}: ${Ce.message||a("common.unknownError")}`)}catch(Ie){console.error("[Direct] Failed to add error messages:",Ie),alert(`${a("direct.executionFailed")}: ${Ce.message||a("common.unknownError")}`)}}finally{console.log("[Direct] Plan execution finished, resetting isExecutingPlan flag"),A.value=!1}},G=()=>{c.value.showMemory()},U=()=>{Ve.clearMemoryId(),c.value.newChat()};return(R,O)=>(p(),g("div",hg,[s("div",mg,[E(pg,{ref_key:"sidebarRef",ref:S,onPlanExecutionRequested:H},null,512),s("div",{class:"left-panel",style:We({width:v.value+"%"})},[s("div",fg,[s("button",{class:"back-button",onClick:ge},[E(r(T),{icon:"carbon:arrow-left"})]),s("h2",null,i(R.$t("conversation")),1),s("div",gg,[E(Js),s("button",{class:"config-button",onClick:U,title:R.$t("memory.newChat")},[E(r(T),{icon:"carbon:add",width:"20"})],8,vg),s("button",{class:"config-button",onClick:ke,title:R.$t("direct.configuration")},[E(r(T),{icon:"carbon:settings-adjust",width:"20"})],8,bg),s("button",{class:"cron-task-btn",onClick:O[0]||(O[0]=B=>r(Ve).toggleSidebar()),title:R.$t("memory.selectMemory")},[E(r(T),{icon:"carbon:calendar",width:"20"})],8,yg)])]),s("div",_g,[E(Xa,{ref_key:"chatRef",ref:c,mode:"direct","initial-prompt":d.value||"",onStepSelected:K,onSubPlanStepSelected:X},null,8,["initial-prompt"])]),(p(),me(_l,{key:R.$i18n.locale,ref_key:"inputRef",ref:m,disabled:L.value,placeholder:L.value?r(a)("input.waiting"):r(a)("input.placeholder"),"initial-value":d.value,onSend:x,onClear:j,onFocus:Z,onUpdateState:Y,onPlanModeClicked:ne},null,8,["disabled","placeholder","initial-value"]))],4),s("div",{class:"panel-resizer",onMousedown:_,onDblclick:N,title:R.$t("direct.panelResizeHint")},O[1]||(O[1]=[s("div",{class:"resizer-line"},null,-1)]),40,Sg),E(bc,{ref_key:"rightPanelRef",ref:h,style:We({width:100-$.value+"%"}),"current-root-plan-id":M.value},null,8,["style","current-root-plan-id"])]),E(mr,{onMemorySelected:G}),r(l).show?(p(),g("div",{key:0,class:le(["message-toast",r(l).type])},[s("div",wg,[s("span",null,i(r(l).text),1)])],2)):V("",!0)]))}}),Xg=$e($g,[["__scopeId","data-v-429ad590"]]);export{Xg as default};
//# sourceMappingURL=index-BASnXG-g.js.map
