var Us=Object.defineProperty;var Ns=(n,e,s)=>e in n?Us(n,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[e]=s;var be=(n,e,s)=>Ns(n,typeof e!="symbol"?e+"":e,s);import{d as he,u as Ee,c as pe,r as F,B as tt,C as fe,o as ke,a as v,b as u,F as re,g as S,f as B,p as Me,h as ne,i as r,t as c,e as o,w as oe,m as ce,n as ae,q as ie,D as at,E as Lt,l as le,G as pt,H as Os,I as Se,J as ts,z as We,j as ve,T as Be,K as Ye,M as ss,A as Te,v as Ls,N as os,O as Qe,y as ns,P as Bs,_ as qs}from"./index-B41i2gpg.js";import{I as E,_ as me}from"./_plugin-vue_export-helper-ivSPPR41.js";import{s as z,P as Ze,u as as}from"./sidebar-DEVC0Td1.js";import{M as js,A as Vs,T as Hs,u as ls,a as Ws}from"./useMessage-CoVlS8dN.js";import{L as Bt}from"./llm-check-BVkAKrj3.js";import{L as zs}from"./LanguageSwitcher-DVrlPFFd.js";class Fe{static async getCoordinatorToolConfig(){try{const e=await fetch(`${this.BASE_URL}/config`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get coordinator tool config: ${e.status}`);return await e.json()}catch(e){return console.error("Failed to get CoordinatorTool configuration:",e),{enabled:!0,success:!1,message:e.message}}}static async getAllEndpoints(){try{const e=await fetch(`${this.BASE_URL}/endpoints`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get endpoints: ${e.status}`);return await e.json()}catch(e){throw console.error("Failed to get endpoints:",e),new Error("Failed to get endpoints: "+e.message)}}static async getCoordinatorToolsByTemplate(e){console.log("[CoordinatorToolApiService] Starting to get coordinator tool, planTemplateId:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/get-get-or-new-by-template/${e}`);try{const s=await fetch(`${this.BASE_URL}/get-or-new-by-template/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",s.status),console.log("[CoordinatorToolApiService] Response status text:",s.statusText),s.status===404)return console.log("[CoordinatorToolApiService] 404"),null;if(!s.ok){const a=await s.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to get coordinator tools: ${s.status} - ${a}`)}const t=await s.json();return console.log("[CoordinatorToolApiService] Successfully got coordinator tool, result:",t),t}catch(s){throw console.error("[CoordinatorToolApiService] Failed to get coordinator tool:",s),new Error("Failed to get coordinator tool: "+s.message)}}static async getOrNewCoordinatorToolsByTemplate(e){console.log("[CoordinatorToolApiService] Starting to get or create coordinator tool, planTemplateId:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/get-or-new-by-template/${e}`);try{const s=await fetch(`${this.BASE_URL}/get-or-new-by-template/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",s.status),console.log("[CoordinatorToolApiService] Response status text:",s.statusText),!s.ok){const a=await s.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to get coordinator tools: ${s.status} - ${a}`)}const t=await s.json();return console.log("[CoordinatorToolApiService] Successfully got coordinator tool, result:",t),t}catch(s){throw console.error("[CoordinatorToolApiService] Failed to get coordinator tool:",s),new Error("Failed to get coordinator tool: "+s.message)}}static async createCoordinatorTool(e){console.log("[CoordinatorToolApiService] Starting to create coordinator tool"),console.log("[CoordinatorToolApiService] Original data:",JSON.stringify(e,null,2)),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}`);const s={id:e.id,toolName:e.toolName,toolDescription:e.toolDescription,inputSchema:e.inputSchema,planTemplateId:e.planTemplateId,httpEndpoint:e.httpEndpoint,mcpEndpoint:e.mcpEndpoint,serviceGroup:e.serviceGroup,enableInternalToolcall:e.enableInternalToolcall,enableHttpService:e.enableHttpService,enableMcpService:e.enableMcpService};console.log("[CoordinatorToolApiService] Cleaned sending data:",JSON.stringify(s,null,2));try{const t=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(console.log("[CoordinatorToolApiService] Response status:",t.status),console.log("[CoordinatorToolApiService] Response status text:",t.statusText),!t.ok){let l="Unknown error";try{const i=await t.json();l=i.message||i.error||l}catch{l=await t.text()||l}throw console.error("[CoordinatorToolApiService] Response error content:",l),new Error(`Failed to create coordinator tool: ${t.status} - ${l}`)}const a=await t.json();return console.log("[CoordinatorToolApiService] Created successfully, result:",a),a}catch(t){throw console.error("[CoordinatorToolApiService] Failed to create coordinator tool:",t),new Error("Failed to create coordinator tool: "+t.message)}}static async updateCoordinatorTool(e,s){console.log("[CoordinatorToolApiService] Starting to update coordinator tool, ID:",e),console.log("[CoordinatorToolApiService] Sending data:",s),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/${e}`);const t={id:s.id,toolName:s.toolName,toolDescription:s.toolDescription,inputSchema:s.inputSchema,planTemplateId:s.planTemplateId,httpEndpoint:s.httpEndpoint,mcpEndpoint:s.mcpEndpoint,serviceGroup:s.serviceGroup,enableInternalToolcall:s.enableInternalToolcall,enableHttpService:s.enableHttpService,enableMcpService:s.enableMcpService};console.log("[CoordinatorToolApiService] Cleaned sending data:",t);try{const a=await fetch(`${this.BASE_URL}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(console.log("[CoordinatorToolApiService] Response status:",a.status),console.log("[CoordinatorToolApiService] Response status text:",a.statusText),!a.ok){let i="Unknown error";try{const p=await a.json();i=p.message||p.error||i}catch{i=await a.text()||i}throw console.error("[CoordinatorToolApiService] Response error content:",i),new Error(`Failed to update coordinator tool: ${a.status} - ${i}`)}const l=await a.json();return console.log("[CoordinatorToolApiService] Updated successfully, result:",l),l}catch(a){throw console.error("[CoordinatorToolApiService] Failed to update coordinator tool:",a),new Error("Failed to update coordinator tool: "+a.message)}}static async deleteCoordinatorTool(e){console.log("[CoordinatorToolApiService] Starting to delete coordinator tool, ID:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/${e}`);try{const s=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",s.status),console.log("[CoordinatorToolApiService] Response status text:",s.statusText),!s.ok){const a=await s.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to delete coordinator tool: ${s.status} - ${a}`)}const t=await s.json();return console.log("[CoordinatorToolApiService] Deleted successfully, result:",t),t}catch(s){throw console.error("[CoordinatorToolApiService] Failed to delete coordinator tool:",s),new Error("Failed to delete coordinator tool: "+s.message)}}}be(Fe,"BASE_URL","/api/coordinator-tools");class Dt{static async getParameterRequirements(e){try{const s=await fetch(`${this.BASE_URL}/${e}/parameters`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`Failed to get parameter requirements: ${s.statusText}`);return await s.json()}catch(s){throw console.error("Error getting parameter requirements:",s),s}}}be(Dt,"BASE_URL","/api/plan-template");const Js={class:"modal-form wide-modal"},Gs={class:"form-section"},Ks={class:"form-item"},Xs=["placeholder"],Ys={class:"field-description"},Qs={class:"form-section"},Zs={class:"form-item"},eo=["placeholder"],to={class:"field-description"},so={class:"form-section"},oo={class:"form-item"},no=["placeholder"],ao={class:"field-description"},lo={class:"form-section"},ro={class:"section-title"},io={key:0,class:"params-help-text"},co={class:"parameter-table"},uo=["onUpdate:modelValue","placeholder","readonly"],po=["onUpdate:modelValue","placeholder"],ho={class:"form-section"},mo={class:"service-publish-options"},fo={class:"internal-toolcall-publish-option"},vo={class:"checkbox-label"},go={class:"checkbox-text"},bo={class:"checkbox-description"},yo={class:"http-publish-option"},_o={class:"checkbox-label"},$o={class:"checkbox-text"},wo={class:"checkbox-description"},So={class:"mcp-publish-option"},ko={class:"checkbox-label"},To={class:"checkbox-text"},Eo={class:"checkbox-description"},Po={key:0,class:"form-section"},Co={class:"form-item"},Ro={class:"endpoint-description"},Io={class:"endpoint-container"},Ao={class:"endpoint-row"},xo={class:"custom-select"},Do={class:"select-input-container"},Fo={class:"input-content"},Mo=["placeholder"],Uo={class:"dropdown-header"},No={class:"select-options"},Oo=["onClick"],Lo={class:"option-name"},Bo={class:"manual-input-section"},qo={class:"manual-input-container"},jo=["placeholder"],Vo={key:0,class:"form-item url-item"},Ho={class:"url-container"},Wo=["title"],zo={class:"url-text"},Jo={class:"button-container"},Go=["disabled"],Ko=["disabled"],Xo=he({__name:"PublishServiceModal",props:{modelValue:{type:Boolean,default:!1},planTemplateId:{default:""},planTitle:{default:""},planDescription:{default:""}},emits:["update:modelValue","published"],setup(n,{expose:e,emit:s}){const{t}=Ee(),a=n,l=s,i=pe({get:()=>a.modelValue,set:H=>l("update:modelValue",H)}),p=F(""),b=F(""),d=F(!1),h=F(!1),k=F([]),C=F(""),U=F(!1),_=F("bottom"),y=F(""),m=F(null),g=F(!1),w=F(!1),$=F(!1),P=F(!0),f=F({parameters:[],hasParameters:!1,requirements:""}),j=F(!1),x=tt({serviceName:"",userRequest:"",endpoint:"",serviceGroup:"",parameters:[]}),se=pe(()=>{const H=m.value&&m.value.id;return t(H?"mcpService.updateService":"mcpService.createService")}),A=()=>{x.serviceName="",x.userRequest=a.planDescription||"",x.endpoint="",x.serviceGroup="",f.value.hasParameters||(x.parameters=[]),m.value=null,C.value="",g.value=!1},N=async()=>{try{k.value=await Fe.getAllEndpoints()}catch(H){console.error("Failed to load endpoints:",H),O(t("mcpService.loadEndpointsFailed")+": "+H.message,"error")}},W=async()=>{if(!a.planTemplateId){f.value={parameters:[],hasParameters:!1,requirements:""};return}j.value=!0;try{const H=await Dt.getParameterRequirements(a.planTemplateId);f.value=H,H.hasParameters&&(x.parameters=H.parameters.map(X=>({name:X,description:""})))}catch(H){console.error("[PublishModal] Failed to load parameter requirements:",H),H instanceof Error&&!H.message.includes("404")&&console.warn("[PublishModal] Parameter requirements not available yet, will retry later"),f.value={parameters:[],hasParameters:!1,requirements:""}}finally{j.value=!1}},Z=()=>{U.value||T(),U.value=!U.value},T=()=>{const H=document.querySelector(".custom-select");if(!H)return;const X=H.getBoundingClientRect(),K=window.innerHeight;X.bottom+200>K?_.value="top":_.value="bottom"},I=H=>{x.endpoint=H,U.value=!1,y.value=""},J=()=>{if(y.value.trim()){const H=y.value.trim().replace(/[^a-zA-Z0-9_/]/g,"");H&&(x.endpoint=H,k.value.includes(H)||k.value.push(H),U.value=!1,y.value="")}},Y=()=>{setTimeout(()=>{y.value.trim()&&J()},200)},M=()=>{k.value.includes(x.endpoint)&&I(x.endpoint)},D=()=>{k.value.includes(x.endpoint)&&I(x.endpoint)},Q=()=>{k.value.includes(x.endpoint)&&I(x.endpoint)},L=async()=>{if(C.value)try{await navigator.clipboard.writeText(C.value),O(t("common.copy")+" "+t("common.success"),"success")}catch(H){console.error("Copy failed:",H),O(t("common.copy")+" "+t("common.error"),"error")}},O=(H,X)=>{X==="success"?(b.value=H,setTimeout(()=>{b.value=""},3e3)):X==="error"&&(p.value=H,setTimeout(()=>{p.value=""},5e3))},ee=()=>{if(!x.serviceName||!x.serviceName.trim())return O(t("mcpService.toolNameRequiredError"),"error"),!1;if(!x.userRequest||!x.userRequest.trim())return O(t("mcpService.toolDescriptionRequiredError"),"error"),!1;if(!x.serviceGroup||!x.serviceGroup.trim())return O(t("mcpService.serviceGroupRequiredError"),"error"),!1;if(w.value&&(!x.endpoint||!x.endpoint.trim()))return O(t("mcpService.endpointRequiredError"),"error"),!1;if(!P.value&&!$.value&&!w.value)return O("Please select at least one service type","error"),!1;for(let H=0;H<x.parameters.length;H++){const X=x.parameters[H];if(X.name&&!X.description.trim())return O(`Parameter "${X.name}" description cannot be empty`,"error"),!1;if(X.description&&!X.name.trim())return O(`Parameter description "${X.description}" corresponding name cannot be empty`,"error"),!1}return!0},q=async()=>{if(console.log("[PublishModal] Starting to handle publish request"),console.log("[PublishModal] Form data:",x),console.log("[PublishModal] Current tool:",m.value),console.log("[PublishModal] Publish as MCP service:",w.value),console.log("[PublishModal] Publish as HTTP service:",$.value),!ee()){console.log("[PublishModal] Form validation failed");return}d.value=!0;try{m.value||(console.log("[PublishModal] No current tool data, getting or creating first"),m.value=await Fe.getOrNewCoordinatorToolsByTemplate(a.planTemplateId)),console.log("[PublishModal] Updating tool information"),m.value.toolName=x.serviceName.trim(),m.value.toolDescription=x.userRequest.trim(),m.value.serviceGroup=x.serviceGroup.trim(),m.value.planTemplateId=a.planTemplateId,m.value.enableInternalToolcall=P.value,m.value.enableHttpService=$.value,m.value.enableMcpService=w.value,w.value?m.value.mcpEndpoint=x.endpoint.trim():m.value.mcpEndpoint=void 0;const H=x.parameters.filter(K=>K.name.trim()&&K.description.trim()).map(K=>({name:K.name.trim(),description:K.description.trim(),type:"string"}));if(m.value.inputSchema=JSON.stringify(H),console.log("[PublishModal] Updated tool information:",m.value),m.value.id)console.log("[PublishModal] Updating existing tool, ID:",m.value.id),await Fe.updateCoordinatorTool(m.value.id,m.value);else{console.log("[PublishModal] Creating new tool");const K=await Fe.createCoordinatorTool(m.value);m.value=K}const X=[];if(P.value&&X.push("Internal Method Call"),$.value&&X.push("HTTP Service"),w.value&&X.push("MCP Service"),X.length>0){console.log("[PublishModal] Step 5: Publishing service, ID:",m.value.id,"Enabled services:",X.join(", "));const K=[];if(w.value&&m.value.mcpEndpoint){const _e=window.location.origin;K.push(`MCP: ${_e}/mcp${m.value.mcpEndpoint}`)}P.value&&K.push(`Internal Call: ${x.serviceName}`),C.value=K.join(`
`),console.log("[PublishModal] Service published successfully, service URLs:",C.value),O(t("mcpService.publishSuccess"),"success"),l("published",m.value)}else console.log("[PublishModal] Only saving tool, not publishing as any service"),O(t("mcpService.saveSuccess"),"success"),l("published",m.value)}catch(H){console.error("[PublishModal] Failed to publish service:",H),O(t("mcpService.publishFailed")+": "+H.message,"error")}finally{d.value=!1}},V=async()=>{if(!h.value&&confirm(t("mcpService.deleteConfirmMessage"))){if(!m.value||!m.value.id){O(t("mcpService.deleteFailed")+": "+t("mcpService.selectPlanTemplateFirst"),"error");return}h.value=!0;try{console.log("[PublishModal] Starting to delete MCP service, ID:",m.value.id);const H=await Fe.deleteCoordinatorTool(m.value.id);if(H.success)console.log("[PublishModal] Deleted successfully"),O(t("mcpService.deleteSuccess"),"success"),i.value=!1,l("published",null);else throw new Error(H.message)}catch(H){console.error("[PublishModal] Failed to delete MCP service:",H),O(t("mcpService.deleteFailed")+": "+H.message,"error")}finally{h.value=!1}}},G=async()=>{i.value&&(console.log("[PublishModal] Modal opened, starting to initialize data"),A(),await N(),await de())},de=async()=>{if(!a.planTemplateId){console.log("[PublishModal] "+t("mcpService.noPlanTemplateId"));return}try{console.log("[PublishModal] Starting to load coordinator tool data, planTemplateId:",a.planTemplateId);const H=await Fe.getOrNewCoordinatorToolsByTemplate(a.planTemplateId);console.log("[PublishModal] Get coordinator tool data result:",H),m.value=H,g.value=!!H.id;const X=[];if(H.enableMcpService&&H.mcpEndpoint){const K=window.location.origin;X.push(`MCP: ${K}/mcp${H.mcpEndpoint}`)}H.enableInternalToolcall&&X.push(`Internal Call: ${H.toolName}`),C.value=X.join(`
`),console.log("[PublishModal] Load tool data - endpointUrl:",C.value),x.serviceName=H.toolName||"",x.userRequest=H.toolDescription||a.planDescription||"",x.serviceGroup=H.serviceGroup||"",w.value=H.enableMcpService||!1,$.value=H.enableHttpService||!1,P.value=H.enableInternalToolcall||!1,H.enableMcpService&&(x.endpoint=H.mcpEndpoint||"");try{if(H.inputSchema){const K=JSON.parse(H.inputSchema);Array.isArray(K)&&K.length>0?(x.parameters=K.map(_e=>({name:_e.name||"",description:_e.description||""})),console.log("[PublishModal] Load parameters from inputSchema:",x.parameters)):console.log("[PublishModal] inputSchema is empty, keeping existing parameters:",x.parameters)}}catch(K){console.warn("[PublishModal] "+t("mcpService.parseInputSchemaFailed")+":",K),console.log("[PublishModal] Parsing failed, keeping existing parameters:",x.parameters)}console.log("[PublishModal] Form data filled:",x)}catch(H){console.error("[PublishModal] "+t("mcpService.loadToolDataFailed")+":",H),O(t("mcpService.loadToolDataFailed")+": "+H.message,"error")}};return fe(()=>a.modelValue,G),fe(()=>a.planTemplateId,(H,X)=>{H&&H!==X&&(X&&H.startsWith("planTemplate-")?setTimeout(()=>{W()},1e3):W())}),ke(async()=>{i.value&&(console.log("[PublishModal] Initialize when component mounted"),A(),await N(),await de(),await W())}),e({loadParameterRequirements:W}),(H,X)=>(u(),v(re,null,[S(js,{modelValue:i.value,"onUpdate:modelValue":X[11]||(X[11]=K=>i.value=K),title:se.value,onConfirm:q},{footer:Me(()=>{var K;return[o("div",Jo,[g.value&&((K=m.value)!=null&&K.id)?(u(),v("button",{key:0,class:"action-btn danger",onClick:V,disabled:h.value},[h.value?(u(),le(r(E),{key:0,icon:"carbon:loading",class:"loading-icon"})):(u(),le(r(E),{key:1,icon:"carbon:trash-can"})),ne(" "+c(h.value?r(t)("mcpService.deleting"):r(t)("mcpService.delete")),1)],8,Go)):B("",!0),o("button",{class:"action-btn primary",onClick:q,disabled:d.value},[d.value?(u(),le(r(E),{key:0,icon:"carbon:loading",class:"loading-icon"})):(u(),le(r(E),{key:1,icon:"carbon:cloud-upload"})),ne(" "+c(d.value?r(t)("mcpService.publishing"):r(t)("mcpService.publishAsService")),1)],8,Ko)])]}),default:Me(()=>[o("div",Js,[o("div",Gs,[o("div",Ks,[o("label",null,c(r(t)("mcpService.toolNameRequired")),1),oe(o("input",{type:"text","onUpdate:modelValue":X[0]||(X[0]=K=>x.serviceName=K),placeholder:r(t)("mcpService.toolNamePlaceholder"),class:ae({error:!x.serviceName||!x.serviceName.trim()}),required:""},null,10,Xs),[[ce,x.serviceName]]),o("div",Ys,c(r(t)("mcpService.toolNameDescription")),1)])]),o("div",Qs,[o("div",Zs,[o("label",null,c(r(t)("mcpService.toolDescriptionRequired")),1),oe(o("textarea",{"onUpdate:modelValue":X[1]||(X[1]=K=>x.userRequest=K),placeholder:r(t)("mcpService.toolDescriptionPlaceholder"),class:ae([{error:!x.userRequest||!x.userRequest.trim()},"description-field"]),rows:"4",required:""},null,10,eo),[[ce,x.userRequest]]),o("div",to,c(r(t)("mcpService.toolDescriptionDescription")),1)])]),o("div",so,[o("div",oo,[o("label",null,c(r(t)("mcpService.serviceGroup")),1),oe(o("input",{type:"text","onUpdate:modelValue":X[2]||(X[2]=K=>x.serviceGroup=K),placeholder:r(t)("mcpService.serviceGroupPlaceholder"),class:ae({error:!x.serviceGroup||!x.serviceGroup.trim()}),required:""},null,10,no),[[ce,x.serviceGroup]]),o("div",ao,c(r(t)("mcpService.serviceGroupDescription")),1)])]),o("div",lo,[o("div",ro,c(r(t)("mcpService.parameterConfig")),1),f.value.hasParameters?(u(),v("div",io,c(r(t)("sidebar.parameterRequirementsHelp")),1)):B("",!0),o("div",co,[o("table",null,[o("thead",null,[o("tr",null,[o("th",null,c(r(t)("mcpService.parameterName")),1),o("th",null,c(r(t)("mcpService.parameterDescription")),1)])]),o("tbody",null,[(u(!0),v(re,null,ie(x.parameters,(K,_e)=>(u(),v("tr",{key:_e},[o("td",null,[oe(o("input",{type:"text","onUpdate:modelValue":xe=>K.name=xe,placeholder:r(t)("mcpService.parameterName"),class:ae(["parameter-input",{"readonly-input":f.value.hasParameters}]),readonly:f.value.hasParameters,required:""},null,10,uo),[[ce,K.name]])]),o("td",null,[oe(o("input",{type:"text","onUpdate:modelValue":xe=>K.description=xe,placeholder:r(t)("mcpService.parameterDescription"),class:"parameter-input",required:""},null,8,po),[[ce,K.description]])])]))),128))])])])]),o("div",ho,[o("div",mo,[o("div",fo,[o("label",vo,[oe(o("input",{type:"checkbox","onUpdate:modelValue":X[3]||(X[3]=K=>P.value=K),class:"checkbox-input"},null,512),[[at,P.value]]),o("span",go,c(r(t)("mcpService.publishAsInternalToolcall")),1)]),o("div",bo,c(r(t)("mcpService.publishAsInternalToolcallDescription")),1)]),o("div",yo,[o("label",_o,[oe(o("input",{type:"checkbox","onUpdate:modelValue":X[4]||(X[4]=K=>$.value=K),class:"checkbox-input"},null,512),[[at,$.value]]),o("span",$o,c(r(t)("mcpService.publishAsHttpService")),1)]),o("div",wo,c(r(t)("mcpService.publishAsHttpServiceDescription")),1)]),o("div",So,[o("label",ko,[oe(o("input",{type:"checkbox","onUpdate:modelValue":X[5]||(X[5]=K=>w.value=K),class:"checkbox-input"},null,512),[[at,w.value]]),o("span",To,c(r(t)("mcpService.publishAsMcpService")),1)]),o("div",Eo,c(r(t)("mcpService.publishAsMcpServiceDescription")),1),w.value?(u(),v("div",Po,[o("div",Co,[o("label",null,c(r(t)("mcpService.endpointRequired")),1),o("div",Ro,c(r(t)("mcpService.endpointDescription")),1),o("div",Io,[o("div",Ao,[o("div",xo,[o("div",Do,[o("div",Fo,[S(r(E),{icon:"carbon:application",width:"16",class:"input-icon"}),oe(o("input",{type:"text","onUpdate:modelValue":X[6]||(X[6]=K=>x.endpoint=K),placeholder:r(t)("mcpService.endpointPlaceholder"),class:"select-input",onFocus:X[7]||(X[7]=K=>U.value=!0),onInput:M,onKeydown:Lt(D,["enter"]),onBlur:Q},null,40,Mo),[[ce,x.endpoint]])]),o("button",{class:"select-arrow-btn",onClick:Z,title:"Expand Options"},[S(r(E),{icon:U.value?"carbon:chevron-up":"carbon:chevron-down",width:"14",class:"chevron"},null,8,["icon"])])]),U.value?(u(),v("div",{key:0,class:ae(["select-dropdown",{"dropdown-top":_.value==="top"}])},[o("div",Uo,[o("span",null,c(r(t)("mcpService.selectEndpoint")),1),o("button",{class:"close-btn",onClick:X[8]||(X[8]=K=>U.value=!1)},[S(r(E),{icon:"carbon:close",width:"12"})])]),o("div",No,[(u(!0),v(re,null,ie(k.value,K=>(u(),v("button",{key:K,class:ae(["select-option",{active:x.endpoint===K}]),onClick:_e=>I(K)},[o("span",Lo,c(K),1),x.endpoint===K?(u(),le(r(E),{key:0,icon:"carbon:checkmark",width:"14",class:"check-icon"})):B("",!0)],10,Oo))),128))]),o("div",Bo,[o("div",qo,[oe(o("input",{type:"text","onUpdate:modelValue":X[9]||(X[9]=K=>y.value=K),placeholder:r(t)("mcpService.manualInput"),class:"manual-input",onKeydown:Lt(J,["enter"]),onBlur:Y},null,40,jo),[[ce,y.value]]),o("button",{class:"add-manual-btn",onClick:J},[S(r(E),{icon:"carbon:add",width:"14"})])])])],2)):B("",!0),U.value?(u(),v("div",{key:1,class:"backdrop",onClick:X[10]||(X[10]=K=>U.value=!1)})):B("",!0)])])])]),C.value?(u(),v("div",Vo,[o("label",null,c(r(t)("mcpService.mcpStreamableUrl")),1),o("div",Ho,[o("div",{class:"url-display",onDblclick:L,title:r(t)("mcpService.copyUrl")+": "+C.value},[o("span",zo,c(C.value||r(t)("mcpService.mcpStreamableUrlPlaceholder")),1),S(r(E),{icon:"carbon:copy",width:"16",class:"copy-icon"})],40,Wo)])])):B("",!0)])):B("",!0)])])])])]),_:1},8,["modelValue","title"]),p.value?(u(),v("div",{key:0,class:"error-toast",onClick:X[12]||(X[12]=K=>p.value="")},[S(r(E),{icon:"carbon:error"}),ne(" "+c(p.value),1)])):B("",!0),b.value?(u(),v("div",{key:1,class:"success-toast",onClick:X[13]||(X[13]=K=>b.value="")},[S(r(E),{icon:"carbon:checkmark"}),ne(" "+c(b.value),1)])):B("",!0)],64))}}),Yo=me(Xo,[["__scopeId","data-v-bd88743f"]]);function rs(n,e){const s=F(!1),t=tt({title:"",steps:[],directResponse:!1,planTemplateId:n.currentPlanTemplateId||"",planType:"dynamic_agent"}),a=m=>{try{if(!m){Object.assign(t,{title:"",steps:[],directResponse:!1,planTemplateId:n.currentPlanTemplateId||"",planType:"dynamic_agent"});return}const g=JSON.parse(m);t.title=g.title||"",t.directResponse=!1,t.planTemplateId=g.planTemplateId||n.currentPlanTemplateId||"",t.planType=g.planType||"dynamic_agent",t.steps=(g.steps||[]).map(w=>({stepRequirement:w.stepRequirement||"",agentName:w.agentName||"",modelName:w.modelName||null,selectedToolKeys:w.selectedToolKeys||[],terminateColumns:w.terminateColumns||""}))}catch(g){console.warn("Failed to parse JSON content:",g)}},l=()=>{try{const m={title:t.title,steps:t.steps.map(g=>({stepRequirement:g.stepRequirement,agentName:g.agentName,modelName:g.modelName||"",selectedToolKeys:g.selectedToolKeys,terminateColumns:g.terminateColumns})),directResponse:t.directResponse,planTemplateId:t.planTemplateId,planType:t.planType};return JSON.stringify(m,null,2)}catch(m){return console.error("Failed to convert visual data to JSON:",m),"{}"}},i=pe(()=>l());return fe(()=>n.jsonContent,m=>{a(m)},{immediate:!0}),fe(t,()=>{const m=l();e("update:jsonContent",m)},{deep:!0}),fe(()=>n.currentPlanTemplateId,m=>{m&&(t.planTemplateId=m)}),{showJsonPreview:s,displayData:t,formattedJsonOutput:i,addStep:()=>{const m={stepRequirement:"",agentName:"ConfigurableDynaAgent",modelName:null,selectedToolKeys:[],terminateColumns:"",agentType:"",stepContent:""};t.steps.push(m)},removeStep:m=>{m>=0&&m<t.steps.length&&t.steps.splice(m,1)},moveStepUp:m=>{if(m>0){const g=t.steps.splice(m,1)[0];t.steps.splice(m-1,0,g)}},moveStepDown:m=>{if(m<t.steps.length-1){const g=t.steps.splice(m,1)[0];t.steps.splice(m+1,0,g)}},toggleJsonPreview:()=>{s.value=!s.value},closeJsonPreview:()=>{s.value=!1},handleRollback:()=>{e("rollback")},handleRestore:()=>{e("restore")},handleSave:()=>{e("save")}}}const Qo={class:"config-section"},Zo={class:"section-header"},en={class:"visual-editor"},tn={class:"plan-basic-info"},sn={class:"form-row"},on={class:"form-label"},nn=["placeholder"],an={class:"steps-section"},ln={class:"steps-header"},rn={class:"form-label"},cn={class:"steps-container"},dn={class:"step-header"},un={class:"step-number"},pn={class:"step-actions"},hn=["onClick","disabled","title"],mn=["onClick","disabled","title"],fn=["onClick","title"],vn={class:"step-content"},gn={class:"form-row"},bn={class:"form-label"},yn={class:"agent-selector"},_n=["onUpdate:modelValue"],$n={value:""},wn=["title"],Sn={class:"form-row"},kn={class:"form-label"},Tn=["onUpdate:modelValue","placeholder"],En={class:"form-row"},Pn={class:"form-label"},Cn=["onUpdate:modelValue","placeholder"],Rn={key:0,class:"empty-steps"},In={class:"plan-id-section"},An={class:"form-row"},xn={class:"form-label"},Dn={key:0,class:"json-preview"},Fn={class:"preview-header"},Mn={class:"form-label"},Un={class:"json-code"},Nn={class:"editor-footer"},On={class:"section-actions"},Ln=["disabled","title"],Bn=["disabled","title"],qn=["disabled"],jn=he({__name:"JsonEditor",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},hiddenFields:{default:()=>["currentPlanId","userRequest","rootPlanId"]},currentPlanTemplateId:{}},emits:["rollback","restore","save","update:jsonContent"],setup(n,{emit:e}){const s=n,t=e,{showJsonPreview:a,displayData:l,formattedJsonOutput:i,addStep:p,removeStep:b,moveStepUp:d,moveStepDown:h,handleRollback:k,handleRestore:C,handleSave:U,toggleJsonPreview:_,closeJsonPreview:y}=rs(s,t),m=g=>{const w=g.target;if(!w)return;w.style.height="auto";const $=20,P=Math.ceil(w.scrollHeight/$),f=4,j=12,x=Math.max(f,Math.min(j,P)),se=x*$;w.style.height=`${se}px`,w.rows=x,P>j?w.style.overflowY="auto":w.style.overflowY="hidden"};return(g,w)=>(u(),v("div",Qo,[o("div",Zo,[S(r(E),{icon:"carbon:code",width:"16"}),o("span",null,c(g.$t("sidebar.jsonTemplate")),1)]),o("div",en,[o("div",tn,[o("div",sn,[o("label",on,c(g.$t("sidebar.title")),1),oe(o("input",{"onUpdate:modelValue":w[0]||(w[0]=$=>r(l).title=$),type:"text",class:"form-input",placeholder:g.$t("sidebar.titlePlaceholder")},null,8,nn),[[ce,r(l).title]])])]),o("div",an,[o("div",ln,[o("label",rn,c(g.$t("sidebar.tasks")),1)]),o("div",cn,[(u(!0),v(re,null,ie(r(l).steps,($,P)=>(u(),v("div",{key:P,class:"step-item"},[o("div",dn,[o("span",un,c(g.$t("sidebar.subtask"))+" "+c(P+1),1),o("div",pn,[o("button",{onClick:f=>r(d)(P),disabled:P===0,class:"btn btn-xs",title:g.$t("sidebar.moveUp")},[S(r(E),{icon:"carbon:chevron-up",width:"12"})],8,hn),o("button",{onClick:f=>r(h)(P),disabled:P===r(l).steps.length-1,class:"btn btn-xs",title:g.$t("sidebar.moveDown")},[S(r(E),{icon:"carbon:chevron-down",width:"12"})],8,mn),o("button",{onClick:f=>r(b)(P),class:"btn btn-xs btn-danger",title:g.$t("sidebar.removeStep")},[S(r(E),{icon:"carbon:trash-can",width:"12"})],8,fn)])]),o("div",vn,[o("div",gn,[o("label",bn,c(g.$t("sidebar.agent")),1),o("div",yn,[oe(o("select",{"onUpdate:modelValue":f=>$.agentName=f,class:"form-select agent-select"},[o("option",$n,c(g.$t("sidebar.selectAgent")),1),w[10]||(w[10]=Os('<option value="DEFAULT_AGENT" data-v-228d1ada>DEFAULT_AGENT</option><option value="BROWSER_AGENT" data-v-228d1ada>BROWSER_AGENT</option><option value="TEXT_FILE_AGENT" data-v-228d1ada>TEXT_FILE_AGENT</option><option value="JSX_GENERATOR_AGENT" data-v-228d1ada>JSX_GENERATOR_AGENT</option><option value="FILE_MANAGER_AGENT" data-v-228d1ada>FILE_MANAGER_AGENT</option>',5))],8,_n),[[pt,$.agentName]]),o("button",{onClick:w[1]||(w[1]=(...f)=>r(p)&&r(p)(...f)),class:"btn btn-sm btn-add-step",title:g.$t("sidebar.addStep")},[S(r(E),{icon:"carbon:add",width:"14"})],8,wn)])]),o("div",Sn,[o("label",kn,c(g.$t("sidebar.stepRequirement")),1),oe(o("textarea",{"onUpdate:modelValue":f=>$.stepContent=f,class:"form-textarea auto-resize",placeholder:g.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:w[2]||(w[2]=f=>m(f))},null,40,Tn),[[ce,$.stepContent]])]),o("div",En,[o("label",Pn,c(g.$t("sidebar.terminateColumns")),1),oe(o("input",{"onUpdate:modelValue":f=>$.terminateColumns=f,type:"text",class:"form-input",placeholder:g.$t("sidebar.terminateColumnsPlaceholder")},null,8,Cn),[[ce,$.terminateColumns]])])])]))),128)),r(l).steps.length===0?(u(),v("div",Rn,[S(r(E),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),o("p",null,c(g.$t("sidebar.noSteps")),1),o("button",{onClick:w[3]||(w[3]=(...$)=>r(p)&&r(p)(...$)),class:"btn btn-primary"},[S(r(E),{icon:"carbon:add",width:"14"}),ne(" "+c(g.$t("sidebar.addFirstStep")),1)])])):B("",!0)])]),o("div",In,[o("div",An,[o("label",xn,c(g.$t("sidebar.planId")),1),oe(o("input",{"onUpdate:modelValue":w[4]||(w[4]=$=>r(l).planTemplateId=$),type:"text",class:"form-input",placeholder:"planTemplate-1756109892045"},null,512),[[ce,r(l).planTemplateId]])])]),r(a)?(u(),v("div",Dn,[o("div",Fn,[o("label",Mn,c(g.$t("sidebar.jsonPreview")),1),o("button",{onClick:w[5]||(w[5]=(...$)=>r(y)&&r(y)(...$)),class:"btn btn-xs"},[S(r(E),{icon:"carbon:close",width:"12"})])]),o("pre",Un,c(r(i)),1)])):B("",!0),o("div",Nn,[o("button",{onClick:w[6]||(w[6]=(...$)=>r(_)&&r(_)(...$)),class:"btn btn-sm btn-secondary"},[S(r(E),{icon:"carbon:code",width:"14"}),ne(" "+c(r(a)?g.$t("sidebar.hideJson"):g.$t("sidebar.showJson")),1)]),o("div",On,[o("button",{class:"btn btn-sm",onClick:w[7]||(w[7]=(...$)=>r(k)&&r(k)(...$)),disabled:!(g.canRollback??!1),title:g.$t("sidebar.rollback")},[S(r(E),{icon:"carbon:undo",width:"14"})],8,Ln),o("button",{class:"btn btn-sm",onClick:w[8]||(w[8]=(...$)=>r(C)&&r(C)(...$)),disabled:!(g.canRestore??!1),title:g.$t("sidebar.restore")},[S(r(E),{icon:"carbon:redo",width:"14"})],8,Bn),o("button",{class:"btn btn-primary",onClick:w[9]||(w[9]=(...$)=>r(U)&&r(U)(...$)),disabled:g.isGenerating||g.isExecuting},[S(r(E),{icon:"carbon:save",width:"14"}),w[11]||(w[11]=ne(" Save "))],8,qn)])])])]))}}),Vn=me(jn,[["__scopeId","data-v-228d1ada"]]);function is(n,e){return function(){return n.apply(e,arguments)}}const{toString:Hn}=Object.prototype,{getPrototypeOf:Ft}=Object,{iterator:ht,toStringTag:cs}=Symbol,mt=(n=>e=>{const s=Hn.call(e);return n[s]||(n[s]=s.slice(8,-1).toLowerCase())})(Object.create(null)),Ce=n=>(n=n.toLowerCase(),e=>mt(e)===n),ft=n=>e=>typeof e===n,{isArray:ze}=Array,et=ft("undefined");function Wn(n){return n!==null&&!et(n)&&n.constructor!==null&&!et(n.constructor)&&$e(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const ds=Ce("ArrayBuffer");function zn(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&ds(n.buffer),e}const Jn=ft("string"),$e=ft("function"),us=ft("number"),vt=n=>n!==null&&typeof n=="object",Gn=n=>n===!0||n===!1,lt=n=>{if(mt(n)!=="object")return!1;const e=Ft(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(cs in n)&&!(ht in n)},Kn=Ce("Date"),Xn=Ce("File"),Yn=Ce("Blob"),Qn=Ce("FileList"),Zn=n=>vt(n)&&$e(n.pipe),ea=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||$e(n.append)&&((e=mt(n))==="formdata"||e==="object"&&$e(n.toString)&&n.toString()==="[object FormData]"))},ta=Ce("URLSearchParams"),[sa,oa,na,aa]=["ReadableStream","Request","Response","Headers"].map(Ce),la=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function st(n,e,{allOwnKeys:s=!1}={}){if(n===null||typeof n>"u")return;let t,a;if(typeof n!="object"&&(n=[n]),ze(n))for(t=0,a=n.length;t<a;t++)e.call(null,n[t],t,n);else{const l=s?Object.getOwnPropertyNames(n):Object.keys(n),i=l.length;let p;for(t=0;t<i;t++)p=l[t],e.call(null,n[p],p,n)}}function ps(n,e){e=e.toLowerCase();const s=Object.keys(n);let t=s.length,a;for(;t-- >0;)if(a=s[t],e===a.toLowerCase())return a;return null}const Le=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,hs=n=>!et(n)&&n!==Le;function Tt(){const{caseless:n}=hs(this)&&this||{},e={},s=(t,a)=>{const l=n&&ps(e,a)||a;lt(e[l])&&lt(t)?e[l]=Tt(e[l],t):lt(t)?e[l]=Tt({},t):ze(t)?e[l]=t.slice():e[l]=t};for(let t=0,a=arguments.length;t<a;t++)arguments[t]&&st(arguments[t],s);return e}const ra=(n,e,s,{allOwnKeys:t}={})=>(st(e,(a,l)=>{s&&$e(a)?n[l]=is(a,s):n[l]=a},{allOwnKeys:t}),n),ia=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),ca=(n,e,s,t)=>{n.prototype=Object.create(e.prototype,t),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),s&&Object.assign(n.prototype,s)},da=(n,e,s,t)=>{let a,l,i;const p={};if(e=e||{},n==null)return e;do{for(a=Object.getOwnPropertyNames(n),l=a.length;l-- >0;)i=a[l],(!t||t(i,n,e))&&!p[i]&&(e[i]=n[i],p[i]=!0);n=s!==!1&&Ft(n)}while(n&&(!s||s(n,e))&&n!==Object.prototype);return e},ua=(n,e,s)=>{n=String(n),(s===void 0||s>n.length)&&(s=n.length),s-=e.length;const t=n.indexOf(e,s);return t!==-1&&t===s},pa=n=>{if(!n)return null;if(ze(n))return n;let e=n.length;if(!us(e))return null;const s=new Array(e);for(;e-- >0;)s[e]=n[e];return s},ha=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&Ft(Uint8Array)),ma=(n,e)=>{const t=(n&&n[ht]).call(n);let a;for(;(a=t.next())&&!a.done;){const l=a.value;e.call(n,l[0],l[1])}},fa=(n,e)=>{let s;const t=[];for(;(s=n.exec(e))!==null;)t.push(s);return t},va=Ce("HTMLFormElement"),ga=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(s,t,a){return t.toUpperCase()+a}),qt=(({hasOwnProperty:n})=>(e,s)=>n.call(e,s))(Object.prototype),ba=Ce("RegExp"),ms=(n,e)=>{const s=Object.getOwnPropertyDescriptors(n),t={};st(s,(a,l)=>{let i;(i=e(a,l,n))!==!1&&(t[l]=i||a)}),Object.defineProperties(n,t)},ya=n=>{ms(n,(e,s)=>{if($e(n)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const t=n[s];if($e(t)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")})}})},_a=(n,e)=>{const s={},t=a=>{a.forEach(l=>{s[l]=!0})};return ze(n)?t(n):t(String(n).split(e)),s},$a=()=>{},wa=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e;function Sa(n){return!!(n&&$e(n.append)&&n[cs]==="FormData"&&n[ht])}const ka=n=>{const e=new Array(10),s=(t,a)=>{if(vt(t)){if(e.indexOf(t)>=0)return;if(!("toJSON"in t)){e[a]=t;const l=ze(t)?[]:{};return st(t,(i,p)=>{const b=s(i,a+1);!et(b)&&(l[p]=b)}),e[a]=void 0,l}}return t};return s(n,0)},Ta=Ce("AsyncFunction"),Ea=n=>n&&(vt(n)||$e(n))&&$e(n.then)&&$e(n.catch),fs=((n,e)=>n?setImmediate:e?((s,t)=>(Le.addEventListener("message",({source:a,data:l})=>{a===Le&&l===s&&t.length&&t.shift()()},!1),a=>{t.push(a),Le.postMessage(s,"*")}))(`axios@${Math.random()}`,[]):s=>setTimeout(s))(typeof setImmediate=="function",$e(Le.postMessage)),Pa=typeof queueMicrotask<"u"?queueMicrotask.bind(Le):typeof process<"u"&&process.nextTick||fs,Ca=n=>n!=null&&$e(n[ht]),R={isArray:ze,isArrayBuffer:ds,isBuffer:Wn,isFormData:ea,isArrayBufferView:zn,isString:Jn,isNumber:us,isBoolean:Gn,isObject:vt,isPlainObject:lt,isReadableStream:sa,isRequest:oa,isResponse:na,isHeaders:aa,isUndefined:et,isDate:Kn,isFile:Xn,isBlob:Yn,isRegExp:ba,isFunction:$e,isStream:Zn,isURLSearchParams:ta,isTypedArray:ha,isFileList:Qn,forEach:st,merge:Tt,extend:ra,trim:la,stripBOM:ia,inherits:ca,toFlatObject:da,kindOf:mt,kindOfTest:Ce,endsWith:ua,toArray:pa,forEachEntry:ma,matchAll:fa,isHTMLForm:va,hasOwnProperty:qt,hasOwnProp:qt,reduceDescriptors:ms,freezeMethods:ya,toObjectSet:_a,toCamelCase:ga,noop:$a,toFiniteNumber:wa,findKey:ps,global:Le,isContextDefined:hs,isSpecCompliantForm:Sa,toJSONObject:ka,isAsyncFn:Ta,isThenable:Ea,setImmediate:fs,asap:Pa,isIterable:Ca};function te(n,e,s,t,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),s&&(this.config=s),t&&(this.request=t),a&&(this.response=a,this.status=a.status?a.status:null)}R.inherits(te,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:R.toJSONObject(this.config),code:this.code,status:this.status}}});const vs=te.prototype,gs={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{gs[n]={value:n}});Object.defineProperties(te,gs);Object.defineProperty(vs,"isAxiosError",{value:!0});te.from=(n,e,s,t,a,l)=>{const i=Object.create(vs);return R.toFlatObject(n,i,function(b){return b!==Error.prototype},p=>p!=="isAxiosError"),te.call(i,n.message,e,s,t,a),i.cause=n,i.name=n.name,l&&Object.assign(i,l),i};const Ra=null;function Et(n){return R.isPlainObject(n)||R.isArray(n)}function bs(n){return R.endsWith(n,"[]")?n.slice(0,-2):n}function jt(n,e,s){return n?n.concat(e).map(function(a,l){return a=bs(a),!s&&l?"["+a+"]":a}).join(s?".":""):e}function Ia(n){return R.isArray(n)&&!n.some(Et)}const Aa=R.toFlatObject(R,{},null,function(e){return/^is[A-Z]/.test(e)});function gt(n,e,s){if(!R.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,s=R.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(y,m){return!R.isUndefined(m[y])});const t=s.metaTokens,a=s.visitor||h,l=s.dots,i=s.indexes,b=(s.Blob||typeof Blob<"u"&&Blob)&&R.isSpecCompliantForm(e);if(!R.isFunction(a))throw new TypeError("visitor must be a function");function d(_){if(_===null)return"";if(R.isDate(_))return _.toISOString();if(!b&&R.isBlob(_))throw new te("Blob is not supported. Use a Buffer instead.");return R.isArrayBuffer(_)||R.isTypedArray(_)?b&&typeof Blob=="function"?new Blob([_]):Buffer.from(_):_}function h(_,y,m){let g=_;if(_&&!m&&typeof _=="object"){if(R.endsWith(y,"{}"))y=t?y:y.slice(0,-2),_=JSON.stringify(_);else if(R.isArray(_)&&Ia(_)||(R.isFileList(_)||R.endsWith(y,"[]"))&&(g=R.toArray(_)))return y=bs(y),g.forEach(function($,P){!(R.isUndefined($)||$===null)&&e.append(i===!0?jt([y],P,l):i===null?y:y+"[]",d($))}),!1}return Et(_)?!0:(e.append(jt(m,y,l),d(_)),!1)}const k=[],C=Object.assign(Aa,{defaultVisitor:h,convertValue:d,isVisitable:Et});function U(_,y){if(!R.isUndefined(_)){if(k.indexOf(_)!==-1)throw Error("Circular reference detected in "+y.join("."));k.push(_),R.forEach(_,function(g,w){(!(R.isUndefined(g)||g===null)&&a.call(e,g,R.isString(w)?w.trim():w,y,C))===!0&&U(g,y?y.concat(w):[w])}),k.pop()}}if(!R.isObject(n))throw new TypeError("data must be an object");return U(n),e}function Vt(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(t){return e[t]})}function Mt(n,e){this._pairs=[],n&&gt(n,this,e)}const ys=Mt.prototype;ys.append=function(e,s){this._pairs.push([e,s])};ys.toString=function(e){const s=e?function(t){return e.call(this,t,Vt)}:Vt;return this._pairs.map(function(a){return s(a[0])+"="+s(a[1])},"").join("&")};function xa(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function _s(n,e,s){if(!e)return n;const t=s&&s.encode||xa;R.isFunction(s)&&(s={serialize:s});const a=s&&s.serialize;let l;if(a?l=a(e,s):l=R.isURLSearchParams(e)?e.toString():new Mt(e,s).toString(t),l){const i=n.indexOf("#");i!==-1&&(n=n.slice(0,i)),n+=(n.indexOf("?")===-1?"?":"&")+l}return n}class Ht{constructor(){this.handlers=[]}use(e,s,t){return this.handlers.push({fulfilled:e,rejected:s,synchronous:t?t.synchronous:!1,runWhen:t?t.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){R.forEach(this.handlers,function(t){t!==null&&e(t)})}}const $s={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Da=typeof URLSearchParams<"u"?URLSearchParams:Mt,Fa=typeof FormData<"u"?FormData:null,Ma=typeof Blob<"u"?Blob:null,Ua={isBrowser:!0,classes:{URLSearchParams:Da,FormData:Fa,Blob:Ma},protocols:["http","https","file","blob","url","data"]},Ut=typeof window<"u"&&typeof document<"u",Pt=typeof navigator=="object"&&navigator||void 0,Na=Ut&&(!Pt||["ReactNative","NativeScript","NS"].indexOf(Pt.product)<0),Oa=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",La=Ut&&window.location.href||"http://localhost",Ba=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ut,hasStandardBrowserEnv:Na,hasStandardBrowserWebWorkerEnv:Oa,navigator:Pt,origin:La},Symbol.toStringTag,{value:"Module"})),ye={...Ba,...Ua};function qa(n,e){return gt(n,new ye.classes.URLSearchParams,Object.assign({visitor:function(s,t,a,l){return ye.isNode&&R.isBuffer(s)?(this.append(t,s.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)}},e))}function ja(n){return R.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Va(n){const e={},s=Object.keys(n);let t;const a=s.length;let l;for(t=0;t<a;t++)l=s[t],e[l]=n[l];return e}function ws(n){function e(s,t,a,l){let i=s[l++];if(i==="__proto__")return!0;const p=Number.isFinite(+i),b=l>=s.length;return i=!i&&R.isArray(a)?a.length:i,b?(R.hasOwnProp(a,i)?a[i]=[a[i],t]:a[i]=t,!p):((!a[i]||!R.isObject(a[i]))&&(a[i]=[]),e(s,t,a[i],l)&&R.isArray(a[i])&&(a[i]=Va(a[i])),!p)}if(R.isFormData(n)&&R.isFunction(n.entries)){const s={};return R.forEachEntry(n,(t,a)=>{e(ja(t),a,s,0)}),s}return null}function Ha(n,e,s){if(R.isString(n))try{return(e||JSON.parse)(n),R.trim(n)}catch(t){if(t.name!=="SyntaxError")throw t}return(s||JSON.stringify)(n)}const ot={transitional:$s,adapter:["xhr","http","fetch"],transformRequest:[function(e,s){const t=s.getContentType()||"",a=t.indexOf("application/json")>-1,l=R.isObject(e);if(l&&R.isHTMLForm(e)&&(e=new FormData(e)),R.isFormData(e))return a?JSON.stringify(ws(e)):e;if(R.isArrayBuffer(e)||R.isBuffer(e)||R.isStream(e)||R.isFile(e)||R.isBlob(e)||R.isReadableStream(e))return e;if(R.isArrayBufferView(e))return e.buffer;if(R.isURLSearchParams(e))return s.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let p;if(l){if(t.indexOf("application/x-www-form-urlencoded")>-1)return qa(e,this.formSerializer).toString();if((p=R.isFileList(e))||t.indexOf("multipart/form-data")>-1){const b=this.env&&this.env.FormData;return gt(p?{"files[]":e}:e,b&&new b,this.formSerializer)}}return l||a?(s.setContentType("application/json",!1),Ha(e)):e}],transformResponse:[function(e){const s=this.transitional||ot.transitional,t=s&&s.forcedJSONParsing,a=this.responseType==="json";if(R.isResponse(e)||R.isReadableStream(e))return e;if(e&&R.isString(e)&&(t&&!this.responseType||a)){const i=!(s&&s.silentJSONParsing)&&a;try{return JSON.parse(e)}catch(p){if(i)throw p.name==="SyntaxError"?te.from(p,te.ERR_BAD_RESPONSE,this,null,this.response):p}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ye.classes.FormData,Blob:ye.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};R.forEach(["delete","get","head","post","put","patch"],n=>{ot.headers[n]={}});const Wa=R.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),za=n=>{const e={};let s,t,a;return n&&n.split(`
`).forEach(function(i){a=i.indexOf(":"),s=i.substring(0,a).trim().toLowerCase(),t=i.substring(a+1).trim(),!(!s||e[s]&&Wa[s])&&(s==="set-cookie"?e[s]?e[s].push(t):e[s]=[t]:e[s]=e[s]?e[s]+", "+t:t)}),e},Wt=Symbol("internals");function Xe(n){return n&&String(n).trim().toLowerCase()}function rt(n){return n===!1||n==null?n:R.isArray(n)?n.map(rt):String(n)}function Ja(n){const e=Object.create(null),s=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let t;for(;t=s.exec(n);)e[t[1]]=t[2];return e}const Ga=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function wt(n,e,s,t,a){if(R.isFunction(t))return t.call(this,e,s);if(a&&(e=s),!!R.isString(e)){if(R.isString(t))return e.indexOf(t)!==-1;if(R.isRegExp(t))return t.test(e)}}function Ka(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,s,t)=>s.toUpperCase()+t)}function Xa(n,e){const s=R.toCamelCase(" "+e);["get","set","has"].forEach(t=>{Object.defineProperty(n,t+s,{value:function(a,l,i){return this[t].call(this,e,a,l,i)},configurable:!0})})}let we=class{constructor(e){e&&this.set(e)}set(e,s,t){const a=this;function l(p,b,d){const h=Xe(b);if(!h)throw new Error("header name must be a non-empty string");const k=R.findKey(a,h);(!k||a[k]===void 0||d===!0||d===void 0&&a[k]!==!1)&&(a[k||b]=rt(p))}const i=(p,b)=>R.forEach(p,(d,h)=>l(d,h,b));if(R.isPlainObject(e)||e instanceof this.constructor)i(e,s);else if(R.isString(e)&&(e=e.trim())&&!Ga(e))i(za(e),s);else if(R.isObject(e)&&R.isIterable(e)){let p={},b,d;for(const h of e){if(!R.isArray(h))throw TypeError("Object iterator must return a key-value pair");p[d=h[0]]=(b=p[d])?R.isArray(b)?[...b,h[1]]:[b,h[1]]:h[1]}i(p,s)}else e!=null&&l(s,e,t);return this}get(e,s){if(e=Xe(e),e){const t=R.findKey(this,e);if(t){const a=this[t];if(!s)return a;if(s===!0)return Ja(a);if(R.isFunction(s))return s.call(this,a,t);if(R.isRegExp(s))return s.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,s){if(e=Xe(e),e){const t=R.findKey(this,e);return!!(t&&this[t]!==void 0&&(!s||wt(this,this[t],t,s)))}return!1}delete(e,s){const t=this;let a=!1;function l(i){if(i=Xe(i),i){const p=R.findKey(t,i);p&&(!s||wt(t,t[p],p,s))&&(delete t[p],a=!0)}}return R.isArray(e)?e.forEach(l):l(e),a}clear(e){const s=Object.keys(this);let t=s.length,a=!1;for(;t--;){const l=s[t];(!e||wt(this,this[l],l,e,!0))&&(delete this[l],a=!0)}return a}normalize(e){const s=this,t={};return R.forEach(this,(a,l)=>{const i=R.findKey(t,l);if(i){s[i]=rt(a),delete s[l];return}const p=e?Ka(l):String(l).trim();p!==l&&delete s[l],s[p]=rt(a),t[p]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const s=Object.create(null);return R.forEach(this,(t,a)=>{t!=null&&t!==!1&&(s[a]=e&&R.isArray(t)?t.join(", "):t)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,s])=>e+": "+s).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...s){const t=new this(e);return s.forEach(a=>t.set(a)),t}static accessor(e){const t=(this[Wt]=this[Wt]={accessors:{}}).accessors,a=this.prototype;function l(i){const p=Xe(i);t[p]||(Xa(a,i),t[p]=!0)}return R.isArray(e)?e.forEach(l):l(e),this}};we.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);R.reduceDescriptors(we.prototype,({value:n},e)=>{let s=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(t){this[s]=t}}});R.freezeMethods(we);function St(n,e){const s=this||ot,t=e||s,a=we.from(t.headers);let l=t.data;return R.forEach(n,function(p){l=p.call(s,l,a.normalize(),e?e.status:void 0)}),a.normalize(),l}function Ss(n){return!!(n&&n.__CANCEL__)}function Je(n,e,s){te.call(this,n??"canceled",te.ERR_CANCELED,e,s),this.name="CanceledError"}R.inherits(Je,te,{__CANCEL__:!0});function ks(n,e,s){const t=s.config.validateStatus;!s.status||!t||t(s.status)?n(s):e(new te("Request failed with status code "+s.status,[te.ERR_BAD_REQUEST,te.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s))}function Ya(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function Qa(n,e){n=n||10;const s=new Array(n),t=new Array(n);let a=0,l=0,i;return e=e!==void 0?e:1e3,function(b){const d=Date.now(),h=t[l];i||(i=d),s[a]=b,t[a]=d;let k=l,C=0;for(;k!==a;)C+=s[k++],k=k%n;if(a=(a+1)%n,a===l&&(l=(l+1)%n),d-i<e)return;const U=h&&d-h;return U?Math.round(C*1e3/U):void 0}}function Za(n,e){let s=0,t=1e3/e,a,l;const i=(d,h=Date.now())=>{s=h,a=null,l&&(clearTimeout(l),l=null),n.apply(null,d)};return[(...d)=>{const h=Date.now(),k=h-s;k>=t?i(d,h):(a=d,l||(l=setTimeout(()=>{l=null,i(a)},t-k)))},()=>a&&i(a)]}const dt=(n,e,s=3)=>{let t=0;const a=Qa(50,250);return Za(l=>{const i=l.loaded,p=l.lengthComputable?l.total:void 0,b=i-t,d=a(b),h=i<=p;t=i;const k={loaded:i,total:p,progress:p?i/p:void 0,bytes:b,rate:d||void 0,estimated:d&&p&&h?(p-i)/d:void 0,event:l,lengthComputable:p!=null,[e?"download":"upload"]:!0};n(k)},s)},zt=(n,e)=>{const s=n!=null;return[t=>e[0]({lengthComputable:s,total:n,loaded:t}),e[1]]},Jt=n=>(...e)=>R.asap(()=>n(...e)),el=ye.hasStandardBrowserEnv?((n,e)=>s=>(s=new URL(s,ye.origin),n.protocol===s.protocol&&n.host===s.host&&(e||n.port===s.port)))(new URL(ye.origin),ye.navigator&&/(msie|trident)/i.test(ye.navigator.userAgent)):()=>!0,tl=ye.hasStandardBrowserEnv?{write(n,e,s,t,a,l){const i=[n+"="+encodeURIComponent(e)];R.isNumber(s)&&i.push("expires="+new Date(s).toGMTString()),R.isString(t)&&i.push("path="+t),R.isString(a)&&i.push("domain="+a),l===!0&&i.push("secure"),document.cookie=i.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function sl(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function ol(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function Ts(n,e,s){let t=!sl(e);return n&&(t||s==!1)?ol(n,e):e}const Gt=n=>n instanceof we?{...n}:n;function je(n,e){e=e||{};const s={};function t(d,h,k,C){return R.isPlainObject(d)&&R.isPlainObject(h)?R.merge.call({caseless:C},d,h):R.isPlainObject(h)?R.merge({},h):R.isArray(h)?h.slice():h}function a(d,h,k,C){if(R.isUndefined(h)){if(!R.isUndefined(d))return t(void 0,d,k,C)}else return t(d,h,k,C)}function l(d,h){if(!R.isUndefined(h))return t(void 0,h)}function i(d,h){if(R.isUndefined(h)){if(!R.isUndefined(d))return t(void 0,d)}else return t(void 0,h)}function p(d,h,k){if(k in e)return t(d,h);if(k in n)return t(void 0,d)}const b={url:l,method:l,data:l,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:p,headers:(d,h,k)=>a(Gt(d),Gt(h),k,!0)};return R.forEach(Object.keys(Object.assign({},n,e)),function(h){const k=b[h]||a,C=k(n[h],e[h],h);R.isUndefined(C)&&k!==p||(s[h]=C)}),s}const Es=n=>{const e=je({},n);let{data:s,withXSRFToken:t,xsrfHeaderName:a,xsrfCookieName:l,headers:i,auth:p}=e;e.headers=i=we.from(i),e.url=_s(Ts(e.baseURL,e.url,e.allowAbsoluteUrls),n.params,n.paramsSerializer),p&&i.set("Authorization","Basic "+btoa((p.username||"")+":"+(p.password?unescape(encodeURIComponent(p.password)):"")));let b;if(R.isFormData(s)){if(ye.hasStandardBrowserEnv||ye.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if((b=i.getContentType())!==!1){const[d,...h]=b?b.split(";").map(k=>k.trim()).filter(Boolean):[];i.setContentType([d||"multipart/form-data",...h].join("; "))}}if(ye.hasStandardBrowserEnv&&(t&&R.isFunction(t)&&(t=t(e)),t||t!==!1&&el(e.url))){const d=a&&l&&tl.read(l);d&&i.set(a,d)}return e},nl=typeof XMLHttpRequest<"u",al=nl&&function(n){return new Promise(function(s,t){const a=Es(n);let l=a.data;const i=we.from(a.headers).normalize();let{responseType:p,onUploadProgress:b,onDownloadProgress:d}=a,h,k,C,U,_;function y(){U&&U(),_&&_(),a.cancelToken&&a.cancelToken.unsubscribe(h),a.signal&&a.signal.removeEventListener("abort",h)}let m=new XMLHttpRequest;m.open(a.method.toUpperCase(),a.url,!0),m.timeout=a.timeout;function g(){if(!m)return;const $=we.from("getAllResponseHeaders"in m&&m.getAllResponseHeaders()),f={data:!p||p==="text"||p==="json"?m.responseText:m.response,status:m.status,statusText:m.statusText,headers:$,config:n,request:m};ks(function(x){s(x),y()},function(x){t(x),y()},f),m=null}"onloadend"in m?m.onloadend=g:m.onreadystatechange=function(){!m||m.readyState!==4||m.status===0&&!(m.responseURL&&m.responseURL.indexOf("file:")===0)||setTimeout(g)},m.onabort=function(){m&&(t(new te("Request aborted",te.ECONNABORTED,n,m)),m=null)},m.onerror=function(){t(new te("Network Error",te.ERR_NETWORK,n,m)),m=null},m.ontimeout=function(){let P=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const f=a.transitional||$s;a.timeoutErrorMessage&&(P=a.timeoutErrorMessage),t(new te(P,f.clarifyTimeoutError?te.ETIMEDOUT:te.ECONNABORTED,n,m)),m=null},l===void 0&&i.setContentType(null),"setRequestHeader"in m&&R.forEach(i.toJSON(),function(P,f){m.setRequestHeader(f,P)}),R.isUndefined(a.withCredentials)||(m.withCredentials=!!a.withCredentials),p&&p!=="json"&&(m.responseType=a.responseType),d&&([C,_]=dt(d,!0),m.addEventListener("progress",C)),b&&m.upload&&([k,U]=dt(b),m.upload.addEventListener("progress",k),m.upload.addEventListener("loadend",U)),(a.cancelToken||a.signal)&&(h=$=>{m&&(t(!$||$.type?new Je(null,n,m):$),m.abort(),m=null)},a.cancelToken&&a.cancelToken.subscribe(h),a.signal&&(a.signal.aborted?h():a.signal.addEventListener("abort",h)));const w=Ya(a.url);if(w&&ye.protocols.indexOf(w)===-1){t(new te("Unsupported protocol "+w+":",te.ERR_BAD_REQUEST,n));return}m.send(l||null)})},ll=(n,e)=>{const{length:s}=n=n?n.filter(Boolean):[];if(e||s){let t=new AbortController,a;const l=function(d){if(!a){a=!0,p();const h=d instanceof Error?d:this.reason;t.abort(h instanceof te?h:new Je(h instanceof Error?h.message:h))}};let i=e&&setTimeout(()=>{i=null,l(new te(`timeout ${e} of ms exceeded`,te.ETIMEDOUT))},e);const p=()=>{n&&(i&&clearTimeout(i),i=null,n.forEach(d=>{d.unsubscribe?d.unsubscribe(l):d.removeEventListener("abort",l)}),n=null)};n.forEach(d=>d.addEventListener("abort",l));const{signal:b}=t;return b.unsubscribe=()=>R.asap(p),b}},rl=function*(n,e){let s=n.byteLength;if(s<e){yield n;return}let t=0,a;for(;t<s;)a=t+e,yield n.slice(t,a),t=a},il=async function*(n,e){for await(const s of cl(n))yield*rl(s,e)},cl=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:s,value:t}=await e.read();if(s)break;yield t}}finally{await e.cancel()}},Kt=(n,e,s,t)=>{const a=il(n,e);let l=0,i,p=b=>{i||(i=!0,t&&t(b))};return new ReadableStream({async pull(b){try{const{done:d,value:h}=await a.next();if(d){p(),b.close();return}let k=h.byteLength;if(s){let C=l+=k;s(C)}b.enqueue(new Uint8Array(h))}catch(d){throw p(d),d}},cancel(b){return p(b),a.return()}},{highWaterMark:2})},bt=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Ps=bt&&typeof ReadableStream=="function",dl=bt&&(typeof TextEncoder=="function"?(n=>e=>n.encode(e))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),Cs=(n,...e)=>{try{return!!n(...e)}catch{return!1}},ul=Ps&&Cs(()=>{let n=!1;const e=new Request(ye.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e}),Xt=64*1024,Ct=Ps&&Cs(()=>R.isReadableStream(new Response("").body)),ut={stream:Ct&&(n=>n.body)};bt&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!ut[e]&&(ut[e]=R.isFunction(n[e])?s=>s[e]():(s,t)=>{throw new te(`Response type '${e}' is not supported`,te.ERR_NOT_SUPPORT,t)})})})(new Response);const pl=async n=>{if(n==null)return 0;if(R.isBlob(n))return n.size;if(R.isSpecCompliantForm(n))return(await new Request(ye.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(R.isArrayBufferView(n)||R.isArrayBuffer(n))return n.byteLength;if(R.isURLSearchParams(n)&&(n=n+""),R.isString(n))return(await dl(n)).byteLength},hl=async(n,e)=>{const s=R.toFiniteNumber(n.getContentLength());return s??pl(e)},ml=bt&&(async n=>{let{url:e,method:s,data:t,signal:a,cancelToken:l,timeout:i,onDownloadProgress:p,onUploadProgress:b,responseType:d,headers:h,withCredentials:k="same-origin",fetchOptions:C}=Es(n);d=d?(d+"").toLowerCase():"text";let U=ll([a,l&&l.toAbortSignal()],i),_;const y=U&&U.unsubscribe&&(()=>{U.unsubscribe()});let m;try{if(b&&ul&&s!=="get"&&s!=="head"&&(m=await hl(h,t))!==0){let f=new Request(e,{method:"POST",body:t,duplex:"half"}),j;if(R.isFormData(t)&&(j=f.headers.get("content-type"))&&h.setContentType(j),f.body){const[x,se]=zt(m,dt(Jt(b)));t=Kt(f.body,Xt,x,se)}}R.isString(k)||(k=k?"include":"omit");const g="credentials"in Request.prototype;_=new Request(e,{...C,signal:U,method:s.toUpperCase(),headers:h.normalize().toJSON(),body:t,duplex:"half",credentials:g?k:void 0});let w=await fetch(_);const $=Ct&&(d==="stream"||d==="response");if(Ct&&(p||$&&y)){const f={};["status","statusText","headers"].forEach(A=>{f[A]=w[A]});const j=R.toFiniteNumber(w.headers.get("content-length")),[x,se]=p&&zt(j,dt(Jt(p),!0))||[];w=new Response(Kt(w.body,Xt,x,()=>{se&&se(),y&&y()}),f)}d=d||"text";let P=await ut[R.findKey(ut,d)||"text"](w,n);return!$&&y&&y(),await new Promise((f,j)=>{ks(f,j,{data:P,headers:we.from(w.headers),status:w.status,statusText:w.statusText,config:n,request:_})})}catch(g){throw y&&y(),g&&g.name==="TypeError"&&/Load failed|fetch/i.test(g.message)?Object.assign(new te("Network Error",te.ERR_NETWORK,n,_),{cause:g.cause||g}):te.from(g,g&&g.code,n,_)}}),Rt={http:Ra,xhr:al,fetch:ml};R.forEach(Rt,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const Yt=n=>`- ${n}`,fl=n=>R.isFunction(n)||n===null||n===!1,Rs={getAdapter:n=>{n=R.isArray(n)?n:[n];const{length:e}=n;let s,t;const a={};for(let l=0;l<e;l++){s=n[l];let i;if(t=s,!fl(s)&&(t=Rt[(i=String(s)).toLowerCase()],t===void 0))throw new te(`Unknown adapter '${i}'`);if(t)break;a[i||"#"+l]=t}if(!t){const l=Object.entries(a).map(([p,b])=>`adapter ${p} `+(b===!1?"is not supported by the environment":"is not available in the build"));let i=e?l.length>1?`since :
`+l.map(Yt).join(`
`):" "+Yt(l[0]):"as no adapter specified";throw new te("There is no suitable adapter to dispatch the request "+i,"ERR_NOT_SUPPORT")}return t},adapters:Rt};function kt(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Je(null,n)}function Qt(n){return kt(n),n.headers=we.from(n.headers),n.data=St.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),Rs.getAdapter(n.adapter||ot.adapter)(n).then(function(t){return kt(n),t.data=St.call(n,n.transformResponse,t),t.headers=we.from(t.headers),t},function(t){return Ss(t)||(kt(n),t&&t.response&&(t.response.data=St.call(n,n.transformResponse,t.response),t.response.headers=we.from(t.response.headers))),Promise.reject(t)})}const Is="1.9.0",yt={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{yt[n]=function(t){return typeof t===n||"a"+(e<1?"n ":" ")+n}});const Zt={};yt.transitional=function(e,s,t){function a(l,i){return"[Axios v"+Is+"] Transitional option '"+l+"'"+i+(t?". "+t:"")}return(l,i,p)=>{if(e===!1)throw new te(a(i," has been removed"+(s?" in "+s:"")),te.ERR_DEPRECATED);return s&&!Zt[i]&&(Zt[i]=!0,console.warn(a(i," has been deprecated since v"+s+" and will be removed in the near future"))),e?e(l,i,p):!0}};yt.spelling=function(e){return(s,t)=>(console.warn(`${t} is likely a misspelling of ${e}`),!0)};function vl(n,e,s){if(typeof n!="object")throw new te("options must be an object",te.ERR_BAD_OPTION_VALUE);const t=Object.keys(n);let a=t.length;for(;a-- >0;){const l=t[a],i=e[l];if(i){const p=n[l],b=p===void 0||i(p,l,n);if(b!==!0)throw new te("option "+l+" must be "+b,te.ERR_BAD_OPTION_VALUE);continue}if(s!==!0)throw new te("Unknown option "+l,te.ERR_BAD_OPTION)}}const it={assertOptions:vl,validators:yt},Ae=it.validators;let qe=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Ht,response:new Ht}}async request(e,s){try{return await this._request(e,s)}catch(t){if(t instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const l=a.stack?a.stack.replace(/^.+\n/,""):"";try{t.stack?l&&!String(t.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(t.stack+=`
`+l):t.stack=l}catch{}}throw t}}_request(e,s){typeof e=="string"?(s=s||{},s.url=e):s=e||{},s=je(this.defaults,s);const{transitional:t,paramsSerializer:a,headers:l}=s;t!==void 0&&it.assertOptions(t,{silentJSONParsing:Ae.transitional(Ae.boolean),forcedJSONParsing:Ae.transitional(Ae.boolean),clarifyTimeoutError:Ae.transitional(Ae.boolean)},!1),a!=null&&(R.isFunction(a)?s.paramsSerializer={serialize:a}:it.assertOptions(a,{encode:Ae.function,serialize:Ae.function},!0)),s.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?s.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:s.allowAbsoluteUrls=!0),it.assertOptions(s,{baseUrl:Ae.spelling("baseURL"),withXsrfToken:Ae.spelling("withXSRFToken")},!0),s.method=(s.method||this.defaults.method||"get").toLowerCase();let i=l&&R.merge(l.common,l[s.method]);l&&R.forEach(["delete","get","head","post","put","patch","common"],_=>{delete l[_]}),s.headers=we.concat(i,l);const p=[];let b=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(s)===!1||(b=b&&y.synchronous,p.unshift(y.fulfilled,y.rejected))});const d=[];this.interceptors.response.forEach(function(y){d.push(y.fulfilled,y.rejected)});let h,k=0,C;if(!b){const _=[Qt.bind(this),void 0];for(_.unshift.apply(_,p),_.push.apply(_,d),C=_.length,h=Promise.resolve(s);k<C;)h=h.then(_[k++],_[k++]);return h}C=p.length;let U=s;for(k=0;k<C;){const _=p[k++],y=p[k++];try{U=_(U)}catch(m){y.call(this,m);break}}try{h=Qt.call(this,U)}catch(_){return Promise.reject(_)}for(k=0,C=d.length;k<C;)h=h.then(d[k++],d[k++]);return h}getUri(e){e=je(this.defaults,e);const s=Ts(e.baseURL,e.url,e.allowAbsoluteUrls);return _s(s,e.params,e.paramsSerializer)}};R.forEach(["delete","get","head","options"],function(e){qe.prototype[e]=function(s,t){return this.request(je(t||{},{method:e,url:s,data:(t||{}).data}))}});R.forEach(["post","put","patch"],function(e){function s(t){return function(l,i,p){return this.request(je(p||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:l,data:i}))}}qe.prototype[e]=s(),qe.prototype[e+"Form"]=s(!0)});let gl=class As{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let s;this.promise=new Promise(function(l){s=l});const t=this;this.promise.then(a=>{if(!t._listeners)return;let l=t._listeners.length;for(;l-- >0;)t._listeners[l](a);t._listeners=null}),this.promise.then=a=>{let l;const i=new Promise(p=>{t.subscribe(p),l=p}).then(a);return i.cancel=function(){t.unsubscribe(l)},i},e(function(l,i,p){t.reason||(t.reason=new Je(l,i,p),s(t.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const s=this._listeners.indexOf(e);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const e=new AbortController,s=t=>{e.abort(t)};return this.subscribe(s),e.signal.unsubscribe=()=>this.unsubscribe(s),e.signal}static source(){let e;return{token:new As(function(a){e=a}),cancel:e}}};function bl(n){return function(s){return n.apply(null,s)}}function yl(n){return R.isObject(n)&&n.isAxiosError===!0}const It={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(It).forEach(([n,e])=>{It[e]=n});function xs(n){const e=new qe(n),s=is(qe.prototype.request,e);return R.extend(s,qe.prototype,e,{allOwnKeys:!0}),R.extend(s,e,null,{allOwnKeys:!0}),s.create=function(a){return xs(je(n,a))},s}const ge=xs(ot);ge.Axios=qe;ge.CanceledError=Je;ge.CancelToken=gl;ge.isCancel=Ss;ge.VERSION=Is;ge.toFormData=gt;ge.AxiosError=te;ge.Cancel=ge.CanceledError;ge.all=function(e){return Promise.all(e)};ge.spread=bl;ge.isAxiosError=yl;ge.mergeConfig=je;ge.AxiosHeaders=we;ge.formToJSON=n=>ws(R.isHTMLForm(n)?new FormData(n):n);ge.getAdapter=Rs.getAdapter;ge.HttpStatusCode=It;ge.default=ge;const{Axios:tg,AxiosError:sg,CanceledError:og,isCancel:ng,CancelToken:ag,VERSION:lg,all:rg,Cancel:ig,isAxiosError:cg,spread:dg,toFormData:ug,AxiosHeaders:pg,HttpStatusCode:hg,formToJSON:mg,getAdapter:fg,mergeConfig:vg}=ge;class _l{static async getAvailableModels(){try{return(await ge({url:"/api/models/available-models",method:"GET",baseURL:""})).data}catch(e){return console.error("Failed to fetch available models:",e),{options:[],total:0}}}}const $l={class:"config-section"},wl={class:"section-header"},Sl={key:0,class:"error-section"},kl={class:"error-message"},Tl={class:"error-content"},El={class:"error-title"},Pl={class:"error-description"},Cl={key:1,class:"visual-editor"},Rl={class:"plan-basic-info"},Il={class:"form-row"},Al={class:"form-label"},xl=["placeholder"],Dl={key:0,class:"field-error-message"},Fl={class:"form-row"},Ml={class:"form-label"},Ul=["value","placeholder"],Nl={class:"steps-section"},Ol={class:"steps-header"},Ll={class:"form-label"},Bl={class:"steps-actions"},ql=["title"],jl={class:"steps-container"},Vl={class:"step-header"},Hl={class:"step-number"},Wl={class:"step-actions"},zl=["onClick","disabled","title"],Jl=["onClick","disabled","title"],Gl=["onClick","title"],Kl={class:"step-content"},Xl={class:"form-row"},Yl={class:"form-label"},Ql=["onUpdate:modelValue","placeholder"],Zl={class:"form-row"},er={class:"form-label"},tr=["onUpdate:modelValue","placeholder"],sr={class:"form-row"},or={class:"form-label"},nr={class:"model-selector"},ar=["onUpdate:modelValue","disabled"],lr={key:0,disabled:"",value:""},rr={key:1,disabled:"",value:""},ir={value:"",disabled:""},cr={value:""},dr=["value","title"],ur=["title"],pr={key:0,class:"error-message"},hr={class:"form-row"},mr={key:0,class:"empty-steps"},fr={key:0,class:"json-preview"},vr={class:"preview-header"},gr={class:"form-label"},br={class:"json-code"},yr={class:"editor-footer"},_r={class:"section-actions"},$r=["disabled","title"],wr=["disabled","title"],Sr=["disabled"],kr=he({__name:"JsonEditorV2",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},hiddenFields:{default:()=>[]},currentPlanTemplateId:{default:""}},emits:["rollback","restore","save","update:jsonContent"],setup(n,{emit:e}){const s=n,t=e,{showJsonPreview:a,displayData:l,formattedJsonOutput:i,addStep:p,removeStep:b,moveStepUp:d,moveStepDown:h,handleRollback:k,handleRestore:C,handleSave:U,toggleJsonPreview:_,closeJsonPreview:y}=rs(s,t),m=F(null),g=F(""),w=F([]),$=F(!1),P=F(""),f=F(!1),j=F(-1),x=async()=>{if(!$.value){$.value=!0,P.value="";try{const T=await _l.getAvailableModels();T&&T.options?w.value=T.options:w.value=[]}catch(T){console.error("Failed to load models:",T),P.value=T instanceof Error?T.message:"Failed to load models",w.value=[]}finally{$.value=!1}}},se=T=>{j.value=T,f.value=!0,console.log("[JsonEditorV2] Available tools from store:",z.availableTools)},A=T=>{j.value>=0&&j.value<l.steps.length&&(l.steps[j.value].selectedToolKeys=[...T]),f.value=!1,j.value=-1},N=(T,I)=>{T>=0&&T<l.steps.length&&(l.steps[T].selectedToolKeys=[...I])},W=()=>{try{m.value=null,l.title||(l.title=""),l.steps||(l.steps=[]),l.directResponse=!1}catch(T){const I=`Failed to initialize JsonEditorV2: ${T instanceof Error?T.message:"Unknown error"}`;m.value=I,console.error(I,T)}};fe(()=>l,T=>{try{!T.title||!T.title.trim()?g.value="Title is required field":g.value="",m.value=null}catch(I){m.value=`Invalid data structure: ${I instanceof Error?I.message:"Unknown error"}`,g.value=""}},{immediate:!0,deep:!0}),ke(()=>{W(),x()});const Z=T=>{const I=T.target;if(!I)return;I.style.height="auto";const J=20,Y=Math.ceil(I.scrollHeight/J),M=4,D=12,Q=Math.max(M,Math.min(D,Y)),L=Q*J;I.style.height=`${L}px`,I.rows=Q,Y>D?I.style.overflowY="auto":I.style.overflowY="hidden"};return(T,I)=>{var J;return u(),v("div",$l,[o("div",wl,[S(r(E),{icon:"carbon:code",width:"16"}),o("span",null,c(T.$t("sidebar.dynamicAgentPlan")),1)]),m.value?(u(),v("div",Sl,[o("div",kl,[S(r(E),{icon:"carbon:warning",width:"16"}),o("div",Tl,[o("div",El,c(T.$t("sidebar.planTypeError")),1),o("div",Pl,c(m.value),1)])])])):(u(),v("div",Cl,[o("div",Rl,[o("div",Il,[o("label",Al,c(T.$t("sidebar.title")),1),oe(o("input",{"onUpdate:modelValue":I[0]||(I[0]=Y=>r(l).title=Y),type:"text",class:ae(["form-input",{error:g.value}]),placeholder:T.$t("sidebar.titlePlaceholder")},null,10,xl),[[ce,r(l).title]]),g.value?(u(),v("div",Dl,[S(r(E),{icon:"carbon:warning",width:"12"}),ne(" "+c(g.value),1)])):B("",!0)]),o("div",Fl,[o("label",Ml,c(T.$t("sidebar.planTemplateId")),1),o("input",{value:T.currentPlanTemplateId,type:"text",class:"form-input readonly-input",readonly:"",placeholder:T.$t("sidebar.planTemplateIdPlaceholder")},null,8,Ul)])]),o("div",Nl,[o("div",Ol,[o("label",Ll,c(T.$t("sidebar.tasks")),1),o("div",Bl,[o("button",{onClick:I[1]||(I[1]=(...Y)=>r(p)&&r(p)(...Y)),class:"btn btn-xs",title:T.$t("sidebar.addStep")},[S(r(E),{icon:"carbon:add",width:"12"})],8,ql)])]),o("div",jl,[(u(!0),v(re,null,ie(r(l).steps,(Y,M)=>(u(),v("div",{key:M,class:"step-item"},[o("div",Vl,[o("span",Hl,c(T.$t("sidebar.subtask"))+" "+c(M+1),1),o("div",Wl,[o("button",{onClick:D=>r(d)(M),disabled:M===0,class:"btn btn-xs",title:T.$t("sidebar.moveUp")},[S(r(E),{icon:"carbon:chevron-up",width:"12"})],8,zl),o("button",{onClick:D=>r(h)(M),disabled:M===r(l).steps.length-1,class:"btn btn-xs",title:T.$t("sidebar.moveDown")},[S(r(E),{icon:"carbon:chevron-down",width:"12"})],8,Jl),o("button",{onClick:D=>r(b)(M),class:"btn btn-xs btn-danger",title:T.$t("sidebar.removeStep")},[S(r(E),{icon:"carbon:trash-can",width:"12"})],8,Gl)])]),o("div",Kl,[o("div",Xl,[o("label",Yl,c(T.$t("sidebar.stepRequirement")),1),oe(o("textarea",{"onUpdate:modelValue":D=>Y.stepRequirement=D,class:"form-textarea auto-resize",placeholder:T.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:I[2]||(I[2]=D=>Z(D))},null,40,Ql),[[ce,Y.stepRequirement]])]),o("div",Zl,[o("label",er,c(T.$t("sidebar.terminateColumns")),1),oe(o("textarea",{"onUpdate:modelValue":D=>Y.terminateColumns=D,class:"form-textarea auto-resize",placeholder:T.$t("sidebar.terminateColumnsPlaceholder"),rows:"4",onInput:I[3]||(I[3]=D=>Z(D))},null,40,tr),[[ce,Y.terminateColumns]])]),o("div",sr,[o("label",or,c(T.$t("sidebar.modelName")),1),o("div",nr,[oe(o("select",{"onUpdate:modelValue":D=>Y.modelName=D,class:"form-select model-select",disabled:$.value},[$.value?(u(),v("option",lr,c(T.$t("sidebar.loading")),1)):P.value?(u(),v("option",rr,c(T.$t("sidebar.modelLoadError")),1)):B("",!0),o("option",ir,c(T.$t("sidebar.modelNameDescription")),1),o("option",cr,c(T.$t("sidebar.noModelSelected")),1),(u(!0),v(re,null,ie(w.value,D=>(u(),v("option",{key:D.value,value:D.value,title:D.label},c(D.label),9,dr))),128))],8,ar),[[pt,Y.modelName]]),P.value?(u(),v("button",{key:0,onClick:x,class:"btn btn-sm btn-danger",title:T.$t("sidebar.retryLoadModels")},[S(r(E),{icon:"carbon:warning",width:"14"}),ne(" "+c(T.$t("sidebar.retry")),1)],8,ur)):B("",!0)]),P.value?(u(),v("div",pr,[S(r(E),{icon:"carbon:warning",width:"12"}),ne(" "+c(P.value),1)])):B("",!0)]),o("div",hr,[S(Vs,{title:T.$t("sidebar.selectedTools"),"selected-tool-ids":Y.selectedToolKeys,"available-tools":r(z).availableTools,"add-button-text":T.$t("sidebar.addRemoveTools"),"empty-text":T.$t("sidebar.noTools"),"use-grid-layout":!0,onAddTools:D=>se(M),onToolsFiltered:D=>N(M,D)},null,8,["title","selected-tool-ids","available-tools","add-button-text","empty-text","onAddTools","onToolsFiltered"])])])]))),128)),r(l).steps.length===0?(u(),v("div",mr,[S(r(E),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),o("p",null,c(T.$t("sidebar.noSteps")),1),o("button",{onClick:I[4]||(I[4]=(...Y)=>r(p)&&r(p)(...Y)),class:"btn btn-primary"},[S(r(E),{icon:"carbon:add",width:"14"}),ne(" "+c(T.$t("sidebar.addFirstStep")),1)])])):B("",!0)])]),r(a)?(u(),v("div",fr,[o("div",vr,[o("label",gr,c(T.$t("sidebar.jsonPreview")),1),o("button",{onClick:I[5]||(I[5]=(...Y)=>r(y)&&r(y)(...Y)),class:"btn btn-xs"},[S(r(E),{icon:"carbon:close",width:"12"})])]),o("pre",br,c(r(i)),1)])):B("",!0),o("div",yr,[o("button",{onClick:I[6]||(I[6]=(...Y)=>r(_)&&r(_)(...Y)),class:"btn btn-sm btn-secondary"},[S(r(E),{icon:"carbon:code",width:"14"}),ne(" "+c(r(a)?T.$t("sidebar.hideJson"):T.$t("sidebar.showJson")),1)]),o("div",_r,[o("button",{class:"btn btn-sm",onClick:I[7]||(I[7]=(...Y)=>r(k)&&r(k)(...Y)),disabled:!(T.canRollback??!1),title:T.$t("sidebar.rollback")},[S(r(E),{icon:"carbon:undo",width:"14"})],8,$r),o("button",{class:"btn btn-sm",onClick:I[8]||(I[8]=(...Y)=>r(C)&&r(C)(...Y)),disabled:!(T.canRestore??!1),title:T.$t("sidebar.restore")},[S(r(E),{icon:"carbon:redo",width:"14"})],8,wr),o("button",{class:"btn btn-primary",onClick:I[9]||(I[9]=(...Y)=>r(U)&&r(U)(...Y)),disabled:T.isGenerating||T.isExecuting},[S(r(E),{icon:"carbon:save",width:"14"}),I[11]||(I[11]=ne(" Save "))],8,Sr)])])])),S(Hs,{modelValue:f.value,"onUpdate:modelValue":I[10]||(I[10]=Y=>f.value=Y),tools:r(z).availableTools,"selected-tool-ids":j.value>=0?((J=r(l).steps[j.value])==null?void 0:J.selectedToolKeys)||[]:[],onConfirm:A},null,8,["modelValue","tools","selected-tool-ids"])])}}}),Tr=me(kr,[["__scopeId","data-v-575f3fe3"]]);class es{static async uploadFiles(e){try{console.log("[FileUploadApiService] Uploading files:",e.length);const s=new FormData;e.forEach(l=>{s.append("files",l)});const t=await fetch("/api/file-upload/upload",{method:"POST",body:s});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();return console.log("[FileUploadApiService] Files uploaded successfully:",a.successfulFiles,"uploadKey:",a.uploadKey),a}catch(s){throw console.error("[FileUploadApiService] Error uploading files:",s),s}}static async getUploadedFiles(e){try{console.log("[FileUploadApiService] Getting uploaded files for uploadKey:",e);const s=await fetch(`/api/file-upload/files/${encodeURIComponent(e)}`);if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const t=await s.json();return console.log("[FileUploadApiService] Got uploaded files:",t.totalCount,"for uploadKey:",e),t}catch(s){throw console.error("[FileUploadApiService] Error getting uploaded files:",s),s}}static async deleteFile(e,s){try{console.log("[FileUploadApiService] Deleting file:",s,"from uploadKey:",e);const t=await fetch(`/api/file-upload/files/${encodeURIComponent(e)}/${encodeURIComponent(s)}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();return console.log("[FileUploadApiService] File deleted successfully:",a.success),a}catch(t){throw console.error("[FileUploadApiService] Error deleting file:",t),t}}static async getUploadConfig(){try{console.log("[FileUploadApiService] Getting upload configuration");const e=await fetch("/api/file-upload/config");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();return console.log("[FileUploadApiService] Got upload configuration:",s),s}catch(e){throw console.error("[FileUploadApiService] Error getting upload configuration:",e),e}}}const Er={class:"file-upload-component"},Pr=["accept"],Cr={key:0},Rr={key:1},Ir={key:0,class:"files-list"},Ar={class:"file-name"},xr={class:"file-size"},Dr=["onClick","title"],Fr={key:0,class:"upload-progress"},Mr=he({__name:"FileUploadComponent",props:{acceptedFileTypes:{default:".pdf,.txt,.md,.doc,.docx,.csv,.xlsx,.xls,.json,.xml,.html,.htm,.log,.java,.py,.js,.ts,.sql,.sh,.bat,.yaml,.yml,.properties,.conf,.ini,.jpg,.jpeg,.png,.gif"},disabled:{type:Boolean,default:!1}},emits:["files-uploaded","files-removed","upload-key-changed","upload-started","upload-completed","upload-error"],setup(n,{expose:e,emit:s}){const{t}=Ee(),a=n,l=s,i=F(),p=F([]),b=F(!1),d=F(null),h=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),p.value=[],d.value=null,l("upload-key-changed",null)};Se(()=>{h()}),fe(()=>p.value,m=>{l("files-removed",m)},{deep:!0});const k=()=>{a.disabled||i.value&&i.value.click()},C=async m=>{const g=m.target,w=g.files;if(!w||w.length===0)return;const $=Array.from(w);console.log("[FileUpload] Selected files for upload:",$.map(P=>P.name)),await U($),g&&(g.value="")},U=async m=>{if(m.length!==0){b.value=!0,l("upload-started");try{const g=await es.uploadFiles(m);g.success&&g.uploadedFiles&&(!d.value&&g.uploadKey?(d.value=g.uploadKey,console.log("[FileUpload] Set uploadKey:",d.value),p.value=g.uploadedFiles):d.value?(console.log("[FileUpload] Using existing uploadKey:",d.value),p.value=[...p.value,...g.uploadedFiles]):(console.warn("[FileUpload] No uploadKey returned from upload"),p.value=g.uploadedFiles),g.uploadKey&&(d.value=g.uploadKey,console.log("[Input] Saved uploadKey locally:",g.uploadKey),l("upload-key-changed",d.value)),console.log("[Input] Updated global uploadedFiles state:",p.value),l("files-uploaded",p.value,d.value)),console.log("Files uploaded successfully:",g),l("upload-completed")}catch(g){console.error("File upload error:",g),l("upload-error",g)}finally{b.value=!1}}},_=async m=>{try{if(console.log("🗑️ Removing file:",m.originalName,"from uploadKey:",d),d.value){const g=await es.deleteFile(d.value,m.originalName);g.success?console.log("✅ File deleted from server successfully"):console.error("❌ Failed to delete file from server:",g.error)}p.value=p.value.filter(g=>g.originalName!==m.originalName),p.value.length===0&&(console.log("[FileUpload] 🧹 Clearing uploadKey to force new plan for new files"),d.value=null,l("upload-key-changed",null)),console.log("🎉 File removal completed, remaining files:",p.value.length)}catch(g){console.error("❌ Error removing file:",g),l("upload-error",g)}},y=m=>{if(m===0)return"0 Bytes";const g=1024,w=["Bytes","KB","MB","GB"],$=Math.floor(Math.log(m)/Math.log(g));return parseFloat((m/Math.pow(g,$)).toFixed(2))+" "+w[$]};return e({uploadedFiles:p,uploadKey:d,resetSession:h,uploadFiles:U,removeFile:_,isUploading:b}),(m,g)=>(u(),v("div",Er,[o("input",{ref_key:"fileInputRef",ref:i,type:"file",multiple:"",style:{display:"none"},onChange:C,accept:m.acceptedFileTypes||""},null,40,Pr),o("div",{class:ae(["uploaded-files",{"has-files":p.value.length>0}])},[o("div",{class:"files-header",onClick:k},[S(r(E),{icon:"carbon:attachment"}),p.value.length===0?(u(),v("span",Cr,c(r(t)("input.attachFile")),1)):(u(),v("span",Rr,c(r(t)("input.attachedFiles"))+" ("+c(p.value.length)+")",1))]),p.value.length>0?(u(),v("div",Ir,[(u(!0),v(re,null,ie(p.value,w=>(u(),v("div",{key:w.originalName,class:"file-item"},[S(r(E),{icon:"carbon:document",class:"file-icon"}),o("span",Ar,c(w.originalName),1),o("span",xr,"("+c(y(w.size))+")",1),o("button",{onClick:$=>_(w),class:"remove-btn",title:r(t)("input.removeFile")},[S(r(E),{icon:"carbon:close"})],8,Dr)]))),128))])):B("",!0)],2),b.value?(u(),v("div",Fr,[S(r(E),{icon:"carbon:rotate--clockwise",class:"loading-icon"}),o("span",null,c(r(t)("input.uploading")),1)])):B("",!0)]))}}),Ds=me(Mr,[["__scopeId","data-v-6688da5c"]]),Ur={class:"config-section"},Nr={class:"section-header"},Or={class:"execution-content"},Lr={class:"params-requirements-group"},Br={class:"params-help-text"},qr={key:0,class:"parameter-fields"},jr={class:"parameter-label"},Vr=["onUpdate:modelValue","placeholder","onInput"],Hr={key:0,class:"parameter-error"},Wr={key:1,class:"validation-message"},zr=["disabled"],Jr=["disabled"],Gr={key:1,class:"call-example-wrapper"},Kr={class:"call-example-header"},Xr={class:"call-example-title"},Yr={class:"call-example-description"},Qr={class:"internal-call-wrapper"},Zr={class:"call-info"},ei={class:"call-method"},ti={class:"call-endpoint"},si={key:0,class:"call-endpoint"},oi={class:"call-description"},ni={class:"call-example"},ai={class:"example-code"},li={key:2,class:"call-example-wrapper"},ri={class:"call-example-header"},ii={class:"call-example-title"},ci={class:"call-example-description"},di={class:"http-api-urls-wrapper"},ui={class:"tab-container"},pi={class:"tab-header"},hi=["onClick"],mi={class:"tab-content"},fi={class:"http-api-url-display"},vi={class:"api-method"},gi={class:"api-endpoint"},bi={class:"api-description"},yi={key:0,class:"api-example"},_i={class:"example-code"},$i={key:3,class:"call-example-wrapper"},wi={class:"call-example-header"},Si={class:"call-example-title"},ki={class:"call-example-description"},Ti={class:"mcp-call-wrapper"},Ei={class:"call-info"},Pi={class:"call-method"},Ci={class:"call-endpoint"},Ri={class:"call-description"},Ii={class:"call-example"},Ai={class:"example-code"},xi=he({__name:"ExecutionController",props:{currentPlanTemplateId:{default:""},isExecuting:{type:Boolean,default:!1},isGenerating:{type:Boolean,default:!1},showPublishButton:{type:Boolean,default:!0},toolInfo:{default:()=>({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""})}},emits:["executePlan","publishMcpService","clearParams","updateExecutionParams"],setup(n,{expose:e,emit:s}){const{t}=Ee(),a=n,l=s,i=F(""),p=F({parameters:[],hasParameters:!1,requirements:""}),b=F({}),d=F(!1),h=F("get-sync"),k=F({}),C=F(!1),U=F(!1),_=F(),y=F([]),m=F(null),g=F([{id:"get-sync",label:"GET + Sync",method:"GET",endpoint:"/api/executor/executeByToolNameSync/{toolName}",description:"Synchronous GET request - returns execution result immediately",example:`GET /api/executor/executeByToolNameSync/my-tool?allParams={"rawParam":"test"}
Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-sync",label:"POST + Sync",method:"POST",endpoint:"/api/executor/executeByToolNameSync",description:"Synchronous POST request - returns execution result immediately",example:`POST /api/executor/executeByToolNameSync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-async",label:"POST + Async",method:"POST",endpoint:"/api/executor/executeByToolNameAsync",description:"Asynchronous POST request - returns task ID, check status separately",example:`POST /api/executor/executeByToolNameAsync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "planId": "plan-123",
  "status": "processing",
  "message": "Task submitted, processing",
  "memoryId": "ABC12345",
  "toolName": "my-tool",
  "planTemplateId": "template-456"
}

# Check execution status and get detailed results:
GET /api/executor/details/{planId}
Response: {
  "currentPlanId": "plan-123",
  "title": "Plan Title",
  "status": "completed",
  "summary": "Execution completed successfully",
  "agentExecutionSequence": [...],
  "userInputWaitState": null
}`}]),w=pe(()=>{var D,Q,L;return((D=a.toolInfo)==null?void 0:D.enableInternalToolcall)||((Q=a.toolInfo)==null?void 0:Q.enableHttpService)||((L=a.toolInfo)==null?void 0:L.enableMcpService)}),$=pe(()=>w.value?t("sidebar.updateServiceStatus"):t("sidebar.publishMcpService")),P=pe(()=>a.isExecuting||a.isGenerating?!1:p.value.hasParameters?p.value.parameters.every(D=>{var Q;return(Q=b.value[D])==null?void 0:Q.trim()}):!0),f=(D,Q)=>{y.value=D.map(L=>L.originalName),m.value=Q,console.log("[ExecutionController] Files uploaded:",D.length,"uploadKey:",Q)},j=D=>{y.value=D.map(Q=>Q.originalName),console.log("[ExecutionController] Files removed, remaining:",D.length)},x=D=>{m.value=D,console.log("[ExecutionController] Upload key changed:",D)},se=()=>{console.log("[ExecutionController] Upload started")},A=()=>{console.log("[ExecutionController] Upload completed")},N=D=>{console.error("[ExecutionController] Upload error:",D)},W=()=>{if(console.log("[ExecutionController] 🚀 Execute button clicked"),U.value=!0,console.log("[ExecutionController] 🔒 Set isExecutingPlan to true"),!Y()){console.log("[ExecutionController] ❌ Parameter validation failed:",k.value),U.value=!1;return}const D=p.value.hasParameters&&Object.keys(b.value).length>0?b.value:void 0;console.log("[ExecutionController] 🔄 Replacement params:",D);const Q={title:"",planData:{title:"",steps:[],directResponse:!1},params:void 0,replacementParams:D,uploadedFiles:y.value,uploadKey:m.value};console.log("[ExecutionController] 📤 Emitting executePlan with payload:",JSON.stringify(Q,null,2)),l("executePlan",Q)},Z=()=>{l("publishMcpService")},T=()=>{console.log("[ExecutionController] 🧹 clearExecutionParams called"),i.value="",b.value={},U.value=!1,console.log("[ExecutionController] 🔓 Reset isExecutingPlan to false"),console.log("[ExecutionController] ✅ After clear - parameterValues cleared"),l("clearParams")},I=async()=>{if(console.log("[ExecutionController] 🔄 loadParameterRequirements called for templateId:",a.currentPlanTemplateId),console.log("[ExecutionController] 📊 Current parameterRequirements before load:",JSON.stringify(p.value,null,2)),!a.currentPlanTemplateId){console.log("[ExecutionController] ❌ No template ID, resetting parameters"),p.value={parameters:[],hasParameters:!1,requirements:""},b.value={};return}d.value=!0;try{console.log("[ExecutionController] 🌐 Fetching parameter requirements from API...");const D=await Dt.getParameterRequirements(a.currentPlanTemplateId);console.log("[ExecutionController] 📥 Received requirements from API:",JSON.stringify(D,null,2)),p.value=D;const Q={};D.parameters.forEach(L=>{Q[L]=b.value[L]||""}),b.value=Q,console.log("[ExecutionController] ✅ Updated parameterRequirements:",JSON.stringify(p.value,null,2)),console.log("[ExecutionController] ✅ Updated parameterValues:",JSON.stringify(b.value,null,2)),M()}catch(D){console.error("[ExecutionController] ❌ Failed to load parameter requirements:",D),D instanceof Error&&!D.message.includes("404")&&console.warn("[ExecutionController] ⚠️ Parameter requirements not available yet, will retry later"),p.value={parameters:[],hasParameters:!1,requirements:""},console.log("[ExecutionController] 🔄 Reset parameterRequirements due to error:",JSON.stringify(p.value,null,2))}finally{d.value=!1,console.log("[ExecutionController] ✅ loadParameterRequirements completed")}},J=(D,Q)=>{b.value[D]=Q,k.value[D]&&delete k.value[D],M()},Y=()=>{if(k.value={},C.value=!1,!p.value.hasParameters)return!0;let D=!1;return p.value.parameters.forEach(Q=>{var O;((O=b.value[Q])==null?void 0:O.trim())||(k.value[Q]=`${Q} is required`,D=!0)}),C.value=D,!D},M=()=>{p.value.hasParameters?i.value=JSON.stringify(b.value,null,2):i.value="",l("updateExecutionParams",i.value)};return fe(()=>a.currentPlanTemplateId,(D,Q)=>{if(D&&D!==Q){if(U.value){console.log("[ExecutionController] ⏸️ Skipping parameter reload - plan is executing");return}console.log("[ExecutionController] 🔄 Template ID changed, will reload parameters"),Q&&D.startsWith("planTemplate-")?(console.log("[ExecutionController] ⏰ New template detected, retrying with delay..."),setTimeout(()=>{console.log("[ExecutionController] ⏰ Delay timeout, calling loadParameterRequirements"),I()},1e3)):(console.log("[ExecutionController] 🚀 Immediate reload of parameters"),I())}}),fe(()=>i.value,D=>{l("updateExecutionParams",D)}),ke(()=>{I()}),e({executionParams:i,clearExecutionParams:T,loadParameterRequirements:I,fileUploadRef:_,uploadedFiles:y,uploadKey:m}),(D,Q)=>{var L,O,ee,q,V;return u(),v("div",Ur,[o("div",Nr,[S(r(E),{icon:"carbon:play",width:"16"}),o("span",null,c(r(t)("sidebar.executionController")),1)]),o("div",Or,[o("div",Lr,[o("label",null,c(r(t)("sidebar.parameterRequirements")),1),o("div",Br,c(r(t)("sidebar.parameterRequirementsHelp")),1),p.value.hasParameters?(u(),v("div",qr,[(u(!0),v(re,null,ie(p.value.parameters,G=>(u(),v("div",{key:G,class:"parameter-field"},[o("label",jr,[ne(c(G)+" ",1),Q[0]||(Q[0]=o("span",{class:"required"},"*",-1))]),oe(o("input",{"onUpdate:modelValue":de=>b.value[G]=de,class:ae(["parameter-input",{error:k.value[G]}]),placeholder:r(t)("sidebar.enterValueFor",{param:G}),onInput:de=>J(G,de.target.value),required:""},null,42,Vr),[[ce,b.value[G]]]),k.value[G]?(u(),v("div",Hr,c(k.value[G]),1)):B("",!0)]))),128))])):B("",!0),p.value.hasParameters&&!P.value&&!a.isExecuting&&!a.isGenerating?(u(),v("div",Wr,[S(r(E),{icon:"carbon:warning",width:"14"}),ne(" "+c(r(t)("sidebar.fillAllRequiredParameters")),1)])):B("",!0)]),S(Ds,{ref_key:"fileUploadRef",ref:_,disabled:a.isExecuting||a.isGenerating,onFilesUploaded:f,onFilesRemoved:j,onUploadKeyChanged:x,onUploadStarted:se,onUploadCompleted:A,onUploadError:N},null,8,["disabled"]),o("button",{class:"btn btn-primary execute-btn",onClick:W,disabled:!P.value},[S(r(E),{icon:a.isExecuting?"carbon:circle-dash":"carbon:play",width:"16",class:ae({spinning:a.isExecuting})},null,8,["icon","class"]),ne(" "+c(a.isExecuting?r(t)("sidebar.executing"):r(t)("sidebar.executePlan")),1)],8,zr),D.showPublishButton?(u(),v("button",{key:0,class:"btn publish-mcp-btn",onClick:Z,disabled:!D.currentPlanTemplateId},[S(r(E),{icon:"carbon:application",width:"16"}),ne(" "+c($.value),1)],8,Jr)):B("",!0),(L=D.toolInfo)!=null&&L.enableInternalToolcall?(u(),v("div",Gr,[o("div",Kr,[o("h4",Xr,c(r(t)("sidebar.internalCall")),1),o("p",Yr,c(r(t)("sidebar.internalCallDescription")),1)]),o("div",Qr,[o("div",Zr,[o("div",ei,c(r(t)("sidebar.internalMethodCall")),1),o("div",ti,c(r(t)("sidebar.toolName"))+": "+c(((O=D.toolInfo)==null?void 0:O.toolName)||D.currentPlanTemplateId),1),(ee=D.toolInfo)!=null&&ee.serviceGroup?(u(),v("div",si,c(r(t)("sidebar.serviceGroup"))+": "+c(D.toolInfo.serviceGroup),1)):B("",!0),o("div",oi,c(r(t)("sidebar.internalCallUsage")),1),o("div",ni,[o("strong",null,c(r(t)("sidebar.usage"))+":",1),o("pre",ai,c(r(t)("sidebar.internalCallExample")),1)])])])])):B("",!0),(q=D.toolInfo)!=null&&q.enableHttpService?(u(),v("div",li,[o("div",ri,[o("h4",ii,c(r(t)("sidebar.httpCallExample")),1),o("p",ci,c(r(t)("sidebar.httpCallDescription")),1)]),o("div",di,[o("div",ui,[o("div",pi,[(u(!0),v(re,null,ie(g.value,G=>(u(),v("button",{key:G.id,class:ae(["tab-button",{active:h.value===G.id}]),onClick:de=>h.value=G.id},c(G.label),11,hi))),128))]),o("div",mi,[(u(!0),v(re,null,ie(g.value,G=>oe((u(),v("div",{key:G.id,class:"tab-panel"},[o("div",fi,[o("div",vi,c(G.method),1),o("div",gi,c(G.endpoint),1),o("div",bi,c(G.description),1),G.example?(u(),v("div",yi,[o("strong",null,c(r(t)("sidebar.example"))+":",1),o("pre",_i,c(G.example),1)])):B("",!0)])])),[[ts,h.value===G.id]])),128))])])])])):B("",!0),(V=D.toolInfo)!=null&&V.enableMcpService?(u(),v("div",$i,[o("div",wi,[o("h4",Si,c(r(t)("sidebar.mcpCall")),1),o("p",ki,c(r(t)("sidebar.mcpCallDescription")),1)]),o("div",Ti,[o("div",Ei,[o("div",Pi,c(r(t)("sidebar.mcpServiceCall")),1),o("div",Ci,c(r(t)("sidebar.mcpEndpoint"))+": /mcp/execute",1),o("div",Ri,c(r(t)("sidebar.mcpCallUsage")),1),o("div",Ii,[o("strong",null,c(r(t)("sidebar.usage"))+":",1),o("pre",Ai,c(r(t)("sidebar.mcpCallExample")),1)])])])])):B("",!0)])])}}}),Di=me(xi,[["__scopeId","data-v-29b1330b"]]),Fi={class:"sidebar-content"},Mi={class:"sidebar-content-header"},Ui={class:"sidebar-content-title"},Ni={class:"tab-switcher"},Oi=["disabled"],Li={key:0,class:"tab-content"},Bi={class:"new-task-section"},qi={class:"sidebar-content-list"},ji={key:0,class:"loading-state"},Vi={key:1,class:"error-state"},Hi={key:2,class:"empty-state"},Wi=["onClick"],zi={class:"task-icon"},Ji={class:"task-details"},Gi={class:"task-title"},Ki={class:"task-preview"},Xi={class:"task-time"},Yi={class:"task-actions"},Qi=["title","onClick"],Zi={key:1,class:"tab-content config-tab"},ec={key:0,class:"config-container"},tc={class:"template-info-header"},sc={class:"template-info"},oc={class:"template-id"},nc=["title"],ac=he({__name:"Sidebar",emits:["planExecutionRequested"],setup(n,{expose:e,emit:s}){const{t}=Ee(),a=ls(),l=F(80),i=F(!1),p=F(0),b=F(0),d=F(null),h=F({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}),k=F(null),C=F({enabled:!0,success:!0}),U=pe(()=>C.value.enabled),_=async()=>{try{const M=await Fe.getCoordinatorToolConfig();C.value=M}catch(M){console.error("Failed to load CoordinatorTool configuration:",M),C.value={enabled:!0,success:!1,message:M instanceof Error?M.message:"Unknown error"}}},y=s,m=async()=>{try{const M=await z.saveTemplate();M!=null&&M.duplicate?a.success(t("sidebar.saveCompleted",{message:M.message,versionCount:M.versionCount})):M!=null&&M.saved?(a.success(t("sidebar.saveSuccess",{message:M.message,versionCount:M.versionCount})),g()):M!=null&&M.message&&a.success(t("sidebar.saveStatus",{message:M.message}))}catch(M){console.error("Failed to save plan modifications:",M),a.error(M.message||t("sidebar.saveFailed"))}},g=async()=>{await new Promise(M=>setTimeout(M,500)),d.value&&d.value.loadParameterRequirements(),k.value&&k.value.loadParameterRequirements()},w=()=>{try{z&&typeof z.rollbackVersion=="function"?z.rollbackVersion():console.warn("sidebarStore or rollbackVersion method is not available")}catch(M){console.error("Error during rollback operation:",M),a.error(t("sidebar.rollbackFailed")||"Rollback failed")}},$=()=>{try{z&&typeof z.restoreVersion=="function"?z.restoreVersion():console.warn("sidebarStore or restoreVersion method is not available")}catch(M){console.error("Error during restore operation:",M),a.error(t("sidebar.restoreFailed")||"Restore failed")}},P=async M=>{var D,Q;console.log("[Sidebar] 🎯 handleExecutePlan called with payload:",JSON.stringify(M,null,2)),console.log("[Sidebar] 📊 Current sidebarStore state:",{currentPlanTemplateId:z.currentPlanTemplateId,selectedTemplate:(D=z.selectedTemplate)==null?void 0:D.id,jsonContent:((Q=z.jsonContent)==null?void 0:Q.substring(0,100))+"..."});try{const L=z.preparePlanExecution();if(console.log("[Sidebar] 📋 Prepared plan data:",JSON.stringify(L,null,2)),!L){console.log("[Sidebar] ❌ No plan data available, returning");return}const O={...L,uploadedFiles:M.uploadedFiles,uploadKey:M.uploadKey};M.replacementParams&&Object.keys(M.replacementParams).length>0&&(console.log("[Sidebar] 🔄 Processing replacement parameters:",M.replacementParams),O.replacementParams=M.replacementParams),console.log("[Sidebar] ✅ Final plan data:",JSON.stringify(O,null,2));const ee={...M,title:O.title,planData:O.planData,params:O.params,uploadedFiles:O.uploadedFiles,uploadKey:O.uploadKey};console.log("[Sidebar] 📤 Emitting planExecutionRequested with final payload:",JSON.stringify(ee,null,2)),y("planExecutionRequested",ee),console.log("[Sidebar] ✅ Event emitted successfully")}catch(L){console.error("[Sidebar] ❌ Error executing plan:",L),a.error(t("sidebar.executeFailed")+": "+L.message)}finally{console.log("[Sidebar] 🧹 Cleaning up after execution"),z.finishPlanExecution(),z.clearExecutionParams(),d.value&&(console.log("[Sidebar] 🧹 Calling ExecutionController.clearExecutionParams"),d.value.clearExecutionParams()),console.log("[Sidebar] ✅ Cleanup completed")}},f=F(!1),j=()=>{if(console.log("[Sidebar] Publish MCP service button clicked"),console.log("[Sidebar] currentPlanTemplateId:",z.currentPlanTemplateId),!z.currentPlanTemplateId){console.log("[Sidebar] No plan template selected, showing warning"),a.error(t("mcpService.selectPlanTemplateFirst"));return}console.log("[Sidebar] Opening publish MCP service modal"),f.value=!0},x=M=>{M===null?(console.log("MCP service deleted successfully"),a.success(t("mcpService.deleteSuccess")),h.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}):(console.log("MCP service published successfully:",M),a.success(t("mcpService.publishSuccess")),h.value={...M,toolName:M.toolName||"",serviceGroup:M.serviceGroup||""})},se=()=>{z.clearExecutionParams()},A=M=>{z.executionParams=M},N=async M=>{if(!M){h.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""};return}try{const D=await Fe.getCoordinatorToolsByTemplate(M);D?h.value={...D,toolName:D.toolName||"",serviceGroup:D.serviceGroup||""}:h.value={toolName:"",toolDescription:"",planTemplateId:M,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}catch(D){console.error("Failed to load tool information:",D),h.value={toolName:"",toolDescription:"",planTemplateId:M,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}},W=M=>{if(isNaN(M.getTime()))return console.warn("Invalid date received:",M),t("time.unknown");const Q=new Date().getTime()-M.getTime(),L=Math.floor(Q/6e4),O=Math.floor(Q/36e5),ee=Math.floor(Q/864e5);return L<1?t("time.now"):L<60?t("time.minuteAgo",{count:L}):O<24?t("time.hourAgo",{count:O}):ee<30?t("time.dayAgo",{count:ee}):M.toLocaleDateString("zh-CN")},Z=(M,D)=>!M||M.length<=D?M:M.substring(0,D)+"...",T=M=>{i.value=!0,p.value=M.clientX,b.value=l.value,document.addEventListener("mousemove",I),document.addEventListener("mouseup",J),document.body.style.cursor="col-resize",document.body.style.userSelect="none",M.preventDefault()},I=M=>{if(!i.value)return;const D=window.innerWidth,L=(M.clientX-p.value)/D*100;let O=b.value+L;O=Math.max(15,Math.min(100,O)),l.value=O},J=()=>{i.value=!1,document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",J),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("sidebarWidth",l.value.toString())},Y=()=>{l.value=80,localStorage.setItem("sidebarWidth","80")};return fe(()=>z.currentPlanTemplateId,M=>{N(M)},{immediate:!0}),ke(()=>{z.loadPlanTemplateList(),_(),z.loadAvailableTools();const M=localStorage.getItem("sidebarWidth");M&&(l.value=parseFloat(M))}),Se(()=>{document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",J)}),e({loadPlanTemplateList:z.loadPlanTemplateList,toggleSidebar:z.toggleSidebar,currentPlanTemplateId:z.currentPlanTemplateId}),(M,D)=>{var Q,L;return u(),v(re,null,[o("div",{class:ae(["sidebar-wrapper",{"sidebar-wrapper-collapsed":r(z).isCollapsed}]),style:We({width:l.value+"%"})},[o("div",Fi,[o("div",Mi,[o("div",Ui,c(M.$t("sidebar.title")),1)]),o("div",Ni,[o("button",{class:ae(["tab-button",{active:r(z).currentTab==="list"}]),onClick:D[0]||(D[0]=O=>r(z).switchToTab("list"))},[S(r(E),{icon:"carbon:list",width:"16"}),ne(" "+c(M.$t("sidebar.templateList")),1)],2),o("button",{class:ae(["tab-button",{active:r(z).currentTab==="config"}]),onClick:D[1]||(D[1]=O=>r(z).switchToTab("config")),disabled:!r(z).selectedTemplate},[S(r(E),{icon:"carbon:settings",width:"16"}),ne(" "+c(M.$t("sidebar.configuration")),1)],10,Oi)]),r(z).currentTab==="list"?(u(),v("div",Li,[o("div",Bi,[o("button",{class:"new-task-btn",onClick:D[2]||(D[2]=O=>r(z).createNewTemplate(r(z).planType))},[S(r(E),{icon:"carbon:add",width:"16"}),ne(" "+c(M.$t("sidebar.newPlan"))+" ",1),D[8]||(D[8]=o("span",{class:"shortcut"},"⌘ K",-1))])]),o("div",qi,[r(z).isLoading?(u(),v("div",ji,[S(r(E),{icon:"carbon:circle-dash",width:"20",class:"spinning"}),o("span",null,c(M.$t("sidebar.loading")),1)])):r(z).errorMessage?(u(),v("div",Vi,[S(r(E),{icon:"carbon:warning",width:"20"}),o("span",null,c(r(z).errorMessage),1),o("button",{onClick:D[3]||(D[3]=(...O)=>r(z).loadPlanTemplateList&&r(z).loadPlanTemplateList(...O)),class:"retry-btn"},c(M.$t("sidebar.retry")),1)])):r(z).planTemplateList.length===0?(u(),v("div",Hi,[S(r(E),{icon:"carbon:document",width:"32"}),o("span",null,c(M.$t("sidebar.noTemplates")),1)])):(u(!0),v(re,{key:3},ie(r(z).sortedTemplates,O=>(u(),v("div",{key:O.id,class:ae(["sidebar-content-list-item",{"sidebar-content-list-item-active":O.id===r(z).currentPlanTemplateId}]),onClick:ee=>r(z).selectTemplate(O)},[o("div",zi,[S(r(E),{icon:"carbon:document",width:"20"})]),o("div",Ji,[o("div",Gi,c(O.title||M.$t("sidebar.unnamedPlan")),1),o("div",Ki,c(Z(O.description||M.$t("sidebar.noDescription"),40)),1)]),o("div",Xi,c(W(r(z).parseDateTime(O.updateTime||O.createTime))),1),o("div",Yi,[o("button",{class:"delete-task-btn",title:M.$t("sidebar.deleteTemplate"),onClick:ve(ee=>r(z).deleteTemplate(O),["stop"])},[S(r(E),{icon:"carbon:close",width:"16"})],8,Qi)])],10,Wi))),128))])])):r(z).currentTab==="config"?(u(),v("div",Zi,[r(z).selectedTemplate?(u(),v("div",ec,[o("div",tc,[o("div",sc,[o("h3",null,c(r(z).selectedTemplate.title||M.$t("sidebar.unnamedPlan")),1),o("span",oc,"ID: "+c(r(z).selectedTemplate.id),1)]),o("button",{class:"back-to-list-btn",onClick:D[4]||(D[4]=O=>r(z).switchToTab("list"))},[S(r(E),{icon:"carbon:arrow-left",width:"16"})])]),r(z).planType==="dynamic_agent"?(u(),le(Tr,{key:0,"json-content":r(z).jsonContent,"can-rollback":r(z).canRollback,"can-restore":r(z).canRestore,"is-generating":r(z).isGenerating,"is-executing":r(z).isExecuting,"current-plan-template-id":r(z).currentPlanTemplateId||"",onRollback:w,onRestore:$,onSave:m,"onUpdate:jsonContent":D[5]||(D[5]=O=>r(z).jsonContent=O)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])):(u(),le(Vn,{key:1,"json-content":r(z).jsonContent,"can-rollback":r(z).canRollback,"can-restore":r(z).canRestore,"is-generating":r(z).isGenerating,"is-executing":r(z).isExecuting,"current-plan-template-id":r(z).currentPlanTemplateId||"",onRollback:w,onRestore:$,onSave:m,"onUpdate:jsonContent":D[6]||(D[6]=O=>r(z).jsonContent=O)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])),S(Di,{ref_key:"executionControllerRef",ref:d,"current-plan-template-id":r(z).currentPlanTemplateId||"","is-executing":r(z).isExecuting,"is-generating":r(z).isGenerating,"show-publish-button":U.value,"tool-info":h.value,onExecutePlan:P,onPublishMcpService:j,onClearParams:se,onUpdateExecutionParams:A},null,8,["current-plan-template-id","is-executing","is-generating","show-publish-button","tool-info"])])):B("",!0)])):B("",!0)]),o("div",{class:"sidebar-resizer",onMousedown:T,onDblclick:Y,title:M.$t("sidebar.resizeHint")},D[9]||(D[9]=[o("div",{class:"resizer-line"},null,-1)]),40,nc)],6),S(Yo,{ref_key:"publishMcpModalRef",ref:k,modelValue:f.value,"onUpdate:modelValue":D[7]||(D[7]=O=>f.value=O),"plan-template-id":r(z).currentPlanTemplateId||"","plan-title":((Q=r(z).selectedTemplate)==null?void 0:Q.title)||"","plan-description":((L=r(z).selectedTemplate)==null?void 0:L.description)||"",onPublished:x},null,8,["modelValue","plan-template-id","plan-title","plan-description"])],64)}}}),lc=me(ac,[["__scopeId","data-v-c17b83e1"]]);class ct{static async handleResponse(e){if(!e.ok)try{const s=await e.json();throw new Error(s.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getMemories(){try{const e=await fetch(`${this.BASE_URL}`);return(await(await this.handleResponse(e)).json()).memories||[]}catch(e){throw console.error("Failed to get memory list:",e),e}}static async getMemory(e){try{const s=await fetch(`${this.BASE_URL}/single?conversationId=${e}`),a=await(await this.handleResponse(s)).json();if(!a.data)throw new Error("Memory not found");return a.data}catch(s){throw console.error("Failed to get memory:",s),s}}static async createMemory(e,s){try{const t=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,memory_name:s})}),l=await(await this.handleResponse(t)).json();if(!l.data)throw new Error("Failed to create memory");return l.data}catch(t){throw console.error("Failed to create memory:",t),t}}static async updateMemory(e,s){try{const t=await fetch(`${this.BASE_URL}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,memory_name:s})}),l=await(await this.handleResponse(t)).json();if(!l.data)throw new Error("Failed to update memory");return l.data}catch(t){throw console.error("Failed to update memory:",t),t}}static async deleteMemory(e){try{const s=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE"});await this.handleResponse(s)}catch(s){throw console.error("Failed to delete memory:",s),s}}static async generateConversationId(){try{const e=await fetch(`${this.BASE_URL}/generate-id`),t=await(await this.handleResponse(e)).json();if(!t.data)throw new Error("Failed to generate conversation ID");return t.data}catch(e){throw console.error("Failed to generate conversation ID:",e),e}}}be(ct,"BASE_URL","/api/memories");class rc{constructor(){be(this,"isCollapsed",!1);be(this,"selectMemoryId","");be(this,"loadMessages",()=>{});be(this,"intervalId")}toggleSidebar(){this.isCollapsed=!this.isCollapsed,this.isCollapsed?(this.loadMessages(),this.intervalId=window.setInterval(()=>{this.loadMessages()},3e3)):clearInterval(this.intervalId)}selectMemory(e){this.toggleSidebar(),this.selectMemoryId=e}setMemory(e){this.selectMemoryId=e}defaultMemoryId(){this.selectMemoryId=this.generateRandomId()}clearMemoryId(){this.selectMemoryId=""}generateRandomId(){return Math.random().toString(36).substring(2,10)}setLoadMessages(e){this.loadMessages=e}}const Ue=tt(new rc),ic={key:0,class:"app-container"},cc={class:"app-content"},dc={class:"header"},uc={class:"relative"},pc={class:"title-edit-group"},hc={id:"main-title",class:"main-title"},mc={key:0,id:"title-edit-container",class:"title-edit-container"},fc={class:"search-bar"},vc={class:"search-container"},gc=["placeholder"],bc={class:"message-list",id:"message-list"},yc={class:"message-header"},_c={class:"message-content"},$c={class:"sender-info"},wc=["onClick"],Sc={class:"sender-name"},kc=["onClick"],Tc={class:"action-buttons"},Ec=["onClick"],Pc={class:"action-buttons"},Cc=["onClick"],Rc={class:"message-preview"},Ic={class:"preview-line"},Ac={key:0,class:"preview-line",style:{opacity:"0.8"}},xc={class:"message-meta"},Dc={class:"message-id"},Fc={class:"meta-right"},Mc={key:0,class:"unread-count"},Uc={class:"message-time"},Nc=["id"],Oc={style:{display:"flex","flex-direction":"column",gap:"0.75rem"}},Lc={class:"bubble-avatar"},Bc={class:"bubble-content"},qc={class:"bubble-text"},jc={key:0,class:"empty-state"},Vc={class:"modal-content"},Hc={class:"modal-header"},Wc={class:"modal-title"},zc=["placeholder"],Jc={id:"name-char-count",class:"char-count",style:{"text-align":"right",display:"block","margin-top":"0.25rem"}},Gc={class:"modal-footer"},Kc={class:"modal-content"},Xc={class:"modal-header"},Yc={class:"modal-title"},Qc={class:"state-text",id:"delete-message"},Zc={class:"modal-footer"},ed=he({__name:"Memory",emits:["memory-selected"],setup(n,{emit:e}){const s=F(!1),t=F(""),a=F([]),l=F([]),i=F(!1),p=F(null),b=F(""),d=F(!1),h=F(null),k=new Map,C=e,U=A=>{A.key==="Escape"&&(d.value?x():i.value&&$())};ke(()=>{Ue.setLoadMessages(_),document.addEventListener("keydown",U)}),Se(()=>{document.removeEventListener("keydown",U)});const _=async()=>{try{const A=await ct.getMemories();a.value?a.value=A.map(N=>({...N,expanded:k.has(N.conversation_id)?k.get(N.conversation_id):!1})):a.value=A.map(N=>({...N,expanded:!1})),l.value=[...a.value],g()}catch(A){console.error("error:",A),a.value=[],l.value=[]}},y=A=>{Ue.selectMemory(A),C("memory-selected")},m=A=>{const N=typeof A=="string"?parseInt(A,10):A;return isNaN(N)||N<=0?"unknow time":new Date(N.toString().length===13?N:N*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(","," ")},g=()=>{const A=t.value.toLowerCase().trim();if(!A){l.value=[...a.value];return}l.value=a.value.filter(N=>{var I;const W=N.memory_name.toLowerCase().includes(A),Z=N.conversation_id.toLowerCase().includes(A),T=((I=N.messages)==null?void 0:I.some(J=>J.text.toLowerCase().includes(A)))||!1;return W||Z||T})},w=(A,N)=>{p.value=A,b.value=N,i.value=!0},$=()=>{i.value=!1,p.value=null},P=async()=>{if(!p.value)return;const A=b.value.trim()||"unknow name",N=a.value.findIndex(W=>W.conversation_id===p.value);if(N!==-1){const W=a.value[N];try{const Z=await ct.updateMemory(W.conversation_id,A);Z.messages||(Z.messages=[]),a.value[N]={...Z,expanded:W.expanded},g(),i.value=!1}catch(Z){console.error("error:",Z)}}},f=A=>{const N=a.value.find(W=>W.conversation_id===A);if(N){N.expanded=!N.expanded,k.set(A,N.expanded);const W=l.value.findIndex(Z=>Z.conversation_id===A);W!==-1&&(l.value[W]={...N})}},j=A=>{h.value=A,d.value=!0},x=()=>{d.value=!1,h.value=null},se=async()=>{if(h.value)try{await ct.deleteMemory(h.value),a.value=a.value.filter(A=>A.conversation_id!==h.value),g(),a.value.length===0&&Ue.clearMemoryId(),d.value=!1,h.value=null}catch(A){console.error("error:",A)}};return(A,N)=>(u(),le(Ye,{to:"body"},[S(Be,{name:"modal"},{default:Me(()=>[r(Ue).isCollapsed?(u(),v("div",ic,[o("div",cc,[o("div",dc,[o("div",uc,[o("div",pc,[o("h1",hc,[o("span",null,c(A.$t("memory.title")),1)])]),s.value?(u(),v("div",mc)):B("",!0)]),o("button",{class:"close-btn",onClick:N[0]||(N[0]=W=>r(Ue).toggleSidebar())},[S(r(E),{icon:"carbon:close"})])]),o("div",fc,[o("div",vc,[S(r(E),{class:"search-container-icon",icon:"carbon:search"}),oe(o("input",{type:"text",placeholder:A.$t("memory.searchPlaceholder"),class:"search-input","onUpdate:modelValue":N[1]||(N[1]=W=>t.value=W),onInput:g},null,40,gc),[[ce,t.value]])])]),o("div",bc,[o("div",null,[(u(!0),v(re,null,ie(l.value,W=>(u(),v("div",{class:ae(["message-item",{expanded:W.expanded}]),key:W.conversation_id},[o("div",yc,[o("div",_c,[o("div",$c,[o("div",{class:"sender-div",onClick:ve(Z=>y(W.conversation_id),["stop"])},[o("h3",Sc,c(W.memory_name),1)],8,wc),o("div",{class:"toggle-container",onClick:ve(Z=>w(W.conversation_id,W.memory_name),["stop"])},[S(r(E),{icon:"carbon:edit",class:"edit-btn"})],8,kc),o("div",Tc,[o("button",{class:"delete-btn",onClick:ve(Z=>f(W.conversation_id),["stop"])},[S(r(E),{id:"toggle-"+W.conversation_id,icon:"carbon:chevron-down",class:"down-btn"},null,8,["id"])],8,Ec)]),o("div",Pc,[o("button",{class:"delete-btn",onClick:ve(Z=>j(W.conversation_id),["stop"])},[S(r(E),{icon:"carbon:delete"})],8,Cc)])]),o("div",Rc,[o("p",Ic,c(W.messages&&W.messages.length>0?W.messages[0].text:"none message"),1),W.messages&&W.messages.length>1?(u(),v("p",Ac,c(W.messages[1].text),1)):B("",!0)]),o("div",xc,[o("span",Dc,"ID: "+c(W.conversation_id),1),o("div",Fc,[W.messages&&W.messages.length>0?(u(),v("span",Mc,c(W.messages.length)+" "+c(A.$t("memory.size")),1)):B("",!0),o("span",Uc,c(m(W.create_time)),1)])])])]),W.expanded?(u(),v("div",{key:0,id:"content-"+W.conversation_id,class:"expanded-content"},[o("div",Oc,[(u(!0),v(re,null,ie(W.messages,(Z,T)=>(u(),v("div",{class:"message-bubble",key:T},[o("div",Lc,c(Z.messageType),1),o("div",Bc,[o("p",qc,c(Z.text),1)])]))),128))])],8,Nc)):B("",!0)],2))),128))]),l.value.length===0&&t.value?(u(),v("div",jc,N[3]||(N[3]=[o("p",{class:"state-text"},"none message",-1)]))):B("",!0)]),i.value?(u(),v("div",{key:0,id:"name-edit-modal",class:"modal-overlay",onClick:ve($,["self"])},[o("div",Vc,[o("div",Hc,[o("h3",Wc,c(A.$t("memory.changeName")),1),oe(o("input",{type:"text","onUpdate:modelValue":N[2]||(N[2]=W=>b.value=W),class:"edit-input",placeholder:A.$t("memory.newNamePlaceholder")},null,8,zc),[[ce,b.value]]),o("span",Jc,c(b.value.length),1)]),o("div",Gc,[o("button",{id:"cancel-name",class:"modal-btn cancel-btn",onClick:$},c(A.$t("memory.cancel")),1),o("button",{id:"save-name",class:"modal-btn confirm-btn",onClick:P},c(A.$t("memory.save")),1)])])])):B("",!0),d.value?(u(),v("div",{key:1,id:"delete-modal",class:"modal-overlay",onClick:ve(x,["self"])},[o("div",Kc,[o("div",Xc,[o("h3",Yc,c(A.$t("memory.deleteHint")),1),o("p",Qc,c(A.$t("memory.deleteHintPrefix"))+" "+c(h.value)+" "+c(A.$t("memory.deleteHintSuffix")),1)]),o("div",Zc,[o("button",{id:"cancel-delete",class:"modal-btn cancel-btn",onClick:x},c(A.$t("memory.cancel")),1),o("button",{id:"confirm-delete",class:"modal-btn delete-btn-confirm",onClick:se},c(A.$t("memory.delete")),1)])])])):B("",!0)])])):B("",!0)]),_:1})]))}}),td=me(ed,[["__scopeId","data-v-ca286acb"]]),sd="/api/executor";async function Fs(n){try{const e=await fetch(`${sd}/agent-execution/${n}`);if(!e.ok){if(e.status===404)return console.warn(`Agent execution detail not found for stepId: ${n}`),null;throw new Error(`HTTP error! status: ${e.status}`)}return await e.json()}catch(e){return console.error(`Error fetching agent execution detail for stepId: ${n}:`,e),null}}async function od(n){return console.log(`Refreshing agent execution detail for stepId: ${n}`),Fs(n)}class Ne{static async handleResponse(e){if(!e.ok)try{const s=await e.json();throw new Error(s.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getFileTree(e){try{const s=await fetch(`${this.BASE_URL}/tree/${e}`),a=await(await this.handleResponse(s)).json();if(!a.success)throw new Error(a.message||"Failed to get file tree");return a.data}catch(s){throw console.error("Failed to get file tree:",s),s}}static async getFileContent(e,s){try{const t=await fetch(`${this.BASE_URL}/content/${e}?path=${encodeURIComponent(s)}`),l=await(await this.handleResponse(t)).json();if(!l.success)throw new Error(l.message||"Failed to get file content");return l.data}catch(t){throw console.error("Failed to get file content:",t),t}}static async downloadFile(e,s,t){try{const a=await fetch(`${this.BASE_URL}/download/${e}?path=${encodeURIComponent(s)}`);await this.handleResponse(a);const l=await a.blob(),i=window.URL.createObjectURL(l),p=document.createElement("a");p.href=i,p.download=t||s.split("/").pop()||"download",document.body.appendChild(p),p.click(),window.URL.revokeObjectURL(i),document.body.removeChild(p)}catch(a){throw console.error("Failed to download file:",a),a}}static isTextFile(e,s){const t=["text/","application/json","application/xml","application/javascript","application/typescript"],a=[".txt",".md",".json",".xml",".html",".css",".js",".ts",".vue",".jsx",".tsx",".py",".java",".cpp",".c",".h",".sh",".bat",".yml",".yaml",".properties",".conf",".cfg"];if(t.some(i=>e.startsWith(i)))return!0;const l=s.toLowerCase();return a.some(i=>l.endsWith(i))}static getFileIcon(e){if(e.type==="directory")return"carbon:folder";const s=e.name.toLowerCase();return s.endsWith(".js")?"vscode-icons:file-type-js":s.endsWith(".ts")?"vscode-icons:file-type-typescript":s.endsWith(".vue")?"vscode-icons:file-type-vue":s.endsWith(".java")?"vscode-icons:file-type-java":s.endsWith(".py")?"vscode-icons:file-type-python":s.endsWith(".json")?"vscode-icons:file-type-json":s.endsWith(".xml")?"vscode-icons:file-type-xml":s.endsWith(".html")?"vscode-icons:file-type-html":s.endsWith(".css")?"vscode-icons:file-type-css":s.endsWith(".md")?"vscode-icons:file-type-markdown":s.endsWith(".yml")||s.endsWith(".yaml")?"vscode-icons:file-type-yaml":s.endsWith(".pdf")?"vscode-icons:file-type-pdf2":s.endsWith(".doc")||s.endsWith(".docx")?"vscode-icons:file-type-word":s.endsWith(".xls")||s.endsWith(".xlsx")?"vscode-icons:file-type-excel":s.endsWith(".ppt")||s.endsWith(".pptx")?"vscode-icons:file-type-powerpoint":s.match(/\.(jpg|jpeg|png|gif|bmp|svg)$/)?"carbon:image":s.match(/\.(zip|rar|7z|tar|gz)$/)?"carbon:archive":"carbon:document"}}be(Ne,"BASE_URL","/api/file-browser");const nd={class:"file-tree-node"},ad={class:"node-icon"},ld={class:"node-name"},rd={key:1,class:"file-size"},id={key:2,class:"node-actions"},cd={key:0,class:"children"},dd=he({__name:"FileTreeNode",props:{node:{},level:{}},emits:["file-selected","download-file"],setup(n,{emit:e}){const s=n,t=e,a=F(s.level===0),l=F(!1),i=F(!1),p=F({}),b=()=>{s.node.type==="directory"&&(a.value=!a.value)},d=()=>{s.node.type==="directory"?b():h()},h=()=>{s.node.type==="file"&&t("file-selected",s.node),U()},k=()=>{t("download-file",s.node),U()},C=g=>{g.preventDefault(),i.value=!0,p.value={position:"fixed",top:`${g.clientY}px`,left:`${g.clientX}px`,zIndex:1e3},setTimeout(()=>{document.addEventListener("click",U)},0)},U=()=>{i.value=!1,document.removeEventListener("click",U)},_=async()=>{try{await navigator.clipboard.writeText(s.node.path)}catch(g){console.error("Failed to copy path:",g)}U()},y=()=>s.node.type==="directory"?a.value?"carbon:folder-open":"carbon:folder":Ne.getFileIcon(s.node),m=g=>{if(g===0)return"0 B";const w=1024,$=["B","KB","MB","GB"],P=Math.floor(Math.log(g)/Math.log(w));return parseFloat((g/Math.pow(w,P)).toFixed(1))+" "+$[P]};return Se(()=>{document.removeEventListener("click",U)}),(g,w)=>{const $=ss("FileTreeNode",!0);return u(),v("div",nd,[o("div",{class:ae(["node-content",{"is-directory":g.node.type==="directory","is-file":g.node.type==="file","is-expanded":a.value}]),style:We({paddingLeft:`${g.level*16+12}px`}),onClick:d,onContextmenu:ve(C,["prevent"])},[g.node.type==="directory"?(u(),v("div",{key:0,class:"expand-icon",onClick:ve(b,["stop"])},[S(r(E),{icon:a.value?"carbon:chevron-down":"carbon:chevron-right",class:"chevron-icon"},null,8,["icon"])])):B("",!0),o("div",ad,[S(r(E),{icon:y()},null,8,["icon"])]),o("span",ld,c(g.node.name),1),g.node.type==="file"?(u(),v("span",rd,c(m(g.node.size)),1)):B("",!0),l.value?(u(),v("div",id,[g.node.type==="file"?(u(),v("button",{key:0,onClick:w[0]||(w[0]=ve(P=>g.$emit("download-file",g.node),["stop"])),class:"action-btn download-btn",title:"Download"},[S(r(E),{icon:"carbon:download"})])):B("",!0)])):B("",!0)],38),g.node.type==="directory"&&a.value&&g.node.children?(u(),v("div",cd,[(u(!0),v(re,null,ie(g.node.children,P=>(u(),le($,{key:P.path,node:P,level:g.level+1,onFileSelected:w[1]||(w[1]=f=>g.$emit("file-selected",f)),onDownloadFile:w[2]||(w[2]=f=>g.$emit("download-file",f))},null,8,["node","level"]))),128))])):B("",!0),i.value?(u(),v("div",{key:1,class:"context-menu",style:We(p.value),onClick:w[3]||(w[3]=ve(()=>{},["stop"]))},[o("div",{class:"context-menu-item",onClick:h},[S(r(E),{icon:"carbon:view"}),w[4]||(w[4]=o("span",null,"Open",-1))]),g.node.type==="file"?(u(),v("div",{key:0,class:"context-menu-item",onClick:k},[S(r(E),{icon:"carbon:download"}),w[5]||(w[5]=o("span",null,"Download",-1))])):B("",!0),w[7]||(w[7]=o("div",{class:"context-menu-divider"},null,-1)),o("div",{class:"context-menu-item",onClick:_},[S(r(E),{icon:"carbon:copy"}),w[6]||(w[6]=o("span",null,"Copy Path",-1))])],4)):B("",!0)])}}}),ud=me(dd,[["__scopeId","data-v-e4a376d5"]]),pd={class:"file-browser"},hd={class:"file-browser-header"},md={class:"header-actions"},fd=["disabled","title"],vd={class:"file-browser-content"},gd={class:"file-tree-panel"},bd={key:0,class:"loading-state"},yd={key:1,class:"error-state"},_d={key:0,class:"waiting-for-files"},$d={class:"message-content"},wd={class:"tips"},Sd=["disabled"],kd={key:1,class:"actual-error"},Td={key:2,class:"empty-state"},Ed={key:3,class:"file-tree"},Pd={key:0,class:"file-content-panel"},Cd={class:"file-content-header"},Rd={class:"file-info"},Id={class:"file-name"},Ad={class:"file-size"},xd={class:"file-actions"},Dd=["title"],Fd=["title"],Md={class:"file-content-body"},Ud={key:0,class:"loading-content"},Nd={key:1,class:"content-error"},Od={key:2,class:"file-content"},Ld={key:0,class:"text-content"},Bd={key:1,class:"binary-content"},qd=he({__name:"index",props:{planId:{}},setup(n){const e=n,{t:s}=Ee(),t=F(!1),a=F(null),l=F(null),i=F(null),p=F(null),b=F(!1),d=F(null),h=F(null),k=pe(()=>!p.value||!i.value?!1:Ne.isTextFile(p.value.mimeType,i.value.name)),C=pe(()=>a.value&&(a.value.includes("Plan directory not found")||a.value.includes("not found"))),U=()=>{h.value&&(clearTimeout(h.value),h.value=null)},_=()=>{U(),h.value=window.setTimeout(()=>{C.value&&y()},5e3)},y=async()=>{if(e.planId){t.value=!0,a.value=null,U();try{l.value=await Ne.getFileTree(e.planId)}catch(f){a.value=f instanceof Error?f.message:s("fileBrowser.loadError"),console.error("Failed to load file tree:",f);const j=f instanceof Error?f.message:"";(j.includes("Plan directory not found")||j.includes("not found"))&&_()}finally{t.value=!1}}},m=async f=>{if(f.type!=="directory"){i.value=f,p.value=null,b.value=!0,d.value=null;try{p.value=await Ne.getFileContent(e.planId,f.path)}catch(j){d.value=j instanceof Error?j.message:s("fileBrowser.contentLoadError"),console.error("Failed to load file content:",j)}finally{b.value=!1}}},g=async f=>{try{await Ne.downloadFile(e.planId,f.path,f.name)}catch(j){console.error("Failed to download file:",j)}},w=()=>{i.value=null,p.value=null,d.value=null},$=f=>Ne.getFileIcon(f),P=f=>{if(f===0)return"0 B";const j=1024,x=["B","KB","MB","GB"],se=Math.floor(Math.log(f)/Math.log(j));return parseFloat((f/Math.pow(j,se)).toFixed(1))+" "+x[se]};return fe(()=>e.planId,f=>{f&&(i.value=null,p.value=null,y())},{immediate:!0}),ke(()=>{e.planId&&y()}),Se(()=>{U()}),(f,j)=>(u(),v("div",pd,[o("div",hd,[o("h3",null,c(f.$t("fileBrowser.title")),1),o("div",md,[o("button",{class:"refresh-btn",onClick:y,disabled:t.value,title:f.$t("fileBrowser.refresh")},[S(r(E),{icon:"carbon:refresh",class:ae({rotating:t.value}),style:{color:"#ffffff",fontSize:"18px",width:"18px",height:"18px"}},null,8,["class"])],8,fd)])]),o("div",vd,[o("div",gd,[t.value?(u(),v("div",bd,[S(r(E),{icon:"carbon:loading",class:"rotating"}),o("span",null,c(f.$t("fileBrowser.loading")),1)])):a.value?(u(),v("div",yd,[C.value?(u(),v("div",_d,[S(r(E),{icon:"carbon:time",class:"rotating"}),o("div",$d,[o("h3",null,c(f.$t("fileBrowser.waitingForGeneration")),1),o("p",null,c(f.$t("fileBrowser.planExecuting")),1),o("div",wd,[S(r(E),{icon:"carbon:information"}),o("span",null,c(f.$t("fileBrowser.filesTip")),1)])]),o("button",{onClick:y,class:"retry-btn",disabled:t.value},[S(r(E),{icon:"carbon:refresh",class:ae({rotating:t.value})},null,8,["class"]),ne(" "+c(t.value?f.$t("fileBrowser.checking"):f.$t("fileBrowser.checkNow")),1)],8,Sd)])):(u(),v("div",kd,[S(r(E),{icon:"carbon:warning"}),o("span",null,c(a.value),1),o("button",{onClick:y,class:"retry-btn"},c(f.$t("fileBrowser.retry")),1)]))])):l.value?(u(),v("div",Ed,[S(ud,{node:l.value,level:0,onFileSelected:m,onDownloadFile:g},null,8,["node"])])):(u(),v("div",Td,[S(r(E),{icon:"carbon:folder-off"}),o("span",null,c(f.$t("fileBrowser.noFiles")),1)]))]),i.value?(u(),v("div",Pd,[o("div",Cd,[o("div",Rd,[S(r(E),{icon:$(i.value)},null,8,["icon"]),o("span",Id,c(i.value.name),1),o("span",Ad,"("+c(P(i.value.size))+")",1)]),o("div",xd,[o("button",{onClick:j[0]||(j[0]=x=>g(i.value)),class:"download-btn",title:f.$t("fileBrowser.download")},[S(r(E),{icon:"carbon:download"})],8,Dd),o("button",{onClick:w,class:"close-btn",title:f.$t("common.close")},[S(r(E),{icon:"carbon:close"})],8,Fd)])]),o("div",Md,[b.value?(u(),v("div",Ud,[S(r(E),{icon:"carbon:loading",class:"rotating"}),o("span",null,c(f.$t("fileBrowser.loadingContent")),1)])):d.value?(u(),v("div",Nd,[S(r(E),{icon:"carbon:warning"}),o("span",null,c(d.value),1)])):p.value?(u(),v("div",Od,[k.value?(u(),v("div",Ld,[o("pre",null,[o("code",null,c(p.value.content),1)])])):(u(),v("div",Bd,[S(r(E),{icon:"carbon:document-unknown"}),o("p",null,c(f.$t("fileBrowser.binaryFile")),1),o("button",{onClick:j[1]||(j[1]=x=>g(i.value)),class:"download-btn-large"},[S(r(E),{icon:"carbon:download"}),ne(" "+c(f.$t("fileBrowser.downloadToView")),1)])]))])):B("",!0)])])):B("",!0)])]))}}),jd=me(qd,[["__scopeId","data-v-e7c74fe4"]]),Vd={class:"right-panel"},Hd={class:"preview-header"},Wd={class:"preview-tabs"},zd={class:"preview-content"},Jd={key:0,class:"step-details"},Gd={key:0,class:"step-info"},Kd={key:0,class:"agent-info"},Xd={class:"info-item"},Yd={class:"label"},Qd={class:"value"},Zd={class:"info-item"},eu={class:"label"},tu={class:"value"},su={class:"info-item"},ou={class:"label"},nu={class:"execution-status"},au={class:"status-item"},lu={class:"status-text"},ru={key:0},iu={key:0,class:"think-act-steps"},cu={class:"steps-container"},du={class:"step-header"},uu={class:"step-number"},pu={class:"think-section"},hu={class:"think-content"},mu={class:"input"},fu={class:"label"},vu={class:"output"},gu={class:"label"},bu={key:0,class:"action-section"},yu={class:"action-content"},_u={class:"tool-info"},$u={class:"label"},wu={class:"value"},Su={class:"input"},ku={class:"label"},Tu={class:"output"},Eu={class:"label"},Pu={key:0,class:"sub-plan-section"},Cu={class:"sub-plan-content"},Ru={class:"sub-plan-header"},Iu={class:"sub-plan-info"},Au={class:"label"},xu={class:"value"},Du={key:0,class:"sub-plan-info"},Fu={class:"label"},Mu={class:"value"},Uu={class:"sub-plan-status"},Nu={class:"status-text"},Ou={key:0,class:"no-steps-message"},Lu={key:1,class:"no-execution-message"},Bu={class:"step-basic-info"},qu={class:"info-item"},ju={class:"label"},Vu={class:"value"},Hu={key:0,class:"info-item"},Wu={class:"label"},zu={class:"value"},Ju={class:"info-item"},Gu={class:"label"},Ku={class:"no-execution-hint"},Xu={key:2,class:"execution-indicator"},Yu={class:"execution-text"},Qu={key:1,class:"no-selection"},Zu=["title"],ep={key:1,class:"file-browser-container"},tp={key:1,class:"no-plan-message"},sp={class:"message-content"},op={class:"tips"},np=he({__name:"RightPanel",props:{currentRootPlanId:{},selectedStepId:{}},setup(n,{expose:e}){const s=n,{t}=Ee(),a=F(),l=F(),i=F("details"),p=F(localStorage.getItem("jmanus-last-plan-id")),b=F(localStorage.getItem("jmanus-has-executed-plan")==="true"),d=F(!1),h=F(!0),k=F(!0),C=pe(()=>l.value?l.value.completed?t("rightPanel.status.completed"):l.value.current?t("rightPanel.status.executing"):t("rightPanel.status.waiting"):""),U=pe(()=>s.currentRootPlanId?s.currentRootPlanId:p.value),_=pe(()=>!U.value&&!b.value),y=async A=>{var N,W,Z;if(console.log("[RightPanel] Step selected:",{stepId:A}),!A){console.warn("[RightPanel] No stepId provided"),l.value=null;return}try{const T=await Fs(A);if(!T){console.warn("[RightPanel] Agent execution detail not found for stepId:",A),l.value=null;return}const I={stepId:A,title:T.agentName||`Step ${A}`,description:T.agentDescription||"",agentExecution:T,completed:T.status==="FINISHED",current:T.status==="RUNNING"};l.value=I,console.log("[RightPanel] Step details updated:",I),console.log("[RightPanel] activeTab:",i.value),console.log("[RightPanel] selectedStep.value:",l.value),console.log("[RightPanel] agentExecution:",l.value.agentExecution),console.log("[RightPanel] thinkActSteps:",(N=l.value.agentExecution)==null?void 0:N.thinkActSteps),console.log("[RightPanel] thinkActSteps length:",(Z=(W=l.value.agentExecution)==null?void 0:W.thinkActSteps)==null?void 0:Z.length),await Te(),console.log("[RightPanel] After nextTick - selectedStep:",l.value),setTimeout(()=>{w()},100),P()}catch(T){console.error("[RightPanel] Error fetching step details:",T),l.value=null}},m=async()=>{var A;if(!((A=l.value)!=null&&A.stepId)){console.warn("[RightPanel] No step selected for refresh");return}console.log("[RightPanel] Refreshing current step:",l.value.stepId);try{const N=await od(l.value.stepId);N&&l.value&&(l.value.agentExecution=N,l.value.completed=N.status==="FINISHED",l.value.current=N.status==="RUNNING",console.log("[RightPanel] Step refreshed successfully"),P())}catch(N){console.error("[RightPanel] Error refreshing step:",N)}};fe(()=>s.selectedStepId,async A=>{A?await y(A):l.value=null},{immediate:!0});const g=A=>{a.value=A??void 0},w=()=>{if(!a.value)return;const{scrollTop:A,scrollHeight:N,clientHeight:W}=a.value,Z=N-A-W<50,T=N>W;h.value=Z,d.value=T&&!Z,Z?k.value=!0:N-A-W>100&&(k.value=!1),console.log("[RightPanel] Scroll state check:",{scrollTop:A,scrollHeight:N,clientHeight:W,isAtBottom:Z,hasScrollableContent:T,showButton:d.value,shouldAutoScroll:k.value})},$=()=>{a.value&&(a.value.scrollTo({top:a.value.scrollHeight,behavior:"smooth"}),Te(()=>{k.value=!0,w()}))},P=()=>{!k.value||!a.value||Te(()=>{a.value&&(a.value.scrollTop=a.value.scrollHeight,console.log("[RightPanel] Auto scroll to bottom"))})},f=A=>{if(A===null||typeof A>"u"||A==="")return"N/A";try{const N=typeof A=="object"?A:JSON.parse(A);return JSON.stringify(N,null,2)}catch{return String(A)}},j=()=>{l.value=null,k.value=!0,a.value&&a.value.removeEventListener("scroll",w)},x=()=>{const A=()=>{const N=a.value;return N?(g(N),N.addEventListener("scroll",w),k.value=!0,w(),console.log("[RightPanel] Scroll listener initialized successfully"),!0):(console.log("[RightPanel] Scroll container not found, retrying..."),!1)};Te(()=>{A()||setTimeout(()=>{A()},100)})};return fe(()=>s.currentRootPlanId,(A,N)=>{A&&A!==N?(p.value=A,b.value=!0,localStorage.setItem("jmanus-last-plan-id",A),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] New plan started:",A)):!A&&N&&console.log("[RightPanel] Plan execution finished, keeping last plan:",p.value)},{immediate:!0}),ke(()=>{console.log("[RightPanel] Component mounted"),Te(()=>{x()})}),Se(()=>{console.log("[RightPanel] Component unmounting, cleaning up..."),j()}),e({handleStepSelected:y,refreshCurrentStep:m,updateDisplayedPlanProgress:A=>{console.log("[RightPanel] updateDisplayedPlanProgress called with rootPlanId:",A),A&&(p.value=A,b.value=!0,localStorage.setItem("jmanus-last-plan-id",A),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] Plan progress updated:",A))}}),(A,N)=>{var W,Z;return u(),v("div",Vd,[o("div",Hd,[o("div",Wd,[o("div",{class:ae(["tab-item",{active:i.value==="details"}]),onClick:N[0]||(N[0]=T=>i.value="details")},[S(r(E),{icon:"carbon:events"}),o("span",null,c(r(t)("rightPanel.stepExecutionDetails")),1)],2),o("div",{class:ae(["tab-item",{active:i.value==="files"}]),onClick:N[1]||(N[1]=T=>i.value="files")},[S(r(E),{icon:"carbon:folder"}),o("span",null,c(r(t)("fileBrowser.title")),1)],2)])]),o("div",zd,[i.value==="details"?(u(),v("div",Jd,[l.value?(u(),v("div",Gd,[o("h3",null,c(l.value.title||l.value.description||r(t)("rightPanel.defaultStepTitle",{number:1})),1),l.value.agentExecution?(u(),v("div",Kd,[o("div",Xd,[o("span",Yd,c(r(t)("rightPanel.executingAgent"))+":",1),o("span",Qd,c(l.value.agentExecution.agentName),1)]),o("div",Zd,[o("span",eu,c(r(t)("rightPanel.callingModel"))+":",1),o("span",tu,c(l.value.agentExecution.modelName),1)]),o("div",su,[o("span",ou,c(r(t)("rightPanel.executionResult"))+":",1),o("span",{class:ae(["value",{success:l.value.agentExecution.status==="FINISHED"}])},c(l.value.agentExecution.status||r(t)("rightPanel.executing")),3)])])):B("",!0),o("div",nu,[o("div",au,[l.value.completed?(u(),le(r(E),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):l.value.current?(u(),le(r(E),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})):(u(),le(r(E),{key:2,icon:"carbon:time",class:"status-icon pending"})),o("span",lu,c(C.value),1)])])])):B("",!0),o("div",{ref_key:"scrollContainer",ref:a,class:"step-details-scroll-container",onScroll:w},[l.value?(u(),v("div",ru,[(W=l.value.agentExecution)!=null&&W.thinkActSteps&&l.value.agentExecution.thinkActSteps.length>0?(u(),v("div",iu,[o("h4",null,c(r(t)("rightPanel.thinkAndActionSteps")),1),o("div",cu,[(u(!0),v(re,null,ie(l.value.agentExecution.thinkActSteps,(T,I)=>(u(),v("div",{key:I,class:"think-act-step"},[o("div",du,[o("span",uu,"#"+c(I+1),1),o("span",{class:ae(["step-status",T.status])},c(T.status||r(t)("rightPanel.executing")),3)]),o("div",pu,[o("h5",null,[S(r(E),{icon:"carbon:thinking"}),ne(" "+c(r(t)("rightPanel.thinking")),1)]),o("div",hu,[o("div",mu,[o("span",fu,c(r(t)("rightPanel.input"))+":",1),o("pre",null,c(f(T.thinkInput)),1)]),o("div",vu,[o("span",gu,c(r(t)("rightPanel.output"))+":",1),o("pre",null,c(f(T.thinkOutput)),1)])])]),T.actionNeeded?(u(),v("div",bu,[o("h5",null,[S(r(E),{icon:"carbon:play"}),ne(" "+c(r(t)("rightPanel.action")),1)]),o("div",yu,[(u(!0),v(re,null,ie(T.actToolInfoList,(J,Y)=>(u(),v("div",{key:Y},[o("div",_u,[o("span",$u,c(r(t)("rightPanel.tool"))+":",1),o("span",wu,c(J.name||""),1)]),o("div",Su,[o("span",ku,c(r(t)("rightPanel.toolParameters"))+":",1),o("pre",null,c(f(J.parameters)),1)]),o("div",Tu,[o("span",Eu,c(r(t)("rightPanel.executionResult"))+":",1),o("pre",null,c(f(J.result)),1)])]))),128))]),T.subPlanExecutionRecord?(u(),v("div",Pu,[o("h5",null,[S(r(E),{icon:"carbon:tree-view"}),ne(" "+c(r(t)("rightPanel.subPlan")),1)]),o("div",Cu,[o("div",Ru,[o("div",Iu,[o("span",Au,c(A.$t("rightPanel.subPlanId"))+":",1),o("span",xu,c(T.subPlanExecutionRecord.currentPlanId),1)]),T.subPlanExecutionRecord.title?(u(),v("div",Du,[o("span",Fu,c(A.$t("rightPanel.title"))+":",1),o("span",Mu,c(T.subPlanExecutionRecord.title),1)])):B("",!0),o("div",Uu,[T.subPlanExecutionRecord.completed?(u(),le(r(E),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):(u(),le(r(E),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})),o("span",Nu,c(T.subPlanExecutionRecord.completed?A.$t("rightPanel.status.completed"):A.$t("rightPanel.status.executing")),1)])])])])):B("",!0)])):B("",!0)]))),128))]),l.value.agentExecution&&!((Z=l.value.agentExecution.thinkActSteps)!=null&&Z.length)?(u(),v("div",Ou,[o("p",null,c(r(t)("rightPanel.noStepDetails")),1)])):l.value.agentExecution?B("",!0):(u(),v("div",Lu,[S(r(E),{icon:"carbon:information",class:"info-icon"}),o("h4",null,c(r(t)("rightPanel.stepInfo")),1),o("div",Bu,[o("div",qu,[o("span",ju,c(r(t)("rightPanel.stepName"))+":",1),o("span",Vu,c(l.value.title||l.value.description||l.value.stepId),1)]),l.value.description?(u(),v("div",Hu,[o("span",Wu,c(A.$t("rightPanel.description"))+":",1),o("span",zu,c(l.value.description),1)])):B("",!0),o("div",Ju,[o("span",Gu,c(A.$t("rightPanel.status.label"))+":",1),o("span",{class:ae(["value",{"status-completed":l.value.completed,"status-current":l.value.current,"status-pending":!l.value.completed&&!l.value.current}])},c(l.value.completed?A.$t("rightPanel.status.completed"):l.value.current?A.$t("rightPanel.status.executing"):A.$t("rightPanel.status.pending")),3)])]),o("p",Ku,c(r(t)("rightPanel.noExecutionInfo")),1)])),l.value.current&&!l.value.completed?(u(),v("div",Xu,[N[2]||(N[2]=o("div",{class:"execution-waves"},[o("div",{class:"wave wave-1"}),o("div",{class:"wave wave-2"}),o("div",{class:"wave wave-3"})],-1)),o("p",Yu,[S(r(E),{icon:"carbon:in-progress",class:"rotating-icon"}),ne(" "+c(r(t)("rightPanel.stepExecuting")),1)])])):B("",!0)])):(u(),v("div",Qu,[S(r(E),{icon:"carbon:events",class:"empty-icon"}),o("h3",null,c(r(t)("rightPanel.noStepSelected")),1),o("p",null,c(r(t)("rightPanel.selectStepHint")),1)]))])):B("",!0),S(Be,{name:"scroll-button"},{default:Me(()=>[d.value?(u(),v("button",{key:0,onClick:$,class:"scroll-to-bottom-btn",title:r(t)("rightPanel.scrollToBottom")},[S(r(E),{icon:"carbon:chevron-down"})],8,Zu)):B("",!0)]),_:1})],544)])):B("",!0),i.value==="files"?(u(),v("div",ep,[U.value?(u(),le(jd,{key:0,"plan-id":U.value},null,8,["plan-id"])):_.value?(u(),v("div",tp,[S(r(E),{icon:"carbon:folder-off"}),o("div",sp,[o("h3",null,c(r(t)("fileBrowser.noFilesYet")),1),o("p",null,c(r(t)("fileBrowser.noPlanExecuting")),1),o("div",op,[S(r(E),{icon:"carbon:information"}),o("span",null,c(r(t)("fileBrowser.startTaskTip")),1)])])])):B("",!0)])):B("",!0)])])}}}),ap=me(np,[["__scopeId","data-v-ea214380"]]);function Nt(){return{formatResponseText:b=>b?b.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\n/g,"<br>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>"):"",formatTimestamp:b=>{const h=new Date().getTime()-b.getTime();return h<6e4?"Just now":h<36e5?`${Math.floor(h/6e4)} minutes ago`:h<864e5?`${Math.floor(h/36e5)} hours ago`:b.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},getMessageClasses:b=>pe(()=>({user:b.type==="user",assistant:b.type==="assistant",streaming:b.isStreaming,"has-error":!!b.error,"has-thinking":!!b.thinking,"has-execution":!!b.planExecution})),formatFileSize:b=>{if(b===0)return"0 B";const d=1024,h=["B","KB","MB","GB"],k=Math.floor(Math.log(b)/Math.log(d));return parseFloat((b/Math.pow(d,k)).toFixed(2))+" "+h[k]},truncateText:(b,d=100)=>!b||b.length<=d?b:b.substring(0,d)+"...",stripHtml:b=>b.replace(/<[^>]*>/g,""),hasDisplayableContent:b=>!!(b.content||b.thinking||b.planExecution||b.error),getMessageStatus:b=>b.error?"Send failed":b.isStreaming?"Typing...":b.type==="assistant"&&!b.content&&!b.thinking?"Waiting for response":""}}const lp=["data-message-id"],rp={class:"user-content"},ip={class:"message-text"},cp={key:0,class:"attachments"},dp={class:"attachment-name"},up={class:"attachment-size"},pp={class:"message-timestamp"},hp={key:0,class:"message-status error"},mp={class:"status-text"},fp=he({__name:"UserMessage",props:{message:{}},setup(n){const{formatTimestamp:e,formatFileSize:s}=Nt();return(t,a)=>{var l;return u(),v("div",{class:"user-message","data-message-id":t.message.id},[o("div",rp,[o("div",ip,c(t.message.content),1),(l=t.message.attachments)!=null&&l.length?(u(),v("div",cp,[(u(!0),v(re,null,ie(t.message.attachments,(i,p)=>(u(),v("div",{key:p,class:"attachment-item"},[S(r(E),{icon:"carbon:document",class:"attachment-icon"}),o("span",dp,c(i.name),1),o("span",up,c(r(s)(i.size)),1)]))),128))])):B("",!0),o("div",pp,c(r(e)(t.message.timestamp)),1)]),t.message.error?(u(),v("div",hp,[S(r(E),{icon:"carbon:warning",class:"status-icon"}),o("span",mp,c(t.message.error),1)])):B("",!0)],8,lp)}}}),vp=me(fp,[["__scopeId","data-v-94372507"]]),gp={class:"sub-plan-info"},bp={class:"sub-plan-details"},yp={class:"sub-plan-title"},_p={key:0,class:"nesting-level"},$p={class:"sub-plan-id"},wp={class:"sub-plan-meta"},Sp={key:0,class:"trigger-tool"},kp={class:"trigger-text"},Tp={key:0,class:"sub-plan-progress"},Ep={class:"progress-info"},Pp={class:"progress-text"},Cp={class:"progress-bar"},Rp={key:1,class:"sub-plan-agents-steps"},Ip={class:"agents-steps-header"},Ap={class:"agents-label"},xp={class:"agents-steps-list"},Dp=["onClick"],Fp={class:"agent-step-header"},Mp={class:"agent-name"},Up={class:"sub-agent-execution-info"},Np={key:0,class:"agent-result"},Op={class:"result-header"},Lp={class:"result-label"},Bp={class:"result-content"},qp={key:1,class:"agent-error"},jp={class:"error-header"},Vp={class:"error-label"},Hp={class:"error-content"},Wp={key:2,class:"think-act-preview"},zp={class:"think-act-header"},Jp={class:"think-act-label"},Gp={class:"think-act-steps-preview"},Kp=["onClick"],Xp={class:"step-number"},Yp={class:"step-description"},Qp={key:0,class:"more-steps"},Zp={class:"more-steps-text"},eh={key:3,class:"nested-sub-plans"},th={class:"nested-sub-plans-header"},sh={class:"nested-label"},oh={class:"nested-sub-plans-list"},nh={key:4,class:"direct-sub-plans"},ah={class:"direct-sub-plans-header"},lh={class:"direct-label"},rh={class:"direct-sub-plans-list"},ih=he({__name:"RecursiveSubPlan",props:{subPlan:{},subPlanIndex:{},nestingLevel:{default:0},maxNestingDepth:{default:3},maxVisibleSteps:{default:2}},emits:["sub-plan-selected","step-selected"],setup(n,{emit:e}){const s=n,t=e,{t:a}=Ee(),l=()=>`nesting-level-${s.nestingLevel}`,i=()=>{var x,se;return s.subPlan.completed?"completed":((x=s.subPlan.agentExecutionSequence)==null?void 0:x.some(A=>A.status==="RUNNING"))?"running":((se=s.subPlan.agentExecutionSequence)==null?void 0:se.some(A=>A.status==="FINISHED"))?"in-progress":"pending"},p=()=>{switch(i()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},b=()=>{switch(i()){case"completed":return"carbon:checkmark";case"running":return"carbon:play";case"in-progress":return"carbon:in-progress";case"pending":default:return"carbon:dot-mark"}},d=()=>{var j;if(!((j=s.subPlan.agentExecutionSequence)!=null&&j.length))return 0;if(s.subPlan.completed)return 100;const f=h();return Math.min(100,f/s.subPlan.agentExecutionSequence.length*100)},h=()=>{var f;return(f=s.subPlan.agentExecutionSequence)!=null&&f.length?s.subPlan.agentExecutionSequence.filter(j=>j.status==="FINISHED").length:0},k=f=>{switch(f){case"FINISHED":return"completed";case"RUNNING":return"running";case"IDLE":default:return"pending"}},C=f=>{switch(f){case"FINISHED":return"carbon:checkmark";case"RUNNING":return"carbon:play";case"IDLE":default:return"carbon:dot-mark"}},U=f=>{switch(f){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},_=f=>{var j;return((j=f.thinkActSteps)==null?void 0:j.some(x=>x.subPlanExecutionRecord))??!1},y=f=>{var j;return((j=f.thinkActSteps)==null?void 0:j.filter(x=>x.subPlanExecutionRecord))??[]},m=()=>{t("sub-plan-selected",-1,s.subPlanIndex,s.subPlan)},g=(f,j)=>{const x=j.stepId||`subplan-${s.subPlanIndex}-agent-${f}`;t("step-selected",x)},w=(f,j,x)=>{const se=x.stepId||`subplan-${s.subPlanIndex}-agent-${f}`;t("step-selected",se)},$=(f,j,x)=>{t("sub-plan-selected",f,j,x)},P=f=>{t("step-selected",f)};return(f,j)=>{var se,A;const x=ss("RecursiveSubPlan",!0);return u(),v("div",{class:ae(["recursive-sub-plan",l()])},[o("div",{class:"sub-plan-header",onClick:m},[o("div",gp,[S(r(E),{icon:b(),class:"sub-plan-status-icon"},null,8,["icon"]),o("div",bp,[o("div",yp,[ne(c(f.subPlan.title||f.$t("chat.subPlan"))+" #"+c(f.subPlanIndex+1)+" ",1),(f.nestingLevel??0)>0?(u(),v("span",_p,"(L"+c((f.nestingLevel??0)+1)+")",1)):B("",!0)]),o("div",$p,c(f.subPlan.currentPlanId),1)])]),o("div",wp,[o("div",{class:ae(["sub-plan-status-badge",i()])},c(p()),3),f.subPlan.parentActToolCall?(u(),v("div",Sp,[S(r(E),{icon:"carbon:function",class:"trigger-icon"}),o("span",kp,c(f.subPlan.parentActToolCall.name),1)])):B("",!0)])]),(se=f.subPlan.agentExecutionSequence)!=null&&se.length?(u(),v("div",Tp,[o("div",Ep,[o("span",Pp,c(f.$t("chat.progress"))+": "+c(h())+" / "+c(f.subPlan.agentExecutionSequence.length),1),o("div",Cp,[o("div",{class:"progress-fill",style:We({width:d()+"%"})},null,4)])])])):B("",!0),(A=f.subPlan.agentExecutionSequence)!=null&&A.length?(u(),v("div",Rp,[o("div",Ip,[o("span",Ap,c(f.$t("chat.agentExecutions"))+":",1)]),o("div",xp,[(u(!0),v(re,null,ie(f.subPlan.agentExecutionSequence,(N,W)=>{var Z,T;return u(),v("div",{key:N.id||W,class:ae(["agent-step-item",k(N.status)]),onClick:I=>g(W,N)},[o("div",Fp,[S(r(E),{icon:C(N.status),class:"agent-icon"},null,8,["icon"]),o("span",Mp,c(N.agentName||f.$t("chat.unknownAgent")),1),o("div",{class:ae(["agent-status-badge",k(N.status)])},c(U(N.status)),3)]),o("div",Up,[N.result?(u(),v("div",Np,[o("div",Op,[S(r(E),{icon:"carbon:checkmark",class:"result-icon"}),o("span",Lp,c(f.$t("chat.agentResult"))+":",1)]),o("pre",Bp,c(N.result),1)])):B("",!0),N.errorMessage?(u(),v("div",qp,[o("div",jp,[S(r(E),{icon:"carbon:warning",class:"error-icon"}),o("span",Vp,c(f.$t("chat.errorMessage"))+":",1)]),o("pre",Hp,c(N.errorMessage),1)])):B("",!0),(Z=N.thinkActSteps)!=null&&Z.length?(u(),v("div",Wp,[o("div",zp,[S(r(E),{icon:"carbon:thinking",class:"think-act-icon"}),o("span",Jp,c(f.$t("chat.thinkActSteps"))+" ("+c(N.thinkActSteps.length)+")",1)]),o("div",Gp,[(u(!0),v(re,null,ie(N.thinkActSteps.slice(0,f.maxVisibleSteps??2),(I,J)=>(u(),v("div",{key:I.id||J,class:"think-act-step-preview",onClick:ve(Y=>w(W,J,N),["stop"])},[o("span",Xp,"#"+c(J+1),1),o("span",Yp,c(I.actionDescription||f.$t("chat.thinking")),1),S(r(E),{icon:"carbon:arrow-right",class:"step-arrow"})],8,Kp))),128)),N.thinkActSteps.length>(f.maxVisibleSteps??2)?(u(),v("div",Qp,[o("span",Zp,c(f.$t("chat.andMoreSteps",{count:N.thinkActSteps.length-(f.maxVisibleSteps??2)})),1)])):B("",!0)])])):B("",!0),_(N)?(u(),v("div",eh,[o("div",th,[S(r(E),{icon:"carbon:tree-view-alt",class:"nested-icon"}),o("span",sh,c(f.$t("chat.nestedSubPlans")),1)]),o("div",oh,[(u(!0),v(re,null,ie(y(N),(I,J)=>(u(),le(x,{key:I.id||J,"sub-plan":I.subPlanExecutionRecord,"sub-plan-index":J,"nesting-level":(f.nestingLevel??0)+1,"max-nesting-depth":f.maxNestingDepth??3,"max-visible-steps":f.maxVisibleSteps??2,onSubPlanSelected:$,onStepSelected:P},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):B("",!0),(T=N.subPlanExecutionRecords)!=null&&T.length?(u(),v("div",nh,[o("div",ah,[S(r(E),{icon:"carbon:tree-view",class:"direct-icon"}),o("span",lh,c(f.$t("chat.directSubPlans")),1)]),o("div",rh,[(u(!0),v(re,null,ie(N.subPlanExecutionRecords,(I,J)=>(u(),le(x,{key:I.currentPlanId||J,"sub-plan":I,"sub-plan-index":J,"nesting-level":(f.nestingLevel??0)+1,"max-nesting-depth":f.maxNestingDepth??3,"max-visible-steps":f.maxVisibleSteps??2,onSubPlanSelected:$,onStepSelected:P},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):B("",!0)])],10,Dp)}),128))])])):B("",!0)],2)}}}),ch=me(ih,[["__scopeId","data-v-5ef3cbb7"]]),dh={class:"execution-details"},uh={key:0,class:"plan-overview"},ph={class:"plan-header"},hh={class:"plan-title"},mh={key:0,class:"parent-tool-call"},fh={class:"parent-tool-header"},vh={class:"tool-label"},gh={class:"tool-name"},bh={key:0,class:"tool-parameters"},yh={class:"param-label"},_h={class:"param-content"},$h={key:1,class:"agent-execution-container"},wh={class:"section-title"},Sh=["onClick"],kh={class:"agent-info"},Th={class:"agent-details"},Eh={class:"agent-name"},Ph={class:"request-content"},Ch={class:"agent-controls"},Rh={class:"agent-execution-info"},Ih={key:0,class:"agent-result"},Ah={class:"result-header"},xh={class:"result-label"},Dh={class:"result-content"},Fh={key:1,class:"agent-error"},Mh={class:"error-header"},Uh={class:"error-label"},Nh={class:"error-content"},Oh={key:0,class:"sub-plans-container"},Lh={class:"sub-plans-header"},Bh={class:"sub-plans-title"},qh={class:"sub-plans-list"},jh=he({__name:"ExecutionDetails",props:{planExecution:{},genericInput:{}},emits:["agent-selected","sub-plan-selected","user-input-submitted","step-selected"],setup(n,{emit:e}){const s=n,t=e,{t:a}=Ee(),l=pe(()=>{var y;return((y=s.planExecution)==null?void 0:y.agentExecutionSequence)??[]}),i=y=>{y.stepId?t("step-selected",y.stepId):console.warn("[ExecutionDetails] Agent execution has no stepId:",y)},p=()=>s.planExecution?s.planExecution.completed?"completed":l.value.some(g=>g.status==="RUNNING")?"running":l.value.some(g=>g.status==="FINISHED")?"in-progress":"pending":"unknown",b=()=>{switch(p()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},d=y=>{switch(y){case"RUNNING":return"running";case"FINISHED":return"completed";case"IDLE":default:return"pending"}},h=y=>{switch(y){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},k=y=>{switch(y){case"RUNNING":return"carbon:play";case"FINISHED":return"carbon:checkmark";case"IDLE":default:return"carbon:dot-mark"}},C=(y,m,g)=>{t("sub-plan-selected",y,m,g)},U=y=>{t("step-selected",y)},_=y=>{if(!y)return"";try{const m=JSON.parse(y);return JSON.stringify(m,null,2)}catch{return y}};return(y,m)=>{var g,w,$;return u(),v("div",dh,[y.planExecution?(u(),v("div",uh,[o("div",ph,[o("h3",hh,c(y.planExecution.title||y.$t("chat.planExecution")),1),o("div",{class:ae(["plan-status-badge",p()])},c(b()),3)]),y.planExecution.parentActToolCall?(u(),v("div",mh,[o("div",fh,[S(r(E),{icon:"carbon:flow",class:"tool-icon"}),o("span",vh,c(y.$t("chat.triggeredByTool"))+":",1),o("span",gh,c(y.planExecution.parentActToolCall.name),1)]),y.planExecution.parentActToolCall.parameters?(u(),v("div",bh,[o("span",yh,c(y.$t("common.parameters"))+":",1),o("pre",_h,c(_(y.planExecution.parentActToolCall.parameters)),1)])):B("",!0)])):B("",!0)])):B("",!0),(((w=(g=y.planExecution)==null?void 0:g.agentExecutionSequence)==null?void 0:w.length)??0)>0?(u(),v("div",$h,[o("h4",wh,c(y.$t("chat.agentExecutionSequence")),1),(u(!0),v(re,null,ie(($=y.planExecution)==null?void 0:$.agentExecutionSequence,(P,f)=>{var j;return u(),v("div",{key:P.id||f,class:ae(["agent-execution-item",d(P.status)])},[o("div",{class:"agent-header",onClick:x=>i(P)},[o("div",kh,[S(r(E),{icon:k(P.status),class:"agent-status-icon"},null,8,["icon"]),o("div",Th,[o("div",Eh,c(P.agentName||y.$t("chat.unknownAgent")),1),o("pre",Ph,c(P.agentRequest),1)])]),o("div",Ch,[o("div",{class:ae(["agent-status-badge",d(P.status)])},c(h(P.status)),3),S(r(E),{icon:"carbon:arrow-right",class:"step-select-icon"})])],8,Sh),o("div",Rh,[P.result?(u(),v("div",Ih,[o("div",Ah,[S(r(E),{icon:"carbon:checkmark",class:"result-icon"}),o("span",xh,c(y.$t("chat.agentResult"))+":",1)]),o("pre",Dh,c(P.result),1)])):B("",!0),P.errorMessage?(u(),v("div",Fh,[o("div",Mh,[S(r(E),{icon:"carbon:warning",class:"error-icon"}),o("span",Uh,c(y.$t("chat.errorMessage"))+":",1)]),o("pre",Nh,c(P.errorMessage),1)])):B("",!0)]),(j=P.subPlanExecutionRecords)!=null&&j.length?(u(),v("div",Oh,[o("div",Lh,[S(r(E),{icon:"carbon:tree-view",class:"sub-plans-icon"}),o("span",Bh,c(y.$t("chat.subPlanExecutions"))+" ("+c(P.subPlanExecutionRecords.length)+") ",1)]),o("div",qh,[(u(!0),v(re,null,ie(P.subPlanExecutionRecords,(x,se)=>(u(),le(ch,{key:x.currentPlanId||se,"sub-plan":x,"sub-plan-index":se,"nesting-level":0,"max-nesting-depth":3,"max-visible-steps":2,onSubPlanSelected:C,onStepSelected:U},null,8,["sub-plan","sub-plan-index"]))),128))])])):B("",!0)],2)}),128))])):B("",!0)])}}}),Ms=me(jh,[["__scopeId","data-v-2d936ebb"]]),Vh={key:0,class:"thinking-section"},Hh={class:"thinking-header"},Wh={class:"thinking-avatar"},zh={class:"thinking-label"},Jh={class:"thinking-content"},Gh={key:0,class:"thinking"},Kh={key:2,class:"default-processing"},Xh={class:"processing-indicator"},Yh=he({__name:"ThinkingSection",props:{thinking:{},thinkingDetails:{},planExecution:{},stepActions:{},genericInput:{},hasContent:{type:Boolean}},emits:["agent-selected","sub-plan-selected","user-input-submitted","step-selected"],setup(n,{emit:e}){const s=n,t=e,a=pe(()=>{var d,h,k,C;return s.thinking||(((h=(d=s.thinkingDetails)==null?void 0:d.agentExecutionSequence)==null?void 0:h.length)??0)>0||(((C=(k=s.planExecution)==null?void 0:k.agentExecutionSequence)==null?void 0:C.length)??0)>0}),l=(d,h)=>{t("agent-selected",d,h)},i=(d,h,k)=>{t("sub-plan-selected",d,h,k)},p=d=>{t("user-input-submitted",d)},b=d=>{t("step-selected",d)};return(d,h)=>a.value?(u(),v("div",Vh,[o("div",Hh,[o("div",Wh,[S(r(E),{icon:"carbon:thinking",class:"thinking-icon"})]),o("div",zh,c(d.$t("chat.thinkingLabel")),1)]),o("div",Jh,[d.thinking?(u(),v("div",Gh,[S(r(E),{icon:"carbon:thinking",class:"thinking-icon"}),o("span",null,c(d.thinking),1)])):B("",!0),d.thinkingDetails||d.planExecution?(u(),le(Ms,{key:1,"plan-execution":d.thinkingDetails||d.planExecution,"step-actions":d.stepActions||[],"generic-input":d.genericInput||"",onAgentSelected:l,onSubPlanSelected:i,onUserInputSubmitted:p,onStepSelected:b},null,8,["plan-execution","step-actions","generic-input"])):!d.hasContent&&d.thinking?(u(),v("div",Kh,[o("div",Xh,[h[0]||(h[0]=o("div",{class:"thinking-dots"},[o("span"),o("span"),o("span")],-1)),o("span",null,c(d.thinking||d.$t("chat.thinkingProcessing")),1)])])):B("",!0)])])):B("",!0)}}),Qh=me(Yh,[["__scopeId","data-v-c341487f"]]);class _t{static async getDetails(e){try{const s=await fetch(`${this.BASE_URL}/details/${e}`);if(s.status===404)return null;if(!s.ok){const l=await s.text();throw new Error(`Failed to get detailed information: ${s.status} - ${l}`)}const t=await s.text(),a=JSON.parse(t);return a&&typeof a=="object"&&!a.currentPlanId&&(a.currentPlanId=e),a}catch(s){return console.error("[CommonApiService] Failed to get plan details:",s),null}}static async submitFormInput(e,s){const t=await fetch(`${this.BASE_URL}/submit-input/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!t.ok){let l;try{l=await t.json()}catch{l={message:`Failed to submit form input: ${t.status}`}}throw new Error(l.message||`Failed to submit form input: ${t.status}`)}const a=t.headers.get("content-type");return a&&a.indexOf("application/json")!==-1?await t.json():{success:!0}}static async getAllPrompts(){try{const e=await fetch(this.BASE_URL);return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get Prompt list:",e),e}}static async handleResponse(e){if(!e.ok)try{const s=await e.json();throw new Error(s.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}}be(_t,"BASE_URL","/api/executor");const Zh={class:"user-input-form-container"},em={class:"user-input-header"},tm={class:"user-input-title"},sm={class:"user-input-message"},om={key:0,class:"form-description"},nm={key:0,class:"form-grid"},am=["for"],lm=["id","name","placeholder","required","onUpdate:modelValue"],rm=["id","name","placeholder","required","onUpdate:modelValue"],im=["id","name","placeholder","required","onUpdate:modelValue"],cm=["id","name","placeholder","required","onUpdate:modelValue"],dm=["id","name","placeholder","required","onUpdate:modelValue"],um=["id","name","required","onUpdate:modelValue"],pm={value:""},hm=["value"],mm={key:6,class:"checkbox-group"},fm=["id","name","value","onUpdate:modelValue"],vm={class:"checkbox-label"},gm={key:7,class:"radio-group"},bm=["id","name","value","onUpdate:modelValue"],ym={class:"radio-label"},_m=["id","name","placeholder","required","onUpdate:modelValue"],$m={key:1,class:"form-group"},wm={for:"form-input-genericInput"},Sm={type:"submit",class:"submit-user-input-btn"},km=he({__name:"UserInputForm",props:{userInputWaitState:{},planId:{},genericInput:{}},emits:["user-input-submitted"],setup(n,{emit:e}){const s=n,t=e;Ee();const a=tt({}),l=F(s.genericInput||""),i=F(!1),p=F(null),b=()=>{var U;const C=(U=s.userInputWaitState)==null?void 0:U.formInputs;C&&C.length>0&&(!i.value||Object.keys(a).length!==C.length)&&(C.forEach((y,m)=>{(!(m in a)||y.type==="checkbox"&&!Array.isArray(a[m])||y.type!=="checkbox"&&a[m]==="")&&(y.type==="checkbox"?a[m]=[]:a[m]="")}),i.value=!0)};ke(()=>{b()}),fe(()=>{var C;return(C=s.userInputWaitState)==null?void 0:C.formInputs},()=>{p.value&&clearTimeout(p.value),p.value=setTimeout(()=>{i.value=!1,b()},100)},{deep:!0});const d=async()=>{var C;try{const U={},_=(C=s.userInputWaitState)==null?void 0:C.formInputs;_&&_.length>0?Object.entries(a).forEach(([y,m])=>{const g=parseInt(y,10),w=_[g];if(w){const $=w.label||`input_${y}`;Array.isArray(m)?U[$]=m.join(", "):U[$]=m}}):U.genericInput=l.value,console.log("[UserInputForm] Submitting user input:",U,"for planId:",s.planId),s.planId?(await _t.submitFormInput(s.planId,U),console.log("[UserInputForm] User input submitted successfully")):console.error("[UserInputForm] No planId available for user input submission"),t("user-input-submitted",U)}catch(U){console.error("[UserInputForm] User input submission failed:",U)}},h=C=>C?Array.isArray(C)?C:typeof C=="string"?C.split(",").map(U=>U.trim()).filter(U=>U.length>0):[]:[],k=C=>typeof C=="boolean"?C:typeof C=="string"?C==="true":!1;return Se(()=>{p.value&&clearTimeout(p.value)}),(C,U)=>{var _,y,m,g,w;return u(),v("div",Zh,[o("div",em,[S(r(E),{icon:"carbon:user",class:"user-icon"}),o("h4",tm,c(C.$t("chat.userInputRequired")),1)]),o("p",sm,c(((_=C.userInputWaitState)==null?void 0:_.title)??C.$t("chat.userInput.message")),1),(y=C.userInputWaitState)!=null&&y.formDescription?(u(),v("p",om,c((m=C.userInputWaitState)==null?void 0:m.formDescription),1)):B("",!0),o("form",{onSubmit:ve(d,["prevent"]),class:"user-input-form"},[(g=C.userInputWaitState)!=null&&g.formInputs&&C.userInputWaitState.formInputs.length>0?(u(),v("div",nm,[(u(!0),v(re,null,ie((w=C.userInputWaitState)==null?void 0:w.formInputs,($,P)=>(u(),v("div",{key:P,class:"form-group"},[o("label",{for:`form-input-${$.label.replace(/\W+/g,"_")}`},c($.label)+c(k($.required)?" *":"")+": ",9,am),!$.type||$.type==="text"?oe((u(),v("input",{key:0,type:"text",id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,placeholder:$.placeholder||"",required:k($.required),"onUpdate:modelValue":f=>a[P]=f,class:"form-input"},null,8,lm)),[[ce,a[P]]]):$.type==="email"?oe((u(),v("input",{key:1,type:"email",id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,placeholder:$.placeholder||"",required:k($.required),"onUpdate:modelValue":f=>a[P]=f,class:"form-input"},null,8,rm)),[[ce,a[P]]]):$.type==="number"?oe((u(),v("input",{key:2,type:"number",id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,placeholder:$.placeholder||"",required:k($.required),"onUpdate:modelValue":f=>a[P]=f,class:"form-input"},null,8,im)),[[ce,a[P]]]):$.type==="password"?oe((u(),v("input",{key:3,type:"password",id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,placeholder:$.placeholder||"",required:k($.required),"onUpdate:modelValue":f=>a[P]=f,class:"form-input"},null,8,cm)),[[ce,a[P]]]):$.type==="textarea"?oe((u(),v("textarea",{key:4,id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,placeholder:$.placeholder||"",required:k($.required),"onUpdate:modelValue":f=>a[P]=f,class:"form-input form-textarea",rows:"4"},null,8,dm)),[[ce,a[P]]]):$.type==="select"&&$.options?oe((u(),v("select",{key:5,id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,required:k($.required),"onUpdate:modelValue":f=>a[P]=f,class:"form-input form-select"},[o("option",pm,c(C.$t("selectCommon.pleaseSelect")),1),(u(!0),v(re,null,ie(h($.options),f=>(u(),v("option",{key:f,value:f},c(f),9,hm))),128))],8,um)),[[pt,a[P]]]):$.type==="checkbox"&&$.options?(u(),v("div",mm,[(u(!0),v(re,null,ie(h($.options),f=>(u(),v("label",{key:f,class:"checkbox-item"},[oe(o("input",{type:"checkbox",id:`form-input-${$.label.replace(/\W+/g,"_")}-${f.replace(/\W+/g,"_")}`,name:$.label,value:f,"onUpdate:modelValue":j=>a[P]=j,class:"form-checkbox"},null,8,fm),[[at,a[P]]]),o("span",vm,c(f),1)]))),128))])):$.type==="radio"&&$.options?(u(),v("div",gm,[(u(!0),v(re,null,ie(h($.options),f=>(u(),v("label",{key:f,class:"radio-item"},[oe(o("input",{type:"radio",id:`form-input-${$.label.replace(/\W+/g,"_")}-${f.replace(/\W+/g,"_")}`,name:$.label,value:f,"onUpdate:modelValue":j=>a[P]=j,class:"form-radio"},null,8,bm),[[Ls,a[P]]]),o("span",ym,c(f),1)]))),128))])):oe((u(),v("input",{key:8,type:"text",id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,placeholder:$.placeholder||"",required:k($.required),"onUpdate:modelValue":f=>a[P]=f,class:"form-input"},null,8,_m)),[[ce,a[P]]])]))),128))])):(u(),v("div",$m,[o("label",wm,c(C.$t("common.input"))+":",1),oe(o("input",{type:"text",id:"form-input-genericInput",name:"genericInput","onUpdate:modelValue":U[0]||(U[0]=$=>l.value=$),class:"form-input"},null,512),[[ce,l.value]])])),o("button",Sm,c(C.$t("chat.userInput.submit")),1)],32)])}}}),Tm=me(km,[["__scopeId","data-v-043b591c"]]),Em={class:"response-section"},Pm={class:"response-header"},Cm={class:"response-avatar"},Rm={class:"response-name"},Im={key:0,class:"response-timestamp"},Am={class:"response-content"},xm={key:1,class:"final-response"},Dm=["innerHTML"],Fm={class:"response-actions"},Mm=["title"],Um=["title"],Nm={key:2,class:"response-placeholder"},Om={class:"typing-indicator"},Lm={class:"typing-text"},Bm={key:3,class:"response-error"},qm={class:"error-text"},jm={key:4,class:"response-empty"},Vm={class:"empty-text"},Hm=he({__name:"ResponseSection",props:{content:{},isStreaming:{type:Boolean},error:{},timestamp:{},userInputWaitState:{},planId:{},genericInput:{}},emits:["copy","regenerate","retry","user-input-submitted"],setup(n,{emit:e}){const s=n,t=e,{formatResponseText:a,formatTimestamp:l}=Nt(),i=async()=>{if(s.content)try{const h=s.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(h),t("copy")}catch(h){console.error("Failed to copy to clipboard:",h)}},p=()=>{t("regenerate")},b=()=>{t("retry")},d=h=>{console.log("[ResponseSection] User input submitted:",h),t("user-input-submitted",h)};return(h,k)=>{var C;return u(),v("div",Em,[o("div",Pm,[o("div",Cm,[S(r(E),{icon:"carbon:bot",class:"bot-icon"})]),o("div",Rm,c(h.$t("chat.botName")),1),h.timestamp?(u(),v("div",Im,c(r(l)(h.timestamp)),1)):B("",!0)]),o("div",Am,[(C=h.userInputWaitState)!=null&&C.waiting?(u(),le(Tm,os({key:0,"user-input-wait-state":h.userInputWaitState},h.planId?{"plan-id":h.planId}:{},{"generic-input":h.genericInput??"",onUserInputSubmitted:d}),null,16,["user-input-wait-state","generic-input"])):B("",!0),h.content?(u(),v("div",xm,[o("div",{class:"response-text",innerHTML:r(a)(h.content)},null,8,Dm),o("div",Fm,[o("button",{class:"action-btn copy-btn",onClick:i,title:h.$t("chat.copyResponse")},[S(r(E),{icon:"carbon:copy"})],8,Mm),o("button",{class:"action-btn regenerate-btn",onClick:p,title:h.$t("chat.regenerateResponse")},[S(r(E),{icon:"carbon:renew"})],8,Um)])])):h.isStreaming?(u(),v("div",Nm,[o("div",Om,[k[0]||(k[0]=o("div",{class:"typing-dots"},[o("span"),o("span"),o("span")],-1)),o("span",Lm,c(h.$t("chat.thinkingResponse")),1)])])):h.error?(u(),v("div",Bm,[S(r(E),{icon:"carbon:warning",class:"error-icon"}),o("span",qm,c(h.error),1),o("button",{class:"retry-btn",onClick:b},c(h.$t("chat.retry")),1)])):(u(),v("div",jm,[o("span",Vm,c(h.$t("chat.waitingForResponse")),1)]))])])}}}),Wm=me(Hm,[["__scopeId","data-v-6581a34f"]]),zm={class:"assistant-message"},Jm=he({__name:"AssistantMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(n,{emit:e}){const s=n,t=e,a=()=>{t("copy",s.message.id)},l=()=>{t("regenerate",s.message.id)},i=()=>{t("retry",s.message.id)},p=(d,h)=>{console.log("[AssistantMessage] User input submitted:",h,"for message:",d.id)},b=d=>{console.log("[AssistantMessage] Step selected:",d),t("step-selected",d)};return(d,h)=>{var k,C,U,_;return u(),v("div",zm,[d.message.thinkingDetails?(u(),le(Qh,{key:0,"thinking-details":d.message.thinkingDetails,onStepSelected:b},null,8,["thinking-details"])):B("",!0),d.message.planExecution?(u(),le(Ms,{key:1,"plan-execution":d.message.planExecution,"step-actions":d.message.stepActions||[],"generic-input":d.message.genericInput||"",onStepSelected:b},null,8,["plan-execution","step-actions","generic-input"])):B("",!0),d.message.content||d.message.error||d.isStreaming||(C=(k=d.message.planExecution)==null?void 0:k.userInputWaitState)!=null&&C.waiting?(u(),le(Wm,os({key:2,content:d.message.content||"","is-streaming":d.isStreaming||!1},{...d.message.error?{error:d.message.error}:{},...(U=d.message.planExecution)!=null&&U.userInputWaitState?{userInputWaitState:d.message.planExecution.userInputWaitState}:{},...(_=d.message.planExecution)!=null&&_.currentPlanId?{planId:d.message.planExecution.currentPlanId}:{}},{timestamp:d.message.timestamp,"generic-input":d.message.genericInput||"",onCopy:a,onRegenerate:l,onRetry:i,onUserInputSubmitted:h[0]||(h[0]=y=>p(d.message,y))}),null,16,["content","is-streaming","timestamp","generic-input"])):B("",!0)])}}}),Gm=me(Jm,[["__scopeId","data-v-3810c279"]]),Km=he({__name:"ChatMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(n,{emit:e}){const s=n,t=e,{getMessageClasses:a}=Nt(),l=pe(()=>a(s.message)),i=h=>{t("copy",h)},p=h=>{t("regenerate",h)},b=h=>{t("retry",h)},d=h=>{t("step-selected",h)};return(h,k)=>(u(),v("div",{class:ae(["chat-message",l.value])},[h.message.type==="user"?(u(),le(vp,{key:0,message:h.message},null,8,["message"])):h.message.type==="assistant"?(u(),le(Gm,{key:1,message:h.message,"is-streaming":h.isStreaming||!1,onCopy:i,onRegenerate:p,onRetry:b,onStepSelected:d},null,8,["message","is-streaming"])):B("",!0)],2))}}),Xm=me(Km,[["__scopeId","data-v-218b3735"]]);function At(n){const e={...n};return"agentExecutionSequence"in n&&Array.isArray(n.agentExecutionSequence)&&(e.agentExecutionSequence=n.agentExecutionSequence.map(s=>Ym(s))),e}function Ym(n){const e={...n};return"subPlanExecutionRecords"in n&&Array.isArray(n.subPlanExecutionRecords)&&(e.subPlanExecutionRecords=n.subPlanExecutionRecords.map(s=>At(s))),e}function Qm(n){const e={...n};return"thinkingDetails"in n&&n.thinkingDetails&&(e.thinkingDetails=At(n.thinkingDetails)),"planExecution"in n&&n.planExecution&&(e.planExecution=At(n.planExecution)),"attachments"in n&&Array.isArray(n.attachments)&&(e.attachments=[...n.attachments]),e}function Zm(){const n=F([]),e=F(!1),s=F(null),t=F(null),a=pe(()=>n.value.length>0?n.value[n.value.length-1]:null),l=pe(()=>s.value!==null),i=pe(()=>n.value.length>0),p=(P,f,j)=>{const x={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:P,content:f,timestamp:new Date,isStreaming:!1,...j};return n.value.push(x),x},b=(P,f)=>{const j=n.value.findIndex(x=>x.id===P);j!==-1&&(n.value[j]={...n.value[j],...f})},d=P=>{const f=n.value.findIndex(j=>j.id===P);f!==-1&&n.value.splice(f,1)},h=()=>{n.value=[],s.value=null,t.value=null},k=P=>{s.value=P,b(P,{isStreaming:!0})},C=P=>{P&&b(P,{isStreaming:!1}),s.value===P&&(s.value=null)},U=P=>{t.value=P},_=(P,f,j="content")=>{const x=n.value.find(se=>se.id===P);x&&typeof x[j]=="string"&&b(P,{[j]:x[j]+f})},y=(P,f)=>{b(P,{thinkingDetails:f})},m=(P,f)=>{b(P,{thinking:f})},g=(P,f)=>{b(P,{planExecution:f})},w=P=>n.value.find(f=>f.id===P),$=P=>n.value.findIndex(f=>f.id===P);return{messages:Qe(n),isLoading:e,streamingMessageId:Qe(s),activeMessageId:Qe(t),lastMessage:a,isStreaming:l,hasMessages:i,addMessage:p,updateMessage:b,removeMessage:d,clearMessages:h,startStreaming:k,stopStreaming:C,setActiveMessage:U,appendToMessage:_,updateMessageThinking:m,updateMessageThinkingDetails:y,updateMessagePlanExecution:g,findMessage:w,getMessageIndex:$}}function ef(n){const e=F(!1),s=F(!0),t=150,a=async(m=!0)=>{n.value&&(await Te(),n.value.scrollTo({top:n.value.scrollHeight,behavior:m?"smooth":"auto"}))},l=()=>{if(!n.value)return!1;const{scrollTop:m,scrollHeight:g,clientHeight:w}=n.value;return g-m-w<t},i=()=>{if(!n.value)return;const m=l();e.value=!m&&n.value.scrollHeight>n.value.clientHeight,m&&(s.value=!0)},p=()=>{i(),l()||(s.value=!1)},b=async()=>{s.value&&await a()},d=async()=>{s.value=!0,await a()},h=(m,g=!0)=>{if(!n.value)return;const w=n.value.querySelector(`[data-message-id="${m}"]`);w&&w.scrollIntoView({behavior:g?"smooth":"auto",block:"center"})},k=()=>{if(!n.value)return{scrollTop:0,scrollHeight:0,clientHeight:0,isAtTop:!0,isAtBottom:!0,scrollPercentage:0};const{scrollTop:m,scrollHeight:g,clientHeight:w}=n.value,$=m===0,P=m+w>=g-5,f=g>w?m/(g-w)*100:100;return{scrollTop:m,scrollHeight:g,clientHeight:w,isAtTop:$,isAtBottom:P,scrollPercentage:f}},C=()=>{n.value&&n.value.addEventListener("scroll",p,{passive:!0})},U=()=>{n.value&&n.value.removeEventListener("scroll",p)},_=()=>{C(),i()},y=()=>{U()};return ke(()=>{Te(()=>{_()})}),Se(()=>{y()}),{showScrollToBottom:Qe(e),isAutoScrollEnabled:Qe(s),scrollToBottom:a,autoScrollToBottom:b,forceScrollToBottom:d,scrollToMessage:h,isNearBottom:l,checkScrollPosition:i,getScrollInfo:k,addScrollListener:C,removeScrollListener:U,initializeScrollBehavior:_,cleanupScrollBehavior:y}}class Ot{static async sendMessage(e){return Bt.withLlmCheck(async()=>{const s={...e,isVueRequest:!0},t=await fetch(`${this.BASE_URL}/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!t.ok)throw new Error(`API request failed: ${t.status}`);return await t.json()})}static async sendMessageWithDefaultPlan(e){return Bt.withLlmCheck(async()=>{const s="default-plan-id-001000222",t={userRequirement:e.input},a={toolName:s,replacementParams:t,isVueRequest:!0};e.uploadedFiles&&e.uploadedFiles.length>0&&(a.uploadedFiles=e.uploadedFiles,console.log("[DirectApiService] Including uploaded files:",e.uploadedFiles.length)),e.uploadKey&&(a.uploadKey=e.uploadKey,console.log("[DirectApiService] Including uploadKey:",e.uploadKey)),console.log("[DirectApiService] Sending message with default plan:",a);const l=await fetch(`${this.BASE_URL}/executeByToolNameAsync`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!l.ok)throw new Error(`API request failed: ${l.status}`);return await l.json()})}}be(Ot,"BASE_URL","/api/executor");const tf=Object.freeze(Object.defineProperty({__proto__:null,DirectApiService:Ot},Symbol.toStringTag,{value:"Module"})),Oe=class Oe{constructor(){be(this,"POLL_INTERVAL",5e3);be(this,"state",tt({activePlanId:null,lastSequenceSize:0,isPolling:!1,pollTimer:null}));be(this,"callbacks",{});be(this,"planExecutionCache",new Map);be(this,"uiStateCache",new Map);console.log("[PlanExecutionManager] Initialized with callback-based event system")}getCachedPlanRecord(e){return this.planExecutionCache.get(e)}getCachedUIState(e){return this.uiStateCache.get(e)}setCachedUIState(e,s){this.uiStateCache.set(e,s),console.log(`[PlanExecutionManager] Cached UI state for rootPlanId: ${e}`)}getAllCachedRecords(){return new Map(this.planExecutionCache)}hasCachedPlanRecord(e){return this.planExecutionCache.has(e)}setCachedPlanRecord(e,s){this.planExecutionCache.set(e,s),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${e}`)}clearCachedPlanRecord(e){const s=this.planExecutionCache.delete(e);return s&&console.log(`[PlanExecutionManager] Cleared cached plan execution record for rootPlanId: ${e}`),s}clearAllCachedRecords(){const e=this.planExecutionCache.size,s=this.uiStateCache.size;this.planExecutionCache.clear(),this.uiStateCache.clear(),console.log(`[PlanExecutionManager] Cleared all caches - Plans: ${e}, UI States: ${s}`)}static getInstance(){return Oe.instance||(Oe.instance=new Oe),Oe.instance}getActivePlanId(){return this.state.activePlanId}getState(){return this.state}setEventCallbacks(e){this.callbacks={...this.callbacks,...e},console.log("[PlanExecutionManager] Event callbacks set:",Object.keys(e))}async handleUserMessageSendRequested(e){if(this.validateAndPrepareUIForNewRequest(e))try{if(await this.sendUserMessageAndSetPlanId(e),this.state.activePlanId)this.initiatePlanExecutionSequence(e,this.state.activePlanId);else throw new Error("Failed to get valid plan ID")}catch(s){console.error("[PlanExecutionManager] Failed to send user message:",s);const t=this.state.activePlanId??"error";this.setCachedUIState(t,{enabled:!0}),this.emitChatInputUpdateState(t),this.state.activePlanId=null}}handlePlanExecutionRequested(e,s){console.log("[PlanExecutionManager] Received plan execution request:",{planId:e,query:s}),e?(this.state.activePlanId=e,this.initiatePlanExecutionSequence(s??"Execute Plan",e)):console.error("[PlanExecutionManager] Invalid plan execution request: missing planId")}handleCachedPlanExecution(e,s){const t=this.getCachedPlanRecord(e);return t!=null&&t.currentPlanId?(console.log(`[PlanExecutionManager] Found cached plan execution record for rootPlanId: ${e}`),this.handlePlanExecutionRequested(t.currentPlanId,s),!0):(console.log(`[PlanExecutionManager] No cached plan execution record found for rootPlanId: ${e}`),!1)}validateAndPrepareUIForNewRequest(e){if(!e)return console.warn("[PlanExecutionManager] Query is empty"),!1;if(this.state.activePlanId)return!1;this.emitChatInputClear();const s=this.state.activePlanId??"ui-state";return this.setCachedUIState(s,{enabled:!1,placeholder:"Processing..."}),this.emitChatInputUpdateState(s),!0}async sendUserMessageAndSetPlanId(e){try{const s=await Ot.sendMessage({input:e});if(s!=null&&s.planId)return this.state.activePlanId=s.planId,s;if(s!=null&&s.planTemplateId)return this.state.activePlanId=s.planTemplateId,{...s,planId:s.planTemplateId};throw console.error("[PlanExecutionManager] Failed to get planId from response:",s),new Error("Failed to get valid planId from API response")}catch(s){throw console.error("[PlanExecutionManager] API call failed:",s),s}}initiatePlanExecutionSequence(e,s){console.log(`[PlanExecutionManager] Starting plan execution sequence for query: "${e}", planId: ${s}`);const t=s;this.emitDialogRoundStart(t),this.startPolling()}handlePlanCompletion(e){this.emitPlanCompleted(e.rootPlanId??""),this.state.lastSequenceSize=0,this.stopPolling();try{setTimeout(async()=>{if(this.state.activePlanId)try{await Ze.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(s){console.log(`Delete plan execution record failed: ${s.message}`)}},5e3)}catch(s){console.log(`Delete plan execution record failed: ${s.message}`)}e.completed&&(this.state.activePlanId=null,this.emitChatInputUpdateState(e.rootPlanId??""))}handlePlanError(e){this.emitPlanError(e.message??""),this.state.lastSequenceSize=0,this.stopPolling();try{setTimeout(async()=>{if(this.state.activePlanId)try{await Ze.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(s){console.log(`Delete plan execution record failed: ${s.message}`)}},5e3)}catch(s){console.log(`Delete plan execution record failed: ${s.message}`)}}async pollPlanStatus(){if(this.state.activePlanId){if(this.state.isPolling){console.log("[PlanExecutionManager] Previous polling still in progress, skipping");return}try{this.state.isPolling=!0;const e=await this.getPlanDetails(this.state.activePlanId);if(!e){console.warn("[PlanExecutionManager] No details received from API - this might be a temporary network issue");return}if(e.status&&e.status==="failed"&&e.message&&!e.message.includes("Failed to get detailed information")){this.handlePlanError(e);return}e.rootPlanId&&this.setCachedPlanRecord(e.rootPlanId,e),this.emitPlanUpdate(e.rootPlanId??""),e.completed&&this.handlePlanCompletion(e)}catch(e){console.error("[PlanExecutionManager] Failed to poll plan status:",e)}finally{this.state.isPolling=!1}}}async getPlanDetails(e){try{const s=await _t.getDetails(e);return s!=null&&s.rootPlanId&&(this.planExecutionCache.set(s.rootPlanId,s),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${s.rootPlanId}`)),s}catch(s){return console.error("[PlanExecutionManager] Failed to get plan details:",s),{currentPlanId:e,status:"failed",message:s instanceof Error?s.message:"Failed to get plan"}}}startPolling(){this.state.pollTimer&&clearInterval(this.state.pollTimer),this.state.pollTimer=window.setInterval(()=>{this.pollPlanStatus()},this.POLL_INTERVAL),console.log("[PlanExecutionManager] Started polling")}async pollPlanStatusImmediately(){console.log("[PlanExecutionManager] Polling plan status immediately"),await this.pollPlanStatus()}stopPolling(){this.state.pollTimer&&(clearInterval(this.state.pollTimer),this.state.pollTimer=null),console.log("[PlanExecutionManager] Stopped polling")}cleanup(){this.stopPolling(),this.state.activePlanId=null,this.state.lastSequenceSize=0,this.state.isPolling=!1,this.clearAllCachedRecords()}emitChatInputClear(){this.callbacks.onChatInputClear&&this.callbacks.onChatInputClear()}emitChatInputUpdateState(e){this.callbacks.onChatInputUpdateState&&this.callbacks.onChatInputUpdateState(e)}emitDialogRoundStart(e){this.callbacks.onDialogRoundStart&&this.callbacks.onDialogRoundStart(e)}emitPlanUpdate(e){this.callbacks.onPlanUpdate&&this.callbacks.onPlanUpdate(e)}emitPlanCompleted(e){this.callbacks.onPlanCompleted&&this.callbacks.onPlanCompleted(e)}emitPlanError(e){this.callbacks.onPlanError&&this.callbacks.onPlanError(e)}};be(Oe,"instance",null);let xt=Oe;const De=xt.getInstance(),sf={class:"chat-container"},of={key:0,class:"loading-message"},nf={class:"loading-content"},af=["title"],lf=he({__name:"ChatContainer",props:{mode:{default:"plan"},initialPrompt:{default:""}},emits:["step-selected"],setup(n,{expose:e,emit:s}){const t=s,{t:a}=Ee(),{messages:l,isLoading:i,streamingMessageId:p,addMessage:b,updateMessage:d,startStreaming:h,stopStreaming:k,findMessage:C}=Zm(),U=F(null),{scrollToBottom:_,autoScrollToBottom:y,showScrollToBottom:m}=ef(U),g=F(),w=I=>p.value===I,$=pe(()=>l.value.map(Qm)),P=()=>{},f=I=>{const J=I.target;if(J.classList.contains("md-copy-btn")){const Y=J.getAttribute("data-raw");if(Y){const M=decodeURIComponent(Y);navigator.clipboard.writeText(M).then(()=>{J.textContent=a("chat.copied"),setTimeout(()=>{J.textContent=a("chat.copy")},1e3)})}}},j=async I=>{const J=C(I);if(J)try{const Y=J.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(Y)}catch(Y){console.error("Failed to copy message:",Y)}},x=I=>{const J=C(I);J&&J.type==="assistant"&&(d(I,{content:""}),h(I))},se=I=>{C(I)&&(d(I,{content:""}),h(I))},A=I=>{console.log("[ChatContainer] Step selected:",I),t("step-selected",I)},N=I=>{console.log("[ChatContainer] Plan update received:",I);const J=De.getCachedPlanRecord(I);if(!J){console.warn("[ChatContainer] No cached plan data found for rootPlanId:",I);return}console.log("[ChatContainer] Retrieved plan details from cache:",J);const Y=l.value.findIndex(M=>{var D;return((D=M.planExecution)==null?void 0:D.currentPlanId)===J.currentPlanId&&M.type==="assistant"});if(Y!==-1){const M=l.value[Y],D={planExecution:JSON.parse(JSON.stringify(J))};if(!J.agentExecutionSequence||J.agentExecutionSequence.length===0){if(console.log("[ChatContainer] Handling simple response without agent execution sequence"),J.completed){D.thinking="";const Q=J.summary??J.result??J.message??"Execution completed";D.content=Q,console.log("[ChatContainer] Set simple response content:",Q)}}else console.log("[ChatContainer] Handling detailed plan with agent execution sequence");d(M.id,D)}},W=I=>{if(console.log("[ChatContainer] Plan completed:",I),I.rootPlanId){const J=l.value.findIndex(Y=>{var M;return((M=Y.planExecution)==null?void 0:M.currentPlanId)===I.rootPlanId});if(J!==-1){const Y=l.value[J],M=I.summary??I.result??"Execution completed";d(Y.id,{thinking:"",content:M}),console.log("[ChatContainer] Updated completed message:",M)}}},Z=I=>{console.log("[ChatContainer] Dialog round start:",I)},T=I=>{console.log("[ChatContainer] Plan error:",I),b("assistant",`Error: ${I}`),console.error("[ChatContainer] Plan execution error:",I)};return ke(()=>{fe(l,()=>{Te(()=>{y()})},{deep:!0}),De.setEventCallbacks({onPlanUpdate:N,onPlanCompleted:W,onDialogRoundStart:Z,onPlanError:T})}),Se(()=>{g.value&&clearInterval(g.value)}),e({scrollToBottom:_,handlePlanUpdate:N,handlePlanCompleted:W,handleDialogRoundStart:Z,handlePlanError:T,addMessage:b,updateMessage:d,startStreaming:h,stopStreaming:k}),(I,J)=>(u(),v("div",sf,[o("div",{class:"messages",ref_key:"messagesRef",ref:U,onScroll:P,onClick:f},[(u(!0),v(re,null,ie($.value,Y=>(u(),le(Xm,{key:Y.id,message:Y,"is-streaming":w(Y.id),onCopy:j,onRegenerate:x,onRetry:se,onStepSelected:A},null,8,["message","is-streaming"]))),128)),r(i)?(u(),v("div",of,[o("div",nf,[S(r(E),{icon:"carbon:circle-dash",class:"loading-icon"}),o("span",null,c(I.$t("chat.processing")),1)])])):B("",!0)],544),S(Be,{name:"scroll-button"},{default:Me(()=>[r(m)?(u(),v("button",{key:0,class:"scroll-to-bottom",onClick:J[0]||(J[0]=()=>r(_)()),title:I.$t("chat.scrollToBottom")},[S(r(E),{icon:"carbon:chevron-down"})],8,af)):B("",!0)]),_:1})]))}}),rf=me(lf,[["__scopeId","data-v-e7a5d6c9"]]),cf={class:"input-area"},df={class:"input-container"},uf=["placeholder","disabled"],pf=["title"],hf=["disabled","title"],mf=he({__name:"InputArea",props:{placeholder:{default:""},disabled:{type:Boolean,default:!1},initialValue:{default:""}},emits:["send","clear","update-state","plan-mode-clicked"],setup(n,{expose:e,emit:s}){const{t}=Ee(),a=n,l=s,i=F(),p=F(),b=F(""),d=pe(()=>a.placeholder||t("input.placeholder")),h=F(d.value),k=F([]),C=F(null),U=()=>{var T;console.log("[FileUpload] Resetting session and clearing uploadKey"),(T=p.value)==null||T.resetSession()};Se(()=>{U()});const _=(T,I)=>{k.value=T.map(J=>J.originalName),C.value=I,console.log("[InputArea] Files uploaded:",T.length,"uploadKey:",I),k.value.length>0&&(h.value=t("input.filesAttached",{count:k.value.length}))},y=T=>{k.value=T.map(I=>I.originalName),console.log("[InputArea] Files removed, remaining:",T.length),k.value.length===0?h.value=d.value:h.value=t("input.filesAttached",{count:k.value.length})},m=T=>{C.value=T,console.log("[InputArea] Upload key changed:",T)},g=()=>{console.log("[InputArea] Upload started")},w=()=>{console.log("[InputArea] Upload completed")},$=T=>{console.error("[InputArea] Upload error:",T)},P=pe(()=>!!a.disabled),f=()=>{Te(()=>{i.value&&(i.value.style.height="auto",i.value.style.height=Math.min(i.value.scrollHeight,120)+"px")})},j=T=>{T.key==="Enter"&&!T.shiftKey&&(T.preventDefault(),x())},x=()=>{if(!b.value.trim()||P.value)return;const I={input:b.value.trim(),memoryId:Ue.selectMemoryId,uploadedFiles:k.value};C.value?(I.uploadKey=C.value,console.log("[InputArea] Including uploadKey in message:",C.value)):console.log("[InputArea] No uploadKey available for message"),l("send",I),A()},se=()=>{l("plan-mode-clicked")},A=()=>{b.value="",f(),l("clear")},N=(T,I)=>{I&&(h.value=T?I:t("input.waiting")),l("update-state",T,I)},W=T=>{b.value=T,f()},Z=()=>b.value.trim();return fe(()=>a.initialValue,T=>{T&&T.trim()&&(b.value=T,f())},{immediate:!0}),e({clearInput:A,updateState:N,setInputValue:W,getQuery:Z,resetSession:U,focus:()=>{var T;return(T=i.value)==null?void 0:T.focus()},get uploadedFiles(){var T,I;return((I=(T=p.value)==null?void 0:T.uploadedFiles)==null?void 0:I.map(J=>J.originalName))||[]},get uploadKey(){var T;return((T=p.value)==null?void 0:T.uploadKey)||null}}),ke(()=>{}),Se(()=>{}),(T,I)=>(u(),v("div",cf,[S(Ds,{ref_key:"fileUploadRef",ref:p,disabled:P.value,onFilesUploaded:_,onFilesRemoved:y,onUploadKeyChanged:m,onUploadStarted:g,onUploadCompleted:w,onUploadError:$},null,8,["disabled"]),o("div",df,[oe(o("textarea",{"onUpdate:modelValue":I[0]||(I[0]=J=>b.value=J),ref_key:"inputRef",ref:i,class:"chat-input",placeholder:h.value,disabled:P.value,onKeydown:j,onInput:f},null,40,uf),[[ce,b.value]]),o("button",{class:"plan-mode-btn",title:T.$t("input.planMode"),onClick:se},[S(r(E),{icon:"carbon:document"}),ne(" "+c(T.$t("input.planMode")),1)],8,pf),o("button",{class:"send-button",disabled:!b.value.trim()||P.value,onClick:x,title:T.$t("input.send")},[S(r(E),{icon:"carbon:send-alt"}),ne(" "+c(T.$t("input.send")),1)],8,hf)])]))}}),ff=me(mf,[["__scopeId","data-v-84fb4aeb"]]);class Ve{static async getAllCronTasks(){try{const e=await fetch(this.BASE_URL);return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get cron tasks:",e),e}}static async getCronTaskById(e){try{const s=await fetch(`${this.BASE_URL}/${e}`);return await(await this.handleResponse(s)).json()}catch(s){throw console.error("Failed to get cron task by id:",s),s}}static async createCronTask(e){try{const s=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await(await this.handleResponse(s)).json()}catch(s){throw console.error("Failed to create cron task:",s),s}}static async updateCronTask(e,s){try{const t=await fetch(`${this.BASE_URL}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to update cron task:",t),t}}static async updateTaskStatus(e,s){try{const t=await fetch(`${this.BASE_URL}/${e}/status?status=${s}`,{method:"PUT"});await this.handleResponse(t)}catch(t){throw console.error("Failed to update task status:",t),t}}static async deleteCronTask(e){try{const s=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE"});await this.handleResponse(s)}catch(s){throw console.error("Failed to delete cron task:",s),s}}static async handleResponse(e){if(!e.ok)try{const s=await e.json();throw new Error(s.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}}be(Ve,"BASE_URL","/api/cron-tasks");const He={validateCronExpression(n){const e=n.trim().split(/\s+/);return e.length>=5&&e.length<=6},formatTime(n){return new Date(n).toLocaleString()},async saveTask(n){try{let e;return n.id?e=await Ve.updateCronTask(Number(n.id),n):e=await Ve.createCronTask(n),e}catch(e){throw console.error("Failed to save cron task:",e),e}},async deleteTask(n){try{await Ve.deleteCronTask(String(n))}catch(e){throw console.error("Failed to delete cron task:",e),e}},async toggleTaskStatus(n){if(!n.id)throw new Error("Task ID is required");const e=n.status===0?1:0;return await Ve.updateCronTask(Number(n.id),{...n,status:e})},prepareTaskExecution(n){return n.planTemplateId?{useTemplate:!0,planData:{title:n.cronName||"Scheduled Task Execution",planData:{id:n.planTemplateId,planTemplateId:n.planTemplateId,planId:n.planTemplateId},params:n.executionParams||void 0}}:{useTemplate:!1,taskContent:n.planDesc||n.cronName||""}}},vf={class:"modal-header"},gf={class:"header-actions"},bf={class:"status-switch"},yf={class:"status-label"},_f={class:"toggle-switch"},$f=["checked"],wf={class:"modal-content"},Sf={class:"form-group"},kf={class:"form-label"},Tf=["placeholder"],Ef={class:"form-group"},Pf={class:"form-label"},Cf=["placeholder"],Rf={class:"form-help"},If={class:"form-group"},Af={class:"form-label"},xf=["placeholder"],Df={class:"form-group"},Ff={class:"form-label"},Mf={class:"template-toggle"},Uf={key:0,class:"template-selector"},Nf={value:""},Of=["value"],Lf={class:"form-help"},Bf={key:0,class:"form-group"},qf={class:"time-info"},jf={class:"time-label"},Vf={class:"time-value"},Hf={key:1,class:"form-group"},Wf={class:"time-info"},zf={class:"time-label"},Jf={class:"time-value"},Gf={class:"modal-footer"},Kf=["disabled"],Xf=he({__name:"TaskDetailModal",props:{modelValue:{type:Boolean},task:{}},emits:["update:modelValue","save"],setup(n,{emit:e}){const s=n,t=e,a=F(!1),l=F([]),i=F({cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""}),p=async()=>{try{const _=await Ze.getAllPlanTemplates();_&&_.templates&&(l.value=_.templates.map(y=>({id:y.id,name:y.title||"Unnamed Template"})))}catch(_){console.error("Failed to get template list:",_)}},b=_=>{_.key==="Escape"&&s.modelValue&&t("update:modelValue",!1)};ke(()=>{p(),document.addEventListener("keydown",b)}),Se(()=>{document.removeEventListener("keydown",b)});const d=_=>{_.target===_.currentTarget&&t("update:modelValue",!1)},h=()=>{i.value.linkTemplate=!1,i.value.templateId="",i.value.planTemplateId=""},k=()=>i.value.cronName.trim()?i.value.cronTime.trim()?He.validateCronExpression(i.value.cronTime)?i.value.planDesc.trim()?i.value.linkTemplate&&!i.value.templateId?(alert("Please select a plan template"),!1):!0:(alert("Task description cannot be empty"),!1):(alert("Invalid Cron expression format, should be 5-6 parts separated by spaces"),!1):(alert("Cron expression cannot be empty"),!1):(alert("Task name cannot be empty"),!1),C=_=>He.formatTime(_),U=async()=>{var _;if(k()){a.value=!0;try{const y={...i.value,...((_=s.task)==null?void 0:_.id)!==void 0&&{id:s.task.id},cronName:i.value.cronName.trim(),cronTime:i.value.cronTime.trim(),planDesc:i.value.planDesc.trim(),status:i.value.status,planTemplateId:i.value.linkTemplate&&i.value.templateId||""};t("save",y)}finally{a.value=!1}}};return fe(()=>s.task,_=>{if(_){const y=_.templateId||_.planTemplateId||"";i.value={cronName:_.cronName||"",cronTime:_.cronTime||"",planDesc:_.planDesc||"",status:_.status??1,linkTemplate:!!y,templateId:y,planTemplateId:y}}else i.value={cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""}},{immediate:!0}),fe(()=>s.modelValue,_=>{_||(i.value={cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""})}),(_,y)=>(u(),le(Ye,{to:"body"},[S(Be,{name:"modal"},{default:Me(()=>{var m,g,w;return[_.modelValue?(u(),v("div",{key:0,class:"modal-overlay",onClick:d},[o("div",{class:"modal-container",onClick:y[8]||(y[8]=ve(()=>{},["stop"]))},[o("div",vf,[o("h3",null,c(_.$t("cronTask.taskDetail")),1),o("div",gf,[o("div",bf,[o("span",yf,c(_.$t("cronTask.taskStatus")),1),o("label",_f,[o("input",{type:"checkbox",checked:i.value.status===0,onChange:y[0]||(y[0]=$=>i.value.status=i.value.status===0?1:0)},null,40,$f),y[9]||(y[9]=o("span",{class:"toggle-slider"},null,-1))])]),o("button",{class:"close-btn",onClick:y[1]||(y[1]=$=>_.$emit("update:modelValue",!1))},[S(r(E),{icon:"carbon:close"})])])]),o("div",wf,[o("form",{onSubmit:ve(U,["prevent"]),class:"task-form"},[o("div",Sf,[o("label",kf,c(_.$t("cronTask.taskName")),1),oe(o("input",{"onUpdate:modelValue":y[2]||(y[2]=$=>i.value.cronName=$),type:"text",class:"form-input",placeholder:_.$t("cronTask.taskNamePlaceholder"),required:""},null,8,Tf),[[ce,i.value.cronName]])]),o("div",Ef,[o("label",Pf,c(_.$t("cronTask.cronExpression")),1),oe(o("input",{"onUpdate:modelValue":y[3]||(y[3]=$=>i.value.cronTime=$),type:"text",class:"form-input",placeholder:_.$t("cronTask.cronExpressionPlaceholder"),required:""},null,8,Cf),[[ce,i.value.cronTime]]),o("div",Rf,c(_.$t("cronTask.cronExpressionHelp")),1)]),o("div",If,[o("label",Af,c(_.$t("cronTask.taskDescription")),1),oe(o("textarea",{"onUpdate:modelValue":y[4]||(y[4]=$=>i.value.planDesc=$),class:"form-textarea",placeholder:_.$t("cronTask.taskDescriptionPlaceholder"),rows:"4",required:""},null,8,xf),[[ce,i.value.planDesc]])]),o("div",Df,[o("label",Ff,c(_.$t("cronTask.planTemplate")),1),o("div",Mf,[o("button",{type:"button",class:ae(["template-btn",i.value.linkTemplate?"active":""]),onClick:y[5]||(y[5]=$=>i.value.linkTemplate=!0)},[S(r(E),{icon:"carbon:checkmark"}),ne(" "+c(_.$t("cronTask.linkTemplate")),1)],2),o("button",{type:"button",class:ae(["template-btn",i.value.linkTemplate?"":"active"]),onClick:h},[S(r(E),{icon:"carbon:close"}),ne(" "+c(_.$t("cronTask.noTemplate")),1)],2)]),i.value.linkTemplate?(u(),v("div",Uf,[oe(o("select",{"onUpdate:modelValue":y[6]||(y[6]=$=>i.value.templateId=$),class:"form-select"},[o("option",Nf,c(_.$t("cronTask.selectTemplate")),1),(u(!0),v(re,null,ie(l.value,$=>(u(),v("option",{key:$.id,value:$.id},c($.name),9,Of))),128))],512),[[pt,i.value.templateId]]),o("div",Lf,c(_.$t("cronTask.templateHelpText")),1)])):B("",!0)]),(m=_.task)!=null&&m.createTime?(u(),v("div",Bf,[o("div",qf,[o("span",jf,c(_.$t("cronTask.createTime"))+":",1),o("span",Vf,c(C(_.task.createTime)),1)])])):B("",!0),(g=_.task)!=null&&g.updateTime?(u(),v("div",Hf,[o("div",Wf,[o("span",zf,c(_.$t("cronTask.updateTime"))+":",1),o("span",Jf,c(C(_.task.updateTime)),1)])])):B("",!0)],32)]),o("div",Gf,[o("button",{type:"button",class:"cancel-btn",onClick:y[7]||(y[7]=$=>_.$emit("update:modelValue",!1))},c(_.$t("common.cancel")),1),o("button",{type:"button",class:"save-btn",onClick:U,disabled:a.value},[a.value?(u(),le(r(E),{key:0,icon:"carbon:loading",class:"loading-icon"})):B("",!0),ne(" "+c((w=s.task)!=null&&w.id?_.$t("common.save"):_.$t("common.create")),1)],8,Kf)])])])):B("",!0)]}),_:1})]))}}),Yf=me(Xf,[["__scopeId","data-v-45bbcf14"]]),Qf={class:"modal-header"},Zf={class:"header-actions"},ev={class:"modal-content"},tv={key:0,class:"loading-container"},sv={key:1,class:"empty-container"},ov={key:2,class:"task-list"},nv=["onClick"],av={class:"task-main"},lv={class:"task-info"},rv={class:"task-header"},iv={class:"task-name"},cv={class:"task-description"},dv={class:"task-time"},uv=["onClick"],pv=["onClick","disabled","title"],hv=["onClick","title"],mv={class:"dropdown-menu"},fv=["onClick"],vv=["onClick","disabled"],gv=["onClick","disabled"],bv={class:"confirm-header"},yv={class:"confirm-content"},_v={class:"confirm-actions"},$v=["disabled"],wv={class:"confirm-header"},Sv={class:"confirm-content"},kv={class:"create-options"},Tv={class:"option-content"},Ev={class:"option-title"},Pv={class:"option-desc"},Cv={class:"option-content"},Rv={class:"option-title"},Iv={class:"option-desc"},Av={class:"confirm-actions"},xv=he({__name:"CronTaskModal",props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue"],setup(n,{emit:e}){const s=ns(),t=as(),a=ls(),{t:l}=Ee(),i=n,p=e,b=F([]),d=F(!1),h=F(null),k=F(null),C=F(null),U=F(null),_=F(!1),y=F(null),m=F(!1),g=F(null),w=F(!1),$=L=>{L.target===L.currentTarget&&p("update:modelValue",!1)},P=async()=>{d.value=!0;try{b.value=await Ve.getAllCronTasks()}catch(L){console.error("Failed to load cron tasks:",L),a.error(`Failed to load tasks: ${L instanceof Error?L.message:String(L)}`)}finally{d.value=!1}},f=async L=>{h.value=L;try{const O=b.value.find(V=>V.id===L);if(!O){console.error("Task not found:",L);return}p("update:modelValue",!1);const ee=Date.now().toString();await s.push({name:"direct",params:{id:ee}}),await new Promise(V=>setTimeout(V,100));const q=He.prepareTaskExecution(O);q.useTemplate&&q.planData?t.emitPlanExecutionRequested(q.planData):q.taskContent&&t.setTask(q.taskContent)}catch(O){console.error("Failed to execute task:",O),a.error(`Execution failed: ${O instanceof Error?O.message:String(O)}`)}finally{h.value=null}},j=L=>{y.value={...L},_.value=!0,U.value=null},x=async L=>{try{await He.saveTask(L),await P(),_.value=!1,a.success("Task saved successfully")}catch(O){console.error("Failed to save task:",O),a.error(`Save failed: ${O instanceof Error?O.message:String(O)}`)}},se=L=>{g.value=L,m.value=!0},A=async()=>{var L;if((L=g.value)!=null&&L.id){k.value=g.value.id;try{await He.deleteTask(g.value.id),await P(),m.value=!1,g.value=null,a.success("Task deleted successfully")}catch(O){console.error("Failed to delete task:",O),a.error(`Delete failed: ${O instanceof Error?O.message:String(O)}`)}finally{k.value=null}}},N=()=>{m.value=!1,g.value=null},W=L=>{U.value=U.value===L?null:L},Z=async L=>{if(L.id){C.value=L.id;try{await He.toggleTaskStatus(L),await P(),U.value=null,a.success(`Task ${L.status===0?"disabled":"enabled"} successfully`)}catch(O){console.error("Failed to toggle task status:",O),a.error(`Status toggle failed: ${O instanceof Error?O.message:String(O)}`)}finally{C.value=null}}},T=async L=>{try{await navigator.clipboard.writeText(L),a.success("Cron expression copied successfully")}catch(O){a.error(`Copy failed: ${O instanceof Error?O.message:String(O)}`)}},I=()=>{w.value=!0},J=()=>{w.value=!1;try{p("update:modelValue",!1);const L=l("cronTask.template");t.setTaskToInput(L);const O=Date.now().toString();s.push({name:"direct",params:{id:O}})}catch(L){console.error("Error in createWithJmanus:",L),a.error(`Creation failed: ${L instanceof Error?L.message:String(L)}`)}},Y=()=>{w.value=!1,y.value={cronName:"",cronTime:"",planDesc:"",status:0,planTemplateId:""},_.value=!0},M=()=>{w.value=!1},D=L=>{const O=L.target;!O.closest(".action-dropdown")&&!O.closest(".dropdown-menu")&&(U.value=null)},Q=L=>{L.key==="Escape"&&(m.value?N():w.value?M():i.modelValue&&p("update:modelValue",!1))};return ke(()=>{document.addEventListener("click",D,!0),document.addEventListener("keydown",Q)}),Se(()=>{document.removeEventListener("click",D,!0),document.removeEventListener("keydown",Q)}),fe(()=>i.modelValue,L=>{L&&P()}),(L,O)=>(u(),v(re,null,[(u(),le(Ye,{to:"body"},[S(Be,{name:"modal"},{default:Me(()=>[n.modelValue?(u(),v("div",{key:0,class:"modal-overlay",onClick:$},[o("div",{class:"modal-container",onClick:O[3]||(O[3]=ve(()=>{},["stop"]))},[o("div",Qf,[o("h3",null,c(L.$t("cronTask.title")),1),o("div",Zf,[o("button",{class:"add-task-btn",onClick:[I,O[0]||(O[0]=ve(()=>{},["stop"]))]},[S(r(E),{icon:"carbon:add"}),ne(" "+c(L.$t("cronTask.addTask")),1)]),o("button",{class:"close-btn",onClick:O[1]||(O[1]=ee=>L.$emit("update:modelValue",!1))},[S(r(E),{icon:"carbon:close"})])])]),o("div",ev,[d.value?(u(),v("div",tv,[S(r(E),{icon:"carbon:loading",class:"loading-icon"}),o("span",null,c(L.$t("common.loading")),1)])):b.value.length===0?(u(),v("div",sv,[S(r(E),{icon:"carbon:time",class:"empty-icon"}),o("span",null,c(L.$t("cronTask.noTasks")),1)])):(u(),v("div",ov,[(u(!0),v(re,null,ie(b.value,ee=>(u(),v("div",{key:ee.id||"",class:"task-item",onClick:q=>j(ee)},[o("div",av,[o("div",lv,[o("div",rv,[o("div",iv,c(ee.cronName),1),o("div",{class:ae(["task-status-badge",ee.status===0?"active":"inactive"])},[S(r(E),{icon:ee.status===0?"carbon:checkmark-filled":"carbon:pause-filled"},null,8,["icon"]),o("span",null,c(ee.status===0?L.$t("cronTask.active"):L.$t("cronTask.inactive")),1)],2)]),o("div",cv,c(ee.planDesc),1),o("div",dv,[S(r(E),{icon:"carbon:time"}),o("span",{class:"cron-readable",style:{cursor:"pointer"},onClick:ve(q=>T(ee.cronTime),["stop"])},c(ee.cronTime),9,uv)])])]),o("div",{class:"task-actions",onClick:O[2]||(O[2]=ve(()=>{},["stop"]))},[o("button",{class:"action-btn execute-btn",onClick:q=>f(ee.id),disabled:h.value===ee.id,title:L.$t("cronTask.executeOnce")},[S(r(E),{icon:h.value===ee.id?"carbon:loading":"carbon:play-filled"},null,8,["icon"]),ne(" "+c(L.$t("cronTask.executeOnce")),1)],8,pv),o("div",{class:ae(["action-dropdown",{active:U.value===ee.id}])},[o("button",{class:"action-btn dropdown-btn",onClick:q=>W(ee.id),title:L.$t("cronTask.operations")},[S(r(E),{icon:"carbon:overflow-menu-horizontal"}),ne(" "+c(L.$t("cronTask.operations")),1)],8,hv),oe(o("div",mv,[o("button",{class:"dropdown-item edit-btn",onClick:q=>j(ee)},[S(r(E),{icon:"carbon:edit"}),ne(" "+c(L.$t("cronTask.edit")),1)],8,fv),o("button",{class:"dropdown-item toggle-btn",onClick:q=>Z(ee),disabled:C.value===ee.id},[S(r(E),{icon:C.value===ee.id?"carbon:loading":ee.status===0?"carbon:pause-filled":"carbon:play-filled"},null,8,["icon"]),ne(" "+c(ee.status===0?L.$t("cronTask.disable"):L.$t("cronTask.enable")),1)],8,vv),o("button",{class:"dropdown-item delete-btn",onClick:q=>se(ee),disabled:k.value===ee.id},[S(r(E),{icon:k.value===ee.id?"carbon:loading":"carbon:trash-can"},null,8,["icon"]),ne(" "+c(L.$t("cronTask.delete")),1)],8,gv)],512),[[ts,U.value===ee.id]])],2)])],8,nv))),128))]))])])])):B("",!0)]),_:1})])),S(Yf,{modelValue:_.value,"onUpdate:modelValue":O[4]||(O[4]=ee=>_.value=ee),task:y.value,onSave:x},null,8,["modelValue","task"]),(u(),le(Ye,{to:"body"},[S(Be,{name:"modal"},{default:Me(()=>{var ee,q,V,G;return[m.value?(u(),v("div",{key:0,class:"modal-overlay",onClick:N},[o("div",{class:"confirm-modal",onClick:O[5]||(O[5]=ve(()=>{},["stop"]))},[o("div",bv,[S(r(E),{icon:"carbon:warning",class:"warning-icon"}),o("h3",null,c(L.$t("cronTask.deleteConfirm")),1)]),o("div",yv,[o("p",null,c(L.$t("cronTask.deleteConfirmMessage",{taskName:((ee=g.value)==null?void 0:ee.cronName)||((q=g.value)==null?void 0:q.planDesc)||""})),1)]),o("div",_v,[o("button",{class:"confirm-btn cancel-btn",onClick:N},c(L.$t("common.cancel")),1),o("button",{class:"confirm-btn delete-btn",onClick:A,disabled:k.value===((V=g.value)==null?void 0:V.id)},[S(r(E),{icon:k.value===((G=g.value)==null?void 0:G.id)?"carbon:loading":"carbon:trash-can"},null,8,["icon"]),ne(" "+c(L.$t("cronTask.delete")),1)],8,$v)])])])):B("",!0)]}),_:1})])),(u(),le(Ye,{to:"body"},[S(Be,{name:"modal"},{default:Me(()=>[w.value?(u(),v("div",{key:0,class:"modal-overlay",onClick:M},[o("div",{class:"confirm-modal create-options-modal",onClick:O[6]||(O[6]=ve(()=>{},["stop"]))},[o("div",wv,[S(r(E),{icon:"carbon:time",class:"create-icon"}),o("h3",null,c(L.$t("cronTask.createTask")),1)]),o("div",Sv,[o("p",null,c(L.$t("cronTask.selectCreateMethod")),1),o("div",kv,[o("button",{class:"create-option-btn jmanus-btn",onClick:J},[S(r(E),{icon:"carbon:ai-status"}),o("div",Tv,[o("span",Ev,c(L.$t("cronTask.createWithJmanus")),1),o("span",Pv,c(L.$t("cronTask.createWithJmanusDesc")),1)])]),o("button",{class:"create-option-btn manual-btn",onClick:Y},[S(r(E),{icon:"carbon:edit"}),o("div",Cv,[o("span",Rv,c(L.$t("cronTask.createManually")),1),o("span",Iv,c(L.$t("cronTask.createManuallyDesc")),1)])])])]),o("div",Av,[o("button",{class:"confirm-btn cancel-btn",onClick:M},c(L.$t("common.cancel")),1)])])])):B("",!0)]),_:1})]))],64))}}),Dv=me(xv,[["__scopeId","data-v-a90a3961"]]),Fv={class:"direct-page"},Mv={class:"direct-chat"},Uv={class:"chat-header"},Nv={class:"header-actions"},Ov=["title"],Lv=["title"],Bv=["title"],qv=["title"],jv={class:"chat-content"},Vv=["title"],Hv={class:"message-content"},Wv=he({__name:"index",setup(n){const e=Bs(),s=ns(),t=as(),{t:a}=Ee(),{message:l}=Ws(),i=F(""),p=F(""),b=F(),d=F(),h=F(),k=F(),C=F(!1),U=F(!1),_=F(null),y=F(!1),m=F(50),g=F(!1),w=F(0),$=F(0),P=pe(()=>{if(z.isCollapsed)return m.value;let q=26;k.value&&k.value.sidebarWidth!==void 0&&(q=k.value.sidebarWidth);const V=100-q;return Math.max(20,Math.min(V,m.value))});ke(()=>{if(console.log("[Direct] onMounted called"),console.log("[Direct] taskStore.currentTask:",t.currentTask),console.log("[Direct] taskStore.hasUnprocessedTask():",t.hasUnprocessedTask()),De.setEventCallbacks({onPlanUpdate:V=>{console.log("[Direct] Plan update event received for rootPlanId:",V),A(V)&&(console.log("[Direct] Processing plan update for current rootPlanId:",V),d.value&&typeof d.value.handlePlanUpdate=="function"?(console.log("[Direct] Calling chatRef.handlePlanUpdate with rootPlanId:",V),d.value.handlePlanUpdate(V)):console.warn("[Direct] chatRef.handlePlanUpdate method not available"),b.value&&typeof b.value.updateDisplayedPlanProgress=="function"?(console.log("[Direct] Calling rightPanelRef.updateDisplayedPlanProgress with rootPlanId:",V),b.value.updateDisplayedPlanProgress(V)):console.warn("[Direct] rightPanelRef.updateDisplayedPlanProgress method not available"))},onPlanCompleted:V=>{if(console.log("[Direct] Plan completed event received for rootPlanId:",V),!!A(V)){if(console.log("[Direct] Processing plan completion for current rootPlanId:",V),d.value&&typeof d.value.handlePlanCompleted=="function"){const G=De.getCachedPlanRecord(V);G&&G.completed?G.summary&&G.summary.trim().length>0?(console.log("[Direct]  Plan details are valid and complete from polling cache, updating UI"),d.value.handlePlanCompleted(G)):(console.warn("[Direct]  Plan completed but summary is empty, still proceeding with available data"),d.value.handlePlanCompleted(G)):(console.warn("[Direct]  Plan details incomplete in cache, attempting API fallback"),_t.getDetails(V).then(de=>{console.log("[Direct]  Got fresh details from API:",de),de&&de.completed?(console.log("[Direct] Fresh details from API are valid, updating UI"),De.setCachedPlanRecord(V,de),d.value.handlePlanCompleted(de)):(console.warn("[Direct]  API details also incomplete, using best available data"),d.value.handlePlanCompleted(G??{planId:V}))}).catch(de=>{console.error("[Direct] API call failed (likely record deleted), using cached data:",de),d.value.handlePlanCompleted(G??{planId:V})}))}else console.warn("[Direct] chatRef.handlePlanCompleted method not available");_.value=null,console.log("[Direct] 🧹 Cleared currentRootPlanId after plan completion"),h.value&&typeof h.value.resetSession=="function"&&(console.log("[Direct] 🧹 Calling inputRef.resetSession to clear sessionPlanId"),h.value.resetSession())}},onDialogRoundStart:V=>{console.log("[Direct] Dialog round start event received for rootPlanId:",V),_.value=V,console.log("[Direct] Set currentRootPlanId to:",V),d.value&&typeof d.value.handleDialogRoundStart=="function"?(console.log("[Direct] Calling chatRef.handleDialogRoundStart with planId:",V),d.value.handleDialogRoundStart(V)):console.warn("[Direct] chatRef.handleDialogRoundStart method not available")},onChatInputClear:()=>{console.log("[Direct] Chat input clear event received"),Z()},onChatInputUpdateState:V=>{if(console.log("[Direct] Chat input update state event received for rootPlanId:",V),!A(V,!0))return;const G=De.getCachedUIState(V);G&&I(G.enabled,G.placeholder)},onPlanError:V=>{d.value.handlePlanError(V)}}),console.log("[Direct] Event callbacks registered to planExecutionManager"),z.loadPlanTemplateList(),t.hasUnprocessedTask()&&t.currentTask){const V=t.currentTask.prompt;console.log("[Direct] Found unprocessed task from store:",V),t.markTaskAsProcessed(),Te(async()=>{try{console.log("[Direct] Calling handleChatSendMessage with taskContent:",V),await N({input:V})}catch(G){console.warn("[Direct] handleChatSendMessage failed, falling back to prompt:",G),i.value=V}})}else{const V=t.getAndClearTaskToInput();V?(p.value=V,console.log("[Direct] Setting inputOnlyContent for input only:",p.value)):(i.value=e.query.prompt||"",console.log("[Direct] Received task from URL:",i.value),console.log("[Direct] No unprocessed task in store"))}const q=localStorage.getItem("directPanelWidth");q&&(m.value=parseFloat(q)),console.log("[Direct] Final prompt value:",i.value),p.value&&Te(()=>{h.value&&typeof h.value.setInputValue=="function"&&(h.value.setInputValue(p.value),console.log("[Direct] Set input value:",p.value),p.value="")}),window.addEventListener("plan-execution-requested",V=>{console.log("[DirectView] Received plan-execution-requested event:",V.detail),L(V.detail)})}),fe(()=>t.currentTask,q=>{if(console.log("[Direct] Watch taskStore.currentTask triggered, newTask:",q),q&&!q.processed){const V=q.prompt;t.markTaskAsProcessed(),console.log("[Direct] Received new task from store:",V),Te(async()=>{try{console.log("[Direct] Directly executing new task via handleChatSendMessage:",V),await N({input:V})}catch(G){console.warn("[Direct] handleChatSendMessage failed for new task:",G)}})}else console.log("[Direct] Task is null or already processed, ignoring")},{immediate:!1}),fe(()=>i.value,(q,V)=>{console.log("[Direct] prompt value changed from:",V,"to:",q)},{immediate:!1}),fe(()=>t.taskToInput,q=>{console.log("[Direct] Watch taskStore.taskToInput triggered, newTaskToInput:",q),q!=null&&q.trim()&&(console.log("[Direct] Setting input value from taskToInput:",q),Te(()=>{h.value&&typeof h.value.setInputValue=="function"&&(h.value.setInputValue(q.trim()),console.log("[Direct] Input value set from taskToInput watch:",q.trim()),t.getAndClearTaskToInput())}))},{immediate:!1}),Se(()=>{console.log("[Direct] onUnmounted called, cleaning up resources"),_.value=null,De.cleanup(),document.removeEventListener("mousemove",j),document.removeEventListener("mouseup",x),window.removeEventListener("plan-execution-requested",q=>{L(q.detail)})});const f=q=>{g.value=!0,w.value=q.clientX,$.value=m.value,document.addEventListener("mousemove",j),document.addEventListener("mouseup",x),document.body.style.cursor="col-resize",document.body.style.userSelect="none",q.preventDefault()},j=q=>{if(!g.value)return;const V=window.innerWidth,de=(q.clientX-w.value)/V*100;let H=$.value+de;H=Math.max(20,Math.min(80,H)),m.value=H},x=()=>{g.value=!1,document.removeEventListener("mousemove",j),document.removeEventListener("mouseup",x),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("directPanelWidth",m.value.toString())},se=()=>{m.value=50,localStorage.setItem("directPanelWidth","50")},A=(q,V=!1)=>!_.value||q===_.value||V&&(q==="ui-state"||q==="error")?!0:(console.log("[Direct] Ignoring event for non-current rootPlanId:",q,"current:",_.value),!1),N=async q=>{var G,de,H,X,K,_e,xe,Ge,Ke;let V=null;try{console.log("[DirectView] Processing send-message event:",q);const Re=(G=d.value)==null?void 0:G.addMessage("user",q.input);q.attachments&&Re&&((de=d.value)==null||de.updateMessage(Re.id,{attachments:q.attachments})),V=(H=d.value)==null?void 0:H.addMessage("assistant","",{thinking:a("chat.thinkingProcessing")}),V&&((X=d.value)==null||X.startStreaming(V.id));const{DirectApiService:nt}=await qs(async()=>{const{DirectApiService:Ie}=await Promise.resolve().then(()=>tf);return{DirectApiService:Ie}},void 0);console.log("[DirectView] Calling DirectApiService.sendMessageWithDefaultPlan");const ue=await nt.sendMessageWithDefaultPlan(q);console.log("[DirectView] API response received:",ue),ue.planId&&V?((K=d.value)==null||K.updateMessage(V.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:ue.planId,rootPlanId:ue.planId,status:"running"}}),_.value=ue.planId,console.log("[DirectView] Set currentRootPlanId to:",ue.planId),De.handlePlanExecutionRequested(ue.planId,q.input),console.log("[DirectView] Started polling for plan execution updates")):V&&((_e=d.value)==null||_e.updateMessage(V.id,{content:ue.message||ue.result||"No response received from backend"}),(xe=d.value)==null||xe.stopStreaming(V.id))}catch(Re){console.error("[DirectView] Send message failed:",Re),(Ge=d.value)==null||Ge.addMessage("assistant",`Error: ${(Re==null?void 0:Re.message)||"Failed to send message"}`),V&&((Ke=d.value)==null||Ke.stopStreaming(V.id))}},W=async q=>{console.log("[DirectView] Send message from input:",JSON.stringify(q)),await N(q)},Z=()=>{console.log("[DirectView] Input cleared"),h.value&&typeof h.value.clear=="function"&&h.value.clear()},T=()=>{console.log("[DirectView] Input focused")},I=(q,V)=>{console.log("[DirectView] Input state updated:",q,V),U.value=!q},J=q=>{console.log("[DirectView] Step selected:",q),b.value&&typeof b.value.handleStepSelected=="function"?(console.log("[DirectView] Forwarding step selection to right panel:",q),b.value.handleStepSelected(q)):console.warn("[DirectView] rightPanelRef.handleStepSelected method not available")},Y=(q,V,G,de)=>{console.log("[DirectView] Sub plan step selected:",{parentPlanId:q,subPlanId:V,stepIndex:G,subStepIndex:de}),b.value&&typeof b.value.handleSubPlanStepSelected=="function"?(console.log("[DirectView] Forwarding sub plan step selection to right panel:",{parentPlanId:q,subPlanId:V,stepIndex:G,subStepIndex:de}),b.value.handleSubPlanStepSelected(q,V,G,de)):console.warn("[DirectView] rightPanelRef.handleSubPlanStepSelected method not available")},M=()=>{console.log("[DirectView] Plan mode button clicked"),z.toggleSidebar(),console.log("[DirectView] Sidebar toggled, isCollapsed:",z.isCollapsed)},D=()=>{s.push("/home")},Q=()=>{s.push("/configs")},L=async q=>{var de,H,X,K,_e,xe,Ge,Ke,Re,nt;if(console.log("[DirectView] Plan execution requested:",q),C.value){console.log("[DirectView] Plan execution already in progress, ignoring request");return}C.value=!0;let V=!1,G=null;try{console.log("[DirectView] Adding messages for plan execution:",q.title),(de=d.value)==null||de.addMessage("user",q.title),V=!0,G=(H=d.value)==null?void 0:H.addMessage("assistant","",{thinking:a("chat.planningExecution")}),G&&((X=d.value)==null||X.startStreaming(G.id),console.log("[DirectView] Added assistant message for plan execution:",G.id))}catch(ue){console.warn("[DirectView] Failed to add messages:",ue)}try{const ue=(K=q.planData)==null?void 0:K.planTemplateId;if(!ue)throw new Error(a("direct.planTemplateIdNotFound"));console.log("[Direct] Executing plan with templateId:",ue,"params:",q.params),console.log("[Direct] About to call PlanActApiService.executePlan");const Ie=q.uploadedFiles||[],$t=q.uploadKey||void 0;console.log("[Direct] 🔍 DEBUG - InputArea uploadedFiles:",Ie),console.log("[Direct] 🔍 DEBUG - InputArea uploadKey:",$t),console.log("[Direct] Executing with uploaded files:",(Ie==null?void 0:Ie.length)??0),console.log("[Direct] Executing with replacement params:",q.replacementParams);let Pe;if((_e=q.params)!=null&&_e.trim()?(console.log("[Direct] Calling executePlan with rawParam:",q.params.trim()),Pe=await Ze.executePlan(ue,q.params.trim(),Ie,q.replacementParams,$t)):(console.log("[Direct] Calling executePlan without rawParam"),Pe=await Ze.executePlan(ue,void 0,Ie,q.replacementParams,$t)),console.log("[Direct] Plan execution API response:",Pe),Pe.planId&&G)console.log("[Direct] Got planId from response:",Pe.planId,"starting plan execution"),(xe=d.value)==null||xe.updateMessage(G.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:Pe.planId,rootPlanId:Pe.planId,status:"running"}}),_.value=Pe.planId,console.log("[Direct] Set currentRootPlanId to:",Pe.planId),console.log("[Direct] Delegating plan execution to planExecutionManager"),De.handlePlanExecutionRequested(Pe.planId,q.title);else throw console.error("[Direct] No planId in response:",Pe),new Error(a("direct.executionFailedNoPlanId"))}catch(ue){console.error("[Direct] Plan execution failed:",ue),console.error("[Direct] Error details:",{message:ue.message,stack:ue.stack}),_.value=null;try{console.log("[Direct] Adding error messages to chat"),V||(Ge=d.value)==null||Ge.addMessage("user",q.title),G?((Ke=d.value)==null||Ke.updateMessage(G.id,{content:`${a("direct.executionFailed")}: ${ue.message||a("common.unknownError")}`,thinking:void 0}),(Re=d.value)==null||Re.stopStreaming(G.id)):(nt=d.value)==null||nt.addMessage("assistant",`${a("direct.executionFailed")}: ${ue.message||a("common.unknownError")}`)}catch(Ie){console.error("[Direct] Failed to add error messages:",Ie),alert(`${a("direct.executionFailed")}: ${ue.message||a("common.unknownError")}`)}}finally{console.log("[Direct] Plan execution finished, resetting isExecutingPlan flag"),C.value=!1}},O=()=>{d.value.showMemory()},ee=()=>{Ue.clearMemoryId(),d.value.newChat()};return(q,V)=>(u(),v("div",Fv,[o("div",Mv,[S(lc,{ref_key:"sidebarRef",ref:k,onPlanExecutionRequested:L},null,512),o("div",{class:"left-panel",style:We({width:P.value+"%"})},[o("div",Uv,[o("button",{class:"back-button",onClick:D},[S(r(E),{icon:"carbon:arrow-left"})]),o("h2",null,c(q.$t("conversation")),1),o("div",Nv,[S(zs),o("button",{class:"config-button",onClick:ee,title:q.$t("memory.newChat")},[S(r(E),{icon:"carbon:add",width:"20"})],8,Ov),o("button",{class:"config-button",onClick:Q,title:q.$t("direct.configuration")},[S(r(E),{icon:"carbon:settings-adjust",width:"20"})],8,Lv),o("button",{class:"cron-task-btn",onClick:V[0]||(V[0]=G=>y.value=!0),title:q.$t("cronTask.title")},[S(r(E),{icon:"carbon:alarm",width:"20"})],8,Bv),o("button",{class:"cron-task-btn",onClick:V[1]||(V[1]=G=>r(Ue).toggleSidebar()),title:q.$t("memory.selectMemory")},[S(r(E),{icon:"carbon:calendar",width:"20"})],8,qv)])]),o("div",jv,[S(rf,{ref_key:"chatRef",ref:d,mode:"direct","initial-prompt":i.value||"",onStepSelected:J,onSubPlanStepSelected:Y},null,8,["initial-prompt"])]),(u(),le(ff,{key:q.$i18n.locale,ref_key:"inputRef",ref:h,disabled:U.value,placeholder:U.value?r(a)("input.waiting"):r(a)("input.placeholder"),"initial-value":i.value,onSend:W,onClear:Z,onFocus:T,onUpdateState:I,onPlanModeClicked:M},null,8,["disabled","placeholder","initial-value"]))],4),o("div",{class:"panel-resizer",onMousedown:f,onDblclick:se,title:q.$t("direct.panelResizeHint")},V[3]||(V[3]=[o("div",{class:"resizer-line"},null,-1)]),40,Vv),S(ap,{ref_key:"rightPanelRef",ref:b,style:We({width:100-m.value+"%"}),"current-root-plan-id":_.value},null,8,["style","current-root-plan-id"])]),S(Dv,{modelValue:y.value,"onUpdate:modelValue":V[2]||(V[2]=G=>y.value=G)},null,8,["modelValue"]),S(td,{onMemorySelected:O}),r(l).show?(u(),v("div",{key:0,class:ae(["message-toast",r(l).type])},[o("div",Hv,[o("span",null,c(r(l).text),1)])],2)):B("",!0)]))}}),gg=me(Wv,[["__scopeId","data-v-35690d5f"]]);export{gg as default};
