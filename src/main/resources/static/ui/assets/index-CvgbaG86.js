var Us=Object.defineProperty;var Ns=(n,e,t)=>e in n?Us(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var fe=(n,e,t)=>Ns(n,typeof e!="symbol"?e+"":e,t);import{d as ce,u as Se,c as le,r as N,B as tt,C as ie,o as $e,a as g,b as h,F as oe,g as k,f as q,p as Ee,h as ee,i as r,t as c,e as s,w as te,m as re,n as se,q as ae,D as kt,l as ne,E as st,G as Ls,j as he,A as ge,H as _e,I as es,z as qe,T as Ue,J as Qe,K as ts,v as Bs,M as ss,N as Ye,y as os,O as Os,_ as qs}from"./index-BG76GrHK.js";import{I as C,_ as de}from"./_plugin-vue_export-helper-DaEcP4m7.js";import{s as z,P as Ze,u as ns}from"./sidebar-D7pt5Rpz.js";import{M as as,u as ls,a as Vs}from"./useMessage-y8p1piER.js";import{L as Bt}from"./llm-check-BVkAKrj3.js";import{L as js}from"./LanguageSwitcher-BKAMWUKY.js";class Ae{static async getCoordinatorToolConfig(){try{const e=await fetch(`${this.BASE_URL}/config`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get coordinator tool config: ${e.status}`);return await e.json()}catch(e){return console.error("Failed to get CoordinatorTool configuration:",e),{enabled:!0,success:!1,message:e.message}}}static async getAllEndpoints(){try{const e=await fetch(`${this.BASE_URL}/endpoints`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get endpoints: ${e.status}`);return await e.json()}catch(e){throw console.error("Failed to get endpoints:",e),new Error("Failed to get endpoints: "+e.message)}}static async getCoordinatorToolsByTemplate(e){console.log("[CoordinatorToolApiService] Starting to get coordinator tool, planTemplateId:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/get-get-or-new-by-template/${e}`);try{const t=await fetch(`${this.BASE_URL}/get-or-new-by-template/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",t.status),console.log("[CoordinatorToolApiService] Response status text:",t.statusText),t.status===404)return console.log("[CoordinatorToolApiService] 404"),null;if(!t.ok){const a=await t.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to get coordinator tools: ${t.status} - ${a}`)}const o=await t.json();return console.log("[CoordinatorToolApiService] Successfully got coordinator tool, result:",o),o}catch(t){throw console.error("[CoordinatorToolApiService] Failed to get coordinator tool:",t),new Error("Failed to get coordinator tool: "+t.message)}}static async getOrNewCoordinatorToolsByTemplate(e){console.log("[CoordinatorToolApiService] Starting to get or create coordinator tool, planTemplateId:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/get-or-new-by-template/${e}`);try{const t=await fetch(`${this.BASE_URL}/get-or-new-by-template/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",t.status),console.log("[CoordinatorToolApiService] Response status text:",t.statusText),!t.ok){const a=await t.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to get coordinator tools: ${t.status} - ${a}`)}const o=await t.json();return console.log("[CoordinatorToolApiService] Successfully got coordinator tool, result:",o),o}catch(t){throw console.error("[CoordinatorToolApiService] Failed to get coordinator tool:",t),new Error("Failed to get coordinator tool: "+t.message)}}static async createCoordinatorTool(e){console.log("[CoordinatorToolApiService] Starting to create coordinator tool"),console.log("[CoordinatorToolApiService] Original data:",JSON.stringify(e,null,2)),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}`);const t={id:e.id,toolName:e.toolName,toolDescription:e.toolDescription,inputSchema:e.inputSchema,planTemplateId:e.planTemplateId,httpEndpoint:e.httpEndpoint,mcpEndpoint:e.mcpEndpoint,serviceGroup:e.serviceGroup,enableInternalToolcall:e.enableInternalToolcall,enableHttpService:e.enableHttpService,enableMcpService:e.enableMcpService};console.log("[CoordinatorToolApiService] Cleaned sending data:",JSON.stringify(t,null,2));try{const o=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(console.log("[CoordinatorToolApiService] Response status:",o.status),console.log("[CoordinatorToolApiService] Response status text:",o.statusText),!o.ok){let l="Unknown error";try{const i=await o.json();l=i.message||i.error||l}catch{l=await o.text()||l}throw console.error("[CoordinatorToolApiService] Response error content:",l),new Error(`Failed to create coordinator tool: ${o.status} - ${l}`)}const a=await o.json();return console.log("[CoordinatorToolApiService] Created successfully, result:",a),a}catch(o){throw console.error("[CoordinatorToolApiService] Failed to create coordinator tool:",o),new Error("Failed to create coordinator tool: "+o.message)}}static async updateCoordinatorTool(e,t){console.log("[CoordinatorToolApiService] Starting to update coordinator tool, ID:",e),console.log("[CoordinatorToolApiService] Sending data:",t),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/${e}`);const o={id:t.id,toolName:t.toolName,toolDescription:t.toolDescription,inputSchema:t.inputSchema,planTemplateId:t.planTemplateId,httpEndpoint:t.httpEndpoint,mcpEndpoint:t.mcpEndpoint,serviceGroup:t.serviceGroup,enableInternalToolcall:t.enableInternalToolcall,enableHttpService:t.enableHttpService,enableMcpService:t.enableMcpService};console.log("[CoordinatorToolApiService] Cleaned sending data:",o);try{const a=await fetch(`${this.BASE_URL}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(console.log("[CoordinatorToolApiService] Response status:",a.status),console.log("[CoordinatorToolApiService] Response status text:",a.statusText),!a.ok){let i="Unknown error";try{const u=await a.json();i=u.message||u.error||i}catch{i=await a.text()||i}throw console.error("[CoordinatorToolApiService] Response error content:",i),new Error(`Failed to update coordinator tool: ${a.status} - ${i}`)}const l=await a.json();return console.log("[CoordinatorToolApiService] Updated successfully, result:",l),l}catch(a){throw console.error("[CoordinatorToolApiService] Failed to update coordinator tool:",a),new Error("Failed to update coordinator tool: "+a.message)}}static async deleteCoordinatorTool(e){console.log("[CoordinatorToolApiService] Starting to delete coordinator tool, ID:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/${e}`);try{const t=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",t.status),console.log("[CoordinatorToolApiService] Response status text:",t.statusText),!t.ok){const a=await t.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to delete coordinator tool: ${t.status} - ${a}`)}const o=await t.json();return console.log("[CoordinatorToolApiService] Deleted successfully, result:",o),o}catch(t){throw console.error("[CoordinatorToolApiService] Failed to delete coordinator tool:",t),new Error("Failed to delete coordinator tool: "+t.message)}}}fe(Ae,"BASE_URL","/api/coordinator-tools");class Dt{static async getParameterRequirements(e){try{const t=await fetch(`${this.BASE_URL}/${e}/parameters`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to get parameter requirements: ${t.statusText}`);return await t.json()}catch(t){throw console.error("Error getting parameter requirements:",t),t}}}fe(Dt,"BASE_URL","/api/plan-template");const Hs={class:"modal-form wide-modal"},Gs={class:"form-section"},Ws={class:"form-item"},zs=["placeholder"],Js={class:"field-description"},Ks={class:"form-section"},Xs={class:"form-item"},Qs=["placeholder"],Ys={class:"field-description"},Zs={class:"form-section"},eo={class:"form-item"},to=["placeholder"],so={class:"field-description"},oo={class:"form-section"},no={class:"section-title"},ao={key:0,class:"params-help-text"},lo={class:"parameter-table"},ro=["onUpdate:modelValue","placeholder","readonly"],io=["onUpdate:modelValue","placeholder"],co={class:"form-section"},uo={class:"service-publish-options"},po={class:"internal-toolcall-publish-option"},ho={class:"checkbox-label"},mo={class:"checkbox-text"},fo={class:"checkbox-description"},vo={class:"http-publish-option"},go={class:"checkbox-label"},bo={class:"checkbox-text"},yo={class:"checkbox-description"},_o={class:"button-container"},$o=["disabled"],So=["disabled"],wo=ce({__name:"PublishServiceModal",props:{modelValue:{type:Boolean,default:!1},planTemplateId:{default:""},planTitle:{default:""},planDescription:{default:""}},emits:["update:modelValue","published"],setup(n,{expose:e,emit:t}){const{t:o}=Se(),a=n,l=t,i=le({get:()=>a.modelValue,set:A=>l("update:modelValue",A)}),u=N(""),f=N(""),d=N(!1),m=N(!1),b=N(null),F=N(!1),B=N(!1),S=N(!0),$=N({parameters:[],hasParameters:!1,requirements:""}),_=N(!1),p=tt({serviceName:"",userRequest:"",endpoint:"",serviceGroup:"",parameters:[]}),T=le(()=>{const A=b.value&&b.value.id;return o(A?"mcpService.updateService":"mcpService.createService")}),w=()=>{p.serviceName="",p.userRequest=a.planDescription||"",p.endpoint="",p.serviceGroup="",$.value.hasParameters||(p.parameters=[]),b.value=null,F.value=!1},R=async()=>{if(!a.planTemplateId){$.value={parameters:[],hasParameters:!1,requirements:""};return}_.value=!0;try{const A=await Dt.getParameterRequirements(a.planTemplateId);$.value=A,A.hasParameters&&(p.parameters=A.parameters.map(j=>({name:j,description:""})))}catch(A){console.error("[PublishModal] Failed to load parameter requirements:",A),A instanceof Error&&!A.message.includes("404")&&console.warn("[PublishModal] Parameter requirements not available yet, will retry later"),$.value={parameters:[],hasParameters:!1,requirements:""}}finally{_.value=!1}},v=(A,j)=>{j==="success"?(f.value=A,setTimeout(()=>{f.value=""},3e3)):j==="error"&&(u.value=A,setTimeout(()=>{u.value=""},5e3))},P=()=>{if(!p.serviceName||!p.serviceName.trim())return v(o("mcpService.toolNameRequiredError"),"error"),!1;if(!p.userRequest||!p.userRequest.trim())return v(o("mcpService.toolDescriptionRequiredError"),"error"),!1;if(!p.serviceGroup||!p.serviceGroup.trim())return v(o("mcpService.serviceGroupRequiredError"),"error"),!1;if(!S.value&&!B.value)return v("Please select at least one service type","error"),!1;for(let A=0;A<p.parameters.length;A++){const j=p.parameters[A];if(j.name&&!j.description.trim())return v(`Parameter "${j.name}" description cannot be empty`,"error"),!1;if(j.description&&!j.name.trim())return v(`Parameter description "${j.description}" corresponding name cannot be empty`,"error"),!1}return!0},U=async()=>{if(console.log("[PublishModal] Starting to handle publish request"),console.log("[PublishModal] Form data:",p),console.log("[PublishModal] Current tool:",b.value),console.log("[PublishModal] Publish as HTTP service:",B.value),!P()){console.log("[PublishModal] Form validation failed");return}d.value=!0;try{b.value||(console.log("[PublishModal] No current tool data, getting or creating first"),b.value=await Ae.getOrNewCoordinatorToolsByTemplate(a.planTemplateId)),console.log("[PublishModal] Updating tool information"),b.value.toolName=p.serviceName.trim(),b.value.toolDescription=p.userRequest.trim(),b.value.serviceGroup=p.serviceGroup.trim(),b.value.planTemplateId=a.planTemplateId,b.value.enableInternalToolcall=S.value,b.value.enableHttpService=B.value,b.value.enableMcpService=!1,b.value.mcpEndpoint=void 0;const A=p.parameters.filter(y=>y.name.trim()&&y.description.trim()).map(y=>({name:y.name.trim(),description:y.description.trim(),type:"string"}));if(b.value.inputSchema=JSON.stringify(A),console.log("[PublishModal] Updated tool information:",b.value),b.value.id)console.log("[PublishModal] Updating existing tool, ID:",b.value.id),await Ae.updateCoordinatorTool(b.value.id,b.value);else{console.log("[PublishModal] Creating new tool");const y=await Ae.createCoordinatorTool(b.value);b.value=y}const j=[];if(S.value&&j.push("Internal Method Call"),B.value&&j.push("HTTP Service"),j.length>0){console.log("[PublishModal] Step 5: Publishing service, ID:",b.value.id,"Enabled services:",j.join(", "));const y=[];S.value&&y.push(`Internal Call: ${p.serviceName}`),console.log("[PublishModal] Service published successfully"),v(o("mcpService.publishSuccess"),"success"),l("published",b.value)}else console.log("[PublishModal] Only saving tool, not publishing as any service"),v(o("mcpService.saveSuccess"),"success"),l("published",b.value)}catch(A){console.error("[PublishModal] Failed to publish service:",A),v(o("mcpService.publishFailed")+": "+A.message,"error")}finally{d.value=!1}},W=async()=>{if(!m.value&&confirm(o("mcpService.deleteConfirmMessage"))){if(!b.value||!b.value.id){v(o("mcpService.deleteFailed")+": "+o("mcpService.selectPlanTemplateFirst"),"error");return}m.value=!0;try{console.log("[PublishModal] Starting to delete MCP service, ID:",b.value.id);const A=await Ae.deleteCoordinatorTool(b.value.id);if(A.success)console.log("[PublishModal] Deleted successfully"),v(o("mcpService.deleteSuccess"),"success"),i.value=!1,l("published",null);else throw new Error(A.message)}catch(A){console.error("[PublishModal] Failed to delete MCP service:",A),v(o("mcpService.deleteFailed")+": "+A.message,"error")}finally{m.value=!1}}},E=async()=>{i.value&&(console.log("[PublishModal] Modal opened, starting to initialize data"),w(),await x())},x=async()=>{if(!a.planTemplateId){console.log("[PublishModal] "+o("mcpService.noPlanTemplateId"));return}try{console.log("[PublishModal] Starting to load coordinator tool data, planTemplateId:",a.planTemplateId);const A=await Ae.getOrNewCoordinatorToolsByTemplate(a.planTemplateId);console.log("[PublishModal] Get coordinator tool data result:",A),b.value=A,F.value=!!A.id;const j=[];if(A.enableMcpService&&A.mcpEndpoint){const y=window.location.origin;j.push(`MCP: ${y}/mcp${A.mcpEndpoint}`)}A.enableInternalToolcall&&j.push(`Internal Call: ${A.toolName}`),console.log("[PublishModal] Load tool data completed"),p.serviceName=A.toolName||"",p.userRequest=A.toolDescription||a.planDescription||"",p.serviceGroup=A.serviceGroup||"",B.value=A.enableHttpService||!1,S.value=A.enableInternalToolcall||!1;try{if(A.inputSchema){const y=JSON.parse(A.inputSchema);Array.isArray(y)&&y.length>0?(p.parameters=y.map(D=>({name:D.name||"",description:D.description||""})),console.log("[PublishModal] Load parameters from inputSchema:",p.parameters)):console.log("[PublishModal] inputSchema is empty, keeping existing parameters:",p.parameters)}}catch(y){console.warn("[PublishModal] "+o("mcpService.parseInputSchemaFailed")+":",y),console.log("[PublishModal] Parsing failed, keeping existing parameters:",p.parameters)}console.log("[PublishModal] Form data filled:",p)}catch(A){console.error("[PublishModal] "+o("mcpService.loadToolDataFailed")+":",A),v(o("mcpService.loadToolDataFailed")+": "+A.message,"error")}};return ie(()=>a.modelValue,E),ie(()=>a.planTemplateId,(A,j)=>{A&&A!==j&&(j&&A.startsWith("planTemplate-")?setTimeout(()=>{R()},1e3):R())}),$e(async()=>{i.value&&(console.log("[PublishModal] Initialize when component mounted"),w(),await x(),await R())}),e({loadParameterRequirements:R}),(A,j)=>(h(),g(oe,null,[k(as,{modelValue:i.value,"onUpdate:modelValue":j[5]||(j[5]=y=>i.value=y),title:T.value,onConfirm:U},{footer:Ee(()=>{var y;return[s("div",_o,[F.value&&((y=b.value)!=null&&y.id)?(h(),g("button",{key:0,class:"action-btn danger",onClick:W,disabled:m.value},[m.value?(h(),ne(r(C),{key:0,icon:"carbon:loading",class:"loading-icon"})):(h(),ne(r(C),{key:1,icon:"carbon:trash-can"})),ee(" "+c(m.value?r(o)("mcpService.deleting"):r(o)("mcpService.delete")),1)],8,$o)):q("",!0),s("button",{class:"action-btn primary",onClick:U,disabled:d.value},[d.value?(h(),ne(r(C),{key:0,icon:"carbon:loading",class:"loading-icon"})):(h(),ne(r(C),{key:1,icon:"carbon:cloud-upload"})),ee(" "+c(d.value?r(o)("mcpService.publishing"):r(o)("mcpService.publishAsService")),1)],8,So)])]}),default:Ee(()=>[s("div",Hs,[s("div",Gs,[s("div",Ws,[s("label",null,c(r(o)("mcpService.toolNameRequired")),1),te(s("input",{type:"text","onUpdate:modelValue":j[0]||(j[0]=y=>p.serviceName=y),placeholder:r(o)("mcpService.toolNamePlaceholder"),class:se({error:!p.serviceName||!p.serviceName.trim()}),required:""},null,10,zs),[[re,p.serviceName]]),s("div",Js,c(r(o)("mcpService.toolNameDescription")),1)])]),s("div",Ks,[s("div",Xs,[s("label",null,c(r(o)("mcpService.toolDescriptionRequired")),1),te(s("textarea",{"onUpdate:modelValue":j[1]||(j[1]=y=>p.userRequest=y),placeholder:r(o)("mcpService.toolDescriptionPlaceholder"),class:se([{error:!p.userRequest||!p.userRequest.trim()},"description-field"]),rows:"4",required:""},null,10,Qs),[[re,p.userRequest]]),s("div",Ys,c(r(o)("mcpService.toolDescriptionDescription")),1)])]),s("div",Zs,[s("div",eo,[s("label",null,c(r(o)("mcpService.serviceGroup")),1),te(s("input",{type:"text","onUpdate:modelValue":j[2]||(j[2]=y=>p.serviceGroup=y),placeholder:r(o)("mcpService.serviceGroupPlaceholder"),class:se({error:!p.serviceGroup||!p.serviceGroup.trim()}),required:""},null,10,to),[[re,p.serviceGroup]]),s("div",so,c(r(o)("mcpService.serviceGroupDescription")),1)])]),s("div",oo,[s("div",no,c(r(o)("mcpService.parameterConfig")),1),$.value.hasParameters?(h(),g("div",ao,c(r(o)("sidebar.parameterRequirementsHelp")),1)):q("",!0),s("div",lo,[s("table",null,[s("thead",null,[s("tr",null,[s("th",null,c(r(o)("mcpService.parameterName")),1),s("th",null,c(r(o)("mcpService.parameterDescription")),1)])]),s("tbody",null,[(h(!0),g(oe,null,ae(p.parameters,(y,D)=>(h(),g("tr",{key:D},[s("td",null,[te(s("input",{type:"text","onUpdate:modelValue":J=>y.name=J,placeholder:r(o)("mcpService.parameterName"),class:se(["parameter-input",{"readonly-input":$.value.hasParameters}]),readonly:$.value.hasParameters,required:""},null,10,ro),[[re,y.name]])]),s("td",null,[te(s("input",{type:"text","onUpdate:modelValue":J=>y.description=J,placeholder:r(o)("mcpService.parameterDescription"),class:"parameter-input",required:""},null,8,io),[[re,y.description]])])]))),128))])])])]),s("div",co,[s("div",uo,[s("div",po,[s("label",ho,[te(s("input",{type:"checkbox","onUpdate:modelValue":j[3]||(j[3]=y=>S.value=y),class:"checkbox-input"},null,512),[[kt,S.value]]),s("span",mo,c(r(o)("mcpService.publishAsInternalToolcall")),1)]),s("div",fo,c(r(o)("mcpService.publishAsInternalToolcallDescription")),1)]),s("div",vo,[s("label",go,[te(s("input",{type:"checkbox","onUpdate:modelValue":j[4]||(j[4]=y=>B.value=y),class:"checkbox-input"},null,512),[[kt,B.value]]),s("span",bo,c(r(o)("mcpService.publishAsHttpService")),1)]),s("div",yo,c(r(o)("mcpService.publishAsHttpServiceDescription")),1)])])])])]),_:1},8,["modelValue","title"]),u.value?(h(),g("div",{key:0,class:"error-toast",onClick:j[6]||(j[6]=y=>u.value="")},[k(r(C),{icon:"carbon:error"}),ee(" "+c(u.value),1)])):q("",!0),f.value?(h(),g("div",{key:1,class:"success-toast",onClick:j[7]||(j[7]=y=>f.value="")},[k(r(C),{icon:"carbon:checkmark"}),ee(" "+c(f.value),1)])):q("",!0)],64))}}),ko=de(wo,[["__scopeId","data-v-98b92f03"]]);function rs(n,e){const t=N(!1),o=tt({title:"",steps:[],directResponse:!1,planTemplateId:n.currentPlanTemplateId||"",planType:"dynamic_agent"}),a=_=>{try{if(!_){Object.assign(o,{title:"",steps:[],directResponse:!1,planTemplateId:n.currentPlanTemplateId||"",planType:"dynamic_agent"});return}const p=JSON.parse(_);o.title=p.title||"",o.directResponse=!1,o.planTemplateId=p.planTemplateId||n.currentPlanTemplateId||"",o.planType=p.planType||"dynamic_agent",o.steps=(p.steps||[]).map(T=>({stepRequirement:T.stepRequirement||"",agentName:T.agentName||"",modelName:T.modelName||null,selectedToolKeys:T.selectedToolKeys||[],terminateColumns:T.terminateColumns||""}))}catch(p){console.warn("Failed to parse JSON content:",p)}},l=()=>{try{const _={title:o.title,steps:o.steps.map(p=>({stepRequirement:p.stepRequirement,agentName:p.agentName,modelName:p.modelName||"",selectedToolKeys:p.selectedToolKeys,terminateColumns:p.terminateColumns})),directResponse:o.directResponse,planTemplateId:o.planTemplateId,planType:o.planType};return JSON.stringify(_,null,2)}catch(_){return console.error("Failed to convert visual data to JSON:",_),"{}"}},i=le(()=>l());return ie(()=>n.jsonContent,_=>{a(_)},{immediate:!0}),ie(o,()=>{const _=l();e("update:jsonContent",_)},{deep:!0}),ie(()=>n.currentPlanTemplateId,_=>{_&&(o.planTemplateId=_)}),{showJsonPreview:t,displayData:o,formattedJsonOutput:i,addStep:()=>{const _={stepRequirement:"",agentName:"ConfigurableDynaAgent",modelName:null,selectedToolKeys:[],terminateColumns:"",agentType:"",stepContent:""};o.steps.push(_)},removeStep:_=>{_>=0&&_<o.steps.length&&o.steps.splice(_,1)},moveStepUp:_=>{if(_>0){const p=o.steps.splice(_,1)[0];o.steps.splice(_-1,0,p)}},moveStepDown:_=>{if(_<o.steps.length-1){const p=o.steps.splice(_,1)[0];o.steps.splice(_+1,0,p)}},toggleJsonPreview:()=>{t.value=!t.value},closeJsonPreview:()=>{t.value=!1},handleRollback:()=>{e("rollback")},handleRestore:()=>{e("restore")},handleSave:()=>{e("save")}}}const To={class:"config-section"},Po={class:"section-header"},Co={class:"visual-editor"},Eo={class:"plan-basic-info"},Ro={class:"form-row"},Io={class:"form-label"},Ao=["placeholder"],xo={class:"steps-section"},Do={class:"steps-header"},Fo={class:"form-label"},Mo={class:"steps-container"},Uo={class:"step-header"},No={class:"step-number"},Lo={class:"step-actions"},Bo=["onClick","disabled","title"],Oo=["onClick","disabled","title"],qo=["onClick","title"],Vo={class:"step-content"},jo={class:"form-row"},Ho={class:"form-label"},Go={class:"agent-selector"},Wo=["onUpdate:modelValue"],zo={value:""},Jo=["title"],Ko={class:"form-row"},Xo={class:"form-label"},Qo=["onUpdate:modelValue","placeholder"],Yo={class:"form-row"},Zo={class:"form-label"},en=["onUpdate:modelValue","placeholder"],tn={key:0,class:"empty-steps"},sn={class:"plan-id-section"},on={class:"form-row"},nn={class:"form-label"},an={key:0,class:"json-preview"},ln={class:"preview-header"},rn={class:"form-label"},cn={class:"json-code"},dn={class:"editor-footer"},un={class:"section-actions"},pn=["disabled","title"],hn=["disabled","title"],mn=["disabled"],fn=ce({__name:"JsonEditor",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},hiddenFields:{default:()=>["currentPlanId","userRequest","rootPlanId"]},currentPlanTemplateId:{}},emits:["rollback","restore","save","update:jsonContent"],setup(n,{emit:e}){const t=n,o=e,{showJsonPreview:a,displayData:l,formattedJsonOutput:i,addStep:u,removeStep:f,moveStepUp:d,moveStepDown:m,handleRollback:b,handleRestore:F,handleSave:B,toggleJsonPreview:S,closeJsonPreview:$}=rs(t,o),_=p=>{const T=p.target;if(!T)return;T.style.height="auto";const w=20,R=Math.ceil(T.scrollHeight/w),v=4,P=12,U=Math.max(v,Math.min(P,R)),W=U*w;T.style.height=`${W}px`,T.rows=U,R>P?T.style.overflowY="auto":T.style.overflowY="hidden"};return(p,T)=>(h(),g("div",To,[s("div",Po,[k(r(C),{icon:"carbon:code",width:"16"}),s("span",null,c(p.$t("sidebar.jsonTemplate")),1)]),s("div",Co,[s("div",Eo,[s("div",Ro,[s("label",Io,c(p.$t("sidebar.title")),1),te(s("input",{"onUpdate:modelValue":T[0]||(T[0]=w=>r(l).title=w),type:"text",class:"form-input",placeholder:p.$t("sidebar.titlePlaceholder")},null,8,Ao),[[re,r(l).title]])])]),s("div",xo,[s("div",Do,[s("label",Fo,c(p.$t("sidebar.tasks")),1)]),s("div",Mo,[(h(!0),g(oe,null,ae(r(l).steps,(w,R)=>(h(),g("div",{key:R,class:"step-item"},[s("div",Uo,[s("span",No,c(p.$t("sidebar.subtask"))+" "+c(R+1),1),s("div",Lo,[s("button",{onClick:v=>r(d)(R),disabled:R===0,class:"btn btn-xs",title:p.$t("sidebar.moveUp")},[k(r(C),{icon:"carbon:chevron-up",width:"12"})],8,Bo),s("button",{onClick:v=>r(m)(R),disabled:R===r(l).steps.length-1,class:"btn btn-xs",title:p.$t("sidebar.moveDown")},[k(r(C),{icon:"carbon:chevron-down",width:"12"})],8,Oo),s("button",{onClick:v=>r(f)(R),class:"btn btn-xs btn-danger",title:p.$t("sidebar.removeStep")},[k(r(C),{icon:"carbon:trash-can",width:"12"})],8,qo)])]),s("div",Vo,[s("div",jo,[s("label",Ho,c(p.$t("sidebar.agent")),1),s("div",Go,[te(s("select",{"onUpdate:modelValue":v=>w.agentName=v,class:"form-select agent-select"},[s("option",zo,c(p.$t("sidebar.selectAgent")),1),T[10]||(T[10]=Ls('<option value="DEFAULT_AGENT" data-v-228d1ada>DEFAULT_AGENT</option><option value="BROWSER_AGENT" data-v-228d1ada>BROWSER_AGENT</option><option value="TEXT_FILE_AGENT" data-v-228d1ada>TEXT_FILE_AGENT</option><option value="JSX_GENERATOR_AGENT" data-v-228d1ada>JSX_GENERATOR_AGENT</option><option value="FILE_MANAGER_AGENT" data-v-228d1ada>FILE_MANAGER_AGENT</option>',5))],8,Wo),[[st,w.agentName]]),s("button",{onClick:T[1]||(T[1]=(...v)=>r(u)&&r(u)(...v)),class:"btn btn-sm btn-add-step",title:p.$t("sidebar.addStep")},[k(r(C),{icon:"carbon:add",width:"14"})],8,Jo)])]),s("div",Ko,[s("label",Xo,c(p.$t("sidebar.stepRequirement")),1),te(s("textarea",{"onUpdate:modelValue":v=>w.stepContent=v,class:"form-textarea auto-resize",placeholder:p.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:T[2]||(T[2]=v=>_(v))},null,40,Qo),[[re,w.stepContent]])]),s("div",Yo,[s("label",Zo,c(p.$t("sidebar.terminateColumns")),1),te(s("input",{"onUpdate:modelValue":v=>w.terminateColumns=v,type:"text",class:"form-input",placeholder:p.$t("sidebar.terminateColumnsPlaceholder")},null,8,en),[[re,w.terminateColumns]])])])]))),128)),r(l).steps.length===0?(h(),g("div",tn,[k(r(C),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),s("p",null,c(p.$t("sidebar.noSteps")),1),s("button",{onClick:T[3]||(T[3]=(...w)=>r(u)&&r(u)(...w)),class:"btn btn-primary"},[k(r(C),{icon:"carbon:add",width:"14"}),ee(" "+c(p.$t("sidebar.addFirstStep")),1)])])):q("",!0)])]),s("div",sn,[s("div",on,[s("label",nn,c(p.$t("sidebar.planId")),1),te(s("input",{"onUpdate:modelValue":T[4]||(T[4]=w=>r(l).planTemplateId=w),type:"text",class:"form-input",placeholder:"planTemplate-1756109892045"},null,512),[[re,r(l).planTemplateId]])])]),r(a)?(h(),g("div",an,[s("div",ln,[s("label",rn,c(p.$t("sidebar.jsonPreview")),1),s("button",{onClick:T[5]||(T[5]=(...w)=>r($)&&r($)(...w)),class:"btn btn-xs"},[k(r(C),{icon:"carbon:close",width:"12"})])]),s("pre",cn,c(r(i)),1)])):q("",!0),s("div",dn,[s("button",{onClick:T[6]||(T[6]=(...w)=>r(S)&&r(S)(...w)),class:"btn btn-sm btn-secondary"},[k(r(C),{icon:"carbon:code",width:"14"}),ee(" "+c(r(a)?p.$t("sidebar.hideJson"):p.$t("sidebar.showJson")),1)]),s("div",un,[s("button",{class:"btn btn-sm",onClick:T[7]||(T[7]=(...w)=>r(b)&&r(b)(...w)),disabled:!(p.canRollback??!1),title:p.$t("sidebar.rollback")},[k(r(C),{icon:"carbon:undo",width:"14"})],8,pn),s("button",{class:"btn btn-sm",onClick:T[8]||(T[8]=(...w)=>r(F)&&r(F)(...w)),disabled:!(p.canRestore??!1),title:p.$t("sidebar.restore")},[k(r(C),{icon:"carbon:redo",width:"14"})],8,hn),s("button",{class:"btn btn-primary",onClick:T[9]||(T[9]=(...w)=>r(B)&&r(B)(...w)),disabled:p.isGenerating||p.isExecuting},[k(r(C),{icon:"carbon:save",width:"14"}),T[11]||(T[11]=ee(" Save "))],8,mn)])])])]))}}),vn=de(fn,[["__scopeId","data-v-228d1ada"]]),gn={class:"tool-selection-content"},bn={class:"tool-controls"},yn={class:"search-container"},_n=["placeholder"],$n={class:"sort-container"},Sn={value:"group"},wn={value:"name"},kn={value:"enabled"},Tn={class:"tool-summary"},Pn={class:"summary-text"},Cn={key:0,class:"tool-groups"},En=["onClick"],Rn={class:"group-title-area"},In={class:"group-name"},An={class:"group-count"},xn={class:"group-enable-all"},Dn=["checked","onChange","data-group"],Fn={class:"enable-label"},Mn={class:"tool-info"},Un={class:"tool-selection-name"},Nn={key:0,class:"tool-selection-desc"},Ln={class:"tool-actions"},Bn=["checked","onChange"],On={key:1,class:"empty-state"},qn=ce({__name:"ToolSelectionModal",props:{modelValue:{type:Boolean},tools:{},selectedToolIds:{}},emits:["update:modelValue","confirm"],setup(n,{emit:e}){const t=n,o=e,a=le({get:()=>t.modelValue,set:P=>o("update:modelValue",P)}),l=N(""),i=N("group"),u=N(new Set),f=N([]),d=(P,U)=>{const W=document.querySelector(`input[data-group="${P}"]`);W&&(W.indeterminate=p(U))};ie(()=>t.selectedToolIds,P=>{f.value=[...P]},{immediate:!0});const m=le(()=>{let P=t.tools.filter(U=>U.key);if(P=P.filter(U=>U.selectable===!0),l.value){const U=l.value.toLowerCase();P=P.filter(W=>{var E;return W.name.toLowerCase().includes(U)||W.description.toLowerCase().includes(U)||(((E=W.serviceGroup)==null?void 0:E.toLowerCase().includes(U))??!1)})}switch(i.value){case"name":P=[...P].sort((U,W)=>U.name.localeCompare(W.name));break;case"enabled":P=[...P].sort((U,W)=>{const E=f.value.includes(U.key),x=f.value.includes(W.key);return E&&!x?-1:!E&&x?1:U.name.localeCompare(W.name)});break;case"group":default:P=[...P].sort((U,W)=>{const E=U.serviceGroup??"Ungrouped",x=W.serviceGroup??"Ungrouped";return E!==x?E.localeCompare(x):U.name.localeCompare(W.name)});break}return P}),b=le(()=>{const P=new Map;return m.value.forEach(U=>{const W=U.serviceGroup??"Ungrouped";P.has(W)||P.set(W,[]),P.get(W).push(U)}),new Map([...P.entries()].sort())}),F=le(()=>m.value.length);ie([f,b],()=>{ge(()=>{for(const[P,U]of b.value)d(P,U)})},{flush:"post",deep:!1});const B=P=>f.value.includes(P),S=(P,U)=>{U.stopPropagation();const E=U.target.checked;if(!P){console.error("toolKey is undefined, cannot proceed");return}E?f.value.includes(P)||(f.value=[...f.value,P]):f.value=f.value.filter(x=>x!==P)},$=P=>P.filter(U=>f.value.includes(U.key)),_=P=>P.length>0&&P.every(U=>f.value.includes(U.key)),p=P=>{const U=$(P).length;return U>0&&U<P.length},T=(P,U)=>{U.stopPropagation();const E=U.target.checked,x=P.map(A=>A.key);if(E){const A=[...f.value];x.forEach(j=>{A.includes(j)||A.push(j)}),f.value=A}else f.value=f.value.filter(A=>!x.includes(A))},w=P=>{u.value.has(P)?u.value.delete(P):u.value.add(P)},R=()=>{o("confirm",[...f.value]),o("update:modelValue",!1)},v=()=>{f.value=[...t.selectedToolIds],o("update:modelValue",!1)};return ie(a,P=>{if(P){u.value.clear();const U=Array.from(b.value.keys());U.length>1&&U.slice(1).forEach(W=>{u.value.add(W)})}}),(P,U)=>(h(),ne(as,{modelValue:a.value,"onUpdate:modelValue":[U[4]||(U[4]=W=>a.value=W),v],title:P.$t("toolSelection.title"),onConfirm:R},{default:Ee(()=>[s("div",gn,[s("div",bn,[s("div",yn,[te(s("input",{"onUpdate:modelValue":U[0]||(U[0]=W=>l.value=W),type:"text",class:"search-input",placeholder:P.$t("toolSelection.searchPlaceholder")},null,8,_n),[[re,l.value]])]),s("div",$n,[te(s("select",{"onUpdate:modelValue":U[1]||(U[1]=W=>i.value=W),class:"sort-select"},[s("option",Sn,c(P.$t("toolSelection.sortByGroup")),1),s("option",wn,c(P.$t("toolSelection.sortByName")),1),s("option",kn,c(P.$t("toolSelection.sortByStatus")),1)],512),[[st,i.value]])])]),s("div",Tn,[s("span",Pn,c(P.$t("toolSelection.summary",{groups:b.value.size,tools:F.value,selected:f.value.length})),1)]),b.value.size>0?(h(),g("div",Cn,[(h(!0),g(oe,null,ae(b.value,([W,E])=>(h(),g("div",{key:W,class:"tool-group"},[s("div",{class:se(["tool-group-header",{collapsed:u.value.has(W)}]),onClick:x=>w(W)},[s("div",Rn,[k(r(C),{icon:u.value.has(W)?"carbon:chevron-right":"carbon:chevron-down",class:"collapse-icon"},null,8,["icon"]),k(r(C),{icon:"carbon:folder",class:"group-icon"}),s("span",In,c(W),1),s("span",An," ("+c($(E).length)+"/"+c(E.length)+") ",1)]),s("div",{class:"group-actions",onClick:U[2]||(U[2]=he(()=>{},["stop"]))},[s("label",xn,[s("input",{type:"checkbox",class:"group-enable-checkbox",checked:_(E),onChange:x=>T(E,x),"data-group":W},null,40,Dn),s("span",Fn,c(P.$t("toolSelection.enableAll")),1)])])],10,En),s("div",{class:se(["tool-group-content",{collapsed:u.value.has(W)}])},[(h(!0),g(oe,null,ae(E,x=>(h(),g("div",{key:x.key,class:"tool-selection-item"},[s("div",Mn,[s("div",Un,c(x.name),1),x.description?(h(),g("div",Nn,c(x.description),1)):q("",!0)]),s("div",Ln,[s("label",{class:"tool-enable-switch",onClick:U[3]||(U[3]=he(()=>{},["stop"]))},[s("input",{type:"checkbox",class:"tool-enable-checkbox",checked:B(x.key),onChange:A=>S(x.key,A)},null,40,Bn),U[5]||(U[5]=s("span",{class:"tool-enable-slider"},null,-1))])])]))),128))],2)]))),128))])):(h(),g("div",On,[k(r(C),{icon:"carbon:tools",class:"empty-icon"}),s("p",null,c(P.$t("toolSelection.noToolsFound")),1)]))])]),_:1},8,["modelValue","title"]))}}),Vn=de(qn,[["__scopeId","data-v-96799074"]]),jn={class:"assigned-tools"},Hn={class:"section-header"},Gn={class:"tool-info"},Wn={class:"tool-name"},zn={class:"tool-desc"},Jn={key:0,class:"no-tools"},Kn=ce({__name:"AssignedTools",props:{title:{},selectedToolIds:{},availableTools:{},addButtonText:{default:"Add/Remove Tools"},emptyText:{default:"No tools assigned"},showAddButton:{type:Boolean,default:!0},useGridLayout:{type:Boolean,default:!1}},emits:["add-tools","tools-filtered"],setup(n,{emit:e}){const t=n,o=e,a=le(()=>t.selectedToolIds.filter(u=>t.availableTools.some(f=>f.key===u)));ie(a,u=>{u.length!==t.selectedToolIds.length&&o("tools-filtered",u)},{immediate:!0});const l=u=>{const f=t.availableTools.find(d=>d.key===u);return f?f.name:u},i=u=>{const f=t.availableTools.find(d=>d.key===u);return f?f.description:""};return(u,f)=>(h(),g("div",jn,[s("div",Hn,[s("span",null,c(u.title)+" ("+c(a.value.length)+")",1),u.showAddButton?(h(),g("button",{key:0,class:"action-btn small",onClick:f[0]||(f[0]=d=>u.$emit("add-tools"))},[k(r(C),{icon:"carbon:add"}),ee(" "+c(u.addButtonText),1)])):q("",!0)]),s("div",{class:se(["tools-grid",{"grid-layout":u.useGridLayout}])},[(h(!0),g(oe,null,ae(a.value,d=>(h(),g("div",{key:d,class:"tool-item assigned"},[s("div",Gn,[s("span",Wn,c(l(d)),1),s("span",zn,c(i(d)),1)])]))),128)),a.value.length===0?(h(),g("div",Jn,[k(r(C),{icon:"carbon:tool-box"}),s("span",null,c(u.emptyText),1)])):q("",!0)],2)]))}}),Xn=de(Kn,[["__scopeId","data-v-b5fd8074"]]);function is(n,e){return function(){return n.apply(e,arguments)}}const{toString:Qn}=Object.prototype,{getPrototypeOf:Ft}=Object,{iterator:pt,toStringTag:cs}=Symbol,ht=(n=>e=>{const t=Qn.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),ke=n=>(n=n.toLowerCase(),e=>ht(e)===n),mt=n=>e=>typeof e===n,{isArray:Ve}=Array,et=mt("undefined");function Yn(n){return n!==null&&!et(n)&&n.constructor!==null&&!et(n.constructor)&&be(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const ds=ke("ArrayBuffer");function Zn(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&ds(n.buffer),e}const ea=mt("string"),be=mt("function"),us=mt("number"),ft=n=>n!==null&&typeof n=="object",ta=n=>n===!0||n===!1,lt=n=>{if(ht(n)!=="object")return!1;const e=Ft(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(cs in n)&&!(pt in n)},sa=ke("Date"),oa=ke("File"),na=ke("Blob"),aa=ke("FileList"),la=n=>ft(n)&&be(n.pipe),ra=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||be(n.append)&&((e=ht(n))==="formdata"||e==="object"&&be(n.toString)&&n.toString()==="[object FormData]"))},ia=ke("URLSearchParams"),[ca,da,ua,pa]=["ReadableStream","Request","Response","Headers"].map(ke),ha=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ot(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let o,a;if(typeof n!="object"&&(n=[n]),Ve(n))for(o=0,a=n.length;o<a;o++)e.call(null,n[o],o,n);else{const l=t?Object.getOwnPropertyNames(n):Object.keys(n),i=l.length;let u;for(o=0;o<i;o++)u=l[o],e.call(null,n[u],u,n)}}function ps(n,e){e=e.toLowerCase();const t=Object.keys(n);let o=t.length,a;for(;o-- >0;)if(a=t[o],e===a.toLowerCase())return a;return null}const Me=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,hs=n=>!et(n)&&n!==Me;function Tt(){const{caseless:n}=hs(this)&&this||{},e={},t=(o,a)=>{const l=n&&ps(e,a)||a;lt(e[l])&&lt(o)?e[l]=Tt(e[l],o):lt(o)?e[l]=Tt({},o):Ve(o)?e[l]=o.slice():e[l]=o};for(let o=0,a=arguments.length;o<a;o++)arguments[o]&&ot(arguments[o],t);return e}const ma=(n,e,t,{allOwnKeys:o}={})=>(ot(e,(a,l)=>{t&&be(a)?n[l]=is(a,t):n[l]=a},{allOwnKeys:o}),n),fa=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),va=(n,e,t,o)=>{n.prototype=Object.create(e.prototype,o),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},ga=(n,e,t,o)=>{let a,l,i;const u={};if(e=e||{},n==null)return e;do{for(a=Object.getOwnPropertyNames(n),l=a.length;l-- >0;)i=a[l],(!o||o(i,n,e))&&!u[i]&&(e[i]=n[i],u[i]=!0);n=t!==!1&&Ft(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},ba=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const o=n.indexOf(e,t);return o!==-1&&o===t},ya=n=>{if(!n)return null;if(Ve(n))return n;let e=n.length;if(!us(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},_a=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&Ft(Uint8Array)),$a=(n,e)=>{const o=(n&&n[pt]).call(n);let a;for(;(a=o.next())&&!a.done;){const l=a.value;e.call(n,l[0],l[1])}},Sa=(n,e)=>{let t;const o=[];for(;(t=n.exec(e))!==null;)o.push(t);return o},wa=ke("HTMLFormElement"),ka=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,o,a){return o.toUpperCase()+a}),Ot=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),Ta=ke("RegExp"),ms=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),o={};ot(t,(a,l)=>{let i;(i=e(a,l,n))!==!1&&(o[l]=i||a)}),Object.defineProperties(n,o)},Pa=n=>{ms(n,(e,t)=>{if(be(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const o=n[t];if(be(o)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},Ca=(n,e)=>{const t={},o=a=>{a.forEach(l=>{t[l]=!0})};return Ve(n)?o(n):o(String(n).split(e)),t},Ea=()=>{},Ra=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e;function Ia(n){return!!(n&&be(n.append)&&n[cs]==="FormData"&&n[pt])}const Aa=n=>{const e=new Array(10),t=(o,a)=>{if(ft(o)){if(e.indexOf(o)>=0)return;if(!("toJSON"in o)){e[a]=o;const l=Ve(o)?[]:{};return ot(o,(i,u)=>{const f=t(i,a+1);!et(f)&&(l[u]=f)}),e[a]=void 0,l}}return o};return t(n,0)},xa=ke("AsyncFunction"),Da=n=>n&&(ft(n)||be(n))&&be(n.then)&&be(n.catch),fs=((n,e)=>n?setImmediate:e?((t,o)=>(Me.addEventListener("message",({source:a,data:l})=>{a===Me&&l===t&&o.length&&o.shift()()},!1),a=>{o.push(a),Me.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",be(Me.postMessage)),Fa=typeof queueMicrotask<"u"?queueMicrotask.bind(Me):typeof process<"u"&&process.nextTick||fs,Ma=n=>n!=null&&be(n[pt]),I={isArray:Ve,isArrayBuffer:ds,isBuffer:Yn,isFormData:ra,isArrayBufferView:Zn,isString:ea,isNumber:us,isBoolean:ta,isObject:ft,isPlainObject:lt,isReadableStream:ca,isRequest:da,isResponse:ua,isHeaders:pa,isUndefined:et,isDate:sa,isFile:oa,isBlob:na,isRegExp:Ta,isFunction:be,isStream:la,isURLSearchParams:ia,isTypedArray:_a,isFileList:aa,forEach:ot,merge:Tt,extend:ma,trim:ha,stripBOM:fa,inherits:va,toFlatObject:ga,kindOf:ht,kindOfTest:ke,endsWith:ba,toArray:ya,forEachEntry:$a,matchAll:Sa,isHTMLForm:wa,hasOwnProperty:Ot,hasOwnProp:Ot,reduceDescriptors:ms,freezeMethods:Pa,toObjectSet:Ca,toCamelCase:ka,noop:Ea,toFiniteNumber:Ra,findKey:ps,global:Me,isContextDefined:hs,isSpecCompliantForm:Ia,toJSONObject:Aa,isAsyncFn:xa,isThenable:Da,setImmediate:fs,asap:Fa,isIterable:Ma};function Z(n,e,t,o,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),o&&(this.request=o),a&&(this.response=a,this.status=a.status?a.status:null)}I.inherits(Z,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:I.toJSONObject(this.config),code:this.code,status:this.status}}});const vs=Z.prototype,gs={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{gs[n]={value:n}});Object.defineProperties(Z,gs);Object.defineProperty(vs,"isAxiosError",{value:!0});Z.from=(n,e,t,o,a,l)=>{const i=Object.create(vs);return I.toFlatObject(n,i,function(f){return f!==Error.prototype},u=>u!=="isAxiosError"),Z.call(i,n.message,e,t,o,a),i.cause=n,i.name=n.name,l&&Object.assign(i,l),i};const Ua=null;function Pt(n){return I.isPlainObject(n)||I.isArray(n)}function bs(n){return I.endsWith(n,"[]")?n.slice(0,-2):n}function qt(n,e,t){return n?n.concat(e).map(function(a,l){return a=bs(a),!t&&l?"["+a+"]":a}).join(t?".":""):e}function Na(n){return I.isArray(n)&&!n.some(Pt)}const La=I.toFlatObject(I,{},null,function(e){return/^is[A-Z]/.test(e)});function vt(n,e,t){if(!I.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=I.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function($,_){return!I.isUndefined(_[$])});const o=t.metaTokens,a=t.visitor||m,l=t.dots,i=t.indexes,f=(t.Blob||typeof Blob<"u"&&Blob)&&I.isSpecCompliantForm(e);if(!I.isFunction(a))throw new TypeError("visitor must be a function");function d(S){if(S===null)return"";if(I.isDate(S))return S.toISOString();if(!f&&I.isBlob(S))throw new Z("Blob is not supported. Use a Buffer instead.");return I.isArrayBuffer(S)||I.isTypedArray(S)?f&&typeof Blob=="function"?new Blob([S]):Buffer.from(S):S}function m(S,$,_){let p=S;if(S&&!_&&typeof S=="object"){if(I.endsWith($,"{}"))$=o?$:$.slice(0,-2),S=JSON.stringify(S);else if(I.isArray(S)&&Na(S)||(I.isFileList(S)||I.endsWith($,"[]"))&&(p=I.toArray(S)))return $=bs($),p.forEach(function(w,R){!(I.isUndefined(w)||w===null)&&e.append(i===!0?qt([$],R,l):i===null?$:$+"[]",d(w))}),!1}return Pt(S)?!0:(e.append(qt(_,$,l),d(S)),!1)}const b=[],F=Object.assign(La,{defaultVisitor:m,convertValue:d,isVisitable:Pt});function B(S,$){if(!I.isUndefined(S)){if(b.indexOf(S)!==-1)throw Error("Circular reference detected in "+$.join("."));b.push(S),I.forEach(S,function(p,T){(!(I.isUndefined(p)||p===null)&&a.call(e,p,I.isString(T)?T.trim():T,$,F))===!0&&B(p,$?$.concat(T):[T])}),b.pop()}}if(!I.isObject(n))throw new TypeError("data must be an object");return B(n),e}function Vt(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(o){return e[o]})}function Mt(n,e){this._pairs=[],n&&vt(n,this,e)}const ys=Mt.prototype;ys.append=function(e,t){this._pairs.push([e,t])};ys.toString=function(e){const t=e?function(o){return e.call(this,o,Vt)}:Vt;return this._pairs.map(function(a){return t(a[0])+"="+t(a[1])},"").join("&")};function Ba(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function _s(n,e,t){if(!e)return n;const o=t&&t.encode||Ba;I.isFunction(t)&&(t={serialize:t});const a=t&&t.serialize;let l;if(a?l=a(e,t):l=I.isURLSearchParams(e)?e.toString():new Mt(e,t).toString(o),l){const i=n.indexOf("#");i!==-1&&(n=n.slice(0,i)),n+=(n.indexOf("?")===-1?"?":"&")+l}return n}class jt{constructor(){this.handlers=[]}use(e,t,o){return this.handlers.push({fulfilled:e,rejected:t,synchronous:o?o.synchronous:!1,runWhen:o?o.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){I.forEach(this.handlers,function(o){o!==null&&e(o)})}}const $s={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Oa=typeof URLSearchParams<"u"?URLSearchParams:Mt,qa=typeof FormData<"u"?FormData:null,Va=typeof Blob<"u"?Blob:null,ja={isBrowser:!0,classes:{URLSearchParams:Oa,FormData:qa,Blob:Va},protocols:["http","https","file","blob","url","data"]},Ut=typeof window<"u"&&typeof document<"u",Ct=typeof navigator=="object"&&navigator||void 0,Ha=Ut&&(!Ct||["ReactNative","NativeScript","NS"].indexOf(Ct.product)<0),Ga=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Wa=Ut&&window.location.href||"http://localhost",za=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ut,hasStandardBrowserEnv:Ha,hasStandardBrowserWebWorkerEnv:Ga,navigator:Ct,origin:Wa},Symbol.toStringTag,{value:"Module"})),ve={...za,...ja};function Ja(n,e){return vt(n,new ve.classes.URLSearchParams,Object.assign({visitor:function(t,o,a,l){return ve.isNode&&I.isBuffer(t)?(this.append(o,t.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)}},e))}function Ka(n){return I.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Xa(n){const e={},t=Object.keys(n);let o;const a=t.length;let l;for(o=0;o<a;o++)l=t[o],e[l]=n[l];return e}function Ss(n){function e(t,o,a,l){let i=t[l++];if(i==="__proto__")return!0;const u=Number.isFinite(+i),f=l>=t.length;return i=!i&&I.isArray(a)?a.length:i,f?(I.hasOwnProp(a,i)?a[i]=[a[i],o]:a[i]=o,!u):((!a[i]||!I.isObject(a[i]))&&(a[i]=[]),e(t,o,a[i],l)&&I.isArray(a[i])&&(a[i]=Xa(a[i])),!u)}if(I.isFormData(n)&&I.isFunction(n.entries)){const t={};return I.forEachEntry(n,(o,a)=>{e(Ka(o),a,t,0)}),t}return null}function Qa(n,e,t){if(I.isString(n))try{return(e||JSON.parse)(n),I.trim(n)}catch(o){if(o.name!=="SyntaxError")throw o}return(t||JSON.stringify)(n)}const nt={transitional:$s,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const o=t.getContentType()||"",a=o.indexOf("application/json")>-1,l=I.isObject(e);if(l&&I.isHTMLForm(e)&&(e=new FormData(e)),I.isFormData(e))return a?JSON.stringify(Ss(e)):e;if(I.isArrayBuffer(e)||I.isBuffer(e)||I.isStream(e)||I.isFile(e)||I.isBlob(e)||I.isReadableStream(e))return e;if(I.isArrayBufferView(e))return e.buffer;if(I.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(l){if(o.indexOf("application/x-www-form-urlencoded")>-1)return Ja(e,this.formSerializer).toString();if((u=I.isFileList(e))||o.indexOf("multipart/form-data")>-1){const f=this.env&&this.env.FormData;return vt(u?{"files[]":e}:e,f&&new f,this.formSerializer)}}return l||a?(t.setContentType("application/json",!1),Qa(e)):e}],transformResponse:[function(e){const t=this.transitional||nt.transitional,o=t&&t.forcedJSONParsing,a=this.responseType==="json";if(I.isResponse(e)||I.isReadableStream(e))return e;if(e&&I.isString(e)&&(o&&!this.responseType||a)){const i=!(t&&t.silentJSONParsing)&&a;try{return JSON.parse(e)}catch(u){if(i)throw u.name==="SyntaxError"?Z.from(u,Z.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ve.classes.FormData,Blob:ve.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};I.forEach(["delete","get","head","post","put","patch"],n=>{nt.headers[n]={}});const Ya=I.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Za=n=>{const e={};let t,o,a;return n&&n.split(`
`).forEach(function(i){a=i.indexOf(":"),t=i.substring(0,a).trim().toLowerCase(),o=i.substring(a+1).trim(),!(!t||e[t]&&Ya[t])&&(t==="set-cookie"?e[t]?e[t].push(o):e[t]=[o]:e[t]=e[t]?e[t]+", "+o:o)}),e},Ht=Symbol("internals");function Xe(n){return n&&String(n).trim().toLowerCase()}function rt(n){return n===!1||n==null?n:I.isArray(n)?n.map(rt):String(n)}function el(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let o;for(;o=t.exec(n);)e[o[1]]=o[2];return e}const tl=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function $t(n,e,t,o,a){if(I.isFunction(o))return o.call(this,e,t);if(a&&(e=t),!!I.isString(e)){if(I.isString(o))return e.indexOf(o)!==-1;if(I.isRegExp(o))return o.test(e)}}function sl(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,o)=>t.toUpperCase()+o)}function ol(n,e){const t=I.toCamelCase(" "+e);["get","set","has"].forEach(o=>{Object.defineProperty(n,o+t,{value:function(a,l,i){return this[o].call(this,e,a,l,i)},configurable:!0})})}let ye=class{constructor(e){e&&this.set(e)}set(e,t,o){const a=this;function l(u,f,d){const m=Xe(f);if(!m)throw new Error("header name must be a non-empty string");const b=I.findKey(a,m);(!b||a[b]===void 0||d===!0||d===void 0&&a[b]!==!1)&&(a[b||f]=rt(u))}const i=(u,f)=>I.forEach(u,(d,m)=>l(d,m,f));if(I.isPlainObject(e)||e instanceof this.constructor)i(e,t);else if(I.isString(e)&&(e=e.trim())&&!tl(e))i(Za(e),t);else if(I.isObject(e)&&I.isIterable(e)){let u={},f,d;for(const m of e){if(!I.isArray(m))throw TypeError("Object iterator must return a key-value pair");u[d=m[0]]=(f=u[d])?I.isArray(f)?[...f,m[1]]:[f,m[1]]:m[1]}i(u,t)}else e!=null&&l(t,e,o);return this}get(e,t){if(e=Xe(e),e){const o=I.findKey(this,e);if(o){const a=this[o];if(!t)return a;if(t===!0)return el(a);if(I.isFunction(t))return t.call(this,a,o);if(I.isRegExp(t))return t.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Xe(e),e){const o=I.findKey(this,e);return!!(o&&this[o]!==void 0&&(!t||$t(this,this[o],o,t)))}return!1}delete(e,t){const o=this;let a=!1;function l(i){if(i=Xe(i),i){const u=I.findKey(o,i);u&&(!t||$t(o,o[u],u,t))&&(delete o[u],a=!0)}}return I.isArray(e)?e.forEach(l):l(e),a}clear(e){const t=Object.keys(this);let o=t.length,a=!1;for(;o--;){const l=t[o];(!e||$t(this,this[l],l,e,!0))&&(delete this[l],a=!0)}return a}normalize(e){const t=this,o={};return I.forEach(this,(a,l)=>{const i=I.findKey(o,l);if(i){t[i]=rt(a),delete t[l];return}const u=e?sl(l):String(l).trim();u!==l&&delete t[l],t[u]=rt(a),o[u]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return I.forEach(this,(o,a)=>{o!=null&&o!==!1&&(t[a]=e&&I.isArray(o)?o.join(", "):o)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const o=new this(e);return t.forEach(a=>o.set(a)),o}static accessor(e){const o=(this[Ht]=this[Ht]={accessors:{}}).accessors,a=this.prototype;function l(i){const u=Xe(i);o[u]||(ol(a,i),o[u]=!0)}return I.isArray(e)?e.forEach(l):l(e),this}};ye.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);I.reduceDescriptors(ye.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(o){this[t]=o}}});I.freezeMethods(ye);function St(n,e){const t=this||nt,o=e||t,a=ye.from(o.headers);let l=o.data;return I.forEach(n,function(u){l=u.call(t,l,a.normalize(),e?e.status:void 0)}),a.normalize(),l}function ws(n){return!!(n&&n.__CANCEL__)}function je(n,e,t){Z.call(this,n??"canceled",Z.ERR_CANCELED,e,t),this.name="CanceledError"}I.inherits(je,Z,{__CANCEL__:!0});function ks(n,e,t){const o=t.config.validateStatus;!t.status||!o||o(t.status)?n(t):e(new Z("Request failed with status code "+t.status,[Z.ERR_BAD_REQUEST,Z.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function nl(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function al(n,e){n=n||10;const t=new Array(n),o=new Array(n);let a=0,l=0,i;return e=e!==void 0?e:1e3,function(f){const d=Date.now(),m=o[l];i||(i=d),t[a]=f,o[a]=d;let b=l,F=0;for(;b!==a;)F+=t[b++],b=b%n;if(a=(a+1)%n,a===l&&(l=(l+1)%n),d-i<e)return;const B=m&&d-m;return B?Math.round(F*1e3/B):void 0}}function ll(n,e){let t=0,o=1e3/e,a,l;const i=(d,m=Date.now())=>{t=m,a=null,l&&(clearTimeout(l),l=null),n.apply(null,d)};return[(...d)=>{const m=Date.now(),b=m-t;b>=o?i(d,m):(a=d,l||(l=setTimeout(()=>{l=null,i(a)},o-b)))},()=>a&&i(a)]}const dt=(n,e,t=3)=>{let o=0;const a=al(50,250);return ll(l=>{const i=l.loaded,u=l.lengthComputable?l.total:void 0,f=i-o,d=a(f),m=i<=u;o=i;const b={loaded:i,total:u,progress:u?i/u:void 0,bytes:f,rate:d||void 0,estimated:d&&u&&m?(u-i)/d:void 0,event:l,lengthComputable:u!=null,[e?"download":"upload"]:!0};n(b)},t)},Gt=(n,e)=>{const t=n!=null;return[o=>e[0]({lengthComputable:t,total:n,loaded:o}),e[1]]},Wt=n=>(...e)=>I.asap(()=>n(...e)),rl=ve.hasStandardBrowserEnv?((n,e)=>t=>(t=new URL(t,ve.origin),n.protocol===t.protocol&&n.host===t.host&&(e||n.port===t.port)))(new URL(ve.origin),ve.navigator&&/(msie|trident)/i.test(ve.navigator.userAgent)):()=>!0,il=ve.hasStandardBrowserEnv?{write(n,e,t,o,a,l){const i=[n+"="+encodeURIComponent(e)];I.isNumber(t)&&i.push("expires="+new Date(t).toGMTString()),I.isString(o)&&i.push("path="+o),I.isString(a)&&i.push("domain="+a),l===!0&&i.push("secure"),document.cookie=i.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function cl(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function dl(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function Ts(n,e,t){let o=!cl(e);return n&&(o||t==!1)?dl(n,e):e}const zt=n=>n instanceof ye?{...n}:n;function Le(n,e){e=e||{};const t={};function o(d,m,b,F){return I.isPlainObject(d)&&I.isPlainObject(m)?I.merge.call({caseless:F},d,m):I.isPlainObject(m)?I.merge({},m):I.isArray(m)?m.slice():m}function a(d,m,b,F){if(I.isUndefined(m)){if(!I.isUndefined(d))return o(void 0,d,b,F)}else return o(d,m,b,F)}function l(d,m){if(!I.isUndefined(m))return o(void 0,m)}function i(d,m){if(I.isUndefined(m)){if(!I.isUndefined(d))return o(void 0,d)}else return o(void 0,m)}function u(d,m,b){if(b in e)return o(d,m);if(b in n)return o(void 0,d)}const f={url:l,method:l,data:l,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:u,headers:(d,m,b)=>a(zt(d),zt(m),b,!0)};return I.forEach(Object.keys(Object.assign({},n,e)),function(m){const b=f[m]||a,F=b(n[m],e[m],m);I.isUndefined(F)&&b!==u||(t[m]=F)}),t}const Ps=n=>{const e=Le({},n);let{data:t,withXSRFToken:o,xsrfHeaderName:a,xsrfCookieName:l,headers:i,auth:u}=e;e.headers=i=ye.from(i),e.url=_s(Ts(e.baseURL,e.url,e.allowAbsoluteUrls),n.params,n.paramsSerializer),u&&i.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):"")));let f;if(I.isFormData(t)){if(ve.hasStandardBrowserEnv||ve.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if((f=i.getContentType())!==!1){const[d,...m]=f?f.split(";").map(b=>b.trim()).filter(Boolean):[];i.setContentType([d||"multipart/form-data",...m].join("; "))}}if(ve.hasStandardBrowserEnv&&(o&&I.isFunction(o)&&(o=o(e)),o||o!==!1&&rl(e.url))){const d=a&&l&&il.read(l);d&&i.set(a,d)}return e},ul=typeof XMLHttpRequest<"u",pl=ul&&function(n){return new Promise(function(t,o){const a=Ps(n);let l=a.data;const i=ye.from(a.headers).normalize();let{responseType:u,onUploadProgress:f,onDownloadProgress:d}=a,m,b,F,B,S;function $(){B&&B(),S&&S(),a.cancelToken&&a.cancelToken.unsubscribe(m),a.signal&&a.signal.removeEventListener("abort",m)}let _=new XMLHttpRequest;_.open(a.method.toUpperCase(),a.url,!0),_.timeout=a.timeout;function p(){if(!_)return;const w=ye.from("getAllResponseHeaders"in _&&_.getAllResponseHeaders()),v={data:!u||u==="text"||u==="json"?_.responseText:_.response,status:_.status,statusText:_.statusText,headers:w,config:n,request:_};ks(function(U){t(U),$()},function(U){o(U),$()},v),_=null}"onloadend"in _?_.onloadend=p:_.onreadystatechange=function(){!_||_.readyState!==4||_.status===0&&!(_.responseURL&&_.responseURL.indexOf("file:")===0)||setTimeout(p)},_.onabort=function(){_&&(o(new Z("Request aborted",Z.ECONNABORTED,n,_)),_=null)},_.onerror=function(){o(new Z("Network Error",Z.ERR_NETWORK,n,_)),_=null},_.ontimeout=function(){let R=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const v=a.transitional||$s;a.timeoutErrorMessage&&(R=a.timeoutErrorMessage),o(new Z(R,v.clarifyTimeoutError?Z.ETIMEDOUT:Z.ECONNABORTED,n,_)),_=null},l===void 0&&i.setContentType(null),"setRequestHeader"in _&&I.forEach(i.toJSON(),function(R,v){_.setRequestHeader(v,R)}),I.isUndefined(a.withCredentials)||(_.withCredentials=!!a.withCredentials),u&&u!=="json"&&(_.responseType=a.responseType),d&&([F,S]=dt(d,!0),_.addEventListener("progress",F)),f&&_.upload&&([b,B]=dt(f),_.upload.addEventListener("progress",b),_.upload.addEventListener("loadend",B)),(a.cancelToken||a.signal)&&(m=w=>{_&&(o(!w||w.type?new je(null,n,_):w),_.abort(),_=null)},a.cancelToken&&a.cancelToken.subscribe(m),a.signal&&(a.signal.aborted?m():a.signal.addEventListener("abort",m)));const T=nl(a.url);if(T&&ve.protocols.indexOf(T)===-1){o(new Z("Unsupported protocol "+T+":",Z.ERR_BAD_REQUEST,n));return}_.send(l||null)})},hl=(n,e)=>{const{length:t}=n=n?n.filter(Boolean):[];if(e||t){let o=new AbortController,a;const l=function(d){if(!a){a=!0,u();const m=d instanceof Error?d:this.reason;o.abort(m instanceof Z?m:new je(m instanceof Error?m.message:m))}};let i=e&&setTimeout(()=>{i=null,l(new Z(`timeout ${e} of ms exceeded`,Z.ETIMEDOUT))},e);const u=()=>{n&&(i&&clearTimeout(i),i=null,n.forEach(d=>{d.unsubscribe?d.unsubscribe(l):d.removeEventListener("abort",l)}),n=null)};n.forEach(d=>d.addEventListener("abort",l));const{signal:f}=o;return f.unsubscribe=()=>I.asap(u),f}},ml=function*(n,e){let t=n.byteLength;if(t<e){yield n;return}let o=0,a;for(;o<t;)a=o+e,yield n.slice(o,a),o=a},fl=async function*(n,e){for await(const t of vl(n))yield*ml(t,e)},vl=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:t,value:o}=await e.read();if(t)break;yield o}}finally{await e.cancel()}},Jt=(n,e,t,o)=>{const a=fl(n,e);let l=0,i,u=f=>{i||(i=!0,o&&o(f))};return new ReadableStream({async pull(f){try{const{done:d,value:m}=await a.next();if(d){u(),f.close();return}let b=m.byteLength;if(t){let F=l+=b;t(F)}f.enqueue(new Uint8Array(m))}catch(d){throw u(d),d}},cancel(f){return u(f),a.return()}},{highWaterMark:2})},gt=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Cs=gt&&typeof ReadableStream=="function",gl=gt&&(typeof TextEncoder=="function"?(n=>e=>n.encode(e))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),Es=(n,...e)=>{try{return!!n(...e)}catch{return!1}},bl=Cs&&Es(()=>{let n=!1;const e=new Request(ve.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e}),Kt=64*1024,Et=Cs&&Es(()=>I.isReadableStream(new Response("").body)),ut={stream:Et&&(n=>n.body)};gt&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!ut[e]&&(ut[e]=I.isFunction(n[e])?t=>t[e]():(t,o)=>{throw new Z(`Response type '${e}' is not supported`,Z.ERR_NOT_SUPPORT,o)})})})(new Response);const yl=async n=>{if(n==null)return 0;if(I.isBlob(n))return n.size;if(I.isSpecCompliantForm(n))return(await new Request(ve.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(I.isArrayBufferView(n)||I.isArrayBuffer(n))return n.byteLength;if(I.isURLSearchParams(n)&&(n=n+""),I.isString(n))return(await gl(n)).byteLength},_l=async(n,e)=>{const t=I.toFiniteNumber(n.getContentLength());return t??yl(e)},$l=gt&&(async n=>{let{url:e,method:t,data:o,signal:a,cancelToken:l,timeout:i,onDownloadProgress:u,onUploadProgress:f,responseType:d,headers:m,withCredentials:b="same-origin",fetchOptions:F}=Ps(n);d=d?(d+"").toLowerCase():"text";let B=hl([a,l&&l.toAbortSignal()],i),S;const $=B&&B.unsubscribe&&(()=>{B.unsubscribe()});let _;try{if(f&&bl&&t!=="get"&&t!=="head"&&(_=await _l(m,o))!==0){let v=new Request(e,{method:"POST",body:o,duplex:"half"}),P;if(I.isFormData(o)&&(P=v.headers.get("content-type"))&&m.setContentType(P),v.body){const[U,W]=Gt(_,dt(Wt(f)));o=Jt(v.body,Kt,U,W)}}I.isString(b)||(b=b?"include":"omit");const p="credentials"in Request.prototype;S=new Request(e,{...F,signal:B,method:t.toUpperCase(),headers:m.normalize().toJSON(),body:o,duplex:"half",credentials:p?b:void 0});let T=await fetch(S);const w=Et&&(d==="stream"||d==="response");if(Et&&(u||w&&$)){const v={};["status","statusText","headers"].forEach(E=>{v[E]=T[E]});const P=I.toFiniteNumber(T.headers.get("content-length")),[U,W]=u&&Gt(P,dt(Wt(u),!0))||[];T=new Response(Jt(T.body,Kt,U,()=>{W&&W(),$&&$()}),v)}d=d||"text";let R=await ut[I.findKey(ut,d)||"text"](T,n);return!w&&$&&$(),await new Promise((v,P)=>{ks(v,P,{data:R,headers:ye.from(T.headers),status:T.status,statusText:T.statusText,config:n,request:S})})}catch(p){throw $&&$(),p&&p.name==="TypeError"&&/Load failed|fetch/i.test(p.message)?Object.assign(new Z("Network Error",Z.ERR_NETWORK,n,S),{cause:p.cause||p}):Z.from(p,p&&p.code,n,S)}}),Rt={http:Ua,xhr:pl,fetch:$l};I.forEach(Rt,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const Xt=n=>`- ${n}`,Sl=n=>I.isFunction(n)||n===null||n===!1,Rs={getAdapter:n=>{n=I.isArray(n)?n:[n];const{length:e}=n;let t,o;const a={};for(let l=0;l<e;l++){t=n[l];let i;if(o=t,!Sl(t)&&(o=Rt[(i=String(t)).toLowerCase()],o===void 0))throw new Z(`Unknown adapter '${i}'`);if(o)break;a[i||"#"+l]=o}if(!o){const l=Object.entries(a).map(([u,f])=>`adapter ${u} `+(f===!1?"is not supported by the environment":"is not available in the build"));let i=e?l.length>1?`since :
`+l.map(Xt).join(`
`):" "+Xt(l[0]):"as no adapter specified";throw new Z("There is no suitable adapter to dispatch the request "+i,"ERR_NOT_SUPPORT")}return o},adapters:Rt};function wt(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new je(null,n)}function Qt(n){return wt(n),n.headers=ye.from(n.headers),n.data=St.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),Rs.getAdapter(n.adapter||nt.adapter)(n).then(function(o){return wt(n),o.data=St.call(n,n.transformResponse,o),o.headers=ye.from(o.headers),o},function(o){return ws(o)||(wt(n),o&&o.response&&(o.response.data=St.call(n,n.transformResponse,o.response),o.response.headers=ye.from(o.response.headers))),Promise.reject(o)})}const Is="1.9.0",bt={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{bt[n]=function(o){return typeof o===n||"a"+(e<1?"n ":" ")+n}});const Yt={};bt.transitional=function(e,t,o){function a(l,i){return"[Axios v"+Is+"] Transitional option '"+l+"'"+i+(o?". "+o:"")}return(l,i,u)=>{if(e===!1)throw new Z(a(i," has been removed"+(t?" in "+t:"")),Z.ERR_DEPRECATED);return t&&!Yt[i]&&(Yt[i]=!0,console.warn(a(i," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(l,i,u):!0}};bt.spelling=function(e){return(t,o)=>(console.warn(`${o} is likely a misspelling of ${e}`),!0)};function wl(n,e,t){if(typeof n!="object")throw new Z("options must be an object",Z.ERR_BAD_OPTION_VALUE);const o=Object.keys(n);let a=o.length;for(;a-- >0;){const l=o[a],i=e[l];if(i){const u=n[l],f=u===void 0||i(u,l,n);if(f!==!0)throw new Z("option "+l+" must be "+f,Z.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Z("Unknown option "+l,Z.ERR_BAD_OPTION)}}const it={assertOptions:wl,validators:bt},Ce=it.validators;let Ne=class{constructor(e){this.defaults=e||{},this.interceptors={request:new jt,response:new jt}}async request(e,t){try{return await this._request(e,t)}catch(o){if(o instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const l=a.stack?a.stack.replace(/^.+\n/,""):"";try{o.stack?l&&!String(o.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(o.stack+=`
`+l):o.stack=l}catch{}}throw o}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Le(this.defaults,t);const{transitional:o,paramsSerializer:a,headers:l}=t;o!==void 0&&it.assertOptions(o,{silentJSONParsing:Ce.transitional(Ce.boolean),forcedJSONParsing:Ce.transitional(Ce.boolean),clarifyTimeoutError:Ce.transitional(Ce.boolean)},!1),a!=null&&(I.isFunction(a)?t.paramsSerializer={serialize:a}:it.assertOptions(a,{encode:Ce.function,serialize:Ce.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),it.assertOptions(t,{baseUrl:Ce.spelling("baseURL"),withXsrfToken:Ce.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let i=l&&I.merge(l.common,l[t.method]);l&&I.forEach(["delete","get","head","post","put","patch","common"],S=>{delete l[S]}),t.headers=ye.concat(i,l);const u=[];let f=!0;this.interceptors.request.forEach(function($){typeof $.runWhen=="function"&&$.runWhen(t)===!1||(f=f&&$.synchronous,u.unshift($.fulfilled,$.rejected))});const d=[];this.interceptors.response.forEach(function($){d.push($.fulfilled,$.rejected)});let m,b=0,F;if(!f){const S=[Qt.bind(this),void 0];for(S.unshift.apply(S,u),S.push.apply(S,d),F=S.length,m=Promise.resolve(t);b<F;)m=m.then(S[b++],S[b++]);return m}F=u.length;let B=t;for(b=0;b<F;){const S=u[b++],$=u[b++];try{B=S(B)}catch(_){$.call(this,_);break}}try{m=Qt.call(this,B)}catch(S){return Promise.reject(S)}for(b=0,F=d.length;b<F;)m=m.then(d[b++],d[b++]);return m}getUri(e){e=Le(this.defaults,e);const t=Ts(e.baseURL,e.url,e.allowAbsoluteUrls);return _s(t,e.params,e.paramsSerializer)}};I.forEach(["delete","get","head","options"],function(e){Ne.prototype[e]=function(t,o){return this.request(Le(o||{},{method:e,url:t,data:(o||{}).data}))}});I.forEach(["post","put","patch"],function(e){function t(o){return function(l,i,u){return this.request(Le(u||{},{method:e,headers:o?{"Content-Type":"multipart/form-data"}:{},url:l,data:i}))}}Ne.prototype[e]=t(),Ne.prototype[e+"Form"]=t(!0)});let kl=class As{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(l){t=l});const o=this;this.promise.then(a=>{if(!o._listeners)return;let l=o._listeners.length;for(;l-- >0;)o._listeners[l](a);o._listeners=null}),this.promise.then=a=>{let l;const i=new Promise(u=>{o.subscribe(u),l=u}).then(a);return i.cancel=function(){o.unsubscribe(l)},i},e(function(l,i,u){o.reason||(o.reason=new je(l,i,u),t(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=o=>{e.abort(o)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new As(function(a){e=a}),cancel:e}}};function Tl(n){return function(t){return n.apply(null,t)}}function Pl(n){return I.isObject(n)&&n.isAxiosError===!0}const It={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(It).forEach(([n,e])=>{It[e]=n});function xs(n){const e=new Ne(n),t=is(Ne.prototype.request,e);return I.extend(t,Ne.prototype,e,{allOwnKeys:!0}),I.extend(t,e,null,{allOwnKeys:!0}),t.create=function(a){return xs(Le(n,a))},t}const me=xs(nt);me.Axios=Ne;me.CanceledError=je;me.CancelToken=kl;me.isCancel=ws;me.VERSION=Is;me.toFormData=vt;me.AxiosError=Z;me.Cancel=me.CanceledError;me.all=function(e){return Promise.all(e)};me.spread=Tl;me.isAxiosError=Pl;me.mergeConfig=Le;me.AxiosHeaders=ye;me.formToJSON=n=>Ss(I.isHTMLForm(n)?new FormData(n):n);me.getAdapter=Rs.getAdapter;me.HttpStatusCode=It;me.default=me;const{Axios:ig,AxiosError:cg,CanceledError:dg,isCancel:ug,CancelToken:pg,VERSION:hg,all:mg,Cancel:fg,isAxiosError:vg,spread:gg,toFormData:bg,AxiosHeaders:yg,HttpStatusCode:_g,formToJSON:$g,getAdapter:Sg,mergeConfig:wg}=me;class Cl{static async getAvailableModels(){try{return(await me({url:"/api/models/available-models",method:"GET",baseURL:""})).data}catch(e){return console.error("Failed to fetch available models:",e),{options:[],total:0}}}}const El={class:"config-section"},Rl={class:"section-header"},Il={key:0,class:"error-section"},Al={class:"error-message"},xl={class:"error-content"},Dl={class:"error-title"},Fl={class:"error-description"},Ml={key:1,class:"visual-editor"},Ul={class:"plan-basic-info"},Nl={class:"form-row"},Ll={class:"form-label"},Bl=["placeholder"],Ol={key:0,class:"field-error-message"},ql={class:"form-row"},Vl={class:"form-label"},jl=["value","placeholder"],Hl={class:"steps-section"},Gl={class:"steps-header"},Wl={class:"form-label"},zl={class:"steps-actions"},Jl=["title"],Kl={class:"steps-container"},Xl={class:"step-header"},Ql={class:"step-number"},Yl={class:"step-actions"},Zl=["onClick","disabled","title"],er=["onClick","disabled","title"],tr=["onClick","title"],sr={class:"step-content"},or={class:"form-row"},nr={class:"form-label"},ar=["onUpdate:modelValue","placeholder"],lr={class:"form-row"},rr={class:"form-label"},ir=["onUpdate:modelValue","placeholder"],cr={class:"form-row"},dr={class:"form-label"},ur={class:"model-selector"},pr=["onUpdate:modelValue","disabled"],hr={key:0,disabled:"",value:""},mr={key:1,disabled:"",value:""},fr={value:"",disabled:""},vr={value:""},gr=["value","title"],br=["title"],yr={key:0,class:"error-message"},_r={class:"form-row"},$r={key:0,class:"empty-steps"},Sr={key:0,class:"json-preview"},wr={class:"preview-header"},kr={class:"form-label"},Tr={class:"json-code"},Pr={class:"editor-footer"},Cr={class:"section-actions"},Er=["disabled","title"],Rr=["disabled","title"],Ir=["disabled"],Ar=ce({__name:"JsonEditorV2",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},hiddenFields:{default:()=>[]},currentPlanTemplateId:{default:""}},emits:["rollback","restore","save","update:jsonContent"],setup(n,{emit:e}){const t=n,o=e,{showJsonPreview:a,displayData:l,formattedJsonOutput:i,addStep:u,removeStep:f,moveStepUp:d,moveStepDown:m,handleRollback:b,handleRestore:F,handleSave:B,toggleJsonPreview:S,closeJsonPreview:$}=rs(t,o),_=N(null),p=N(""),T=N([]),w=N(!1),R=N(""),v=N(!1),P=N(-1),U=async()=>{if(!w.value){w.value=!0,R.value="";try{const y=await Cl.getAvailableModels();y&&y.options?T.value=y.options:T.value=[]}catch(y){console.error("Failed to load models:",y),R.value=y instanceof Error?y.message:"Failed to load models",T.value=[]}finally{w.value=!1}}},W=y=>{P.value=y,v.value=!0,console.log("[JsonEditorV2] Available tools from store:",z.availableTools)},E=y=>{P.value>=0&&P.value<l.steps.length&&(l.steps[P.value].selectedToolKeys=[...y]),v.value=!1,P.value=-1},x=(y,D)=>{y>=0&&y<l.steps.length&&(l.steps[y].selectedToolKeys=[...D])},A=()=>{try{_.value=null,l.title||(l.title=""),l.steps||(l.steps=[]),l.directResponse=!1}catch(y){const D=`Failed to initialize JsonEditorV2: ${y instanceof Error?y.message:"Unknown error"}`;_.value=D,console.error(D,y)}};ie(()=>l,y=>{try{!y.title||!y.title.trim()?p.value="Title is required field":p.value="",_.value=null}catch(D){_.value=`Invalid data structure: ${D instanceof Error?D.message:"Unknown error"}`,p.value=""}},{immediate:!0,deep:!0}),$e(()=>{A(),U()});const j=y=>{const D=y.target;if(!D)return;D.style.height="auto";const J=20,X=Math.ceil(D.scrollHeight/J),L=4,M=12,Q=Math.max(L,Math.min(M,X)),O=Q*J;D.style.height=`${O}px`,D.rows=Q,X>M?D.style.overflowY="auto":D.style.overflowY="hidden"};return(y,D)=>{var J;return h(),g("div",El,[s("div",Rl,[k(r(C),{icon:"carbon:code",width:"16"}),s("span",null,c(y.$t("sidebar.dynamicAgentPlan")),1)]),_.value?(h(),g("div",Il,[s("div",Al,[k(r(C),{icon:"carbon:warning",width:"16"}),s("div",xl,[s("div",Dl,c(y.$t("sidebar.planTypeError")),1),s("div",Fl,c(_.value),1)])])])):(h(),g("div",Ml,[s("div",Ul,[s("div",Nl,[s("label",Ll,c(y.$t("sidebar.title")),1),te(s("input",{"onUpdate:modelValue":D[0]||(D[0]=X=>r(l).title=X),type:"text",class:se(["form-input",{error:p.value}]),placeholder:y.$t("sidebar.titlePlaceholder")},null,10,Bl),[[re,r(l).title]]),p.value?(h(),g("div",Ol,[k(r(C),{icon:"carbon:warning",width:"12"}),ee(" "+c(p.value),1)])):q("",!0)]),s("div",ql,[s("label",Vl,c(y.$t("sidebar.planTemplateId")),1),s("input",{value:y.currentPlanTemplateId,type:"text",class:"form-input readonly-input",readonly:"",placeholder:y.$t("sidebar.planTemplateIdPlaceholder")},null,8,jl)])]),s("div",Hl,[s("div",Gl,[s("label",Wl,c(y.$t("sidebar.tasks")),1),s("div",zl,[s("button",{onClick:D[1]||(D[1]=(...X)=>r(u)&&r(u)(...X)),class:"btn btn-xs",title:y.$t("sidebar.addStep")},[k(r(C),{icon:"carbon:add",width:"12"})],8,Jl)])]),s("div",Kl,[(h(!0),g(oe,null,ae(r(l).steps,(X,L)=>(h(),g("div",{key:L,class:"step-item"},[s("div",Xl,[s("span",Ql,c(y.$t("sidebar.subtask"))+" "+c(L+1),1),s("div",Yl,[s("button",{onClick:M=>r(d)(L),disabled:L===0,class:"btn btn-xs",title:y.$t("sidebar.moveUp")},[k(r(C),{icon:"carbon:chevron-up",width:"12"})],8,Zl),s("button",{onClick:M=>r(m)(L),disabled:L===r(l).steps.length-1,class:"btn btn-xs",title:y.$t("sidebar.moveDown")},[k(r(C),{icon:"carbon:chevron-down",width:"12"})],8,er),s("button",{onClick:M=>r(f)(L),class:"btn btn-xs btn-danger",title:y.$t("sidebar.removeStep")},[k(r(C),{icon:"carbon:trash-can",width:"12"})],8,tr)])]),s("div",sr,[s("div",or,[s("label",nr,c(y.$t("sidebar.stepRequirement")),1),te(s("textarea",{"onUpdate:modelValue":M=>X.stepRequirement=M,class:"form-textarea auto-resize",placeholder:y.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:D[2]||(D[2]=M=>j(M))},null,40,ar),[[re,X.stepRequirement]])]),s("div",lr,[s("label",rr,c(y.$t("sidebar.terminateColumns")),1),te(s("textarea",{"onUpdate:modelValue":M=>X.terminateColumns=M,class:"form-textarea auto-resize",placeholder:y.$t("sidebar.terminateColumnsPlaceholder"),rows:"4",onInput:D[3]||(D[3]=M=>j(M))},null,40,ir),[[re,X.terminateColumns]])]),s("div",cr,[s("label",dr,c(y.$t("sidebar.modelName")),1),s("div",ur,[te(s("select",{"onUpdate:modelValue":M=>X.modelName=M,class:"form-select model-select",disabled:w.value},[w.value?(h(),g("option",hr,c(y.$t("sidebar.loading")),1)):R.value?(h(),g("option",mr,c(y.$t("sidebar.modelLoadError")),1)):q("",!0),s("option",fr,c(y.$t("sidebar.modelNameDescription")),1),s("option",vr,c(y.$t("sidebar.noModelSelected")),1),(h(!0),g(oe,null,ae(T.value,M=>(h(),g("option",{key:M.value,value:M.value,title:M.label},c(M.label),9,gr))),128))],8,pr),[[st,X.modelName]]),R.value?(h(),g("button",{key:0,onClick:U,class:"btn btn-sm btn-danger",title:y.$t("sidebar.retryLoadModels")},[k(r(C),{icon:"carbon:warning",width:"14"}),ee(" "+c(y.$t("sidebar.retry")),1)],8,br)):q("",!0)]),R.value?(h(),g("div",yr,[k(r(C),{icon:"carbon:warning",width:"12"}),ee(" "+c(R.value),1)])):q("",!0)]),s("div",_r,[k(Xn,{title:y.$t("sidebar.selectedTools"),"selected-tool-ids":X.selectedToolKeys,"available-tools":r(z).availableTools,"add-button-text":y.$t("sidebar.addRemoveTools"),"empty-text":y.$t("sidebar.noTools"),"use-grid-layout":!0,onAddTools:M=>W(L),onToolsFiltered:M=>x(L,M)},null,8,["title","selected-tool-ids","available-tools","add-button-text","empty-text","onAddTools","onToolsFiltered"])])])]))),128)),r(l).steps.length===0?(h(),g("div",$r,[k(r(C),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),s("p",null,c(y.$t("sidebar.noSteps")),1),s("button",{onClick:D[4]||(D[4]=(...X)=>r(u)&&r(u)(...X)),class:"btn btn-primary"},[k(r(C),{icon:"carbon:add",width:"14"}),ee(" "+c(y.$t("sidebar.addFirstStep")),1)])])):q("",!0)])]),r(a)?(h(),g("div",Sr,[s("div",wr,[s("label",kr,c(y.$t("sidebar.jsonPreview")),1),s("button",{onClick:D[5]||(D[5]=(...X)=>r($)&&r($)(...X)),class:"btn btn-xs"},[k(r(C),{icon:"carbon:close",width:"12"})])]),s("pre",Tr,c(r(i)),1)])):q("",!0),s("div",Pr,[s("button",{onClick:D[6]||(D[6]=(...X)=>r(S)&&r(S)(...X)),class:"btn btn-sm btn-secondary"},[k(r(C),{icon:"carbon:code",width:"14"}),ee(" "+c(r(a)?y.$t("sidebar.hideJson"):y.$t("sidebar.showJson")),1)]),s("div",Cr,[s("button",{class:"btn btn-sm",onClick:D[7]||(D[7]=(...X)=>r(b)&&r(b)(...X)),disabled:!(y.canRollback??!1),title:y.$t("sidebar.rollback")},[k(r(C),{icon:"carbon:undo",width:"14"})],8,Er),s("button",{class:"btn btn-sm",onClick:D[8]||(D[8]=(...X)=>r(F)&&r(F)(...X)),disabled:!(y.canRestore??!1),title:y.$t("sidebar.restore")},[k(r(C),{icon:"carbon:redo",width:"14"})],8,Rr),s("button",{class:"btn btn-primary",onClick:D[9]||(D[9]=(...X)=>r(B)&&r(B)(...X)),disabled:y.isGenerating||y.isExecuting},[k(r(C),{icon:"carbon:save",width:"14"}),D[11]||(D[11]=ee(" Save "))],8,Ir)])])])),k(Vn,{modelValue:v.value,"onUpdate:modelValue":D[10]||(D[10]=X=>v.value=X),tools:r(z).availableTools,"selected-tool-ids":P.value>=0?((J=r(l).steps[P.value])==null?void 0:J.selectedToolKeys)||[]:[],onConfirm:E},null,8,["modelValue","tools","selected-tool-ids"])])}}}),xr=de(Ar,[["__scopeId","data-v-575f3fe3"]]);class Zt{static async uploadFiles(e){try{console.log("[FileUploadApiService] Uploading files:",e.length);const t=new FormData;e.forEach(l=>{t.append("files",l)});const o=await fetch("/api/file-upload/upload",{method:"POST",body:t});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const a=await o.json();return console.log("[FileUploadApiService] Files uploaded successfully:",a.successfulFiles,"uploadKey:",a.uploadKey),a}catch(t){throw console.error("[FileUploadApiService] Error uploading files:",t),t}}static async getUploadedFiles(e){try{console.log("[FileUploadApiService] Getting uploaded files for uploadKey:",e);const t=await fetch(`/api/file-upload/files/${encodeURIComponent(e)}`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const o=await t.json();return console.log("[FileUploadApiService] Got uploaded files:",o.totalCount,"for uploadKey:",e),o}catch(t){throw console.error("[FileUploadApiService] Error getting uploaded files:",t),t}}static async deleteFile(e,t){try{console.log("[FileUploadApiService] Deleting file:",t,"from uploadKey:",e);const o=await fetch(`/api/file-upload/files/${encodeURIComponent(e)}/${encodeURIComponent(t)}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const a=await o.json();return console.log("[FileUploadApiService] File deleted successfully:",a.success),a}catch(o){throw console.error("[FileUploadApiService] Error deleting file:",o),o}}static async getUploadConfig(){try{console.log("[FileUploadApiService] Getting upload configuration");const e=await fetch("/api/file-upload/config");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();return console.log("[FileUploadApiService] Got upload configuration:",t),t}catch(e){throw console.error("[FileUploadApiService] Error getting upload configuration:",e),e}}}const Dr={class:"file-upload-component"},Fr=["accept"],Mr={key:0},Ur={key:1},Nr={key:0,class:"files-list"},Lr={class:"file-name"},Br={class:"file-size"},Or=["onClick","title"],qr={key:0,class:"upload-progress"},Vr=ce({__name:"FileUploadComponent",props:{acceptedFileTypes:{default:".pdf,.txt,.md,.doc,.docx,.csv,.xlsx,.xls,.json,.xml,.html,.htm,.log,.java,.py,.js,.ts,.sql,.sh,.bat,.yaml,.yml,.properties,.conf,.ini,.jpg,.jpeg,.png,.gif"},disabled:{type:Boolean,default:!1}},emits:["files-uploaded","files-removed","upload-key-changed","upload-started","upload-completed","upload-error"],setup(n,{expose:e,emit:t}){const{t:o}=Se(),a=n,l=t,i=N(),u=N([]),f=N(!1),d=N(null),m=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),u.value=[],d.value=null,l("upload-key-changed",null)};_e(()=>{m()}),ie(()=>u.value,_=>{l("files-removed",_)},{deep:!0});const b=()=>{a.disabled||i.value&&i.value.click()},F=async _=>{const p=_.target,T=p.files;if(!T||T.length===0)return;const w=Array.from(T);console.log("[FileUpload] Selected files for upload:",w.map(R=>R.name)),await B(w),p&&(p.value="")},B=async _=>{if(_.length!==0){f.value=!0,l("upload-started");try{const p=await Zt.uploadFiles(_);p.success&&p.uploadedFiles&&(!d.value&&p.uploadKey?(d.value=p.uploadKey,console.log("[FileUpload] Set uploadKey:",d.value),u.value=p.uploadedFiles):d.value?(console.log("[FileUpload] Using existing uploadKey:",d.value),u.value=[...u.value,...p.uploadedFiles]):(console.warn("[FileUpload] No uploadKey returned from upload"),u.value=p.uploadedFiles),p.uploadKey&&(d.value=p.uploadKey,console.log("[Input] Saved uploadKey locally:",p.uploadKey),l("upload-key-changed",d.value)),console.log("[Input] Updated global uploadedFiles state:",u.value),l("files-uploaded",u.value,d.value)),console.log("Files uploaded successfully:",p),l("upload-completed")}catch(p){console.error("File upload error:",p),l("upload-error",p)}finally{f.value=!1}}},S=async _=>{try{if(console.log("🗑️ Removing file:",_.originalName,"from uploadKey:",d),d.value){const p=await Zt.deleteFile(d.value,_.originalName);p.success?console.log("✅ File deleted from server successfully"):console.error("❌ Failed to delete file from server:",p.error)}u.value=u.value.filter(p=>p.originalName!==_.originalName),u.value.length===0&&(console.log("[FileUpload] 🧹 Clearing uploadKey to force new plan for new files"),d.value=null,l("upload-key-changed",null)),console.log("🎉 File removal completed, remaining files:",u.value.length)}catch(p){console.error("❌ Error removing file:",p),l("upload-error",p)}},$=_=>{if(_===0)return"0 Bytes";const p=1024,T=["Bytes","KB","MB","GB"],w=Math.floor(Math.log(_)/Math.log(p));return parseFloat((_/Math.pow(p,w)).toFixed(2))+" "+T[w]};return e({uploadedFiles:u,uploadKey:d,resetSession:m,uploadFiles:B,removeFile:S,isUploading:f}),(_,p)=>(h(),g("div",Dr,[s("input",{ref_key:"fileInputRef",ref:i,type:"file",multiple:"",style:{display:"none"},onChange:F,accept:_.acceptedFileTypes||""},null,40,Fr),s("div",{class:se(["uploaded-files",{"has-files":u.value.length>0}])},[s("div",{class:"files-header",onClick:b},[k(r(C),{icon:"carbon:attachment"}),u.value.length===0?(h(),g("span",Mr,c(r(o)("input.attachFile")),1)):(h(),g("span",Ur,c(r(o)("input.attachedFiles"))+" ("+c(u.value.length)+")",1))]),u.value.length>0?(h(),g("div",Nr,[(h(!0),g(oe,null,ae(u.value,T=>(h(),g("div",{key:T.originalName,class:"file-item"},[k(r(C),{icon:"carbon:document",class:"file-icon"}),s("span",Lr,c(T.originalName),1),s("span",Br,"("+c($(T.size))+")",1),s("button",{onClick:w=>S(T),class:"remove-btn",title:r(o)("input.removeFile")},[k(r(C),{icon:"carbon:close"})],8,Or)]))),128))])):q("",!0)],2),f.value?(h(),g("div",qr,[k(r(C),{icon:"carbon:rotate--clockwise",class:"loading-icon"}),s("span",null,c(r(o)("input.uploading")),1)])):q("",!0)]))}}),Ds=de(Vr,[["__scopeId","data-v-608b06f9"]]),jr={class:"config-section"},Hr={class:"section-header"},Gr={class:"execution-content"},Wr={class:"params-requirements-group"},zr={class:"params-help-text"},Jr={key:0,class:"parameter-fields"},Kr={class:"parameter-label"},Xr=["onUpdate:modelValue","placeholder","onInput"],Qr={key:0,class:"parameter-error"},Yr={key:1,class:"validation-message"},Zr=["disabled"],ei=["disabled"],ti={key:1,class:"call-example-wrapper"},si={class:"call-example-header"},oi={class:"call-example-title"},ni={class:"call-example-description"},ai={class:"internal-call-wrapper"},li={class:"call-info"},ri={class:"call-method"},ii={class:"call-endpoint"},ci={key:0,class:"call-endpoint"},di={class:"call-description"},ui={class:"call-example"},pi={class:"example-code"},hi={key:2,class:"call-example-wrapper"},mi={class:"call-example-header"},fi={class:"call-example-title"},vi={class:"call-example-description"},gi={class:"http-api-urls-wrapper"},bi={class:"tab-container"},yi={class:"tab-header"},_i=["onClick"],$i={class:"tab-content"},Si={class:"http-api-url-display"},wi={class:"api-method"},ki={class:"api-endpoint"},Ti={class:"api-description"},Pi={key:0,class:"api-example"},Ci={class:"example-code"},Ei={key:3,class:"call-example-wrapper"},Ri={class:"call-example-header"},Ii={class:"call-example-title"},Ai={class:"call-example-description"},xi={class:"mcp-call-wrapper"},Di={class:"call-info"},Fi={class:"call-method"},Mi={class:"call-endpoint"},Ui={class:"call-description"},Ni={class:"call-example"},Li={class:"example-code"},Bi=ce({__name:"ExecutionController",props:{currentPlanTemplateId:{default:""},isExecuting:{type:Boolean,default:!1},isGenerating:{type:Boolean,default:!1},showPublishButton:{type:Boolean,default:!0},toolInfo:{default:()=>({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""})}},emits:["executePlan","publishMcpService","clearParams","updateExecutionParams"],setup(n,{expose:e,emit:t}){const{t:o}=Se(),a=n,l=t,i=N(""),u=N({parameters:[],hasParameters:!1,requirements:""}),f=N({}),d=N(!1),m=N("get-sync"),b=N({}),F=N(!1),B=N(!1),S=N(),$=N([]),_=N(null),p=N([{id:"get-sync",label:"GET + Sync",method:"GET",endpoint:"/api/executor/executeByToolNameSync/{toolName}",description:"Synchronous GET request - returns execution result immediately",example:`GET /api/executor/executeByToolNameSync/my-tool?allParams={"rawParam":"test"}
Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-sync",label:"POST + Sync",method:"POST",endpoint:"/api/executor/executeByToolNameSync",description:"Synchronous POST request - returns execution result immediately",example:`POST /api/executor/executeByToolNameSync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-async",label:"POST + Async",method:"POST",endpoint:"/api/executor/executeByToolNameAsync",description:"Asynchronous POST request - returns task ID, check status separately",example:`POST /api/executor/executeByToolNameAsync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "planId": "plan-123",
  "status": "processing",
  "message": "Task submitted, processing",
  "memoryId": "ABC12345",
  "toolName": "my-tool",
  "planTemplateId": "template-456"
}

# Check execution status and get detailed results:
GET /api/executor/details/{planId}
Response: {
  "currentPlanId": "plan-123",
  "title": "Plan Title",
  "status": "completed",
  "summary": "Execution completed successfully",
  "agentExecutionSequence": [...],
  "userInputWaitState": null
}`}]),T=le(()=>{var M,Q,O;return((M=a.toolInfo)==null?void 0:M.enableInternalToolcall)||((Q=a.toolInfo)==null?void 0:Q.enableHttpService)||((O=a.toolInfo)==null?void 0:O.enableMcpService)}),w=le(()=>T.value?o("sidebar.updateServiceStatus"):o("sidebar.publishMcpService")),R=le(()=>a.isExecuting||a.isGenerating?!1:u.value.hasParameters?u.value.parameters.every(M=>{var Q;return(Q=f.value[M])==null?void 0:Q.trim()}):!0),v=(M,Q)=>{$.value=M.map(O=>O.originalName),_.value=Q,console.log("[ExecutionController] Files uploaded:",M.length,"uploadKey:",Q)},P=M=>{$.value=M.map(Q=>Q.originalName),console.log("[ExecutionController] Files removed, remaining:",M.length)},U=M=>{_.value=M,console.log("[ExecutionController] Upload key changed:",M)},W=()=>{console.log("[ExecutionController] Upload started")},E=()=>{console.log("[ExecutionController] Upload completed")},x=M=>{console.error("[ExecutionController] Upload error:",M)},A=()=>{if(console.log("[ExecutionController] 🚀 Execute button clicked"),B.value=!0,console.log("[ExecutionController] 🔒 Set isExecutingPlan to true"),!X()){console.log("[ExecutionController] ❌ Parameter validation failed:",b.value),B.value=!1;return}const M=u.value.hasParameters&&Object.keys(f.value).length>0?f.value:void 0;console.log("[ExecutionController] 🔄 Replacement params:",M);const Q={title:"",planData:{title:"",steps:[],directResponse:!1},params:void 0,replacementParams:M,uploadedFiles:$.value,uploadKey:_.value};console.log("[ExecutionController] 📤 Emitting executePlan with payload:",JSON.stringify(Q,null,2)),l("executePlan",Q)},j=()=>{l("publishMcpService")},y=()=>{console.log("[ExecutionController] 🧹 clearExecutionParams called"),i.value="",f.value={},B.value=!1,console.log("[ExecutionController] 🔓 Reset isExecutingPlan to false"),console.log("[ExecutionController] ✅ After clear - parameterValues cleared"),l("clearParams")},D=async()=>{if(console.log("[ExecutionController] 🔄 loadParameterRequirements called for templateId:",a.currentPlanTemplateId),console.log("[ExecutionController] 📊 Current parameterRequirements before load:",JSON.stringify(u.value,null,2)),!a.currentPlanTemplateId){console.log("[ExecutionController] ❌ No template ID, resetting parameters"),u.value={parameters:[],hasParameters:!1,requirements:""},f.value={};return}d.value=!0;try{console.log("[ExecutionController] 🌐 Fetching parameter requirements from API...");const M=await Dt.getParameterRequirements(a.currentPlanTemplateId);console.log("[ExecutionController] 📥 Received requirements from API:",JSON.stringify(M,null,2)),u.value=M;const Q={};M.parameters.forEach(O=>{Q[O]=f.value[O]||""}),f.value=Q,console.log("[ExecutionController] ✅ Updated parameterRequirements:",JSON.stringify(u.value,null,2)),console.log("[ExecutionController] ✅ Updated parameterValues:",JSON.stringify(f.value,null,2)),L()}catch(M){console.error("[ExecutionController] ❌ Failed to load parameter requirements:",M),M instanceof Error&&!M.message.includes("404")&&console.warn("[ExecutionController] ⚠️ Parameter requirements not available yet, will retry later"),u.value={parameters:[],hasParameters:!1,requirements:""},console.log("[ExecutionController] 🔄 Reset parameterRequirements due to error:",JSON.stringify(u.value,null,2))}finally{d.value=!1,console.log("[ExecutionController] ✅ loadParameterRequirements completed")}},J=(M,Q)=>{f.value[M]=Q,b.value[M]&&delete b.value[M],L()},X=()=>{if(b.value={},F.value=!1,!u.value.hasParameters)return!0;let M=!1;return u.value.parameters.forEach(Q=>{var G;((G=f.value[Q])==null?void 0:G.trim())||(b.value[Q]=`${Q} is required`,M=!0)}),F.value=M,!M},L=()=>{u.value.hasParameters?i.value=JSON.stringify(f.value,null,2):i.value="",l("updateExecutionParams",i.value)};return ie(()=>a.currentPlanTemplateId,(M,Q)=>{if(M&&M!==Q){if(B.value){console.log("[ExecutionController] ⏸️ Skipping parameter reload - plan is executing");return}console.log("[ExecutionController] 🔄 Template ID changed, will reload parameters"),Q&&M.startsWith("planTemplate-")?(console.log("[ExecutionController] ⏰ New template detected, retrying with delay..."),setTimeout(()=>{console.log("[ExecutionController] ⏰ Delay timeout, calling loadParameterRequirements"),D()},1e3)):(console.log("[ExecutionController] 🚀 Immediate reload of parameters"),D())}}),ie(()=>i.value,M=>{l("updateExecutionParams",M)}),$e(()=>{D()}),e({executionParams:i,clearExecutionParams:y,loadParameterRequirements:D,fileUploadRef:S,uploadedFiles:$,uploadKey:_}),(M,Q)=>{var O,G,Y,V,H;return h(),g("div",jr,[s("div",Hr,[k(r(C),{icon:"carbon:play",width:"16"}),s("span",null,c(r(o)("sidebar.executionController")),1)]),s("div",Gr,[s("div",Wr,[s("label",null,c(r(o)("sidebar.parameterRequirements")),1),s("div",zr,c(r(o)("sidebar.parameterRequirementsHelp")),1),u.value.hasParameters?(h(),g("div",Jr,[(h(!0),g(oe,null,ae(u.value.parameters,K=>(h(),g("div",{key:K,class:"parameter-field"},[s("label",Kr,[ee(c(K)+" ",1),Q[0]||(Q[0]=s("span",{class:"required"},"*",-1))]),te(s("input",{"onUpdate:modelValue":ue=>f.value[K]=ue,class:se(["parameter-input",{error:b.value[K]}]),placeholder:r(o)("sidebar.enterValueFor",{param:K}),onInput:ue=>J(K,ue.target.value),required:""},null,42,Xr),[[re,f.value[K]]]),b.value[K]?(h(),g("div",Qr,c(b.value[K]),1)):q("",!0)]))),128))])):q("",!0),u.value.hasParameters&&!R.value&&!a.isExecuting&&!a.isGenerating?(h(),g("div",Yr,[k(r(C),{icon:"carbon:warning",width:"14"}),ee(" "+c(r(o)("sidebar.fillAllRequiredParameters")),1)])):q("",!0)]),k(Ds,{ref_key:"fileUploadRef",ref:S,disabled:a.isExecuting||a.isGenerating,onFilesUploaded:v,onFilesRemoved:P,onUploadKeyChanged:U,onUploadStarted:W,onUploadCompleted:E,onUploadError:x},null,8,["disabled"]),s("button",{class:"btn btn-primary execute-btn",onClick:A,disabled:!R.value},[k(r(C),{icon:a.isExecuting?"carbon:circle-dash":"carbon:play",width:"16",class:se({spinning:a.isExecuting})},null,8,["icon","class"]),ee(" "+c(a.isExecuting?r(o)("sidebar.executing"):r(o)("sidebar.executePlan")),1)],8,Zr),M.showPublishButton?(h(),g("button",{key:0,class:"btn publish-mcp-btn",onClick:j,disabled:!M.currentPlanTemplateId},[k(r(C),{icon:"carbon:application",width:"16"}),ee(" "+c(w.value),1)],8,ei)):q("",!0),(O=M.toolInfo)!=null&&O.enableInternalToolcall?(h(),g("div",ti,[s("div",si,[s("h4",oi,c(r(o)("sidebar.internalCall")),1),s("p",ni,c(r(o)("sidebar.internalCallDescription")),1)]),s("div",ai,[s("div",li,[s("div",ri,c(r(o)("sidebar.internalMethodCall")),1),s("div",ii,c(r(o)("sidebar.toolName"))+": "+c(((G=M.toolInfo)==null?void 0:G.toolName)||M.currentPlanTemplateId),1),(Y=M.toolInfo)!=null&&Y.serviceGroup?(h(),g("div",ci,c(r(o)("sidebar.serviceGroup"))+": "+c(M.toolInfo.serviceGroup),1)):q("",!0),s("div",di,c(r(o)("sidebar.internalCallUsage")),1),s("div",ui,[s("strong",null,c(r(o)("sidebar.usage"))+":",1),s("pre",pi,c(r(o)("sidebar.internalCallExample")),1)])])])])):q("",!0),(V=M.toolInfo)!=null&&V.enableHttpService?(h(),g("div",hi,[s("div",mi,[s("h4",fi,c(r(o)("sidebar.httpCallExample")),1),s("p",vi,c(r(o)("sidebar.httpCallDescription")),1)]),s("div",gi,[s("div",bi,[s("div",yi,[(h(!0),g(oe,null,ae(p.value,K=>(h(),g("button",{key:K.id,class:se(["tab-button",{active:m.value===K.id}]),onClick:ue=>m.value=K.id},c(K.label),11,_i))),128))]),s("div",$i,[(h(!0),g(oe,null,ae(p.value,K=>te((h(),g("div",{key:K.id,class:"tab-panel"},[s("div",Si,[s("div",wi,c(K.method),1),s("div",ki,c(K.endpoint),1),s("div",Ti,c(K.description),1),K.example?(h(),g("div",Pi,[s("strong",null,c(r(o)("sidebar.example"))+":",1),s("pre",Ci,c(K.example),1)])):q("",!0)])])),[[es,m.value===K.id]])),128))])])])])):q("",!0),(H=M.toolInfo)!=null&&H.enableMcpService?(h(),g("div",Ei,[s("div",Ri,[s("h4",Ii,c(r(o)("sidebar.mcpCall")),1),s("p",Ai,c(r(o)("sidebar.mcpCallDescription")),1)]),s("div",xi,[s("div",Di,[s("div",Fi,c(r(o)("sidebar.mcpServiceCall")),1),s("div",Mi,c(r(o)("sidebar.mcpEndpoint"))+": /mcp/execute",1),s("div",Ui,c(r(o)("sidebar.mcpCallUsage")),1),s("div",Ni,[s("strong",null,c(r(o)("sidebar.usage"))+":",1),s("pre",Li,c(r(o)("sidebar.mcpCallExample")),1)])])])])):q("",!0)])])}}}),Oi=de(Bi,[["__scopeId","data-v-29b1330b"]]),qi={class:"sidebar-content"},Vi={class:"sidebar-content-header"},ji={class:"sidebar-content-title"},Hi={class:"tab-switcher"},Gi=["disabled"],Wi={key:0,class:"tab-content"},zi={class:"new-task-section"},Ji={class:"sidebar-content-list"},Ki={key:0,class:"loading-state"},Xi={key:1,class:"error-state"},Qi={key:2,class:"empty-state"},Yi=["onClick"],Zi={class:"task-icon"},ec={class:"task-details"},tc={class:"task-title"},sc={class:"task-preview"},oc={class:"task-time"},nc={class:"task-actions"},ac=["title","onClick"],lc={key:1,class:"tab-content config-tab"},rc={key:0,class:"config-container"},ic={class:"template-info-header"},cc={class:"template-info"},dc={class:"template-id"},uc=["title"],pc=ce({__name:"Sidebar",emits:["planExecutionRequested"],setup(n,{expose:e,emit:t}){const{t:o}=Se(),a=ls(),l=N(80),i=N(!1),u=N(0),f=N(0),d=N(null),m=N({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}),b=N(null),F=N({enabled:!0,success:!0}),B=le(()=>F.value.enabled),S=async()=>{try{const L=await Ae.getCoordinatorToolConfig();F.value=L}catch(L){console.error("Failed to load CoordinatorTool configuration:",L),F.value={enabled:!0,success:!1,message:L instanceof Error?L.message:"Unknown error"}}},$=t,_=async()=>{try{const L=await z.saveTemplate();L!=null&&L.duplicate?a.success(o("sidebar.saveCompleted",{message:L.message,versionCount:L.versionCount})):L!=null&&L.saved?(a.success(o("sidebar.saveSuccess",{message:L.message,versionCount:L.versionCount})),p()):L!=null&&L.message&&a.success(o("sidebar.saveStatus",{message:L.message}))}catch(L){console.error("Failed to save plan modifications:",L),a.error(L.message||o("sidebar.saveFailed"))}},p=async()=>{await new Promise(L=>setTimeout(L,1e3)),console.log("[Sidebar] 🔄 Refreshing parameter requirements for templateId:",z.currentPlanTemplateId),await ge(),d.value?(console.log("[Sidebar] 📞 Calling ExecutionController.loadParameterRequirements()"),d.value.loadParameterRequirements(),setTimeout(()=>{d.value&&(console.log("[Sidebar] 🔄 Retry: Calling ExecutionController.loadParameterRequirements() again"),d.value.loadParameterRequirements())},2e3)):console.warn("[Sidebar] ⚠️ ExecutionController ref not available"),b.value?(console.log("[Sidebar] 📞 Calling PublishMcpServiceModal.loadParameterRequirements()"),b.value.loadParameterRequirements()):console.warn("[Sidebar] ⚠️ PublishMcpServiceModal ref not available")},T=()=>{try{z&&typeof z.rollbackVersion=="function"?z.rollbackVersion():console.warn("sidebarStore or rollbackVersion method is not available")}catch(L){console.error("Error during rollback operation:",L),a.error(o("sidebar.rollbackFailed")||"Rollback failed")}},w=()=>{try{z&&typeof z.restoreVersion=="function"?z.restoreVersion():console.warn("sidebarStore or restoreVersion method is not available")}catch(L){console.error("Error during restore operation:",L),a.error(o("sidebar.restoreFailed")||"Restore failed")}},R=async L=>{var M,Q;console.log("[Sidebar] 🎯 handleExecutePlan called with payload:",JSON.stringify(L,null,2)),console.log("[Sidebar] 📊 Current sidebarStore state:",{currentPlanTemplateId:z.currentPlanTemplateId,selectedTemplate:(M=z.selectedTemplate)==null?void 0:M.id,jsonContent:((Q=z.jsonContent)==null?void 0:Q.substring(0,100))+"..."});try{const O=z.preparePlanExecution();if(console.log("[Sidebar] 📋 Prepared plan data:",JSON.stringify(O,null,2)),!O){console.log("[Sidebar] ❌ No plan data available, returning");return}const G={...O,uploadedFiles:L.uploadedFiles,uploadKey:L.uploadKey};L.replacementParams&&Object.keys(L.replacementParams).length>0&&(console.log("[Sidebar] 🔄 Processing replacement parameters:",L.replacementParams),G.replacementParams=L.replacementParams),console.log("[Sidebar] ✅ Final plan data:",JSON.stringify(G,null,2));const Y={...L,title:G.title,planData:G.planData,params:G.params,uploadedFiles:G.uploadedFiles,uploadKey:G.uploadKey};console.log("[Sidebar] 📤 Emitting planExecutionRequested with final payload:",JSON.stringify(Y,null,2)),$("planExecutionRequested",Y),console.log("[Sidebar] ✅ Event emitted successfully")}catch(O){console.error("[Sidebar] ❌ Error executing plan:",O),a.error(o("sidebar.executeFailed")+": "+O.message)}finally{console.log("[Sidebar] 🧹 Cleaning up after execution"),z.finishPlanExecution(),z.clearExecutionParams(),d.value&&(console.log("[Sidebar] 🧹 Calling ExecutionController.clearExecutionParams"),d.value.clearExecutionParams()),console.log("[Sidebar] ✅ Cleanup completed")}},v=N(!1),P=()=>{if(console.log("[Sidebar] Publish MCP service button clicked"),console.log("[Sidebar] currentPlanTemplateId:",z.currentPlanTemplateId),!z.currentPlanTemplateId){console.log("[Sidebar] No plan template selected, showing warning"),a.error(o("mcpService.selectPlanTemplateFirst"));return}console.log("[Sidebar] Opening publish MCP service modal"),v.value=!0},U=async L=>{L===null?(console.log("MCP service deleted successfully"),a.success(o("mcpService.deleteSuccess")),m.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}):(console.log("MCP service published successfully:",L),a.success(o("mcpService.publishSuccess")),m.value={...L,toolName:L.toolName||"",serviceGroup:L.serviceGroup||""}),console.log("[Sidebar] 🔄 Reloading available tools after service publish/delete"),await z.loadAvailableTools()},W=()=>{z.clearExecutionParams()},E=L=>{z.executionParams=L},x=async L=>{if(!L){m.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""};return}try{const M=await Ae.getCoordinatorToolsByTemplate(L);M?m.value={...M,toolName:M.toolName||"",serviceGroup:M.serviceGroup||""}:m.value={toolName:"",toolDescription:"",planTemplateId:L,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}catch(M){console.error("Failed to load tool information:",M),m.value={toolName:"",toolDescription:"",planTemplateId:L,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}},A=L=>{if(isNaN(L.getTime()))return console.warn("Invalid date received:",L),o("time.unknown");const Q=new Date().getTime()-L.getTime(),O=Math.floor(Q/6e4),G=Math.floor(Q/36e5),Y=Math.floor(Q/864e5);return O<1?o("time.now"):O<60?o("time.minuteAgo",{count:O}):G<24?o("time.hourAgo",{count:G}):Y<30?o("time.dayAgo",{count:Y}):L.toLocaleDateString("zh-CN")},j=(L,M)=>!L||L.length<=M?L:L.substring(0,M)+"...",y=L=>{i.value=!0,u.value=L.clientX,f.value=l.value,document.addEventListener("mousemove",D),document.addEventListener("mouseup",J),document.body.style.cursor="col-resize",document.body.style.userSelect="none",L.preventDefault()},D=L=>{if(!i.value)return;const M=window.innerWidth,O=(L.clientX-u.value)/M*100;let G=f.value+O;G=Math.max(15,Math.min(100,G)),l.value=G},J=()=>{i.value=!1,document.removeEventListener("mousemove",D),document.removeEventListener("mouseup",J),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("sidebarWidth",l.value.toString())},X=()=>{l.value=80,localStorage.setItem("sidebarWidth","80")};return ie(()=>z.currentPlanTemplateId,L=>{x(L)},{immediate:!0}),$e(()=>{z.loadPlanTemplateList(),S(),z.loadAvailableTools();const L=localStorage.getItem("sidebarWidth");L&&(l.value=parseFloat(L))}),_e(()=>{document.removeEventListener("mousemove",D),document.removeEventListener("mouseup",J)}),e({loadPlanTemplateList:z.loadPlanTemplateList,toggleSidebar:z.toggleSidebar,currentPlanTemplateId:z.currentPlanTemplateId}),(L,M)=>{var Q,O;return h(),g(oe,null,[s("div",{class:se(["sidebar-wrapper",{"sidebar-wrapper-collapsed":r(z).isCollapsed}]),style:qe({width:l.value+"%"})},[s("div",qi,[s("div",Vi,[s("div",ji,c(L.$t("sidebar.title")),1)]),s("div",Hi,[s("button",{class:se(["tab-button",{active:r(z).currentTab==="list"}]),onClick:M[0]||(M[0]=G=>r(z).switchToTab("list"))},[k(r(C),{icon:"carbon:list",width:"16"}),ee(" "+c(L.$t("sidebar.templateList")),1)],2),s("button",{class:se(["tab-button",{active:r(z).currentTab==="config"}]),onClick:M[1]||(M[1]=G=>r(z).switchToTab("config")),disabled:!r(z).selectedTemplate},[k(r(C),{icon:"carbon:settings",width:"16"}),ee(" "+c(L.$t("sidebar.configuration")),1)],10,Gi)]),r(z).currentTab==="list"?(h(),g("div",Wi,[s("div",zi,[s("button",{class:"new-task-btn",onClick:M[2]||(M[2]=()=>r(z).createNewTemplate(r(z).planType))},[k(r(C),{icon:"carbon:add",width:"16"}),ee(" "+c(L.$t("sidebar.newPlan"))+" ",1),M[8]||(M[8]=s("span",{class:"shortcut"},"⌘ K",-1))])]),s("div",Ji,[r(z).isLoading?(h(),g("div",Ki,[k(r(C),{icon:"carbon:circle-dash",width:"20",class:"spinning"}),s("span",null,c(L.$t("sidebar.loading")),1)])):r(z).errorMessage?(h(),g("div",Xi,[k(r(C),{icon:"carbon:warning",width:"20"}),s("span",null,c(r(z).errorMessage),1),s("button",{onClick:M[3]||(M[3]=(...G)=>r(z).loadPlanTemplateList&&r(z).loadPlanTemplateList(...G)),class:"retry-btn"},c(L.$t("sidebar.retry")),1)])):r(z).planTemplateList.length===0?(h(),g("div",Qi,[k(r(C),{icon:"carbon:document",width:"32"}),s("span",null,c(L.$t("sidebar.noTemplates")),1)])):(h(!0),g(oe,{key:3},ae(r(z).sortedTemplates,G=>(h(),g("div",{key:G.id,class:se(["sidebar-content-list-item",{"sidebar-content-list-item-active":G.id===r(z).currentPlanTemplateId}]),onClick:Y=>r(z).selectTemplate(G)},[s("div",Zi,[k(r(C),{icon:"carbon:document",width:"20"})]),s("div",ec,[s("div",tc,c(G.title||L.$t("sidebar.unnamedPlan")),1),s("div",sc,c(j(G.description||L.$t("sidebar.noDescription"),40)),1)]),s("div",oc,c(A(r(z).parseDateTime(G.updateTime||G.createTime))),1),s("div",nc,[s("button",{class:"delete-task-btn",title:L.$t("sidebar.deleteTemplate"),onClick:he(Y=>r(z).deleteTemplate(G),["stop"])},[k(r(C),{icon:"carbon:close",width:"16"})],8,ac)])],10,Yi))),128))])])):r(z).currentTab==="config"?(h(),g("div",lc,[r(z).selectedTemplate?(h(),g("div",rc,[s("div",ic,[s("div",cc,[s("h3",null,c(r(z).selectedTemplate.title||L.$t("sidebar.unnamedPlan")),1),s("span",dc,"ID: "+c(r(z).selectedTemplate.id),1)]),s("button",{class:"back-to-list-btn",onClick:M[4]||(M[4]=G=>r(z).switchToTab("list"))},[k(r(C),{icon:"carbon:arrow-left",width:"16"})])]),r(z).planType==="dynamic_agent"?(h(),ne(xr,{key:0,"json-content":r(z).jsonContent,"can-rollback":r(z).canRollback,"can-restore":r(z).canRestore,"is-generating":r(z).isGenerating,"is-executing":r(z).isExecuting,"current-plan-template-id":r(z).currentPlanTemplateId||"",onRollback:T,onRestore:w,onSave:_,"onUpdate:jsonContent":M[5]||(M[5]=G=>r(z).jsonContent=G)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])):(h(),ne(vn,{key:1,"json-content":r(z).jsonContent,"can-rollback":r(z).canRollback,"can-restore":r(z).canRestore,"is-generating":r(z).isGenerating,"is-executing":r(z).isExecuting,"current-plan-template-id":r(z).currentPlanTemplateId||"",onRollback:T,onRestore:w,onSave:_,"onUpdate:jsonContent":M[6]||(M[6]=G=>r(z).jsonContent=G)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])),k(Oi,{ref_key:"executionControllerRef",ref:d,"current-plan-template-id":r(z).currentPlanTemplateId||"","is-executing":r(z).isExecuting,"is-generating":r(z).isGenerating,"show-publish-button":B.value,"tool-info":m.value,onExecutePlan:R,onPublishMcpService:P,onClearParams:W,onUpdateExecutionParams:E},null,8,["current-plan-template-id","is-executing","is-generating","show-publish-button","tool-info"])])):q("",!0)])):q("",!0)]),s("div",{class:"sidebar-resizer",onMousedown:y,onDblclick:X,title:L.$t("sidebar.resizeHint")},M[9]||(M[9]=[s("div",{class:"resizer-line"},null,-1)]),40,uc)],6),k(ko,{ref_key:"publishMcpModalRef",ref:b,modelValue:v.value,"onUpdate:modelValue":M[7]||(M[7]=G=>v.value=G),"plan-template-id":r(z).currentPlanTemplateId||"","plan-title":((Q=r(z).selectedTemplate)==null?void 0:Q.title)||"","plan-description":((O=r(z).selectedTemplate)==null?void 0:O.description)||"",onPublished:U},null,8,["modelValue","plan-template-id","plan-title","plan-description"])],64)}}}),hc=de(pc,[["__scopeId","data-v-36d3da05"]]);class ct{static async handleResponse(e){if(!e.ok)try{const t=await e.json();throw new Error(t.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getMemories(){try{const e=await fetch(`${this.BASE_URL}`);return(await(await this.handleResponse(e)).json()).memories||[]}catch(e){throw console.error("Failed to get memory list:",e),e}}static async getMemory(e){try{const t=await fetch(`${this.BASE_URL}/single?conversationId=${e}`),a=await(await this.handleResponse(t)).json();if(!a.data)throw new Error("Memory not found");return a.data}catch(t){throw console.error("Failed to get memory:",t),t}}static async createMemory(e,t){try{const o=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,memory_name:t})}),l=await(await this.handleResponse(o)).json();if(!l.data)throw new Error("Failed to create memory");return l.data}catch(o){throw console.error("Failed to create memory:",o),o}}static async updateMemory(e,t){try{const o=await fetch(`${this.BASE_URL}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,memory_name:t})}),l=await(await this.handleResponse(o)).json();if(!l.data)throw new Error("Failed to update memory");return l.data}catch(o){throw console.error("Failed to update memory:",o),o}}static async deleteMemory(e){try{const t=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE"});await this.handleResponse(t)}catch(t){throw console.error("Failed to delete memory:",t),t}}static async generateConversationId(){try{const e=await fetch(`${this.BASE_URL}/generate-id`),o=await(await this.handleResponse(e)).json();if(!o.data)throw new Error("Failed to generate conversation ID");return o.data}catch(e){throw console.error("Failed to generate conversation ID:",e),e}}}fe(ct,"BASE_URL","/api/memories");class mc{constructor(){fe(this,"isCollapsed",!1);fe(this,"selectMemoryId","");fe(this,"loadMessages",()=>{});fe(this,"intervalId")}toggleSidebar(){this.isCollapsed=!this.isCollapsed,this.isCollapsed?(this.loadMessages(),this.intervalId=window.setInterval(()=>{this.loadMessages()},3e3)):clearInterval(this.intervalId)}selectMemory(e){this.toggleSidebar(),this.selectMemoryId=e}setMemory(e){this.selectMemoryId=e}defaultMemoryId(){this.selectMemoryId=this.generateRandomId()}clearMemoryId(){this.selectMemoryId=""}generateRandomId(){return Math.random().toString(36).substring(2,10)}setLoadMessages(e){this.loadMessages=e}}const xe=tt(new mc),fc={key:0,class:"app-container"},vc={class:"app-content"},gc={class:"header"},bc={class:"relative"},yc={class:"title-edit-group"},_c={id:"main-title",class:"main-title"},$c={key:0,id:"title-edit-container",class:"title-edit-container"},Sc={class:"search-bar"},wc={class:"search-container"},kc=["placeholder"],Tc={class:"message-list",id:"message-list"},Pc={class:"message-header"},Cc={class:"message-content"},Ec={class:"sender-info"},Rc=["onClick"],Ic={class:"sender-name"},Ac=["onClick"],xc={class:"action-buttons"},Dc=["onClick"],Fc={class:"action-buttons"},Mc=["onClick"],Uc={class:"message-preview"},Nc={class:"preview-line"},Lc={key:0,class:"preview-line",style:{opacity:"0.8"}},Bc={class:"message-meta"},Oc={class:"message-id"},qc={class:"meta-right"},Vc={key:0,class:"unread-count"},jc={class:"message-time"},Hc=["id"],Gc={style:{display:"flex","flex-direction":"column",gap:"0.75rem"}},Wc={class:"bubble-avatar"},zc={class:"bubble-content"},Jc={class:"bubble-text"},Kc={key:0,class:"empty-state"},Xc={class:"modal-content"},Qc={class:"modal-header"},Yc={class:"modal-title"},Zc=["placeholder"],ed={id:"name-char-count",class:"char-count",style:{"text-align":"right",display:"block","margin-top":"0.25rem"}},td={class:"modal-footer"},sd={class:"modal-content"},od={class:"modal-header"},nd={class:"modal-title"},ad={class:"state-text",id:"delete-message"},ld={class:"modal-footer"},rd=ce({__name:"Memory",emits:["memory-selected"],setup(n,{emit:e}){const t=N(!1),o=N(""),a=N([]),l=N([]),i=N(!1),u=N(null),f=N(""),d=N(!1),m=N(null),b=new Map,F=e,B=E=>{E.key==="Escape"&&(d.value?U():i.value&&w())};$e(()=>{xe.setLoadMessages(S),document.addEventListener("keydown",B)}),_e(()=>{document.removeEventListener("keydown",B)});const S=async()=>{try{const E=await ct.getMemories();a.value?a.value=E.map(x=>({...x,expanded:b.has(x.conversation_id)?b.get(x.conversation_id):!1})):a.value=E.map(x=>({...x,expanded:!1})),l.value=[...a.value],p()}catch(E){console.error("error:",E),a.value=[],l.value=[]}},$=E=>{xe.selectMemory(E),F("memory-selected")},_=E=>{const x=typeof E=="string"?parseInt(E,10):E;return isNaN(x)||x<=0?"unknow time":new Date(x.toString().length===13?x:x*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(","," ")},p=()=>{const E=o.value.toLowerCase().trim();if(!E){l.value=[...a.value];return}l.value=a.value.filter(x=>{var D;const A=x.memory_name.toLowerCase().includes(E),j=x.conversation_id.toLowerCase().includes(E),y=((D=x.messages)==null?void 0:D.some(J=>J.text.toLowerCase().includes(E)))||!1;return A||j||y})},T=(E,x)=>{u.value=E,f.value=x,i.value=!0},w=()=>{i.value=!1,u.value=null},R=async()=>{if(!u.value)return;const E=f.value.trim()||"unknow name",x=a.value.findIndex(A=>A.conversation_id===u.value);if(x!==-1){const A=a.value[x];try{const j=await ct.updateMemory(A.conversation_id,E);j.messages||(j.messages=[]),a.value[x]={...j,expanded:A.expanded},p(),i.value=!1}catch(j){console.error("error:",j)}}},v=E=>{const x=a.value.find(A=>A.conversation_id===E);if(x){x.expanded=!x.expanded,b.set(E,x.expanded);const A=l.value.findIndex(j=>j.conversation_id===E);A!==-1&&(l.value[A]={...x})}},P=E=>{m.value=E,d.value=!0},U=()=>{d.value=!1,m.value=null},W=async()=>{if(m.value)try{await ct.deleteMemory(m.value),a.value=a.value.filter(E=>E.conversation_id!==m.value),p(),a.value.length===0&&xe.clearMemoryId(),d.value=!1,m.value=null}catch(E){console.error("error:",E)}};return(E,x)=>(h(),ne(Qe,{to:"body"},[k(Ue,{name:"modal"},{default:Ee(()=>[r(xe).isCollapsed?(h(),g("div",fc,[s("div",vc,[s("div",gc,[s("div",bc,[s("div",yc,[s("h1",_c,[s("span",null,c(E.$t("memory.title")),1)])]),t.value?(h(),g("div",$c)):q("",!0)]),s("button",{class:"close-btn",onClick:x[0]||(x[0]=A=>r(xe).toggleSidebar())},[k(r(C),{icon:"carbon:close"})])]),s("div",Sc,[s("div",wc,[k(r(C),{class:"search-container-icon",icon:"carbon:search"}),te(s("input",{type:"text",placeholder:E.$t("memory.searchPlaceholder"),class:"search-input","onUpdate:modelValue":x[1]||(x[1]=A=>o.value=A),onInput:p},null,40,kc),[[re,o.value]])])]),s("div",Tc,[s("div",null,[(h(!0),g(oe,null,ae(l.value,A=>(h(),g("div",{class:se(["message-item",{expanded:A.expanded}]),key:A.conversation_id},[s("div",Pc,[s("div",Cc,[s("div",Ec,[s("div",{class:"sender-div",onClick:he(j=>$(A.conversation_id),["stop"])},[s("h3",Ic,c(A.memory_name),1)],8,Rc),s("div",{class:"toggle-container",onClick:he(j=>T(A.conversation_id,A.memory_name),["stop"])},[k(r(C),{icon:"carbon:edit",class:"edit-btn"})],8,Ac),s("div",xc,[s("button",{class:"delete-btn",onClick:he(j=>v(A.conversation_id),["stop"])},[k(r(C),{id:"toggle-"+A.conversation_id,icon:"carbon:chevron-down",class:"down-btn"},null,8,["id"])],8,Dc)]),s("div",Fc,[s("button",{class:"delete-btn",onClick:he(j=>P(A.conversation_id),["stop"])},[k(r(C),{icon:"carbon:delete"})],8,Mc)])]),s("div",Uc,[s("p",Nc,c(A.messages&&A.messages.length>0?A.messages[0].text:"none message"),1),A.messages&&A.messages.length>1?(h(),g("p",Lc,c(A.messages[1].text),1)):q("",!0)]),s("div",Bc,[s("span",Oc,"ID: "+c(A.conversation_id),1),s("div",qc,[A.messages&&A.messages.length>0?(h(),g("span",Vc,c(A.messages.length)+" "+c(E.$t("memory.size")),1)):q("",!0),s("span",jc,c(_(A.create_time)),1)])])])]),A.expanded?(h(),g("div",{key:0,id:"content-"+A.conversation_id,class:"expanded-content"},[s("div",Gc,[(h(!0),g(oe,null,ae(A.messages,(j,y)=>(h(),g("div",{class:"message-bubble",key:y},[s("div",Wc,c(j.messageType),1),s("div",zc,[s("p",Jc,c(j.text),1)])]))),128))])],8,Hc)):q("",!0)],2))),128))]),l.value.length===0&&o.value?(h(),g("div",Kc,x[3]||(x[3]=[s("p",{class:"state-text"},"none message",-1)]))):q("",!0)]),i.value?(h(),g("div",{key:0,id:"name-edit-modal",class:"modal-overlay",onClick:he(w,["self"])},[s("div",Xc,[s("div",Qc,[s("h3",Yc,c(E.$t("memory.changeName")),1),te(s("input",{type:"text","onUpdate:modelValue":x[2]||(x[2]=A=>f.value=A),class:"edit-input",placeholder:E.$t("memory.newNamePlaceholder")},null,8,Zc),[[re,f.value]]),s("span",ed,c(f.value.length),1)]),s("div",td,[s("button",{id:"cancel-name",class:"modal-btn cancel-btn",onClick:w},c(E.$t("memory.cancel")),1),s("button",{id:"save-name",class:"modal-btn confirm-btn",onClick:R},c(E.$t("memory.save")),1)])])])):q("",!0),d.value?(h(),g("div",{key:1,id:"delete-modal",class:"modal-overlay",onClick:he(U,["self"])},[s("div",sd,[s("div",od,[s("h3",nd,c(E.$t("memory.deleteHint")),1),s("p",ad,c(E.$t("memory.deleteHintPrefix"))+" "+c(m.value)+" "+c(E.$t("memory.deleteHintSuffix")),1)]),s("div",ld,[s("button",{id:"cancel-delete",class:"modal-btn cancel-btn",onClick:U},c(E.$t("memory.cancel")),1),s("button",{id:"confirm-delete",class:"modal-btn delete-btn-confirm",onClick:W},c(E.$t("memory.delete")),1)])])])):q("",!0)])])):q("",!0)]),_:1})]))}}),id=de(rd,[["__scopeId","data-v-ca286acb"]]),cd="/api/executor";async function Fs(n){try{const e=await fetch(`${cd}/agent-execution/${n}`);if(!e.ok){if(e.status===404)return console.warn(`Agent execution detail not found for stepId: ${n}`),null;throw new Error(`HTTP error! status: ${e.status}`)}return await e.json()}catch(e){return console.error(`Error fetching agent execution detail for stepId: ${n}:`,e),null}}async function dd(n){return console.log(`Refreshing agent execution detail for stepId: ${n}`),Fs(n)}class De{static async handleResponse(e){if(!e.ok)try{const t=await e.json();throw new Error(t.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getFileTree(e){try{const t=await fetch(`${this.BASE_URL}/tree/${e}`),a=await(await this.handleResponse(t)).json();if(!a.success)throw new Error(a.message||"Failed to get file tree");return a.data}catch(t){throw console.error("Failed to get file tree:",t),t}}static async getFileContent(e,t){try{const o=await fetch(`${this.BASE_URL}/content/${e}?path=${encodeURIComponent(t)}`),l=await(await this.handleResponse(o)).json();if(!l.success)throw new Error(l.message||"Failed to get file content");return l.data}catch(o){throw console.error("Failed to get file content:",o),o}}static async downloadFile(e,t,o){try{const a=await fetch(`${this.BASE_URL}/download/${e}?path=${encodeURIComponent(t)}`);await this.handleResponse(a);const l=await a.blob(),i=window.URL.createObjectURL(l),u=document.createElement("a");u.href=i,u.download=o||t.split("/").pop()||"download",document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(i),document.body.removeChild(u)}catch(a){throw console.error("Failed to download file:",a),a}}static isTextFile(e,t){const o=["text/","application/json","application/xml","application/javascript","application/typescript"],a=[".txt",".md",".json",".xml",".html",".css",".js",".ts",".vue",".jsx",".tsx",".py",".java",".cpp",".c",".h",".sh",".bat",".yml",".yaml",".properties",".conf",".cfg"];if(o.some(i=>e.startsWith(i)))return!0;const l=t.toLowerCase();return a.some(i=>l.endsWith(i))}static getFileIcon(e){if(e.type==="directory")return"carbon:folder";const t=e.name.toLowerCase();return t.endsWith(".js")?"vscode-icons:file-type-js":t.endsWith(".ts")?"vscode-icons:file-type-typescript":t.endsWith(".vue")?"vscode-icons:file-type-vue":t.endsWith(".java")?"vscode-icons:file-type-java":t.endsWith(".py")?"vscode-icons:file-type-python":t.endsWith(".json")?"vscode-icons:file-type-json":t.endsWith(".xml")?"vscode-icons:file-type-xml":t.endsWith(".html")?"vscode-icons:file-type-html":t.endsWith(".css")?"vscode-icons:file-type-css":t.endsWith(".md")?"vscode-icons:file-type-markdown":t.endsWith(".yml")||t.endsWith(".yaml")?"vscode-icons:file-type-yaml":t.endsWith(".pdf")?"vscode-icons:file-type-pdf2":t.endsWith(".doc")||t.endsWith(".docx")?"vscode-icons:file-type-word":t.endsWith(".xls")||t.endsWith(".xlsx")?"vscode-icons:file-type-excel":t.endsWith(".ppt")||t.endsWith(".pptx")?"vscode-icons:file-type-powerpoint":t.match(/\.(jpg|jpeg|png|gif|bmp|svg)$/)?"carbon:image":t.match(/\.(zip|rar|7z|tar|gz)$/)?"carbon:archive":"carbon:document"}}fe(De,"BASE_URL","/api/file-browser");const ud={class:"file-tree-node"},pd={class:"node-icon"},hd={class:"node-name"},md={key:1,class:"file-size"},fd={key:2,class:"node-actions"},vd={key:0,class:"children"},gd=ce({__name:"FileTreeNode",props:{node:{},level:{}},emits:["file-selected","download-file"],setup(n,{emit:e}){const t=n,o=e,a=N(t.level===0),l=N(!1),i=N(!1),u=N({}),f=()=>{t.node.type==="directory"&&(a.value=!a.value)},d=()=>{t.node.type==="directory"?f():m()},m=()=>{t.node.type==="file"&&o("file-selected",t.node),B()},b=()=>{o("download-file",t.node),B()},F=p=>{p.preventDefault(),i.value=!0,u.value={position:"fixed",top:`${p.clientY}px`,left:`${p.clientX}px`,zIndex:1e3},setTimeout(()=>{document.addEventListener("click",B)},0)},B=()=>{i.value=!1,document.removeEventListener("click",B)},S=async()=>{try{await navigator.clipboard.writeText(t.node.path)}catch(p){console.error("Failed to copy path:",p)}B()},$=()=>t.node.type==="directory"?a.value?"carbon:folder-open":"carbon:folder":De.getFileIcon(t.node),_=p=>{if(p===0)return"0 B";const T=1024,w=["B","KB","MB","GB"],R=Math.floor(Math.log(p)/Math.log(T));return parseFloat((p/Math.pow(T,R)).toFixed(1))+" "+w[R]};return _e(()=>{document.removeEventListener("click",B)}),(p,T)=>{const w=ts("FileTreeNode",!0);return h(),g("div",ud,[s("div",{class:se(["node-content",{"is-directory":p.node.type==="directory","is-file":p.node.type==="file","is-expanded":a.value}]),style:qe({paddingLeft:`${p.level*16+12}px`}),onClick:d,onContextmenu:he(F,["prevent"])},[p.node.type==="directory"?(h(),g("div",{key:0,class:"expand-icon",onClick:he(f,["stop"])},[k(r(C),{icon:a.value?"carbon:chevron-down":"carbon:chevron-right",class:"chevron-icon"},null,8,["icon"])])):q("",!0),s("div",pd,[k(r(C),{icon:$()},null,8,["icon"])]),s("span",hd,c(p.node.name),1),p.node.type==="file"?(h(),g("span",md,c(_(p.node.size)),1)):q("",!0),l.value?(h(),g("div",fd,[p.node.type==="file"?(h(),g("button",{key:0,onClick:T[0]||(T[0]=he(R=>p.$emit("download-file",p.node),["stop"])),class:"action-btn download-btn",title:"Download"},[k(r(C),{icon:"carbon:download"})])):q("",!0)])):q("",!0)],38),p.node.type==="directory"&&a.value&&p.node.children?(h(),g("div",vd,[(h(!0),g(oe,null,ae(p.node.children,R=>(h(),ne(w,{key:R.path,node:R,level:p.level+1,onFileSelected:T[1]||(T[1]=v=>p.$emit("file-selected",v)),onDownloadFile:T[2]||(T[2]=v=>p.$emit("download-file",v))},null,8,["node","level"]))),128))])):q("",!0),i.value?(h(),g("div",{key:1,class:"context-menu",style:qe(u.value),onClick:T[3]||(T[3]=he(()=>{},["stop"]))},[s("div",{class:"context-menu-item",onClick:m},[k(r(C),{icon:"carbon:view"}),T[4]||(T[4]=s("span",null,"Open",-1))]),p.node.type==="file"?(h(),g("div",{key:0,class:"context-menu-item",onClick:b},[k(r(C),{icon:"carbon:download"}),T[5]||(T[5]=s("span",null,"Download",-1))])):q("",!0),T[7]||(T[7]=s("div",{class:"context-menu-divider"},null,-1)),s("div",{class:"context-menu-item",onClick:S},[k(r(C),{icon:"carbon:copy"}),T[6]||(T[6]=s("span",null,"Copy Path",-1))])],4)):q("",!0)])}}}),bd=de(gd,[["__scopeId","data-v-e4a376d5"]]),yd={class:"file-browser"},_d={class:"file-browser-header"},$d={class:"header-actions"},Sd=["disabled","title"],wd={class:"file-browser-content"},kd={class:"file-tree-panel"},Td={key:0,class:"loading-state"},Pd={key:1,class:"error-state"},Cd={key:0,class:"waiting-for-files"},Ed={class:"message-content"},Rd={class:"tips"},Id=["disabled"],Ad={key:1,class:"actual-error"},xd={key:2,class:"empty-state"},Dd={key:3,class:"file-tree"},Fd={key:0,class:"file-content-panel"},Md={class:"file-content-header"},Ud={class:"file-info"},Nd={class:"file-name"},Ld={class:"file-size"},Bd={class:"file-actions"},Od=["title"],qd=["title"],Vd={class:"file-content-body"},jd={key:0,class:"loading-content"},Hd={key:1,class:"content-error"},Gd={key:2,class:"file-content"},Wd={key:0,class:"text-content"},zd={key:1,class:"binary-content"},Jd=ce({__name:"index",props:{planId:{}},setup(n){const e=n,{t}=Se(),o=N(!1),a=N(null),l=N(null),i=N(null),u=N(null),f=N(!1),d=N(null),m=N(null),b=le(()=>!u.value||!i.value?!1:De.isTextFile(u.value.mimeType,i.value.name)),F=le(()=>a.value&&(a.value.includes("Plan directory not found")||a.value.includes("not found"))),B=()=>{m.value&&(clearTimeout(m.value),m.value=null)},S=()=>{B(),m.value=window.setTimeout(()=>{F.value&&$()},5e3)},$=async()=>{if(e.planId){o.value=!0,a.value=null,B();try{l.value=await De.getFileTree(e.planId)}catch(v){a.value=v instanceof Error?v.message:t("fileBrowser.loadError"),console.error("Failed to load file tree:",v);const P=v instanceof Error?v.message:"";(P.includes("Plan directory not found")||P.includes("not found"))&&S()}finally{o.value=!1}}},_=async v=>{if(v.type!=="directory"){i.value=v,u.value=null,f.value=!0,d.value=null;try{u.value=await De.getFileContent(e.planId,v.path)}catch(P){d.value=P instanceof Error?P.message:t("fileBrowser.contentLoadError"),console.error("Failed to load file content:",P)}finally{f.value=!1}}},p=async v=>{try{await De.downloadFile(e.planId,v.path,v.name)}catch(P){console.error("Failed to download file:",P)}},T=()=>{i.value=null,u.value=null,d.value=null},w=v=>De.getFileIcon(v),R=v=>{if(v===0)return"0 B";const P=1024,U=["B","KB","MB","GB"],W=Math.floor(Math.log(v)/Math.log(P));return parseFloat((v/Math.pow(P,W)).toFixed(1))+" "+U[W]};return ie(()=>e.planId,v=>{v&&(i.value=null,u.value=null,$())},{immediate:!0}),$e(()=>{e.planId&&$()}),_e(()=>{B()}),(v,P)=>(h(),g("div",yd,[s("div",_d,[s("h3",null,c(v.$t("fileBrowser.title")),1),s("div",$d,[s("button",{class:"refresh-btn",onClick:$,disabled:o.value,title:v.$t("fileBrowser.refresh")},[k(r(C),{icon:"carbon:refresh",class:se({rotating:o.value}),style:{color:"#ffffff",fontSize:"18px",width:"18px",height:"18px"}},null,8,["class"])],8,Sd)])]),s("div",wd,[s("div",kd,[o.value?(h(),g("div",Td,[k(r(C),{icon:"carbon:loading",class:"rotating"}),s("span",null,c(v.$t("fileBrowser.loading")),1)])):a.value?(h(),g("div",Pd,[F.value?(h(),g("div",Cd,[k(r(C),{icon:"carbon:time",class:"rotating"}),s("div",Ed,[s("h3",null,c(v.$t("fileBrowser.waitingForGeneration")),1),s("p",null,c(v.$t("fileBrowser.planExecuting")),1),s("div",Rd,[k(r(C),{icon:"carbon:information"}),s("span",null,c(v.$t("fileBrowser.filesTip")),1)])]),s("button",{onClick:$,class:"retry-btn",disabled:o.value},[k(r(C),{icon:"carbon:refresh",class:se({rotating:o.value})},null,8,["class"]),ee(" "+c(o.value?v.$t("fileBrowser.checking"):v.$t("fileBrowser.checkNow")),1)],8,Id)])):(h(),g("div",Ad,[k(r(C),{icon:"carbon:warning"}),s("span",null,c(a.value),1),s("button",{onClick:$,class:"retry-btn"},c(v.$t("fileBrowser.retry")),1)]))])):l.value?(h(),g("div",Dd,[k(bd,{node:l.value,level:0,onFileSelected:_,onDownloadFile:p},null,8,["node"])])):(h(),g("div",xd,[k(r(C),{icon:"carbon:folder-off"}),s("span",null,c(v.$t("fileBrowser.noFiles")),1)]))]),i.value?(h(),g("div",Fd,[s("div",Md,[s("div",Ud,[k(r(C),{icon:w(i.value)},null,8,["icon"]),s("span",Nd,c(i.value.name),1),s("span",Ld,"("+c(R(i.value.size))+")",1)]),s("div",Bd,[s("button",{onClick:P[0]||(P[0]=U=>p(i.value)),class:"download-btn",title:v.$t("fileBrowser.download")},[k(r(C),{icon:"carbon:download"})],8,Od),s("button",{onClick:T,class:"close-btn",title:v.$t("common.close")},[k(r(C),{icon:"carbon:close"})],8,qd)])]),s("div",Vd,[f.value?(h(),g("div",jd,[k(r(C),{icon:"carbon:loading",class:"rotating"}),s("span",null,c(v.$t("fileBrowser.loadingContent")),1)])):d.value?(h(),g("div",Hd,[k(r(C),{icon:"carbon:warning"}),s("span",null,c(d.value),1)])):u.value?(h(),g("div",Gd,[b.value?(h(),g("div",Wd,[s("pre",null,[s("code",null,c(u.value.content),1)])])):(h(),g("div",zd,[k(r(C),{icon:"carbon:document-unknown"}),s("p",null,c(v.$t("fileBrowser.binaryFile")),1),s("button",{onClick:P[1]||(P[1]=U=>p(i.value)),class:"download-btn-large"},[k(r(C),{icon:"carbon:download"}),ee(" "+c(v.$t("fileBrowser.downloadToView")),1)])]))])):q("",!0)])])):q("",!0)])]))}}),Kd=de(Jd,[["__scopeId","data-v-e7c74fe4"]]),Xd={class:"right-panel"},Qd={class:"preview-header"},Yd={class:"preview-tabs"},Zd={class:"preview-content"},eu={key:0,class:"step-details"},tu={key:0,class:"step-info"},su={key:0,class:"agent-info"},ou={class:"info-item"},nu={class:"label"},au={class:"value"},lu={class:"info-item"},ru={class:"label"},iu={class:"value"},cu={class:"info-item"},du={class:"label"},uu={class:"execution-status"},pu={class:"status-item"},hu={class:"status-text"},mu={key:0},fu={key:0,class:"think-act-steps"},vu={class:"steps-container"},gu={class:"step-header"},bu={class:"step-number"},yu={class:"think-section"},_u={class:"think-content"},$u={class:"input"},Su={class:"label"},wu={class:"output"},ku={class:"label"},Tu={key:0,class:"action-section"},Pu={class:"action-content"},Cu={class:"tool-info"},Eu={class:"label"},Ru={class:"value"},Iu={class:"input"},Au={class:"label"},xu={class:"output"},Du={class:"label"},Fu={key:0,class:"sub-plan-section"},Mu={class:"sub-plan-content"},Uu={class:"sub-plan-header"},Nu={class:"sub-plan-info"},Lu={class:"label"},Bu={class:"value"},Ou={key:0,class:"sub-plan-info"},qu={class:"label"},Vu={class:"value"},ju={class:"sub-plan-status"},Hu={class:"status-text"},Gu={key:0,class:"no-steps-message"},Wu={key:1,class:"no-execution-message"},zu={class:"step-basic-info"},Ju={class:"info-item"},Ku={class:"label"},Xu={class:"value"},Qu={key:0,class:"info-item"},Yu={class:"label"},Zu={class:"value"},ep={class:"info-item"},tp={class:"label"},sp={class:"no-execution-hint"},op={key:2,class:"execution-indicator"},np={class:"execution-text"},ap={key:1,class:"no-selection"},lp=["title"],rp={key:1,class:"file-browser-container"},ip={key:1,class:"no-plan-message"},cp={class:"message-content"},dp={class:"tips"},up=ce({__name:"RightPanel",props:{currentRootPlanId:{},selectedStepId:{}},setup(n,{expose:e}){const t=n,{t:o}=Se(),a=N(),l=N(),i=N("details"),u=N(localStorage.getItem("jmanus-last-plan-id")),f=N(localStorage.getItem("jmanus-has-executed-plan")==="true"),d=N(!1),m=N(!0),b=N(!0),F=le(()=>l.value?l.value.completed?o("rightPanel.status.completed"):l.value.current?o("rightPanel.status.executing"):o("rightPanel.status.waiting"):""),B=le(()=>t.currentRootPlanId?t.currentRootPlanId:u.value),S=le(()=>!B.value&&!f.value),$=async E=>{var x,A,j;if(console.log("[RightPanel] Step selected:",{stepId:E}),!E){console.warn("[RightPanel] No stepId provided"),l.value=null;return}try{const y=await Fs(E);if(!y){console.warn("[RightPanel] Agent execution detail not found for stepId:",E),l.value=null;return}const D={stepId:E,title:y.agentName||`Step ${E}`,description:y.agentDescription||"",agentExecution:y,completed:y.status==="FINISHED",current:y.status==="RUNNING"};l.value=D,console.log("[RightPanel] Step details updated:",D),console.log("[RightPanel] activeTab:",i.value),console.log("[RightPanel] selectedStep.value:",l.value),console.log("[RightPanel] agentExecution:",l.value.agentExecution),console.log("[RightPanel] thinkActSteps:",(x=l.value.agentExecution)==null?void 0:x.thinkActSteps),console.log("[RightPanel] thinkActSteps length:",(j=(A=l.value.agentExecution)==null?void 0:A.thinkActSteps)==null?void 0:j.length),await ge(),console.log("[RightPanel] After nextTick - selectedStep:",l.value),setTimeout(()=>{T()},100),R()}catch(y){console.error("[RightPanel] Error fetching step details:",y),l.value=null}},_=async()=>{var E;if(!((E=l.value)!=null&&E.stepId)){console.warn("[RightPanel] No step selected for refresh");return}console.log("[RightPanel] Refreshing current step:",l.value.stepId);try{const x=await dd(l.value.stepId);x&&l.value&&(l.value.agentExecution=x,l.value.completed=x.status==="FINISHED",l.value.current=x.status==="RUNNING",console.log("[RightPanel] Step refreshed successfully"),R())}catch(x){console.error("[RightPanel] Error refreshing step:",x)}};ie(()=>t.selectedStepId,async E=>{E?await $(E):l.value=null},{immediate:!0});const p=E=>{a.value=E??void 0},T=()=>{if(!a.value)return;const{scrollTop:E,scrollHeight:x,clientHeight:A}=a.value,j=x-E-A<50,y=x>A;m.value=j,d.value=y&&!j,j?b.value=!0:x-E-A>100&&(b.value=!1),console.log("[RightPanel] Scroll state check:",{scrollTop:E,scrollHeight:x,clientHeight:A,isAtBottom:j,hasScrollableContent:y,showButton:d.value,shouldAutoScroll:b.value})},w=()=>{a.value&&(a.value.scrollTo({top:a.value.scrollHeight,behavior:"smooth"}),ge(()=>{b.value=!0,T()}))},R=()=>{!b.value||!a.value||ge(()=>{a.value&&(a.value.scrollTop=a.value.scrollHeight,console.log("[RightPanel] Auto scroll to bottom"))})},v=E=>{if(E===null||typeof E>"u"||E==="")return"N/A";try{const x=typeof E=="object"?E:JSON.parse(E);return JSON.stringify(x,null,2)}catch{return String(E)}},P=()=>{l.value=null,b.value=!0,a.value&&a.value.removeEventListener("scroll",T)},U=()=>{const E=()=>{const x=a.value;return x?(p(x),x.addEventListener("scroll",T),b.value=!0,T(),console.log("[RightPanel] Scroll listener initialized successfully"),!0):(console.log("[RightPanel] Scroll container not found, retrying..."),!1)};ge(()=>{E()||setTimeout(()=>{E()},100)})};return ie(()=>t.currentRootPlanId,(E,x)=>{E&&E!==x?(u.value=E,f.value=!0,localStorage.setItem("jmanus-last-plan-id",E),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] New plan started:",E)):!E&&x&&console.log("[RightPanel] Plan execution finished, keeping last plan:",u.value)},{immediate:!0}),$e(()=>{console.log("[RightPanel] Component mounted"),ge(()=>{U()})}),_e(()=>{console.log("[RightPanel] Component unmounting, cleaning up..."),P()}),e({handleStepSelected:$,refreshCurrentStep:_,updateDisplayedPlanProgress:E=>{console.log("[RightPanel] updateDisplayedPlanProgress called with rootPlanId:",E),E&&(u.value=E,f.value=!0,localStorage.setItem("jmanus-last-plan-id",E),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] Plan progress updated:",E))}}),(E,x)=>{var A,j;return h(),g("div",Xd,[s("div",Qd,[s("div",Yd,[s("div",{class:se(["tab-item",{active:i.value==="details"}]),onClick:x[0]||(x[0]=y=>i.value="details")},[k(r(C),{icon:"carbon:events"}),s("span",null,c(r(o)("rightPanel.stepExecutionDetails")),1)],2),s("div",{class:se(["tab-item",{active:i.value==="files"}]),onClick:x[1]||(x[1]=y=>i.value="files")},[k(r(C),{icon:"carbon:folder"}),s("span",null,c(r(o)("fileBrowser.title")),1)],2)])]),s("div",Zd,[i.value==="details"?(h(),g("div",eu,[l.value?(h(),g("div",tu,[s("h3",null,c(l.value.title||l.value.description||r(o)("rightPanel.defaultStepTitle",{number:1})),1),l.value.agentExecution?(h(),g("div",su,[s("div",ou,[s("span",nu,c(r(o)("rightPanel.executingAgent"))+":",1),s("span",au,c(l.value.agentExecution.agentName),1)]),s("div",lu,[s("span",ru,c(r(o)("rightPanel.callingModel"))+":",1),s("span",iu,c(l.value.agentExecution.modelName),1)]),s("div",cu,[s("span",du,c(r(o)("rightPanel.executionResult"))+":",1),s("span",{class:se(["value",{success:l.value.agentExecution.status==="FINISHED"}])},c(l.value.agentExecution.status||r(o)("rightPanel.executing")),3)])])):q("",!0),s("div",uu,[s("div",pu,[l.value.completed?(h(),ne(r(C),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):l.value.current?(h(),ne(r(C),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})):(h(),ne(r(C),{key:2,icon:"carbon:time",class:"status-icon pending"})),s("span",hu,c(F.value),1)])])])):q("",!0),s("div",{ref_key:"scrollContainer",ref:a,class:"step-details-scroll-container",onScroll:T},[l.value?(h(),g("div",mu,[(A=l.value.agentExecution)!=null&&A.thinkActSteps&&l.value.agentExecution.thinkActSteps.length>0?(h(),g("div",fu,[s("h4",null,c(r(o)("rightPanel.thinkAndActionSteps")),1),s("div",vu,[(h(!0),g(oe,null,ae(l.value.agentExecution.thinkActSteps,(y,D)=>(h(),g("div",{key:D,class:"think-act-step"},[s("div",gu,[s("span",bu,"#"+c(D+1),1),s("span",{class:se(["step-status",y.status])},c(y.status||r(o)("rightPanel.executing")),3)]),s("div",yu,[s("h5",null,[k(r(C),{icon:"carbon:thinking"}),ee(" "+c(r(o)("rightPanel.thinking")),1)]),s("div",_u,[s("div",$u,[s("span",Su,c(r(o)("rightPanel.input"))+":",1),s("pre",null,c(v(y.thinkInput)),1)]),s("div",wu,[s("span",ku,c(r(o)("rightPanel.output"))+":",1),s("pre",null,c(v(y.thinkOutput)),1)])])]),y.actionNeeded?(h(),g("div",Tu,[s("h5",null,[k(r(C),{icon:"carbon:play"}),ee(" "+c(r(o)("rightPanel.action")),1)]),s("div",Pu,[(h(!0),g(oe,null,ae(y.actToolInfoList,(J,X)=>(h(),g("div",{key:X},[s("div",Cu,[s("span",Eu,c(r(o)("rightPanel.tool"))+":",1),s("span",Ru,c(J.name||""),1)]),s("div",Iu,[s("span",Au,c(r(o)("rightPanel.toolParameters"))+":",1),s("pre",null,c(v(J.parameters)),1)]),s("div",xu,[s("span",Du,c(r(o)("rightPanel.executionResult"))+":",1),s("pre",null,c(v(J.result)),1)])]))),128))]),y.subPlanExecutionRecord?(h(),g("div",Fu,[s("h5",null,[k(r(C),{icon:"carbon:tree-view"}),ee(" "+c(r(o)("rightPanel.subPlan")),1)]),s("div",Mu,[s("div",Uu,[s("div",Nu,[s("span",Lu,c(E.$t("rightPanel.subPlanId"))+":",1),s("span",Bu,c(y.subPlanExecutionRecord.currentPlanId),1)]),y.subPlanExecutionRecord.title?(h(),g("div",Ou,[s("span",qu,c(E.$t("rightPanel.title"))+":",1),s("span",Vu,c(y.subPlanExecutionRecord.title),1)])):q("",!0),s("div",ju,[y.subPlanExecutionRecord.completed?(h(),ne(r(C),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):(h(),ne(r(C),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})),s("span",Hu,c(y.subPlanExecutionRecord.completed?E.$t("rightPanel.status.completed"):E.$t("rightPanel.status.executing")),1)])])])])):q("",!0)])):q("",!0)]))),128))]),l.value.agentExecution&&!((j=l.value.agentExecution.thinkActSteps)!=null&&j.length)?(h(),g("div",Gu,[s("p",null,c(r(o)("rightPanel.noStepDetails")),1)])):l.value.agentExecution?q("",!0):(h(),g("div",Wu,[k(r(C),{icon:"carbon:information",class:"info-icon"}),s("h4",null,c(r(o)("rightPanel.stepInfo")),1),s("div",zu,[s("div",Ju,[s("span",Ku,c(r(o)("rightPanel.stepName"))+":",1),s("span",Xu,c(l.value.title||l.value.description||l.value.stepId),1)]),l.value.description?(h(),g("div",Qu,[s("span",Yu,c(E.$t("rightPanel.description"))+":",1),s("span",Zu,c(l.value.description),1)])):q("",!0),s("div",ep,[s("span",tp,c(E.$t("rightPanel.status.label"))+":",1),s("span",{class:se(["value",{"status-completed":l.value.completed,"status-current":l.value.current,"status-pending":!l.value.completed&&!l.value.current}])},c(l.value.completed?E.$t("rightPanel.status.completed"):l.value.current?E.$t("rightPanel.status.executing"):E.$t("rightPanel.status.pending")),3)])]),s("p",sp,c(r(o)("rightPanel.noExecutionInfo")),1)])),l.value.current&&!l.value.completed?(h(),g("div",op,[x[2]||(x[2]=s("div",{class:"execution-waves"},[s("div",{class:"wave wave-1"}),s("div",{class:"wave wave-2"}),s("div",{class:"wave wave-3"})],-1)),s("p",np,[k(r(C),{icon:"carbon:in-progress",class:"rotating-icon"}),ee(" "+c(r(o)("rightPanel.stepExecuting")),1)])])):q("",!0)])):(h(),g("div",ap,[k(r(C),{icon:"carbon:events",class:"empty-icon"}),s("h3",null,c(r(o)("rightPanel.noStepSelected")),1),s("p",null,c(r(o)("rightPanel.selectStepHint")),1)]))])):q("",!0),k(Ue,{name:"scroll-button"},{default:Ee(()=>[d.value?(h(),g("button",{key:0,onClick:w,class:"scroll-to-bottom-btn",title:r(o)("rightPanel.scrollToBottom")},[k(r(C),{icon:"carbon:chevron-down"})],8,lp)):q("",!0)]),_:1})],544)])):q("",!0),i.value==="files"?(h(),g("div",rp,[B.value?(h(),ne(Kd,{key:0,"plan-id":B.value},null,8,["plan-id"])):S.value?(h(),g("div",ip,[k(r(C),{icon:"carbon:folder-off"}),s("div",cp,[s("h3",null,c(r(o)("fileBrowser.noFilesYet")),1),s("p",null,c(r(o)("fileBrowser.noPlanExecuting")),1),s("div",dp,[k(r(C),{icon:"carbon:information"}),s("span",null,c(r(o)("fileBrowser.startTaskTip")),1)])])])):q("",!0)])):q("",!0)])])}}}),pp=de(up,[["__scopeId","data-v-ea214380"]]);function Nt(){return{formatResponseText:f=>f?f.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\n/g,"<br>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>"):"",formatTimestamp:f=>{const m=new Date().getTime()-f.getTime();return m<6e4?"Just now":m<36e5?`${Math.floor(m/6e4)} minutes ago`:m<864e5?`${Math.floor(m/36e5)} hours ago`:f.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},getMessageClasses:f=>le(()=>({user:f.type==="user",assistant:f.type==="assistant",streaming:f.isStreaming,"has-error":!!f.error,"has-thinking":!!f.thinking,"has-execution":!!f.planExecution})),formatFileSize:f=>{if(f===0)return"0 B";const d=1024,m=["B","KB","MB","GB"],b=Math.floor(Math.log(f)/Math.log(d));return parseFloat((f/Math.pow(d,b)).toFixed(2))+" "+m[b]},truncateText:(f,d=100)=>!f||f.length<=d?f:f.substring(0,d)+"...",stripHtml:f=>f.replace(/<[^>]*>/g,""),hasDisplayableContent:f=>!!(f.content||f.thinking||f.planExecution||f.error),getMessageStatus:f=>f.error?"Send failed":f.isStreaming?"Typing...":f.type==="assistant"&&!f.content&&!f.thinking?"Waiting for response":""}}const hp=["data-message-id"],mp={class:"user-content"},fp={class:"message-text"},vp={key:0,class:"attachments"},gp={class:"attachment-name"},bp={class:"attachment-size"},yp={class:"message-timestamp"},_p={key:0,class:"message-status error"},$p={class:"status-text"},Sp=ce({__name:"UserMessage",props:{message:{}},setup(n){const{formatTimestamp:e,formatFileSize:t}=Nt();return(o,a)=>{var l;return h(),g("div",{class:"user-message","data-message-id":o.message.id},[s("div",mp,[s("div",fp,c(o.message.content),1),(l=o.message.attachments)!=null&&l.length?(h(),g("div",vp,[(h(!0),g(oe,null,ae(o.message.attachments,(i,u)=>(h(),g("div",{key:u,class:"attachment-item"},[k(r(C),{icon:"carbon:document",class:"attachment-icon"}),s("span",gp,c(i.name),1),s("span",bp,c(r(t)(i.size)),1)]))),128))])):q("",!0),s("div",yp,c(r(e)(o.message.timestamp)),1)]),o.message.error?(h(),g("div",_p,[k(r(C),{icon:"carbon:warning",class:"status-icon"}),s("span",$p,c(o.message.error),1)])):q("",!0)],8,hp)}}}),wp=de(Sp,[["__scopeId","data-v-94372507"]]),kp={class:"sub-plan-info"},Tp={class:"sub-plan-details"},Pp={class:"sub-plan-title"},Cp={key:0,class:"nesting-level"},Ep={class:"sub-plan-id"},Rp={class:"sub-plan-meta"},Ip={key:0,class:"trigger-tool"},Ap={class:"trigger-text"},xp={key:0,class:"sub-plan-progress"},Dp={class:"progress-info"},Fp={class:"progress-text"},Mp={class:"progress-bar"},Up={key:1,class:"sub-plan-agents-steps"},Np={class:"agents-steps-header"},Lp={class:"agents-label"},Bp={class:"agents-steps-list"},Op=["onClick"],qp={class:"agent-step-header"},Vp={class:"agent-name"},jp={class:"sub-agent-execution-info"},Hp={key:0,class:"agent-result"},Gp={class:"result-header"},Wp={class:"result-label"},zp={class:"result-content"},Jp={key:1,class:"agent-error"},Kp={class:"error-header"},Xp={class:"error-label"},Qp={class:"error-content"},Yp={key:2,class:"think-act-preview"},Zp={class:"think-act-header"},eh={class:"think-act-label"},th={class:"think-act-steps-preview"},sh=["onClick"],oh={class:"step-number"},nh={class:"step-description"},ah={key:0,class:"more-steps"},lh={class:"more-steps-text"},rh={key:3,class:"nested-sub-plans"},ih={class:"nested-sub-plans-header"},ch={class:"nested-label"},dh={class:"nested-sub-plans-list"},uh={key:4,class:"direct-sub-plans"},ph={class:"direct-sub-plans-header"},hh={class:"direct-label"},mh={class:"direct-sub-plans-list"},fh=ce({__name:"RecursiveSubPlan",props:{subPlan:{},subPlanIndex:{},nestingLevel:{default:0},maxNestingDepth:{default:3},maxVisibleSteps:{default:2}},emits:["sub-plan-selected","step-selected"],setup(n,{emit:e}){const t=n,o=e,{t:a}=Se(),l=()=>`nesting-level-${t.nestingLevel}`,i=()=>{var U,W;return t.subPlan.completed?"completed":((U=t.subPlan.agentExecutionSequence)==null?void 0:U.some(E=>E.status==="RUNNING"))?"running":((W=t.subPlan.agentExecutionSequence)==null?void 0:W.some(E=>E.status==="FINISHED"))?"in-progress":"pending"},u=()=>{switch(i()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},f=()=>{switch(i()){case"completed":return"carbon:checkmark";case"running":return"carbon:play";case"in-progress":return"carbon:in-progress";case"pending":default:return"carbon:dot-mark"}},d=()=>{var P;if(!((P=t.subPlan.agentExecutionSequence)!=null&&P.length))return 0;if(t.subPlan.completed)return 100;const v=m();return Math.min(100,v/t.subPlan.agentExecutionSequence.length*100)},m=()=>{var v;return(v=t.subPlan.agentExecutionSequence)!=null&&v.length?t.subPlan.agentExecutionSequence.filter(P=>P.status==="FINISHED").length:0},b=v=>{switch(v){case"FINISHED":return"completed";case"RUNNING":return"running";case"IDLE":default:return"pending"}},F=v=>{switch(v){case"FINISHED":return"carbon:checkmark";case"RUNNING":return"carbon:play";case"IDLE":default:return"carbon:dot-mark"}},B=v=>{switch(v){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},S=v=>{var P;return((P=v.thinkActSteps)==null?void 0:P.some(U=>U.subPlanExecutionRecord))??!1},$=v=>{var P;return((P=v.thinkActSteps)==null?void 0:P.filter(U=>U.subPlanExecutionRecord))??[]},_=()=>{o("sub-plan-selected",-1,t.subPlanIndex,t.subPlan)},p=(v,P)=>{const U=P.stepId||`subplan-${t.subPlanIndex}-agent-${v}`;o("step-selected",U)},T=(v,P,U)=>{const W=U.stepId||`subplan-${t.subPlanIndex}-agent-${v}`;o("step-selected",W)},w=(v,P,U)=>{o("sub-plan-selected",v,P,U)},R=v=>{o("step-selected",v)};return(v,P)=>{var W,E;const U=ts("RecursiveSubPlan",!0);return h(),g("div",{class:se(["recursive-sub-plan",l()])},[s("div",{class:"sub-plan-header",onClick:_},[s("div",kp,[k(r(C),{icon:f(),class:"sub-plan-status-icon"},null,8,["icon"]),s("div",Tp,[s("div",Pp,[ee(c(v.subPlan.title||v.$t("chat.subPlan"))+" #"+c(v.subPlanIndex+1)+" ",1),(v.nestingLevel??0)>0?(h(),g("span",Cp,"(L"+c((v.nestingLevel??0)+1)+")",1)):q("",!0)]),s("div",Ep,c(v.subPlan.currentPlanId),1)])]),s("div",Rp,[s("div",{class:se(["sub-plan-status-badge",i()])},c(u()),3),v.subPlan.parentActToolCall?(h(),g("div",Ip,[k(r(C),{icon:"carbon:function",class:"trigger-icon"}),s("span",Ap,c(v.subPlan.parentActToolCall.name),1)])):q("",!0)])]),(W=v.subPlan.agentExecutionSequence)!=null&&W.length?(h(),g("div",xp,[s("div",Dp,[s("span",Fp,c(v.$t("chat.progress"))+": "+c(m())+" / "+c(v.subPlan.agentExecutionSequence.length),1),s("div",Mp,[s("div",{class:"progress-fill",style:qe({width:d()+"%"})},null,4)])])])):q("",!0),(E=v.subPlan.agentExecutionSequence)!=null&&E.length?(h(),g("div",Up,[s("div",Np,[s("span",Lp,c(v.$t("chat.agentExecutions"))+":",1)]),s("div",Bp,[(h(!0),g(oe,null,ae(v.subPlan.agentExecutionSequence,(x,A)=>{var j,y;return h(),g("div",{key:x.id||A,class:se(["agent-step-item",b(x.status)]),onClick:D=>p(A,x)},[s("div",qp,[k(r(C),{icon:F(x.status),class:"agent-icon"},null,8,["icon"]),s("span",Vp,c(x.agentName||v.$t("chat.unknownAgent")),1),s("div",{class:se(["agent-status-badge",b(x.status)])},c(B(x.status)),3)]),s("div",jp,[x.result?(h(),g("div",Hp,[s("div",Gp,[k(r(C),{icon:"carbon:checkmark",class:"result-icon"}),s("span",Wp,c(v.$t("chat.agentResult"))+":",1)]),s("pre",zp,c(x.result),1)])):q("",!0),x.errorMessage?(h(),g("div",Jp,[s("div",Kp,[k(r(C),{icon:"carbon:warning",class:"error-icon"}),s("span",Xp,c(v.$t("chat.errorMessage"))+":",1)]),s("pre",Qp,c(x.errorMessage),1)])):q("",!0),(j=x.thinkActSteps)!=null&&j.length?(h(),g("div",Yp,[s("div",Zp,[k(r(C),{icon:"carbon:thinking",class:"think-act-icon"}),s("span",eh,c(v.$t("chat.thinkActSteps"))+" ("+c(x.thinkActSteps.length)+")",1)]),s("div",th,[(h(!0),g(oe,null,ae(x.thinkActSteps.slice(0,v.maxVisibleSteps??2),(D,J)=>(h(),g("div",{key:D.id||J,class:"think-act-step-preview",onClick:he(X=>T(A,J,x),["stop"])},[s("span",oh,"#"+c(J+1),1),s("span",nh,c(D.actionDescription||v.$t("chat.thinking")),1),k(r(C),{icon:"carbon:arrow-right",class:"step-arrow"})],8,sh))),128)),x.thinkActSteps.length>(v.maxVisibleSteps??2)?(h(),g("div",ah,[s("span",lh,c(v.$t("chat.andMoreSteps",{count:x.thinkActSteps.length-(v.maxVisibleSteps??2)})),1)])):q("",!0)])])):q("",!0),S(x)?(h(),g("div",rh,[s("div",ih,[k(r(C),{icon:"carbon:tree-view-alt",class:"nested-icon"}),s("span",ch,c(v.$t("chat.nestedSubPlans")),1)]),s("div",dh,[(h(!0),g(oe,null,ae($(x),(D,J)=>(h(),ne(U,{key:D.id||J,"sub-plan":D.subPlanExecutionRecord,"sub-plan-index":J,"nesting-level":(v.nestingLevel??0)+1,"max-nesting-depth":v.maxNestingDepth??3,"max-visible-steps":v.maxVisibleSteps??2,onSubPlanSelected:w,onStepSelected:R},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):q("",!0),(y=x.subPlanExecutionRecords)!=null&&y.length?(h(),g("div",uh,[s("div",ph,[k(r(C),{icon:"carbon:tree-view",class:"direct-icon"}),s("span",hh,c(v.$t("chat.directSubPlans")),1)]),s("div",mh,[(h(!0),g(oe,null,ae(x.subPlanExecutionRecords,(D,J)=>(h(),ne(U,{key:D.currentPlanId||J,"sub-plan":D,"sub-plan-index":J,"nesting-level":(v.nestingLevel??0)+1,"max-nesting-depth":v.maxNestingDepth??3,"max-visible-steps":v.maxVisibleSteps??2,onSubPlanSelected:w,onStepSelected:R},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):q("",!0)])],10,Op)}),128))])])):q("",!0)],2)}}}),vh=de(fh,[["__scopeId","data-v-5ef3cbb7"]]),gh={class:"execution-details"},bh={key:0,class:"plan-overview"},yh={class:"plan-header"},_h={class:"plan-title"},$h={key:0,class:"parent-tool-call"},Sh={class:"parent-tool-header"},wh={class:"tool-label"},kh={class:"tool-name"},Th={key:0,class:"tool-parameters"},Ph={class:"param-label"},Ch={class:"param-content"},Eh={key:1,class:"agent-execution-container"},Rh={class:"section-title"},Ih=["onClick"],Ah={class:"agent-info"},xh={class:"agent-details"},Dh={class:"agent-name"},Fh={class:"request-content"},Mh={class:"agent-controls"},Uh={class:"agent-execution-info"},Nh={key:0,class:"agent-result"},Lh={class:"result-header"},Bh={class:"result-label"},Oh={class:"result-content"},qh={key:1,class:"agent-error"},Vh={class:"error-header"},jh={class:"error-label"},Hh={class:"error-content"},Gh={key:0,class:"sub-plans-container"},Wh={class:"sub-plans-header"},zh={class:"sub-plans-title"},Jh={class:"sub-plans-list"},Kh=ce({__name:"ExecutionDetails",props:{planExecution:{},genericInput:{}},emits:["agent-selected","sub-plan-selected","user-input-submitted","step-selected"],setup(n,{emit:e}){const t=n,o=e,{t:a}=Se(),l=le(()=>{var $;return(($=t.planExecution)==null?void 0:$.agentExecutionSequence)??[]}),i=$=>{$.stepId?o("step-selected",$.stepId):console.warn("[ExecutionDetails] Agent execution has no stepId:",$)},u=()=>t.planExecution?t.planExecution.completed?"completed":l.value.some(p=>p.status==="RUNNING")?"running":l.value.some(p=>p.status==="FINISHED")?"in-progress":"pending":"unknown",f=()=>{switch(u()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},d=$=>{switch($){case"RUNNING":return"running";case"FINISHED":return"completed";case"IDLE":default:return"pending"}},m=$=>{switch($){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},b=$=>{switch($){case"RUNNING":return"carbon:play";case"FINISHED":return"carbon:checkmark";case"IDLE":default:return"carbon:dot-mark"}},F=($,_,p)=>{o("sub-plan-selected",$,_,p)},B=$=>{o("step-selected",$)},S=$=>{if(!$)return"";try{const _=JSON.parse($);return JSON.stringify(_,null,2)}catch{return $}};return($,_)=>{var p,T,w;return h(),g("div",gh,[$.planExecution?(h(),g("div",bh,[s("div",yh,[s("h3",_h,c($.planExecution.title||$.$t("chat.planExecution")),1),s("div",{class:se(["plan-status-badge",u()])},c(f()),3)]),$.planExecution.parentActToolCall?(h(),g("div",$h,[s("div",Sh,[k(r(C),{icon:"carbon:flow",class:"tool-icon"}),s("span",wh,c($.$t("chat.triggeredByTool"))+":",1),s("span",kh,c($.planExecution.parentActToolCall.name),1)]),$.planExecution.parentActToolCall.parameters?(h(),g("div",Th,[s("span",Ph,c($.$t("common.parameters"))+":",1),s("pre",Ch,c(S($.planExecution.parentActToolCall.parameters)),1)])):q("",!0)])):q("",!0)])):q("",!0),(((T=(p=$.planExecution)==null?void 0:p.agentExecutionSequence)==null?void 0:T.length)??0)>0?(h(),g("div",Eh,[s("h4",Rh,c($.$t("chat.agentExecutionSequence")),1),(h(!0),g(oe,null,ae((w=$.planExecution)==null?void 0:w.agentExecutionSequence,(R,v)=>{var P;return h(),g("div",{key:R.id||v,class:se(["agent-execution-item",d(R.status)])},[s("div",{class:"agent-header",onClick:U=>i(R)},[s("div",Ah,[k(r(C),{icon:b(R.status),class:"agent-status-icon"},null,8,["icon"]),s("div",xh,[s("div",Dh,c(R.agentName||$.$t("chat.unknownAgent")),1),s("pre",Fh,c(R.agentRequest),1)])]),s("div",Mh,[s("div",{class:se(["agent-status-badge",d(R.status)])},c(m(R.status)),3),k(r(C),{icon:"carbon:arrow-right",class:"step-select-icon"})])],8,Ih),s("div",Uh,[R.result?(h(),g("div",Nh,[s("div",Lh,[k(r(C),{icon:"carbon:checkmark",class:"result-icon"}),s("span",Bh,c($.$t("chat.agentResult"))+":",1)]),s("pre",Oh,c(R.result),1)])):q("",!0),R.errorMessage?(h(),g("div",qh,[s("div",Vh,[k(r(C),{icon:"carbon:warning",class:"error-icon"}),s("span",jh,c($.$t("chat.errorMessage"))+":",1)]),s("pre",Hh,c(R.errorMessage),1)])):q("",!0)]),(P=R.subPlanExecutionRecords)!=null&&P.length?(h(),g("div",Gh,[s("div",Wh,[k(r(C),{icon:"carbon:tree-view",class:"sub-plans-icon"}),s("span",zh,c($.$t("chat.subPlanExecutions"))+" ("+c(R.subPlanExecutionRecords.length)+") ",1)]),s("div",Jh,[(h(!0),g(oe,null,ae(R.subPlanExecutionRecords,(U,W)=>(h(),ne(vh,{key:U.currentPlanId||W,"sub-plan":U,"sub-plan-index":W,"nesting-level":0,"max-nesting-depth":3,"max-visible-steps":2,onSubPlanSelected:F,onStepSelected:B},null,8,["sub-plan","sub-plan-index"]))),128))])])):q("",!0)],2)}),128))])):q("",!0)])}}}),Ms=de(Kh,[["__scopeId","data-v-2d936ebb"]]),Xh={key:0,class:"thinking-section"},Qh={class:"thinking-header"},Yh={class:"thinking-avatar"},Zh={class:"thinking-label"},em={class:"thinking-content"},tm={key:0,class:"thinking"},sm={key:2,class:"default-processing"},om={class:"processing-indicator"},nm=ce({__name:"ThinkingSection",props:{thinking:{},thinkingDetails:{},planExecution:{},stepActions:{},genericInput:{},hasContent:{type:Boolean}},emits:["agent-selected","sub-plan-selected","user-input-submitted","step-selected"],setup(n,{emit:e}){const t=n,o=e,a=le(()=>{var d,m,b,F;return t.thinking||(((m=(d=t.thinkingDetails)==null?void 0:d.agentExecutionSequence)==null?void 0:m.length)??0)>0||(((F=(b=t.planExecution)==null?void 0:b.agentExecutionSequence)==null?void 0:F.length)??0)>0}),l=(d,m)=>{o("agent-selected",d,m)},i=(d,m,b)=>{o("sub-plan-selected",d,m,b)},u=d=>{o("user-input-submitted",d)},f=d=>{o("step-selected",d)};return(d,m)=>a.value?(h(),g("div",Xh,[s("div",Qh,[s("div",Yh,[k(r(C),{icon:"carbon:thinking",class:"thinking-icon"})]),s("div",Zh,c(d.$t("chat.thinkingLabel")),1)]),s("div",em,[d.thinking?(h(),g("div",tm,[k(r(C),{icon:"carbon:thinking",class:"thinking-icon"}),s("span",null,c(d.thinking),1)])):q("",!0),d.thinkingDetails||d.planExecution?(h(),ne(Ms,{key:1,"plan-execution":d.thinkingDetails||d.planExecution,"step-actions":d.stepActions||[],"generic-input":d.genericInput||"",onAgentSelected:l,onSubPlanSelected:i,onUserInputSubmitted:u,onStepSelected:f},null,8,["plan-execution","step-actions","generic-input"])):!d.hasContent&&d.thinking?(h(),g("div",sm,[s("div",om,[m[0]||(m[0]=s("div",{class:"thinking-dots"},[s("span"),s("span"),s("span")],-1)),s("span",null,c(d.thinking||d.$t("chat.thinkingProcessing")),1)])])):q("",!0)])])):q("",!0)}}),am=de(nm,[["__scopeId","data-v-c341487f"]]);class yt{static async getDetails(e){try{const t=await fetch(`${this.BASE_URL}/details/${e}`);if(t.status===404)return null;if(!t.ok){const l=await t.text();throw new Error(`Failed to get detailed information: ${t.status} - ${l}`)}const o=await t.text(),a=JSON.parse(o);return a&&typeof a=="object"&&!a.currentPlanId&&(a.currentPlanId=e),a}catch(t){return console.error("[CommonApiService] Failed to get plan details:",t),null}}static async submitFormInput(e,t){const o=await fetch(`${this.BASE_URL}/submit-input/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!o.ok){let l;try{l=await o.json()}catch{l={message:`Failed to submit form input: ${o.status}`}}throw new Error(l.message||`Failed to submit form input: ${o.status}`)}const a=o.headers.get("content-type");return a&&a.indexOf("application/json")!==-1?await o.json():{success:!0}}static async getAllPrompts(){try{const e=await fetch(this.BASE_URL);return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get Prompt list:",e),e}}static async handleResponse(e){if(!e.ok)try{const t=await e.json();throw new Error(t.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}}fe(yt,"BASE_URL","/api/executor");const lm={class:"user-input-form-container"},rm={class:"user-input-header"},im={class:"user-input-title"},cm={class:"user-input-message"},dm={key:0,class:"form-description"},um={key:0,class:"form-grid"},pm=["for"],hm=["id","name","placeholder","required","onUpdate:modelValue"],mm=["id","name","placeholder","required","onUpdate:modelValue"],fm=["id","name","placeholder","required","onUpdate:modelValue"],vm=["id","name","placeholder","required","onUpdate:modelValue"],gm=["id","name","placeholder","required","onUpdate:modelValue"],bm=["id","name","required","onUpdate:modelValue"],ym={value:""},_m=["value"],$m={key:6,class:"checkbox-group"},Sm=["id","name","value","onUpdate:modelValue"],wm={class:"checkbox-label"},km={key:7,class:"radio-group"},Tm=["id","name","value","onUpdate:modelValue"],Pm={class:"radio-label"},Cm=["id","name","placeholder","required","onUpdate:modelValue"],Em={key:1,class:"form-group"},Rm={for:"form-input-genericInput"},Im={type:"submit",class:"submit-user-input-btn"},Am=ce({__name:"UserInputForm",props:{userInputWaitState:{},planId:{},genericInput:{}},emits:["user-input-submitted"],setup(n,{emit:e}){const t=n,o=e;Se();const a=tt({}),l=N(t.genericInput||""),i=N(!1),u=N(null),f=()=>{var B;const F=(B=t.userInputWaitState)==null?void 0:B.formInputs;F&&F.length>0&&(!i.value||Object.keys(a).length!==F.length)&&(F.forEach(($,_)=>{(!(_ in a)||$.type==="checkbox"&&!Array.isArray(a[_])||$.type!=="checkbox"&&a[_]==="")&&($.type==="checkbox"?a[_]=[]:a[_]="")}),i.value=!0)};$e(()=>{f()}),ie(()=>{var F;return(F=t.userInputWaitState)==null?void 0:F.formInputs},()=>{u.value&&clearTimeout(u.value),u.value=setTimeout(()=>{i.value=!1,f()},100)},{deep:!0});const d=async()=>{var F;try{const B={},S=(F=t.userInputWaitState)==null?void 0:F.formInputs;S&&S.length>0?Object.entries(a).forEach(([$,_])=>{const p=parseInt($,10),T=S[p];if(T){const w=T.label||`input_${$}`;Array.isArray(_)?B[w]=_.join(", "):B[w]=_}}):B.genericInput=l.value,console.log("[UserInputForm] Submitting user input:",B,"for planId:",t.planId),t.planId?(await yt.submitFormInput(t.planId,B),console.log("[UserInputForm] User input submitted successfully")):console.error("[UserInputForm] No planId available for user input submission"),o("user-input-submitted",B)}catch(B){console.error("[UserInputForm] User input submission failed:",B)}},m=F=>F?Array.isArray(F)?F:typeof F=="string"?F.split(",").map(B=>B.trim()).filter(B=>B.length>0):[]:[],b=F=>typeof F=="boolean"?F:typeof F=="string"?F==="true":!1;return _e(()=>{u.value&&clearTimeout(u.value)}),(F,B)=>{var S,$,_,p,T;return h(),g("div",lm,[s("div",rm,[k(r(C),{icon:"carbon:user",class:"user-icon"}),s("h4",im,c(F.$t("chat.userInputRequired")),1)]),s("p",cm,c(((S=F.userInputWaitState)==null?void 0:S.title)??F.$t("chat.userInput.message")),1),($=F.userInputWaitState)!=null&&$.formDescription?(h(),g("p",dm,c((_=F.userInputWaitState)==null?void 0:_.formDescription),1)):q("",!0),s("form",{onSubmit:he(d,["prevent"]),class:"user-input-form"},[(p=F.userInputWaitState)!=null&&p.formInputs&&F.userInputWaitState.formInputs.length>0?(h(),g("div",um,[(h(!0),g(oe,null,ae((T=F.userInputWaitState)==null?void 0:T.formInputs,(w,R)=>(h(),g("div",{key:R,class:"form-group"},[s("label",{for:`form-input-${w.label.replace(/\W+/g,"_")}`},c(w.label)+c(b(w.required)?" *":"")+": ",9,pm),!w.type||w.type==="text"?te((h(),g("input",{key:0,type:"text",id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:b(w.required),"onUpdate:modelValue":v=>a[R]=v,class:"form-input"},null,8,hm)),[[re,a[R]]]):w.type==="email"?te((h(),g("input",{key:1,type:"email",id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:b(w.required),"onUpdate:modelValue":v=>a[R]=v,class:"form-input"},null,8,mm)),[[re,a[R]]]):w.type==="number"?te((h(),g("input",{key:2,type:"number",id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:b(w.required),"onUpdate:modelValue":v=>a[R]=v,class:"form-input"},null,8,fm)),[[re,a[R]]]):w.type==="password"?te((h(),g("input",{key:3,type:"password",id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:b(w.required),"onUpdate:modelValue":v=>a[R]=v,class:"form-input"},null,8,vm)),[[re,a[R]]]):w.type==="textarea"?te((h(),g("textarea",{key:4,id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:b(w.required),"onUpdate:modelValue":v=>a[R]=v,class:"form-input form-textarea",rows:"4"},null,8,gm)),[[re,a[R]]]):w.type==="select"&&w.options?te((h(),g("select",{key:5,id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,required:b(w.required),"onUpdate:modelValue":v=>a[R]=v,class:"form-input form-select"},[s("option",ym,c(F.$t("selectCommon.pleaseSelect")),1),(h(!0),g(oe,null,ae(m(w.options),v=>(h(),g("option",{key:v,value:v},c(v),9,_m))),128))],8,bm)),[[st,a[R]]]):w.type==="checkbox"&&w.options?(h(),g("div",$m,[(h(!0),g(oe,null,ae(m(w.options),v=>(h(),g("label",{key:v,class:"checkbox-item"},[te(s("input",{type:"checkbox",id:`form-input-${w.label.replace(/\W+/g,"_")}-${v.replace(/\W+/g,"_")}`,name:w.label,value:v,"onUpdate:modelValue":P=>a[R]=P,class:"form-checkbox"},null,8,Sm),[[kt,a[R]]]),s("span",wm,c(v),1)]))),128))])):w.type==="radio"&&w.options?(h(),g("div",km,[(h(!0),g(oe,null,ae(m(w.options),v=>(h(),g("label",{key:v,class:"radio-item"},[te(s("input",{type:"radio",id:`form-input-${w.label.replace(/\W+/g,"_")}-${v.replace(/\W+/g,"_")}`,name:w.label,value:v,"onUpdate:modelValue":P=>a[R]=P,class:"form-radio"},null,8,Tm),[[Bs,a[R]]]),s("span",Pm,c(v),1)]))),128))])):te((h(),g("input",{key:8,type:"text",id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:b(w.required),"onUpdate:modelValue":v=>a[R]=v,class:"form-input"},null,8,Cm)),[[re,a[R]]])]))),128))])):(h(),g("div",Em,[s("label",Rm,c(F.$t("common.input"))+":",1),te(s("input",{type:"text",id:"form-input-genericInput",name:"genericInput","onUpdate:modelValue":B[0]||(B[0]=w=>l.value=w),class:"form-input"},null,512),[[re,l.value]])])),s("button",Im,c(F.$t("chat.userInput.submit")),1)],32)])}}}),xm=de(Am,[["__scopeId","data-v-043b591c"]]),Dm={class:"response-section"},Fm={class:"response-header"},Mm={class:"response-avatar"},Um={class:"response-name"},Nm={key:0,class:"response-timestamp"},Lm={class:"response-content"},Bm={key:1,class:"final-response"},Om=["innerHTML"],qm={class:"response-actions"},Vm=["title"],jm=["title"],Hm={key:2,class:"response-placeholder"},Gm={class:"typing-indicator"},Wm={class:"typing-text"},zm={key:3,class:"response-error"},Jm={class:"error-text"},Km={key:4,class:"response-empty"},Xm={class:"empty-text"},Qm=ce({__name:"ResponseSection",props:{content:{},isStreaming:{type:Boolean},error:{},timestamp:{},userInputWaitState:{},planId:{},genericInput:{}},emits:["copy","regenerate","retry","user-input-submitted"],setup(n,{emit:e}){const t=n,o=e,{formatResponseText:a,formatTimestamp:l}=Nt(),i=async()=>{if(t.content)try{const m=t.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(m),o("copy")}catch(m){console.error("Failed to copy to clipboard:",m)}},u=()=>{o("regenerate")},f=()=>{o("retry")},d=m=>{console.log("[ResponseSection] User input submitted:",m),o("user-input-submitted",m)};return(m,b)=>{var F;return h(),g("div",Dm,[s("div",Fm,[s("div",Mm,[k(r(C),{icon:"carbon:bot",class:"bot-icon"})]),s("div",Um,c(m.$t("chat.botName")),1),m.timestamp?(h(),g("div",Nm,c(r(l)(m.timestamp)),1)):q("",!0)]),s("div",Lm,[(F=m.userInputWaitState)!=null&&F.waiting?(h(),ne(xm,ss({key:0,"user-input-wait-state":m.userInputWaitState},m.planId?{"plan-id":m.planId}:{},{"generic-input":m.genericInput??"",onUserInputSubmitted:d}),null,16,["user-input-wait-state","generic-input"])):q("",!0),m.content?(h(),g("div",Bm,[s("div",{class:"response-text",innerHTML:r(a)(m.content)},null,8,Om),s("div",qm,[s("button",{class:"action-btn copy-btn",onClick:i,title:m.$t("chat.copyResponse")},[k(r(C),{icon:"carbon:copy"})],8,Vm),s("button",{class:"action-btn regenerate-btn",onClick:u,title:m.$t("chat.regenerateResponse")},[k(r(C),{icon:"carbon:renew"})],8,jm)])])):m.isStreaming?(h(),g("div",Hm,[s("div",Gm,[b[0]||(b[0]=s("div",{class:"typing-dots"},[s("span"),s("span"),s("span")],-1)),s("span",Wm,c(m.$t("chat.thinkingResponse")),1)])])):m.error?(h(),g("div",zm,[k(r(C),{icon:"carbon:warning",class:"error-icon"}),s("span",Jm,c(m.error),1),s("button",{class:"retry-btn",onClick:f},c(m.$t("chat.retry")),1)])):(h(),g("div",Km,[s("span",Xm,c(m.$t("chat.waitingForResponse")),1)]))])])}}}),Ym=de(Qm,[["__scopeId","data-v-6581a34f"]]),Zm={class:"assistant-message"},ef=ce({__name:"AssistantMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(n,{emit:e}){const t=n,o=e,a=()=>{o("copy",t.message.id)},l=()=>{o("regenerate",t.message.id)},i=()=>{o("retry",t.message.id)},u=(d,m)=>{console.log("[AssistantMessage] User input submitted:",m,"for message:",d.id)},f=d=>{console.log("[AssistantMessage] Step selected:",d),o("step-selected",d)};return(d,m)=>{var b,F,B,S;return h(),g("div",Zm,[d.message.thinkingDetails?(h(),ne(am,{key:0,"thinking-details":d.message.thinkingDetails,onStepSelected:f},null,8,["thinking-details"])):q("",!0),d.message.planExecution?(h(),ne(Ms,{key:1,"plan-execution":d.message.planExecution,"step-actions":d.message.stepActions||[],"generic-input":d.message.genericInput||"",onStepSelected:f},null,8,["plan-execution","step-actions","generic-input"])):q("",!0),d.message.content||d.message.error||d.isStreaming||(F=(b=d.message.planExecution)==null?void 0:b.userInputWaitState)!=null&&F.waiting?(h(),ne(Ym,ss({key:2,content:d.message.content||"","is-streaming":d.isStreaming||!1},{...d.message.error?{error:d.message.error}:{},...(B=d.message.planExecution)!=null&&B.userInputWaitState?{userInputWaitState:d.message.planExecution.userInputWaitState}:{},...(S=d.message.planExecution)!=null&&S.currentPlanId?{planId:d.message.planExecution.currentPlanId}:{}},{timestamp:d.message.timestamp,"generic-input":d.message.genericInput||"",onCopy:a,onRegenerate:l,onRetry:i,onUserInputSubmitted:m[0]||(m[0]=$=>u(d.message,$))}),null,16,["content","is-streaming","timestamp","generic-input"])):q("",!0)])}}}),tf=de(ef,[["__scopeId","data-v-3810c279"]]),sf=ce({__name:"ChatMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(n,{emit:e}){const t=n,o=e,{getMessageClasses:a}=Nt(),l=le(()=>a(t.message)),i=m=>{o("copy",m)},u=m=>{o("regenerate",m)},f=m=>{o("retry",m)},d=m=>{o("step-selected",m)};return(m,b)=>(h(),g("div",{class:se(["chat-message",l.value])},[m.message.type==="user"?(h(),ne(wp,{key:0,message:m.message},null,8,["message"])):m.message.type==="assistant"?(h(),ne(tf,{key:1,message:m.message,"is-streaming":m.isStreaming||!1,onCopy:i,onRegenerate:u,onRetry:f,onStepSelected:d},null,8,["message","is-streaming"])):q("",!0)],2))}}),of=de(sf,[["__scopeId","data-v-218b3735"]]);function At(n){const e={...n};return"agentExecutionSequence"in n&&Array.isArray(n.agentExecutionSequence)&&(e.agentExecutionSequence=n.agentExecutionSequence.map(t=>nf(t))),e}function nf(n){const e={...n};return"subPlanExecutionRecords"in n&&Array.isArray(n.subPlanExecutionRecords)&&(e.subPlanExecutionRecords=n.subPlanExecutionRecords.map(t=>At(t))),e}function af(n){const e={...n};return"thinkingDetails"in n&&n.thinkingDetails&&(e.thinkingDetails=At(n.thinkingDetails)),"planExecution"in n&&n.planExecution&&(e.planExecution=At(n.planExecution)),"attachments"in n&&Array.isArray(n.attachments)&&(e.attachments=[...n.attachments]),e}function lf(){const n=N([]),e=N(!1),t=N(null),o=N(null),a=le(()=>n.value.length>0?n.value[n.value.length-1]:null),l=le(()=>t.value!==null),i=le(()=>n.value.length>0),u=(R,v,P)=>{const U={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:R,content:v,timestamp:new Date,isStreaming:!1,...P};return n.value.push(U),U},f=(R,v)=>{const P=n.value.findIndex(U=>U.id===R);P!==-1&&(n.value[P]={...n.value[P],...v})},d=R=>{const v=n.value.findIndex(P=>P.id===R);v!==-1&&n.value.splice(v,1)},m=()=>{n.value=[],t.value=null,o.value=null},b=R=>{t.value=R,f(R,{isStreaming:!0})},F=R=>{R&&f(R,{isStreaming:!1}),t.value===R&&(t.value=null)},B=R=>{o.value=R},S=(R,v,P="content")=>{const U=n.value.find(W=>W.id===R);U&&typeof U[P]=="string"&&f(R,{[P]:U[P]+v})},$=(R,v)=>{f(R,{thinkingDetails:v})},_=(R,v)=>{f(R,{thinking:v})},p=(R,v)=>{f(R,{planExecution:v})},T=R=>n.value.find(v=>v.id===R),w=R=>n.value.findIndex(v=>v.id===R);return{messages:Ye(n),isLoading:e,streamingMessageId:Ye(t),activeMessageId:Ye(o),lastMessage:a,isStreaming:l,hasMessages:i,addMessage:u,updateMessage:f,removeMessage:d,clearMessages:m,startStreaming:b,stopStreaming:F,setActiveMessage:B,appendToMessage:S,updateMessageThinking:_,updateMessageThinkingDetails:$,updateMessagePlanExecution:p,findMessage:T,getMessageIndex:w}}function rf(n){const e=N(!1),t=N(!0),o=150,a=async(_=!0)=>{n.value&&(await ge(),n.value.scrollTo({top:n.value.scrollHeight,behavior:_?"smooth":"auto"}))},l=()=>{if(!n.value)return!1;const{scrollTop:_,scrollHeight:p,clientHeight:T}=n.value;return p-_-T<o},i=()=>{if(!n.value)return;const _=l();e.value=!_&&n.value.scrollHeight>n.value.clientHeight,_&&(t.value=!0)},u=()=>{i(),l()||(t.value=!1)},f=async()=>{t.value&&await a()},d=async()=>{t.value=!0,await a()},m=(_,p=!0)=>{if(!n.value)return;const T=n.value.querySelector(`[data-message-id="${_}"]`);T&&T.scrollIntoView({behavior:p?"smooth":"auto",block:"center"})},b=()=>{if(!n.value)return{scrollTop:0,scrollHeight:0,clientHeight:0,isAtTop:!0,isAtBottom:!0,scrollPercentage:0};const{scrollTop:_,scrollHeight:p,clientHeight:T}=n.value,w=_===0,R=_+T>=p-5,v=p>T?_/(p-T)*100:100;return{scrollTop:_,scrollHeight:p,clientHeight:T,isAtTop:w,isAtBottom:R,scrollPercentage:v}},F=()=>{n.value&&n.value.addEventListener("scroll",u,{passive:!0})},B=()=>{n.value&&n.value.removeEventListener("scroll",u)},S=()=>{F(),i()},$=()=>{B()};return $e(()=>{ge(()=>{S()})}),_e(()=>{$()}),{showScrollToBottom:Ye(e),isAutoScrollEnabled:Ye(t),scrollToBottom:a,autoScrollToBottom:f,forceScrollToBottom:d,scrollToMessage:m,isNearBottom:l,checkScrollPosition:i,getScrollInfo:b,addScrollListener:F,removeScrollListener:B,initializeScrollBehavior:S,cleanupScrollBehavior:$}}class Lt{static async sendMessage(e){return Bt.withLlmCheck(async()=>{const t={...e,isVueRequest:!0},o=await fetch(`${this.BASE_URL}/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!o.ok)throw new Error(`API request failed: ${o.status}`);return await o.json()})}static async sendMessageWithDefaultPlan(e){return Bt.withLlmCheck(async()=>{const t="default-plan-id-001000222",o={userRequirement:e.input},a={toolName:t,replacementParams:o,isVueRequest:!0};e.uploadedFiles&&e.uploadedFiles.length>0&&(a.uploadedFiles=e.uploadedFiles,console.log("[DirectApiService] Including uploaded files:",e.uploadedFiles.length)),e.uploadKey&&(a.uploadKey=e.uploadKey,console.log("[DirectApiService] Including uploadKey:",e.uploadKey)),console.log("[DirectApiService] Sending message with default plan:",a);const l=await fetch(`${this.BASE_URL}/executeByToolNameAsync`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!l.ok)throw new Error(`API request failed: ${l.status}`);return await l.json()})}}fe(Lt,"BASE_URL","/api/executor");const cf=Object.freeze(Object.defineProperty({__proto__:null,DirectApiService:Lt},Symbol.toStringTag,{value:"Module"})),Fe=class Fe{constructor(){fe(this,"POLL_INTERVAL",5e3);fe(this,"state",tt({activePlanId:null,lastSequenceSize:0,isPolling:!1,pollTimer:null}));fe(this,"callbacks",{});fe(this,"planExecutionCache",new Map);fe(this,"uiStateCache",new Map);console.log("[PlanExecutionManager] Initialized with callback-based event system")}getCachedPlanRecord(e){return this.planExecutionCache.get(e)}getCachedUIState(e){return this.uiStateCache.get(e)}setCachedUIState(e,t){this.uiStateCache.set(e,t),console.log(`[PlanExecutionManager] Cached UI state for rootPlanId: ${e}`)}getAllCachedRecords(){return new Map(this.planExecutionCache)}hasCachedPlanRecord(e){return this.planExecutionCache.has(e)}setCachedPlanRecord(e,t){this.planExecutionCache.set(e,t),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${e}`)}clearCachedPlanRecord(e){const t=this.planExecutionCache.delete(e);return t&&console.log(`[PlanExecutionManager] Cleared cached plan execution record for rootPlanId: ${e}`),t}clearAllCachedRecords(){const e=this.planExecutionCache.size,t=this.uiStateCache.size;this.planExecutionCache.clear(),this.uiStateCache.clear(),console.log(`[PlanExecutionManager] Cleared all caches - Plans: ${e}, UI States: ${t}`)}static getInstance(){return Fe.instance||(Fe.instance=new Fe),Fe.instance}getActivePlanId(){return this.state.activePlanId}getState(){return this.state}setEventCallbacks(e){this.callbacks={...this.callbacks,...e},console.log("[PlanExecutionManager] Event callbacks set:",Object.keys(e))}async handleUserMessageSendRequested(e){if(this.validateAndPrepareUIForNewRequest(e))try{if(await this.sendUserMessageAndSetPlanId(e),this.state.activePlanId)this.initiatePlanExecutionSequence(e,this.state.activePlanId);else throw new Error("Failed to get valid plan ID")}catch(t){console.error("[PlanExecutionManager] Failed to send user message:",t);const o=this.state.activePlanId??"error";this.setCachedUIState(o,{enabled:!0}),this.emitChatInputUpdateState(o),this.state.activePlanId=null}}handlePlanExecutionRequested(e,t){console.log("[PlanExecutionManager] Received plan execution request:",{planId:e,query:t}),e?(this.state.activePlanId=e,this.initiatePlanExecutionSequence(t??"Execute Plan",e)):console.error("[PlanExecutionManager] Invalid plan execution request: missing planId")}handleCachedPlanExecution(e,t){const o=this.getCachedPlanRecord(e);return o!=null&&o.currentPlanId?(console.log(`[PlanExecutionManager] Found cached plan execution record for rootPlanId: ${e}`),this.handlePlanExecutionRequested(o.currentPlanId,t),!0):(console.log(`[PlanExecutionManager] No cached plan execution record found for rootPlanId: ${e}`),!1)}validateAndPrepareUIForNewRequest(e){if(!e)return console.warn("[PlanExecutionManager] Query is empty"),!1;if(this.state.activePlanId)return!1;this.emitChatInputClear();const t=this.state.activePlanId??"ui-state";return this.setCachedUIState(t,{enabled:!1,placeholder:"Processing..."}),this.emitChatInputUpdateState(t),!0}async sendUserMessageAndSetPlanId(e){try{const t=await Lt.sendMessage({input:e});if(t!=null&&t.planId)return this.state.activePlanId=t.planId,t;if(t!=null&&t.planTemplateId)return this.state.activePlanId=t.planTemplateId,{...t,planId:t.planTemplateId};throw console.error("[PlanExecutionManager] Failed to get planId from response:",t),new Error("Failed to get valid planId from API response")}catch(t){throw console.error("[PlanExecutionManager] API call failed:",t),t}}initiatePlanExecutionSequence(e,t){console.log(`[PlanExecutionManager] Starting plan execution sequence for query: "${e}", planId: ${t}`);const o=t;this.emitDialogRoundStart(o),this.startPolling()}handlePlanCompletion(e){this.emitPlanCompleted(e.rootPlanId??""),this.state.lastSequenceSize=0,this.stopPolling();try{setTimeout(async()=>{if(this.state.activePlanId)try{await Ze.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}},5e3)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}e.completed&&(this.state.activePlanId=null,this.emitChatInputUpdateState(e.rootPlanId??""))}handlePlanError(e){this.emitPlanError(e.message??""),this.state.lastSequenceSize=0,this.stopPolling();try{setTimeout(async()=>{if(this.state.activePlanId)try{await Ze.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}},5e3)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}}async pollPlanStatus(){if(this.state.activePlanId){if(this.state.isPolling){console.log("[PlanExecutionManager] Previous polling still in progress, skipping");return}try{this.state.isPolling=!0;const e=await this.getPlanDetails(this.state.activePlanId);if(!e){console.warn("[PlanExecutionManager] No details received from API - this might be a temporary network issue");return}if(e.status&&e.status==="failed"&&e.message&&!e.message.includes("Failed to get detailed information")){this.handlePlanError(e);return}e.rootPlanId&&this.setCachedPlanRecord(e.rootPlanId,e),this.emitPlanUpdate(e.rootPlanId??""),e.completed&&this.handlePlanCompletion(e)}catch(e){console.error("[PlanExecutionManager] Failed to poll plan status:",e)}finally{this.state.isPolling=!1}}}async getPlanDetails(e){try{const t=await yt.getDetails(e);return t!=null&&t.rootPlanId&&(this.planExecutionCache.set(t.rootPlanId,t),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${t.rootPlanId}`)),t}catch(t){return console.error("[PlanExecutionManager] Failed to get plan details:",t),{currentPlanId:e,status:"failed",message:t instanceof Error?t.message:"Failed to get plan"}}}startPolling(){this.state.pollTimer&&clearInterval(this.state.pollTimer),this.state.pollTimer=window.setInterval(()=>{this.pollPlanStatus()},this.POLL_INTERVAL),console.log("[PlanExecutionManager] Started polling")}async pollPlanStatusImmediately(){console.log("[PlanExecutionManager] Polling plan status immediately"),await this.pollPlanStatus()}stopPolling(){this.state.pollTimer&&(clearInterval(this.state.pollTimer),this.state.pollTimer=null),console.log("[PlanExecutionManager] Stopped polling")}cleanup(){this.stopPolling(),this.state.activePlanId=null,this.state.lastSequenceSize=0,this.state.isPolling=!1,this.clearAllCachedRecords()}emitChatInputClear(){this.callbacks.onChatInputClear&&this.callbacks.onChatInputClear()}emitChatInputUpdateState(e){this.callbacks.onChatInputUpdateState&&this.callbacks.onChatInputUpdateState(e)}emitDialogRoundStart(e){this.callbacks.onDialogRoundStart&&this.callbacks.onDialogRoundStart(e)}emitPlanUpdate(e){this.callbacks.onPlanUpdate&&this.callbacks.onPlanUpdate(e)}emitPlanCompleted(e){this.callbacks.onPlanCompleted&&this.callbacks.onPlanCompleted(e)}emitPlanError(e){this.callbacks.onPlanError&&this.callbacks.onPlanError(e)}};fe(Fe,"instance",null);let xt=Fe;const Ie=xt.getInstance(),df={class:"chat-container"},uf={key:0,class:"loading-message"},pf={class:"loading-content"},hf=["title"],mf=ce({__name:"ChatContainer",props:{mode:{default:"plan"},initialPrompt:{default:""}},emits:["step-selected"],setup(n,{expose:e,emit:t}){const o=t,{t:a}=Se(),{messages:l,isLoading:i,streamingMessageId:u,addMessage:f,updateMessage:d,startStreaming:m,stopStreaming:b,findMessage:F}=lf(),B=N(null),{scrollToBottom:S,autoScrollToBottom:$,showScrollToBottom:_}=rf(B),p=N(),T=D=>u.value===D,w=le(()=>l.value.map(af)),R=()=>{},v=D=>{const J=D.target;if(J.classList.contains("md-copy-btn")){const X=J.getAttribute("data-raw");if(X){const L=decodeURIComponent(X);navigator.clipboard.writeText(L).then(()=>{J.textContent=a("chat.copied"),setTimeout(()=>{J.textContent=a("chat.copy")},1e3)})}}},P=async D=>{const J=F(D);if(J)try{const X=J.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(X)}catch(X){console.error("Failed to copy message:",X)}},U=D=>{const J=F(D);J&&J.type==="assistant"&&(d(D,{content:""}),m(D))},W=D=>{F(D)&&(d(D,{content:""}),m(D))},E=D=>{console.log("[ChatContainer] Step selected:",D),o("step-selected",D)},x=D=>{console.log("[ChatContainer] Plan update received:",D);const J=Ie.getCachedPlanRecord(D);if(!J){console.warn("[ChatContainer] No cached plan data found for rootPlanId:",D);return}console.log("[ChatContainer] Retrieved plan details from cache:",J);const X=l.value.findIndex(L=>{var M;return((M=L.planExecution)==null?void 0:M.currentPlanId)===J.currentPlanId&&L.type==="assistant"});if(X!==-1){const L=l.value[X],M={planExecution:JSON.parse(JSON.stringify(J))};if(!J.agentExecutionSequence||J.agentExecutionSequence.length===0){if(console.log("[ChatContainer] Handling simple response without agent execution sequence"),J.completed){M.thinking="";const Q=J.summary??J.result??J.message??"Execution completed";M.content=Q,console.log("[ChatContainer] Set simple response content:",Q)}}else console.log("[ChatContainer] Handling detailed plan with agent execution sequence");d(L.id,M)}},A=D=>{if(console.log("[ChatContainer] Plan completed:",D),D.rootPlanId){const J=l.value.findIndex(X=>{var L;return((L=X.planExecution)==null?void 0:L.currentPlanId)===D.rootPlanId});if(J!==-1){const X=l.value[J],L=D.summary??D.result??"Execution completed";d(X.id,{thinking:"",content:L}),console.log("[ChatContainer] Updated completed message:",L)}}},j=D=>{console.log("[ChatContainer] Dialog round start:",D)},y=D=>{console.log("[ChatContainer] Plan error:",D),f("assistant",`Error: ${D}`),console.error("[ChatContainer] Plan execution error:",D)};return $e(()=>{ie(l,()=>{ge(()=>{$()})},{deep:!0}),Ie.setEventCallbacks({onPlanUpdate:x,onPlanCompleted:A,onDialogRoundStart:j,onPlanError:y})}),_e(()=>{p.value&&clearInterval(p.value)}),e({scrollToBottom:S,handlePlanUpdate:x,handlePlanCompleted:A,handleDialogRoundStart:j,handlePlanError:y,addMessage:f,updateMessage:d,startStreaming:m,stopStreaming:b}),(D,J)=>(h(),g("div",df,[s("div",{class:"messages",ref_key:"messagesRef",ref:B,onScroll:R,onClick:v},[(h(!0),g(oe,null,ae(w.value,X=>(h(),ne(of,{key:X.id,message:X,"is-streaming":T(X.id),onCopy:P,onRegenerate:U,onRetry:W,onStepSelected:E},null,8,["message","is-streaming"]))),128)),r(i)?(h(),g("div",uf,[s("div",pf,[k(r(C),{icon:"carbon:circle-dash",class:"loading-icon"}),s("span",null,c(D.$t("chat.processing")),1)])])):q("",!0)],544),k(Ue,{name:"scroll-button"},{default:Ee(()=>[r(_)?(h(),g("button",{key:0,class:"scroll-to-bottom",onClick:J[0]||(J[0]=()=>r(S)()),title:D.$t("chat.scrollToBottom")},[k(r(C),{icon:"carbon:chevron-down"})],8,hf)):q("",!0)]),_:1})]))}}),ff=de(mf,[["__scopeId","data-v-e7a5d6c9"]]),vf={class:"input-area"},gf={class:"input-container"},bf=["placeholder","disabled"],yf=["title"],_f=["disabled","title"],$f=ce({__name:"InputArea",props:{placeholder:{default:""},disabled:{type:Boolean,default:!1},initialValue:{default:""}},emits:["send","clear","update-state","plan-mode-clicked"],setup(n,{expose:e,emit:t}){const{t:o}=Se(),a=n,l=t,i=N(),u=N(),f=N(""),d=le(()=>a.placeholder||o("input.placeholder")),m=N(d.value),b=N([]),F=N(null),B=()=>{var y;console.log("[FileUpload] Resetting session and clearing uploadKey"),(y=u.value)==null||y.resetSession()};_e(()=>{B()});const S=(y,D)=>{b.value=y.map(J=>J.originalName),F.value=D,console.log("[InputArea] Files uploaded:",y.length,"uploadKey:",D),b.value.length>0&&(m.value=o("input.filesAttached",{count:b.value.length}))},$=y=>{b.value=y.map(D=>D.originalName),console.log("[InputArea] Files removed, remaining:",y.length),b.value.length===0?m.value=d.value:m.value=o("input.filesAttached",{count:b.value.length})},_=y=>{F.value=y,console.log("[InputArea] Upload key changed:",y)},p=()=>{console.log("[InputArea] Upload started")},T=()=>{console.log("[InputArea] Upload completed")},w=y=>{console.error("[InputArea] Upload error:",y)},R=le(()=>!!a.disabled),v=()=>{ge(()=>{i.value&&(i.value.style.height="auto",i.value.style.height=Math.min(i.value.scrollHeight,120)+"px")})},P=y=>{y.key==="Enter"&&!y.shiftKey&&(y.preventDefault(),U())},U=()=>{if(!f.value.trim()||R.value)return;const D={input:f.value.trim(),memoryId:xe.selectMemoryId,uploadedFiles:b.value};F.value?(D.uploadKey=F.value,console.log("[InputArea] Including uploadKey in message:",F.value)):console.log("[InputArea] No uploadKey available for message"),l("send",D),E()},W=()=>{l("plan-mode-clicked")},E=()=>{f.value="",v(),l("clear")},x=(y,D)=>{D&&(m.value=y?D:o("input.waiting")),l("update-state",y,D)},A=y=>{f.value=y,v()},j=()=>f.value.trim();return ie(()=>a.initialValue,y=>{y&&y.trim()&&(f.value=y,v())},{immediate:!0}),e({clearInput:E,updateState:x,setInputValue:A,getQuery:j,resetSession:B,focus:()=>{var y;return(y=i.value)==null?void 0:y.focus()},get uploadedFiles(){var y,D;return((D=(y=u.value)==null?void 0:y.uploadedFiles)==null?void 0:D.map(J=>J.originalName))||[]},get uploadKey(){var y;return((y=u.value)==null?void 0:y.uploadKey)||null}}),$e(()=>{}),_e(()=>{}),(y,D)=>(h(),g("div",vf,[k(Ds,{ref_key:"fileUploadRef",ref:u,disabled:R.value,onFilesUploaded:S,onFilesRemoved:$,onUploadKeyChanged:_,onUploadStarted:p,onUploadCompleted:T,onUploadError:w},null,8,["disabled"]),s("div",gf,[te(s("textarea",{"onUpdate:modelValue":D[0]||(D[0]=J=>f.value=J),ref_key:"inputRef",ref:i,class:"chat-input",placeholder:m.value,disabled:R.value,onKeydown:P,onInput:v},null,40,bf),[[re,f.value]]),s("button",{class:"plan-mode-btn",title:y.$t("input.planMode"),onClick:W},[k(r(C),{icon:"carbon:document"}),ee(" "+c(y.$t("input.planMode")),1)],8,yf),s("button",{class:"send-button",disabled:!f.value.trim()||R.value,onClick:U,title:y.$t("input.send")},[k(r(C),{icon:"carbon:send-alt"}),ee(" "+c(y.$t("input.send")),1)],8,_f)])]))}}),Sf=de($f,[["__scopeId","data-v-84fb4aeb"]]);class Be{static async getAllCronTasks(){try{const e=await fetch(this.BASE_URL);return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get cron tasks:",e),e}}static async getCronTaskById(e){try{const t=await fetch(`${this.BASE_URL}/${e}`);return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to get cron task by id:",t),t}}static async createCronTask(e){try{const t=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to create cron task:",t),t}}static async updateCronTask(e,t){try{const o=await fetch(`${this.BASE_URL}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await(await this.handleResponse(o)).json()}catch(o){throw console.error("Failed to update cron task:",o),o}}static async updateTaskStatus(e,t){try{const o=await fetch(`${this.BASE_URL}/${e}/status?status=${t}`,{method:"PUT"});await this.handleResponse(o)}catch(o){throw console.error("Failed to update task status:",o),o}}static async deleteCronTask(e){try{const t=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE"});await this.handleResponse(t)}catch(t){throw console.error("Failed to delete cron task:",t),t}}static async handleResponse(e){if(!e.ok)try{const t=await e.json();throw new Error(t.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}}fe(Be,"BASE_URL","/api/cron-tasks");const Oe={validateCronExpression(n){const e=n.trim().split(/\s+/);return e.length>=5&&e.length<=6},formatTime(n){return new Date(n).toLocaleString()},async saveTask(n){try{let e;return n.id?e=await Be.updateCronTask(Number(n.id),n):e=await Be.createCronTask(n),e}catch(e){throw console.error("Failed to save cron task:",e),e}},async deleteTask(n){try{await Be.deleteCronTask(String(n))}catch(e){throw console.error("Failed to delete cron task:",e),e}},async toggleTaskStatus(n){if(!n.id)throw new Error("Task ID is required");const e=n.status===0?1:0;return await Be.updateCronTask(Number(n.id),{...n,status:e})},prepareTaskExecution(n){return n.planTemplateId?{useTemplate:!0,planData:{title:n.cronName||"Scheduled Task Execution",planData:{id:n.planTemplateId,planTemplateId:n.planTemplateId,planId:n.planTemplateId},params:n.executionParams||void 0}}:{useTemplate:!1,taskContent:n.planDesc||n.cronName||""}}},wf={class:"modal-header"},kf={class:"header-actions"},Tf={class:"status-switch"},Pf={class:"status-label"},Cf={class:"toggle-switch"},Ef=["checked"],Rf={class:"modal-content"},If={class:"form-group"},Af={class:"form-label"},xf=["placeholder"],Df={class:"form-group"},Ff={class:"form-label"},Mf=["placeholder"],Uf={class:"form-help"},Nf={class:"form-group"},Lf={class:"form-label"},Bf=["placeholder"],Of={class:"form-group"},qf={class:"form-label"},Vf={class:"template-toggle"},jf={key:0,class:"template-selector"},Hf={value:""},Gf=["value"],Wf={class:"form-help"},zf={key:0,class:"form-group"},Jf={class:"time-info"},Kf={class:"time-label"},Xf={class:"time-value"},Qf={key:1,class:"form-group"},Yf={class:"time-info"},Zf={class:"time-label"},ev={class:"time-value"},tv={class:"modal-footer"},sv=["disabled"],ov=ce({__name:"TaskDetailModal",props:{modelValue:{type:Boolean},task:{}},emits:["update:modelValue","save"],setup(n,{emit:e}){const t=n,o=e,a=N(!1),l=N([]),i=N({cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""}),u=async()=>{try{const S=await Ze.getAllPlanTemplates();S&&S.templates&&(l.value=S.templates.map($=>({id:$.id,name:$.title||"Unnamed Template"})))}catch(S){console.error("Failed to get template list:",S)}},f=S=>{S.key==="Escape"&&t.modelValue&&o("update:modelValue",!1)};$e(()=>{u(),document.addEventListener("keydown",f)}),_e(()=>{document.removeEventListener("keydown",f)});const d=S=>{S.target===S.currentTarget&&o("update:modelValue",!1)},m=()=>{i.value.linkTemplate=!1,i.value.templateId="",i.value.planTemplateId=""},b=()=>i.value.cronName.trim()?i.value.cronTime.trim()?Oe.validateCronExpression(i.value.cronTime)?i.value.planDesc.trim()?i.value.linkTemplate&&!i.value.templateId?(alert("Please select a plan template"),!1):!0:(alert("Task description cannot be empty"),!1):(alert("Invalid Cron expression format, should be 5-6 parts separated by spaces"),!1):(alert("Cron expression cannot be empty"),!1):(alert("Task name cannot be empty"),!1),F=S=>Oe.formatTime(S),B=async()=>{var S;if(b()){a.value=!0;try{const $={...i.value,...((S=t.task)==null?void 0:S.id)!==void 0&&{id:t.task.id},cronName:i.value.cronName.trim(),cronTime:i.value.cronTime.trim(),planDesc:i.value.planDesc.trim(),status:i.value.status,planTemplateId:i.value.linkTemplate&&i.value.templateId||""};o("save",$)}finally{a.value=!1}}};return ie(()=>t.task,S=>{if(S){const $=S.templateId||S.planTemplateId||"";i.value={cronName:S.cronName||"",cronTime:S.cronTime||"",planDesc:S.planDesc||"",status:S.status??1,linkTemplate:!!$,templateId:$,planTemplateId:$}}else i.value={cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""}},{immediate:!0}),ie(()=>t.modelValue,S=>{S||(i.value={cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""})}),(S,$)=>(h(),ne(Qe,{to:"body"},[k(Ue,{name:"modal"},{default:Ee(()=>{var _,p,T;return[S.modelValue?(h(),g("div",{key:0,class:"modal-overlay",onClick:d},[s("div",{class:"modal-container",onClick:$[8]||($[8]=he(()=>{},["stop"]))},[s("div",wf,[s("h3",null,c(S.$t("cronTask.taskDetail")),1),s("div",kf,[s("div",Tf,[s("span",Pf,c(S.$t("cronTask.taskStatus")),1),s("label",Cf,[s("input",{type:"checkbox",checked:i.value.status===0,onChange:$[0]||($[0]=w=>i.value.status=i.value.status===0?1:0)},null,40,Ef),$[9]||($[9]=s("span",{class:"toggle-slider"},null,-1))])]),s("button",{class:"close-btn",onClick:$[1]||($[1]=w=>S.$emit("update:modelValue",!1))},[k(r(C),{icon:"carbon:close"})])])]),s("div",Rf,[s("form",{onSubmit:he(B,["prevent"]),class:"task-form"},[s("div",If,[s("label",Af,c(S.$t("cronTask.taskName")),1),te(s("input",{"onUpdate:modelValue":$[2]||($[2]=w=>i.value.cronName=w),type:"text",class:"form-input",placeholder:S.$t("cronTask.taskNamePlaceholder"),required:""},null,8,xf),[[re,i.value.cronName]])]),s("div",Df,[s("label",Ff,c(S.$t("cronTask.cronExpression")),1),te(s("input",{"onUpdate:modelValue":$[3]||($[3]=w=>i.value.cronTime=w),type:"text",class:"form-input",placeholder:S.$t("cronTask.cronExpressionPlaceholder"),required:""},null,8,Mf),[[re,i.value.cronTime]]),s("div",Uf,c(S.$t("cronTask.cronExpressionHelp")),1)]),s("div",Nf,[s("label",Lf,c(S.$t("cronTask.taskDescription")),1),te(s("textarea",{"onUpdate:modelValue":$[4]||($[4]=w=>i.value.planDesc=w),class:"form-textarea",placeholder:S.$t("cronTask.taskDescriptionPlaceholder"),rows:"4",required:""},null,8,Bf),[[re,i.value.planDesc]])]),s("div",Of,[s("label",qf,c(S.$t("cronTask.planTemplate")),1),s("div",Vf,[s("button",{type:"button",class:se(["template-btn",i.value.linkTemplate?"active":""]),onClick:$[5]||($[5]=w=>i.value.linkTemplate=!0)},[k(r(C),{icon:"carbon:checkmark"}),ee(" "+c(S.$t("cronTask.linkTemplate")),1)],2),s("button",{type:"button",class:se(["template-btn",i.value.linkTemplate?"":"active"]),onClick:m},[k(r(C),{icon:"carbon:close"}),ee(" "+c(S.$t("cronTask.noTemplate")),1)],2)]),i.value.linkTemplate?(h(),g("div",jf,[te(s("select",{"onUpdate:modelValue":$[6]||($[6]=w=>i.value.templateId=w),class:"form-select"},[s("option",Hf,c(S.$t("cronTask.selectTemplate")),1),(h(!0),g(oe,null,ae(l.value,w=>(h(),g("option",{key:w.id,value:w.id},c(w.name),9,Gf))),128))],512),[[st,i.value.templateId]]),s("div",Wf,c(S.$t("cronTask.templateHelpText")),1)])):q("",!0)]),(_=S.task)!=null&&_.createTime?(h(),g("div",zf,[s("div",Jf,[s("span",Kf,c(S.$t("cronTask.createTime"))+":",1),s("span",Xf,c(F(S.task.createTime)),1)])])):q("",!0),(p=S.task)!=null&&p.updateTime?(h(),g("div",Qf,[s("div",Yf,[s("span",Zf,c(S.$t("cronTask.updateTime"))+":",1),s("span",ev,c(F(S.task.updateTime)),1)])])):q("",!0)],32)]),s("div",tv,[s("button",{type:"button",class:"cancel-btn",onClick:$[7]||($[7]=w=>S.$emit("update:modelValue",!1))},c(S.$t("common.cancel")),1),s("button",{type:"button",class:"save-btn",onClick:B,disabled:a.value},[a.value?(h(),ne(r(C),{key:0,icon:"carbon:loading",class:"loading-icon"})):q("",!0),ee(" "+c((T=t.task)!=null&&T.id?S.$t("common.save"):S.$t("common.create")),1)],8,sv)])])])):q("",!0)]}),_:1})]))}}),nv=de(ov,[["__scopeId","data-v-45bbcf14"]]),av={class:"modal-header"},lv={class:"header-actions"},rv={class:"modal-content"},iv={key:0,class:"loading-container"},cv={key:1,class:"empty-container"},dv={key:2,class:"task-list"},uv=["onClick"],pv={class:"task-main"},hv={class:"task-info"},mv={class:"task-header"},fv={class:"task-name"},vv={class:"task-description"},gv={class:"task-time"},bv=["onClick"],yv=["onClick","disabled","title"],_v=["onClick","title"],$v={class:"dropdown-menu"},Sv=["onClick"],wv=["onClick","disabled"],kv=["onClick","disabled"],Tv={class:"confirm-header"},Pv={class:"confirm-content"},Cv={class:"confirm-actions"},Ev=["disabled"],Rv={class:"confirm-header"},Iv={class:"confirm-content"},Av={class:"create-options"},xv={class:"option-content"},Dv={class:"option-title"},Fv={class:"option-desc"},Mv={class:"option-content"},Uv={class:"option-title"},Nv={class:"option-desc"},Lv={class:"confirm-actions"},Bv=ce({__name:"CronTaskModal",props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue"],setup(n,{emit:e}){const t=os(),o=ns(),a=ls(),{t:l}=Se(),i=n,u=e,f=N([]),d=N(!1),m=N(null),b=N(null),F=N(null),B=N(null),S=N(!1),$=N(null),_=N(!1),p=N(null),T=N(!1),w=O=>{O.target===O.currentTarget&&u("update:modelValue",!1)},R=async()=>{d.value=!0;try{f.value=await Be.getAllCronTasks()}catch(O){console.error("Failed to load cron tasks:",O),a.error(`Failed to load tasks: ${O instanceof Error?O.message:String(O)}`)}finally{d.value=!1}},v=async O=>{m.value=O;try{const G=f.value.find(H=>H.id===O);if(!G){console.error("Task not found:",O);return}u("update:modelValue",!1);const Y=Date.now().toString();await t.push({name:"direct",params:{id:Y}}),await new Promise(H=>setTimeout(H,100));const V=Oe.prepareTaskExecution(G);V.useTemplate&&V.planData?o.emitPlanExecutionRequested(V.planData):V.taskContent&&o.setTask(V.taskContent)}catch(G){console.error("Failed to execute task:",G),a.error(`Execution failed: ${G instanceof Error?G.message:String(G)}`)}finally{m.value=null}},P=O=>{$.value={...O},S.value=!0,B.value=null},U=async O=>{try{await Oe.saveTask(O),await R(),S.value=!1,a.success("Task saved successfully")}catch(G){console.error("Failed to save task:",G),a.error(`Save failed: ${G instanceof Error?G.message:String(G)}`)}},W=O=>{p.value=O,_.value=!0},E=async()=>{var O;if((O=p.value)!=null&&O.id){b.value=p.value.id;try{await Oe.deleteTask(p.value.id),await R(),_.value=!1,p.value=null,a.success("Task deleted successfully")}catch(G){console.error("Failed to delete task:",G),a.error(`Delete failed: ${G instanceof Error?G.message:String(G)}`)}finally{b.value=null}}},x=()=>{_.value=!1,p.value=null},A=O=>{B.value=B.value===O?null:O},j=async O=>{if(O.id){F.value=O.id;try{await Oe.toggleTaskStatus(O),await R(),B.value=null,a.success(`Task ${O.status===0?"disabled":"enabled"} successfully`)}catch(G){console.error("Failed to toggle task status:",G),a.error(`Status toggle failed: ${G instanceof Error?G.message:String(G)}`)}finally{F.value=null}}},y=async O=>{try{await navigator.clipboard.writeText(O),a.success("Cron expression copied successfully")}catch(G){a.error(`Copy failed: ${G instanceof Error?G.message:String(G)}`)}},D=()=>{T.value=!0},J=()=>{T.value=!1;try{u("update:modelValue",!1);const O=l("cronTask.template");o.setTaskToInput(O);const G=Date.now().toString();t.push({name:"direct",params:{id:G}})}catch(O){console.error("Error in createWithJmanus:",O),a.error(`Creation failed: ${O instanceof Error?O.message:String(O)}`)}},X=()=>{T.value=!1,$.value={cronName:"",cronTime:"",planDesc:"",status:0,planTemplateId:""},S.value=!0},L=()=>{T.value=!1},M=O=>{const G=O.target;!G.closest(".action-dropdown")&&!G.closest(".dropdown-menu")&&(B.value=null)},Q=O=>{O.key==="Escape"&&(_.value?x():T.value?L():i.modelValue&&u("update:modelValue",!1))};return $e(()=>{document.addEventListener("click",M,!0),document.addEventListener("keydown",Q)}),_e(()=>{document.removeEventListener("click",M,!0),document.removeEventListener("keydown",Q)}),ie(()=>i.modelValue,O=>{O&&R()}),(O,G)=>(h(),g(oe,null,[(h(),ne(Qe,{to:"body"},[k(Ue,{name:"modal"},{default:Ee(()=>[n.modelValue?(h(),g("div",{key:0,class:"modal-overlay",onClick:w},[s("div",{class:"modal-container",onClick:G[3]||(G[3]=he(()=>{},["stop"]))},[s("div",av,[s("h3",null,c(O.$t("cronTask.title")),1),s("div",lv,[s("button",{class:"add-task-btn",onClick:[D,G[0]||(G[0]=he(()=>{},["stop"]))]},[k(r(C),{icon:"carbon:add"}),ee(" "+c(O.$t("cronTask.addTask")),1)]),s("button",{class:"close-btn",onClick:G[1]||(G[1]=Y=>O.$emit("update:modelValue",!1))},[k(r(C),{icon:"carbon:close"})])])]),s("div",rv,[d.value?(h(),g("div",iv,[k(r(C),{icon:"carbon:loading",class:"loading-icon"}),s("span",null,c(O.$t("common.loading")),1)])):f.value.length===0?(h(),g("div",cv,[k(r(C),{icon:"carbon:time",class:"empty-icon"}),s("span",null,c(O.$t("cronTask.noTasks")),1)])):(h(),g("div",dv,[(h(!0),g(oe,null,ae(f.value,Y=>(h(),g("div",{key:Y.id||"",class:"task-item",onClick:V=>P(Y)},[s("div",pv,[s("div",hv,[s("div",mv,[s("div",fv,c(Y.cronName),1),s("div",{class:se(["task-status-badge",Y.status===0?"active":"inactive"])},[k(r(C),{icon:Y.status===0?"carbon:checkmark-filled":"carbon:pause-filled"},null,8,["icon"]),s("span",null,c(Y.status===0?O.$t("cronTask.active"):O.$t("cronTask.inactive")),1)],2)]),s("div",vv,c(Y.planDesc),1),s("div",gv,[k(r(C),{icon:"carbon:time"}),s("span",{class:"cron-readable",style:{cursor:"pointer"},onClick:he(V=>y(Y.cronTime),["stop"])},c(Y.cronTime),9,bv)])])]),s("div",{class:"task-actions",onClick:G[2]||(G[2]=he(()=>{},["stop"]))},[s("button",{class:"action-btn execute-btn",onClick:V=>v(Y.id),disabled:m.value===Y.id,title:O.$t("cronTask.executeOnce")},[k(r(C),{icon:m.value===Y.id?"carbon:loading":"carbon:play-filled"},null,8,["icon"]),ee(" "+c(O.$t("cronTask.executeOnce")),1)],8,yv),s("div",{class:se(["action-dropdown",{active:B.value===Y.id}])},[s("button",{class:"action-btn dropdown-btn",onClick:V=>A(Y.id),title:O.$t("cronTask.operations")},[k(r(C),{icon:"carbon:overflow-menu-horizontal"}),ee(" "+c(O.$t("cronTask.operations")),1)],8,_v),te(s("div",$v,[s("button",{class:"dropdown-item edit-btn",onClick:V=>P(Y)},[k(r(C),{icon:"carbon:edit"}),ee(" "+c(O.$t("cronTask.edit")),1)],8,Sv),s("button",{class:"dropdown-item toggle-btn",onClick:V=>j(Y),disabled:F.value===Y.id},[k(r(C),{icon:F.value===Y.id?"carbon:loading":Y.status===0?"carbon:pause-filled":"carbon:play-filled"},null,8,["icon"]),ee(" "+c(Y.status===0?O.$t("cronTask.disable"):O.$t("cronTask.enable")),1)],8,wv),s("button",{class:"dropdown-item delete-btn",onClick:V=>W(Y),disabled:b.value===Y.id},[k(r(C),{icon:b.value===Y.id?"carbon:loading":"carbon:trash-can"},null,8,["icon"]),ee(" "+c(O.$t("cronTask.delete")),1)],8,kv)],512),[[es,B.value===Y.id]])],2)])],8,uv))),128))]))])])])):q("",!0)]),_:1})])),k(nv,{modelValue:S.value,"onUpdate:modelValue":G[4]||(G[4]=Y=>S.value=Y),task:$.value,onSave:U},null,8,["modelValue","task"]),(h(),ne(Qe,{to:"body"},[k(Ue,{name:"modal"},{default:Ee(()=>{var Y,V,H,K;return[_.value?(h(),g("div",{key:0,class:"modal-overlay",onClick:x},[s("div",{class:"confirm-modal",onClick:G[5]||(G[5]=he(()=>{},["stop"]))},[s("div",Tv,[k(r(C),{icon:"carbon:warning",class:"warning-icon"}),s("h3",null,c(O.$t("cronTask.deleteConfirm")),1)]),s("div",Pv,[s("p",null,c(O.$t("cronTask.deleteConfirmMessage",{taskName:((Y=p.value)==null?void 0:Y.cronName)||((V=p.value)==null?void 0:V.planDesc)||""})),1)]),s("div",Cv,[s("button",{class:"confirm-btn cancel-btn",onClick:x},c(O.$t("common.cancel")),1),s("button",{class:"confirm-btn delete-btn",onClick:E,disabled:b.value===((H=p.value)==null?void 0:H.id)},[k(r(C),{icon:b.value===((K=p.value)==null?void 0:K.id)?"carbon:loading":"carbon:trash-can"},null,8,["icon"]),ee(" "+c(O.$t("cronTask.delete")),1)],8,Ev)])])])):q("",!0)]}),_:1})])),(h(),ne(Qe,{to:"body"},[k(Ue,{name:"modal"},{default:Ee(()=>[T.value?(h(),g("div",{key:0,class:"modal-overlay",onClick:L},[s("div",{class:"confirm-modal create-options-modal",onClick:G[6]||(G[6]=he(()=>{},["stop"]))},[s("div",Rv,[k(r(C),{icon:"carbon:time",class:"create-icon"}),s("h3",null,c(O.$t("cronTask.createTask")),1)]),s("div",Iv,[s("p",null,c(O.$t("cronTask.selectCreateMethod")),1),s("div",Av,[s("button",{class:"create-option-btn jmanus-btn",onClick:J},[k(r(C),{icon:"carbon:ai-status"}),s("div",xv,[s("span",Dv,c(O.$t("cronTask.createWithJmanus")),1),s("span",Fv,c(O.$t("cronTask.createWithJmanusDesc")),1)])]),s("button",{class:"create-option-btn manual-btn",onClick:X},[k(r(C),{icon:"carbon:edit"}),s("div",Mv,[s("span",Uv,c(O.$t("cronTask.createManually")),1),s("span",Nv,c(O.$t("cronTask.createManuallyDesc")),1)])])])]),s("div",Lv,[s("button",{class:"confirm-btn cancel-btn",onClick:L},c(O.$t("common.cancel")),1)])])])):q("",!0)]),_:1})]))],64))}}),Ov=de(Bv,[["__scopeId","data-v-a90a3961"]]),qv={class:"direct-page"},Vv={class:"direct-chat"},jv={class:"chat-header"},Hv={class:"header-actions"},Gv=["title"],Wv=["title"],zv=["title"],Jv=["title"],Kv={class:"chat-content"},Xv=["title"],Qv={class:"message-content"},Yv=ce({__name:"index",setup(n){const e=Os(),t=os(),o=ns(),{t:a}=Se(),{message:l}=Vs(),i=N(""),u=N(""),f=N(),d=N(),m=N(),b=N(),F=N(!1),B=N(!1),S=N(null),$=N(!1),_=N(50),p=N(!1),T=N(0),w=N(0),R=le(()=>{if(z.isCollapsed)return _.value;let V=26;b.value&&b.value.sidebarWidth!==void 0&&(V=b.value.sidebarWidth);const H=100-V;return Math.max(20,Math.min(H,_.value))});$e(()=>{if(console.log("[Direct] onMounted called"),console.log("[Direct] taskStore.currentTask:",o.currentTask),console.log("[Direct] taskStore.hasUnprocessedTask():",o.hasUnprocessedTask()),Ie.setEventCallbacks({onPlanUpdate:H=>{console.log("[Direct] Plan update event received for rootPlanId:",H),E(H)&&(console.log("[Direct] Processing plan update for current rootPlanId:",H),d.value&&typeof d.value.handlePlanUpdate=="function"?(console.log("[Direct] Calling chatRef.handlePlanUpdate with rootPlanId:",H),d.value.handlePlanUpdate(H)):console.warn("[Direct] chatRef.handlePlanUpdate method not available"),f.value&&typeof f.value.updateDisplayedPlanProgress=="function"?(console.log("[Direct] Calling rightPanelRef.updateDisplayedPlanProgress with rootPlanId:",H),f.value.updateDisplayedPlanProgress(H)):console.warn("[Direct] rightPanelRef.updateDisplayedPlanProgress method not available"))},onPlanCompleted:H=>{if(console.log("[Direct] Plan completed event received for rootPlanId:",H),!!E(H)){if(console.log("[Direct] Processing plan completion for current rootPlanId:",H),d.value&&typeof d.value.handlePlanCompleted=="function"){const K=Ie.getCachedPlanRecord(H);K&&K.completed?K.summary&&K.summary.trim().length>0?(console.log("[Direct]  Plan details are valid and complete from polling cache, updating UI"),d.value.handlePlanCompleted(K)):(console.warn("[Direct]  Plan completed but summary is empty, still proceeding with available data"),d.value.handlePlanCompleted(K)):(console.warn("[Direct]  Plan details incomplete in cache, attempting API fallback"),yt.getDetails(H).then(ue=>{console.log("[Direct]  Got fresh details from API:",ue),ue&&ue.completed?(console.log("[Direct] Fresh details from API are valid, updating UI"),Ie.setCachedPlanRecord(H,ue),d.value.handlePlanCompleted(ue)):(console.warn("[Direct]  API details also incomplete, using best available data"),d.value.handlePlanCompleted(K??{planId:H}))}).catch(ue=>{console.error("[Direct] API call failed (likely record deleted), using cached data:",ue),d.value.handlePlanCompleted(K??{planId:H})}))}else console.warn("[Direct] chatRef.handlePlanCompleted method not available");S.value=null,console.log("[Direct] 🧹 Cleared currentRootPlanId after plan completion"),m.value&&typeof m.value.resetSession=="function"&&(console.log("[Direct] 🧹 Calling inputRef.resetSession to clear sessionPlanId"),m.value.resetSession())}},onDialogRoundStart:H=>{console.log("[Direct] Dialog round start event received for rootPlanId:",H),S.value=H,console.log("[Direct] Set currentRootPlanId to:",H),d.value&&typeof d.value.handleDialogRoundStart=="function"?(console.log("[Direct] Calling chatRef.handleDialogRoundStart with planId:",H),d.value.handleDialogRoundStart(H)):console.warn("[Direct] chatRef.handleDialogRoundStart method not available")},onChatInputClear:()=>{console.log("[Direct] Chat input clear event received"),j()},onChatInputUpdateState:H=>{if(console.log("[Direct] Chat input update state event received for rootPlanId:",H),!E(H,!0))return;const K=Ie.getCachedUIState(H);K&&D(K.enabled,K.placeholder)},onPlanError:H=>{d.value.handlePlanError(H)}}),console.log("[Direct] Event callbacks registered to planExecutionManager"),z.loadPlanTemplateList(),o.hasUnprocessedTask()&&o.currentTask){const H=o.currentTask.prompt;console.log("[Direct] Found unprocessed task from store:",H),o.markTaskAsProcessed(),ge(async()=>{try{console.log("[Direct] Calling handleChatSendMessage with taskContent:",H),await x({input:H})}catch(K){console.warn("[Direct] handleChatSendMessage failed, falling back to prompt:",K),i.value=H}})}else{const H=o.getAndClearTaskToInput();H?(u.value=H,console.log("[Direct] Setting inputOnlyContent for input only:",u.value)):(i.value=e.query.prompt||"",console.log("[Direct] Received task from URL:",i.value),console.log("[Direct] No unprocessed task in store"))}const V=localStorage.getItem("directPanelWidth");V&&(_.value=parseFloat(V)),console.log("[Direct] Final prompt value:",i.value),u.value&&ge(()=>{m.value&&typeof m.value.setInputValue=="function"&&(m.value.setInputValue(u.value),console.log("[Direct] Set input value:",u.value),u.value="")}),window.addEventListener("plan-execution-requested",H=>{console.log("[DirectView] Received plan-execution-requested event:",H.detail),O(H.detail)})}),ie(()=>o.currentTask,V=>{if(console.log("[Direct] Watch taskStore.currentTask triggered, newTask:",V),V&&!V.processed){const H=V.prompt;o.markTaskAsProcessed(),console.log("[Direct] Received new task from store:",H),ge(async()=>{try{console.log("[Direct] Directly executing new task via handleChatSendMessage:",H),await x({input:H})}catch(K){console.warn("[Direct] handleChatSendMessage failed for new task:",K)}})}else console.log("[Direct] Task is null or already processed, ignoring")},{immediate:!1}),ie(()=>i.value,(V,H)=>{console.log("[Direct] prompt value changed from:",H,"to:",V)},{immediate:!1}),ie(()=>o.taskToInput,V=>{console.log("[Direct] Watch taskStore.taskToInput triggered, newTaskToInput:",V),V!=null&&V.trim()&&(console.log("[Direct] Setting input value from taskToInput:",V),ge(()=>{m.value&&typeof m.value.setInputValue=="function"&&(m.value.setInputValue(V.trim()),console.log("[Direct] Input value set from taskToInput watch:",V.trim()),o.getAndClearTaskToInput())}))},{immediate:!1}),_e(()=>{console.log("[Direct] onUnmounted called, cleaning up resources"),S.value=null,Ie.cleanup(),document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",U),window.removeEventListener("plan-execution-requested",V=>{O(V.detail)})});const v=V=>{p.value=!0,T.value=V.clientX,w.value=_.value,document.addEventListener("mousemove",P),document.addEventListener("mouseup",U),document.body.style.cursor="col-resize",document.body.style.userSelect="none",V.preventDefault()},P=V=>{if(!p.value)return;const H=window.innerWidth,ue=(V.clientX-T.value)/H*100;let Re=w.value+ue;Re=Math.max(20,Math.min(80,Re)),_.value=Re},U=()=>{p.value=!1,document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",U),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("directPanelWidth",_.value.toString())},W=()=>{_.value=50,localStorage.setItem("directPanelWidth","50")},E=(V,H=!1)=>!S.value||V===S.value||H&&(V==="ui-state"||V==="error")?!0:(console.log("[Direct] Ignoring event for non-current rootPlanId:",V,"current:",S.value),!1),x=async V=>{var K,ue,Re,He,Ge,We,ze,Je,Ke;let H=null;try{console.log("[DirectView] Processing send-message event:",V);const Te=(K=d.value)==null?void 0:K.addMessage("user",V.input);V.attachments&&Te&&((ue=d.value)==null||ue.updateMessage(Te.id,{attachments:V.attachments})),H=(Re=d.value)==null?void 0:Re.addMessage("assistant","",{thinking:a("chat.thinkingProcessing")}),H&&((He=d.value)==null||He.startStreaming(H.id));const{DirectApiService:at}=await qs(async()=>{const{DirectApiService:Pe}=await Promise.resolve().then(()=>cf);return{DirectApiService:Pe}},void 0);console.log("[DirectView] Calling DirectApiService.sendMessageWithDefaultPlan");const pe=await at.sendMessageWithDefaultPlan(V);console.log("[DirectView] API response received:",pe),pe.planId&&H?((Ge=d.value)==null||Ge.updateMessage(H.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:pe.planId,rootPlanId:pe.planId,status:"running"}}),S.value=pe.planId,console.log("[DirectView] Set currentRootPlanId to:",pe.planId),Ie.handlePlanExecutionRequested(pe.planId,V.input),console.log("[DirectView] Started polling for plan execution updates")):H&&((We=d.value)==null||We.updateMessage(H.id,{content:pe.message||pe.result||"No response received from backend"}),(ze=d.value)==null||ze.stopStreaming(H.id))}catch(Te){console.error("[DirectView] Send message failed:",Te),(Je=d.value)==null||Je.addMessage("assistant",`Error: ${(Te==null?void 0:Te.message)||"Failed to send message"}`),H&&((Ke=d.value)==null||Ke.stopStreaming(H.id))}},A=async V=>{console.log("[DirectView] Send message from input:",JSON.stringify(V)),await x(V)},j=()=>{console.log("[DirectView] Input cleared"),m.value&&typeof m.value.clear=="function"&&m.value.clear()},y=()=>{console.log("[DirectView] Input focused")},D=(V,H)=>{console.log("[DirectView] Input state updated:",V,H),B.value=!V},J=V=>{console.log("[DirectView] Step selected:",V),f.value&&typeof f.value.handleStepSelected=="function"?(console.log("[DirectView] Forwarding step selection to right panel:",V),f.value.handleStepSelected(V)):console.warn("[DirectView] rightPanelRef.handleStepSelected method not available")},X=(V,H,K,ue)=>{console.log("[DirectView] Sub plan step selected:",{parentPlanId:V,subPlanId:H,stepIndex:K,subStepIndex:ue}),f.value&&typeof f.value.handleSubPlanStepSelected=="function"?(console.log("[DirectView] Forwarding sub plan step selection to right panel:",{parentPlanId:V,subPlanId:H,stepIndex:K,subStepIndex:ue}),f.value.handleSubPlanStepSelected(V,H,K,ue)):console.warn("[DirectView] rightPanelRef.handleSubPlanStepSelected method not available")},L=()=>{console.log("[DirectView] Plan mode button clicked"),z.toggleSidebar(),console.log("[DirectView] Sidebar toggled, isCollapsed:",z.isCollapsed)},M=()=>{t.push("/home")},Q=()=>{t.push("/configs")},O=async V=>{var ue,Re,He,Ge,We,ze,Je,Ke,Te,at;if(console.log("[DirectView] Plan execution requested:",V),F.value){console.log("[DirectView] Plan execution already in progress, ignoring request");return}F.value=!0;let H=!1,K=null;try{console.log("[DirectView] Adding messages for plan execution:",V.title),(ue=d.value)==null||ue.addMessage("user",V.title),H=!0,K=(Re=d.value)==null?void 0:Re.addMessage("assistant","",{thinking:a("chat.planningExecution")}),K&&((He=d.value)==null||He.startStreaming(K.id),console.log("[DirectView] Added assistant message for plan execution:",K.id))}catch(pe){console.warn("[DirectView] Failed to add messages:",pe)}try{const pe=(Ge=V.planData)==null?void 0:Ge.planTemplateId;if(!pe)throw new Error(a("direct.planTemplateIdNotFound"));console.log("[Direct] Executing plan with templateId:",pe,"params:",V.params),console.log("[Direct] About to call PlanActApiService.executePlan");const Pe=V.uploadedFiles||[],_t=V.uploadKey||void 0;console.log("[Direct] 🔍 DEBUG - InputArea uploadedFiles:",Pe),console.log("[Direct] 🔍 DEBUG - InputArea uploadKey:",_t),console.log("[Direct] Executing with uploaded files:",(Pe==null?void 0:Pe.length)??0),console.log("[Direct] Executing with replacement params:",V.replacementParams);let we;if((We=V.params)!=null&&We.trim()?(console.log("[Direct] Calling executePlan with rawParam:",V.params.trim()),we=await Ze.executePlan(pe,V.params.trim(),Pe,V.replacementParams,_t)):(console.log("[Direct] Calling executePlan without rawParam"),we=await Ze.executePlan(pe,void 0,Pe,V.replacementParams,_t)),console.log("[Direct] Plan execution API response:",we),we.planId&&K)console.log("[Direct] Got planId from response:",we.planId,"starting plan execution"),(ze=d.value)==null||ze.updateMessage(K.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:we.planId,rootPlanId:we.planId,status:"running"}}),S.value=we.planId,console.log("[Direct] Set currentRootPlanId to:",we.planId),console.log("[Direct] Delegating plan execution to planExecutionManager"),Ie.handlePlanExecutionRequested(we.planId,V.title);else throw console.error("[Direct] No planId in response:",we),new Error(a("direct.executionFailedNoPlanId"))}catch(pe){console.error("[Direct] Plan execution failed:",pe),console.error("[Direct] Error details:",{message:pe.message,stack:pe.stack}),S.value=null;try{console.log("[Direct] Adding error messages to chat"),H||(Je=d.value)==null||Je.addMessage("user",V.title),K?((Ke=d.value)==null||Ke.updateMessage(K.id,{content:`${a("direct.executionFailed")}: ${pe.message||a("common.unknownError")}`,thinking:void 0}),(Te=d.value)==null||Te.stopStreaming(K.id)):(at=d.value)==null||at.addMessage("assistant",`${a("direct.executionFailed")}: ${pe.message||a("common.unknownError")}`)}catch(Pe){console.error("[Direct] Failed to add error messages:",Pe),alert(`${a("direct.executionFailed")}: ${pe.message||a("common.unknownError")}`)}}finally{console.log("[Direct] Plan execution finished, resetting isExecutingPlan flag"),F.value=!1}},G=()=>{d.value.showMemory()},Y=()=>{xe.clearMemoryId(),d.value.newChat()};return(V,H)=>(h(),g("div",qv,[s("div",Vv,[k(hc,{ref_key:"sidebarRef",ref:b,onPlanExecutionRequested:O},null,512),s("div",{class:"left-panel",style:qe({width:R.value+"%"})},[s("div",jv,[s("button",{class:"back-button",onClick:M},[k(r(C),{icon:"carbon:arrow-left"})]),s("h2",null,c(V.$t("conversation")),1),s("div",Hv,[k(js),s("button",{class:"config-button",onClick:Y,title:V.$t("memory.newChat")},[k(r(C),{icon:"carbon:add",width:"20"})],8,Gv),s("button",{class:"config-button",onClick:Q,title:V.$t("direct.configuration")},[k(r(C),{icon:"carbon:settings-adjust",width:"20"})],8,Wv),s("button",{class:"cron-task-btn",onClick:H[0]||(H[0]=K=>$.value=!0),title:V.$t("cronTask.title")},[k(r(C),{icon:"carbon:alarm",width:"20"})],8,zv),s("button",{class:"cron-task-btn",onClick:H[1]||(H[1]=K=>r(xe).toggleSidebar()),title:V.$t("memory.selectMemory")},[k(r(C),{icon:"carbon:calendar",width:"20"})],8,Jv)])]),s("div",Kv,[k(ff,{ref_key:"chatRef",ref:d,mode:"direct","initial-prompt":i.value||"",onStepSelected:J,onSubPlanStepSelected:X},null,8,["initial-prompt"])]),(h(),ne(Sf,{key:V.$i18n.locale,ref_key:"inputRef",ref:m,disabled:B.value,placeholder:B.value?r(a)("input.waiting"):r(a)("input.placeholder"),"initial-value":i.value,onSend:A,onClear:j,onFocus:y,onUpdateState:D,onPlanModeClicked:L},null,8,["disabled","placeholder","initial-value"]))],4),s("div",{class:"panel-resizer",onMousedown:v,onDblclick:W,title:V.$t("direct.panelResizeHint")},H[3]||(H[3]=[s("div",{class:"resizer-line"},null,-1)]),40,Xv),k(pp,{ref_key:"rightPanelRef",ref:f,style:qe({width:100-_.value+"%"}),"current-root-plan-id":S.value},null,8,["style","current-root-plan-id"])]),k(Ov,{modelValue:$.value,"onUpdate:modelValue":H[2]||(H[2]=K=>$.value=K)},null,8,["modelValue"]),k(id,{onMemorySelected:G}),r(l).show?(h(),g("div",{key:0,class:se(["message-toast",r(l).type])},[s("div",Qv,[s("span",null,c(r(l).text),1)])],2)):q("",!0)]))}}),kg=de(Yv,[["__scopeId","data-v-35690d5f"]]);export{kg as default};
