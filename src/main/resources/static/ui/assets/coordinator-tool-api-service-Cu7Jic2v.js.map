{"version":3,"file":"coordinator-tool-api-service-Cu7Jic2v.js","sources":["../../src/api/coordinator-tool-api-service.ts"],"sourcesContent":["/*\n * Copyright 2025 the original author or authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport interface CoordinatorToolVO {\n  id?: number\n  toolName: string\n  toolDescription: string\n  planTemplateId: string\n  httpEndpoint?: string | undefined\n  mcpEndpoint?: string | undefined\n  inputSchema: string\n  serviceGroup?: string\n  enableInternalToolcall?: boolean\n  enableHttpService?: boolean\n  enableMcpService?: boolean\n  createTime?: string\n  updateTime?: string\n}\n\nexport interface CoordinatorToolConfig {\n  enabled: boolean\n  success: boolean\n  message?: string\n}\n\nexport class CoordinatorToolApiService {\n  private static readonly BASE_URL = '/api/coordinator-tools'\n\n  /**\n   * Get all coordinator tools\n   * @returns List of all coordinator tools\n   */\n  public static async getAllCoordinatorTools(): Promise<CoordinatorToolVO[]> {\n    try {\n      const response = await fetch(`${this.BASE_URL}`, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      })\n\n      if (!response.ok) {\n        throw new Error(`Failed to get coordinator tools: ${response.status}`)\n      }\n\n      const result = await response.json()\n      return result || []\n    } catch (error: unknown) {\n      console.error('Failed to get coordinator tools:', error)\n      const message = error instanceof Error ? error.message : 'Unknown error'\n      throw new Error('Failed to get coordinator tools: ' + message)\n    }\n  }\n\n  /**\n   * Get CoordinatorTool configuration information\n   */\n  public static async getCoordinatorToolConfig(): Promise<CoordinatorToolConfig> {\n    try {\n      const response = await fetch(`${this.BASE_URL}/config`, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      })\n\n      if (!response.ok) {\n        throw new Error(`Failed to get coordinator tool config: ${response.status}`)\n      }\n\n      return await response.json()\n    } catch (error: unknown) {\n      console.error('Failed to get CoordinatorTool configuration:', error)\n      // Return default configuration\n      const message = error instanceof Error ? error.message : 'Unknown error'\n      return {\n        enabled: true,\n        success: false,\n        message: message,\n      }\n    }\n  }\n\n  /**\n   * Get all endpoint list\n   */\n  public static async getAllEndpoints(): Promise<string[]> {\n    try {\n      const response = await fetch(`${this.BASE_URL}/endpoints`, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      })\n\n      if (!response.ok) {\n        throw new Error(`Failed to get endpoints: ${response.status}`)\n      }\n\n      return await response.json()\n    } catch (error: unknown) {\n      console.error('Failed to get endpoints:', error)\n      const message = error instanceof Error ? error.message : 'Unknown error'\n      throw new Error('Failed to get endpoints: ' + message)\n    }\n  }\n\n  /**\n   * Get coordinator tool by plan template ID\n   * @param planTemplateId Plan template ID\n   * @returns Coordinator tool if exists, null if not found\n   */\n  public static async getCoordinatorToolByTemplate(\n    planTemplateId: string\n  ): Promise<CoordinatorToolVO | null> {\n    console.log(\n      '[CoordinatorToolApiService] Getting coordinator tool, planTemplateId:',\n      planTemplateId\n    )\n    console.log(\n      '[CoordinatorToolApiService] Request URL:',\n      `${this.BASE_URL}/by-template/${planTemplateId}`\n    )\n\n    try {\n      const response = await fetch(`${this.BASE_URL}/by-template/${planTemplateId}`, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      })\n\n      console.log('[CoordinatorToolApiService] Response status:', response.status)\n\n      if (!response.ok) {\n        const errorText = await response.text()\n        console.error('[CoordinatorToolApiService] Response error content:', errorText)\n        throw new Error(`Failed to get coordinator tool: ${response.status} - ${errorText}`)\n      }\n\n      // Get response text first to check if empty\n      const text = await response.text()\n\n      // If response body is empty, treat as not found\n      if (!text || text.trim() === '') {\n        console.log(\n          '[CoordinatorToolApiService] Tool not found for planTemplateId (empty response):',\n          planTemplateId\n        )\n        return null\n      }\n\n      // Parse JSON response\n      let result: CoordinatorToolVO | null\n      try {\n        result = JSON.parse(text)\n      } catch (parseError) {\n        console.error('[CoordinatorToolApiService] Failed to parse JSON response:', parseError)\n        return null\n      }\n\n      // If result is null or empty object, treat as not found\n      if (result === null || (typeof result === 'object' && Object.keys(result).length === 0)) {\n        console.log(\n          '[CoordinatorToolApiService] Tool not found for planTemplateId:',\n          planTemplateId\n        )\n        return null\n      }\n\n      console.log('[CoordinatorToolApiService] Successfully got coordinator tool:', result)\n      return result\n    } catch (error: unknown) {\n      console.error('[CoordinatorToolApiService] Failed to get coordinator tool:', error)\n      const message = error instanceof Error ? error.message : 'Unknown error'\n      throw new Error('Failed to get coordinator tool: ' + message)\n    }\n  }\n\n  /**\n   * Create a default coordinator tool VO for a plan template\n   * This creates a VO object but does not save it to the database\n   * @param planTemplateId Plan template ID\n   * @param planTitle Optional plan template title\n   * @param planDescription Optional plan template description\n   * @returns Default coordinator tool VO\n   */\n  public static createDefaultCoordinatorTool(\n    planTemplateId: string,\n    planTitle?: string,\n    planDescription?: string\n  ): CoordinatorToolVO {\n    return {\n      toolName: planTitle ? `tool_${planTitle}` : '',\n      toolDescription: planDescription ?? '',\n      planTemplateId: planTemplateId,\n      inputSchema: '[]',\n      serviceGroup: '',\n      enableInternalToolcall: false,\n      enableHttpService: false,\n      enableMcpService: false,\n    }\n  }\n\n  /**\n   * Create coordinator tool\n   */\n  public static async createCoordinatorTool(tool: CoordinatorToolVO): Promise<CoordinatorToolVO> {\n    console.log('[CoordinatorToolApiService] Starting to create coordinator tool')\n    console.log('[CoordinatorToolApiService] Original data:', JSON.stringify(tool, null, 2))\n    console.log('[CoordinatorToolApiService] Request URL:', `${this.BASE_URL}`)\n\n    // Only send necessary fields, excluding createTime and updateTime\n    const requestData = {\n      id: tool.id,\n      toolName: tool.toolName,\n      toolDescription: tool.toolDescription,\n      inputSchema: tool.inputSchema,\n      planTemplateId: tool.planTemplateId,\n      httpEndpoint: tool.httpEndpoint,\n      mcpEndpoint: tool.mcpEndpoint,\n      serviceGroup: tool.serviceGroup,\n      enableInternalToolcall: tool.enableInternalToolcall,\n      enableHttpService: tool.enableHttpService,\n      enableMcpService: tool.enableMcpService,\n    }\n\n    console.log(\n      '[CoordinatorToolApiService] Cleaned sending data:',\n      JSON.stringify(requestData, null, 2)\n    )\n\n    try {\n      const response = await fetch(`${this.BASE_URL}`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(requestData),\n      })\n\n      console.log('[CoordinatorToolApiService] Response status:', response.status)\n      console.log('[CoordinatorToolApiService] Response status text:', response.statusText)\n\n      if (!response.ok) {\n        let errorMessage = 'Unknown error'\n        try {\n          const errorData = await response.json()\n          errorMessage = errorData.message || errorData.error || errorMessage\n        } catch {\n          // If JSON parsing fails, try to get text\n          const errorText = await response.text()\n          errorMessage = errorText || errorMessage\n        }\n        console.error('[CoordinatorToolApiService] Response error content:', errorMessage)\n        throw new Error(`Failed to create coordinator tool: ${response.status} - ${errorMessage}`)\n      }\n\n      const result = await response.json()\n      console.log('[CoordinatorToolApiService] Created successfully, result:', result)\n      return result\n    } catch (error: unknown) {\n      console.error('[CoordinatorToolApiService] Failed to create coordinator tool:', error)\n      const message = error instanceof Error ? error.message : 'Unknown error'\n      throw new Error('Failed to create coordinator tool: ' + message)\n    }\n  }\n\n  /**\n   * Update coordinator tool\n   */\n  public static async updateCoordinatorTool(\n    id: number,\n    tool: CoordinatorToolVO\n  ): Promise<CoordinatorToolVO> {\n    console.log('[CoordinatorToolApiService] Starting to update coordinator tool, ID:', id)\n    console.log('[CoordinatorToolApiService] Sending data:', tool)\n    console.log('[CoordinatorToolApiService] Request URL:', `${this.BASE_URL}/${id}`)\n\n    // Only send necessary fields, excluding createTime and updateTime\n    const requestData = {\n      id: tool.id,\n      toolName: tool.toolName,\n      toolDescription: tool.toolDescription,\n      inputSchema: tool.inputSchema,\n      planTemplateId: tool.planTemplateId,\n      httpEndpoint: tool.httpEndpoint,\n      mcpEndpoint: tool.mcpEndpoint,\n      serviceGroup: tool.serviceGroup,\n      enableInternalToolcall: tool.enableInternalToolcall,\n      enableHttpService: tool.enableHttpService,\n      enableMcpService: tool.enableMcpService,\n    }\n\n    console.log('[CoordinatorToolApiService] Cleaned sending data:', requestData)\n\n    try {\n      const response = await fetch(`${this.BASE_URL}/${id}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(requestData),\n      })\n\n      console.log('[CoordinatorToolApiService] Response status:', response.status)\n      console.log('[CoordinatorToolApiService] Response status text:', response.statusText)\n\n      if (!response.ok) {\n        let errorMessage = 'Unknown error'\n        try {\n          const errorData = await response.json()\n          errorMessage = errorData.message || errorData.error || errorMessage\n        } catch {\n          // If JSON parsing fails, try to get text\n          const errorText = await response.text()\n          errorMessage = errorText || errorMessage\n        }\n        console.error('[CoordinatorToolApiService] Response error content:', errorMessage)\n        throw new Error(`Failed to update coordinator tool: ${response.status} - ${errorMessage}`)\n      }\n\n      const result = await response.json()\n      console.log('[CoordinatorToolApiService] Updated successfully, result:', result)\n      return result\n    } catch (error: unknown) {\n      console.error('[CoordinatorToolApiService] Failed to update coordinator tool:', error)\n      const message = error instanceof Error ? error.message : 'Unknown error'\n      throw new Error('Failed to update coordinator tool: ' + message)\n    }\n  }\n\n  /**\n   * Delete coordinator tool\n   */\n  public static async deleteCoordinatorTool(\n    id: number\n  ): Promise<{ success: boolean; message: string }> {\n    console.log('[CoordinatorToolApiService] Starting to delete coordinator tool, ID:', id)\n    console.log('[CoordinatorToolApiService] Request URL:', `${this.BASE_URL}/${id}`)\n\n    try {\n      const response = await fetch(`${this.BASE_URL}/${id}`, {\n        method: 'DELETE',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      })\n\n      console.log('[CoordinatorToolApiService] Response status:', response.status)\n      console.log('[CoordinatorToolApiService] Response status text:', response.statusText)\n\n      if (!response.ok) {\n        const errorText = await response.text()\n        console.error('[CoordinatorToolApiService] Response error content:', errorText)\n        throw new Error(`Failed to delete coordinator tool: ${response.status} - ${errorText}`)\n      }\n\n      const result = await response.json()\n      console.log('[CoordinatorToolApiService] Deleted successfully, result:', result)\n      return result\n    } catch (error: unknown) {\n      console.error('[CoordinatorToolApiService] Failed to delete coordinator tool:', error)\n      const message = error instanceof Error ? error.message : 'Unknown error'\n      throw new Error('Failed to delete coordinator tool: ' + message)\n    }\n  }\n}\n"],"names":["CoordinatorToolApiService","response","error","message","planTemplateId","errorText","text","result","parseError","planTitle","planDescription","tool","requestData","errorMessage","errorData","id"],"mappings":"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"}