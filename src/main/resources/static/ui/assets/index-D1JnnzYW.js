const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/sidebar-5tyxaoYG.js","assets/index-Di-C3GYT.js","assets/index-Cehgtc1Y.css","assets/llm-check-CJy4TeZw.js"])))=>i.map(i=>d[i]);
import{c as me,d as ye,a as f,b as p,e as s,f as V,t as i,F as ie,q as pe,g as k,i as r,u as Ie,n as le,h as re,z as Ve,j as be,l as he,B as Yt,C as Ye,r as F,o as Te,D as ue,E as Re,w as de,m as ve,G as dt,H as St,v as Ds,I as Zt,J as Xe,A as ke,T as Ct,p as je,K as Ns,M as Us,N as Os,O as Ke,_ as es,P as Ls,y as Bs}from"./index-Di-C3GYT.js";import{D as qs,u as Qe,P as it,T as Vs,s as q}from"./sidebar-5tyxaoYG.js";import{I as T,_ as _e}from"./_plugin-vue_export-helper-DuD37CTk.js";import{CoordinatorToolApiService as Ae}from"./coordinator-tool-api-service-Cu7Jic2v.js";import{L as js}from"./LanguageSwitcher-dO_9SAbX.js";import{M as ts,u as ss,a as Gs}from"./useMessage-IJe1lkNO.js";import"./llm-check-CJy4TeZw.js";class Tt{static BASE_URL="/api/executor";static async getDetails(e){try{const n=await fetch(`${this.BASE_URL}/details/${e}`);if(n.status===404)return null;if(!n.ok){const l=await n.text();throw new Error(`Failed to get detailed information: ${n.status} - ${l}`)}const t=await n.text(),a=JSON.parse(t);return a&&typeof a=="object"&&!a.currentPlanId&&(a.currentPlanId=e),a}catch(n){return console.error("[CommonApiService] Failed to get plan details:",n),null}}static async submitFormInput(e,n){const t=await fetch(`${this.BASE_URL}/submit-input/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!t.ok){let l;try{l=await t.json()}catch{l={message:`Failed to submit form input: ${t.status}`}}throw new Error(l.message||`Failed to submit form input: ${t.status}`)}const a=t.headers.get("content-type");return a&&a.indexOf("application/json")!==-1?await t.json():{success:!0}}static async getAllPrompts(){try{const e=await fetch(this.BASE_URL);return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get Prompt list:",e),e}}static async handleResponse(e){if(!e.ok)try{const n=await e.json();throw new Error(n.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}}function Rt(){return{formatResponseText:h=>h?h.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\n/g,"<br>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>"):"",formatTimestamp:h=>{const m=new Date().getTime()-h.getTime();return m<6e4?"Just now":m<36e5?`${Math.floor(m/6e4)} minutes ago`:m<864e5?`${Math.floor(m/36e5)} hours ago`:h.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},getMessageClasses:h=>me(()=>({user:h.type==="user",assistant:h.type==="assistant",streaming:h.isStreaming,"has-error":!!h.error,"has-thinking":!!h.thinking,"has-execution":!!h.planExecution})),formatFileSize:h=>{if(h===0)return"0 B";const u=1024,m=["B","KB","MB","GB"],w=Math.floor(Math.log(h)/Math.log(u));return parseFloat((h/Math.pow(u,w)).toFixed(2))+" "+m[w]},truncateText:(h,u=100)=>!h||h.length<=u?h:h.substring(0,u)+"...",stripHtml:h=>h.replace(/<[^>]*>/g,""),hasDisplayableContent:h=>!!(h.content||(h.thinking??!1)||(h.planExecution??!1)||h.error),getMessageStatus:h=>h.error?"Send failed":h.isStreaming?"Typing...":h.type==="assistant"&&!h.content&&!h.thinking?"Waiting for response":""}}const Hs=["data-message-id"],zs={class:"user-content"},Js={class:"message-text"},Ws={key:0,class:"attachments"},Ks={class:"attachment-name"},Xs={class:"attachment-size"},Qs={class:"message-timestamp"},Ys={key:0,class:"message-status error"},Zs={class:"status-text"},en=ye({__name:"UserMessage",props:{message:{}},setup(o){const{formatTimestamp:e,formatFileSize:n}=Rt();return(t,a)=>(p(),f("div",{class:"user-message","data-message-id":t.message.id},[s("div",zs,[s("div",Js,i(t.message.content),1),t.message.attachments?.length?(p(),f("div",Ws,[(p(!0),f(ie,null,pe(t.message.attachments,(l,c)=>(p(),f("div",{key:c,class:"attachment-item"},[k(r(T),{icon:"carbon:document",class:"attachment-icon"}),s("span",Ks,i(l.name),1),s("span",Xs,i(r(n)(l.size)),1)]))),128))])):V("",!0),s("div",Qs,i(r(e)(t.message.timestamp)),1)]),t.message.error?(p(),f("div",Ys,[k(r(T),{icon:"carbon:warning",class:"status-icon"}),s("span",Zs,i(t.message.error),1)])):V("",!0)],8,Hs))}}),tn=_e(en,[["__scopeId","data-v-27de3afc"]]),sn={class:"sub-plan-info"},nn={class:"sub-plan-details"},on={class:"sub-plan-title"},an={key:0,class:"nesting-level"},ln={class:"sub-plan-id"},rn={class:"sub-plan-meta"},cn={key:0,class:"trigger-tool"},dn={class:"trigger-text"},un={key:0,class:"sub-plan-progress"},pn={class:"progress-info"},hn={class:"progress-text"},mn={class:"progress-bar"},fn={key:1,class:"sub-plan-agents-steps"},gn={class:"agents-steps-header"},vn={class:"agents-label"},bn={class:"agents-steps-list"},yn=["onClick"],_n={class:"agent-step-header"},Sn={class:"agent-name"},wn={class:"sub-agent-execution-info"},$n={key:0,class:"agent-result"},Pn={class:"result-header"},kn={class:"result-label"},En={class:"result-content"},Cn={key:1,class:"agent-error"},Tn={class:"error-header"},Rn={class:"error-label"},In={class:"error-content"},An={key:2,class:"think-act-preview"},xn={class:"think-act-header"},Mn={class:"think-act-label"},Fn={class:"think-act-steps-preview"},Dn=["onClick"],Nn={class:"step-number"},Un={class:"step-description"},On={key:0,class:"more-steps"},Ln={class:"more-steps-text"},Bn={key:3,class:"nested-sub-plans"},qn={class:"nested-sub-plans-header"},Vn={class:"nested-label"},jn={class:"nested-sub-plans-list"},Gn={key:4,class:"direct-sub-plans"},Hn={class:"direct-sub-plans-header"},zn={class:"direct-label"},Jn={class:"direct-sub-plans-list"},Wn=ye({__name:"RecursiveSubPlan",props:{subPlan:{},subPlanIndex:{},nestingLevel:{default:0},maxNestingDepth:{default:3},maxVisibleSteps:{default:2}},emits:["sub-plan-selected","step-selected"],setup(o,{emit:e}){const n=o,t=e,{t:a}=Ie(),l=()=>`nesting-level-${n.nestingLevel}`,c=()=>n.subPlan.completed?"completed":n.subPlan.agentExecutionSequence?.some(N=>N.status==="RUNNING")?"running":n.subPlan.agentExecutionSequence?.some(N=>N.status==="FINISHED")?"in-progress":"pending",d=()=>{switch(c()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},h=()=>{switch(c()){case"completed":return"carbon:checkmark";case"running":return"carbon:play";case"in-progress":return"carbon:in-progress";case"pending":default:return"carbon:dot-mark"}},u=()=>{if(!n.subPlan.agentExecutionSequence?.length)return 0;if(n.subPlan.completed)return 100;const b=m();return Math.min(100,b/n.subPlan.agentExecutionSequence.length*100)},m=()=>n.subPlan.agentExecutionSequence?.length?n.subPlan.agentExecutionSequence.filter(b=>b.status==="FINISHED").length:0,w=b=>{switch(b){case"FINISHED":return"completed";case"RUNNING":return"running";case"IDLE":default:return"pending"}},x=b=>{switch(b){case"FINISHED":return"carbon:checkmark";case"RUNNING":return"carbon:play";case"IDLE":default:return"carbon:dot-mark"}},j=b=>{switch(b){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},g=b=>b.thinkActSteps?.some(R=>R.subPlanExecutionRecord)??!1,y=b=>b.thinkActSteps?.filter(R=>R.subPlanExecutionRecord)??[],_=()=>{t("sub-plan-selected",-1,n.subPlanIndex,n.subPlan)},v=(b,R)=>{const N=R.stepId??`subplan-${n.subPlanIndex}-agent-${b}`;t("step-selected",N)},S=(b,R,N)=>{const G=N.stepId??`subplan-${n.subPlanIndex}-agent-${b}`;t("step-selected",G)},A=(b,R,N)=>{t("sub-plan-selected",b,R,N)},P=b=>{t("step-selected",b)};return(b,R)=>{const N=Yt("RecursiveSubPlan",!0);return p(),f("div",{class:le(["recursive-sub-plan",l()])},[s("div",{class:"sub-plan-header",onClick:_},[s("div",sn,[k(r(T),{icon:h(),class:"sub-plan-status-icon"},null,8,["icon"]),s("div",nn,[s("div",on,[re(i(b.subPlan.title||b.$t("chat.subPlan"))+" #"+i(b.subPlanIndex+1)+" ",1),(b.nestingLevel??0)>0?(p(),f("span",an,"(L"+i((b.nestingLevel??0)+1)+")",1)):V("",!0)]),s("div",ln,i(b.subPlan.currentPlanId),1)])]),s("div",rn,[s("div",{class:le(["sub-plan-status-badge",c()])},i(d()),3),b.subPlan.parentActToolCall?(p(),f("div",cn,[k(r(T),{icon:"carbon:function",class:"trigger-icon"}),s("span",dn,i(b.subPlan.parentActToolCall.name),1)])):V("",!0)])]),b.subPlan.agentExecutionSequence?.length?(p(),f("div",un,[s("div",pn,[s("span",hn,i(b.$t("chat.progress"))+": "+i(m())+" / "+i(b.subPlan.agentExecutionSequence.length),1),s("div",mn,[s("div",{class:"progress-fill",style:Ve({width:u()+"%"})},null,4)])])])):V("",!0),b.subPlan.agentExecutionSequence?.length?(p(),f("div",fn,[s("div",gn,[s("span",vn,i(b.$t("chat.agentExecutions"))+":",1)]),s("div",bn,[(p(!0),f(ie,null,pe(b.subPlan.agentExecutionSequence,(G,$)=>(p(),f("div",{key:G.id||$,class:le(["agent-step-item",w(G.status)]),onClick:U=>v($,G)},[s("div",_n,[k(r(T),{icon:x(G.status),class:"agent-icon"},null,8,["icon"]),s("span",Sn,i(G.agentName||b.$t("chat.unknownAgent")),1),s("div",{class:le(["agent-status-badge",w(G.status)])},i(j(G.status)),3)]),s("div",wn,[G.result?(p(),f("div",$n,[s("div",Pn,[k(r(T),{icon:"carbon:checkmark",class:"result-icon"}),s("span",kn,i(b.$t("chat.agentResult"))+":",1)]),s("pre",En,i(G.result),1)])):V("",!0),G.errorMessage?(p(),f("div",Cn,[s("div",Tn,[k(r(T),{icon:"carbon:warning",class:"error-icon"}),s("span",Rn,i(b.$t("chat.errorMessage"))+":",1)]),s("pre",In,i(G.errorMessage),1)])):V("",!0),G.thinkActSteps?.length?(p(),f("div",An,[s("div",xn,[k(r(T),{icon:"carbon:thinking",class:"think-act-icon"}),s("span",Mn,i(b.$t("chat.thinkActSteps"))+" ("+i(G.thinkActSteps.length)+")",1)]),s("div",Fn,[(p(!0),f(ie,null,pe(G.thinkActSteps.slice(0,b.maxVisibleSteps??2),(U,B)=>(p(),f("div",{key:U.id||B,class:"think-act-step-preview",onClick:be(Y=>S($,B,G),["stop"])},[s("span",Nn,"#"+i(B+1),1),s("span",Un,i(U.actionDescription||b.$t("chat.thinking")),1),k(r(T),{icon:"carbon:arrow-right",class:"step-arrow"})],8,Dn))),128)),G.thinkActSteps.length>(b.maxVisibleSteps??2)?(p(),f("div",On,[s("span",Ln,i(b.$t("chat.andMoreSteps",{count:G.thinkActSteps.length-(b.maxVisibleSteps??2)})),1)])):V("",!0)])])):V("",!0),g(G)?(p(),f("div",Bn,[s("div",qn,[k(r(T),{icon:"carbon:tree-view-alt",class:"nested-icon"}),s("span",Vn,i(b.$t("chat.nestedSubPlans")),1)]),s("div",jn,[(p(!0),f(ie,null,pe(y(G),(U,B)=>(p(),he(N,{key:U.id||B,"sub-plan":U.subPlanExecutionRecord,"sub-plan-index":B,"nesting-level":(b.nestingLevel??0)+1,"max-nesting-depth":b.maxNestingDepth??3,"max-visible-steps":b.maxVisibleSteps??2,onSubPlanSelected:A,onStepSelected:P},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):V("",!0),G.subPlanExecutionRecords?.length?(p(),f("div",Gn,[s("div",Hn,[k(r(T),{icon:"carbon:tree-view",class:"direct-icon"}),s("span",zn,i(b.$t("chat.directSubPlans")),1)]),s("div",Jn,[(p(!0),f(ie,null,pe(G.subPlanExecutionRecords,(U,B)=>(p(),he(N,{key:U.currentPlanId||B,"sub-plan":U,"sub-plan-index":B,"nesting-level":(b.nestingLevel??0)+1,"max-nesting-depth":b.maxNestingDepth??3,"max-visible-steps":b.maxVisibleSteps??2,onSubPlanSelected:A,onStepSelected:P},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):V("",!0)])],10,yn))),128))])])):V("",!0)],2)}}}),Kn=_e(Wn,[["__scopeId","data-v-1d7fe8a1"]]),Xn={class:"execution-details"},Qn={key:0,class:"plan-overview"},Yn={class:"plan-header"},Zn={class:"plan-title"},eo={key:0,class:"parent-tool-call"},to={class:"parent-tool-header"},so={class:"tool-label"},no={class:"tool-name"},oo={key:0,class:"tool-parameters"},ao={class:"param-label"},lo={class:"param-content"},ro={key:1,class:"agent-execution-container"},io={class:"section-title"},co=["onClick"],uo={class:"agent-info"},po={class:"agent-details"},ho={class:"agent-name"},mo={class:"request-content"},fo={class:"agent-controls"},go={class:"agent-execution-info"},vo={key:0,class:"agent-result"},bo={class:"result-header"},yo={class:"result-label"},_o={class:"result-content"},So={key:1,class:"agent-error"},wo={class:"error-header"},$o={class:"error-label"},Po={class:"error-content"},ko={key:0,class:"sub-plans-container"},Eo={class:"sub-plans-header"},Co={class:"sub-plans-title"},To={class:"sub-plans-list"},Ro=ye({__name:"ExecutionDetails",props:{planExecution:{}},emits:["sub-plan-selected","step-selected"],setup(o,{emit:e}){const n=o,t=e,{t:a}=Ie(),l=me(()=>n.planExecution.agentExecutionSequence??[]),c=y=>{y.stepId?t("step-selected",y.stepId):console.warn("[ExecutionDetails] Agent execution has no stepId:",y)},d=()=>n.planExecution.completed?"completed":l.value.some(v=>v.status==="RUNNING")?"running":l.value.some(v=>v.status==="FINISHED")?"in-progress":"pending",h=()=>{switch(d()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},u=y=>{switch(y){case"RUNNING":return"running";case"FINISHED":return"completed";case"IDLE":default:return"pending"}},m=y=>{switch(y){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},w=y=>{switch(y){case"RUNNING":return"carbon:play";case"FINISHED":return"carbon:checkmark";case"IDLE":default:return"carbon:dot-mark"}},x=(y,_,v)=>{t("sub-plan-selected",y,_,v)},j=y=>{t("step-selected",y)},g=y=>{if(!y)return"";try{const _=JSON.parse(y);return JSON.stringify(_,null,2)}catch{return y}};return(y,_)=>(p(),f("div",Xn,[y.planExecution?(p(),f("div",Qn,[s("div",Yn,[s("h3",Zn,i(y.planExecution.title||y.$t("chat.planExecution")),1),s("div",{class:le(["plan-status-badge",d()])},i(h()),3)]),y.planExecution.parentActToolCall?(p(),f("div",eo,[s("div",to,[k(r(T),{icon:"carbon:flow",class:"tool-icon"}),s("span",so,i(y.$t("chat.triggeredByTool"))+":",1),s("span",no,i(y.planExecution.parentActToolCall.name),1)]),y.planExecution.parentActToolCall.parameters?(p(),f("div",oo,[s("span",ao,i(y.$t("common.parameters"))+":",1),s("pre",lo,i(g(y.planExecution.parentActToolCall.parameters)),1)])):V("",!0)])):V("",!0)])):V("",!0),(y.planExecution?.agentExecutionSequence?.length??0)>0?(p(),f("div",ro,[s("h4",io,i(y.$t("chat.agentExecutionSequence")),1),(p(!0),f(ie,null,pe(y.planExecution?.agentExecutionSequence,(v,S)=>(p(),f("div",{key:v.id||S,class:le(["agent-execution-item",u(v.status)])},[s("div",{class:"agent-header",onClick:A=>c(v)},[s("div",uo,[k(r(T),{icon:w(v.status),class:"agent-status-icon"},null,8,["icon"]),s("div",po,[s("div",ho,i(v.agentName||y.$t("chat.unknownAgent")),1),s("pre",mo,i(v.agentRequest),1)])]),s("div",fo,[s("div",{class:le(["agent-status-badge",u(v.status)])},i(m(v.status)),3),k(r(T),{icon:"carbon:arrow-right",class:"step-select-icon"})])],8,co),s("div",go,[v.result?(p(),f("div",vo,[s("div",bo,[k(r(T),{icon:"carbon:checkmark",class:"result-icon"}),s("span",yo,i(y.$t("chat.agentResult"))+":",1)]),s("pre",_o,i(v.result),1)])):V("",!0),v.errorMessage?(p(),f("div",So,[s("div",wo,[k(r(T),{icon:"carbon:warning",class:"error-icon"}),s("span",$o,i(y.$t("chat.errorMessage"))+":",1)]),s("pre",Po,i(v.errorMessage),1)])):V("",!0)]),v.subPlanExecutionRecords?.length?(p(),f("div",ko,[s("div",Eo,[k(r(T),{icon:"carbon:tree-view",class:"sub-plans-icon"}),s("span",Co,i(y.$t("chat.subPlanExecutions"))+" ("+i(v.subPlanExecutionRecords.length)+") ",1)]),s("div",To,[(p(!0),f(ie,null,pe(v.subPlanExecutionRecords,(A,P)=>(p(),he(Kn,{key:A.currentPlanId||P,"sub-plan":A,"sub-plan-index":P,"nesting-level":0,"max-nesting-depth":3,"max-visible-steps":2,onSubPlanSelected:x,onStepSelected:j},null,8,["sub-plan","sub-plan-index"]))),128))])])):V("",!0)],2))),128))])):V("",!0)]))}}),ns=_e(Ro,[["__scopeId","data-v-b1d6b7b8"]]),Io={key:0,class:"thinking-section"},Ao={class:"thinking-header"},xo={class:"thinking-avatar"},Mo={class:"thinking-label"},Fo={class:"thinking-content"},Do={key:0,class:"thinking"},No={key:2,class:"default-processing"},Uo={class:"processing-indicator"},Oo=ye({__name:"ThinkingSection",props:{thinking:{},thinkingDetails:{},planExecution:{},stepActions:{},genericInput:{},hasContent:{type:Boolean}},emits:["agent-selected","sub-plan-selected","user-input-submitted","step-selected"],setup(o,{emit:e}){const n=o,t=e,a=me(()=>(n.thinking??!1)||(n.thinkingDetails?.agentExecutionSequence?.length??0)>0||(n.planExecution?.agentExecutionSequence?.length??0)>0),l=(u,m)=>{t("agent-selected",u,m)},c=(u,m,w)=>{t("sub-plan-selected",u,m,w)},d=u=>{t("user-input-submitted",u)},h=u=>{t("step-selected",u)};return(u,m)=>a.value?(p(),f("div",Io,[s("div",Ao,[s("div",xo,[k(r(T),{icon:"carbon:thinking",class:"thinking-icon"})]),s("div",Mo,i(u.$t("chat.thinkingLabel")),1)]),s("div",Fo,[u.thinking?(p(),f("div",Do,[k(r(T),{icon:"carbon:thinking",class:"thinking-icon"}),s("span",null,i(u.thinking),1)])):V("",!0),u.thinkingDetails||u.planExecution?(p(),he(ns,{key:1,"plan-execution":u.thinkingDetails||u.planExecution,"step-actions":u.stepActions||[],"generic-input":u.genericInput||"",onAgentSelected:l,onSubPlanSelected:c,onUserInputSubmitted:d,onStepSelected:h},null,8,["plan-execution","step-actions","generic-input"])):!u.hasContent&&u.thinking?(p(),f("div",No,[s("div",Uo,[m[0]||(m[0]=s("div",{class:"thinking-dots"},[s("span"),s("span"),s("span")],-1)),s("span",null,i(u.thinking||u.$t("chat.thinkingProcessing")),1)])])):V("",!0)])])):V("",!0)}}),Lo=_e(Oo,[["__scopeId","data-v-b4256759"]]),Bo={class:"user-input-form-container"},qo={class:"user-input-header"},Vo={class:"user-input-title"},jo={class:"user-input-message"},Go={key:0,class:"form-description"},Ho={key:0,class:"form-grid"},zo=["for"],Jo=["id","name","placeholder","required","onUpdate:modelValue"],Wo=["id","name","placeholder","required","onUpdate:modelValue"],Ko=["id","name","placeholder","required","onUpdate:modelValue"],Xo=["id","name","placeholder","required","onUpdate:modelValue"],Qo=["id","name","placeholder","required","onUpdate:modelValue"],Yo=["id","name","required","onUpdate:modelValue"],Zo={value:""},ea=["value"],ta={key:6,class:"checkbox-group"},sa=["id","name","value","onUpdate:modelValue"],na={class:"checkbox-label"},oa={key:7,class:"radio-group"},aa=["id","name","value","onUpdate:modelValue"],la={class:"radio-label"},ra=["id","name","placeholder","required","onUpdate:modelValue"],ia={key:1,class:"form-group"},ca={for:"form-input-genericInput"},da={type:"submit",class:"submit-user-input-btn"},ua=ye({__name:"UserInputForm",props:{userInputWaitState:{},planId:{},genericInput:{}},emits:["user-input-submitted"],setup(o,{emit:e}){const n=o,t=e;Ie();const a=Ye({}),l=F(n.genericInput??""),c=F(!1),d=F(null),h=()=>{const x=n.userInputWaitState?.formInputs;x&&x.length>0&&(!c.value||Object.keys(a).length!==x.length)&&(x.forEach((g,y)=>{(!(y in a)||g.type==="checkbox"&&!Array.isArray(a[y])||g.type!=="checkbox"&&a[y]==="")&&(g.type==="checkbox"?a[y]=[]:a[y]="")}),c.value=!0)};Te(()=>{h()}),ue(()=>n.userInputWaitState?.formInputs,()=>{d.value&&clearTimeout(d.value),d.value=setTimeout(()=>{c.value=!1,h()},100)},{deep:!0});const u=async()=>{try{const x={},j=n.userInputWaitState?.formInputs;j&&j.length>0?Object.entries(a).forEach(([g,y])=>{const _=parseInt(g,10),S=j[_].label||`input_${g}`;Array.isArray(y)?x[S]=y.join(", "):x[S]=y}):x.genericInput=l.value,console.log("[UserInputForm] Submitting user input:",x,"for planId:",n.planId),n.planId?(await Tt.submitFormInput(n.planId,x),console.log("[UserInputForm] User input submitted successfully")):console.error("[UserInputForm] No planId available for user input submission"),t("user-input-submitted",x)}catch(x){console.error("[UserInputForm] User input submission failed:",x)}},m=x=>x?Array.isArray(x)?x:typeof x=="string"?x.split(",").map(j=>j.trim()).filter(j=>j.length>0):[]:[],w=x=>typeof x=="boolean"?x:typeof x=="string"?x==="true":!1;return Re(()=>{d.value&&clearTimeout(d.value)}),(x,j)=>(p(),f("div",Bo,[s("div",qo,[k(r(T),{icon:"carbon:user",class:"user-icon"}),s("h4",Vo,i(x.$t("chat.userInputRequired")),1)]),s("p",jo,i(x.userInputWaitState?.title??x.$t("chat.userInput.message")),1),x.userInputWaitState?.formDescription?(p(),f("p",Go,i(x.userInputWaitState?.formDescription),1)):V("",!0),s("form",{onSubmit:be(u,["prevent"]),class:"user-input-form"},[x.userInputWaitState?.formInputs&&x.userInputWaitState.formInputs.length>0?(p(),f("div",Ho,[(p(!0),f(ie,null,pe(x.userInputWaitState?.formInputs,(g,y)=>(p(),f("div",{key:y,class:"form-group"},[s("label",{for:`form-input-${g.label.replace(/\W+/g,"_")}`},i(g.label)+i(w(g.required)?" *":"")+": ",9,zo),!g.type||g.type==="text"?de((p(),f("input",{key:0,type:"text",id:`form-input-${g.label.replace(/\W+/g,"_")}`,name:g.label,placeholder:g.placeholder||"",required:w(g.required),"onUpdate:modelValue":_=>a[y]=_,class:"form-input"},null,8,Jo)),[[ve,a[y]]]):g.type==="email"?de((p(),f("input",{key:1,type:"email",id:`form-input-${g.label.replace(/\W+/g,"_")}`,name:g.label,placeholder:g.placeholder||"",required:w(g.required),"onUpdate:modelValue":_=>a[y]=_,class:"form-input"},null,8,Wo)),[[ve,a[y]]]):g.type==="number"?de((p(),f("input",{key:2,type:"number",id:`form-input-${g.label.replace(/\W+/g,"_")}`,name:g.label,placeholder:g.placeholder||"",required:w(g.required),"onUpdate:modelValue":_=>a[y]=_,class:"form-input"},null,8,Ko)),[[ve,a[y]]]):g.type==="password"?de((p(),f("input",{key:3,type:"password",id:`form-input-${g.label.replace(/\W+/g,"_")}`,name:g.label,placeholder:g.placeholder||"",required:w(g.required),"onUpdate:modelValue":_=>a[y]=_,class:"form-input"},null,8,Xo)),[[ve,a[y]]]):g.type==="textarea"?de((p(),f("textarea",{key:4,id:`form-input-${g.label.replace(/\W+/g,"_")}`,name:g.label,placeholder:g.placeholder||"",required:w(g.required),"onUpdate:modelValue":_=>a[y]=_,class:"form-input form-textarea",rows:"4"},null,8,Qo)),[[ve,a[y]]]):g.type==="select"&&g.options?de((p(),f("select",{key:5,id:`form-input-${g.label.replace(/\W+/g,"_")}`,name:g.label,required:w(g.required),"onUpdate:modelValue":_=>a[y]=_,class:"form-input form-select"},[s("option",Zo,i(x.$t("selectCommon.pleaseSelect")),1),(p(!0),f(ie,null,pe(m(g.options),_=>(p(),f("option",{key:_,value:_},i(_),9,ea))),128))],8,Yo)),[[dt,a[y]]]):g.type==="checkbox"&&g.options?(p(),f("div",ta,[(p(!0),f(ie,null,pe(m(g.options),_=>(p(),f("label",{key:_,class:"checkbox-item"},[de(s("input",{type:"checkbox",id:`form-input-${g.label.replace(/\W+/g,"_")}-${_.replace(/\W+/g,"_")}`,name:g.label,value:_,"onUpdate:modelValue":v=>a[y]=v,class:"form-checkbox"},null,8,sa),[[St,a[y]]]),s("span",na,i(_),1)]))),128))])):g.type==="radio"&&g.options?(p(),f("div",oa,[(p(!0),f(ie,null,pe(m(g.options),_=>(p(),f("label",{key:_,class:"radio-item"},[de(s("input",{type:"radio",id:`form-input-${g.label.replace(/\W+/g,"_")}-${_.replace(/\W+/g,"_")}`,name:g.label,value:_,"onUpdate:modelValue":v=>a[y]=v,class:"form-radio"},null,8,aa),[[Ds,a[y]]]),s("span",la,i(_),1)]))),128))])):de((p(),f("input",{key:8,type:"text",id:`form-input-${g.label.replace(/\W+/g,"_")}`,name:g.label,placeholder:g.placeholder||"",required:w(g.required),"onUpdate:modelValue":_=>a[y]=_,class:"form-input"},null,8,ra)),[[ve,a[y]]])]))),128))])):(p(),f("div",ia,[s("label",ca,i(x.$t("common.input"))+":",1),de(s("input",{type:"text",id:"form-input-genericInput",name:"genericInput","onUpdate:modelValue":j[0]||(j[0]=g=>l.value=g),class:"form-input"},null,512),[[ve,l.value]])])),s("button",da,i(x.$t("chat.userInput.submit")),1)],32)]))}}),pa=_e(ua,[["__scopeId","data-v-e4d0802d"]]),ha={class:"response-section"},ma={class:"response-header"},fa={class:"response-avatar"},ga={class:"response-name"},va={key:0,class:"response-timestamp"},ba={class:"response-content"},ya={key:1,class:"final-response"},_a=["innerHTML"],Sa={class:"response-actions"},wa=["title"],$a=["title"],Pa={key:2,class:"response-placeholder"},ka={class:"typing-indicator"},Ea={class:"typing-text"},Ca={key:3,class:"response-error"},Ta={class:"error-text"},Ra={key:4,class:"response-empty"},Ia={class:"empty-text"},Aa=ye({__name:"ResponseSection",props:{content:{},isStreaming:{type:Boolean},error:{},timestamp:{},userInputWaitState:{},planId:{},genericInput:{}},emits:["copy","regenerate","retry","user-input-submitted"],setup(o,{emit:e}){const n=o,t=e,{formatResponseText:a,formatTimestamp:l}=Rt(),c=async()=>{if(n.content)try{const m=n.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(m),t("copy")}catch(m){console.error("Failed to copy to clipboard:",m)}},d=()=>{t("regenerate")},h=()=>{t("retry")},u=m=>{console.log("[ResponseSection] User input submitted:",m),t("user-input-submitted",m)};return(m,w)=>(p(),f("div",ha,[s("div",ma,[s("div",fa,[k(r(T),{icon:"carbon:bot",class:"bot-icon"})]),s("div",ga,i(m.$t("chat.botName")),1),m.timestamp?(p(),f("div",va,i(r(l)(m.timestamp)),1)):V("",!0)]),s("div",ba,[m.userInputWaitState?.waiting?(p(),he(pa,Zt({key:0,"user-input-wait-state":m.userInputWaitState},m.planId?{"plan-id":m.planId}:{},{"generic-input":m.genericInput??"",onUserInputSubmitted:u}),null,16,["user-input-wait-state","generic-input"])):V("",!0),m.content?(p(),f("div",ya,[s("div",{class:"response-text",innerHTML:r(a)(m.content)},null,8,_a),s("div",Sa,[s("button",{class:"action-btn copy-btn",onClick:c,title:m.$t("chat.copyResponse")},[k(r(T),{icon:"carbon:copy"})],8,wa),s("button",{class:"action-btn regenerate-btn",onClick:d,title:m.$t("chat.regenerateResponse")},[k(r(T),{icon:"carbon:renew"})],8,$a)])])):m.isStreaming?(p(),f("div",Pa,[s("div",ka,[w[0]||(w[0]=s("div",{class:"typing-dots"},[s("span"),s("span"),s("span")],-1)),s("span",Ea,i(m.$t("chat.thinkingResponse")),1)])])):m.error?(p(),f("div",Ca,[k(r(T),{icon:"carbon:warning",class:"error-icon"}),s("span",Ta,i(m.error),1),s("button",{class:"retry-btn",onClick:h},i(m.$t("chat.retry")),1)])):(p(),f("div",Ra,[s("span",Ia,i(m.$t("chat.waitingForResponse")),1)]))])]))}}),xa=_e(Aa,[["__scopeId","data-v-a03ac86f"]]),Ma={class:"assistant-message"},Fa=ye({__name:"AssistantMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(o,{emit:e}){const n=o,t=e,a=()=>{t("copy",n.message.id)},l=()=>{t("regenerate",n.message.id)},c=()=>{t("retry",n.message.id)},d=(u,m)=>{console.log("[AssistantMessage] User input submitted:",m,"for message:",u.id)},h=u=>{console.log("[AssistantMessage] Step selected:",u),t("step-selected",u)};return(u,m)=>(p(),f("div",Ma,[u.message.thinkingDetails?(p(),he(Lo,{key:0,"thinking-details":u.message.thinkingDetails,onStepSelected:h},null,8,["thinking-details"])):V("",!0),u.message.planExecution?(p(),he(ns,{key:1,"plan-execution":u.message.planExecution,"step-actions":u.message.stepActions||[],"generic-input":u.message.genericInput||"",onStepSelected:h},null,8,["plan-execution","step-actions","generic-input"])):V("",!0),u.message.content||u.message.error||u.isStreaming||u.message.planExecution?.userInputWaitState?.waiting?(p(),he(xa,Zt({key:2,content:u.message.content||"","is-streaming":u.isStreaming||!1},{...u.message.error?{error:u.message.error}:{},...u.message.planExecution?.userInputWaitState?{userInputWaitState:u.message.planExecution.userInputWaitState}:{},...u.message.planExecution?.currentPlanId?{planId:u.message.planExecution.currentPlanId}:{}},{timestamp:u.message.timestamp,"generic-input":u.message.genericInput||"",onCopy:a,onRegenerate:l,onRetry:c,onUserInputSubmitted:m[0]||(m[0]=w=>d(u.message,w))}),null,16,["content","is-streaming","timestamp","generic-input"])):V("",!0)]))}}),Da=_e(Fa,[["__scopeId","data-v-ab086f7d"]]),Na=ye({__name:"ChatMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(o,{emit:e}){const n=o,t=e,{getMessageClasses:a}=Rt(),l=me(()=>a(n.message)),c=m=>{t("copy",m)},d=m=>{t("regenerate",m)},h=m=>{t("retry",m)},u=m=>{t("step-selected",m)};return(m,w)=>(p(),f("div",{class:le(["chat-message",l.value])},[m.message.type==="user"?(p(),he(tn,{key:0,message:m.message},null,8,["message"])):m.message.type==="assistant"?(p(),he(Da,{key:1,message:m.message,"is-streaming":m.isStreaming||!1,onCopy:c,onRegenerate:d,onRetry:h,onStepSelected:u},null,8,["message","is-streaming"])):V("",!0)],2))}}),Ua=_e(Na,[["__scopeId","data-v-e91b5d83"]]);function wt(o){const e={...o};return"agentExecutionSequence"in o&&Array.isArray(o.agentExecutionSequence)&&(e.agentExecutionSequence=o.agentExecutionSequence.map(n=>Oa(n))),e}function Oa(o){const e={...o};return"subPlanExecutionRecords"in o&&Array.isArray(o.subPlanExecutionRecords)&&(e.subPlanExecutionRecords=o.subPlanExecutionRecords.map(n=>wt(n))),e}function La(o){const e={...o};return"thinkingDetails"in o&&o.thinkingDetails&&(e.thinkingDetails=wt(o.thinkingDetails)),"planExecution"in o&&o.planExecution&&(e.planExecution=wt(o.planExecution)),"attachments"in o&&Array.isArray(o.attachments)&&(e.attachments=[...o.attachments]),e}function Ba(){const o=F([]),e=F(!1),n=F(null),t=F(null),a=me(()=>o.value.length>0?o.value[o.value.length-1]:null),l=me(()=>n.value!==null),c=me(()=>o.value.length>0),d=(P,b,R)=>{const N={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:P,content:b,timestamp:new Date,isStreaming:!1,...R};return o.value.push(N),N},h=(P,b)=>{const R=o.value.findIndex(N=>N.id===P);R!==-1&&(o.value[R]={...o.value[R],...b})},u=P=>{const b=o.value.findIndex(R=>R.id===P);b!==-1&&o.value.splice(b,1)},m=()=>{o.value=[],n.value=null,t.value=null},w=P=>{n.value=P,h(P,{isStreaming:!0})},x=P=>{P&&h(P,{isStreaming:!1}),n.value===P&&(n.value=null)},j=P=>{t.value=P},g=(P,b,R="content")=>{const N=o.value.find(G=>G.id===P);N&&typeof N[R]=="string"&&h(P,{[R]:N[R]+b})},y=(P,b)=>{h(P,{thinkingDetails:b})},_=(P,b)=>{h(P,{thinking:b})},v=(P,b)=>{h(P,{planExecution:b})},S=P=>o.value.find(b=>b.id===P),A=P=>o.value.findIndex(b=>b.id===P);return{messages:Xe(o),isLoading:e,streamingMessageId:Xe(n),activeMessageId:Xe(t),lastMessage:a,isStreaming:l,hasMessages:c,addMessage:d,updateMessage:h,removeMessage:u,clearMessages:m,startStreaming:w,stopStreaming:x,setActiveMessage:j,appendToMessage:g,updateMessageThinking:_,updateMessageThinkingDetails:y,updateMessagePlanExecution:v,findMessage:S,getMessageIndex:A}}function qa(o){const e=F(!1),n=F(!0),t=150,a=async(_=!0)=>{o.value&&(await ke(),o.value.scrollTo({top:o.value.scrollHeight,behavior:_?"smooth":"auto"}))},l=()=>{if(!o.value)return!1;const{scrollTop:_,scrollHeight:v,clientHeight:S}=o.value;return v-_-S<t},c=()=>{if(!o.value)return;const _=l();e.value=!_&&o.value.scrollHeight>o.value.clientHeight,_&&(n.value=!0)},d=()=>{c(),l()||(n.value=!1)},h=async()=>{n.value&&await a()},u=async()=>{n.value=!0,await a()},m=(_,v=!0)=>{if(!o.value)return;const S=o.value.querySelector(`[data-message-id="${_}"]`);S&&S.scrollIntoView({behavior:v?"smooth":"auto",block:"center"})},w=()=>{if(!o.value)return{scrollTop:0,scrollHeight:0,clientHeight:0,isAtTop:!0,isAtBottom:!0,scrollPercentage:0};const{scrollTop:_,scrollHeight:v,clientHeight:S}=o.value,A=_===0,P=_+S>=v-5,b=v>S?_/(v-S)*100:100;return{scrollTop:_,scrollHeight:v,clientHeight:S,isAtTop:A,isAtBottom:P,scrollPercentage:b}},x=()=>{o.value&&o.value.addEventListener("scroll",d,{passive:!0})},j=()=>{o.value&&o.value.removeEventListener("scroll",d)},g=()=>{x(),c()},y=()=>{j()};return Te(()=>{ke(()=>{g()})}),Re(()=>{y()}),{showScrollToBottom:Xe(e),isAutoScrollEnabled:Xe(n),scrollToBottom:a,autoScrollToBottom:h,forceScrollToBottom:u,scrollToMessage:m,isNearBottom:l,checkScrollPosition:c,getScrollInfo:w,addScrollListener:x,removeScrollListener:j,initializeScrollBehavior:g,cleanupScrollBehavior:y}}class qe{static instance=null;POLL_INTERVAL=5e3;state=Ye({activePlanId:null,lastSequenceSize:0,isPolling:!1,pollTimer:null});callbacks={};planExecutionCache=new Map;uiStateCache=new Map;getCachedPlanRecord(e){return this.planExecutionCache.get(e)}getCachedUIState(e){return this.uiStateCache.get(e)}setCachedUIState(e,n){this.uiStateCache.set(e,n),console.log(`[PlanExecutionManager] Cached UI state for rootPlanId: ${e}`)}getAllCachedRecords(){return new Map(this.planExecutionCache)}hasCachedPlanRecord(e){return this.planExecutionCache.has(e)}setCachedPlanRecord(e,n){this.planExecutionCache.set(e,n),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${e}`)}clearCachedPlanRecord(e){const n=this.planExecutionCache.delete(e);return n&&console.log(`[PlanExecutionManager] Cleared cached plan execution record for rootPlanId: ${e}`),n}clearAllCachedRecords(){const e=this.planExecutionCache.size,n=this.uiStateCache.size;this.planExecutionCache.clear(),this.uiStateCache.clear(),console.log(`[PlanExecutionManager] Cleared all caches - Plans: ${e}, UI States: ${n}`)}constructor(){console.log("[PlanExecutionManager] Initialized with callback-based event system")}static getInstance(){return qe.instance||(qe.instance=new qe),qe.instance}getActivePlanId(){return this.state.activePlanId}getState(){return this.state}setEventCallbacks(e){this.callbacks={...this.callbacks,...e},console.log("[PlanExecutionManager] Event callbacks set:",Object.keys(e))}async handleUserMessageSendRequested(e){if(this.validateAndPrepareUIForNewRequest(e))try{if(await this.sendUserMessageAndSetPlanId(e),this.state.activePlanId)this.initiatePlanExecutionSequence(e,this.state.activePlanId);else throw new Error("Failed to get valid plan ID")}catch(n){console.error("[PlanExecutionManager] Failed to send user message:",n);const t=this.state.activePlanId??"error";this.setCachedUIState(t,{enabled:!0}),this.emitChatInputUpdateState(t),this.state.activePlanId=null}}handlePlanExecutionRequested(e,n){console.log("[PlanExecutionManager] Received plan execution request:",{planId:e,query:n}),e?(this.state.activePlanId=e,this.initiatePlanExecutionSequence(n??"Execute Plan",e)):console.error("[PlanExecutionManager] Invalid plan execution request: missing planId")}handleCachedPlanExecution(e,n){const t=this.getCachedPlanRecord(e);return t?.currentPlanId?(console.log(`[PlanExecutionManager] Found cached plan execution record for rootPlanId: ${e}`),this.handlePlanExecutionRequested(t.currentPlanId,n),!0):(console.log(`[PlanExecutionManager] No cached plan execution record found for rootPlanId: ${e}`),!1)}validateAndPrepareUIForNewRequest(e){if(!e)return console.warn("[PlanExecutionManager] Query is empty"),!1;if(this.state.activePlanId)return!1;this.emitChatInputClear();const n=this.state.activePlanId??"ui-state";return this.setCachedUIState(n,{enabled:!1,placeholder:"Processing..."}),this.emitChatInputUpdateState(n),!0}async sendUserMessageAndSetPlanId(e){try{const n=await qs.sendMessage({input:e});if(n?.planId)return this.state.activePlanId=n.planId,n;if(n?.planTemplateId)return this.state.activePlanId=n.planTemplateId,{...n,planId:n.planTemplateId};throw console.error("[PlanExecutionManager] Failed to get planId from response:",n),new Error("Failed to get valid planId from API response")}catch(n){throw console.error("[PlanExecutionManager] API call failed:",n),n}}initiatePlanExecutionSequence(e,n){console.log(`[PlanExecutionManager] Starting plan execution sequence for query: "${e}", planId: ${n}`);const t=n;Qe().setTaskRunning(n),console.log("[PlanExecutionManager] Task marked as running with planId:",n),this.emitDialogRoundStart(t),this.startPolling()}handlePlanCompletion(e){this.emitPlanCompleted(e.rootPlanId??""),this.state.lastSequenceSize=0,this.stopPolling();const n=Qe();n.currentTask&&n.currentTask.isRunning&&(n.currentTask.isRunning=!1,console.log("[PlanExecutionManager] Task marked as completed"));try{setTimeout(async()=>{if(this.state.activePlanId)try{await it.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(t){const a=t instanceof Error?t.message:"Unknown error";console.log(`Delete plan execution record failed: ${a}`)}},5e3)}catch(t){const a=t instanceof Error?t.message:"Unknown error";console.log(`Delete plan execution record failed: ${a}`)}e.completed&&(this.state.activePlanId=null,this.emitChatInputUpdateState(e.rootPlanId??""))}handlePlanError(e){this.emitPlanError(e.message??""),this.state.lastSequenceSize=0,this.stopPolling();const n=Qe();n.currentTask&&n.currentTask.isRunning&&(n.currentTask.isRunning=!1,console.log("[PlanExecutionManager] Task marked as stopped due to error"));try{setTimeout(async()=>{if(this.state.activePlanId)try{await it.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(t){const a=t instanceof Error?t.message:"Unknown error";console.log(`Delete plan execution record failed: ${a}`)}},5e3)}catch(t){const a=t instanceof Error?t.message:"Unknown error";console.log(`Delete plan execution record failed: ${a}`)}}async pollPlanStatus(){if(this.state.activePlanId){if(this.state.isPolling){console.log("[PlanExecutionManager] Previous polling still in progress, skipping");return}try{this.state.isPolling=!0;const e=await this.getPlanDetails(this.state.activePlanId);if(!e){console.warn("[PlanExecutionManager] No details received from API - this might be a temporary network issue");return}if(e.status&&e.status==="failed"&&e.message&&!e.message.includes("Failed to get detailed information")){this.handlePlanError(e);return}e.rootPlanId&&this.setCachedPlanRecord(e.rootPlanId,e),this.emitPlanUpdate(e.rootPlanId??""),e.completed&&this.handlePlanCompletion(e)}catch(e){console.error("[PlanExecutionManager] Failed to poll plan status:",e)}finally{this.state.isPolling=!1}}}async getPlanDetails(e){try{const n=await Tt.getDetails(e);return n?.rootPlanId&&(this.planExecutionCache.set(n.rootPlanId,n),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${n.rootPlanId}`)),n}catch(n){console.error("[PlanExecutionManager] Failed to get plan details:",n);const t=n instanceof Error?n.message:"Failed to get plan";return{currentPlanId:e,status:"failed",message:t}}}startPolling(){this.state.pollTimer&&clearInterval(this.state.pollTimer),this.state.pollTimer=window.setInterval(()=>{this.pollPlanStatus()},this.POLL_INTERVAL),console.log("[PlanExecutionManager] Started polling")}async pollPlanStatusImmediately(){console.log("[PlanExecutionManager] Polling plan status immediately"),await this.pollPlanStatus()}stopPolling(){this.state.pollTimer&&(clearInterval(this.state.pollTimer),this.state.pollTimer=null),console.log("[PlanExecutionManager] Stopped polling")}cleanup(){this.stopPolling(),this.state.activePlanId=null,this.state.lastSequenceSize=0,this.state.isPolling=!1,this.clearAllCachedRecords()}emitChatInputClear(){this.callbacks.onChatInputClear&&this.callbacks.onChatInputClear()}emitChatInputUpdateState(e){this.callbacks.onChatInputUpdateState&&this.callbacks.onChatInputUpdateState(e)}emitDialogRoundStart(e){this.callbacks.onDialogRoundStart&&this.callbacks.onDialogRoundStart(e)}emitPlanUpdate(e){this.callbacks.onPlanUpdate&&this.callbacks.onPlanUpdate(e)}emitPlanCompleted(e){this.callbacks.onPlanCompleted&&this.callbacks.onPlanCompleted(e)}emitPlanError(e){this.callbacks.onPlanError&&this.callbacks.onPlanError(e)}}const Fe=qe.getInstance(),Va={class:"chat-container"},ja={key:0,class:"loading-message"},Ga={class:"loading-content"},Ha=["title"],za=ye({__name:"ChatContainer",emits:["step-selected"],setup(o,{expose:e,emit:n}){const t=n,{t:a}=Ie(),{messages:l,isLoading:c,streamingMessageId:d,addMessage:h,updateMessage:u,startStreaming:m,stopStreaming:w,findMessage:x}=Ba(),j=F(null),{scrollToBottom:g,autoScrollToBottom:y,showScrollToBottom:_}=qa(j),v=F(),S=Q=>d.value===Q,A=me(()=>l.value.map(La)),P=()=>{},b=Q=>{const te=Q.target;if(te.classList.contains("md-copy-btn")){const se=te.getAttribute("data-raw");if(se){const ge=decodeURIComponent(se);navigator.clipboard.writeText(ge).then(()=>{te.textContent=a("chat.copied"),setTimeout(()=>{te.textContent=a("chat.copy")},1e3)})}}},R=async Q=>{const te=x(Q);if(te)try{const se=te.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(se)}catch(se){console.error("Failed to copy message:",se)}},N=Q=>{const te=x(Q);te&&te.type==="assistant"&&(u(Q,{content:""}),m(Q))},G=Q=>{x(Q)&&(u(Q,{content:""}),m(Q))},$=Q=>{console.log("[ChatContainer] Step selected:",Q),t("step-selected",Q)},U=Q=>{console.log("[ChatContainer] Plan update received:",Q);const te=Fe.getCachedPlanRecord(Q);if(!te){console.warn("[ChatContainer] No cached plan data found for rootPlanId:",Q);return}console.log("[ChatContainer] Retrieved plan details from cache:",te);const se=l.value.findIndex(ge=>ge.planExecution?.currentPlanId===te.currentPlanId&&ge.type==="assistant");if(se!==-1){const ge=l.value[se],fe={planExecution:JSON.parse(JSON.stringify(te))};if(!te.agentExecutionSequence||te.agentExecutionSequence.length===0){if(console.log("[ChatContainer] Handling simple response without agent execution sequence"),te.completed){fe.thinking="";const W=te.summary??te.result??te.message??"Execution completed";fe.content=W,console.log("[ChatContainer] Set simple response content:",W)}}else console.log("[ChatContainer] Handling detailed plan with agent execution sequence");u(ge.id,fe)}},B=Q=>{if(console.log("[ChatContainer] Plan completed:",Q),Q&&typeof Q=="object"&&"rootPlanId"in Q&&Q.rootPlanId){const te=Q,se=te.rootPlanId,ge=l.value.findIndex(fe=>fe.planExecution?.currentPlanId===se);if(ge!==-1){const fe=l.value[ge],W=te.summary??te.result??"Execution completed";u(fe.id,{thinking:"",content:W}),console.log("[ChatContainer] Updated completed message:",W)}}},Y=Q=>{console.log("[ChatContainer] Dialog round start:",Q)},ne=Q=>{console.log("[ChatContainer] Plan error:",Q),h("assistant",`Error: ${Q}`),console.error("[ChatContainer] Plan execution error:",Q)};return Te(()=>{ue(l,()=>{ke(()=>{y()})},{deep:!0}),Fe.setEventCallbacks({onPlanUpdate:U,onPlanCompleted:B,onDialogRoundStart:Y,onPlanError:ne})}),Re(()=>{v.value&&clearInterval(v.value)}),e({scrollToBottom:g,handlePlanUpdate:U,handlePlanCompleted:B,handleDialogRoundStart:Y,handlePlanError:ne,addMessage:h,updateMessage:u,startStreaming:m,stopStreaming:w}),(Q,te)=>(p(),f("div",Va,[s("div",{class:"messages",ref_key:"messagesRef",ref:j,onScroll:P,onClick:b},[(p(!0),f(ie,null,pe(A.value,se=>(p(),he(Ua,{key:se.id,message:se,"is-streaming":S(se.id),onCopy:R,onRegenerate:N,onRetry:G,onStepSelected:$},null,8,["message","is-streaming"]))),128)),r(c)?(p(),f("div",ja,[s("div",Ga,[k(r(T),{icon:"carbon:circle-dash",class:"loading-icon"}),s("span",null,i(Q.$t("chat.processing")),1)])])):V("",!0)],544),k(Ct,{name:"scroll-button"},{default:je(()=>[r(_)?(p(),f("button",{key:0,class:"scroll-to-bottom",onClick:te[0]||(te[0]=()=>r(g)()),title:Q.$t("chat.scrollToBottom")},[k(r(T),{icon:"carbon:chevron-down"})],8,Ha)):V("",!0)]),_:1})]))}}),Ja=_e(za,[["__scopeId","data-v-437333ba"]]);class Dt{static async uploadFiles(e){try{console.log("[FileUploadApiService] Uploading files:",e.length);const n=new FormData;e.forEach(l=>{n.append("files",l)});const t=await fetch("/api/file-upload/upload",{method:"POST",body:n});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();return console.log("[FileUploadApiService] Files uploaded successfully:",a.successfulFiles,"uploadKey:",a.uploadKey),a}catch(n){throw console.error("[FileUploadApiService] Error uploading files:",n),n}}static async getUploadedFiles(e){try{console.log("[FileUploadApiService] Getting uploaded files for uploadKey:",e);const n=await fetch(`/api/file-upload/files/${encodeURIComponent(e)}`);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const t=await n.json();return console.log("[FileUploadApiService] Got uploaded files:",t.totalCount,"for uploadKey:",e),t}catch(n){throw console.error("[FileUploadApiService] Error getting uploaded files:",n),n}}static async deleteFile(e,n){try{console.log("[FileUploadApiService] Deleting file:",n,"from uploadKey:",e);const t=await fetch(`/api/file-upload/files/${encodeURIComponent(e)}/${encodeURIComponent(n)}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();return console.log("[FileUploadApiService] File deleted successfully:",a.success),a}catch(t){throw console.error("[FileUploadApiService] Error deleting file:",t),t}}static async getUploadConfig(){try{console.log("[FileUploadApiService] Getting upload configuration");const e=await fetch("/api/file-upload/config");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const n=await e.json();return console.log("[FileUploadApiService] Got upload configuration:",n),n}catch(e){throw console.error("[FileUploadApiService] Error getting upload configuration:",e),e}}}const Wa={class:"file-upload-component"},Ka=["accept"],Xa={key:0},Qa={key:1},Ya={key:0,class:"files-list"},Za={class:"file-name"},el={class:"file-size"},tl=["onClick","title"],sl={key:0,class:"upload-progress"},nl=ye({__name:"FileUploadComponent",props:{acceptedFileTypes:{default:".pdf,.txt,.md,.doc,.docx,.csv,.xlsx,.xls,.json,.xml,.html,.htm,.log,.java,.py,.js,.ts,.sql,.sh,.bat,.yaml,.yml,.properties,.conf,.ini,.jpg,.jpeg,.png,.gif"},disabled:{type:Boolean,default:!1}},emits:["files-uploaded","files-removed","upload-key-changed","upload-started","upload-completed","upload-error"],setup(o,{expose:e,emit:n}){const{t}=Ie(),a=o,l=n,c=F(),d=F([]),h=F(!1),u=F(null),m=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),d.value=[],u.value=null,l("upload-key-changed",null)};Re(()=>{m()}),ue(()=>d.value,_=>{l("files-removed",_)},{deep:!0});const w=()=>{a.disabled||c.value&&c.value.click()},x=async _=>{const v=_.target,S=v.files;if(!S||S.length===0)return;const A=Array.from(S);console.log("[FileUpload] Selected files for upload:",A.map(P=>P.name)),await j(A),v.value=""},j=async _=>{if(_.length!==0){h.value=!0,l("upload-started");try{const v=await Dt.uploadFiles(_);v.success&&(!u.value&&v.uploadKey?(u.value=v.uploadKey,console.log("[FileUpload] Set uploadKey:",u.value),d.value=v.uploadedFiles):u.value?(console.log("[FileUpload] Using existing uploadKey:",u.value),d.value=[...d.value,...v.uploadedFiles]):(console.warn("[FileUpload] No uploadKey returned from upload"),d.value=v.uploadedFiles),v.uploadKey&&(u.value=v.uploadKey,console.log("[Input] Saved uploadKey locally:",v.uploadKey),l("upload-key-changed",u.value)),console.log("[Input] Updated global uploadedFiles state:",d.value),l("files-uploaded",d.value,u.value)),console.log("Files uploaded successfully:",v),l("upload-completed")}catch(v){console.error("File upload error:",v),l("upload-error",v)}finally{h.value=!1}}},g=async _=>{try{if(console.log("ðŸ—‘ï¸ Removing file:",_.originalName,"from uploadKey:",u),u.value){const v=await Dt.deleteFile(u.value,_.originalName);v.success?console.log("âœ… File deleted from server successfully"):console.error("âŒ Failed to delete file from server:",v.error)}d.value=d.value.filter(v=>v.originalName!==_.originalName),d.value.length===0&&(console.log("[FileUpload] ðŸ§¹ Clearing uploadKey to force new plan for new files"),u.value=null,l("upload-key-changed",null)),console.log("ðŸŽ‰ File removal completed, remaining files:",d.value.length)}catch(v){console.error("âŒ Error removing file:",v),l("upload-error",v)}},y=_=>{if(_===0)return"0 Bytes";const v=1024,S=["Bytes","KB","MB","GB"],A=Math.floor(Math.log(_)/Math.log(v));return parseFloat((_/Math.pow(v,A)).toFixed(2))+" "+S[A]};return e({uploadedFiles:d,uploadKey:u,resetSession:m,uploadFiles:j,removeFile:g,isUploading:h}),(_,v)=>(p(),f("div",Wa,[s("input",{ref_key:"fileInputRef",ref:c,type:"file",multiple:"",style:{display:"none"},onChange:x,accept:_.acceptedFileTypes||""},null,40,Ka),s("div",{class:le(["uploaded-files",{"has-files":d.value.length>0}])},[s("div",{class:"files-header",onClick:w},[k(r(T),{icon:"carbon:attachment"}),d.value.length===0?(p(),f("span",Xa,i(r(t)("input.attachFile")),1)):(p(),f("span",Qa,i(r(t)("input.attachedFiles"))+" ("+i(d.value.length)+")",1))]),d.value.length>0?(p(),f("div",Ya,[(p(!0),f(ie,null,pe(d.value,S=>(p(),f("div",{key:S.originalName,class:"file-item"},[k(r(T),{icon:"carbon:document",class:"file-icon"}),s("span",Za,i(S.originalName),1),s("span",el,"("+i(y(S.size))+")",1),s("button",{onClick:A=>g(S),class:"remove-btn",title:r(t)("input.removeFile")},[k(r(T),{icon:"carbon:close"})],8,tl)]))),128))])):V("",!0)],2),h.value?(p(),f("div",sl,[k(r(T),{icon:"carbon:rotate--clockwise",class:"loading-icon"}),s("span",null,i(r(t)("input.uploading")),1)])):V("",!0)]))}}),os=_e(nl,[["__scopeId","data-v-a97ebade"]]);class ol{isCollapsed=!1;selectMemoryId="";loadMessages=()=>{};intervalId=void 0;toggleSidebar(){this.isCollapsed=!this.isCollapsed,this.isCollapsed?(this.loadMessages(),this.intervalId=window.setInterval(()=>{this.loadMessages()},3e3)):clearInterval(this.intervalId)}selectMemory(e){this.toggleSidebar(),this.selectMemoryId=e}setMemory(e){this.selectMemoryId=e}defaultMemoryId(){this.selectMemoryId=this.generateRandomId()}clearMemoryId(){this.selectMemoryId=""}generateRandomId(){return Math.random().toString(36).substring(2,10)}setLoadMessages(e){this.loadMessages=e}}const Ne=Ye(new ol),al={class:"input-area"},ll={class:"input-container"},rl={class:"input-row-first"},il=["placeholder","disabled"],cl={class:"input-row-second"},dl=["title","disabled"],ul={value:""},pl=["value"],hl=["title"],ml=["disabled","title"],fl=["title"],gl=ye({__name:"InputArea",props:{placeholder:{default:""},disabled:{type:Boolean,default:!1},initialValue:{default:""},selectionOptions:{default:()=>[]}},emits:["send","clear","update-state","plan-mode-clicked","selection-changed"],setup(o,{expose:e,emit:n}){const{t}=Ie(),a=Qe(),l=me(()=>a.hasRunningTask()),c=o,d=n,h=F(),u=F(),m=F(""),w=me(()=>c.placeholder||t("input.placeholder")),x=F(w.value),j=F([]),g=F(null),y=F(""),_=F([]),v=F(!1),S=async()=>{v.value=!0;try{console.log("[InputArea] Loading inner tools...");const L=await Ae.getAllCoordinatorTools(),I=[];for(const D of L)if(D.enableInternalToolcall)try{const z=JSON.parse(D.inputSchema||"[]");if(Array.isArray(z)&&z.length===1){const Z=z[0];I.push({value:D.planTemplateId,label:`${D.toolName} (${Z.name})`,toolName:D.toolName,planTemplateId:D.planTemplateId,paramName:Z.name})}}catch(z){console.warn("[InputArea] Failed to parse inputSchema for tool:",D.toolName,z)}_.value=I,console.log("[InputArea] Loaded",I.length,"inner tools with single parameter");const O=localStorage.getItem("inputAreaSelectedTool");O&&(I.some(z=>z.value===O)?(y.value=O,console.log("[InputArea] Restored selected tool from localStorage:",O)):(console.log("[InputArea] Saved tool no longer available, clearing selection"),localStorage.removeItem("inputAreaSelectedTool"),y.value=""))}catch(L){console.error("[InputArea] Failed to load inner tools:",L),_.value=[]}finally{v.value=!1}},A=me(()=>_.value.length>0?_.value.map(L=>({value:L.value,label:L.label})):c.selectionOptions);ue(y,L=>{d("selection-changed",L),localStorage.setItem("inputAreaSelectedTool",L||"")}),Te(()=>{S()});const P=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),u.value?.resetSession()};Re(()=>{P()});const b=(L,I)=>{j.value=L.map(O=>O.originalName),g.value=I,console.log("[InputArea] Files uploaded:",L.length,"uploadKey:",I),j.value.length>0&&(x.value=t("input.filesAttached",{count:j.value.length}))},R=L=>{j.value=L.map(I=>I.originalName),console.log("[InputArea] Files removed, remaining:",L.length),j.value.length===0?x.value=w.value:x.value=t("input.filesAttached",{count:j.value.length})},N=L=>{g.value=L,console.log("[InputArea] Upload key changed:",L)},G=()=>{console.log("[InputArea] Upload started")},$=()=>{console.log("[InputArea] Upload completed")},U=L=>{console.error("[InputArea] Upload error:",L)},B=me(()=>!!c.disabled),Y=()=>{ke(()=>{h.value&&(h.value.style.height="auto",h.value.style.height=Math.min(h.value.scrollHeight,120)+"px")})},ne=L=>{L.key==="Enter"&&!L.shiftKey&&(L.preventDefault(),Q())},Q=async()=>{if(!m.value.trim()||B.value)return;const L=m.value.trim(),I={input:L,memoryId:Ne.selectMemoryId,uploadedFiles:j.value};if(g.value?(I.uploadKey=g.value,console.log("[InputArea] Including uploadKey in message:",g.value)):console.log("[InputArea] No uploadKey available for message"),y.value){const O=_.value.find(D=>D.value===y.value);if(O){const D=I;D.toolName=O.planTemplateId,D.replacementParams={[O.paramName]:L},console.log("[InputArea] Sending message with tool:",O.toolName)}}d("send",I),ge()},te=()=>{d("plan-mode-clicked")},se=async()=>{console.log("[InputArea] Stop button clicked"),await a.stopCurrentTask()?console.log("[InputArea] Task stopped successfully"):console.error("[InputArea] Failed to stop task")},ge=()=>{m.value="",Y(),d("clear")},fe=(L,I)=>{I&&(x.value=L?I:t("input.waiting")),d("update-state",L,I)},W=L=>{m.value=L,Y()},J=()=>m.value.trim();return ue(()=>c.initialValue,L=>{L.trim()&&(m.value=L,Y())},{immediate:!0}),e({clearInput:ge,updateState:fe,setInputValue:W,getQuery:J,resetSession:P,focus:()=>h.value?.focus(),get uploadedFiles(){return u.value?.uploadedFiles?.map(L=>L.originalName)||[]},get uploadKey(){return u.value?.uploadKey||null}}),Te(()=>{}),Re(()=>{}),(L,I)=>(p(),f("div",al,[k(os,{ref_key:"fileUploadRef",ref:u,disabled:B.value,onFilesUploaded:b,onFilesRemoved:R,onUploadKeyChanged:N,onUploadStarted:G,onUploadCompleted:$,onUploadError:U},null,8,["disabled"]),s("div",ll,[s("div",rl,[de(s("textarea",{"onUpdate:modelValue":I[0]||(I[0]=O=>m.value=O),ref_key:"inputRef",ref:h,class:"chat-input",placeholder:x.value,disabled:B.value,onKeydown:ne,onInput:Y},null,40,il),[[ve,m.value]])]),s("div",cl,[de(s("select",{"onUpdate:modelValue":I[1]||(I[1]=O=>y.value=O),class:"selection-input",title:L.$t("input.selectionTitle"),disabled:v.value||B.value},[s("option",ul,i(L.$t("input.defaultFuncAgent")),1),(p(!0),f(ie,null,pe(A.value,O=>(p(),f("option",{key:O.value,value:O.value},i(O.label),9,pl))),128))],8,dl),[[dt,y.value]]),s("button",{class:"plan-mode-btn",title:L.$t("input.planMode"),onClick:te},[k(r(T),{icon:"carbon:document"}),re(" "+i(L.$t("input.planMode")),1)],8,hl),l.value?(p(),f("button",{key:1,class:"send-button stop-button",onClick:se,title:L.$t("input.stop")},[k(r(T),{icon:"carbon:stop-filled"}),re(" "+i(L.$t("input.stop")),1)],8,fl)):(p(),f("button",{key:0,class:"send-button",disabled:!m.value.trim()||B.value,onClick:Q,title:L.$t("input.send")},[k(r(T),{icon:"carbon:send-alt"}),re(" "+i(L.$t("input.send")),1)],8,ml))])])]))}}),vl=_e(gl,[["__scopeId","data-v-b6815185"]]);class vt{static BASE_URL="/api/memories";static async handleResponse(e){if(!e.ok)try{const n=await e.json();throw new Error(n.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getMemories(){try{const e=await fetch(`${this.BASE_URL}`);return(await(await this.handleResponse(e)).json()).memories??[]}catch(e){throw console.error("Failed to get memory list:",e),e}}static async getMemory(e){try{const n=await fetch(`${this.BASE_URL}/single?conversationId=${e}`),a=await(await this.handleResponse(n)).json();if(!a.data)throw new Error("Memory not found");return a.data}catch(n){throw console.error("Failed to get memory:",n),n}}static async createMemory(e,n){try{const t=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,memory_name:n})}),l=await(await this.handleResponse(t)).json();if(!l.data)throw new Error("Failed to create memory");return l.data}catch(t){throw console.error("Failed to create memory:",t),t}}static async updateMemory(e,n){try{const t=await fetch(`${this.BASE_URL}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,memory_name:n})}),l=await(await this.handleResponse(t)).json();if(!l.data)throw new Error("Failed to update memory");return l.data}catch(t){throw console.error("Failed to update memory:",t),t}}static async deleteMemory(e){try{const n=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE"});await this.handleResponse(n)}catch(n){throw console.error("Failed to delete memory:",n),n}}static async generateConversationId(){try{const e=await fetch(`${this.BASE_URL}/generate-id`),t=await(await this.handleResponse(e)).json();if(!t.data)throw new Error("Failed to generate conversation ID");return t.data}catch(e){throw console.error("Failed to generate conversation ID:",e),e}}}const bl={key:0,class:"app-container"},yl={class:"app-content"},_l={class:"header"},Sl={class:"relative"},wl={class:"title-edit-group"},$l={id:"main-title",class:"main-title"},Pl={key:0,id:"title-edit-container",class:"title-edit-container"},kl={class:"search-bar"},El={class:"search-container"},Cl=["placeholder"],Tl={class:"message-list",id:"message-list"},Rl={class:"message-header"},Il={class:"message-content"},Al={class:"sender-info"},xl=["onClick"],Ml={class:"sender-name"},Fl=["onClick"],Dl={class:"action-buttons"},Nl=["onClick"],Ul={class:"action-buttons"},Ol=["onClick"],Ll={class:"message-preview"},Bl={class:"preview-line"},ql={key:0,class:"preview-line",style:{opacity:"0.8"}},Vl={class:"message-meta"},jl={class:"message-id"},Gl={class:"meta-right"},Hl={key:0,class:"unread-count"},zl={class:"message-time"},Jl=["id"],Wl={style:{display:"flex","flex-direction":"column",gap:"0.75rem"}},Kl={class:"bubble-avatar"},Xl={class:"bubble-content"},Ql={class:"bubble-text"},Yl={key:0,class:"empty-state"},Zl={class:"modal-content"},er={class:"modal-header"},tr={class:"modal-title"},sr=["placeholder"],nr={id:"name-char-count",class:"char-count",style:{"text-align":"right",display:"block","margin-top":"0.25rem"}},or={class:"modal-footer"},ar={class:"modal-content"},lr={class:"modal-header"},rr={class:"modal-title"},ir={class:"state-text",id:"delete-message"},cr={class:"modal-footer"},dr=ye({name:"MemoryPanel",__name:"Memory",emits:["memory-selected"],setup(o,{emit:e}){const n=F(!1),t=F(""),a=F([]),l=F([]),c=F(!1),d=F(null),h=F(""),u=F(!1),m=F(null),w=new Map,x=e,j=$=>{$.key==="Escape"&&(u.value?N():c.value&&A())};Te(()=>{Ne.setLoadMessages(g),document.addEventListener("keydown",j)}),Re(()=>{document.removeEventListener("keydown",j)});const g=async()=>{try{const $=await vt.getMemories();a.value=$.map(U=>({...U,expanded:w.has(U.conversation_id)?w.get(U.conversation_id):!1})),l.value=[...a.value],v()}catch($){console.error("error:",$),a.value=[],l.value=[]}},y=$=>{Ne.selectMemory($),x("memory-selected")},_=$=>{const U=typeof $=="string"?parseInt($,10):$;return isNaN(U)||U<=0?"unknow time":new Date(U.toString().length===13?U:U*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(","," ")},v=()=>{const $=t.value.toLowerCase().trim();if(!$){l.value=[...a.value];return}l.value=a.value.filter(U=>{const B=U.memory_name.toLowerCase().includes($),Y=U.conversation_id.toLowerCase().includes($),ne=U.messages?.some(Q=>Q.text.toLowerCase().includes($))??!1;return B||Y||ne})},S=($,U)=>{d.value=$,h.value=U,c.value=!0},A=()=>{c.value=!1,d.value=null},P=async()=>{if(!d.value)return;const $=h.value.trim()||"unknow name",U=a.value.findIndex(B=>B.conversation_id===d.value);if(U!==-1){const B=a.value[U];try{const Y=await vt.updateMemory(B.conversation_id,$);Y.messages||(Y.messages=[]),a.value[U]={...Y,expanded:B.expanded},v(),c.value=!1}catch(Y){console.error("error:",Y)}}},b=$=>{const U=a.value.find(B=>B.conversation_id===$);if(U){U.expanded=!U.expanded,w.set($,U.expanded);const B=l.value.findIndex(Y=>Y.conversation_id===$);B!==-1&&(l.value[B]={...U})}},R=$=>{m.value=$,u.value=!0},N=()=>{u.value=!1,m.value=null},G=async()=>{if(m.value)try{await vt.deleteMemory(m.value),a.value=a.value.filter($=>$.conversation_id!==m.value),v(),a.value.length===0&&Ne.clearMemoryId(),u.value=!1,m.value=null}catch($){console.error("error:",$)}};return($,U)=>(p(),he(Ns,{to:"body"},[k(Ct,{name:"modal"},{default:je(()=>[r(Ne).isCollapsed?(p(),f("div",bl,[s("div",yl,[s("div",_l,[s("div",Sl,[s("div",wl,[s("h1",$l,[s("span",null,i($.$t("memory.title")),1)])]),n.value?(p(),f("div",Pl)):V("",!0)]),s("button",{class:"close-btn",onClick:U[0]||(U[0]=B=>r(Ne).toggleSidebar())},[k(r(T),{icon:"carbon:close"})])]),s("div",kl,[s("div",El,[k(r(T),{class:"search-container-icon",icon:"carbon:search"}),de(s("input",{type:"text",placeholder:$.$t("memory.searchPlaceholder"),class:"search-input","onUpdate:modelValue":U[1]||(U[1]=B=>t.value=B),onInput:v},null,40,Cl),[[ve,t.value]])])]),s("div",Tl,[s("div",null,[(p(!0),f(ie,null,pe(l.value,B=>(p(),f("div",{class:le(["message-item",{expanded:B.expanded}]),key:B.conversation_id},[s("div",Rl,[s("div",Il,[s("div",Al,[s("div",{class:"sender-div",onClick:be(Y=>y(B.conversation_id),["stop"])},[s("h3",Ml,i(B.memory_name),1)],8,xl),s("div",{class:"toggle-container",onClick:be(Y=>S(B.conversation_id,B.memory_name),["stop"])},[k(r(T),{icon:"carbon:edit",class:"edit-btn"})],8,Fl),s("div",Dl,[s("button",{class:"delete-btn",onClick:be(Y=>b(B.conversation_id),["stop"])},[k(r(T),{id:"toggle-"+B.conversation_id,icon:"carbon:chevron-down",class:"down-btn"},null,8,["id"])],8,Nl)]),s("div",Ul,[s("button",{class:"delete-btn",onClick:be(Y=>R(B.conversation_id),["stop"])},[k(r(T),{icon:"carbon:delete"})],8,Ol)])]),s("div",Ll,[s("p",Bl,i(B.messages&&B.messages.length>0?B.messages[0].text:"none message"),1),B.messages&&B.messages.length>1?(p(),f("p",ql,i(B.messages[1].text),1)):V("",!0)]),s("div",Vl,[s("span",jl,"ID: "+i(B.conversation_id),1),s("div",Gl,[B.messages&&B.messages.length>0?(p(),f("span",Hl,i(B.messages.length)+" "+i($.$t("memory.size")),1)):V("",!0),s("span",zl,i(_(B.create_time)),1)])])])]),B.expanded?(p(),f("div",{key:0,id:"content-"+B.conversation_id,class:"expanded-content"},[s("div",Wl,[(p(!0),f(ie,null,pe(B.messages,(Y,ne)=>(p(),f("div",{class:"message-bubble",key:ne},[s("div",Kl,i(Y.messageType),1),s("div",Xl,[s("p",Ql,i(Y.text),1)])]))),128))])],8,Jl)):V("",!0)],2))),128))]),l.value.length===0&&t.value?(p(),f("div",Yl,U[3]||(U[3]=[s("p",{class:"state-text"},"none message",-1)]))):V("",!0)]),c.value?(p(),f("div",{key:0,id:"name-edit-modal",class:"modal-overlay",onClick:be(A,["self"])},[s("div",Zl,[s("div",er,[s("h3",tr,i($.$t("memory.changeName")),1),de(s("input",{type:"text","onUpdate:modelValue":U[2]||(U[2]=B=>h.value=B),class:"edit-input",placeholder:$.$t("memory.newNamePlaceholder")},null,8,sr),[[ve,h.value]]),s("span",nr,i(h.value.length),1)]),s("div",or,[s("button",{id:"cancel-name",class:"modal-btn cancel-btn",onClick:A},i($.$t("memory.cancel")),1),s("button",{id:"save-name",class:"modal-btn confirm-btn",onClick:P},i($.$t("memory.save")),1)])])])):V("",!0),u.value?(p(),f("div",{key:1,id:"delete-modal",class:"modal-overlay",onClick:be(N,["self"])},[s("div",ar,[s("div",lr,[s("h3",rr,i($.$t("memory.deleteHint")),1),s("p",ir,i($.$t("memory.deleteHintPrefix"))+" "+i(m.value)+" "+i($.$t("memory.deleteHintSuffix")),1)]),s("div",cr,[s("button",{id:"cancel-delete",class:"modal-btn cancel-btn",onClick:N},i($.$t("memory.cancel")),1),s("button",{id:"confirm-delete",class:"modal-btn delete-btn-confirm",onClick:G},i($.$t("memory.delete")),1)])])])):V("",!0)])])):V("",!0)]),_:1})]))}}),ur=_e(dr,[["__scopeId","data-v-ce3a5dcf"]]),pr="/api/executor";async function as(o){try{const e=await fetch(`${pr}/agent-execution/${o}`);if(!e.ok){if(e.status===404)return console.warn(`Agent execution detail not found for stepId: ${o}`),null;throw new Error(`HTTP error! status: ${e.status}`)}return await e.json()}catch(e){return console.error(`Error fetching agent execution detail for stepId: ${o}:`,e),null}}async function hr(o){return console.log(`Refreshing agent execution detail for stepId: ${o}`),as(o)}class Be{static BASE_URL="/api/file-browser";static async handleResponse(e){if(!e.ok)try{const n=await e.json();throw new Error(n.message??`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getFileTree(e){try{const n=await fetch(`${this.BASE_URL}/tree/${e}`),a=await(await this.handleResponse(n)).json();if(!a.success)throw new Error(a.message??"Failed to get file tree");return a.data}catch(n){throw console.error("Failed to get file tree:",n),n}}static async getFileContent(e,n){try{const t=await fetch(`${this.BASE_URL}/content/${e}?path=${encodeURIComponent(n)}`),l=await(await this.handleResponse(t)).json();if(!l.success)throw new Error(l.message??"Failed to get file content");return l.data}catch(t){throw console.error("Failed to get file content:",t),t}}static async downloadFile(e,n,t){try{const a=await fetch(`${this.BASE_URL}/download/${e}?path=${encodeURIComponent(n)}`);await this.handleResponse(a);const l=await a.blob(),c=window.URL.createObjectURL(l),d=document.createElement("a");d.href=c,d.download=t??n.split("/").pop()??"download",document.body.appendChild(d),d.click(),window.URL.revokeObjectURL(c),document.body.removeChild(d)}catch(a){throw console.error("Failed to download file:",a),a}}static isTextFile(e,n){const t=["text/","application/json","application/xml","application/javascript","application/typescript"],a=[".txt",".md",".json",".xml",".html",".css",".js",".ts",".vue",".jsx",".tsx",".py",".java",".cpp",".c",".h",".sh",".bat",".yml",".yaml",".properties",".conf",".cfg"];if(t.some(c=>e.startsWith(c)))return!0;const l=n.toLowerCase();return a.some(c=>l.endsWith(c))}static getFileIcon(e){if(e.type==="directory")return"carbon:folder";const n=e.name.toLowerCase();return n.endsWith(".js")?"vscode-icons:file-type-js":n.endsWith(".ts")?"vscode-icons:file-type-typescript":n.endsWith(".vue")?"vscode-icons:file-type-vue":n.endsWith(".java")?"vscode-icons:file-type-java":n.endsWith(".py")?"vscode-icons:file-type-python":n.endsWith(".json")?"vscode-icons:file-type-json":n.endsWith(".xml")?"vscode-icons:file-type-xml":n.endsWith(".html")?"vscode-icons:file-type-html":n.endsWith(".css")?"vscode-icons:file-type-css":n.endsWith(".md")?"vscode-icons:file-type-markdown":n.endsWith(".yml")||n.endsWith(".yaml")?"vscode-icons:file-type-yaml":n.endsWith(".pdf")?"vscode-icons:file-type-pdf2":n.endsWith(".doc")||n.endsWith(".docx")?"vscode-icons:file-type-word":n.endsWith(".xls")||n.endsWith(".xlsx")?"vscode-icons:file-type-excel":n.endsWith(".ppt")||n.endsWith(".pptx")?"vscode-icons:file-type-powerpoint":n.match(/\.(jpg|jpeg|png|gif|bmp|svg)$/)?"carbon:image":n.match(/\.(zip|rar|7z|tar|gz)$/)?"carbon:archive":"carbon:document"}}const mr={class:"file-tree-node"},fr={class:"node-icon"},gr={class:"node-name"},vr={key:1,class:"file-size"},br={key:2,class:"node-actions"},yr={key:0,class:"children"},_r=ye({__name:"FileTreeNode",props:{node:{},level:{}},emits:["file-selected","download-file"],setup(o,{emit:e}){const n=o,t=e,a=F(n.level===0),l=F(!1),c=F(!1),d=F({}),h=()=>{n.node.type==="directory"&&(a.value=!a.value)},u=()=>{n.node.type==="directory"?h():m()},m=()=>{n.node.type==="file"&&t("file-selected",n.node),j()},w=()=>{t("download-file",n.node),j()},x=v=>{v.preventDefault(),c.value=!0,d.value={position:"fixed",top:`${v.clientY}px`,left:`${v.clientX}px`,zIndex:1e3},setTimeout(()=>{document.addEventListener("click",j)},0)},j=()=>{c.value=!1,document.removeEventListener("click",j)},g=async()=>{try{await navigator.clipboard.writeText(n.node.path)}catch(v){console.error("Failed to copy path:",v)}j()},y=()=>n.node.type==="directory"?a.value?"carbon:folder-open":"carbon:folder":Be.getFileIcon(n.node),_=v=>{if(v===0)return"0 B";const S=1024,A=["B","KB","MB","GB"],P=Math.floor(Math.log(v)/Math.log(S));return parseFloat((v/Math.pow(S,P)).toFixed(1))+" "+A[P]};return Re(()=>{document.removeEventListener("click",j)}),(v,S)=>{const A=Yt("FileTreeNode",!0);return p(),f("div",mr,[s("div",{class:le(["node-content",{"is-directory":v.node.type==="directory","is-file":v.node.type==="file","is-expanded":a.value}]),style:Ve({paddingLeft:`${v.level*16+12}px`}),onClick:u,onContextmenu:be(x,["prevent"])},[v.node.type==="directory"?(p(),f("div",{key:0,class:"expand-icon",onClick:be(h,["stop"])},[k(r(T),{icon:a.value?"carbon:chevron-down":"carbon:chevron-right",class:"chevron-icon"},null,8,["icon"])])):V("",!0),s("div",fr,[k(r(T),{icon:y()},null,8,["icon"])]),s("span",gr,i(v.node.name),1),v.node.type==="file"?(p(),f("span",vr,i(_(v.node.size)),1)):V("",!0),l.value?(p(),f("div",br,[v.node.type==="file"?(p(),f("button",{key:0,onClick:S[0]||(S[0]=be(P=>v.$emit("download-file",v.node),["stop"])),class:"action-btn download-btn",title:"Download"},[k(r(T),{icon:"carbon:download"})])):V("",!0)])):V("",!0)],38),v.node.type==="directory"&&a.value&&v.node.children?(p(),f("div",yr,[(p(!0),f(ie,null,pe(v.node.children,P=>(p(),he(A,{key:P.path,node:P,level:v.level+1,onFileSelected:S[1]||(S[1]=b=>v.$emit("file-selected",b)),onDownloadFile:S[2]||(S[2]=b=>v.$emit("download-file",b))},null,8,["node","level"]))),128))])):V("",!0),c.value?(p(),f("div",{key:1,class:"context-menu",style:Ve(d.value),onClick:S[3]||(S[3]=be(()=>{},["stop"]))},[s("div",{class:"context-menu-item",onClick:m},[k(r(T),{icon:"carbon:view"}),S[4]||(S[4]=s("span",null,"Open",-1))]),v.node.type==="file"?(p(),f("div",{key:0,class:"context-menu-item",onClick:w},[k(r(T),{icon:"carbon:download"}),S[5]||(S[5]=s("span",null,"Download",-1))])):V("",!0),S[7]||(S[7]=s("div",{class:"context-menu-divider"},null,-1)),s("div",{class:"context-menu-item",onClick:g},[k(r(T),{icon:"carbon:copy"}),S[6]||(S[6]=s("span",null,"Copy Path",-1))])],4)):V("",!0)])}}}),Sr=_e(_r,[["__scopeId","data-v-3fc455d1"]]),wr={class:"file-browser"},$r={class:"file-browser-header"},Pr={class:"header-actions"},kr=["disabled","title"],Er={class:"file-browser-content"},Cr={class:"file-tree-panel"},Tr={key:0,class:"loading-state"},Rr={key:1,class:"error-state"},Ir={key:0,class:"waiting-for-files"},Ar={class:"message-content"},xr={class:"tips"},Mr=["disabled"],Fr={key:1,class:"actual-error"},Dr={key:2,class:"empty-state"},Nr={key:3,class:"file-tree"},Ur={key:0,class:"file-content-panel"},Or={class:"file-content-header"},Lr={class:"file-info"},Br={class:"file-name"},qr={class:"file-size"},Vr={class:"file-actions"},jr=["title"],Gr=["title"],Hr={class:"file-content-body"},zr={key:0,class:"loading-content"},Jr={key:1,class:"content-error"},Wr={key:2,class:"file-content"},Kr={key:0,class:"text-content"},Xr={key:1,class:"binary-content"},Qr=ye({name:"FileBrowser",__name:"index",props:{planId:{}},setup(o){const e=o,{t:n}=Ie(),t=F(!1),a=F(null),l=F(null),c=F(null),d=F(null),h=F(!1),u=F(null),m=F(null),w=me(()=>!d.value||!c.value?!1:Be.isTextFile(d.value.mimeType,c.value.name)),x=me(()=>a.value&&(a.value.includes("Plan directory not found")||a.value.includes("not found"))),j=()=>{m.value&&(clearTimeout(m.value),m.value=null)},g=()=>{j(),m.value=window.setTimeout(()=>{x.value&&y()},5e3)},y=async()=>{if(e.planId){t.value=!0,a.value=null,j();try{l.value=await Be.getFileTree(e.planId)}catch(b){a.value=b instanceof Error?b.message:n("fileBrowser.loadError"),console.error("Failed to load file tree:",b);const R=b instanceof Error?b.message:"";(R.includes("Plan directory not found")||R.includes("not found"))&&g()}finally{t.value=!1}}},_=async b=>{if(b.type!=="directory"){c.value=b,d.value=null,h.value=!0,u.value=null;try{d.value=await Be.getFileContent(e.planId,b.path)}catch(R){u.value=R instanceof Error?R.message:n("fileBrowser.contentLoadError"),console.error("Failed to load file content:",R)}finally{h.value=!1}}},v=async b=>{try{await Be.downloadFile(e.planId,b.path,b.name)}catch(R){console.error("Failed to download file:",R)}},S=()=>{c.value=null,d.value=null,u.value=null},A=b=>Be.getFileIcon(b),P=b=>{if(b===0)return"0 B";const R=1024,N=["B","KB","MB","GB"],G=Math.floor(Math.log(b)/Math.log(R));return parseFloat((b/Math.pow(R,G)).toFixed(1))+" "+N[G]};return ue(()=>e.planId,b=>{b&&(c.value=null,d.value=null,y())},{immediate:!0}),Te(()=>{e.planId&&y()}),Re(()=>{j()}),(b,R)=>(p(),f("div",wr,[s("div",$r,[s("h3",null,i(b.$t("fileBrowser.title")),1),s("div",Pr,[s("button",{class:"refresh-btn",onClick:y,disabled:t.value,title:b.$t("fileBrowser.refresh")},[k(r(T),{icon:"carbon:refresh",class:le({rotating:t.value}),style:{color:"#ffffff",fontSize:"18px",width:"18px",height:"18px"}},null,8,["class"])],8,kr)])]),s("div",Er,[s("div",Cr,[t.value?(p(),f("div",Tr,[k(r(T),{icon:"carbon:loading",class:"rotating"}),s("span",null,i(b.$t("fileBrowser.loading")),1)])):a.value?(p(),f("div",Rr,[x.value?(p(),f("div",Ir,[k(r(T),{icon:"carbon:time",class:"rotating"}),s("div",Ar,[s("h3",null,i(b.$t("fileBrowser.waitingForGeneration")),1),s("p",null,i(b.$t("fileBrowser.planExecuting")),1),s("div",xr,[k(r(T),{icon:"carbon:information"}),s("span",null,i(b.$t("fileBrowser.filesTip")),1)])]),s("button",{onClick:y,class:"retry-btn",disabled:t.value},[k(r(T),{icon:"carbon:refresh",class:le({rotating:t.value})},null,8,["class"]),re(" "+i(t.value?b.$t("fileBrowser.checking"):b.$t("fileBrowser.checkNow")),1)],8,Mr)])):(p(),f("div",Fr,[k(r(T),{icon:"carbon:warning"}),s("span",null,i(a.value),1),s("button",{onClick:y,class:"retry-btn"},i(b.$t("fileBrowser.retry")),1)]))])):l.value?(p(),f("div",Nr,[k(Sr,{node:l.value,level:0,onFileSelected:_,onDownloadFile:v},null,8,["node"])])):(p(),f("div",Dr,[k(r(T),{icon:"carbon:folder-off"}),s("span",null,i(b.$t("fileBrowser.noFiles")),1)]))]),c.value?(p(),f("div",Ur,[s("div",Or,[s("div",Lr,[k(r(T),{icon:A(c.value)},null,8,["icon"]),s("span",Br,i(c.value.name),1),s("span",qr,"("+i(P(c.value.size))+")",1)]),s("div",Vr,[s("button",{onClick:R[0]||(R[0]=N=>v(c.value)),class:"download-btn",title:b.$t("fileBrowser.download")},[k(r(T),{icon:"carbon:download"})],8,jr),s("button",{onClick:S,class:"close-btn",title:b.$t("common.close")},[k(r(T),{icon:"carbon:close"})],8,Gr)])]),s("div",Hr,[h.value?(p(),f("div",zr,[k(r(T),{icon:"carbon:loading",class:"rotating"}),s("span",null,i(b.$t("fileBrowser.loadingContent")),1)])):u.value?(p(),f("div",Jr,[k(r(T),{icon:"carbon:warning"}),s("span",null,i(u.value),1)])):d.value?(p(),f("div",Wr,[w.value?(p(),f("div",Kr,[s("pre",null,[s("code",null,i(d.value.content),1)])])):(p(),f("div",Xr,[k(r(T),{icon:"carbon:document-unknown"}),s("p",null,i(b.$t("fileBrowser.binaryFile")),1),s("button",{onClick:R[1]||(R[1]=N=>v(c.value)),class:"download-btn-large"},[k(r(T),{icon:"carbon:download"}),re(" "+i(b.$t("fileBrowser.downloadToView")),1)])]))])):V("",!0)])])):V("",!0)])]))}}),Yr=_e(Qr,[["__scopeId","data-v-a19b1e5b"]]),Zr={class:"right-panel"},ei={class:"preview-header"},ti={class:"preview-tabs"},si={class:"preview-content"},ni={key:0,class:"step-details"},oi={key:0,class:"step-info"},ai={key:0,class:"agent-info"},li={class:"info-item"},ri={class:"label"},ii={class:"value"},ci={class:"info-item"},di={class:"label"},ui={class:"value"},pi={class:"info-item"},hi={class:"label"},mi={class:"execution-status"},fi={class:"status-item"},gi={class:"status-text"},vi={key:0},bi={key:0,class:"think-act-steps"},yi={class:"steps-container"},_i={class:"step-header"},Si={class:"step-number"},wi={class:"think-section"},$i={class:"think-content"},Pi={class:"input"},ki={class:"label"},Ei={class:"output"},Ci={class:"label"},Ti={key:0,class:"action-section"},Ri={class:"action-content"},Ii={class:"tool-info"},Ai={class:"label"},xi={class:"value"},Mi={class:"input"},Fi={class:"label"},Di={class:"output"},Ni={class:"label"},Ui={key:0,class:"sub-plan-section"},Oi={class:"sub-plan-content"},Li={class:"sub-plan-header"},Bi={class:"sub-plan-info"},qi={class:"label"},Vi={class:"value"},ji={key:0,class:"sub-plan-info"},Gi={class:"label"},Hi={class:"value"},zi={class:"sub-plan-status"},Ji={class:"status-text"},Wi={key:0,class:"no-steps-message"},Ki={key:1,class:"no-execution-message"},Xi={class:"step-basic-info"},Qi={class:"info-item"},Yi={class:"label"},Zi={class:"value"},ec={key:0,class:"info-item"},tc={class:"label"},sc={class:"value"},nc={class:"info-item"},oc={class:"label"},ac={class:"no-execution-hint"},lc={key:2,class:"execution-indicator"},rc={class:"execution-text"},ic={key:1,class:"no-selection"},cc=["title"],dc={key:1,class:"file-browser-container"},uc={key:1,class:"no-plan-message"},pc={class:"message-content"},hc={class:"tips"},mc=ye({__name:"RightPanel",props:{currentRootPlanId:{},selectedStepId:{}},setup(o,{expose:e}){const n=o,{t}=Ie(),a=F(),l=F(),c=F("details"),d=F(localStorage.getItem("jmanus-last-plan-id")),h=F(localStorage.getItem("jmanus-has-executed-plan")==="true"),u=F(!1),m=F(!0),w=F(!0),x=me(()=>l.value?l.value.completed?t("rightPanel.status.completed"):l.value.current?t("rightPanel.status.executing"):t("rightPanel.status.waiting"):""),j=me(()=>n.currentRootPlanId?n.currentRootPlanId:d.value),g=me(()=>!j.value&&!h.value),y=async $=>{if(console.log("[RightPanel] Step selected:",{stepId:$}),!$){console.warn("[RightPanel] No stepId provided"),l.value=null;return}try{const U=await as($);if(!U){console.warn("[RightPanel] Agent execution detail not found for stepId:",$),l.value=null;return}const B={stepId:$,title:U.agentName??`Step ${$}`,description:U.agentDescription??"",agentExecution:U,completed:U.status==="FINISHED",current:U.status==="RUNNING"};l.value=B,console.log("[RightPanel] Step details updated:",B),console.log("[RightPanel] activeTab:",c.value),console.log("[RightPanel] selectedStep.value:",l.value),console.log("[RightPanel] agentExecution:",l.value.agentExecution),console.log("[RightPanel] thinkActSteps:",l.value.agentExecution?.thinkActSteps),console.log("[RightPanel] thinkActSteps length:",l.value.agentExecution?.thinkActSteps?.length),await ke(),console.log("[RightPanel] After nextTick - selectedStep:",l.value),setTimeout(()=>{S()},100),P()}catch(U){console.error("[RightPanel] Error fetching step details:",U),l.value=null}},_=async()=>{if(!l.value?.stepId){console.warn("[RightPanel] No step selected for refresh");return}console.log("[RightPanel] Refreshing current step:",l.value.stepId);try{const $=await hr(l.value.stepId);$&&(l.value.agentExecution=$,l.value.completed=$.status==="FINISHED",l.value.current=$.status==="RUNNING",console.log("[RightPanel] Step refreshed successfully"),P())}catch($){console.error("[RightPanel] Error refreshing step:",$)}};ue(()=>n.selectedStepId,async $=>{$?await y($):l.value=null},{immediate:!0});const v=$=>{a.value=$??void 0},S=()=>{if(!a.value)return;const{scrollTop:$,scrollHeight:U,clientHeight:B}=a.value,Y=U-$-B<50,ne=U>B;m.value=Y,u.value=ne&&!Y,Y?w.value=!0:U-$-B>100&&(w.value=!1),console.log("[RightPanel] Scroll state check:",{scrollTop:$,scrollHeight:U,clientHeight:B,isAtBottom:Y,hasScrollableContent:ne,showButton:u.value,shouldAutoScroll:w.value})},A=()=>{a.value&&(a.value.scrollTo({top:a.value.scrollHeight,behavior:"smooth"}),ke(()=>{w.value=!0,S()}))},P=()=>{!w.value||!a.value||ke(()=>{a.value&&(a.value.scrollTop=a.value.scrollHeight,console.log("[RightPanel] Auto scroll to bottom"))})},b=$=>{if($===null||typeof $>"u"||$==="")return"N/A";try{const U=typeof $=="object"?$:JSON.parse($);return JSON.stringify(U,null,2)}catch{return String($)}},R=()=>{l.value=null,w.value=!0,a.value&&a.value.removeEventListener("scroll",S)},N=()=>{const $=()=>{const U=a.value;return U?(v(U),U.addEventListener("scroll",S),w.value=!0,S(),console.log("[RightPanel] Scroll listener initialized successfully"),!0):(console.log("[RightPanel] Scroll container not found, retrying..."),!1)};ke(()=>{$()||setTimeout(()=>{$()},100)})};return ue(()=>n.currentRootPlanId,($,U)=>{$&&$!==U?(d.value=$,h.value=!0,localStorage.setItem("jmanus-last-plan-id",$),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] New plan started:",$)):!$&&U&&console.log("[RightPanel] Plan execution finished, keeping last plan:",d.value)},{immediate:!0}),Te(()=>{console.log("[RightPanel] Component mounted"),ke(()=>{N()})}),Re(()=>{console.log("[RightPanel] Component unmounting, cleaning up..."),R()}),e({handleStepSelected:y,refreshCurrentStep:_,updateDisplayedPlanProgress:$=>{console.log("[RightPanel] updateDisplayedPlanProgress called with rootPlanId:",$),$&&(d.value=$,h.value=!0,localStorage.setItem("jmanus-last-plan-id",$),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] Plan progress updated:",$))}}),($,U)=>(p(),f("div",Zr,[s("div",ei,[s("div",ti,[s("div",{class:le(["tab-item",{active:c.value==="details"}]),onClick:U[0]||(U[0]=B=>c.value="details")},[k(r(T),{icon:"carbon:events"}),s("span",null,i(r(t)("rightPanel.stepExecutionDetails")),1)],2),s("div",{class:le(["tab-item",{active:c.value==="files"}]),onClick:U[1]||(U[1]=B=>c.value="files")},[k(r(T),{icon:"carbon:folder"}),s("span",null,i(r(t)("fileBrowser.title")),1)],2)])]),s("div",si,[c.value==="details"?(p(),f("div",ni,[l.value?(p(),f("div",oi,[s("h3",null,i(l.value.title||l.value.description||r(t)("rightPanel.defaultStepTitle",{number:1})),1),l.value.agentExecution?(p(),f("div",ai,[s("div",li,[s("span",ri,i(r(t)("rightPanel.executingAgent"))+":",1),s("span",ii,i(l.value.agentExecution.agentName),1)]),s("div",ci,[s("span",di,i(r(t)("rightPanel.callingModel"))+":",1),s("span",ui,i(l.value.agentExecution.modelName),1)]),s("div",pi,[s("span",hi,i(r(t)("rightPanel.executionResult"))+":",1),s("span",{class:le(["value",{success:l.value.agentExecution.status==="FINISHED"}])},i(l.value.agentExecution.status||r(t)("rightPanel.executing")),3)])])):V("",!0),s("div",mi,[s("div",fi,[l.value.completed?(p(),he(r(T),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):l.value.current?(p(),he(r(T),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})):(p(),he(r(T),{key:2,icon:"carbon:time",class:"status-icon pending"})),s("span",gi,i(x.value),1)])])])):V("",!0),s("div",{ref_key:"scrollContainer",ref:a,class:"step-details-scroll-container",onScroll:S},[l.value?(p(),f("div",vi,[l.value.agentExecution?.thinkActSteps&&l.value.agentExecution.thinkActSteps.length>0?(p(),f("div",bi,[s("h4",null,i(r(t)("rightPanel.thinkAndActionSteps")),1),s("div",yi,[(p(!0),f(ie,null,pe(l.value.agentExecution.thinkActSteps,(B,Y)=>(p(),f("div",{key:Y,class:"think-act-step"},[s("div",_i,[s("span",Si,"#"+i(Y+1),1),s("span",{class:le(["step-status",B.status])},i(B.status||r(t)("rightPanel.executing")),3)]),s("div",wi,[s("h5",null,[k(r(T),{icon:"carbon:thinking"}),re(" "+i(r(t)("rightPanel.thinking")),1)]),s("div",$i,[s("div",Pi,[s("span",ki,i(r(t)("rightPanel.input"))+":",1),s("pre",null,i(b(B.thinkInput)),1)]),s("div",Ei,[s("span",Ci,i(r(t)("rightPanel.output"))+":",1),s("pre",null,i(b(B.thinkOutput)),1)])])]),B.actionNeeded?(p(),f("div",Ti,[s("h5",null,[k(r(T),{icon:"carbon:play"}),re(" "+i(r(t)("rightPanel.action")),1)]),s("div",Ri,[(p(!0),f(ie,null,pe(B.actToolInfoList,(ne,Q)=>(p(),f("div",{key:Q},[s("div",Ii,[s("span",Ai,i(r(t)("rightPanel.tool"))+":",1),s("span",xi,i(ne.name||""),1)]),s("div",Mi,[s("span",Fi,i(r(t)("rightPanel.toolParameters"))+":",1),s("pre",null,i(b(ne.parameters)),1)]),s("div",Di,[s("span",Ni,i(r(t)("rightPanel.executionResult"))+":",1),s("pre",null,i(b(ne.result)),1)])]))),128))]),B.subPlanExecutionRecord?(p(),f("div",Ui,[s("h5",null,[k(r(T),{icon:"carbon:tree-view"}),re(" "+i(r(t)("rightPanel.subPlan")),1)]),s("div",Oi,[s("div",Li,[s("div",Bi,[s("span",qi,i($.$t("rightPanel.subPlanId"))+":",1),s("span",Vi,i(B.subPlanExecutionRecord.currentPlanId),1)]),B.subPlanExecutionRecord.title?(p(),f("div",ji,[s("span",Gi,i($.$t("rightPanel.title"))+":",1),s("span",Hi,i(B.subPlanExecutionRecord.title),1)])):V("",!0),s("div",zi,[B.subPlanExecutionRecord.completed?(p(),he(r(T),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):(p(),he(r(T),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})),s("span",Ji,i(B.subPlanExecutionRecord.completed?$.$t("rightPanel.status.completed"):$.$t("rightPanel.status.executing")),1)])])])])):V("",!0)])):V("",!0)]))),128))]),l.value.agentExecution&&!l.value.agentExecution.thinkActSteps?.length?(p(),f("div",Wi,[s("p",null,i(r(t)("rightPanel.noStepDetails")),1)])):l.value.agentExecution?V("",!0):(p(),f("div",Ki,[k(r(T),{icon:"carbon:information",class:"info-icon"}),s("h4",null,i(r(t)("rightPanel.stepInfo")),1),s("div",Xi,[s("div",Qi,[s("span",Yi,i(r(t)("rightPanel.stepName"))+":",1),s("span",Zi,i(l.value.title||l.value.description||l.value.stepId),1)]),l.value.description?(p(),f("div",ec,[s("span",tc,i($.$t("rightPanel.description"))+":",1),s("span",sc,i(l.value.description),1)])):V("",!0),s("div",nc,[s("span",oc,i($.$t("rightPanel.status.label"))+":",1),s("span",{class:le(["value",{"status-completed":l.value.completed,"status-current":l.value.current,"status-pending":!l.value.completed&&!l.value.current}])},i(l.value.completed?$.$t("rightPanel.status.completed"):l.value.current?$.$t("rightPanel.status.executing"):$.$t("rightPanel.status.pending")),3)])]),s("p",ac,i(r(t)("rightPanel.noExecutionInfo")),1)])),l.value.current&&!l.value.completed?(p(),f("div",lc,[U[2]||(U[2]=s("div",{class:"execution-waves"},[s("div",{class:"wave wave-1"}),s("div",{class:"wave wave-2"}),s("div",{class:"wave wave-3"})],-1)),s("p",rc,[k(r(T),{icon:"carbon:in-progress",class:"rotating-icon"}),re(" "+i(r(t)("rightPanel.stepExecuting")),1)])])):V("",!0)])):(p(),f("div",ic,[k(r(T),{icon:"carbon:events",class:"empty-icon"}),s("h3",null,i(r(t)("rightPanel.noStepSelected")),1),s("p",null,i(r(t)("rightPanel.selectStepHint")),1)]))])):V("",!0),k(Ct,{name:"scroll-button"},{default:je(()=>[u.value?(p(),f("button",{key:0,onClick:A,class:"scroll-to-bottom-btn",title:r(t)("rightPanel.scrollToBottom")},[k(r(T),{icon:"carbon:chevron-down"})],8,cc)):V("",!0)]),_:1})],544)])):V("",!0),c.value==="files"?(p(),f("div",dc,[j.value?(p(),he(Yr,{key:0,"plan-id":j.value},null,8,["plan-id"])):g.value?(p(),f("div",uc,[k(r(T),{icon:"carbon:folder-off"}),s("div",pc,[s("h3",null,i(r(t)("fileBrowser.noFilesYet")),1),s("p",null,i(r(t)("fileBrowser.noPlanExecuting")),1),s("div",hc,[k(r(T),{icon:"carbon:information"}),s("span",null,i(r(t)("fileBrowser.startTaskTip")),1)])])])):V("",!0)])):V("",!0)])]))}}),fc=_e(mc,[["__scopeId","data-v-6671ef38"]]);class ls{static BASE_URL="/api/plan-template";static async getParameterRequirements(e){try{const n=await fetch(`${this.BASE_URL}/${e}/parameters`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error(`Failed to get parameter requirements: ${n.statusText}`);return await n.json()}catch(n){throw console.error("Error getting parameter requirements:",n),n}}}const gc={class:"modal-form wide-modal"},vc={class:"form-section"},bc={class:"form-item"},yc=["placeholder"],_c={class:"field-description"},Sc={class:"form-section"},wc={class:"form-item"},$c=["placeholder"],Pc={class:"field-description"},kc={class:"form-section"},Ec={class:"form-item"},Cc={class:"service-group-autocomplete"},Tc=["placeholder"],Rc={key:0,class:"service-group-dropdown"},Ic=["onMousedown"],Ac={class:"field-description"},xc={class:"form-section"},Mc={class:"section-title"},Fc={key:0,class:"params-help-text"},Dc={class:"parameter-table"},Nc=["onUpdate:modelValue","placeholder","readonly"],Uc=["onUpdate:modelValue","placeholder"],Oc={class:"form-section"},Lc={class:"service-publish-options"},Bc={class:"internal-toolcall-publish-option"},qc={class:"checkbox-label"},Vc={class:"checkbox-text"},jc={class:"checkbox-description"},Gc={class:"http-publish-option"},Hc={class:"checkbox-label"},zc={class:"checkbox-text"},Jc={class:"checkbox-description"},Wc={class:"button-container"},Kc=["disabled"],Xc=["disabled"],Qc=ye({__name:"PublishServiceModal",props:{modelValue:{type:Boolean,default:!1},planTemplateId:{default:""},planDescription:{default:""}},emits:["update:modelValue","published"],setup(o,{expose:e,emit:n}){const{t}=Ie(),a=o,l=n,c=me({get:()=>a.modelValue,set:W=>l("update:modelValue",W)}),d=F(""),h=F(""),u=F(!1),m=F(!1),w=F(null),x=F(!1),j=F(!1),g=F(!0),y=F({parameters:[],hasParameters:!1,requirements:""}),_=F(!1),v=F(!1),S=F([]),A=F(!1),P=Ye({serviceName:"",userRequest:"",endpoint:"",serviceGroup:"",parameters:[]}),b=me(()=>{const W=P.serviceGroup.trim();if(!W)return S.value;const J=W.toLowerCase();return S.value.filter(L=>L.toLowerCase().includes(J))}),R=me(()=>{const W=w.value?.id;return t(W?"mcpService.updateService":"mcpService.createService")}),N=()=>{P.serviceName="",P.userRequest=a.planDescription||"",P.endpoint="",P.serviceGroup="",y.value.hasParameters||(P.parameters=[]),w.value=null,x.value=!1};ue(()=>P.userRequest,W=>{const J=W.trim();J&&(P.serviceName.trim()||(P.serviceName=J))});const G=async()=>{if(!A.value){A.value=!0;try{const W=await Vs.getAvailableTools(),J=new Set;W.forEach(L=>{L.serviceGroup&&J.add(L.serviceGroup)}),S.value=Array.from(J).sort()}catch(W){console.error("[PublishModal] Failed to load service groups:",W),S.value=[]}finally{A.value=!1}}},$=()=>{v.value=!0},U=()=>{setTimeout(()=>{v.value=!1},200)},B=W=>{P.serviceGroup=W,v.value=!1},Y=async()=>{if(!a.planTemplateId){y.value={parameters:[],hasParameters:!1,requirements:""};return}_.value=!0;try{const W=await ls.getParameterRequirements(a.planTemplateId);y.value=W,W.hasParameters&&(P.parameters=W.parameters.map(J=>({name:J,description:""})))}catch(W){console.error("[PublishModal] Failed to load parameter requirements:",W),W instanceof Error&&!W.message.includes("404")&&console.warn("[PublishModal] Parameter requirements not available yet, will retry later"),y.value={parameters:[],hasParameters:!1,requirements:""}}finally{_.value=!1}},ne=(W,J)=>{J==="success"?(h.value=W,setTimeout(()=>{h.value=""},3e3)):J==="error"&&(d.value=W,setTimeout(()=>{d.value=""},5e3))},Q=()=>{if(!P.serviceName.trim())return ne(t("mcpService.toolNameRequiredError"),"error"),!1;if(!P.userRequest.trim())return ne(t("mcpService.toolDescriptionRequiredError"),"error"),!1;if(!P.serviceGroup.trim())return ne(t("mcpService.serviceGroupRequiredError"),"error"),!1;if(!g.value&&!j.value)return ne("Please select at least one service type","error"),!1;for(let W=0;W<P.parameters.length;W++){const J=P.parameters[W];if(J.name&&!J.description.trim())return ne(`Parameter "${J.name}" description cannot be empty`,"error"),!1;if(J.description&&!J.name.trim())return ne(`Parameter description "${J.description}" corresponding name cannot be empty`,"error"),!1}return!0},te=async()=>{if(console.log("[PublishModal] Starting to handle publish request"),console.log("[PublishModal] Form data:",P),console.log("[PublishModal] Current tool:",w.value),console.log("[PublishModal] Publish as HTTP service:",j.value),!Q()){console.log("[PublishModal] Form validation failed");return}u.value=!0;try{if(!w.value){console.log("[PublishModal] No current tool data, getting existing tool or creating default");const L=await Ae.getCoordinatorToolByTemplate(a.planTemplateId);L?w.value=L:w.value=Ae.createDefaultCoordinatorTool(a.planTemplateId,void 0,a.planDescription)}console.log("[PublishModal] Updating tool information"),w.value.toolName=P.serviceName.trim(),w.value.toolDescription=P.userRequest.trim(),w.value.serviceGroup=P.serviceGroup.trim(),w.value.planTemplateId=a.planTemplateId,w.value.enableInternalToolcall=g.value,w.value.enableHttpService=j.value,w.value.enableMcpService=!1,w.value.mcpEndpoint=void 0;const W=P.parameters.filter(L=>L.name.trim()&&L.description.trim()).map(L=>({name:L.name.trim(),description:L.description.trim(),type:"string"}));if(w.value.inputSchema=JSON.stringify(W),console.log("[PublishModal] Updated tool information:",w.value),w.value.id)console.log("[PublishModal] Updating existing tool, ID:",w.value.id),await Ae.updateCoordinatorTool(w.value.id,w.value);else{console.log("[PublishModal] Creating new tool");const L=await Ae.createCoordinatorTool(w.value);w.value=L}const J=[];if(g.value&&J.push("Internal Method Call"),j.value&&J.push("HTTP Service"),J.length>0){console.log("[PublishModal] Step 5: Publishing service, ID:",w.value.id,"Enabled services:",J.join(", "));const L=[];g.value&&L.push(`Internal Call: ${P.serviceName}`),console.log("[PublishModal] Service published successfully"),ne(t("mcpService.publishSuccess"),"success"),l("published",w.value)}else console.log("[PublishModal] Only saving tool, not publishing as any service"),ne(t("mcpService.saveSuccess"),"success"),l("published",w.value)}catch(W){console.error("[PublishModal] Failed to publish service:",W);const J=W instanceof Error?W.message:"Unknown error";ne(t("mcpService.publishFailed")+": "+J,"error")}finally{u.value=!1}},se=async()=>{if(!m.value&&confirm(t("mcpService.deleteConfirmMessage"))){if(!w.value?.id){ne(t("mcpService.deleteFailed")+": "+t("mcpService.selectPlanTemplateFirst"),"error");return}m.value=!0;try{console.log("[PublishModal] Starting to delete MCP service, ID:",w.value.id);const W=await Ae.deleteCoordinatorTool(w.value.id);if(W.success)console.log("[PublishModal] Deleted successfully"),ne(t("mcpService.deleteSuccess"),"success"),c.value=!1,l("published",null);else throw new Error(W.message)}catch(W){console.error("[PublishModal] Failed to delete MCP service:",W);const J=W instanceof Error?W.message:"Unknown error";ne(t("mcpService.deleteFailed")+": "+J,"error")}finally{m.value=!1}}},ge=async()=>{c.value&&(console.log("[PublishModal] Modal opened, starting to initialize data"),N(),await fe())},fe=async()=>{if(!a.planTemplateId){console.log("[PublishModal] "+t("mcpService.noPlanTemplateId"));return}try{console.log("[PublishModal] Starting to load coordinator tool data, planTemplateId:",a.planTemplateId);const W=await Ae.getCoordinatorToolByTemplate(a.planTemplateId);let J;W?(J=W,console.log("[PublishModal] Found existing coordinator tool:",J)):(J=Ae.createDefaultCoordinatorTool(a.planTemplateId,void 0,a.planDescription),console.log("[PublishModal] Created default coordinator tool VO:",J)),w.value=J,x.value=!!J.id;const L=[];if(J.enableMcpService&&J.mcpEndpoint){const I=window.location.origin;L.push(`MCP: ${I}/mcp${J.mcpEndpoint}`)}J.enableInternalToolcall&&L.push(`Internal Call: ${J.toolName}`),console.log("[PublishModal] Load tool data completed"),P.serviceName=J.toolName||"",P.userRequest=J.toolDescription||a.planDescription||"",P.serviceGroup=J.serviceGroup??"",j.value=J.enableHttpService??!1,g.value=J.enableInternalToolcall??!1;try{if(J.inputSchema){const I=JSON.parse(J.inputSchema);Array.isArray(I)&&I.length>0?(P.parameters=I.map(O=>({name:O.name||"",description:O.description||""})),console.log("[PublishModal] Load parameters from inputSchema:",P.parameters)):console.log("[PublishModal] inputSchema is empty, keeping existing parameters:",P.parameters)}}catch(I){console.warn("[PublishModal] "+t("mcpService.parseInputSchemaFailed")+":",I),console.log("[PublishModal] Parsing failed, keeping existing parameters:",P.parameters)}console.log("[PublishModal] Form data filled:",P)}catch(W){console.error("[PublishModal] "+t("mcpService.loadToolDataFailed")+":",W);const J=W instanceof Error?W.message:"Unknown error";ne(t("mcpService.loadToolDataFailed")+": "+J,"error")}};return ue(()=>a.modelValue,ge),ue(()=>a.planTemplateId,(W,J)=>{W&&W!==J&&(J&&W.startsWith("planTemplate-")?setTimeout(()=>{Y()},1e3):Y())}),ue(c,W=>{W&&G()}),Te(async()=>{c.value&&(console.log("[PublishModal] Initialize when component mounted"),N(),await fe(),await Y())}),e({loadParameterRequirements:Y}),(W,J)=>(p(),f(ie,null,[k(ts,{modelValue:c.value,"onUpdate:modelValue":J[6]||(J[6]=L=>c.value=L),title:R.value,onConfirm:te},{footer:je(()=>[s("div",Wc,[x.value&&w.value?.id?(p(),f("button",{key:0,class:"action-btn danger",onClick:se,disabled:m.value},[m.value?(p(),he(r(T),{key:0,icon:"carbon:loading",class:"loading-icon"})):(p(),he(r(T),{key:1,icon:"carbon:trash-can"})),re(" "+i(m.value?r(t)("mcpService.deleting"):r(t)("mcpService.delete")),1)],8,Kc)):V("",!0),s("button",{class:"action-btn primary",onClick:te,disabled:u.value},[u.value?(p(),he(r(T),{key:0,icon:"carbon:loading",class:"loading-icon"})):(p(),he(r(T),{key:1,icon:"carbon:cloud-upload"})),re(" "+i(u.value?r(t)("mcpService.publishing"):r(t)("mcpService.publishAsService")),1)],8,Xc)])]),default:je(()=>[s("div",gc,[s("div",vc,[s("div",bc,[s("label",null,i(r(t)("mcpService.toolNameRequired")),1),de(s("input",{type:"text","onUpdate:modelValue":J[0]||(J[0]=L=>P.serviceName=L),placeholder:r(t)("mcpService.toolNamePlaceholder"),class:le({error:!P.serviceName||!P.serviceName.trim()}),required:""},null,10,yc),[[ve,P.serviceName]]),s("div",_c,i(r(t)("mcpService.toolNameDescription")),1)])]),s("div",Sc,[s("div",wc,[s("label",null,i(r(t)("mcpService.toolDescriptionRequired")),1),de(s("textarea",{"onUpdate:modelValue":J[1]||(J[1]=L=>P.userRequest=L),placeholder:r(t)("mcpService.toolDescriptionPlaceholder"),class:le([{error:!P.userRequest||!P.userRequest.trim()},"description-field"]),rows:"4",required:""},null,10,$c),[[ve,P.userRequest]]),s("div",Pc,i(r(t)("mcpService.toolDescriptionDescription")),1)])]),s("div",kc,[s("div",Ec,[s("label",null,i(r(t)("mcpService.serviceGroup")),1),s("div",Cc,[de(s("input",{type:"text","onUpdate:modelValue":J[2]||(J[2]=L=>P.serviceGroup=L),onInput:$,onFocus:J[3]||(J[3]=L=>v.value=!0),onBlur:U,placeholder:r(t)("mcpService.serviceGroupPlaceholder"),class:le({error:!P.serviceGroup||!P.serviceGroup.trim()}),required:""},null,42,Tc),[[ve,P.serviceGroup]]),v.value&&b.value.length>0?(p(),f("div",Rc,[(p(!0),f(ie,null,pe(b.value,L=>(p(),f("div",{key:L,class:"service-group-option",onMousedown:I=>B(L)},i(L),41,Ic))),128))])):V("",!0)]),s("div",Ac,i(r(t)("mcpService.serviceGroupDescription")),1)])]),s("div",xc,[s("div",Mc,i(r(t)("mcpService.parameterConfig")),1),y.value.hasParameters?(p(),f("div",Fc,i(r(t)("sidebar.parameterRequirementsHelp")),1)):V("",!0),s("div",Dc,[s("table",null,[s("thead",null,[s("tr",null,[s("th",null,i(r(t)("mcpService.parameterName")),1),s("th",null,i(r(t)("mcpService.parameterDescription")),1)])]),s("tbody",null,[(p(!0),f(ie,null,pe(P.parameters,(L,I)=>(p(),f("tr",{key:I},[s("td",null,[de(s("input",{type:"text","onUpdate:modelValue":O=>L.name=O,placeholder:r(t)("mcpService.parameterName"),class:le(["parameter-input",{"readonly-input":y.value.hasParameters}]),readonly:y.value.hasParameters,required:""},null,10,Nc),[[ve,L.name]])]),s("td",null,[de(s("input",{type:"text","onUpdate:modelValue":O=>L.description=O,placeholder:r(t)("mcpService.parameterDescription"),class:"parameter-input",required:""},null,8,Uc),[[ve,L.description]])])]))),128))])])])]),s("div",Oc,[s("div",Lc,[s("div",Bc,[s("label",qc,[de(s("input",{type:"checkbox","onUpdate:modelValue":J[4]||(J[4]=L=>g.value=L),class:"checkbox-input"},null,512),[[St,g.value]]),s("span",Vc,i(r(t)("mcpService.publishAsInternalToolcall")),1)]),s("div",jc,i(r(t)("mcpService.publishAsInternalToolcallDescription")),1)]),s("div",Gc,[s("label",Hc,[de(s("input",{type:"checkbox","onUpdate:modelValue":J[5]||(J[5]=L=>j.value=L),class:"checkbox-input"},null,512),[[St,j.value]]),s("span",zc,i(r(t)("mcpService.publishAsHttpService")),1)]),s("div",Jc,i(r(t)("mcpService.publishAsHttpServiceDescription")),1)])])])])]),_:1},8,["modelValue","title"]),d.value?(p(),f("div",{key:0,class:"error-toast",onClick:J[7]||(J[7]=L=>d.value="")},[k(r(T),{icon:"carbon:error"}),re(" "+i(d.value),1)])):V("",!0),h.value?(p(),f("div",{key:1,class:"success-toast",onClick:J[8]||(J[8]=L=>h.value="")},[k(r(T),{icon:"carbon:checkmark"}),re(" "+i(h.value),1)])):V("",!0)],64))}}),Yc=_e(Qc,[["__scopeId","data-v-5d800e24"]]),Zc={class:"modal-header"},ed={class:"modal-body"},td={class:"modal-footer"},sd=["disabled"],nd=ye({__name:"SaveConfirmationDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","save","continue"],setup(o,{emit:e}){const n=e,t=F(!1),a=()=>{n("update:modelValue",!1)},l=async()=>{t.value=!0;try{n("save"),n("update:modelValue",!1)}finally{t.value=!1}},c=()=>{n("continue"),n("update:modelValue",!1)};return(d,h)=>d.modelValue?(p(),f("div",{key:0,class:"modal-overlay",onClick:a},[s("div",{class:"modal-content",onClick:h[0]||(h[0]=be(()=>{},["stop"]))},[s("div",Zc,[s("h3",null,i(d.$t("sidebar.saveConfirmationTitle")),1),s("button",{class:"close-btn",onClick:a},[k(r(T),{icon:"carbon:close",width:"16"})])]),s("div",ed,[s("p",null,i(d.$t("sidebar.saveConfirmationMessage")),1)]),s("div",td,[s("button",{class:"btn btn-secondary",onClick:a},i(d.$t("common.cancel")),1),s("button",{class:"btn btn-primary",onClick:l,disabled:t.value},[t.value?(p(),he(r(T),{key:0,icon:"carbon:loading",width:"16",class:"spinning"})):V("",!0),re(" "+i(t.value?d.$t("sidebar.saving"):d.$t("common.save")),1)],8,sd),s("button",{class:"btn btn-danger",onClick:c},i(d.$t("sidebar.continueWithoutSave")),1)])])])):V("",!0)}}),od=_e(nd,[["__scopeId","data-v-4817656d"]]),ad={class:"config-section"},ld={class:"section-header"},rd={class:"execution-content"},id={class:"params-requirements-group"},cd={class:"params-help-text"},dd={key:0,class:"parameter-fields"},ud={class:"parameter-label"},pd=["onUpdate:modelValue","placeholder","onInput"],hd={key:0,class:"parameter-error"},md={key:1,class:"validation-message"},fd=["disabled"],gd=["disabled"],vd={key:1,class:"call-example-wrapper"},bd={class:"call-example-header"},yd={class:"call-example-title"},_d={class:"call-example-description"},Sd={class:"internal-call-wrapper"},wd={class:"call-info"},$d={class:"call-method"},Pd={class:"call-endpoint"},kd={key:0,class:"call-endpoint"},Ed={class:"call-description"},Cd={class:"call-example"},Td={class:"example-code"},Rd={key:2,class:"call-example-wrapper"},Id={class:"call-example-header"},Ad={class:"call-example-title"},xd={class:"call-example-description"},Md={class:"http-api-urls-wrapper"},Fd={class:"tab-container"},Dd={class:"tab-header"},Nd=["onClick"],Ud={class:"tab-content"},Od={class:"http-api-url-display"},Ld={class:"api-method"},Bd={class:"api-endpoint"},qd={class:"api-description"},Vd={key:0,class:"api-example"},jd={class:"example-code"},Gd={key:3,class:"call-example-wrapper"},Hd={class:"call-example-header"},zd={class:"call-example-title"},Jd={class:"call-example-description"},Wd={class:"mcp-call-wrapper"},Kd={class:"call-info"},Xd={class:"call-method"},Qd={class:"call-endpoint"},Yd={class:"call-description"},Zd={class:"call-example"},eu={class:"example-code"},tu=ye({__name:"ExecutionController",props:{currentPlanTemplateId:{default:""},isExecuting:{type:Boolean,default:!1},isGenerating:{type:Boolean,default:!1},showPublishButton:{type:Boolean,default:!0},toolInfo:{default:()=>({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""})}},emits:["executePlan","publishMcpService","clearParams","updateExecutionParams","saveBeforeExecute"],setup(o,{expose:e,emit:n}){const{t}=Ie(),a=ss(),l=o,c=n,d=F(""),h=F({parameters:[],hasParameters:!1,requirements:""}),u=F({}),m=F(!1),w=F("get-sync"),x=F({}),j=F(!1),g=F(!1),y=F(),_=F([]),v=F(null),S=F(!1),A=F(null),P=F([{id:"get-sync",label:"GET + Sync",method:"GET",endpoint:"/api/executor/executeByToolNameSync/{toolName}",description:"Synchronous GET request - returns execution result immediately",example:`GET /api/executor/executeByToolNameSync/my-tool?allParams={"rawParam":"test"}
Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-sync",label:"POST + Sync",method:"POST",endpoint:"/api/executor/executeByToolNameSync",description:"Synchronous POST request - returns execution result immediately",example:`POST /api/executor/executeByToolNameSync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-async",label:"POST + Async",method:"POST",endpoint:"/api/executor/executeByToolNameAsync",description:"Asynchronous POST request - returns task ID, check status separately",example:`POST /api/executor/executeByToolNameAsync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "planId": "plan-123",
  "status": "processing",
  "message": "Task submitted, processing",
  "memoryId": "ABC12345",
  "toolName": "my-tool",
  "planTemplateId": "template-456"
}

# Check execution status and get detailed results:
GET /api/executor/details/{planId}
Response: {
  "currentPlanId": "plan-123",
  "title": "Plan Title",
  "status": "completed",
  "summary": "Execution completed successfully",
  "agentExecutionSequence": [...],
  "userInputWaitState": null,
  "structureResult": {
    "message": [
      {
        "name": "Product A",
        "price": "100",
        "quantity": "5"
      }
    ],
    "fileList": [
      {
        "fileName": "report.md",
        "fileDescription": "Generated report with product information"
      }
    ]
  }
}`}]),b=me(()=>l.toolInfo.enableInternalToolcall??l.toolInfo.enableHttpService??l.toolInfo.enableMcpService),R=me(()=>b.value?t("sidebar.updateServiceStatus"):t("sidebar.publishMcpService")),N=me(()=>l.isExecuting||l.isGenerating?!1:h.value.hasParameters?h.value.parameters.every(D=>{const z=u.value[D];return typeof z=="string"&&z.trim()!==""}):!0),G=(D,z)=>{_.value=D.map(Z=>Z.originalName),v.value=z,console.log("[ExecutionController] Files uploaded:",D.length,"uploadKey:",z)},$=D=>{_.value=D.map(z=>z.originalName),console.log("[ExecutionController] Files removed, remaining:",D.length)},U=D=>{v.value=D,console.log("[ExecutionController] Upload key changed:",D)},B=()=>{console.log("[ExecutionController] Upload started")},Y=()=>{console.log("[ExecutionController] Upload completed")},ne=D=>{console.error("[ExecutionController] Upload error:",D)},Q=()=>{if(console.log("[ExecutionController] ðŸš€ Execute button clicked"),q.hasTaskRequirementModified){if(console.log("[ExecutionController] âš ï¸ Task requirements modified, showing save confirmation dialog"),!I()){console.log("[ExecutionController] âŒ Parameter validation failed:",x.value);return}const D=h.value.hasParameters&&Object.keys(u.value).length>0?u.value:void 0;A.value={title:"",planData:{title:"",steps:[],directResponse:!1},params:void 0,replacementParams:D,uploadedFiles:_.value,uploadKey:v.value},S.value=!0;return}te()},te=()=>{if(g.value=!0,console.log("[ExecutionController] ðŸ”’ Set isExecutingPlan to true"),!I()){console.log("[ExecutionController] âŒ Parameter validation failed:",x.value),g.value=!1;return}const D=h.value.hasParameters&&Object.keys(u.value).length>0?u.value:void 0;console.log("[ExecutionController] ðŸ”„ Replacement params:",D);const z={title:"",planData:{title:"",steps:[],directResponse:!1},params:void 0,replacementParams:D,uploadedFiles:_.value,uploadKey:v.value};console.log("[ExecutionController] ðŸ“¤ Emitting executePlan with payload:",JSON.stringify(z,null,2)),c("executePlan",z)},se=async()=>{console.log("[ExecutionController] ðŸ’¾ Save and execute requested");try{c("saveBeforeExecute"),await new Promise(D=>setTimeout(D,500)),A.value&&(console.log("[ExecutionController] ðŸ“¤ Emitting executePlan after save:",JSON.stringify(A.value,null,2)),c("executePlan",A.value),A.value=null)}catch(D){console.error("[ExecutionController] âŒ Failed to save before execute:",D);const z=D instanceof Error?D.message:t("sidebar.saveFailed");a.error(z)}},ge=()=>{console.log("[ExecutionController] â© Continue without save requested"),A.value&&(console.log("[ExecutionController] ðŸ“¤ Emitting executePlan without save:",JSON.stringify(A.value,null,2)),c("executePlan",A.value),A.value=null)},fe=()=>{c("publishMcpService")},W=()=>{console.log("[ExecutionController] ðŸ§¹ clearExecutionParams called"),d.value="",u.value={},g.value=!1,console.log("[ExecutionController] ðŸ”“ Reset isExecutingPlan to false"),console.log("[ExecutionController] âœ… After clear - parameterValues cleared"),c("clearParams")},J=async()=>{if(console.log("[ExecutionController] ðŸ”„ loadParameterRequirements called for templateId:",l.currentPlanTemplateId),console.log("[ExecutionController] ðŸ“Š Current parameterRequirements before load:",JSON.stringify(h.value,null,2)),!l.currentPlanTemplateId){console.log("[ExecutionController] âŒ No template ID, resetting parameters"),h.value={parameters:[],hasParameters:!1,requirements:""},u.value={};return}h.value={parameters:[],hasParameters:!1,requirements:""},u.value={},console.log("[ExecutionController] ðŸ§¹ Cleared previous data before loading new template"),m.value=!0;try{console.log("[ExecutionController] ðŸŒ Fetching parameter requirements from API...");const D=await ls.getParameterRequirements(l.currentPlanTemplateId);console.log("[ExecutionController] ðŸ“¥ Received requirements from API:",JSON.stringify(D,null,2)),h.value=D;const z={};D.parameters.forEach(Z=>{z[Z]=u.value[Z]||""}),u.value=z,console.log("[ExecutionController] âœ… Updated parameterRequirements:",JSON.stringify(h.value,null,2)),console.log("[ExecutionController] âœ… Updated parameterValues:",JSON.stringify(u.value,null,2)),O()}catch(D){console.error("[ExecutionController] âŒ Failed to load parameter requirements:",D),D instanceof Error&&!D.message.includes("404")&&console.warn("[ExecutionController] âš ï¸ Parameter requirements not available yet, will retry later"),h.value={parameters:[],hasParameters:!1,requirements:""},u.value={},console.log("[ExecutionController] ðŸ”„ Reset parameterRequirements due to error:",JSON.stringify(h.value,null,2)),console.log("[ExecutionController] ðŸ”„ Cleared parameterValues:",JSON.stringify(u.value,null,2))}finally{m.value=!1,console.log("[ExecutionController] âœ… loadParameterRequirements completed")}},L=(D,z)=>{u.value[D]=z,x.value[D]&&delete x.value[D],O()},I=()=>{if(x.value={},j.value=!1,!h.value.hasParameters)return!0;let D=!1;return h.value.parameters.forEach(z=>{(u.value[z]?u.value[z].trim():"")||(x.value[z]=`${z} is required`,D=!0)}),j.value=D,!D},O=()=>{h.value.hasParameters?d.value=JSON.stringify(u.value,null,2):d.value="",c("updateExecutionParams",d.value)};return ue(()=>l.currentPlanTemplateId,(D,z)=>{if(D&&D!==z){if(g.value){console.log("[ExecutionController] â¸ï¸ Skipping parameter reload - plan is executing");return}console.log("[ExecutionController] ðŸ”„ Template ID changed, will reload parameters"),z&&D.startsWith("planTemplate-")?(console.log("[ExecutionController] â° New template detected, retrying with delay..."),setTimeout(()=>{console.log("[ExecutionController] â° Delay timeout, calling loadParameterRequirements"),J()},1e3)):(console.log("[ExecutionController] ðŸš€ Immediate reload of parameters"),J())}}),ue(()=>d.value,D=>{c("updateExecutionParams",D)}),Te(()=>{J()}),e({executionParams:d,clearExecutionParams:W,loadParameterRequirements:J,fileUploadRef:y,uploadedFiles:_,uploadKey:v}),(D,z)=>(p(),f(ie,null,[s("div",ad,[s("div",ld,[k(r(T),{icon:"carbon:play",width:"16"}),s("span",null,i(r(t)("sidebar.executionController")),1)]),s("div",rd,[s("div",id,[s("label",null,i(r(t)("sidebar.parameterRequirements")),1),s("div",cd,i(r(t)("sidebar.parameterRequirementsHelp")),1),h.value.hasParameters?(p(),f("div",dd,[(p(!0),f(ie,null,pe(h.value.parameters,Z=>(p(),f("div",{key:Z,class:"parameter-field"},[s("label",ud,[re(i(Z)+" ",1),z[1]||(z[1]=s("span",{class:"required"},"*",-1))]),de(s("input",{"onUpdate:modelValue":M=>u.value[Z]=M,class:le(["parameter-input",{error:x.value[Z]}]),placeholder:r(t)("sidebar.enterValueFor",{param:Z}),onInput:M=>L(Z,M.target.value),required:""},null,42,pd),[[ve,u.value[Z]]]),x.value[Z]?(p(),f("div",hd,i(x.value[Z]),1)):V("",!0)]))),128))])):V("",!0),h.value.hasParameters&&!N.value&&!l.isExecuting&&!l.isGenerating?(p(),f("div",md,[k(r(T),{icon:"carbon:warning",width:"14"}),re(" "+i(r(t)("sidebar.fillAllRequiredParameters")),1)])):V("",!0)]),k(os,{ref_key:"fileUploadRef",ref:y,disabled:l.isExecuting||l.isGenerating,onFilesUploaded:G,onFilesRemoved:$,onUploadKeyChanged:U,onUploadStarted:B,onUploadCompleted:Y,onUploadError:ne},null,8,["disabled"]),s("button",{class:"btn btn-primary execute-btn",onClick:Q,disabled:!N.value},[k(r(T),{icon:l.isExecuting?"carbon:circle-dash":"carbon:play",width:"16",class:le({spinning:l.isExecuting})},null,8,["icon","class"]),re(" "+i(l.isExecuting?r(t)("sidebar.executing"):r(t)("sidebar.executePlan")),1)],8,fd),D.showPublishButton?(p(),f("button",{key:0,class:"btn publish-mcp-btn",onClick:fe,disabled:!D.currentPlanTemplateId},[k(r(T),{icon:"carbon:application",width:"16"}),re(" "+i(R.value),1)],8,gd)):V("",!0),D.toolInfo?.enableInternalToolcall?(p(),f("div",vd,[s("div",bd,[s("h4",yd,i(r(t)("sidebar.internalCall")),1),s("p",_d,i(r(t)("sidebar.internalCallDescription")),1)]),s("div",Sd,[s("div",wd,[s("div",$d,i(r(t)("sidebar.internalMethodCall")),1),s("div",Pd,i(r(t)("sidebar.toolName"))+": "+i(D.toolInfo?.toolName||D.currentPlanTemplateId),1),D.toolInfo?.serviceGroup?(p(),f("div",kd,i(r(t)("sidebar.serviceGroup"))+": "+i(D.toolInfo.serviceGroup),1)):V("",!0),s("div",Ed,i(r(t)("sidebar.internalCallUsage")),1),s("div",Cd,[s("strong",null,i(r(t)("sidebar.usage"))+":",1),s("pre",Td,i(r(t)("sidebar.internalCallExample")),1)])])])])):V("",!0),D.toolInfo?.enableHttpService?(p(),f("div",Rd,[s("div",Id,[s("h4",Ad,i(r(t)("sidebar.httpCallExample")),1),s("p",xd,i(r(t)("sidebar.httpCallDescription")),1)]),s("div",Md,[s("div",Fd,[s("div",Dd,[(p(!0),f(ie,null,pe(P.value,Z=>(p(),f("button",{key:Z.id,class:le(["tab-button",{active:w.value===Z.id}]),onClick:M=>w.value=Z.id},i(Z.label),11,Nd))),128))]),s("div",Ud,[(p(!0),f(ie,null,pe(P.value,Z=>de((p(),f("div",{key:Z.id,class:"tab-panel"},[s("div",Od,[s("div",Ld,i(Z.method),1),s("div",Bd,i(Z.endpoint),1),s("div",qd,i(Z.description),1),Z.example?(p(),f("div",Vd,[s("strong",null,i(r(t)("sidebar.example"))+":",1),s("pre",jd,i(Z.example),1)])):V("",!0)])])),[[Us,w.value===Z.id]])),128))])])])])):V("",!0),D.toolInfo?.enableMcpService?(p(),f("div",Gd,[s("div",Hd,[s("h4",zd,i(r(t)("sidebar.mcpCall")),1),s("p",Jd,i(r(t)("sidebar.mcpCallDescription")),1)]),s("div",Wd,[s("div",Kd,[s("div",Xd,i(r(t)("sidebar.mcpServiceCall")),1),s("div",Qd,i(r(t)("sidebar.mcpEndpoint"))+": /mcp/execute",1),s("div",Yd,i(r(t)("sidebar.mcpCallUsage")),1),s("div",Zd,[s("strong",null,i(r(t)("sidebar.usage"))+":",1),s("pre",eu,i(r(t)("sidebar.mcpCallExample")),1)])])])])):V("",!0)])]),k(od,{modelValue:S.value,"onUpdate:modelValue":z[0]||(z[0]=Z=>S.value=Z),onSave:se,onContinue:ge},null,8,["modelValue"])],64))}}),su=_e(tu,[["__scopeId","data-v-b2db22bb"]]);function rs(o,e){const n=F(!1),t=Ye({title:"",steps:[],directResponse:!1,planTemplateId:o.currentPlanTemplateId||"",planType:"dynamic_agent"}),a=S=>{console.log("[JsonEditorLogic] parseJsonToVisual called with jsonContent:",S),console.log("[JsonEditorLogic] parseJsonToVisual called with currentPlanTemplateId:",o.currentPlanTemplateId);try{if(!S){console.log("[JsonEditorLogic] No jsonContent, resetting to default"),Object.assign(t,{title:"",steps:[],directResponse:!1,planTemplateId:o.currentPlanTemplateId||"",planType:"dynamic_agent"}),console.log("[JsonEditorLogic] Reset displayData to:",t);return}const A=JSON.parse(S);console.log("[JsonEditorLogic] Parsed JSON:",A),t.title=A.title||"",t.directResponse=!1,t.planTemplateId=A.planTemplateId||o.currentPlanTemplateId||"",t.planType=A.planType||"dynamic_agent",t.steps=(A.steps||[]).map(P=>{const b=P;return{stepRequirement:b.stepRequirement||"",agentName:b.agentName||"",modelName:b.modelName||null,selectedToolKeys:b.selectedToolKeys||[],terminateColumns:b.terminateColumns||""}}),console.log("[JsonEditorLogic] Updated displayData to:",t)}catch(A){console.warn("Failed to parse JSON content:",A),Object.assign(t,{title:"",steps:[],directResponse:!1,planTemplateId:o.currentPlanTemplateId||"",planType:"dynamic_agent"}),console.log("[JsonEditorLogic] Error occurred, reset displayData to:",t)}},l=()=>{try{const S={title:t.title,steps:t.steps.map(A=>({stepRequirement:A.stepRequirement,agentName:A.agentName,modelName:A.modelName??"",selectedToolKeys:A.selectedToolKeys,terminateColumns:A.terminateColumns})),directResponse:t.directResponse,planTemplateId:t.planTemplateId,planType:t.planType};return JSON.stringify(S,null,2)}catch(S){return console.error("Failed to convert visual data to JSON:",S),"{}"}},c=me(()=>l());ue(()=>o.jsonContent,(S,A)=>{console.log("[JsonEditorLogic] Watch triggered - jsonContent changed from",A,"to",S),a(S)},{immediate:!0}),ue(t,()=>{const S=l();e("update:jsonContent",S)},{deep:!0}),ue(()=>o.currentPlanTemplateId,S=>{S&&(t.planTemplateId=S)});let d=[],h=!0;return ue(()=>t.steps.map(S=>S.stepRequirement||S.stepContent||""),S=>{if(h){d=[...S],h=!1;return}(S.length!==d.length||S.some((P,b)=>P!==(d[b]||"")))&&(q.hasTaskRequirementModified=!0)},{deep:!0}),ue(()=>o.jsonContent,()=>{h=!0,d=[]}),{showJsonPreview:n,displayData:t,formattedJsonOutput:c,addStep:()=>{const S={stepRequirement:"",agentName:"ConfigurableDynaAgent",modelName:null,selectedToolKeys:[],terminateColumns:"",agentType:"",stepContent:""};t.steps.push(S)},removeStep:S=>{S>=0&&S<t.steps.length&&t.steps.splice(S,1)},moveStepUp:S=>{if(S>0){const A=t.steps.splice(S,1)[0];t.steps.splice(S-1,0,A)}},moveStepDown:S=>{if(S<t.steps.length-1){const A=t.steps.splice(S,1)[0];t.steps.splice(S+1,0,A)}},toggleJsonPreview:()=>{n.value=!n.value},closeJsonPreview:()=>{n.value=!1},handleRollback:()=>{e("rollback")},handleRestore:()=>{e("restore")},handleSave:()=>{e("save")}}}const nu={class:"config-section"},ou={class:"section-header"},au={class:"visual-editor"},lu={class:"plan-basic-info"},ru={class:"form-row"},iu={class:"form-label"},cu=["placeholder"],du={class:"steps-section"},uu={class:"steps-header"},pu={class:"form-label"},hu={class:"steps-container"},mu={class:"step-header"},fu={class:"step-number"},gu={class:"step-actions"},vu=["onClick","disabled","title"],bu=["onClick","disabled","title"],yu=["onClick","title"],_u={class:"step-content"},Su={class:"form-row"},wu={class:"form-label"},$u={class:"agent-selector"},Pu=["onUpdate:modelValue"],ku={value:""},Eu=["title"],Cu={class:"form-row"},Tu={class:"form-label"},Ru=["onUpdate:modelValue","placeholder"],Iu={class:"form-row"},Au={class:"form-label"},xu=["onUpdate:modelValue","placeholder"],Mu={key:0,class:"empty-steps"},Fu={class:"plan-id-section"},Du={class:"form-row"},Nu={class:"form-label"},Uu={key:0,class:"json-preview"},Ou={class:"preview-header"},Lu={class:"form-label"},Bu={class:"json-code"},qu={class:"editor-footer"},Vu={class:"section-actions"},ju=["disabled","title"],Gu=["disabled","title"],Hu=["disabled"],zu=ye({__name:"JsonEditor",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},hiddenFields:{default:()=>[]},currentPlanTemplateId:{default:""}},emits:["rollback","restore","save","update:jsonContent"],setup(o,{emit:e}){const n=o,t=e,{showJsonPreview:a,displayData:l,formattedJsonOutput:c,addStep:d,removeStep:h,moveStepUp:u,moveStepDown:m,handleRollback:w,handleRestore:x,handleSave:j,toggleJsonPreview:g,closeJsonPreview:y}=rs(n,t),_=v=>{const S=v.target;S.style.height="auto";const A=20,P=Math.ceil(S.scrollHeight/A),b=4,R=12,N=Math.max(b,Math.min(R,P)),G=N*A;S.style.height=`${G}px`,S.rows=N,P>R?S.style.overflowY="auto":S.style.overflowY="hidden"};return(v,S)=>(p(),f("div",nu,[s("div",ou,[k(r(T),{icon:"carbon:code",width:"16"}),s("span",null,i(v.$t("sidebar.jsonTemplate")),1)]),s("div",au,[s("div",lu,[s("div",ru,[s("label",iu,i(v.$t("sidebar.title")),1),de(s("input",{"onUpdate:modelValue":S[0]||(S[0]=A=>r(l).title=A),type:"text",class:"form-input",placeholder:v.$t("sidebar.titlePlaceholder")},null,8,cu),[[ve,r(l).title]])])]),s("div",du,[s("div",uu,[s("label",pu,i(v.$t("sidebar.tasks")),1)]),s("div",hu,[(p(!0),f(ie,null,pe(r(l).steps,(A,P)=>(p(),f("div",{key:P,class:"step-item"},[s("div",mu,[s("span",fu,i(v.$t("sidebar.subtask"))+" "+i(P+1),1),s("div",gu,[s("button",{onClick:b=>r(u)(P),disabled:P===0,class:"btn btn-xs",title:v.$t("sidebar.moveUp")},[k(r(T),{icon:"carbon:chevron-up",width:"12"})],8,vu),s("button",{onClick:b=>r(m)(P),disabled:P===r(l).steps.length-1,class:"btn btn-xs",title:v.$t("sidebar.moveDown")},[k(r(T),{icon:"carbon:chevron-down",width:"12"})],8,bu),s("button",{onClick:b=>r(h)(P),class:"btn btn-xs btn-danger",title:v.$t("sidebar.removeStep")},[k(r(T),{icon:"carbon:trash-can",width:"12"})],8,yu)])]),s("div",_u,[s("div",Su,[s("label",wu,i(v.$t("sidebar.agent")),1),s("div",$u,[de(s("select",{"onUpdate:modelValue":b=>A.agentName=b,class:"form-select agent-select"},[s("option",ku,i(v.$t("sidebar.selectAgent")),1),S[10]||(S[10]=Os('<option value="DEFAULT_AGENT" data-v-bfa06411>DEFAULT_AGENT</option><option value="BROWSER_AGENT" data-v-bfa06411>BROWSER_AGENT</option><option value="TEXT_FILE_AGENT" data-v-bfa06411>TEXT_FILE_AGENT</option><option value="JSX_GENERATOR_AGENT" data-v-bfa06411>JSX_GENERATOR_AGENT</option><option value="FILE_MANAGER_AGENT" data-v-bfa06411>FILE_MANAGER_AGENT</option>',5))],8,Pu),[[dt,A.agentName]]),s("button",{onClick:S[1]||(S[1]=(...b)=>r(d)&&r(d)(...b)),class:"btn btn-sm btn-add-step",title:v.$t("sidebar.addStep")},[k(r(T),{icon:"carbon:add",width:"14"})],8,Eu)])]),s("div",Cu,[s("label",Tu,i(v.$t("sidebar.stepRequirement")),1),de(s("textarea",{"onUpdate:modelValue":b=>A.stepContent=b,class:"form-textarea auto-resize",placeholder:v.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:S[2]||(S[2]=b=>_(b))},null,40,Ru),[[ve,A.stepContent]])]),s("div",Iu,[s("label",Au,i(v.$t("sidebar.terminateColumns")),1),de(s("input",{"onUpdate:modelValue":b=>A.terminateColumns=b,type:"text",class:"form-input",placeholder:v.$t("sidebar.terminateColumnsPlaceholder")},null,8,xu),[[ve,A.terminateColumns]])])])]))),128)),r(l).steps.length===0?(p(),f("div",Mu,[k(r(T),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),s("p",null,i(v.$t("sidebar.noSteps")),1),s("button",{onClick:S[3]||(S[3]=(...A)=>r(d)&&r(d)(...A)),class:"btn btn-primary"},[k(r(T),{icon:"carbon:add",width:"14"}),re(" "+i(v.$t("sidebar.addFirstStep")),1)])])):V("",!0)])]),s("div",Fu,[s("div",Du,[s("label",Nu,i(v.$t("sidebar.planId")),1),de(s("input",{"onUpdate:modelValue":S[4]||(S[4]=A=>r(l).planTemplateId=A),type:"text",class:"form-input",placeholder:"planTemplate-1756109892045"},null,512),[[ve,r(l).planTemplateId]])])]),r(a)?(p(),f("div",Uu,[s("div",Ou,[s("label",Lu,i(v.$t("sidebar.jsonPreview")),1),s("button",{onClick:S[5]||(S[5]=(...A)=>r(y)&&r(y)(...A)),class:"btn btn-xs"},[k(r(T),{icon:"carbon:close",width:"12"})])]),s("pre",Bu,i(r(c)),1)])):V("",!0),s("div",qu,[s("button",{onClick:S[6]||(S[6]=(...A)=>r(g)&&r(g)(...A)),class:"btn btn-sm btn-secondary"},[k(r(T),{icon:"carbon:code",width:"14"}),re(" "+i(r(a)?v.$t("sidebar.hideJson"):v.$t("sidebar.showJson")),1)]),s("div",Vu,[s("button",{class:"btn btn-sm",onClick:S[7]||(S[7]=(...A)=>r(w)&&r(w)(...A)),disabled:!(v.canRollback??!1),title:v.$t("sidebar.rollback")},[k(r(T),{icon:"carbon:undo",width:"14"})],8,ju),s("button",{class:"btn btn-sm",onClick:S[8]||(S[8]=(...A)=>r(x)&&r(x)(...A)),disabled:!(v.canRestore??!1),title:v.$t("sidebar.restore")},[k(r(T),{icon:"carbon:redo",width:"14"})],8,Gu),s("button",{class:"btn btn-primary",onClick:S[9]||(S[9]=(...A)=>r(j)&&r(j)(...A)),disabled:v.isGenerating||v.isExecuting},[k(r(T),{icon:"carbon:save",width:"14"}),S[11]||(S[11]=re(" Save "))],8,Hu)])])])]))}}),Ju=_e(zu,[["__scopeId","data-v-bfa06411"]]);function is(o,e){return function(){return o.apply(e,arguments)}}const{toString:Wu}=Object.prototype,{getPrototypeOf:It}=Object,{iterator:ut,toStringTag:cs}=Symbol,pt=(o=>e=>{const n=Wu.call(e);return o[n]||(o[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),xe=o=>(o=o.toLowerCase(),e=>pt(e)===o),ht=o=>e=>typeof e===o,{isArray:He}=Array,Ge=ht("undefined");function Ze(o){return o!==null&&!Ge(o)&&o.constructor!==null&&!Ge(o.constructor)&&Ee(o.constructor.isBuffer)&&o.constructor.isBuffer(o)}const ds=xe("ArrayBuffer");function Ku(o){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(o):e=o&&o.buffer&&ds(o.buffer),e}const Xu=ht("string"),Ee=ht("function"),us=ht("number"),et=o=>o!==null&&typeof o=="object",Qu=o=>o===!0||o===!1,at=o=>{if(pt(o)!=="object")return!1;const e=It(o);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(cs in o)&&!(ut in o)},Yu=o=>{if(!et(o)||Ze(o))return!1;try{return Object.keys(o).length===0&&Object.getPrototypeOf(o)===Object.prototype}catch{return!1}},Zu=xe("Date"),ep=xe("File"),tp=xe("Blob"),sp=xe("FileList"),np=o=>et(o)&&Ee(o.pipe),op=o=>{let e;return o&&(typeof FormData=="function"&&o instanceof FormData||Ee(o.append)&&((e=pt(o))==="formdata"||e==="object"&&Ee(o.toString)&&o.toString()==="[object FormData]"))},ap=xe("URLSearchParams"),[lp,rp,ip,cp]=["ReadableStream","Request","Response","Headers"].map(xe),dp=o=>o.trim?o.trim():o.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function tt(o,e,{allOwnKeys:n=!1}={}){if(o===null||typeof o>"u")return;let t,a;if(typeof o!="object"&&(o=[o]),He(o))for(t=0,a=o.length;t<a;t++)e.call(null,o[t],t,o);else{if(Ze(o))return;const l=n?Object.getOwnPropertyNames(o):Object.keys(o),c=l.length;let d;for(t=0;t<c;t++)d=l[t],e.call(null,o[d],d,o)}}function ps(o,e){if(Ze(o))return null;e=e.toLowerCase();const n=Object.keys(o);let t=n.length,a;for(;t-- >0;)if(a=n[t],e===a.toLowerCase())return a;return null}const Ue=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,hs=o=>!Ge(o)&&o!==Ue;function $t(){const{caseless:o,skipUndefined:e}=hs(this)&&this||{},n={},t=(a,l)=>{const c=o&&ps(n,l)||l;at(n[c])&&at(a)?n[c]=$t(n[c],a):at(a)?n[c]=$t({},a):He(a)?n[c]=a.slice():(!e||!Ge(a))&&(n[c]=a)};for(let a=0,l=arguments.length;a<l;a++)arguments[a]&&tt(arguments[a],t);return n}const up=(o,e,n,{allOwnKeys:t}={})=>(tt(e,(a,l)=>{n&&Ee(a)?o[l]=is(a,n):o[l]=a},{allOwnKeys:t}),o),pp=o=>(o.charCodeAt(0)===65279&&(o=o.slice(1)),o),hp=(o,e,n,t)=>{o.prototype=Object.create(e.prototype,t),o.prototype.constructor=o,Object.defineProperty(o,"super",{value:e.prototype}),n&&Object.assign(o.prototype,n)},mp=(o,e,n,t)=>{let a,l,c;const d={};if(e=e||{},o==null)return e;do{for(a=Object.getOwnPropertyNames(o),l=a.length;l-- >0;)c=a[l],(!t||t(c,o,e))&&!d[c]&&(e[c]=o[c],d[c]=!0);o=n!==!1&&It(o)}while(o&&(!n||n(o,e))&&o!==Object.prototype);return e},fp=(o,e,n)=>{o=String(o),(n===void 0||n>o.length)&&(n=o.length),n-=e.length;const t=o.indexOf(e,n);return t!==-1&&t===n},gp=o=>{if(!o)return null;if(He(o))return o;let e=o.length;if(!us(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=o[e];return n},vp=(o=>e=>o&&e instanceof o)(typeof Uint8Array<"u"&&It(Uint8Array)),bp=(o,e)=>{const t=(o&&o[ut]).call(o);let a;for(;(a=t.next())&&!a.done;){const l=a.value;e.call(o,l[0],l[1])}},yp=(o,e)=>{let n;const t=[];for(;(n=o.exec(e))!==null;)t.push(n);return t},_p=xe("HTMLFormElement"),Sp=o=>o.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,t,a){return t.toUpperCase()+a}),Nt=(({hasOwnProperty:o})=>(e,n)=>o.call(e,n))(Object.prototype),wp=xe("RegExp"),ms=(o,e)=>{const n=Object.getOwnPropertyDescriptors(o),t={};tt(n,(a,l)=>{let c;(c=e(a,l,o))!==!1&&(t[l]=c||a)}),Object.defineProperties(o,t)},$p=o=>{ms(o,(e,n)=>{if(Ee(o)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const t=o[n];if(Ee(t)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},Pp=(o,e)=>{const n={},t=a=>{a.forEach(l=>{n[l]=!0})};return He(o)?t(o):t(String(o).split(e)),n},kp=()=>{},Ep=(o,e)=>o!=null&&Number.isFinite(o=+o)?o:e;function Cp(o){return!!(o&&Ee(o.append)&&o[cs]==="FormData"&&o[ut])}const Tp=o=>{const e=new Array(10),n=(t,a)=>{if(et(t)){if(e.indexOf(t)>=0)return;if(Ze(t))return t;if(!("toJSON"in t)){e[a]=t;const l=He(t)?[]:{};return tt(t,(c,d)=>{const h=n(c,a+1);!Ge(h)&&(l[d]=h)}),e[a]=void 0,l}}return t};return n(o,0)},Rp=xe("AsyncFunction"),Ip=o=>o&&(et(o)||Ee(o))&&Ee(o.then)&&Ee(o.catch),fs=((o,e)=>o?setImmediate:e?((n,t)=>(Ue.addEventListener("message",({source:a,data:l})=>{a===Ue&&l===n&&t.length&&t.shift()()},!1),a=>{t.push(a),Ue.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",Ee(Ue.postMessage)),Ap=typeof queueMicrotask<"u"?queueMicrotask.bind(Ue):typeof process<"u"&&process.nextTick||fs,xp=o=>o!=null&&Ee(o[ut]),C={isArray:He,isArrayBuffer:ds,isBuffer:Ze,isFormData:op,isArrayBufferView:Ku,isString:Xu,isNumber:us,isBoolean:Qu,isObject:et,isPlainObject:at,isEmptyObject:Yu,isReadableStream:lp,isRequest:rp,isResponse:ip,isHeaders:cp,isUndefined:Ge,isDate:Zu,isFile:ep,isBlob:tp,isRegExp:wp,isFunction:Ee,isStream:np,isURLSearchParams:ap,isTypedArray:vp,isFileList:sp,forEach:tt,merge:$t,extend:up,trim:dp,stripBOM:pp,inherits:hp,toFlatObject:mp,kindOf:pt,kindOfTest:xe,endsWith:fp,toArray:gp,forEachEntry:bp,matchAll:yp,isHTMLForm:_p,hasOwnProperty:Nt,hasOwnProp:Nt,reduceDescriptors:ms,freezeMethods:$p,toObjectSet:Pp,toCamelCase:Sp,noop:kp,toFiniteNumber:Ep,findKey:ps,global:Ue,isContextDefined:hs,isSpecCompliantForm:Cp,toJSONObject:Tp,isAsyncFn:Rp,isThenable:Ip,setImmediate:fs,asap:Ap,isIterable:xp};function oe(o,e,n,t,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=o,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),t&&(this.request=t),a&&(this.response=a,this.status=a.status?a.status:null)}C.inherits(oe,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:C.toJSONObject(this.config),code:this.code,status:this.status}}});const gs=oe.prototype,vs={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(o=>{vs[o]={value:o}});Object.defineProperties(oe,vs);Object.defineProperty(gs,"isAxiosError",{value:!0});oe.from=(o,e,n,t,a,l)=>{const c=Object.create(gs);C.toFlatObject(o,c,function(m){return m!==Error.prototype},u=>u!=="isAxiosError");const d=o&&o.message?o.message:"Error",h=e==null&&o?o.code:e;return oe.call(c,d,h,n,t,a),o&&c.cause==null&&Object.defineProperty(c,"cause",{value:o,configurable:!0}),c.name=o&&o.name||"Error",l&&Object.assign(c,l),c};const Mp=null;function Pt(o){return C.isPlainObject(o)||C.isArray(o)}function bs(o){return C.endsWith(o,"[]")?o.slice(0,-2):o}function Ut(o,e,n){return o?o.concat(e).map(function(a,l){return a=bs(a),!n&&l?"["+a+"]":a}).join(n?".":""):e}function Fp(o){return C.isArray(o)&&!o.some(Pt)}const Dp=C.toFlatObject(C,{},null,function(e){return/^is[A-Z]/.test(e)});function mt(o,e,n){if(!C.isObject(o))throw new TypeError("target must be an object");e=e||new FormData,n=C.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(y,_){return!C.isUndefined(_[y])});const t=n.metaTokens,a=n.visitor||m,l=n.dots,c=n.indexes,h=(n.Blob||typeof Blob<"u"&&Blob)&&C.isSpecCompliantForm(e);if(!C.isFunction(a))throw new TypeError("visitor must be a function");function u(g){if(g===null)return"";if(C.isDate(g))return g.toISOString();if(C.isBoolean(g))return g.toString();if(!h&&C.isBlob(g))throw new oe("Blob is not supported. Use a Buffer instead.");return C.isArrayBuffer(g)||C.isTypedArray(g)?h&&typeof Blob=="function"?new Blob([g]):Buffer.from(g):g}function m(g,y,_){let v=g;if(g&&!_&&typeof g=="object"){if(C.endsWith(y,"{}"))y=t?y:y.slice(0,-2),g=JSON.stringify(g);else if(C.isArray(g)&&Fp(g)||(C.isFileList(g)||C.endsWith(y,"[]"))&&(v=C.toArray(g)))return y=bs(y),v.forEach(function(A,P){!(C.isUndefined(A)||A===null)&&e.append(c===!0?Ut([y],P,l):c===null?y:y+"[]",u(A))}),!1}return Pt(g)?!0:(e.append(Ut(_,y,l),u(g)),!1)}const w=[],x=Object.assign(Dp,{defaultVisitor:m,convertValue:u,isVisitable:Pt});function j(g,y){if(!C.isUndefined(g)){if(w.indexOf(g)!==-1)throw Error("Circular reference detected in "+y.join("."));w.push(g),C.forEach(g,function(v,S){(!(C.isUndefined(v)||v===null)&&a.call(e,v,C.isString(S)?S.trim():S,y,x))===!0&&j(v,y?y.concat(S):[S])}),w.pop()}}if(!C.isObject(o))throw new TypeError("data must be an object");return j(o),e}function Ot(o){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(o).replace(/[!'()~]|%20|%00/g,function(t){return e[t]})}function At(o,e){this._pairs=[],o&&mt(o,this,e)}const ys=At.prototype;ys.append=function(e,n){this._pairs.push([e,n])};ys.toString=function(e){const n=e?function(t){return e.call(this,t,Ot)}:Ot;return this._pairs.map(function(a){return n(a[0])+"="+n(a[1])},"").join("&")};function Np(o){return encodeURIComponent(o).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function _s(o,e,n){if(!e)return o;const t=n&&n.encode||Np;C.isFunction(n)&&(n={serialize:n});const a=n&&n.serialize;let l;if(a?l=a(e,n):l=C.isURLSearchParams(e)?e.toString():new At(e,n).toString(t),l){const c=o.indexOf("#");c!==-1&&(o=o.slice(0,c)),o+=(o.indexOf("?")===-1?"?":"&")+l}return o}class Lt{constructor(){this.handlers=[]}use(e,n,t){return this.handlers.push({fulfilled:e,rejected:n,synchronous:t?t.synchronous:!1,runWhen:t?t.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){C.forEach(this.handlers,function(t){t!==null&&e(t)})}}const Ss={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Up=typeof URLSearchParams<"u"?URLSearchParams:At,Op=typeof FormData<"u"?FormData:null,Lp=typeof Blob<"u"?Blob:null,Bp={isBrowser:!0,classes:{URLSearchParams:Up,FormData:Op,Blob:Lp},protocols:["http","https","file","blob","url","data"]},xt=typeof window<"u"&&typeof document<"u",kt=typeof navigator=="object"&&navigator||void 0,qp=xt&&(!kt||["ReactNative","NativeScript","NS"].indexOf(kt.product)<0),Vp=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",jp=xt&&window.location.href||"http://localhost",Gp=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:xt,hasStandardBrowserEnv:qp,hasStandardBrowserWebWorkerEnv:Vp,navigator:kt,origin:jp},Symbol.toStringTag,{value:"Module"})),Pe={...Gp,...Bp};function Hp(o,e){return mt(o,new Pe.classes.URLSearchParams,{visitor:function(n,t,a,l){return Pe.isNode&&C.isBuffer(n)?(this.append(t,n.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)},...e})}function zp(o){return C.matchAll(/\w+|\[(\w*)]/g,o).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Jp(o){const e={},n=Object.keys(o);let t;const a=n.length;let l;for(t=0;t<a;t++)l=n[t],e[l]=o[l];return e}function ws(o){function e(n,t,a,l){let c=n[l++];if(c==="__proto__")return!0;const d=Number.isFinite(+c),h=l>=n.length;return c=!c&&C.isArray(a)?a.length:c,h?(C.hasOwnProp(a,c)?a[c]=[a[c],t]:a[c]=t,!d):((!a[c]||!C.isObject(a[c]))&&(a[c]=[]),e(n,t,a[c],l)&&C.isArray(a[c])&&(a[c]=Jp(a[c])),!d)}if(C.isFormData(o)&&C.isFunction(o.entries)){const n={};return C.forEachEntry(o,(t,a)=>{e(zp(t),a,n,0)}),n}return null}function Wp(o,e,n){if(C.isString(o))try{return(e||JSON.parse)(o),C.trim(o)}catch(t){if(t.name!=="SyntaxError")throw t}return(n||JSON.stringify)(o)}const st={transitional:Ss,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const t=n.getContentType()||"",a=t.indexOf("application/json")>-1,l=C.isObject(e);if(l&&C.isHTMLForm(e)&&(e=new FormData(e)),C.isFormData(e))return a?JSON.stringify(ws(e)):e;if(C.isArrayBuffer(e)||C.isBuffer(e)||C.isStream(e)||C.isFile(e)||C.isBlob(e)||C.isReadableStream(e))return e;if(C.isArrayBufferView(e))return e.buffer;if(C.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let d;if(l){if(t.indexOf("application/x-www-form-urlencoded")>-1)return Hp(e,this.formSerializer).toString();if((d=C.isFileList(e))||t.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return mt(d?{"files[]":e}:e,h&&new h,this.formSerializer)}}return l||a?(n.setContentType("application/json",!1),Wp(e)):e}],transformResponse:[function(e){const n=this.transitional||st.transitional,t=n&&n.forcedJSONParsing,a=this.responseType==="json";if(C.isResponse(e)||C.isReadableStream(e))return e;if(e&&C.isString(e)&&(t&&!this.responseType||a)){const c=!(n&&n.silentJSONParsing)&&a;try{return JSON.parse(e,this.parseReviver)}catch(d){if(c)throw d.name==="SyntaxError"?oe.from(d,oe.ERR_BAD_RESPONSE,this,null,this.response):d}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Pe.classes.FormData,Blob:Pe.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};C.forEach(["delete","get","head","post","put","patch"],o=>{st.headers[o]={}});const Kp=C.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Xp=o=>{const e={};let n,t,a;return o&&o.split(`
`).forEach(function(c){a=c.indexOf(":"),n=c.substring(0,a).trim().toLowerCase(),t=c.substring(a+1).trim(),!(!n||e[n]&&Kp[n])&&(n==="set-cookie"?e[n]?e[n].push(t):e[n]=[t]:e[n]=e[n]?e[n]+", "+t:t)}),e},Bt=Symbol("internals");function We(o){return o&&String(o).trim().toLowerCase()}function lt(o){return o===!1||o==null?o:C.isArray(o)?o.map(lt):String(o)}function Qp(o){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let t;for(;t=n.exec(o);)e[t[1]]=t[2];return e}const Yp=o=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(o.trim());function bt(o,e,n,t,a){if(C.isFunction(t))return t.call(this,e,n);if(a&&(e=n),!!C.isString(e)){if(C.isString(t))return e.indexOf(t)!==-1;if(C.isRegExp(t))return t.test(e)}}function Zp(o){return o.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,t)=>n.toUpperCase()+t)}function eh(o,e){const n=C.toCamelCase(" "+e);["get","set","has"].forEach(t=>{Object.defineProperty(o,t+n,{value:function(a,l,c){return this[t].call(this,e,a,l,c)},configurable:!0})})}let Ce=class{constructor(e){e&&this.set(e)}set(e,n,t){const a=this;function l(d,h,u){const m=We(h);if(!m)throw new Error("header name must be a non-empty string");const w=C.findKey(a,m);(!w||a[w]===void 0||u===!0||u===void 0&&a[w]!==!1)&&(a[w||h]=lt(d))}const c=(d,h)=>C.forEach(d,(u,m)=>l(u,m,h));if(C.isPlainObject(e)||e instanceof this.constructor)c(e,n);else if(C.isString(e)&&(e=e.trim())&&!Yp(e))c(Xp(e),n);else if(C.isObject(e)&&C.isIterable(e)){let d={},h,u;for(const m of e){if(!C.isArray(m))throw TypeError("Object iterator must return a key-value pair");d[u=m[0]]=(h=d[u])?C.isArray(h)?[...h,m[1]]:[h,m[1]]:m[1]}c(d,n)}else e!=null&&l(n,e,t);return this}get(e,n){if(e=We(e),e){const t=C.findKey(this,e);if(t){const a=this[t];if(!n)return a;if(n===!0)return Qp(a);if(C.isFunction(n))return n.call(this,a,t);if(C.isRegExp(n))return n.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=We(e),e){const t=C.findKey(this,e);return!!(t&&this[t]!==void 0&&(!n||bt(this,this[t],t,n)))}return!1}delete(e,n){const t=this;let a=!1;function l(c){if(c=We(c),c){const d=C.findKey(t,c);d&&(!n||bt(t,t[d],d,n))&&(delete t[d],a=!0)}}return C.isArray(e)?e.forEach(l):l(e),a}clear(e){const n=Object.keys(this);let t=n.length,a=!1;for(;t--;){const l=n[t];(!e||bt(this,this[l],l,e,!0))&&(delete this[l],a=!0)}return a}normalize(e){const n=this,t={};return C.forEach(this,(a,l)=>{const c=C.findKey(t,l);if(c){n[c]=lt(a),delete n[l];return}const d=e?Zp(l):String(l).trim();d!==l&&delete n[l],n[d]=lt(a),t[d]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return C.forEach(this,(t,a)=>{t!=null&&t!==!1&&(n[a]=e&&C.isArray(t)?t.join(", "):t)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const t=new this(e);return n.forEach(a=>t.set(a)),t}static accessor(e){const t=(this[Bt]=this[Bt]={accessors:{}}).accessors,a=this.prototype;function l(c){const d=We(c);t[d]||(eh(a,c),t[d]=!0)}return C.isArray(e)?e.forEach(l):l(e),this}};Ce.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);C.reduceDescriptors(Ce.prototype,({value:o},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>o,set(t){this[n]=t}}});C.freezeMethods(Ce);function yt(o,e){const n=this||st,t=e||n,a=Ce.from(t.headers);let l=t.data;return C.forEach(o,function(d){l=d.call(n,l,a.normalize(),e?e.status:void 0)}),a.normalize(),l}function $s(o){return!!(o&&o.__CANCEL__)}function ze(o,e,n){oe.call(this,o??"canceled",oe.ERR_CANCELED,e,n),this.name="CanceledError"}C.inherits(ze,oe,{__CANCEL__:!0});function Ps(o,e,n){const t=n.config.validateStatus;!n.status||!t||t(n.status)?o(n):e(new oe("Request failed with status code "+n.status,[oe.ERR_BAD_REQUEST,oe.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function th(o){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(o);return e&&e[1]||""}function sh(o,e){o=o||10;const n=new Array(o),t=new Array(o);let a=0,l=0,c;return e=e!==void 0?e:1e3,function(h){const u=Date.now(),m=t[l];c||(c=u),n[a]=h,t[a]=u;let w=l,x=0;for(;w!==a;)x+=n[w++],w=w%o;if(a=(a+1)%o,a===l&&(l=(l+1)%o),u-c<e)return;const j=m&&u-m;return j?Math.round(x*1e3/j):void 0}}function nh(o,e){let n=0,t=1e3/e,a,l;const c=(u,m=Date.now())=>{n=m,a=null,l&&(clearTimeout(l),l=null),o(...u)};return[(...u)=>{const m=Date.now(),w=m-n;w>=t?c(u,m):(a=u,l||(l=setTimeout(()=>{l=null,c(a)},t-w)))},()=>a&&c(a)]}const ct=(o,e,n=3)=>{let t=0;const a=sh(50,250);return nh(l=>{const c=l.loaded,d=l.lengthComputable?l.total:void 0,h=c-t,u=a(h),m=c<=d;t=c;const w={loaded:c,total:d,progress:d?c/d:void 0,bytes:h,rate:u||void 0,estimated:u&&d&&m?(d-c)/u:void 0,event:l,lengthComputable:d!=null,[e?"download":"upload"]:!0};o(w)},n)},qt=(o,e)=>{const n=o!=null;return[t=>e[0]({lengthComputable:n,total:o,loaded:t}),e[1]]},Vt=o=>(...e)=>C.asap(()=>o(...e)),oh=Pe.hasStandardBrowserEnv?((o,e)=>n=>(n=new URL(n,Pe.origin),o.protocol===n.protocol&&o.host===n.host&&(e||o.port===n.port)))(new URL(Pe.origin),Pe.navigator&&/(msie|trident)/i.test(Pe.navigator.userAgent)):()=>!0,ah=Pe.hasStandardBrowserEnv?{write(o,e,n,t,a,l,c){if(typeof document>"u")return;const d=[`${o}=${encodeURIComponent(e)}`];C.isNumber(n)&&d.push(`expires=${new Date(n).toUTCString()}`),C.isString(t)&&d.push(`path=${t}`),C.isString(a)&&d.push(`domain=${a}`),l===!0&&d.push("secure"),C.isString(c)&&d.push(`SameSite=${c}`),document.cookie=d.join("; ")},read(o){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+o+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(o){this.write(o,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function lh(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)}function rh(o,e){return e?o.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):o}function ks(o,e,n){let t=!lh(e);return o&&(t||n==!1)?rh(o,e):e}const jt=o=>o instanceof Ce?{...o}:o;function Le(o,e){e=e||{};const n={};function t(u,m,w,x){return C.isPlainObject(u)&&C.isPlainObject(m)?C.merge.call({caseless:x},u,m):C.isPlainObject(m)?C.merge({},m):C.isArray(m)?m.slice():m}function a(u,m,w,x){if(C.isUndefined(m)){if(!C.isUndefined(u))return t(void 0,u,w,x)}else return t(u,m,w,x)}function l(u,m){if(!C.isUndefined(m))return t(void 0,m)}function c(u,m){if(C.isUndefined(m)){if(!C.isUndefined(u))return t(void 0,u)}else return t(void 0,m)}function d(u,m,w){if(w in e)return t(u,m);if(w in o)return t(void 0,u)}const h={url:l,method:l,data:l,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:d,headers:(u,m,w)=>a(jt(u),jt(m),w,!0)};return C.forEach(Object.keys({...o,...e}),function(m){const w=h[m]||a,x=w(o[m],e[m],m);C.isUndefined(x)&&w!==d||(n[m]=x)}),n}const Es=o=>{const e=Le({},o);let{data:n,withXSRFToken:t,xsrfHeaderName:a,xsrfCookieName:l,headers:c,auth:d}=e;if(e.headers=c=Ce.from(c),e.url=_s(ks(e.baseURL,e.url,e.allowAbsoluteUrls),o.params,o.paramsSerializer),d&&c.set("Authorization","Basic "+btoa((d.username||"")+":"+(d.password?unescape(encodeURIComponent(d.password)):""))),C.isFormData(n)){if(Pe.hasStandardBrowserEnv||Pe.hasStandardBrowserWebWorkerEnv)c.setContentType(void 0);else if(C.isFunction(n.getHeaders)){const h=n.getHeaders(),u=["content-type","content-length"];Object.entries(h).forEach(([m,w])=>{u.includes(m.toLowerCase())&&c.set(m,w)})}}if(Pe.hasStandardBrowserEnv&&(t&&C.isFunction(t)&&(t=t(e)),t||t!==!1&&oh(e.url))){const h=a&&l&&ah.read(l);h&&c.set(a,h)}return e},ih=typeof XMLHttpRequest<"u",ch=ih&&function(o){return new Promise(function(n,t){const a=Es(o);let l=a.data;const c=Ce.from(a.headers).normalize();let{responseType:d,onUploadProgress:h,onDownloadProgress:u}=a,m,w,x,j,g;function y(){j&&j(),g&&g(),a.cancelToken&&a.cancelToken.unsubscribe(m),a.signal&&a.signal.removeEventListener("abort",m)}let _=new XMLHttpRequest;_.open(a.method.toUpperCase(),a.url,!0),_.timeout=a.timeout;function v(){if(!_)return;const A=Ce.from("getAllResponseHeaders"in _&&_.getAllResponseHeaders()),b={data:!d||d==="text"||d==="json"?_.responseText:_.response,status:_.status,statusText:_.statusText,headers:A,config:o,request:_};Ps(function(N){n(N),y()},function(N){t(N),y()},b),_=null}"onloadend"in _?_.onloadend=v:_.onreadystatechange=function(){!_||_.readyState!==4||_.status===0&&!(_.responseURL&&_.responseURL.indexOf("file:")===0)||setTimeout(v)},_.onabort=function(){_&&(t(new oe("Request aborted",oe.ECONNABORTED,o,_)),_=null)},_.onerror=function(P){const b=P&&P.message?P.message:"Network Error",R=new oe(b,oe.ERR_NETWORK,o,_);R.event=P||null,t(R),_=null},_.ontimeout=function(){let P=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const b=a.transitional||Ss;a.timeoutErrorMessage&&(P=a.timeoutErrorMessage),t(new oe(P,b.clarifyTimeoutError?oe.ETIMEDOUT:oe.ECONNABORTED,o,_)),_=null},l===void 0&&c.setContentType(null),"setRequestHeader"in _&&C.forEach(c.toJSON(),function(P,b){_.setRequestHeader(b,P)}),C.isUndefined(a.withCredentials)||(_.withCredentials=!!a.withCredentials),d&&d!=="json"&&(_.responseType=a.responseType),u&&([x,g]=ct(u,!0),_.addEventListener("progress",x)),h&&_.upload&&([w,j]=ct(h),_.upload.addEventListener("progress",w),_.upload.addEventListener("loadend",j)),(a.cancelToken||a.signal)&&(m=A=>{_&&(t(!A||A.type?new ze(null,o,_):A),_.abort(),_=null)},a.cancelToken&&a.cancelToken.subscribe(m),a.signal&&(a.signal.aborted?m():a.signal.addEventListener("abort",m)));const S=th(a.url);if(S&&Pe.protocols.indexOf(S)===-1){t(new oe("Unsupported protocol "+S+":",oe.ERR_BAD_REQUEST,o));return}_.send(l||null)})},dh=(o,e)=>{const{length:n}=o=o?o.filter(Boolean):[];if(e||n){let t=new AbortController,a;const l=function(u){if(!a){a=!0,d();const m=u instanceof Error?u:this.reason;t.abort(m instanceof oe?m:new ze(m instanceof Error?m.message:m))}};let c=e&&setTimeout(()=>{c=null,l(new oe(`timeout ${e} of ms exceeded`,oe.ETIMEDOUT))},e);const d=()=>{o&&(c&&clearTimeout(c),c=null,o.forEach(u=>{u.unsubscribe?u.unsubscribe(l):u.removeEventListener("abort",l)}),o=null)};o.forEach(u=>u.addEventListener("abort",l));const{signal:h}=t;return h.unsubscribe=()=>C.asap(d),h}},uh=function*(o,e){let n=o.byteLength;if(n<e){yield o;return}let t=0,a;for(;t<n;)a=t+e,yield o.slice(t,a),t=a},ph=async function*(o,e){for await(const n of hh(o))yield*uh(n,e)},hh=async function*(o){if(o[Symbol.asyncIterator]){yield*o;return}const e=o.getReader();try{for(;;){const{done:n,value:t}=await e.read();if(n)break;yield t}}finally{await e.cancel()}},Gt=(o,e,n,t)=>{const a=ph(o,e);let l=0,c,d=h=>{c||(c=!0,t&&t(h))};return new ReadableStream({async pull(h){try{const{done:u,value:m}=await a.next();if(u){d(),h.close();return}let w=m.byteLength;if(n){let x=l+=w;n(x)}h.enqueue(new Uint8Array(m))}catch(u){throw d(u),u}},cancel(h){return d(h),a.return()}},{highWaterMark:2})},Ht=64*1024,{isFunction:ot}=C,mh=(({Request:o,Response:e})=>({Request:o,Response:e}))(C.global),{ReadableStream:zt,TextEncoder:Jt}=C.global,Wt=(o,...e)=>{try{return!!o(...e)}catch{return!1}},fh=o=>{o=C.merge.call({skipUndefined:!0},mh,o);const{fetch:e,Request:n,Response:t}=o,a=e?ot(e):typeof fetch=="function",l=ot(n),c=ot(t);if(!a)return!1;const d=a&&ot(zt),h=a&&(typeof Jt=="function"?(g=>y=>g.encode(y))(new Jt):async g=>new Uint8Array(await new n(g).arrayBuffer())),u=l&&d&&Wt(()=>{let g=!1;const y=new n(Pe.origin,{body:new zt,method:"POST",get duplex(){return g=!0,"half"}}).headers.has("Content-Type");return g&&!y}),m=c&&d&&Wt(()=>C.isReadableStream(new t("").body)),w={stream:m&&(g=>g.body)};a&&["text","arrayBuffer","blob","formData","stream"].forEach(g=>{!w[g]&&(w[g]=(y,_)=>{let v=y&&y[g];if(v)return v.call(y);throw new oe(`Response type '${g}' is not supported`,oe.ERR_NOT_SUPPORT,_)})});const x=async g=>{if(g==null)return 0;if(C.isBlob(g))return g.size;if(C.isSpecCompliantForm(g))return(await new n(Pe.origin,{method:"POST",body:g}).arrayBuffer()).byteLength;if(C.isArrayBufferView(g)||C.isArrayBuffer(g))return g.byteLength;if(C.isURLSearchParams(g)&&(g=g+""),C.isString(g))return(await h(g)).byteLength},j=async(g,y)=>{const _=C.toFiniteNumber(g.getContentLength());return _??x(y)};return async g=>{let{url:y,method:_,data:v,signal:S,cancelToken:A,timeout:P,onDownloadProgress:b,onUploadProgress:R,responseType:N,headers:G,withCredentials:$="same-origin",fetchOptions:U}=Es(g),B=e||fetch;N=N?(N+"").toLowerCase():"text";let Y=dh([S,A&&A.toAbortSignal()],P),ne=null;const Q=Y&&Y.unsubscribe&&(()=>{Y.unsubscribe()});let te;try{if(R&&u&&_!=="get"&&_!=="head"&&(te=await j(G,v))!==0){let L=new n(y,{method:"POST",body:v,duplex:"half"}),I;if(C.isFormData(v)&&(I=L.headers.get("content-type"))&&G.setContentType(I),L.body){const[O,D]=qt(te,ct(Vt(R)));v=Gt(L.body,Ht,O,D)}}C.isString($)||($=$?"include":"omit");const se=l&&"credentials"in n.prototype,ge={...U,signal:Y,method:_.toUpperCase(),headers:G.normalize().toJSON(),body:v,duplex:"half",credentials:se?$:void 0};ne=l&&new n(y,ge);let fe=await(l?B(ne,U):B(y,ge));const W=m&&(N==="stream"||N==="response");if(m&&(b||W&&Q)){const L={};["status","statusText","headers"].forEach(z=>{L[z]=fe[z]});const I=C.toFiniteNumber(fe.headers.get("content-length")),[O,D]=b&&qt(I,ct(Vt(b),!0))||[];fe=new t(Gt(fe.body,Ht,O,()=>{D&&D(),Q&&Q()}),L)}N=N||"text";let J=await w[C.findKey(w,N)||"text"](fe,g);return!W&&Q&&Q(),await new Promise((L,I)=>{Ps(L,I,{data:J,headers:Ce.from(fe.headers),status:fe.status,statusText:fe.statusText,config:g,request:ne})})}catch(se){throw Q&&Q(),se&&se.name==="TypeError"&&/Load failed|fetch/i.test(se.message)?Object.assign(new oe("Network Error",oe.ERR_NETWORK,g,ne),{cause:se.cause||se}):oe.from(se,se&&se.code,g,ne)}}},gh=new Map,Cs=o=>{let e=o&&o.env||{};const{fetch:n,Request:t,Response:a}=e,l=[t,a,n];let c=l.length,d=c,h,u,m=gh;for(;d--;)h=l[d],u=m.get(h),u===void 0&&m.set(h,u=d?new Map:fh(e)),m=u;return u};Cs();const Mt={http:Mp,xhr:ch,fetch:{get:Cs}};C.forEach(Mt,(o,e)=>{if(o){try{Object.defineProperty(o,"name",{value:e})}catch{}Object.defineProperty(o,"adapterName",{value:e})}});const Kt=o=>`- ${o}`,vh=o=>C.isFunction(o)||o===null||o===!1;function bh(o,e){o=C.isArray(o)?o:[o];const{length:n}=o;let t,a;const l={};for(let c=0;c<n;c++){t=o[c];let d;if(a=t,!vh(t)&&(a=Mt[(d=String(t)).toLowerCase()],a===void 0))throw new oe(`Unknown adapter '${d}'`);if(a&&(C.isFunction(a)||(a=a.get(e))))break;l[d||"#"+c]=a}if(!a){const c=Object.entries(l).map(([h,u])=>`adapter ${h} `+(u===!1?"is not supported by the environment":"is not available in the build"));let d=n?c.length>1?`since :
`+c.map(Kt).join(`
`):" "+Kt(c[0]):"as no adapter specified";throw new oe("There is no suitable adapter to dispatch the request "+d,"ERR_NOT_SUPPORT")}return a}const Ts={getAdapter:bh,adapters:Mt};function _t(o){if(o.cancelToken&&o.cancelToken.throwIfRequested(),o.signal&&o.signal.aborted)throw new ze(null,o)}function Xt(o){return _t(o),o.headers=Ce.from(o.headers),o.data=yt.call(o,o.transformRequest),["post","put","patch"].indexOf(o.method)!==-1&&o.headers.setContentType("application/x-www-form-urlencoded",!1),Ts.getAdapter(o.adapter||st.adapter,o)(o).then(function(t){return _t(o),t.data=yt.call(o,o.transformResponse,t),t.headers=Ce.from(t.headers),t},function(t){return $s(t)||(_t(o),t&&t.response&&(t.response.data=yt.call(o,o.transformResponse,t.response),t.response.headers=Ce.from(t.response.headers))),Promise.reject(t)})}const Rs="1.13.2",ft={};["object","boolean","number","function","string","symbol"].forEach((o,e)=>{ft[o]=function(t){return typeof t===o||"a"+(e<1?"n ":" ")+o}});const Qt={};ft.transitional=function(e,n,t){function a(l,c){return"[Axios v"+Rs+"] Transitional option '"+l+"'"+c+(t?". "+t:"")}return(l,c,d)=>{if(e===!1)throw new oe(a(c," has been removed"+(n?" in "+n:"")),oe.ERR_DEPRECATED);return n&&!Qt[c]&&(Qt[c]=!0,console.warn(a(c," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(l,c,d):!0}};ft.spelling=function(e){return(n,t)=>(console.warn(`${t} is likely a misspelling of ${e}`),!0)};function yh(o,e,n){if(typeof o!="object")throw new oe("options must be an object",oe.ERR_BAD_OPTION_VALUE);const t=Object.keys(o);let a=t.length;for(;a-- >0;){const l=t[a],c=e[l];if(c){const d=o[l],h=d===void 0||c(d,l,o);if(h!==!0)throw new oe("option "+l+" must be "+h,oe.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new oe("Unknown option "+l,oe.ERR_BAD_OPTION)}}const rt={assertOptions:yh,validators:ft},Me=rt.validators;let Oe=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Lt,response:new Lt}}async request(e,n){try{return await this._request(e,n)}catch(t){if(t instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const l=a.stack?a.stack.replace(/^.+\n/,""):"";try{t.stack?l&&!String(t.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(t.stack+=`
`+l):t.stack=l}catch{}}throw t}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=Le(this.defaults,n);const{transitional:t,paramsSerializer:a,headers:l}=n;t!==void 0&&rt.assertOptions(t,{silentJSONParsing:Me.transitional(Me.boolean),forcedJSONParsing:Me.transitional(Me.boolean),clarifyTimeoutError:Me.transitional(Me.boolean)},!1),a!=null&&(C.isFunction(a)?n.paramsSerializer={serialize:a}:rt.assertOptions(a,{encode:Me.function,serialize:Me.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),rt.assertOptions(n,{baseUrl:Me.spelling("baseURL"),withXsrfToken:Me.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let c=l&&C.merge(l.common,l[n.method]);l&&C.forEach(["delete","get","head","post","put","patch","common"],g=>{delete l[g]}),n.headers=Ce.concat(c,l);const d=[];let h=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(n)===!1||(h=h&&y.synchronous,d.unshift(y.fulfilled,y.rejected))});const u=[];this.interceptors.response.forEach(function(y){u.push(y.fulfilled,y.rejected)});let m,w=0,x;if(!h){const g=[Xt.bind(this),void 0];for(g.unshift(...d),g.push(...u),x=g.length,m=Promise.resolve(n);w<x;)m=m.then(g[w++],g[w++]);return m}x=d.length;let j=n;for(;w<x;){const g=d[w++],y=d[w++];try{j=g(j)}catch(_){y.call(this,_);break}}try{m=Xt.call(this,j)}catch(g){return Promise.reject(g)}for(w=0,x=u.length;w<x;)m=m.then(u[w++],u[w++]);return m}getUri(e){e=Le(this.defaults,e);const n=ks(e.baseURL,e.url,e.allowAbsoluteUrls);return _s(n,e.params,e.paramsSerializer)}};C.forEach(["delete","get","head","options"],function(e){Oe.prototype[e]=function(n,t){return this.request(Le(t||{},{method:e,url:n,data:(t||{}).data}))}});C.forEach(["post","put","patch"],function(e){function n(t){return function(l,c,d){return this.request(Le(d||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:l,data:c}))}}Oe.prototype[e]=n(),Oe.prototype[e+"Form"]=n(!0)});let _h=class Is{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(l){n=l});const t=this;this.promise.then(a=>{if(!t._listeners)return;let l=t._listeners.length;for(;l-- >0;)t._listeners[l](a);t._listeners=null}),this.promise.then=a=>{let l;const c=new Promise(d=>{t.subscribe(d),l=d}).then(a);return c.cancel=function(){t.unsubscribe(l)},c},e(function(l,c,d){t.reason||(t.reason=new ze(l,c,d),n(t.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=t=>{e.abort(t)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new Is(function(a){e=a}),cancel:e}}};function Sh(o){return function(n){return o.apply(null,n)}}function wh(o){return C.isObject(o)&&o.isAxiosError===!0}const Et={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Et).forEach(([o,e])=>{Et[e]=o});function As(o){const e=new Oe(o),n=is(Oe.prototype.request,e);return C.extend(n,Oe.prototype,e,{allOwnKeys:!0}),C.extend(n,e,null,{allOwnKeys:!0}),n.create=function(a){return As(Le(o,a))},n}const we=As(st);we.Axios=Oe;we.CanceledError=ze;we.CancelToken=_h;we.isCancel=$s;we.VERSION=Rs;we.toFormData=mt;we.AxiosError=oe;we.Cancel=we.CanceledError;we.all=function(e){return Promise.all(e)};we.spread=Sh;we.isAxiosError=wh;we.mergeConfig=Le;we.AxiosHeaders=Ce;we.formToJSON=o=>ws(C.isHTMLForm(o)?new FormData(o):o);we.getAdapter=Ts.getAdapter;we.HttpStatusCode=Et;we.default=we;const{Axios:Rg,AxiosError:Ig,CanceledError:Ag,isCancel:xg,CancelToken:Mg,VERSION:Fg,all:Dg,Cancel:Ng,isAxiosError:Ug,spread:Og,toFormData:Lg,AxiosHeaders:Bg,HttpStatusCode:qg,formToJSON:Vg,getAdapter:jg,mergeConfig:Gg}=we;class $h{static async getAvailableModels(){try{return(await we({url:"/api/models/available-models",method:"GET",baseURL:""})).data}catch(e){return console.error("Failed to fetch available models:",e),{options:[],total:0}}}}const Ph={class:"assigned-tools"},kh={class:"section-header"},Eh={class:"tool-info"},Ch={class:"tool-name"},Th={class:"tool-desc"},Rh={key:0,class:"no-tools"},Ih=ye({__name:"AssignedTools",props:{title:{},selectedToolIds:{},availableTools:{},addButtonText:{default:"Add/Remove Tools"},emptyText:{default:"No tools assigned"},showAddButton:{type:Boolean,default:!0},useGridLayout:{type:Boolean,default:!1}},emits:["add-tools","tools-filtered"],setup(o,{emit:e}){const n=o,t=e,a=me(()=>Array.isArray(n.selectedToolIds)?n.selectedToolIds.filter(d=>n.availableTools.some(h=>h.key===d)):[]);ue(a,d=>{const h=n.selectedToolIds.length;d.length!==h&&t("tools-filtered",d)},{immediate:!0});const l=d=>{const h=n.availableTools.find(m=>m.key===d);return h?`${h.serviceGroup||"Ungrouped"}.${h.name}`:d},c=d=>{const h=n.availableTools.find(u=>u.key===d);return h?h.description:""};return(d,h)=>(p(),f("div",Ph,[s("div",kh,[s("span",null,i(d.title)+" ("+i(a.value.length)+")",1),d.showAddButton?(p(),f("button",{key:0,class:"action-btn small",onClick:h[0]||(h[0]=u=>d.$emit("add-tools"))},[k(r(T),{icon:"carbon:add"}),re(" "+i(d.addButtonText),1)])):V("",!0)]),s("div",{class:le(["tools-grid",{"grid-layout":d.useGridLayout}])},[(p(!0),f(ie,null,pe(a.value,u=>(p(),f("div",{key:u,class:"tool-item assigned"},[s("div",Eh,[s("span",Ch,i(l(u)),1),s("span",Th,i(c(u)),1)])]))),128)),a.value.length===0?(p(),f("div",Rh,[k(r(T),{icon:"carbon:tool-box"}),s("span",null,i(d.emptyText),1)])):V("",!0)],2)]))}}),Ah=_e(Ih,[["__scopeId","data-v-18289139"]]),xh={class:"tool-selection-content"},Mh={class:"tool-controls"},Fh={class:"search-container"},Dh=["placeholder"],Nh={class:"sort-container"},Uh={value:"group"},Oh={value:"name"},Lh={value:"enabled"},Bh={class:"tool-summary"},qh={class:"summary-text"},Vh={key:0,class:"tool-groups"},jh=["onClick"],Gh={class:"group-title-area"},Hh={class:"group-name"},zh={class:"group-count"},Jh={class:"group-enable-all"},Wh=["checked","onChange","data-group"],Kh={class:"enable-label"},Xh={class:"tool-info"},Qh={class:"tool-selection-name"},Yh={key:0,class:"tool-selection-desc"},Zh={class:"tool-actions"},em=["checked","onChange"],tm={key:1,class:"empty-state"},sm=ye({__name:"ToolSelectionModal",props:{modelValue:{type:Boolean},tools:{},selectedToolIds:{}},emits:["update:modelValue","confirm"],setup(o,{emit:e}){const n=o,t=e,a=me({get:()=>n.modelValue,set:R=>t("update:modelValue",R)}),l=F(""),c=F("group"),d=F(new Set),h=F([]),u=(R,N)=>{const G=document.querySelector(`input[data-group="${R}"]`);G&&(G.indeterminate=v(N))};ue(()=>n.selectedToolIds,R=>{h.value=[...R]},{immediate:!0});const m=me(()=>{let R=n.tools.filter(N=>N.key);if(R=R.filter(N=>N.selectable===!0),l.value){const N=l.value.toLowerCase();R=R.filter(G=>G.name.toLowerCase().includes(N)||G.description.toLowerCase().includes(N)||G.serviceGroup.toLowerCase().includes(N))}switch(c.value){case"name":R=[...R].sort((N,G)=>N.name.localeCompare(G.name));break;case"enabled":R=[...R].sort((N,G)=>{const $=h.value.includes(N.key),U=h.value.includes(G.key);return $&&!U?-1:!$&&U?1:N.name.localeCompare(G.name)});break;case"group":default:R=[...R].sort((N,G)=>{const $=N.serviceGroup||"Ungrouped",U=G.serviceGroup||"Ungrouped";return $!==U?$.localeCompare(U):N.name.localeCompare(G.name)});break}return R}),w=me(()=>{const R=new Map;return m.value.forEach(N=>{const G=N.serviceGroup||"Ungrouped";R.has(G)||R.set(G,[]),R.get(G).push(N)}),new Map([...R.entries()].sort())}),x=me(()=>m.value.length);ue([h,w],()=>{ke(()=>{for(const[R,N]of w.value)u(R,N)})},{flush:"post",deep:!1});const j=R=>h.value.includes(R),g=(R,N)=>{N.stopPropagation();const $=N.target.checked;if(!R){console.error("toolKey is undefined, cannot proceed");return}$?h.value.includes(R)||(h.value=[...h.value,R]):h.value=h.value.filter(U=>U!==R)},y=R=>R.filter(N=>h.value.includes(N.key)),_=R=>R.length>0&&R.every(N=>h.value.includes(N.key)),v=R=>{const N=y(R).length;return N>0&&N<R.length},S=(R,N)=>{N.stopPropagation();const $=N.target.checked,U=R.map(B=>B.key);if($){const B=[...h.value];U.forEach(Y=>{B.includes(Y)||B.push(Y)}),h.value=B}else h.value=h.value.filter(B=>!U.includes(B))},A=R=>{d.value.has(R)?d.value.delete(R):d.value.add(R)},P=()=>{t("confirm",[...h.value]),t("update:modelValue",!1)},b=()=>{h.value=[...n.selectedToolIds],t("update:modelValue",!1)};return ue(a,R=>{if(R){d.value.clear();const N=Array.from(w.value.keys());N.length>1&&N.slice(1).forEach(G=>{d.value.add(G)})}}),(R,N)=>(p(),he(ts,{modelValue:a.value,"onUpdate:modelValue":[N[4]||(N[4]=G=>a.value=G),b],title:R.$t("toolSelection.title"),onConfirm:P},{default:je(()=>[s("div",xh,[s("div",Mh,[s("div",Fh,[de(s("input",{"onUpdate:modelValue":N[0]||(N[0]=G=>l.value=G),type:"text",class:"search-input",placeholder:R.$t("toolSelection.searchPlaceholder")},null,8,Dh),[[ve,l.value]])]),s("div",Nh,[de(s("select",{"onUpdate:modelValue":N[1]||(N[1]=G=>c.value=G),class:"sort-select"},[s("option",Uh,i(R.$t("toolSelection.sortByGroup")),1),s("option",Oh,i(R.$t("toolSelection.sortByName")),1),s("option",Lh,i(R.$t("toolSelection.sortByStatus")),1)],512),[[dt,c.value]])])]),s("div",Bh,[s("span",qh,i(R.$t("toolSelection.summary",{groups:w.value.size,tools:x.value,selected:h.value.length})),1)]),w.value.size>0?(p(),f("div",Vh,[(p(!0),f(ie,null,pe(w.value,([G,$])=>(p(),f("div",{key:G,class:"tool-group"},[s("div",{class:le(["tool-group-header",{collapsed:d.value.has(G)}]),onClick:U=>A(G)},[s("div",Gh,[k(r(T),{icon:d.value.has(G)?"carbon:chevron-right":"carbon:chevron-down",class:"collapse-icon"},null,8,["icon"]),k(r(T),{icon:"carbon:folder",class:"group-icon"}),s("span",Hh,i(G),1),s("span",zh," ("+i(y($).length)+"/"+i($.length)+") ",1)]),s("div",{class:"group-actions",onClick:N[2]||(N[2]=be(()=>{},["stop"]))},[s("label",Jh,[s("input",{type:"checkbox",class:"group-enable-checkbox",checked:_($),onChange:U=>S($,U),"data-group":G},null,40,Wh),s("span",Kh,i(R.$t("toolSelection.enableAll")),1)])])],10,jh),s("div",{class:le(["tool-group-content",{collapsed:d.value.has(G)}])},[(p(!0),f(ie,null,pe($,U=>(p(),f("div",{key:U.key,class:"tool-selection-item"},[s("div",Xh,[s("div",Qh,i(U.name),1),U.description?(p(),f("div",Yh,i(U.description),1)):V("",!0)]),s("div",Zh,[s("label",{class:"tool-enable-switch",onClick:N[3]||(N[3]=be(()=>{},["stop"]))},[s("input",{type:"checkbox",class:"tool-enable-checkbox",checked:j(U.key),onChange:B=>g(U.key,B)},null,40,em),N[5]||(N[5]=s("span",{class:"tool-enable-slider"},null,-1))])])]))),128))],2)]))),128))])):(p(),f("div",tm,[k(r(T),{icon:"carbon:tools",class:"empty-icon"}),s("p",null,i(R.$t("toolSelection.noToolsFound")),1)]))])]),_:1},8,["modelValue","title"]))}}),nm=_e(sm,[["__scopeId","data-v-197aa115"]]),om={class:"config-section"},am={class:"section-header"},lm={key:0,class:"error-section"},rm={class:"error-message"},im={class:"error-content"},cm={class:"error-title"},dm={class:"error-description"},um={key:1,class:"visual-editor"},pm={class:"plan-basic-info"},hm={class:"form-row"},mm={class:"form-label"},fm=["placeholder"],gm={key:0,class:"field-error-message"},vm={class:"form-row"},bm={class:"form-label"},ym=["value","placeholder"],_m={class:"steps-section"},Sm={class:"steps-header"},wm={class:"form-label"},$m={class:"steps-actions"},Pm=["title"],km={class:"steps-container"},Em={class:"step-header"},Cm={class:"step-number"},Tm={class:"step-actions"},Rm=["onClick","disabled","title"],Im=["onClick","disabled","title"],Am=["onClick","title"],xm={class:"step-content"},Mm={class:"form-row"},Fm={class:"form-label"},Dm=["onUpdate:modelValue","placeholder"],Nm={class:"form-row"},Um={class:"form-label"},Om=["onUpdate:modelValue","placeholder"],Lm={key:0,class:"preview-section"},Bm={class:"preview-label"},qm={class:"preview-content"},Vm={class:"preview-text"},jm={class:"preview-table-header"},Gm={class:"form-row"},Hm={class:"form-label"},zm={class:"model-selector-wrapper"},Jm={class:"model-input-wrapper"},Wm=["value","placeholder","disabled","onClick","onFocus","onInput","onKeydown"],Km={key:0,class:"dropdown-item disabled"},Xm={key:1,class:"dropdown-item disabled error"},Qm={key:2,class:"dropdown-item disabled"},Ym=["onClick","onMouseenter"],Zm=["onClick","onMouseenter"],ef=["title"],tf={key:0,class:"error-message"},sf={class:"form-row"},nf={key:0,class:"empty-steps"},of={key:0,class:"json-preview"},af={class:"preview-header"},lf={class:"form-label"},rf={class:"json-code"},cf={class:"editor-footer"},df={class:"section-actions"},uf=["disabled","title"],pf=["disabled","title"],hf=["disabled","title"],mf=["disabled"],ff=ye({__name:"JsonEditorV2",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},currentPlanTemplateId:{default:""}},emits:["rollback","restore","save","copy-plan","update:jsonContent"],setup(o,{emit:e}){const{t:n}=Ie(),t=o,a=e,l={...t,hiddenFields:[]},{showJsonPreview:c,displayData:d,formattedJsonOutput:h,addStep:u,removeStep:m,moveStepUp:w,moveStepDown:x,handleRollback:j,handleRestore:g,handleSave:y,toggleJsonPreview:_,closeJsonPreview:v}=rs(l,a),S=F(null),A=F(""),P=F([]),b=F(!1),R=F(""),N=F(new Map),G=F(new Set),$=F(new Map),U=E=>N.value.get(E)??"",B=(E,K)=>{N.value.set(E,K)},Y=E=>{const K=U(E);if(!K.trim())return P.value;const X=K.toLowerCase().trim();return P.value.filter(ae=>ae.value.toLowerCase().includes(X)||ae.label.toLowerCase().includes(X))},ne=E=>{const K=d.steps[E],X=U(E);return G.value.has(E)&&X!==""?X:K.modelName??""},Q=E=>b.value||R.value||d.steps[E].modelName?"":n("sidebar.modelNameDescription")||"",te=E=>G.value.has(E),se=E=>{b.value||G.value.add(E)},ge=E=>{G.value.delete(E),$.value.set(E,-1);const K=d.steps[E];B(E,K.modelName??"")},fe=E=>{te(E)?ge(E):se(E)},W=(E,K)=>{const X=d.steps[K];X.modelName=E,B(K,E),ge(K)},J=(E,K)=>{const X=E.target;B(K,X.value),se(K)},L=E=>$.value.get(E)??-1,I=(E,K)=>{$.value.set(E,K)},O=E=>{const K=L(E),X=Y(E);K>=0&&K<X.length?W(X[K].value,E):K===-1?W("",E):X.length>0?W(X[0].value,E):d.steps[E].modelName||W("",E)},D=E=>{if(!te(E)){se(E),I(E,0);return}const X=Y(E).length+1,ae=L(E),ce=Math.min(ae+1,X-1);I(E,ce)},z=E=>{if(!te(E)){se(E);const ae=Y(E);I(E,ae.length);return}const K=L(E),X=Math.max(K-1,-1);I(E,X)},Z=E=>{E.target.closest(".model-selector")||G.value.clear()};ue(()=>d.steps,E=>{E.forEach((K,X)=>{N.value.has(X)||B(X,K.modelName??"")})},{deep:!0,immediate:!0});const M=F(!1),H=F(-1),ee=async()=>{if(!b.value){b.value=!0,R.value="";try{const E=await $h.getAvailableModels();P.value=E.options}catch(E){console.error("Failed to load models:",E),R.value=E instanceof Error?E.message:"Failed to load models",P.value=[]}finally{b.value=!1}}},$e=E=>{H.value=E,M.value=!0,console.log("[JsonEditorV2] Available tools from store:",q.availableTools)},Se=E=>{H.value>=0&&H.value<d.steps.length&&(d.steps[H.value].selectedToolKeys=[...E]),M.value=!1,H.value=-1},De=(E,K)=>{E>=0&&E<d.steps.length&&(d.steps[E].selectedToolKeys=[...K])},gt=()=>{a("copy-plan")},xs=()=>{try{S.value=null,d.title||(d.title=""),d.directResponse=!1}catch(E){const K=`Failed to initialize JsonEditorV2: ${E instanceof Error?E.message:"Unknown error"}`;S.value=K,console.error(K,E)}};ue(()=>d,E=>{try{E.title.trim()?A.value="":A.value="Title is required field",S.value=null}catch(K){S.value=`Invalid data structure: ${K instanceof Error?K.message:"Unknown error"}`,A.value=""}},{immediate:!0,deep:!0}),ue(()=>t.jsonContent,(E,K)=>{if(console.log("[JsonEditorV2] Props watch triggered - jsonContent changed from",K,"to",E),E&&E!==K){console.log("[JsonEditorV2] Force parsing new jsonContent:",E);try{const X=JSON.parse(E);console.log("[JsonEditorV2] Parsed new jsonContent:",X),Object.assign(d,{title:X.title||"",steps:X.steps||[],directResponse:!1,planTemplateId:X.planTemplateId||t.currentPlanTemplateId||"",planType:X.planType||"dynamic_agent"}),console.log("[JsonEditorV2] Updated displayData with new content:",d)}catch(X){console.warn("[JsonEditorV2] Failed to parse new jsonContent:",X)}}},{immediate:!0}),Te(()=>{if(console.log("[JsonEditorV2] Component mounted with jsonContent:",t.jsonContent),console.log("[JsonEditorV2] Component mounted with currentPlanTemplateId:",t.currentPlanTemplateId),console.log("[JsonEditorV2] Component mounted with displayData:",d),t.jsonContent){console.log("[JsonEditorV2] Force parsing jsonContent on mount:",t.jsonContent);try{const E=JSON.parse(t.jsonContent);console.log("[JsonEditorV2] Parsed jsonContent on mount:",E),Object.assign(d,{title:E.title||"",steps:E.steps||[],directResponse:!1,planTemplateId:E.planTemplateId||t.currentPlanTemplateId||"",planType:E.planType||"dynamic_agent"}),console.log("[JsonEditorV2] Updated displayData on mount:",d)}catch(E){console.warn("[JsonEditorV2] Failed to parse jsonContent on mount:",E)}}xs(),ee(),document.addEventListener("click",Z)}),Re(()=>{document.removeEventListener("click",Z)});const Ft=E=>{const K=E.target;K.style.height="auto";const X=20,ae=Math.ceil(K.scrollHeight/X),ce=4,Je=12,nt=Math.max(ce,Math.min(Je,ae)),Fs=nt*X;K.style.height=`${Fs}px`,K.rows=nt,ae>Je?K.style.overflowY="auto":K.style.overflowY="hidden"},Ms=E=>{if(!E.trim())return"";const K=E.split(",").map(X=>X.trim()).filter(X=>X.length>0);return K.length===0?"":`|${K.join("|")}|`};return(E,K)=>(p(),f("div",om,[s("div",am,[k(r(T),{icon:"carbon:code",width:"16"}),s("span",null,i(E.$t("sidebar.dynamicAgentPlan")),1)]),S.value?(p(),f("div",lm,[s("div",rm,[k(r(T),{icon:"carbon:warning",width:"16"}),s("div",im,[s("div",cm,i(E.$t("sidebar.planTypeError")),1),s("div",dm,i(S.value),1)])])])):(p(),f("div",um,[s("div",pm,[s("div",hm,[s("label",mm,i(E.$t("sidebar.title")),1),de(s("input",{"onUpdate:modelValue":K[0]||(K[0]=X=>r(d).title=X),type:"text",class:le(["form-input",{error:A.value}]),placeholder:E.$t("sidebar.titlePlaceholder")},null,10,fm),[[ve,r(d).title]]),A.value?(p(),f("div",gm,[k(r(T),{icon:"carbon:warning",width:"12"}),re(" "+i(A.value),1)])):V("",!0)]),s("div",vm,[s("label",bm,i(E.$t("sidebar.planTemplateId")),1),s("input",{value:E.currentPlanTemplateId,type:"text",class:"form-input readonly-input",readonly:"",placeholder:E.$t("sidebar.planTemplateIdPlaceholder")},null,8,ym)])]),s("div",_m,[s("div",Sm,[s("label",wm,i(E.$t("sidebar.tasks")),1),s("div",$m,[s("button",{onClick:K[1]||(K[1]=(...X)=>r(u)&&r(u)(...X)),class:"btn btn-xs",title:E.$t("sidebar.addStep")},[k(r(T),{icon:"carbon:add",width:"12"})],8,Pm)])]),s("div",km,[(p(!0),f(ie,null,pe(r(d).steps,(X,ae)=>(p(),f("div",{key:ae,class:"step-item"},[s("div",Em,[s("span",Cm,i(E.$t("sidebar.subtask"))+" "+i(ae+1),1),s("div",Tm,[s("button",{onClick:ce=>r(w)(ae),disabled:ae===0,class:"btn btn-xs",title:E.$t("sidebar.moveUp")},[k(r(T),{icon:"carbon:chevron-up",width:"12"})],8,Rm),s("button",{onClick:ce=>r(x)(ae),disabled:ae===r(d).steps.length-1,class:"btn btn-xs",title:E.$t("sidebar.moveDown")},[k(r(T),{icon:"carbon:chevron-down",width:"12"})],8,Im),s("button",{onClick:ce=>r(m)(ae),class:"btn btn-xs btn-danger",title:E.$t("sidebar.removeStep")},[k(r(T),{icon:"carbon:trash-can",width:"12"})],8,Am)])]),s("div",xm,[s("div",Mm,[s("label",Fm,i(E.$t("sidebar.stepRequirement")),1),de(s("textarea",{"onUpdate:modelValue":ce=>X.stepRequirement=ce,class:"form-textarea auto-resize",placeholder:E.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:K[2]||(K[2]=ce=>Ft(ce))},null,40,Dm),[[ve,X.stepRequirement]])]),s("div",Nm,[s("label",Um,i(E.$t("sidebar.terminateColumns")),1),de(s("textarea",{"onUpdate:modelValue":ce=>X.terminateColumns=ce,class:"form-textarea auto-resize",placeholder:E.$t("sidebar.terminateColumnsPlaceholder"),rows:"4",onInput:K[3]||(K[3]=ce=>Ft(ce))},null,40,Om),[[ve,X.terminateColumns]]),X.terminateColumns&&X.terminateColumns.trim()?(p(),f("div",Lm,[s("div",Bm,i(E.$t("sidebar.preview"))+":",1),s("div",qm,[s("div",Vm,[re(i(E.$t("sidebar.systemWillReturnListWithTableHeaderFormat"))+": ",1),s("span",jm,i(Ms(X.terminateColumns)),1)])])])):V("",!0)]),s("div",Gm,[s("label",Hm,i(E.$t("sidebar.modelName")),1),s("div",zm,[s("div",{class:le(["model-selector",{"is-open":te(ae),"is-disabled":b.value}])},[s("div",Jm,[s("input",{value:ne(ae),type:"text",class:"form-input model-search-input",placeholder:Q(ae),disabled:b.value,onClick:be(ce=>se(ae),["stop"]),onFocus:ce=>se(ae),onInput:ce=>J(ce,ae),onKeydown:[Ke(ce=>ge(ae),["escape"]),Ke(be(ce=>O(ae),["prevent"]),["enter"]),Ke(be(ce=>D(ae),["prevent"]),["down"]),Ke(be(ce=>z(ae),["prevent"]),["up"])]},null,40,Wm),k(r(T),{icon:"carbon:chevron-down",width:"14",class:le(["dropdown-arrow",{"is-open":te(ae)}]),onClick:be(ce=>fe(ae),["stop"])},null,8,["class","onClick"])]),te(ae)?(p(),f("div",{key:0,class:"model-dropdown",onClick:K[4]||(K[4]=be(()=>{},["stop"]))},[b.value?(p(),f("div",Km,i(E.$t("sidebar.loading")),1)):R.value?(p(),f("div",Xm,i(E.$t("sidebar.modelLoadError")),1)):Y(ae).length===0?(p(),f("div",Qm,i(E.$t("sidebar.noModelsFound")),1)):V("",!0),(p(!0),f(ie,null,pe(Y(ae),(ce,Je)=>(p(),f("div",{key:ce.value,class:le(["dropdown-item",{"is-selected":X.modelName===ce.value,"is-highlighted":L(ae)===Je}]),onClick:nt=>W(ce.value,ae),onMouseenter:nt=>I(ae,Je)},[re(i(ce.value)+" ",1),X.modelName===ce.value?(p(),he(r(T),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"})):V("",!0)],42,Ym))),128)),s("div",{class:le(["dropdown-item",{"is-selected":!X.modelName,"is-highlighted":L(ae)===-1}]),onClick:ce=>W("",ae),onMouseenter:ce=>I(ae,-1)},[re(i(E.$t("sidebar.noModelSelected"))+" ",1),X.modelName?V("",!0):(p(),he(r(T),{key:0,icon:"carbon:checkmark",width:"12",class:"check-icon"}))],42,Zm)])):V("",!0)],2),R.value?(p(),f("button",{key:0,onClick:ee,class:"btn btn-sm btn-danger",title:E.$t("sidebar.retryLoadModels")},[k(r(T),{icon:"carbon:warning",width:"14"}),re(" "+i(E.$t("sidebar.retry")),1)],8,ef)):V("",!0)]),R.value?(p(),f("div",tf,[k(r(T),{icon:"carbon:warning",width:"12"}),re(" "+i(R.value),1)])):V("",!0)]),s("div",sf,[k(Ah,{title:E.$t("sidebar.selectedTools"),"selected-tool-ids":X.selectedToolKeys,"available-tools":r(q).availableTools,"add-button-text":E.$t("sidebar.addRemoveTools"),"empty-text":E.$t("sidebar.noTools"),"use-grid-layout":!0,onAddTools:ce=>$e(ae),onToolsFiltered:ce=>De(ae,ce)},null,8,["title","selected-tool-ids","available-tools","add-button-text","empty-text","onAddTools","onToolsFiltered"])])])]))),128)),r(d).steps.length===0?(p(),f("div",nf,[k(r(T),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),s("p",null,i(E.$t("sidebar.noSteps")),1),s("button",{onClick:K[5]||(K[5]=(...X)=>r(u)&&r(u)(...X)),class:"btn btn-primary"},[k(r(T),{icon:"carbon:add",width:"14"}),re(" "+i(E.$t("sidebar.addFirstStep")),1)])])):V("",!0)])]),r(c)?(p(),f("div",of,[s("div",af,[s("label",lf,i(E.$t("sidebar.jsonPreview")),1),s("button",{onClick:K[6]||(K[6]=(...X)=>r(v)&&r(v)(...X)),class:"btn btn-xs"},[k(r(T),{icon:"carbon:close",width:"12"})])]),s("pre",rf,i(r(h)),1)])):V("",!0),s("div",cf,[s("button",{onClick:K[7]||(K[7]=(...X)=>r(_)&&r(_)(...X)),class:"btn btn-sm btn-secondary"},[k(r(T),{icon:"carbon:code",width:"14"}),re(" "+i(r(c)?E.$t("sidebar.hideJson"):E.$t("sidebar.showJson")),1)]),s("div",df,[s("button",{class:"btn btn-sm",onClick:gt,disabled:E.isGenerating||E.isExecuting,title:E.$t("sidebar.copyPlan")},[k(r(T),{icon:"carbon:copy",width:"14"}),re(" "+i(E.$t("sidebar.copyPlan")),1)],8,uf),s("button",{class:"btn btn-sm",onClick:K[8]||(K[8]=(...X)=>r(j)&&r(j)(...X)),disabled:!(E.canRollback??!1),title:E.$t("sidebar.rollback")},[k(r(T),{icon:"carbon:undo",width:"14"})],8,pf),s("button",{class:"btn btn-sm",onClick:K[9]||(K[9]=(...X)=>r(g)&&r(g)(...X)),disabled:!(E.canRestore??!1),title:E.$t("sidebar.restore")},[k(r(T),{icon:"carbon:redo",width:"14"})],8,hf),s("button",{class:"btn btn-primary",onClick:K[10]||(K[10]=(...X)=>r(y)&&r(y)(...X)),disabled:E.isGenerating||E.isExecuting},[k(r(T),{icon:"carbon:save",width:"14"}),K[12]||(K[12]=re(" Save "))],8,mf)])])])),k(nm,{modelValue:M.value,"onUpdate:modelValue":K[11]||(K[11]=X=>M.value=X),tools:r(q).availableTools,"selected-tool-ids":H.value>=0?r(d).steps[H.value]?.selectedToolKeys||[]:[],onConfirm:Se},null,8,["modelValue","tools","selected-tool-ids"])]))}}),gf=_e(ff,[["__scopeId","data-v-e7ef22b6"]]),vf={class:"sidebar-content"},bf={class:"sidebar-content-header"},yf={class:"sidebar-content-title"},_f={class:"tab-switcher"},Sf=["disabled"],wf={key:0,class:"tab-content"},$f={class:"organization-section"},Pf={class:"organization-selector"},kf={class:"organization-label-row"},Ef={class:"organization-label"},Cf=["value"],Tf={value:"by_time"},Rf={value:"by_abc"},If={value:"by_group_time"},Af={value:"by_group_abc"},xf={class:"sidebar-content-list"},Mf={key:0,class:"loading-state"},Ff={key:1,class:"error-state"},Df={key:2,class:"empty-state"},Nf=["onClick","title"],Uf=["onClick","title"],Of={class:"group-name"},Lf={class:"group-count"},Bf=["onClick"],qf={class:"task-icon"},Vf={class:"task-details"},jf={class:"task-title"},Gf={class:"task-preview"},Hf={class:"task-time"},zf={class:"task-actions"},Jf=["title","onClick"],Wf={key:1,class:"tab-content config-tab"},Kf={key:0,class:"config-container"},Xf={class:"template-info-header"},Qf={class:"template-info"},Yf={class:"template-id"},Zf=["title"],eg={class:"modal-header"},tg={class:"modal-body"},sg={class:"form-row"},ng={class:"form-label"},og=["placeholder"],ag={class:"modal-footer"},lg=["disabled"],rg=ye({name:"SidebarPanel",__name:"Sidebar",emits:["planExecutionRequested"],setup(o,{expose:e,emit:n}){const{t}=Ie(),a=ss(),l=F(80),c=F(!1),d=F(0),h=F(0),u=F(null),m=F({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}),w=F({}),x=F(null),j=F({enabled:!0,success:!0}),g=me(()=>j.value.enabled);ue(()=>q.currentPlanTemplateId,(M,H)=>{console.log("[Sidebar] currentPlanTemplateId changed from",H,"to",M)}),ue(()=>q.jsonContent,(M,H)=>{console.log("[Sidebar] jsonContent changed from",H,"to",M)});const y=async()=>{try{const M=await Ae.getCoordinatorToolConfig();j.value=M}catch(M){console.error("Failed to load CoordinatorTool configuration:",M),j.value={enabled:!0,success:!1,message:M instanceof Error?M.message:"Unknown error"}}},_=n,v=async()=>{try{const H=await q.saveTemplate();H?.duplicate?a.success(t("sidebar.saveCompleted",{message:H.message,versionCount:H.versionCount})):H?.saved?(a.success(t("sidebar.saveSuccess",{message:H.message,versionCount:H.versionCount})),A()):H?.message&&a.success(t("sidebar.saveStatus",{message:H.message}))}catch(M){console.error("Failed to save plan modifications:",M);const H=M instanceof Error?M.message:t("sidebar.saveFailed");throw a.error(H),M}},S=async()=>{console.log("[Sidebar] ðŸ’¾ Save before execute requested"),await v()},A=async()=>{await new Promise(M=>setTimeout(M,1e3)),console.log("[Sidebar] ðŸ”„ Refreshing parameter requirements for templateId:",q.currentPlanTemplateId),await ke(),u.value?(console.log("[Sidebar] ðŸ“ž Calling ExecutionController.loadParameterRequirements()"),u.value.loadParameterRequirements(),setTimeout(()=>{u.value&&(console.log("[Sidebar] ðŸ”„ Retry: Calling ExecutionController.loadParameterRequirements() again"),u.value.loadParameterRequirements())},2e3)):console.warn("[Sidebar] âš ï¸ ExecutionController ref not available"),x.value?(console.log("[Sidebar] ðŸ“ž Calling PublishMcpServiceModal.loadParameterRequirements()"),x.value.loadParameterRequirements()):console.warn("[Sidebar] âš ï¸ PublishMcpServiceModal ref not available")},P=()=>{try{typeof q.rollbackVersion=="function"?q.rollbackVersion():console.warn("rollbackVersion method is not available")}catch(M){console.error("Error during rollback operation:",M),a.error(t("sidebar.rollbackFailed")||"Rollback failed")}},b=()=>{try{typeof q.restoreVersion=="function"?q.restoreVersion():console.warn("restoreVersion method is not available")}catch(M){console.error("Error during restore operation:",M),a.error(t("sidebar.restoreFailed")||"Restore failed")}},R=async M=>{console.log("[Sidebar] ðŸŽ¯ handleExecutePlan called with payload:",JSON.stringify(M,null,2)),console.log("[Sidebar] ðŸ“Š Current sidebarStore state:",{currentPlanTemplateId:q.currentPlanTemplateId,selectedTemplate:q.selectedTemplate?.id,jsonContent:q.jsonContent.substring(0,100)+"..."});try{const H=q.preparePlanExecution();if(console.log("[Sidebar] ðŸ“‹ Prepared plan data:",JSON.stringify(H,null,2)),!H){console.log("[Sidebar] âŒ No plan data available, returning");return}const ee={...H,uploadedFiles:M.uploadedFiles,uploadKey:M.uploadKey};M.replacementParams&&Object.keys(M.replacementParams).length>0&&(console.log("[Sidebar] ðŸ”„ Processing replacement parameters:",M.replacementParams),ee.replacementParams=M.replacementParams),console.log("[Sidebar] âœ… Final plan data:",JSON.stringify(ee,null,2));const $e={...M,title:ee.title,planData:ee.planData,params:ee.params,uploadedFiles:ee.uploadedFiles,uploadKey:ee.uploadKey};console.log("[Sidebar] ðŸ“¤ Emitting planExecutionRequested with final payload:",JSON.stringify($e,null,2)),_("planExecutionRequested",$e),console.log("[Sidebar] âœ… Event emitted successfully")}catch(H){console.error("[Sidebar] âŒ Error executing plan:",H);const ee=H instanceof Error?H.message:"Unknown error";a.error(t("sidebar.executeFailed")+": "+ee)}finally{console.log("[Sidebar] ðŸ§¹ Cleaning up after execution"),q.finishPlanExecution(),q.clearExecutionParams(),u.value&&(console.log("[Sidebar] ðŸ§¹ Calling ExecutionController.clearExecutionParams"),u.value.clearExecutionParams()),console.log("[Sidebar] âœ… Cleanup completed")}},N=F(!1),G=F(!1),$=F(""),U=F(!1),B=()=>{if(console.log("[Sidebar] Publish MCP service button clicked"),console.log("[Sidebar] currentPlanTemplateId:",q.currentPlanTemplateId),!q.currentPlanTemplateId){console.log("[Sidebar] No plan template selected, showing warning"),a.error(t("mcpService.selectPlanTemplateFirst"));return}console.log("[Sidebar] Opening publish MCP service modal"),N.value=!0},Y=async M=>{M===null?(console.log("MCP service deleted successfully"),a.success(t("mcpService.deleteSuccess")),m.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}):(console.log("MCP service published successfully:",M),a.success(t("mcpService.publishSuccess")),m.value={...M,toolName:M.toolName,serviceGroup:M.serviceGroup??""}),console.log("[Sidebar] ðŸ”„ Reloading available tools after service publish/delete"),await q.loadAvailableTools(),await I()},ne=()=>{q.clearExecutionParams()},Q=M=>{q.executionParams=M},te=()=>{if(console.log("[Sidebar] Copy plan clicked"),!q.selectedTemplate){console.log("[Sidebar] No template selected, cannot copy"),a.error(t("sidebar.selectPlanFirst"));return}$.value=(q.selectedTemplate.title??t("sidebar.unnamedPlan"))+" (copy)",console.log("[Sidebar] Opening copy plan modal"),G.value=!0},se=()=>{G.value=!1,$.value="",U.value=!1},ge=async()=>{if(!$.value.trim()){a.error(t("sidebar.titleRequired"));return}if(!q.selectedTemplate||!q.jsonContent){a.error(t("sidebar.noPlanToCopy"));return}U.value=!0;try{const H={...JSON.parse(q.jsonContent),title:$.value.trim(),planTemplateId:""},{PlanActApiService:ee}=await es(async()=>{const{PlanActApiService:De}=await import("./sidebar-5tyxaoYG.js").then(gt=>gt.p);return{PlanActApiService:De}},__vite__mapDeps([0,1,2,3])),Se=await ee.savePlanTemplate("",JSON.stringify(H));Se.saved?(a.success(t("sidebar.copyPlanSuccess",{title:$.value.trim()})),await q.loadPlanTemplateList(),se()):a.error(t("sidebar.copyPlanFailed",{message:Se.message||"Unknown error"}))}catch(M){console.error("[Sidebar] Error copying plan:",M);const H=M instanceof Error?M.message:"Unknown error";a.error(t("sidebar.copyPlanFailed",{message:H}))}finally{U.value=!1}},fe=async M=>{if(!M){m.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""};return}try{const H=await Ae.getCoordinatorToolByTemplate(M);H?m.value={...H,toolName:H.toolName,serviceGroup:H.serviceGroup??""}:m.value={toolName:"",toolDescription:"",planTemplateId:M,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}catch(H){console.error("Failed to load tool information:",H),m.value={toolName:"",toolDescription:"",planTemplateId:M,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}},W=M=>{const H=M.target;q.setOrganizationMethod(H.value)},J=M=>{if(isNaN(M.getTime()))return console.warn("Invalid date received:",M),t("time.unknown");const ee=new Date().getTime()-M.getTime(),$e=Math.floor(ee/6e4),Se=Math.floor(ee/36e5),De=Math.floor(ee/864e5);return $e<1?t("time.now"):$e<60?t("time.minuteAgo",{count:$e}):Se<24?t("time.hourAgo",{count:Se}):De<30?t("time.dayAgo",{count:De}):M.toLocaleDateString("zh-CN")},L=M=>{const H=w.value[M.id];return H?`${t("sidebar.publishedTool")}: ${H.toolName}`:""},I=async()=>{for(const M of q.planTemplateList)try{const H=await Ae.getCoordinatorToolByTemplate(M.id);H?.toolName&&(w.value[M.id]=H)}catch(H){console.debug(`No tool found for template ${M.id}:`,H)}},O=M=>{c.value=!0,d.value=M.clientX,h.value=l.value,document.addEventListener("mousemove",D),document.addEventListener("mouseup",z),document.body.style.cursor="col-resize",document.body.style.userSelect="none",M.preventDefault()},D=M=>{if(!c.value)return;const H=window.innerWidth,$e=(M.clientX-d.value)/H*100;let Se=h.value+$e;Se=Math.max(15,Math.min(100,Se)),l.value=Se},z=()=>{c.value=!1,document.removeEventListener("mousemove",D),document.removeEventListener("mouseup",z),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("sidebarWidth",l.value.toString())},Z=()=>{l.value=80,localStorage.setItem("sidebarWidth","80")};return ue(()=>q.currentPlanTemplateId,M=>{fe(M)},{immediate:!0}),Te(async()=>{await q.loadPlanTemplateList(),await I(),y(),q.loadAvailableTools();const M=localStorage.getItem("sidebarWidth");M&&(l.value=parseFloat(M))}),Re(()=>{document.removeEventListener("mousemove",D),document.removeEventListener("mouseup",z)}),e({loadPlanTemplateList:q.loadPlanTemplateList,toggleSidebar:q.toggleSidebar,currentPlanTemplateId:q.currentPlanTemplateId}),(M,H)=>(p(),f(ie,null,[s("div",{class:le(["sidebar-wrapper",{"sidebar-wrapper-collapsed":r(q).isCollapsed}]),style:Ve({width:l.value+"%"})},[s("div",vf,[s("div",bf,[s("div",yf,i(M.$t("sidebar.title")),1)]),s("div",_f,[s("button",{class:le(["tab-button",{active:r(q).currentTab==="list"}]),onClick:H[0]||(H[0]=ee=>r(q).switchToTab("list"))},[k(r(T),{icon:"carbon:list",width:"16"}),re(" "+i(M.$t("sidebar.templateList")),1)],2),s("button",{class:le(["tab-button",{active:r(q).currentTab==="config"}]),onClick:H[1]||(H[1]=ee=>r(q).switchToTab("config")),disabled:!r(q).selectedTemplate},[k(r(T),{icon:"carbon:settings",width:"16"}),re(" "+i(M.$t("sidebar.configuration")),1)],10,Sf)]),r(q).currentTab==="list"?(p(),f("div",wf,[s("div",$f,[s("div",Pf,[s("div",kf,[s("label",Ef,i(M.$t("sidebar.organizationMethod"))+":",1)]),s("select",{value:r(q).organizationMethod,onChange:W,class:"organization-select"},[s("option",Tf,i(M.$t("sidebar.organizationByTime")),1),s("option",Rf,i(M.$t("sidebar.organizationByAbc")),1),s("option",If,i(M.$t("sidebar.organizationByGroupTime")),1),s("option",Af,i(M.$t("sidebar.organizationByGroupAbc")),1)],40,Cf)]),s("button",{class:"new-task-btn",onClick:H[2]||(H[2]=()=>r(q).createNewTemplate(r(q).planType))},[k(r(T),{icon:"carbon:add",width:"16"}),re(" "+i(M.$t("sidebar.newPlan")),1)])]),s("div",xf,[r(q).isLoading?(p(),f("div",Mf,[k(r(T),{icon:"carbon:circle-dash",width:"20",class:"spinning"}),s("span",null,i(M.$t("sidebar.loading")),1)])):r(q).errorMessage?(p(),f("div",Ff,[k(r(T),{icon:"carbon:warning",width:"20"}),s("span",null,i(r(q).errorMessage),1),s("button",{onClick:H[3]||(H[3]=(...ee)=>r(q).loadPlanTemplateList&&r(q).loadPlanTemplateList(...ee)),class:"retry-btn"},i(M.$t("sidebar.retry")),1)])):r(q).planTemplateList.length===0?(p(),f("div",Df,[k(r(T),{icon:"carbon:document",width:"32"}),s("span",null,i(M.$t("sidebar.noTemplates")),1)])):(p(!0),f(ie,{key:3},pe(r(q).groupedTemplates,([ee,$e])=>(p(),f(ie,{key:ee||"ungrouped"},[(r(q).organizationMethod==="by_group_time"||r(q).organizationMethod==="by_group_abc")&&$e.length>0?(p(),f("div",{key:0,class:"group-header",onClick:Se=>r(q).toggleGroupCollapse(ee),title:r(q).isGroupCollapsed(ee)?M.$t("sidebar.expandGroup"):M.$t("sidebar.collapseGroup")},[s("button",{class:"group-toggle-btn",onClick:be(Se=>r(q).toggleGroupCollapse(ee),["stop"]),title:r(q).isGroupCollapsed(ee)?M.$t("sidebar.expandGroup"):M.$t("sidebar.collapseGroup")},[k(r(T),{icon:r(q).isGroupCollapsed(ee)?"carbon:chevron-right":"carbon:chevron-down",width:"14"},null,8,["icon"])],8,Uf),k(r(T),{icon:"carbon:folder",width:"16"}),s("span",Of,i(ee===null||ee===""?M.$t("sidebar.ungroupedMethods"):ee),1),s("span",Lf,"("+i($e.length)+")",1)],8,Nf)):V("",!0),(r(q).organizationMethod==="by_group_time"||r(q).organizationMethod==="by_group_abc")&&r(q).isGroupCollapsed(ee)?V("",!0):(p(!0),f(ie,{key:1},pe($e,Se=>(p(),f("div",{key:Se.id,class:le(["sidebar-content-list-item",{"sidebar-content-list-item-active":Se.id===r(q).currentPlanTemplateId,"grouped-item":r(q).organizationMethod==="by_group_time"||r(q).organizationMethod==="by_group_abc"}]),onClick:De=>r(q).selectTemplate(Se)},[s("div",qf,[k(r(T),{icon:"carbon:document",width:"20"})]),s("div",Vf,[s("div",jf,i(Se.title||M.$t("sidebar.unnamedPlan")),1),s("div",Gf,i(L(Se)),1)]),s("div",Hf,i(J(r(q).parseDateTime(Se.updateTime||Se.createTime))),1),s("div",zf,[s("button",{class:"delete-task-btn",title:M.$t("sidebar.deleteTemplate"),onClick:be(De=>r(q).deleteTemplate(Se),["stop"])},[k(r(T),{icon:"carbon:close",width:"16"})],8,Jf)])],10,Bf))),128))],64))),128))])])):r(q).currentTab==="config"?(p(),f("div",Wf,[r(q).selectedTemplate?(p(),f("div",Kf,[s("div",Xf,[s("div",Qf,[s("h3",null,i(r(q).selectedTemplate.title||M.$t("sidebar.unnamedPlan")),1),s("span",Yf,"ID: "+i(r(q).selectedTemplate.id),1)]),s("button",{class:"back-to-list-btn",onClick:H[4]||(H[4]=ee=>r(q).switchToTab("list"))},[k(r(T),{icon:"carbon:arrow-left",width:"16"})])]),r(q).planType==="dynamic_agent"?(p(),he(gf,{key:r(q).currentPlanTemplateId||"default","json-content":r(q).jsonContent,"can-rollback":r(q).canRollback,"can-restore":r(q).canRestore,"is-generating":r(q).isGenerating,"is-executing":r(q).isExecuting,"current-plan-template-id":r(q).currentPlanTemplateId||"",onRollback:P,onRestore:b,onSave:v,onCopyPlan:te,"onUpdate:jsonContent":H[5]||(H[5]=ee=>r(q).jsonContent=ee)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])):(p(),he(Ju,{key:"simple-"+(r(q).currentPlanTemplateId||"default"),"json-content":r(q).jsonContent,"can-rollback":r(q).canRollback,"can-restore":r(q).canRestore,"is-generating":r(q).isGenerating,"is-executing":r(q).isExecuting,"current-plan-template-id":r(q).currentPlanTemplateId||"",onRollback:P,onRestore:b,onSave:v,"onUpdate:jsonContent":H[6]||(H[6]=ee=>r(q).jsonContent=ee)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])),k(su,{ref_key:"executionControllerRef",ref:u,"current-plan-template-id":r(q).currentPlanTemplateId||"","is-executing":r(q).isExecuting,"is-generating":r(q).isGenerating,"show-publish-button":g.value,"tool-info":m.value,onExecutePlan:R,onPublishMcpService:B,onClearParams:ne,onUpdateExecutionParams:Q,onSaveBeforeExecute:S},null,8,["current-plan-template-id","is-executing","is-generating","show-publish-button","tool-info"])])):V("",!0)])):V("",!0)]),s("div",{class:"sidebar-resizer",onMousedown:O,onDblclick:Z,title:M.$t("sidebar.resizeHint")},H[10]||(H[10]=[s("div",{class:"resizer-line"},null,-1)]),40,Zf)],6),k(Yc,{ref_key:"publishMcpModalRef",ref:x,modelValue:N.value,"onUpdate:modelValue":H[7]||(H[7]=ee=>N.value=ee),"plan-template-id":r(q).currentPlanTemplateId||"","plan-description":r(q).selectedTemplate?.description||"",onPublished:Y},null,8,["modelValue","plan-template-id","plan-description"]),G.value?(p(),f("div",{key:0,class:"modal-overlay",onClick:se},[s("div",{class:"modal-content",onClick:H[9]||(H[9]=be(()=>{},["stop"]))},[s("div",eg,[s("h3",null,i(M.$t("sidebar.copyPlan")),1),s("button",{class:"close-btn",onClick:se},[k(r(T),{icon:"carbon:close",width:"16"})])]),s("div",tg,[s("div",sg,[s("label",ng,i(M.$t("sidebar.newPlanTitle")),1),de(s("input",{"onUpdate:modelValue":H[8]||(H[8]=ee=>$.value=ee),type:"text",class:"form-input",placeholder:M.$t("sidebar.enterNewPlanTitle"),onKeyup:Ke(ge,["enter"])},null,40,og),[[ve,$.value]])])]),s("div",ag,[s("button",{class:"btn btn-secondary",onClick:se},i(M.$t("common.cancel")),1),s("button",{class:"btn btn-primary",onClick:ge,disabled:!$.value.trim()||U.value},[U.value?(p(),he(r(T),{key:0,icon:"carbon:loading",width:"16",class:"spinning"})):V("",!0),re(" "+i(U.value?M.$t("sidebar.copying"):M.$t("sidebar.copyPlan")),1)],8,lg)])])])):V("",!0)],64))}}),ig=_e(rg,[["__scopeId","data-v-4d095078"]]),cg={class:"direct-page"},dg={class:"direct-chat"},ug={class:"chat-header"},pg={class:"header-actions"},hg=["title"],mg=["title"],fg=["title"],gg={class:"chat-content"},vg=["title"],bg={class:"message-content"},yg=ye({name:"DirectIndex",__name:"index",setup(o){const e=Ls(),n=Bs(),t=Qe(),{t:a}=Ie(),{message:l}=Gs(),c=F(""),d=F(""),h=F(),u=F(),m=F(),w=F(),x=F(!1),j=F(!1),g=F(null),y=F(50),_=F(!1),v=F(0),S=F(0),A=me(()=>{if(q.isCollapsed)return y.value;let I=26;w.value&&w.value.sidebarWidth!==void 0&&(I=w.value.sidebarWidth);const O=100-I;return Math.max(20,Math.min(O,y.value))});Te(()=>{if(console.log("[Direct] onMounted called"),console.log("[Direct] taskStore.currentTask:",t.currentTask),console.log("[Direct] taskStore.hasUnprocessedTask():",t.hasUnprocessedTask()),Fe.setEventCallbacks({onPlanUpdate:O=>{console.log("[Direct] Plan update event received for rootPlanId:",O),G(O)&&(console.log("[Direct] Processing plan update for current rootPlanId:",O),u.value&&typeof u.value.handlePlanUpdate=="function"?(console.log("[Direct] Calling chatRef.handlePlanUpdate with rootPlanId:",O),u.value.handlePlanUpdate(O)):console.warn("[Direct] chatRef.handlePlanUpdate method not available"),h.value&&typeof h.value.updateDisplayedPlanProgress=="function"?(console.log("[Direct] Calling rightPanelRef.updateDisplayedPlanProgress with rootPlanId:",O),h.value.updateDisplayedPlanProgress(O)):console.warn("[Direct] rightPanelRef.updateDisplayedPlanProgress method not available"))},onPlanCompleted:O=>{if(console.log("[Direct] Plan completed event received for rootPlanId:",O),!!G(O)){if(console.log("[Direct] Processing plan completion for current rootPlanId:",O),u.value&&typeof u.value.handlePlanCompleted=="function"){const D=Fe.getCachedPlanRecord(O);D&&D.completed?D.summary&&D.summary.trim().length>0?(console.log("[Direct]  Plan details are valid and complete from polling cache, updating UI"),u.value.handlePlanCompleted(D)):(console.warn("[Direct]  Plan completed but summary is empty, still proceeding with available data"),u.value.handlePlanCompleted(D)):(console.warn("[Direct]  Plan details incomplete in cache, attempting API fallback"),Tt.getDetails(O).then(z=>{console.log("[Direct]  Got fresh details from API:",z),z&&z.completed?(console.log("[Direct] Fresh details from API are valid, updating UI"),Fe.setCachedPlanRecord(O,z),u.value.handlePlanCompleted(z)):(console.warn("[Direct]  API details also incomplete, using best available data"),u.value.handlePlanCompleted(D??{planId:O}))}).catch(z=>{console.error("[Direct] API call failed (likely record deleted), using cached data:",z),u.value.handlePlanCompleted(D??{planId:O})}))}else console.warn("[Direct] chatRef.handlePlanCompleted method not available");g.value=null,console.log("[Direct] ðŸ§¹ Cleared currentRootPlanId after plan completion"),m.value&&typeof m.value.resetSession=="function"&&(console.log("[Direct] ðŸ§¹ Calling inputRef.resetSession to clear sessionPlanId"),m.value.resetSession())}},onDialogRoundStart:O=>{console.log("[Direct] Dialog round start event received for rootPlanId:",O),g.value=O,console.log("[Direct] Set currentRootPlanId to:",O),u.value&&typeof u.value.handleDialogRoundStart=="function"?(console.log("[Direct] Calling chatRef.handleDialogRoundStart with planId:",O),u.value.handleDialogRoundStart(O)):console.warn("[Direct] chatRef.handleDialogRoundStart method not available")},onChatInputClear:()=>{console.log("[Direct] Chat input clear event received"),B()},onChatInputUpdateState:O=>{if(console.log("[Direct] Chat input update state event received for rootPlanId:",O),!G(O,!0))return;const D=Fe.getCachedUIState(O);D&&ne(D.enabled,D.placeholder)},onPlanError:O=>{u.value.handlePlanError(O)}}),console.log("[Direct] Event callbacks registered to planExecutionManager"),q.loadPlanTemplateList(),t.hasUnprocessedTask()&&t.currentTask){const O=t.currentTask.prompt;console.log("[Direct] Found unprocessed task from store:",O),O.trim()?(t.markTaskAsProcessed(),ke(async()=>{try{console.log("[Direct] Calling handleChatSendMessage with taskContent:",O),await $({input:O})}catch(D){console.warn("[Direct] handleChatSendMessage failed, falling back to prompt:",D),c.value=O}})):(console.log("[Direct] Task has empty content, marking as processed without execution"),t.markTaskAsProcessed())}else{const O=t.getAndClearTaskToInput();O?(d.value=O,console.log("[Direct] Setting inputOnlyContent for input only:",d.value)):(c.value=e.query.prompt||"",console.log("[Direct] Received task from URL:",c.value),console.log("[Direct] No unprocessed task in store"))}const I=localStorage.getItem("directPanelWidth");I&&(y.value=parseFloat(I)),console.log("[Direct] Final prompt value:",c.value),d.value&&ke(()=>{m.value&&typeof m.value.setInputValue=="function"&&(m.value.setInputValue(d.value),console.log("[Direct] Set input value:",d.value),d.value="")}),window.addEventListener("plan-execution-requested",(O=>{console.log("[DirectView] Received plan-execution-requested event:",O.detail),W(O.detail)}))}),ue(()=>t.currentTask,I=>{if(console.log("[Direct] Watch taskStore.currentTask triggered, newTask:",I),I&&!I.processed&&I.prompt.trim()){const O=I.prompt;t.markTaskAsProcessed(),console.log("[Direct] Received new task from store:",O),ke(async()=>{try{console.log("[Direct] Directly executing new task via handleChatSendMessage:",O),await $({input:O})}catch(D){console.warn("[Direct] handleChatSendMessage failed for new task:",D)}})}else console.log("[Direct] Task is null, already processed, or has empty prompt - ignoring")},{immediate:!1}),ue(()=>c.value,(I,O)=>{console.log("[Direct] prompt value changed from:",O,"to:",I)},{immediate:!1}),ue(()=>t.taskToInput,I=>{console.log("[Direct] Watch taskStore.taskToInput triggered, newTaskToInput:",I),I.trim()&&(console.log("[Direct] Setting input value from taskToInput:",I),ke(()=>{m.value&&typeof m.value.setInputValue=="function"&&(m.value.setInputValue(I.trim()),console.log("[Direct] Input value set from taskToInput watch:",I.trim()),t.getAndClearTaskToInput())}))},{immediate:!1}),Re(()=>{console.log("[Direct] onUnmounted called, cleaning up resources"),g.value=null,Fe.cleanup(),document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",R),window.removeEventListener("plan-execution-requested",(I=>{W(I.detail)}))});const P=I=>{_.value=!0,v.value=I.clientX,S.value=y.value,document.addEventListener("mousemove",b),document.addEventListener("mouseup",R),document.body.style.cursor="col-resize",document.body.style.userSelect="none",I.preventDefault()},b=I=>{if(!_.value)return;const O=window.innerWidth,z=(I.clientX-v.value)/O*100;let Z=S.value+z;Z=Math.max(20,Math.min(80,Z)),y.value=Z},R=()=>{_.value=!1,document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",R),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("directPanelWidth",y.value.toString())},N=()=>{y.value=50,localStorage.setItem("directPanelWidth","50")},G=(I,O=!1)=>!g.value||I===g.value||O&&(I==="ui-state"||I==="error")?!0:(console.log("[Direct] Ignoring event for non-current rootPlanId:",I,"current:",g.value),!1),$=async I=>{let O=null;try{if(console.log("[DirectView] Processing send-message event:",I),!I.input.trim()){console.warn("[DirectView] Empty input detected, skipping backend request");return}const D=u.value?.addMessage("user",I.input),z=I;z.attachments&&D&&u.value?.updateMessage(D.id,{attachments:z.attachments}),O=u.value?.addMessage("assistant","",{thinking:a("chat.thinkingProcessing")}),O&&u.value?.startStreaming(O.id);const{DirectApiService:Z}=await es(async()=>{const{DirectApiService:ee}=await import("./sidebar-5tyxaoYG.js").then($e=>$e.d);return{DirectApiService:ee}},__vite__mapDeps([0,1,2,3]));let M;z.toolName&&z.replacementParams?(console.log("[DirectView] Calling DirectApiService.executeByToolName with tool:",z.toolName),M=await Z.executeByToolName(z.toolName,z.replacementParams,I.uploadedFiles,I.uploadKey)):(console.log("[DirectView] Calling DirectApiService.sendMessageWithDefaultPlan"),M=await Z.sendMessageWithDefaultPlan(I)),console.log("[DirectView] API response received:",M);const H=M;H.planId&&O?(u.value?.updateMessage(O.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:H.planId,rootPlanId:H.planId,status:"running"}}),g.value=H.planId||null,console.log("[DirectView] Set currentRootPlanId to:",H.planId),Fe.handlePlanExecutionRequested(H.planId,I.input),console.log("[DirectView] Started polling for plan execution updates")):O&&(u.value?.updateMessage(O.id,{content:M.message||M.result||"No response received from backend"}),u.value?.stopStreaming(O.id))}catch(D){const z=D instanceof Error?D.message:String(D);console.error("[DirectView] Send message failed:",z),u.value?.addMessage("assistant",`Error: ${z}`),O&&u.value?.stopStreaming(O.id)}},U=async I=>{console.log("[DirectView] Send message from input:",JSON.stringify(I)),await $(I)},B=()=>{console.log("[DirectView] Input cleared"),m.value&&typeof m.value.clear=="function"&&m.value.clear()},Y=()=>{console.log("[DirectView] Input focused")},ne=(I,O)=>{console.log("[DirectView] Input state updated:",I,O),j.value=!I},Q=I=>{console.log("[DirectView] Step selected:",I),h.value&&typeof h.value.handleStepSelected=="function"?(console.log("[DirectView] Forwarding step selection to right panel:",I),h.value.handleStepSelected(I)):console.warn("[DirectView] rightPanelRef.handleStepSelected method not available")},te=(I,O,D,z)=>{console.log("[DirectView] Sub plan step selected:",{parentPlanId:I,subPlanId:O,stepIndex:D,subStepIndex:z}),h.value&&typeof h.value.handleSubPlanStepSelected=="function"?(console.log("[DirectView] Forwarding sub plan step selection to right panel:",{parentPlanId:I,subPlanId:O,stepIndex:D,subStepIndex:z}),h.value.handleSubPlanStepSelected(I,O,D,z)):console.warn("[DirectView] rightPanelRef.handleSubPlanStepSelected method not available")},se=()=>{console.log("[DirectView] Plan mode button clicked"),q.toggleSidebar(),console.log("[DirectView] Sidebar toggled, isCollapsed:",q.isCollapsed)},ge=()=>{n.push("/home")},fe=()=>{n.push("/configs")},W=async I=>{if(console.log("[DirectView] Plan execution requested:",I),x.value){console.log("[DirectView] Plan execution already in progress, ignoring request");return}x.value=!0;let O=!1,D=null;try{console.log("[DirectView] Adding messages for plan execution:",I.title),u.value?.addMessage("user",I.title),O=!0,D=u.value?.addMessage("assistant","",{thinking:a("chat.planningExecution")}),D&&(u.value?.startStreaming(D.id),console.log("[DirectView] Added assistant message for plan execution:",D.id))}catch(z){console.warn("[DirectView] Failed to add messages:",z)}try{const z=I.planData.planTemplateId;if(!z)throw new Error(a("direct.planTemplateIdNotFound"));console.log("[Direct] Executing plan with templateId:",z,"params:",I.params),console.log("[Direct] About to call PlanActApiService.executePlan");const Z=I.uploadedFiles??[],M=I.uploadKey??void 0;console.log("[Direct] ðŸ” DEBUG - InputArea uploadedFiles:",Z),console.log("[Direct] ðŸ” DEBUG - InputArea uploadKey:",M),console.log("[Direct] Executing with uploaded files:",Z.length),console.log("[Direct] Executing with replacement params:",I.replacementParams);let H;I.params?.trim()?(console.log("[Direct] Calling executePlan with rawParam:",I.params.trim()),H=await it.executePlan(z,I.params.trim(),Z,I.replacementParams,M)):(console.log("[Direct] Calling executePlan without rawParam"),H=await it.executePlan(z,void 0,Z,I.replacementParams,M)),console.log("[Direct] Plan execution API response:",H);const ee=H;if(ee.planId&&D)console.log("[Direct] Got planId from response:",ee.planId,"starting plan execution"),u.value?.updateMessage(D.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:ee.planId,rootPlanId:ee.planId,status:"running"}}),g.value=ee.planId||null,console.log("[Direct] Set currentRootPlanId to:",ee.planId),console.log("[Direct] Delegating plan execution to planExecutionManager"),Fe.handlePlanExecutionRequested(ee.planId,I.title);else throw console.error("[Direct] No planId in response:",H),new Error(a("direct.executionFailedNoPlanId"))}catch(z){const Z=z instanceof Error?z.message:String(z);console.error("[Direct] Plan execution failed:",Z);const M=z instanceof Error?z.stack:void 0;console.error("[Direct] Error details:",{message:Z,stack:M}),g.value=null;try{console.log("[Direct] Adding error messages to chat"),O||u.value?.addMessage("user",I.title),D?(u.value?.updateMessage(D.id,{content:`${a("direct.executionFailed")}: ${z.message||a("common.unknownError")}`,thinking:void 0}),u.value?.stopStreaming(D.id)):u.value?.addMessage("assistant",`${a("direct.executionFailed")}: ${z.message||a("common.unknownError")}`)}catch(H){console.error("[Direct] Failed to add error messages:",H),alert(`${a("direct.executionFailed")}: ${z.message||a("common.unknownError")}`)}}finally{console.log("[Direct] Plan execution finished, resetting isExecutingPlan flag"),x.value=!1}},J=()=>{u.value.showMemory()},L=()=>{Ne.clearMemoryId(),u.value.newChat()};return(I,O)=>(p(),f("div",cg,[s("div",dg,[k(ig,{ref_key:"sidebarRef",ref:w,onPlanExecutionRequested:W},null,512),s("div",{class:"left-panel",style:Ve({width:A.value+"%"})},[s("div",ug,[s("button",{class:"back-button",onClick:ge},[k(r(T),{icon:"carbon:arrow-left"})]),s("h2",null,i(I.$t("conversation")),1),s("div",pg,[k(js),s("button",{class:"config-button",onClick:L,title:I.$t("memory.newChat")},[k(r(T),{icon:"carbon:add",width:"20"})],8,hg),s("button",{class:"config-button",onClick:fe,title:I.$t("direct.configuration")},[k(r(T),{icon:"carbon:settings-adjust",width:"20"})],8,mg),s("button",{class:"cron-task-btn",onClick:O[0]||(O[0]=D=>r(Ne).toggleSidebar()),title:I.$t("memory.selectMemory")},[k(r(T),{icon:"carbon:calendar",width:"20"})],8,fg)])]),s("div",gg,[k(Ja,{ref_key:"chatRef",ref:u,mode:"direct","initial-prompt":c.value||"",onStepSelected:Q,onSubPlanStepSelected:te},null,8,["initial-prompt"])]),(p(),he(vl,{key:I.$i18n.locale,ref_key:"inputRef",ref:m,disabled:j.value,placeholder:j.value?r(a)("input.waiting"):r(a)("input.placeholder"),"initial-value":c.value,onSend:U,onClear:B,onFocus:Y,onUpdateState:ne,onPlanModeClicked:se},null,8,["disabled","placeholder","initial-value"]))],4),s("div",{class:"panel-resizer",onMousedown:P,onDblclick:N,title:I.$t("direct.panelResizeHint")},O[1]||(O[1]=[s("div",{class:"resizer-line"},null,-1)]),40,vg),k(fc,{ref_key:"rightPanelRef",ref:h,style:Ve({width:100-y.value+"%"}),"current-root-plan-id":g.value},null,8,["style","current-root-plan-id"])]),k(ur,{onMemorySelected:J}),r(l).show?(p(),f("div",{key:0,class:le(["message-toast",r(l).type])},[s("div",bg,[s("span",null,i(r(l).text),1)])],2)):V("",!0)]))}}),Hg=_e(yg,[["__scopeId","data-v-3d5215b3"]]);export{Hg as default};
//# sourceMappingURL=index-D1JnnzYW.js.map
