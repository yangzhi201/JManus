import{d as E,u as R,r as m,c as F,o as B,L as O,a as p,b as n,e,f as v,g as k,h as f,i as g,t as o,n as $,w as u,v as N,j,k as L,l as M,m as w,p as P,T as D,F as H,q as J,s as G,x as W,y as Q}from"./index-cOT02xKk.js";import{L as X}from"./llm-check-CJy4TeZw.js";import{I as h,_ as Y}from"./_plugin-vue_export-helper-C6FEcwOB.js";const Z={class:"init-container"},x={class:"init-card"},ee={class:"init-header"},se={class:"logo"},ae={class:"description"},te={class:"step-indicator"},le={class:"step-label"},oe={class:"step-label"},ie={key:0,class:"init-form language-selection"},ne={class:"form-group"},de={class:"form-label"},re={class:"language-options"},ue={class:"language-content"},ce={class:"language-flag"},pe={class:"language-text"},me={class:"language-content"},ve={class:"language-flag"},fe={class:"form-actions single"},ge=["disabled"],he={key:1,class:"init-form"},be={class:"form-group"},ye={class:"form-label"},_e={class:"config-mode-selection"},$e={class:"radio-text"},ke={class:"radio-text"},Ne={key:0,class:"form-group"},Me={for:"apiKey",class:"form-label"},we={class:"api-key-input-container"},Ke=["type","placeholder","disabled"],Ue=["title"],Ce={class:"form-hint"},Se={href:"https://bailian.console.aliyun.com/?tab=model#/api-key",target:"_blank",class:"help-link"},Le={key:1,class:"custom-config-section"},Pe={class:"form-group"},De={for:"baseUrl",class:"form-label"},Ae=["placeholder","disabled"],Ve={class:"form-hint"},qe={class:"form-group"},Te={for:"customApiKey",class:"form-label"},Ie={class:"api-key-input-container"},ze=["type","placeholder","disabled"],Ee=["title"],Re={class:"form-group"},Fe={for:"modelName",class:"form-label"},Be=["placeholder","disabled"],Oe={class:"form-hint"},je={class:"form-group"},He={for:"modelDisplayName",class:"form-label"},Je=["placeholder","disabled"],Ge={class:"form-group"},We={for:"completionsPath",class:"form-label"},Qe=["placeholder","disabled"],Xe={class:"form-actions"},Ye=["disabled"],Ze=["disabled"],xe={key:0,class:"loading-spinner"},es={key:0,class:"error-message"},ss={key:0,class:"success-message"},as={class:"background-animation"},ts=E({name:"InitIndex",__name:"index",setup(ls){const{t:b,locale:U}=R(),K=Q(),d=m(1),r=m(U.value||"en"),t=m({configMode:"dashscope",apiKey:"",baseUrl:"",modelName:"",modelDisplayName:"",completionsPath:""}),i=m(!1),c=m(""),C=m(!1),y=m(!1),_=m(!1),A=F(()=>t.value.apiKey.trim()?t.value.configMode==="custom"?t.value.baseUrl.trim()&&t.value.modelName.trim():!0:!1),V=async()=>{if(r.value)try{i.value=!0,await G(r.value);try{await W(r.value),console.log("Plan templates initialized successfully")}catch(s){const a=s instanceof Error?s.message:String(s);console.warn("Failed to initialize plan templates:",a)}d.value=2}catch(s){const a=s instanceof Error?s.message:String(s);console.warn("Failed to switch language:",a),d.value=2}finally{i.value=!1}},q=()=>{d.value=1},S=()=>{t.value.apiKey="",t.value.baseUrl="",t.value.modelName="",t.value.modelDisplayName="",t.value.completionsPath="",c.value="",y.value=!1,_.value=!1},T=()=>{if(!t.value.apiKey.trim())return c.value=b("init.apiKeyRequired"),!1;if(t.value.configMode==="custom"){if(!t.value.baseUrl.trim())return c.value=b("init.baseUrlRequired"),!1;if(!t.value.modelName.trim())return c.value=b("init.modelNameRequired"),!1}return!0},I=async()=>{if(T())try{i.value=!0,c.value="";const s={configMode:t.value.configMode,apiKey:t.value.apiKey.trim()};t.value.configMode==="custom"&&(s.baseUrl=t.value.baseUrl.trim(),s.modelName=t.value.modelName.trim(),s.modelDisplayName=t.value.modelDisplayName.trim()||t.value.modelName.trim(),s.completionsPath=t.value.completionsPath.trim());const l=await(await fetch("/api/init/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json();l.success?(C.value=!0,localStorage.setItem("hasInitialized","true"),localStorage.setItem("hasVisitedHome","true"),X.clearCache(),l.requiresRestart?setTimeout(()=>{confirm(b("init.restartRequired"))?window.location.reload():K.push("/home")},2e3):setTimeout(()=>{K.push("/home")},2e3)):c.value=l.error||b("init.saveFailed")}catch(s){console.error("Save config failed:",s),c.value=b("init.networkError")}finally{i.value=!1}},z=async()=>{try{const a=await(await fetch("/api/init/status")).json();a.success&&a.initialized&&(localStorage.setItem("hasInitialized","true"),K.push("/home"))}catch(s){console.error("Check init status failed:",s)}};return B(()=>{const s=localStorage.getItem(O);s&&(s==="zh"||s==="en")&&(r.value=s,U.value=s),z()}),(s,a)=>(n(),p("div",Z,[e("div",x,[e("div",ee,[e("div",se,[e("h1",null,[k(g(h),{icon:"carbon:bot",class:"logo-icon"}),a[12]||(a[12]=f(" JManus"))])]),e("h2",null,o(d.value===1?s.$t("init.welcomeStep"):s.$t("init.welcome")),1),e("p",ae,o(d.value===1?s.$t("init.languageStepDescription"):s.$t("init.description")),1)]),e("div",te,[e("div",{class:$(["step",{active:d.value>=1,completed:d.value>1}])},[a[13]||(a[13]=e("span",{class:"step-number"},"1",-1)),e("span",le,o(s.$t("init.stepLanguage")),1)],2),a[15]||(a[15]=e("div",{class:"step-divider"},null,-1)),e("div",{class:$(["step",{active:d.value>=2,completed:d.value>2}])},[a[14]||(a[14]=e("span",{class:"step-number"},"2",-1)),e("span",oe,o(s.$t("init.stepModel")),1)],2)]),d.value===1?(n(),p("div",ie,[e("div",ne,[e("label",de,o(s.$t("init.selectLanguageLabel")),1),e("div",re,[e("label",{class:$(["language-option",{active:r.value==="zh"}])},[u(e("input",{type:"radio","onUpdate:modelValue":a[0]||(a[0]=l=>r.value=l),value:"zh"},null,512),[[N,r.value]]),e("span",ue,[e("span",ce,[k(g(h),{icon:"circle-flags:cn"})]),e("span",pe,[e("strong",null,o(s.$t("language.zh")),1),e("small",null,o(s.$t("init.simplifiedChinese")),1)])])],2),e("label",{class:$(["language-option",{active:r.value==="en"}])},[u(e("input",{type:"radio","onUpdate:modelValue":a[1]||(a[1]=l=>r.value=l),value:"en"},null,512),[[N,r.value]]),e("span",me,[e("span",ve,[k(g(h),{icon:"circle-flags:us"})]),a[16]||(a[16]=e("span",{class:"language-text"},[e("strong",null,"English"),e("small",null,"English (US)")],-1))])],2)])]),e("div",fe,[e("button",{type:"button",class:"submit-btn",disabled:!r.value,onClick:V},o(s.$t("init.continueToModel")),9,ge)])])):v("",!0),d.value===2?(n(),p("div",he,[e("form",{onSubmit:j(I,["prevent"])},[e("div",be,[e("label",ye,o(s.$t("init.configModeLabel")),1),e("div",_e,[e("label",{class:$(["radio-option",{active:t.value.configMode==="dashscope"}])},[u(e("input",{type:"radio","onUpdate:modelValue":a[2]||(a[2]=l=>t.value.configMode=l),value:"dashscope",onChange:S},null,544),[[N,t.value.configMode]]),e("span",$e,[e("strong",null,o(s.$t("init.dashscopeMode")),1),e("small",null,o(s.$t("init.dashscopeModeDesc")),1)])],2),e("label",{class:$(["radio-option",{active:t.value.configMode==="custom"}])},[u(e("input",{type:"radio","onUpdate:modelValue":a[3]||(a[3]=l=>t.value.configMode=l),value:"custom",onChange:S},null,544),[[N,t.value.configMode]]),e("span",ke,[e("strong",null,o(s.$t("init.customMode")),1),e("small",null,o(s.$t("init.customModeDesc")),1)])],2)])]),t.value.configMode==="dashscope"?(n(),p("div",Ne,[e("label",Me,[f(o(s.$t("init.apiKeyLabel"))+" ",1),a[17]||(a[17]=e("span",{class:"required"},"*",-1))]),e("div",we,[u(e("input",{id:"apiKey","onUpdate:modelValue":a[4]||(a[4]=l=>t.value.apiKey=l),type:y.value?"text":"password",class:"form-input",placeholder:s.$t("init.apiKeyPlaceholder"),disabled:i.value,required:""},null,8,Ke),[[L,t.value.apiKey]]),e("button",{type:"button",class:"api-key-toggle-btn",onClick:a[5]||(a[5]=l=>y.value=!y.value),title:y.value?s.$t("init.hideApiKey"):s.$t("init.showApiKey")},[y.value?(n(),M(g(h),{key:0,icon:"carbon:view"})):(n(),M(g(h),{key:1,icon:"carbon:view-off"}))],8,Ue)]),e("div",Ce,[f(o(s.$t("init.apiKeyHint"))+" ",1),e("a",Se,o(s.$t("init.getApiKey")),1)])])):v("",!0),t.value.configMode==="custom"?(n(),p("div",Le,[e("div",Pe,[e("label",De,[f(o(s.$t("init.baseUrlLabel"))+" ",1),a[18]||(a[18]=e("span",{class:"required"},"*",-1))]),u(e("input",{id:"baseUrl","onUpdate:modelValue":a[6]||(a[6]=l=>t.value.baseUrl=l),type:"url",class:"form-input",placeholder:s.$t("init.baseUrlPlaceholder"),disabled:i.value,required:""},null,8,Ae),[[w,t.value.baseUrl]]),e("div",Ve,o(s.$t("init.baseUrlHint")),1)]),e("div",qe,[e("label",Te,[f(o(s.$t("init.customApiKeyLabel"))+" ",1),a[19]||(a[19]=e("span",{class:"required"},"*",-1))]),e("div",Ie,[u(e("input",{id:"customApiKey","onUpdate:modelValue":a[7]||(a[7]=l=>t.value.apiKey=l),type:_.value?"text":"password",class:"form-input",placeholder:s.$t("init.customApiKeyPlaceholder"),disabled:i.value,required:""},null,8,ze),[[L,t.value.apiKey]]),e("button",{type:"button",class:"api-key-toggle-btn",onClick:a[8]||(a[8]=l=>_.value=!_.value),title:_.value?s.$t("init.hideApiKey"):s.$t("init.showApiKey")},[_.value?(n(),M(g(h),{key:0,icon:"carbon:view"})):(n(),M(g(h),{key:1,icon:"carbon:view-off"}))],8,Ee)])]),e("div",Re,[e("label",Fe,[f(o(s.$t("init.modelNameLabel"))+" ",1),a[20]||(a[20]=e("span",{class:"required"},"*",-1))]),u(e("input",{id:"modelName","onUpdate:modelValue":a[9]||(a[9]=l=>t.value.modelName=l),type:"text",class:"form-input",placeholder:s.$t("init.modelNamePlaceholder"),disabled:i.value,required:""},null,8,Be),[[w,t.value.modelName]]),e("div",Oe,o(s.$t("init.modelNameHint")),1)]),e("div",je,[e("label",He,o(s.$t("init.modelDisplayNameLabel")),1),u(e("input",{id:"modelDisplayName","onUpdate:modelValue":a[10]||(a[10]=l=>t.value.modelDisplayName=l),type:"text",class:"form-input",placeholder:s.$t("init.modelDisplayNamePlaceholder"),disabled:i.value},null,8,Je),[[w,t.value.modelDisplayName]])]),e("div",Ge,[e("label",We,o(s.$t("init.completionsPath")),1),u(e("input",{id:"modelDisplayName","onUpdate:modelValue":a[11]||(a[11]=l=>t.value.completionsPath=l),type:"text",class:"form-input",placeholder:s.$t("init.completionsPathPlaceholder"),disabled:i.value},null,8,Qe),[[w,t.value.completionsPath]])])])):v("",!0),e("div",Xe,[e("button",{type:"button",class:"back-btn",onClick:q,disabled:i.value},o(s.$t("init.back")),9,Ye),e("button",{type:"submit",class:"submit-btn",disabled:i.value||!A.value},[i.value?(n(),p("span",xe)):v("",!0),f(" "+o(i.value?s.$t("init.saving"):s.$t("init.saveAndContinue")),1)],8,Ze)])],32)])):v("",!0),k(D,{name:"error-fade"},{default:P(()=>[c.value?(n(),p("div",es,o(c.value),1)):v("",!0)]),_:1}),k(D,{name:"success-fade"},{default:P(()=>[C.value?(n(),p("div",ss,o(s.$t("init.successMessage")),1)):v("",!0)]),_:1})]),e("div",as,[(n(),p(H,null,J(6,l=>e("div",{class:"floating-shape",key:l})),64))]),a[21]||(a[21]=e("div",{class:"background-effects"},[e("div",{class:"gradient-orb orb-1"}),e("div",{class:"gradient-orb orb-2"}),e("div",{class:"gradient-orb orb-3"})],-1))]))}}),ds=Y(ts,[["__scopeId","data-v-c7032a16"]]);export{ds as default};
//# sourceMappingURL=index-CmGZ6IL8.js.map
