{"version":3,"mappings":"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","names":["useTaskStore","defineStore","currentTask","ref","taskToInput","hasVisitedHome","prompt","newTask","task","result","stored","payload","planId","DirectApiService","__vitePreload","directApiService","error","query","LlmCheckService","requestBody","response","toolName","replacementParams","uploadedFiles","uploadKey","errorText","errorData","PlanActApiService","planTemplateId","rawParam","planJson","versionIndex","cronConfig","ToolApiService","SidebarStore","savedMethod","saved","parsed","k","v","obj","value","key","objKey","groupName","currentState","dateValue","templates","a","b","timeA","titleA","titleB","groups","ungrouped","template","serviceGroup","sortedGroups","templatesInGroup","sorted","method","baseUrl","params","tab","message","CoordinatorToolApiService","toolData","versionsResponse","latestContent","planType","emptyTemplate","i18n","content","e","saveResult","planData","tools","tool","sidebarStore","reactive"],"ignoreList":[],"sources":["../../src/stores/task.ts","../../src/api/direct-api-service.ts","../../src/api/plan-act-api-service.ts","../../src/api/tool-api-service.ts","../../src/stores/sidebar.ts"],"sourcesContent":["/*\n * Copyright 2025 the original author or authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { defineStore } from 'pinia'\nimport { ref } from 'vue'\n\nexport interface TaskPayload {\n  prompt: string\n  timestamp: number\n  processed?: boolean\n  planId?: string\n  isRunning?: boolean\n}\n\nexport const useTaskStore = defineStore('task', () => {\n  const currentTask = ref<TaskPayload | null>(null)\n  const taskToInput = ref<string>('')\n  const hasVisitedHome = ref(false)\n\n  // Set new task\n  const setTask = (prompt: string) => {\n    console.log('[TaskStore] setTask called with prompt:', prompt)\n\n    // Don't create tasks with empty prompts\n    if (!prompt.trim()) {\n      console.warn('[TaskStore] Empty prompt provided, not creating task')\n      return\n    }\n\n    const newTask = {\n      prompt,\n      timestamp: Date.now(),\n      processed: false,\n    }\n    currentTask.value = newTask\n    console.log('[TaskStore] Task set, currentTask.value:', currentTask.value)\n  }\n\n  // Set task to input (for pre-filling input without executing)\n  const setTaskToInput = (prompt: string) => {\n    console.log('[TaskStore] setTaskToInput called with prompt:', prompt)\n    taskToInput.value = prompt\n    console.log('[TaskStore] Task to input set:', taskToInput.value)\n  }\n\n  // Get and clear task to input\n  const getAndClearTaskToInput = () => {\n    const task = taskToInput.value\n    taskToInput.value = ''\n    console.log('[TaskStore] getAndClearTaskToInput returning:', task)\n    return task\n  }\n\n  // Mark task as processed\n  const markTaskAsProcessed = () => {\n    console.log('[TaskStore] markTaskAsProcessed called, current task:', currentTask.value)\n    if (currentTask.value) {\n      currentTask.value.processed = true\n      console.log('[TaskStore] Task marked as processed:', currentTask.value)\n    } else {\n      console.log('[TaskStore] No current task to mark as processed')\n    }\n  }\n\n  // Clear task\n  const clearTask = () => {\n    currentTask.value = null\n  }\n\n  // Check if there are unprocessed tasks\n  const hasUnprocessedTask = () => {\n    const result = currentTask.value && !currentTask.value.processed\n    console.log(\n      '[TaskStore] hasUnprocessedTask check - currentTask:',\n      currentTask.value,\n      'result:',\n      result\n    )\n    return result\n  }\n\n  // Set that home page has been visited\n  const markHomeVisited = () => {\n    hasVisitedHome.value = true\n    // Save to localStorage\n    localStorage.setItem('hasVisitedHome', 'true')\n  }\n\n  // Check if home page has been visited\n  const checkHomeVisited = () => {\n    const stored = localStorage.getItem('hasVisitedHome')\n    hasVisitedHome.value = stored === 'true'\n    return hasVisitedHome.value\n  }\n\n  // Reset visit status (for debugging or reset)\n  const resetHomeVisited = () => {\n    hasVisitedHome.value = false\n    localStorage.removeItem('hasVisitedHome')\n  }\n\n  // Emit plan execution requested event\n  const emitPlanExecutionRequested = (payload: {\n    title: string\n    planData: unknown\n    params?: string\n  }) => {\n    console.log('[TaskStore] emitPlanExecutionRequested called with payload:', payload)\n\n    // User is on direct page, send event directly\n    window.dispatchEvent(new CustomEvent('plan-execution-requested', { detail: payload }))\n  }\n\n  // Set task as running with plan ID\n  const setTaskRunning = (planId: string) => {\n    console.log('[TaskStore] setTaskRunning called with planId:', planId)\n    // Create a task if none exists, or update existing one\n    if (!currentTask.value) {\n      // Create a new task for running state\n      currentTask.value = {\n        prompt: '', // Empty prompt since this is just for tracking running state\n        timestamp: Date.now(),\n        processed: false,\n        planId: planId,\n        isRunning: true,\n      }\n      console.log('[TaskStore] Created new task for running state:', currentTask.value)\n    } else {\n      currentTask.value.planId = planId\n      currentTask.value.isRunning = true\n      console.log('[TaskStore] Updated existing task:', currentTask.value)\n    }\n  }\n\n  // Stop current running task\n  const stopCurrentTask = async () => {\n    console.log('[TaskStore] stopCurrentTask called')\n    if (currentTask.value && currentTask.value.isRunning && currentTask.value.planId) {\n      try {\n        const { DirectApiService } = await import('@/api/direct-api-service')\n        await DirectApiService.stopTask(currentTask.value.planId)\n        console.log('[TaskStore] Task stopped successfully')\n\n        // Mark task as no longer running\n        currentTask.value.isRunning = false\n        return true\n      } catch (error) {\n        console.error('[TaskStore] Failed to stop task:', error)\n        return false\n      }\n    }\n    return false\n  }\n\n  // Check if there's a running task\n  const hasRunningTask = () => {\n    const result = currentTask.value && currentTask.value.isRunning\n    console.log('[TaskStore] hasRunningTask check - result:', result)\n    return result\n  }\n\n  return {\n    currentTask,\n    taskToInput,\n    hasVisitedHome,\n    setTask,\n    setTaskToInput,\n    getAndClearTaskToInput,\n    markTaskAsProcessed,\n    clearTask,\n    hasUnprocessedTask,\n    markHomeVisited,\n    checkHomeVisited,\n    resetHomeVisited,\n    emitPlanExecutionRequested,\n    setTaskRunning,\n    stopCurrentTask,\n    hasRunningTask,\n  }\n})\n","/*\n * Copyright 2025 the original author or authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { LlmCheckService } from '@/utils/llm-check'\nimport type { InputMessage } from '@/stores/memory'\n\nexport class DirectApiService {\n  private static readonly BASE_URL = '/api/executor'\n\n  // Send task directly (direct execution mode)\n  public static async sendMessage(query: InputMessage): Promise<unknown> {\n    return LlmCheckService.withLlmCheck(async () => {\n      // Add Vue identification flag to distinguish from HTTP requests\n      const requestBody = {\n        ...query,\n        isVueRequest: true,\n      }\n\n      const response = await fetch(`${this.BASE_URL}/execute`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(requestBody),\n      })\n      if (!response.ok) throw new Error(`API request failed: ${response.status}`)\n      return await response.json()\n    })\n  }\n\n  // Send task using executeByToolNameAsync with default plan template\n  public static async sendMessageWithDefaultPlan(query: InputMessage): Promise<unknown> {\n    // Use default plan template ID as toolName\n    const toolName = 'default-plan-id-001000222'\n\n    // Create replacement parameters with user input\n    const replacementParams = {\n      userRequirement: query.input,\n    }\n\n    return this.executeByToolName(toolName, replacementParams, query.uploadedFiles, query.uploadKey)\n  }\n\n  // Unified method to execute by tool name (replaces both sendMessageWithDefaultPlan and PlanActApiService.executePlan)\n  public static async executeByToolName(\n    toolName: string,\n    replacementParams?: Record<string, string>,\n    uploadedFiles?: string[],\n    uploadKey?: string\n  ): Promise<unknown> {\n    return LlmCheckService.withLlmCheck(async () => {\n      console.log('[DirectApiService] executeByToolName called with:', {\n        toolName,\n        replacementParams,\n        uploadedFiles,\n        uploadKey,\n      })\n\n      const requestBody: Record<string, unknown> = {\n        toolName: toolName,\n        isVueRequest: true,\n      }\n\n      // Include replacement parameters if present\n      if (replacementParams && Object.keys(replacementParams).length > 0) {\n        requestBody.replacementParams = replacementParams\n        console.log('[DirectApiService] Including replacement params:', replacementParams)\n      }\n\n      // Include uploaded files if present\n      if (uploadedFiles && uploadedFiles.length > 0) {\n        requestBody.uploadedFiles = uploadedFiles\n        console.log('[DirectApiService] Including uploaded files:', uploadedFiles.length)\n      }\n\n      // Include uploadKey if present\n      if (uploadKey) {\n        requestBody.uploadKey = uploadKey\n        console.log('[DirectApiService] Including uploadKey:', uploadKey)\n      }\n\n      console.log(\n        '[DirectApiService] Making request to:',\n        `${this.BASE_URL}/executeByToolNameAsync`\n      )\n      console.log('[DirectApiService] Request body:', requestBody)\n\n      const response = await fetch(`${this.BASE_URL}/executeByToolNameAsync`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(requestBody),\n      })\n\n      console.log('[DirectApiService] Response status:', response.status, response.ok)\n\n      if (!response.ok) {\n        const errorText = await response.text()\n        console.error('[DirectApiService] Request failed:', errorText)\n        throw new Error(`Failed to execute: ${response.status}`)\n      }\n\n      const result = await response.json()\n      console.log('[DirectApiService] executeByToolName response:', result)\n      return result\n    })\n  }\n\n  // Stop a running task by plan ID\n  public static async stopTask(planId: string): Promise<unknown> {\n    return LlmCheckService.withLlmCheck(async () => {\n      console.log('[DirectApiService] Stopping task for planId:', planId)\n\n      const response = await fetch(`${this.BASE_URL}/stopTask/${planId}`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n      })\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}))\n        throw new Error(errorData.error || `Failed to stop task: ${response.status}`)\n      }\n\n      return await response.json()\n    })\n  }\n}\n","/*\n * Copyright 2025 the original author or authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// Plan-related API wrapper (TypeScript version for Vue projects)\n\nimport type { CronConfig } from '@/types/cron-task'\nimport { LlmCheckService } from '@/utils/llm-check'\nimport { DirectApiService } from '@/api/direct-api-service'\n\nexport class PlanActApiService {\n  private static readonly PLAN_TEMPLATE_URL = '/api/plan-template'\n  private static readonly CRON_TASK_URL = '/api/cron-tasks'\n\n  // Execute generated plan using ManusController.executeByToolNameAsync\n  public static async executePlan(\n    planTemplateId: string,\n    rawParam?: string,\n    uploadedFiles?: string[],\n    replacementParams?: Record<string, string>,\n    uploadKey?: string\n  ): Promise<unknown> {\n    return LlmCheckService.withLlmCheck(async () => {\n      console.log('[PlanActApiService] executePlan called with:', {\n        planTemplateId,\n        rawParam,\n        uploadedFiles,\n        replacementParams,\n        uploadKey,\n      })\n\n      // Add rawParam to replacementParams if provided (backend expects it in replacementParams)\n      if (rawParam) {\n        if (!replacementParams) {\n          replacementParams = {}\n        }\n        replacementParams['userRequirement'] = rawParam\n        console.log('[PlanActApiService] Added rawParam to replacementParams:', rawParam)\n      }\n\n      // Use the unified DirectApiService method\n      return await DirectApiService.executeByToolName(\n        planTemplateId,\n        replacementParams,\n        uploadedFiles,\n        uploadKey\n      )\n    })\n  }\n\n  // Save plan to server\n  public static async savePlanTemplate(planId: string, planJson: string): Promise<unknown> {\n    const response = await fetch(`${this.PLAN_TEMPLATE_URL}/save`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ planId, planJson }),\n    })\n    if (!response.ok) throw new Error(`Failed to save plan: ${response.status}`)\n    return await response.json()\n  }\n\n  // Get all versions of plan\n  public static async getPlanVersions(planId: string): Promise<unknown> {\n    const response = await fetch(`${this.PLAN_TEMPLATE_URL}/versions`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ planId }),\n    })\n    if (!response.ok) throw new Error(`Failed to get plan versions: ${response.status}`)\n    return await response.json()\n  }\n\n  // Get specific version of plan\n  public static async getVersionPlan(planId: string, versionIndex: number): Promise<unknown> {\n    const response = await fetch(`${this.PLAN_TEMPLATE_URL}/get-version`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ planId, versionIndex: versionIndex.toString() }),\n    })\n    if (!response.ok) throw new Error(`Failed to get specific version plan: ${response.status}`)\n    return await response.json()\n  }\n\n  // Get all plan template list\n  public static async getAllPlanTemplates(): Promise<unknown> {\n    const response = await fetch(`${this.PLAN_TEMPLATE_URL}/list`)\n    if (!response.ok) throw new Error(`Failed to get plan template list: ${response.status}`)\n    return await response.json()\n  }\n\n  // Delete plan template\n  public static async deletePlanTemplate(planId: string): Promise<unknown> {\n    const response = await fetch(`${this.PLAN_TEMPLATE_URL}/delete`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ planId }),\n    })\n    if (!response.ok) throw new Error(`Failed to delete plan template: ${response.status}`)\n    return await response.json()\n  }\n\n  // Create cron task\n  public static async createCronTask(cronConfig: CronConfig): Promise<CronConfig> {\n    const response = await fetch(this.CRON_TASK_URL, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(cronConfig),\n    })\n    if (!response.ok) {\n      try {\n        const errorData = await response.json()\n        throw new Error(errorData.message || `Failed to create cron task: ${response.status}`)\n      } catch {\n        throw new Error(`Failed to create cron task: ${response.status}`)\n      }\n    }\n    return await response.json()\n  }\n}\n","/*\n * Copyright 2025 the original author or authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Tool } from '@/types/tool'\n\n/**\n * Tool API service class\n * Provides basic tool-related functionality without agent dependencies\n */\nexport class ToolApiService {\n  /**\n   * Handle HTTP response\n   */\n  private static async handleResponse(response: Response) {\n    if (!response.ok) {\n      try {\n        const errorData = await response.json()\n        throw new Error(errorData.message || `API request failed: ${response.status}`)\n      } catch {\n        throw new Error(`API request failed: ${response.status} ${response.statusText}`)\n      }\n    }\n    return response\n  }\n\n  /**\n   * Get available tools from backend API\n   */\n  static async getAvailableTools(): Promise<Tool[]> {\n    try {\n      const response = await fetch('/api/tools')\n      const result = await this.handleResponse(response)\n      return await result.json()\n    } catch (error) {\n      console.error('Failed to get available tools:', error)\n      throw error\n    }\n  }\n}\n","/*\n * Copyright 2025 the original author or authors.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { PlanActApiService } from '@/api/plan-act-api-service'\nimport { ToolApiService } from '@/api/tool-api-service'\nimport { i18n } from '@/base/i18n'\nimport type { PlanTemplate } from '@/types/plan-template'\nimport type { Tool } from '@/types/tool'\nimport { reactive } from 'vue'\n\ntype TabType = 'list' | 'config'\n\nexport class SidebarStore {\n  // Basic state\n  isCollapsed = false\n  currentTab: TabType = 'list'\n\n  // Template list related state\n  currentPlanTemplateId: string | null = null\n  planTemplateList: PlanTemplate[] = []\n  selectedTemplate: PlanTemplate | null = null\n  isLoading = false\n  errorMessage = ''\n\n  // Configuration related state\n  jsonContent = ''\n  planType = 'dynamic_agent'\n  generatorPrompt = ''\n  executionParams = ''\n  isGenerating = false\n  isExecuting = false\n\n  // Version control\n  planVersions: string[] = []\n  currentVersionIndex = -1\n\n  // Available tools state\n  availableTools: Array<{\n    key: string\n    name: string\n    description: string\n    enabled: boolean\n    serviceGroup: string\n    selectable: boolean\n  }> = []\n  isLoadingTools = false\n  toolsLoadError = ''\n\n  // Track task requirement modifications\n  hasTaskRequirementModified = false\n\n  // Organization method: 'by_time' | 'by_abc' | 'by_group_time' | 'by_group_abc'\n  organizationMethod: 'by_time' | 'by_abc' | 'by_group_time' | 'by_group_abc' = 'by_time'\n\n  // Template service group mapping (templateId -> serviceGroup)\n  templateServiceGroups: Map<string, string> = new Map()\n\n  // Group collapse state (groupName -> isCollapsed)\n  groupCollapseState: Map<string | null, boolean> = new Map()\n\n  constructor() {\n    // Ensure properties are properly initialized\n    this.planVersions = []\n    this.currentVersionIndex = -1\n    // Load organization method from localStorage\n    const savedMethod = localStorage.getItem('sidebarOrganizationMethod')\n    if (\n      savedMethod &&\n      ['by_time', 'by_abc', 'by_group_time', 'by_group_abc'].includes(savedMethod)\n    ) {\n      this.organizationMethod = savedMethod as\n        | 'by_time'\n        | 'by_abc'\n        | 'by_group_time'\n        | 'by_group_abc'\n    }\n    // Load group collapse state from localStorage\n    this.loadGroupCollapseState()\n  }\n\n  // Load group collapse state from localStorage\n  loadGroupCollapseState() {\n    try {\n      const saved = localStorage.getItem('sidebarGroupCollapseState')\n      if (saved) {\n        const parsed = JSON.parse(saved)\n        this.groupCollapseState = new Map(\n          Object.entries(parsed).map(([k, v]) => [k === 'null' ? null : k, v as boolean])\n        )\n      }\n    } catch (error) {\n      console.warn('[SidebarStore] Failed to load group collapse state:', error)\n    }\n  }\n\n  // Save group collapse state to localStorage\n  saveGroupCollapseState() {\n    try {\n      // Convert Map to object, handling null keys properly\n      const obj: Record<string, boolean> = {}\n      this.groupCollapseState.forEach((value, key) => {\n        // Convert null key to 'null' string for JSON serialization\n        const objKey = key ?? 'null'\n        obj[objKey] = value\n      })\n      localStorage.setItem('sidebarGroupCollapseState', JSON.stringify(obj))\n    } catch (error) {\n      console.warn('[SidebarStore] Failed to save group collapse state:', error)\n    }\n  }\n\n  // Toggle group collapse state\n  toggleGroupCollapse(groupName: string | null) {\n    // Use null as the key in Map, but convert to 'null' string for localStorage\n    const currentState = this.groupCollapseState.get(groupName) ?? false\n    this.groupCollapseState.set(groupName, !currentState)\n    this.saveGroupCollapseState()\n  }\n\n  // Check if group is collapsed\n  isGroupCollapsed(groupName: string | null): boolean {\n    // Use null as the key directly in Map\n    return this.groupCollapseState.get(groupName) ?? false\n  }\n\n  // Helper function to parse date from different formats\n  parseDateTime(dateValue: unknown): Date {\n    if (!dateValue) {\n      return new Date()\n    }\n\n    // If array format [year, month, day, hour, minute, second, nanosecond]\n    if (Array.isArray(dateValue) && dateValue.length >= 6) {\n      // JavaScript Date constructor months start from 0, so subtract 1\n      return new Date(\n        dateValue[0],\n        dateValue[1] - 1,\n        dateValue[2],\n        dateValue[3],\n        dateValue[4],\n        dateValue[5],\n        Math.floor(dateValue[6] / 1000000)\n      )\n    }\n\n    // If string format, parse directly\n    if (typeof dateValue === 'string') {\n      return new Date(dateValue)\n    }\n\n    // Return current time for other cases\n    return new Date()\n  }\n\n  // Computed properties\n  get sortedTemplates(): PlanTemplate[] {\n    const templates = [...this.planTemplateList]\n\n    switch (this.organizationMethod) {\n      case 'by_time':\n        return templates.sort((a, b) => {\n          const timeA = this.parseDateTime(a.updateTime ?? a.createTime)\n          const timeB = this.parseDateTime(b.updateTime ?? b.createTime)\n          return timeB.getTime() - timeA.getTime()\n        })\n      case 'by_abc':\n        return templates.sort((a, b) => {\n          const titleA = (a.title ?? '').toLowerCase()\n          const titleB = (b.title ?? '').toLowerCase()\n          return titleA.localeCompare(titleB)\n        })\n      case 'by_group_time':\n      case 'by_group_abc': {\n        // For grouped methods, return templates sorted within groups\n        // The grouping logic will be handled in the component\n        const groups = new Map<string, PlanTemplate[]>()\n        const ungrouped: PlanTemplate[] = []\n\n        templates.forEach(template => {\n          const serviceGroup = this.templateServiceGroups.get(template.id) ?? ''\n          if (!serviceGroup || serviceGroup === 'default' || serviceGroup === '') {\n            ungrouped.push(template)\n          } else {\n            if (!groups.has(serviceGroup)) {\n              groups.set(serviceGroup, [])\n            }\n            groups.get(serviceGroup)!.push(template)\n          }\n        })\n\n        // Sort within each group\n        const sortedGroups = new Map<string, PlanTemplate[]>()\n        groups.forEach((templatesInGroup, groupName) => {\n          const sorted = [...templatesInGroup]\n          if (this.organizationMethod === 'by_group_time') {\n            sorted.sort((a, b) => {\n              const timeA = this.parseDateTime(a.updateTime ?? a.createTime)\n              const timeB = this.parseDateTime(b.updateTime ?? b.createTime)\n              return timeB.getTime() - timeA.getTime()\n            })\n          } else {\n            // by_group_abc\n            sorted.sort((a, b) => {\n              const titleA = (a.title ?? '').toLowerCase()\n              const titleB = (b.title ?? '').toLowerCase()\n              return titleA.localeCompare(titleB)\n            })\n          }\n          sortedGroups.set(groupName, sorted)\n        })\n\n        // Sort ungrouped templates\n        if (this.organizationMethod === 'by_group_time') {\n          ungrouped.sort((a, b) => {\n            const timeA = this.parseDateTime(a.updateTime ?? a.createTime)\n            const timeB = this.parseDateTime(b.updateTime ?? b.createTime)\n            return timeB.getTime() - timeA.getTime()\n          })\n        } else {\n          ungrouped.sort((a, b) => {\n            const titleA = (a.title ?? '').toLowerCase()\n            const titleB = (b.title ?? '').toLowerCase()\n            return titleA.localeCompare(titleB)\n          })\n        }\n\n        // Return flat list (grouping will be handled in component)\n        const result: PlanTemplate[] = []\n        // Add ungrouped first\n        result.push(...ungrouped)\n        // Add grouped templates sorted by group name\n        const sortedGroupNames = Array.from(sortedGroups.keys()).sort()\n        sortedGroupNames.forEach(groupName => {\n          result.push(...sortedGroups.get(groupName)!)\n        })\n        return result\n      }\n      default:\n        return templates.sort((a, b) => {\n          const timeA = this.parseDateTime(a.updateTime ?? a.createTime)\n          const timeB = this.parseDateTime(b.updateTime ?? b.createTime)\n          return timeB.getTime() - timeA.getTime()\n        })\n    }\n  }\n\n  // Get grouped templates for display\n  get groupedTemplates(): Map<string | null, PlanTemplate[]> {\n    if (this.organizationMethod !== 'by_group_time' && this.organizationMethod !== 'by_group_abc') {\n      // Return all templates in a single group for non-grouped methods\n      return new Map([[null, this.sortedTemplates]])\n    }\n\n    const groups = new Map<string | null, PlanTemplate[]>()\n    const ungrouped: PlanTemplate[] = []\n\n    // Use sorted templates directly (already sorted by sortedTemplates getter)\n    const sorted = this.sortedTemplates\n\n    sorted.forEach(template => {\n      const serviceGroup = this.templateServiceGroups.get(template.id) ?? ''\n      if (!serviceGroup || serviceGroup === 'default' || serviceGroup === '') {\n        ungrouped.push(template)\n      } else {\n        if (!groups.has(serviceGroup)) {\n          groups.set(serviceGroup, [])\n        }\n        groups.get(serviceGroup)!.push(template)\n      }\n    })\n\n    // Create result map with ungrouped first, then sorted groups\n    const result = new Map<string | null, PlanTemplate[]>()\n    if (ungrouped.length > 0) {\n      result.set(null, ungrouped)\n    }\n    // Add sorted groups\n    const sortedGroupNames = Array.from(groups.keys()).sort()\n    sortedGroupNames.forEach(groupName => {\n      result.set(groupName, groups.get(groupName)!)\n    })\n\n    return result\n  }\n\n  // Set organization method\n  setOrganizationMethod(method: 'by_time' | 'by_abc' | 'by_group_time' | 'by_group_abc') {\n    this.organizationMethod = method\n    localStorage.setItem('sidebarOrganizationMethod', method)\n  }\n\n  get canRollback(): boolean {\n    return this.planVersions.length > 1 && this.currentVersionIndex > 0\n  }\n\n  get canRestore(): boolean {\n    return this.planVersions.length > 1 && this.currentVersionIndex < this.planVersions.length - 1\n  }\n\n  get computedApiUrl(): string {\n    if (!this.selectedTemplate) return ''\n    const baseUrl = `/api/plan-template/execute/${this.selectedTemplate.id}`\n    const params = this.executionParams.trim()\n    // GET method, parameter name is allParams\n    return params ? `${baseUrl}?allParams=${encodeURIComponent(params)}` : baseUrl\n  }\n\n  // Actions\n  toggleSidebar() {\n    this.isCollapsed = !this.isCollapsed\n  }\n\n  switchToTab(tab: TabType) {\n    this.currentTab = tab\n  }\n\n  async loadPlanTemplateList() {\n    this.isLoading = true\n    this.errorMessage = ''\n    try {\n      console.log('[SidebarStore] Starting to load plan template list...')\n      const response = (await PlanActApiService.getAllPlanTemplates()) as {\n        templates?: PlanTemplate[]\n      }\n      if (response?.templates && Array.isArray(response.templates)) {\n        this.planTemplateList = response.templates\n        console.log(\n          `[SidebarStore] Successfully loaded ${response.templates.length} plan templates`\n        )\n        // Load service group information for each template\n        await this.loadTemplateServiceGroups()\n      } else {\n        this.planTemplateList = []\n        console.warn('[SidebarStore] API returned abnormal data format, using empty list', response)\n      }\n    } catch (error: unknown) {\n      console.error('[SidebarStore] Failed to load plan template list:', error)\n      this.planTemplateList = []\n      const message = error instanceof Error ? error.message : 'Unknown error'\n      this.errorMessage = `Load failed: ${message}`\n    } finally {\n      this.isLoading = false\n    }\n  }\n\n  // Load service group information for templates\n  async loadTemplateServiceGroups() {\n    this.templateServiceGroups.clear()\n    const { CoordinatorToolApiService } = await import('@/api/coordinator-tool-api-service')\n    for (const template of this.planTemplateList) {\n      try {\n        const toolData = await CoordinatorToolApiService.getCoordinatorToolByTemplate(template.id)\n        if (toolData?.serviceGroup) {\n          this.templateServiceGroups.set(template.id, toolData.serviceGroup)\n        }\n      } catch (error) {\n        // Silently ignore errors for templates without published tools\n        console.debug(`No service group found for template ${template.id}:`, error)\n      }\n    }\n  }\n\n  async selectTemplate(template: PlanTemplate) {\n    this.currentPlanTemplateId = template.id\n    this.selectedTemplate = template\n    this.currentTab = 'config'\n\n    // Clear jsonContent immediately to prevent stale data\n    this.jsonContent = ''\n\n    await this.loadTemplateData(template)\n    console.log(`[SidebarStore] Selected plan template: ${template.id}`)\n  }\n\n  async loadTemplateData(template: PlanTemplate) {\n    try {\n      const versionsResponse = await PlanActApiService.getPlanVersions(template.id)\n      this.planVersions = (versionsResponse as { versions?: string[] }).versions || []\n      if (this.planVersions.length > 0) {\n        const latestContent = this.planVersions[this.planVersions.length - 1]\n        this.jsonContent = latestContent\n        this.currentVersionIndex = this.planVersions.length - 1\n        // Reset modification flag when loading new template\n        this.hasTaskRequirementModified = false\n        try {\n          const parsed = JSON.parse(latestContent)\n          if (parsed.prompt) {\n            this.generatorPrompt = parsed.prompt\n          }\n          if (parsed.params) {\n            this.executionParams = parsed.params\n          }\n          // Update planType based on the loaded template's JSON content\n          if (parsed.planType) {\n            this.planType = parsed.planType\n            console.log(`[SidebarStore] Updated planType to: ${this.planType}`)\n          }\n        } catch {\n          console.warn('Unable to parse JSON content to get prompt information')\n        }\n      } else {\n        this.jsonContent = ''\n        this.generatorPrompt = ''\n        this.executionParams = ''\n        this.planType = 'dynamic_agent'\n        this.hasTaskRequirementModified = false\n      }\n    } catch (error: unknown) {\n      console.error('Failed to load template data:', error)\n      throw error\n    }\n  }\n\n  async createNewTemplate(planType: string) {\n    const emptyTemplate: PlanTemplate = {\n      id: `new-${Date.now()}`,\n      title: i18n.global.t('sidebar.newTemplateName'),\n      description: i18n.global.t('sidebar.newTemplateDescription'),\n      createTime: new Date().toISOString(),\n      updateTime: new Date().toISOString(),\n    }\n    this.selectedTemplate = emptyTemplate\n    this.currentPlanTemplateId = null\n    this.jsonContent = ''\n    this.generatorPrompt = ''\n    this.executionParams = ''\n    this.planVersions = []\n    this.currentVersionIndex = -1\n    this.currentTab = 'config'\n    // Reset to default planType for new templates\n    this.planType = planType\n    // Reset modification flag for new template\n    this.hasTaskRequirementModified = false\n\n    // Reload available tools to ensure fresh tool list\n    console.log('[SidebarStore] ðŸ”„ Reloading available tools for new template')\n    await this.loadAvailableTools()\n\n    console.log('[SidebarStore] Created new empty plan template, switching to config tab')\n  }\n\n  async deleteTemplate(template: PlanTemplate) {\n    if (!template.id) {\n      console.warn('[SidebarStore] deleteTemplate: Invalid template object or ID')\n      return\n    }\n    try {\n      await PlanActApiService.deletePlanTemplate(template.id)\n      if (this.currentPlanTemplateId === template.id) {\n        this.clearSelection()\n      }\n      await this.loadPlanTemplateList()\n      console.log(`[SidebarStore] Plan template ${template.id} has been deleted`)\n    } catch (error: unknown) {\n      console.error('Failed to delete plan template:', error)\n      await this.loadPlanTemplateList()\n      throw error\n    }\n  }\n\n  clearSelection() {\n    this.currentPlanTemplateId = null\n    this.selectedTemplate = null\n    this.jsonContent = ''\n    this.generatorPrompt = ''\n    this.executionParams = ''\n    this.planVersions = []\n    this.currentVersionIndex = -1\n    this.currentTab = 'list'\n    this.hasTaskRequirementModified = false\n  }\n\n  clearExecutionParams() {\n    this.executionParams = ''\n  }\n\n  rollbackVersion() {\n    if (this.canRollback && this.currentVersionIndex > 0) {\n      this.currentVersionIndex--\n      this.jsonContent = this.planVersions[this.currentVersionIndex] || ''\n    }\n  }\n\n  restoreVersion() {\n    if (this.canRestore && this.currentVersionIndex < this.planVersions.length - 1) {\n      this.currentVersionIndex++\n      this.jsonContent = this.planVersions[this.currentVersionIndex] || ''\n    }\n  }\n\n  async saveTemplate() {\n    if (!this.selectedTemplate) return\n    const content = this.jsonContent.trim()\n    if (!content) {\n      throw new Error('Content cannot be empty')\n    }\n    try {\n      JSON.parse(content)\n    } catch (e: unknown) {\n      const message = e instanceof Error ? e.message : 'Unknown error'\n      throw new Error('Invalid format, please correct and save.\\nError: ' + message)\n    }\n    try {\n      const saveResult = await PlanActApiService.savePlanTemplate(this.selectedTemplate.id, content)\n\n      // Update the selected template ID with the real planId returned from backend\n      if (\n        (saveResult as { planId?: string })?.planId &&\n        this.selectedTemplate.id.startsWith('new-')\n      ) {\n        console.log(\n          '[SidebarStore] Updating template ID from',\n          this.selectedTemplate.id,\n          'to',\n          (saveResult as { planId: string }).planId\n        )\n        this.selectedTemplate.id = (saveResult as { planId: string }).planId\n        this.currentPlanTemplateId = (saveResult as { planId: string }).planId\n      }\n\n      if (this.currentVersionIndex < this.planVersions.length - 1) {\n        this.planVersions = this.planVersions.slice(0, this.currentVersionIndex + 1)\n      }\n      this.planVersions.push(content)\n      this.currentVersionIndex = this.planVersions.length - 1\n      // Reset modification flag after successful save\n      this.hasTaskRequirementModified = false\n      return saveResult\n    } catch (error: unknown) {\n      console.error('Failed to save plan template:', error)\n      throw error\n    }\n  }\n\n  preparePlanExecution() {\n    if (!this.selectedTemplate) return null\n    this.isExecuting = true\n    try {\n      let planData\n      try {\n        planData = JSON.parse(this.jsonContent)\n        planData.planTemplateId = this.selectedTemplate.id\n      } catch {\n        throw new Error('Failed to parse plan data')\n      }\n      const title = this.selectedTemplate.title ?? planData.title ?? 'Execution Plan'\n      return {\n        title,\n        planData,\n        params: this.executionParams.trim() || undefined,\n        replacementParams: undefined as Record<string, string> | undefined,\n      }\n    } catch (error: unknown) {\n      console.error('Failed to prepare plan execution:', error)\n      this.isExecuting = false\n      throw error\n    }\n  }\n\n  finishPlanExecution() {\n    this.isExecuting = false\n  }\n  // Load available tools from backend\n  async loadAvailableTools() {\n    if (this.isLoadingTools) {\n      return // Avoid duplicate requests\n    }\n\n    this.isLoadingTools = true\n    this.toolsLoadError = ''\n\n    try {\n      console.log('[SidebarStore] Loading available tools...')\n      const tools = await ToolApiService.getAvailableTools()\n      console.log('[SidebarStore] Loaded available tools:', tools)\n      // Transform tools to ensure they have all required fields\n      this.availableTools = tools.map((tool: Tool) => ({\n        key: tool.key || '',\n        name: tool.name || '',\n        description: tool.description || '',\n        enabled: tool.enabled || false,\n        serviceGroup: tool.serviceGroup || 'default',\n        selectable: tool.selectable,\n      }))\n    } catch (error) {\n      console.error('[SidebarStore] Error loading tools:', error)\n      this.toolsLoadError = error instanceof Error ? error.message : 'Unknown error'\n      this.availableTools = []\n    } finally {\n      this.isLoadingTools = false\n    }\n  }\n}\n\nexport const sidebarStore = reactive(new SidebarStore())\n"],"file":"sidebar-CRBevvcl.js"}